(lp0
((dp1
S'text'
p2
(lp3
VThere is no immediate answer; operators are static, and cannot be expressed in constraints - and the existing primatives don't implement any specific interface (contrast to IComparable[] which can be used to emulate greater-than / less-than)
p4
aVHowever; if you just want it to work, then in
p5
aVNET 3
p6
aV5 there are some options
p7
aVI have put together a library here that allows efficient and simple access to operators with generics - such as:
p8
aVIt can be downloaded as part of MiscUtil
p9
aVAdditionally, in C# 4
p10
aV0, this becomes possible via :
p11
aVI also had (at one point) a
p12
aVNET 2
p13
aV0 version, but that is less tested
p14
aVThe other option is to create an interface such as
p15
aVetc, but then you need to pass an  through all the methods, which gets messy
p16
as(dp17
S'author'
p18
V23354
p19
stp20
a((dp21
g2
(lp22
VThis might also be interesting:
p23
aVReal World Functional Programming"
p24
aVExamples are in F# and C#, but the theory is fairly generic
p25
aVFrom what I've read (pre-release) it is definitely interesting, but so far I think it is making me want to stick more and more with C#, using libraries like Parallel Extensions
p26
as(dp27
g18
V23354
p28
stp29
a((dp30
g2
(lp31
VI agree with leppie's reply; to put that in terms of code:
p32
as(dp33
g18
V23354
p34
stp35
a((dp36
g2
(lp37
VIt all depends on the concrete implementation you are using
p38
aVFor example, Dictionary implements both the generic IDictionary and the non-generic IDictionary - so if you have a Dictionary you can use it as either without issue:
p39
aVHowever, this doesn't necessarily apply for all IDictionary imlpementations, since it is not true that IDictionary : IDictionary
p40
aVIf you are deep in the bowels of some generic code, you could test the current dictionary:
p41
as(dp42
g18
V23354
p43
stp44
a((dp45
g2
(lp46
VWell, without creating the directory, all you can be sure of is that it didn't exist a few microseconds ago
p47
aVHere's one approach that might be close enough:
p48
aVNote that this creates the directory to block against thread races (i
p49
aVe
p50
aVanother process/thread stealing the directory from under you)
p51
as(dp52
g18
V23354
p53
stp54
a((dp55
g2
(lp56
VcurrentValue is no longer a local variable: it is a captured variable
p57
aVThis compiles to something like:
p58
aVJon Skeet has a really good write up of this in C# in Depth, and a separate (not as detailed) discussion here
p59
aVNote that the variable currentValue is now on the heap, not the stack - this has lots of implications, not least that it can now be used by various callers
p60
aVThis is different to java: in java the value of a variable is captured
p61
aVIn C#, the variable itself is captured
p62
as(dp63
g18
V23354
p64
stp65
a((dp66
g2
(lp67
VI suspect the issue is here:
p68
aVMember="AchievementTypeId"
p69
aVFor an association, you should be linking a typed member - for example you might have a property called "AchievementType" (of type AchievementType), and have Member="AchievementType"
p70
aVFor example, in Northwind, linking Customer and Order shows (for Order):
p71
aVThe SqlMetal generated code then has some overly complex code linking the CustomerID and Customer properties
p72
as(dp73
g18
V23354
p74
stp75
a((dp76
g2
(lp77
VSelectMany - i
p78
ag50
aVFor each item in someList, this then uses the lambda "x => x" to get an IEnumerable for the inner items
p79
aVIn this case, each "x" is a List, which is already IEnumerable
p80
aVThese are then returned as a contiguous block
p81
aVEssentially, SelectMany is something like (simplified):
p82
aVAlthough that is simplified somewhat
p83
as(dp84
g18
V23354
p85
stp86
a((dp87
g2
(lp88
VOut of interest, any reason this couldn't use the regular BackgroundWorker, which has full support for cancellation
p89
aVRe the lock - a volatile bool field might be less troublesome
p90
aVHowever, in this case your finalizer isn't doing anything interesting, especially given the "if(disposing)" - i
p91
ag50
aVit only runs the interesting code during Dispose()
p92
aVPersonally I'd be tempted to stick with just IDisposable, and not provide a finalizer: you should be cleaning it up with Dispose()
p93
as(dp94
g18
V23354
p95
stp96
a((dp97
g2
(lp98
VC# supports simple tuples via generics quite easily (as per an earlier answer), and with "mumble typing" (one of many possible  C# language enhancements) to improve type inference they could be very, very powerful
p99
aVFor what it is worth, F# supports tuples natively, and having played with it, I'm not sure that (anonymous) tuples add much
p100
aVwhat you gain in brevity you lose very quickly in code clarity
p101
aVFor code within a single method, there are anonymous types; for code going outside of a method, I think I'll stick to simple named types
p102
aVOf course, if a future C# makes it easier to make these immutable (while still easy to work with) I'll be happy
p103
as(dp104
g18
V23354
p105
stp106
a((dp107
g2
(lp108
VYou could issue the first request with the HEAD verb, and check the content-type response header
p109
aV[edit] It looks like you'll have to use HttpWebRequest for this, though
p110
as(dp111
g18
V23354
p112
stp113
a((dp114
g2
(lp115
VIt certainly isn't possible under regular "mex"
p116
aVIt might be possible with assembly sharing, but I really wouldn't recommend it - you are fighting WCF: it will be brittle, etc
p117
aVOf course, you can always mask this in your object model - i
p118
ag50
aVrather than calling the [OperationContract] method directly, abstract this away into a wrapper method that hides the WCF details (perhaps using different objects for the data transfer than it actually returns)
p119
as(dp120
g18
V23354
p121
stp122
a((dp123
g2
(lp124
VWith DataGridViewCell you can just cast the
p125
aVValue to your known type; the following is a complete example that shows this happening (using double) from a DataTable (like your example)
p126
aVAdditionally, Convert
p127
aVTo{blah}(
p128
aVand Convert
p129
aVChangeType(
p130
aVmight be helpful
p131
as(dp132
g18
V23354
p133
stp134
a((dp135
g2
(lp136
VA better approach would be to change the CommandText to just the name of the SP, and the CommandType to StoredProcedure - then the parameters will work much more cleanly:
p137
aVThis also allows simpler passing by name, rather than position
p138
aVIn general, ADO
p139
aVNET wants DBNull
p140
aVValue, not null
p141
aVI just use a handy method that loops over my args and replaces any nulls with DBNull
p142
aVValue - as simple as (wrapped):
p143
aVHowever
p144
aVSpecifying a value with null is different to letting it assume the default value
p145
aVIf you want it to use the default, don't include the parameter in the command
p146
as(dp147
g18
V23354
p148
stp149
a((dp150
g2
(lp151
VIs it possible that you haven't set the folder as an application in IIS (or your web server)
p152
aVIf not, then the App_Code that gets used is that from the parent folder (or the next application upwards)
p153
aVEnsure that the folder is marked as an application, and uses the correct version of ASP
p154
aVNET
p155
as(dp156
g18
V23354
p157
stp158
a((dp159
g2
(lp160
VLINQ-to-SQL has some support for inheritance via a discriminator (here, here), but you can only query on classes that are defined in the LINQ model - i
p161
ag50
aVdata classes themselves, and (more perhaps importantly for this example) the query itself must be phrased in terms of data classes: although TEntity is a data class, it knows that the property here is declared on the entity base
p162
aVOne option might be dynamic expressions; it the classes themselves declared the property (i
p163
ag50
aVlose the base class, but keep the interface) - but this isn't trivial
p164
aVThe Expression work would be something like below, noting that you might want to either pass in the string as an argument, or obtain the primary key via reflection (if it is attributed):
p165
as(dp166
g18
V23354
p167
stp168
a((dp169
g2
(lp170
VYou can re-declare (new), but you can't re-declare and override at the same time (with the same name)
p171
aVOne option is to use a protected method to hide the detail - this allows both polymorphism and hiding at the same time:
p172
as(dp173
g18
V23354
p174
stp175
a((dp176
g2
(lp177
VIs the folder on the web server (IIS presumably) marked as an ASP
p178
aVNET application
p179
aVIf not, ~/ will point to the next application up, or the site root
p180
aVIt should have a cog icon in the IIS/MMC snap-in
p181
aVAlso ensure that it is running the right version of ASP
p182
aVNET (v2
p183
aVblah usually)
p184
aVIn the IIS/MMC view, find the folder that is your project; right-click; Properties
p185
aVCheck it has an Application Name; if it doesn't, click Create
p186
aVYou might also want to tweak the app-pool if you want it to run in a different identity than default
p187
aVAlso check the ASP
p188
aVNET tab - for example, it might be 2
p189
aV0
p190
aV50727
p191
as(dp192
g18
V23354
p193
stp194
a((dp195
g2
(lp196
VThere are two big problems here; first - they might look the same, but they are implemented completely differently - all of the UI work will need to be redone, largely from scratch
p197
aVYou will probably be able to re-use your actual "doing" code, though (i
p198
ag50
aVthe logic that manipulates the files)
p199
aVSecond - define "local machine"
p200
aVFor an ASP
p201
aVNET application, this is usually the server, which might not be what you want
p202
aVYou can do some things clientside via javascript, but the sandbox security model will prevent you doing much file IO
p203
aVI would suggest perhaps looking at Silverlight, which is somewhere between the two - or perhaps just use ClickOnce to deploy your existing winform exe to remote clients
p204
as(dp205
g18
V23354
p206
stp207
a((dp208
g2
(lp209
VIn 2
p210
aV0, you would use XmLWriterSettings
p211
aVOmitXmlDeclaration, and serialize to an XmlWriter - however I don't think this exists in 1
p212
aV1; so not entirely useful - but just one more "consider upgrading" thing
p213
aVand yes, I realise it isn't always possible
p214
as(dp215
g18
V23354
p216
stp217
a((dp218
g2
(lp219
VLooking at the roadmap, maybe the new JIT/IL implementation that they're quite proud of; could be the C# Evaluation API / C# Shell
p220
aVHowever, I suspect we'll have to wait for PDC to find out
p221
aVMany of the roadmap items are (quite reasonably) like-for-like comparable with MS equivalents - but maybe they've sneaked in a few extras on the quiet ;-p
p222
as(dp223
g18
V23354
p224
stp225
a((dp226
g2
(lp227
VIt should work fine as long as you have specified the table name (else IIRC the first table is used)
p228
aVOf course, you can simplify things by giving the appropriate DataTable (rather than the DataSet) to the DGV
p229
aVYou might also want to check that auto column-generation is enabled on the DGV
p230
aVBut binding to an ad-hoc DataTable works fine; I use it all the time for examples etc
p231
as(dp232
g18
V23354
p233
stp234
a((dp235
g2
(lp236
VFor this you need generic maths
p237
aVLuckily I have done this
p238
aVUsage would be similar to this "complex" (i
p239
ag50
aVx+iy) example
p240
aVThe Operator class is now part of MiscUtil
p241
as(dp242
g18
V23354
p243
stp244
a((dp245
g2
(lp246
VDo you have an event that the UI is subscribing to
p247
aVA {Foo}Changed event if data-binding, or perhaps INotifyPropertyChanged
p248
aVYou might have to mark the event backing field as [NonSerialized] (or however attributes look in VB - I'm a C# person
p249
aVIf you are using field-like-events (i
p250
ag50
aVthe abbreviated syntax without add/remove), then mark the entire event with [field: NonSerialized] (again, translate to VB)
p251
aVMarc
p252
as(dp253
g18
V23354
p254
stp255
a((dp256
g2
(lp257
VIf you don't want to have to remember them, then the compiler also accepts a cast for the same purpose (you can check the IL that the effect is the same - i
p258
ag50
aVthe compiler, not the runtime, does the cast)
p259
aVTo borrow the earlier example:
p260
aVAnd for the record, I agree that "var" is a bad choice here; I'll happily use var for a SortedDictionary, but for "int" it is just lazy
p261
as(dp262
g18
V23354
p263
stp264
a((dp265
g2
(lp266
VPersonally I have tried several, but my preference is two:
p267
aV1: TestDriven
p268
aVNET - for simple testing; I tend to use it with Team Coverage which lets me see the coverage directly in the editor, even though the tests are NUnit (not MSTest) based
p269
aV2: a tiny add-on that lets me group files the same way the IDE does - simpler than editing the csproj (DependentUpon IIRC) by hand
p270
aVFrom here, but there is an (unlinked) updated msi here with better support for choosing which file is the parent (hold [Ctrl] when choosing "Group Items")
p271
aVI've never found I've needed ReSharper etc, but I should give it another try some day
p272
as(dp273
g18
V23354
p274
stp275
a((dp276
g2
(lp277
VWell, in this case the functional approach might not be best suited, simply because there isn't a LINQ "ForEach", and you don't want to use string concatenation: you want to use StringBuilder
p278
aVYou could use ToArray (an example just appeared above), but I'd be tempted to simply use:
p279
aVNot functional programming, but it works
p280
aVof course, if your source is already a string[] then string
p281
aVJoin is perfect
p282
aV(LINQ is a great tool, but not necessarily always the best tool for every job)
p283
as(dp284
g18
V23354
p285
stp286
a((dp287
g2
(lp288
VOf course, if all else fails
p289
aVtest it
p290
aVFollowing gives (in "Release", at the console):
p291
aVSo a jagged array is quicker, at least in this test
p292
aVInteresting
p293
aVHowever, it is a relatively small factor, so I would still stick with whichever describes my requirement better
p294
aVExcept for some specific (high CPU/processing) scenarios, readability / maintainability should trump a small performance gain
p295
aVUp to you, though
p296
aVNote that this test assumes you access the array much more often than you create it, so I have not included timings for creation, where I would expect rectangular to be slightly quicker unless memory is highly fragmented
p297
as(dp298
g18
V23354
p299
stp300
a((dp301
g2
(lp302
VAs an aside - PostSharp has the interesting ability to auto-implement INotifyPropertyChanged - like so
p303
as(dp304
g18
V23354
p305
stp306
a((dp307
g2
(lp308
VCan you clarify what you mean
p309
aVWhat is the setup here
p310
aVIf you want to perform multiple related operations, then WebClient may be more appropriate; this might (I haven't checked - never needed it) retain cookies between calls on the same WebClient instance (and is a lot easier to use, too)
p311
as(dp312
g18
V23354
p313
stp314
a((dp315
g2
(lp316
VI make lots of use of PrincipalPermissionAttribute to demand the user has necessary access rights (using roles) from the Thread's Principal - saves a lot of manual checking in my business code (obviously the UI should check too and disable buttons etc - this is just the double-check at the back-end)
p317
aVI find Principal-based security to be very versatily, especially with a custom Principal
p318
aVBut I don't use the CAS stuff
p319
as(dp320
g18
V23354
p321
stp322
a((dp323
g2
(lp324
VIn most cases,  is more useful
p325
aVwill have less cost when adding/removing items in the middle of the list, whereas  can only cheaply add/remove at the end of the list
p326
aVis only at it's most efficient if you are accessing sequential data (either forwards or backwards) - random access is relatively expensive since it must walk the chain each time (hence why it doesn't have an indexer)
p327
aVHowever, because a  is essentially just an array (with a wrapper) random access is fine
p328
aValso offers a lot of support methods - , , etc; however, these are also available for  with
p329
aVNET 3
p330
aV5/C# 3
p331
aV0 via extension methods - so that is less of a factor
p332
as(dp333
g18
V23354
p334
stp335
a((dp336
g2
(lp337
VI was thinking the same, but in C# ;-p
p338
as(dp339
g18
V23354
p340
stp341
a((dp342
g2
(lp343
VThis is very similar to your last post, and I would expect a similar answer
p344
aVThe only significant difference is that you might return "null" from your method if the timeout fails - then the "Dispose()" is not called, and you can easily check the value:
p345
aVThe only real glitch is that you don't necessarily want to add an extension method to "object" (or even "T where T : class")
p346
aVJon Skeet has looked at this in the past - worth a look
p347
as(dp348
g18
V23354
p349
stp350
a((dp351
g2
(lp352
Vyou want DBNull
p353
aVValue
p354
aVIn my shared DAL code, I use a helper method that just does:
p355
as(dp356
g18
V23354
p357
stp358
a((dp359
g2
(lp360
VThe struct vs class issue is a complex one
p361
aVyou might easily end up using a lot more stack space, for example
p362
aVAnd you certainly don't want mutable structs
p363
aVBut the other points seem sensible, as long as you aren't bending the design out of shape to accomodate it
p364
aV[edit] One other common gotcha is string concatenation; if you are doing concatenation in a loop, use StringBuilder, which will remove a lot of intermediate strings
p365
aVIt might be that GC is busy collecting all the abandoned vesions of your strings
p366
as(dp367
g18
V23354
p368
stp369
a((dp370
g2
(lp371
VNo, basically
p372
aVThe static method in a non-generic class (such as DropDownControl [no <>]) is the best approach, as you should be able to use type-inference when you call Create() - i
p373
ag50
aVC# 3
p374
aV0 helps here both via "var" (very welcome here) and by the much-improved generic type inference rules
p375
aVIn some (more general) case, another similar option is an extension method, but an extension method to create a very specific control from a dictionary doesn't feel very natural - I'd use a non-extension method
p376
aVSomething like:
p377
aVAnother option is inheritance, but I don't like it much
p378
aVThis adds complexity and reduces your flexibility
p379
aVI wouldn't do this
p380
aVOverall, it sounds like you want to be working with just IDictionary<,> - I wonder if you can't simplify your control to just use this, and force non-dictionary callers to wrap themselves in an IDictionary<,> facade
p381
as(dp382
g18
V23354
p383
stp384
a((dp385
g2
(lp386
VJust another recommendation for C# in Depth; not only will it fully explain C# 3
p387
aV0 - but it will also significantly improve your understanding of C# 2
p388
aV0 - for example, a lot of the more subtle nuances of iterator blocks or captured variables
p389
aVDefinitely worth a read
p390
as(dp391
g18
V23354
p392
stp393
a((dp394
g2
(lp395
VSee also this discussion
p396
aVThe problem is exacibated because a lot of code (perhaps too much) runs at full trust
p397
aVAnd then the only checks that get done are things like PrincipalPermissionAttribute checks - most of the rest are simply bypassed
p398
aVSo in many cases there isn't much point
p399
aVUnless you are loading in external (untrusted) files [and so need CAS], it simply doesn't add a lot in many cases (and yes, there are plenty of exceptions)
p400
aVCAS is much more useful for clients running in the sandbox (for example downloaded from the internet)
p401
aVSliverlight takes this to the extreme, with stricter rules (especially around reflection) than regular
p402
aVNET
p403
as(dp404
g18
V23354
p405
stp406
a((dp407
g2
(lp408
VIf you are doing it a /lot/, you might want to have a single, static/shared empty delegate that you re-use, simply to reduce the volume of delegate instances
p409
aVNote that the compiler caches this delegate per event anyway (in a static field), so it is only one delegate instance per event definition, so it isn't a huge saving - but maybe worthwhile
p410
aVThe per-instance field in each class will still take the same space, of course
p411
aVi
p412
ag50
aVOther than that, it seems fine
p413
as(dp414
g18
V23354
p415
stp416
a((dp417
g2
(lp418
VAFAIK, you need to keep your own list - like you are already
p419
as(dp420
g18
V23354
p421
stp422
a((dp423
g2
(lp424
VI must admit I don't know the differences, but if you hit problems you could perhaps use WindowsFormsHost to host the winform version in WPF, like so
p425
aVUltimately, both is a wrapper around shdocvw, so principles like "pure WPF" don't really apply
p426
as(dp427
g18
V23354
p428
stp429
a((dp430
g2
(lp431
VThat only locks for the duration of the get/set; of course, in many common cases this will be atomic anyway, simply due to to data size
p432
aVHowever, in reality most locks need to span more than this, in the same way that collections locking over just the Add etc don't help much - a caller typically needs a single lock to span the "is it there
p433
aVif so update, else add" sequence
p434
aVFor something as simple as a bool, "volatile" might solve the problem a lot more simply - especially if it is just for a loop exit
p435
aVYou might also want to consider [MethodImpl(MethodImplOptions
p436
aVSynchronized)] - although personally I prefer a private lock object (like you have used) to prevent issues with external people locking on the object (the above uses "this" as the lock)
p437
aVFor unit testing this, you'd need something to prove it broken first - which would be hard since the operations are so small (and already atomic for most data types)
p438
aVOne of the other things it avoids (that volatile also fixes) is caching in a register, but again that is an optimisation and hard to force to prove it is broken
p439
aVIf you are interested in a lock-wrapper, you might consider existing code like this
p440
as(dp441
g18
V23354
p442
stp443
a((dp444
g2
(lp445
VYou will have to do the recursion manually; don't use AllDirectories - look one folder at a time, then try getting the files from sub-dirs
p446
aVUntested, but something like below (note uses a delegate rather than building an array):
p447
as(dp448
g18
V23354
p449
stp450
a((dp451
g2
(lp452
VUnfortunately, it is very hard to convince the compiler about specific T implementations
p453
aVOne (nasty) approach is to cast to object in the middle (note this will box and unbox value-types):
p454
aVUgly but it works
p455
aVIn
p456
aVNET 3
p457
aV5 I have some better wrappers for generic arithmetic, here
p458
aVThe Operator class is part of MiscUtil; at the simplest level, I suspect AddAlternative would work very well:
p459
aVThis should infer the implicit  automatically, or you can add them yourself:
p460
aVBenefit: This is preferable to the original code as it doesn't actually care about the original T - it will work for any type (even your own) that supports "T +(T,int)"
p461
aVI think there is also a ChangeType hiding around somewhere in there
p462
aV[edit] Collin K and others make a valid remark about the architectural implications - but being pragmatic there are times when the T really does matter that much
p463
aVbut I'd agree with avoiding this type of specialization unless really necessary
p464
aVThat said (as per  my comment on Collin's post), the ability to perform things like basic arithmetic (increment, Int32 division, etc) on (for example) a Matrix [for T in decimal/float/int/double/etc] is often highly valuable
p465
as(dp466
g18
V23354
p467
stp468
a((dp469
g2
(lp470
VReadonly properties are fine as long as you mark the (non-readonly) field as the [DataMember], not the property
p471
aVUnlike XmlSerializer, IIRC DataContractSerializer doesn't use the default ctor - it uses a separate reflection mechanism to create uninitialized instances
p472
aVExcept on mono's "Olive" (WCF port), where it does use the default ctor (at the moment, or at some point in the recent past)
p473
aVExample:
p474
as(dp475
g18
V23354
p476
stp477
a((dp478
g2
(lp479
V1: BitConverter (as sixlettervariables) is an option; as is unsafe code (which doesn't need an intermediate buffer):
p480
aV2: note that you should limit the size of structs
p481
aVI can't find a citation fr it, but the number "16 bytes" (max, as a recommendation) seems to stick in my mind
p482
aVAbove this, consider an immutable reference-type (class)
p483
as(dp484
g18
V23354
p485
stp486
a((dp487
g2
(lp488
VIt doesn't exist in a convenient form withing C# - see here for an idea based on F#'s pattern matching, that does exactly what you want
p489
aVYou can do some things with reflection to select the overload at runtime, but that will be very slow, and has severe issues if anything satisfies both overloads
p490
aVIf you had a return value you could use the conditional operator;
p491
aVAgain - not pretty
p492
as(dp493
g18
V23354
p494
stp495
a((dp496
g2
(lp497
VWell, I'm not familiar with it myself, but some quick searches show one on CodeProject, which links to 2 other such, here and here
p498
aVAny of those help
p499
as(dp500
g18
V23354
p501
stp502
a((dp503
g2
(lp504
VIIRC, this output is only shown in the output window when running an individual test
p505
aVTry right-clicking in the test method to run just that test
p506
as(dp507
g18
V23354
p508
stp509
a((dp510
g2
(lp511
VWell, you can use a "bool ShouldSerializeSomeDateTime()" method to enable/disable serialization of individual members, but I don't think that is quite what you need
p512
aVAnother common option is to add a member that does the format itself:
p513
aVpublic string SomeDateTimeFormatted {
p514
aVget { return theField == DateTime
p515
aVMinValue
p516
aV"" : theField
p517
aVToString("R");} // or whatever format
p518
aVset {
p519
aVopposite
p520
aV}
p521
ag521
aVIt is nicer to stick with the inbuilt serialization if you can, though - in part to reduce the amount of code you need to write
p522
aVJosh's suggestion for a nullable DateTime (DateTime
p523
aVis a good one, although it might still not be quite empty-string vs formatted-string - I expect it would use the xsi:nil markup
p524
as(dp525
g18
V23354
p526
stp527
a((dp528
g2
(lp529
VPersonally, I'd probably go with a SVN repo somewhere
p530
aVhowever, one other option: keep a VM on a portable HDD (USB etc) and treat your entire development OS as portable
p531
aVNote that a VM or a thumb drive don't replace version control; it isn't just about ensuring you have a copy of it
p532
aVSince you state you are new to programming in general, I'll volunteer a recommendation: grab VisualSVN Server and Tortoise SVN (a client); both are free and trivial to get working on Windows - very much "next next ok"
p533
aVOther version control systems are available, but these are simple to use
p534
as(dp535
g18
V23354
p536
stp537
a((dp538
g2
(lp539
VThe space-separated approach is fine if you are using Process
p540
aVStart - you just need to wrap items containing spaces with quotes - same as at the command line: cd "c:\u005cprogram files"
p541
aVIf the data is more complex than a few values, then IPC approaches such as remoting, sockets, WCF, etc might help
p542
aVOr simpler: write the data (perhaps as xml) to a file, and have the second app load the data from the file
p543
as(dp544
g18
V23354
p545
stp546
a((dp547
g2
(lp548
VIt is usually possible to force foreseen race-conditions and deadlocks by using things like ManualResetEvent to get each thread into the expected state before releasing it - i
p549
ag50
aVget thread A to have the lock and wait for a signal
p550
aVget thread B to request the lock, etc
p551
aVHowever - you might typically write such a test to investigate a suspected bug, to prove when it is fixed and that it doesn't re-surface
p552
aVYou would generally design around race conditions (but test them as best as is pragmatic)
p553
as(dp554
g18
V23354
p555
stp556
a((dp557
g2
(lp558
VThe best thing I can think would be: don't use a DateTime field; well, you could use a lot of DATEADD/DATEPART etc, but it will be slow if you have a lot of data, as it can't really use an index here
p559
aVYour DB may offer a suitable type natively - such as the TIME type in SQL Server 2008 - but you could just as easily store the time offset in minutes (for example)
p560
as(dp561
g18
V23354
p562
stp563
a((dp564
g2
(lp565
VThis is due to CAS; code started from the local machine has much more trust than code in the intranet, which in turn has more trust that code from the internet
p566
aVIIRC, with the latest SP (3
p567
aV5SP1
p568
aVif you have mapped the share (i
p569
ag50
aVas F:) it is trusted; otherwise you will need to either:
p570
aVa: apply a caspol change to all clients (yeuck)
p571
aVb: use ClickOnce to deploy the app, and run the
p572
aVapplication instead (yay
p573
aVThe point is that ClickOnce allows you to sign the app and state your security policy (even if you demand full trust)
p574
as(dp575
g18
V23354
p576
stp577
a((dp578
g2
(lp579
VIn json, the "c" in "c" : "One" is the property name
p580
aVAnd in the C# world, you can't create property names on the fly (ignoring System
p581
aVComponentModel)
p582
aVBasically, I don't think you can do what you want
p583
as(dp584
g18
V23354
p585
stp586
a((dp587
g2
(lp588
VWhen you say "push a new record to"
p589
aVdo you mean you want to add a record to the results
p590
aVOr do you mean you want to do an INSERT
p591
aVThe INSERT cannot be done with a reader; however, you can do things with readers
p592
aVOf course, it would be simpler to update the original query so that you UNION the data
p593
aVIn particular: you can't create your own SqlDataReader, but you can create your own bespoke IDataReader implementation; this could wrap the SqlDataReader, simply proxying data from the inner SqlDataReader until the SqlDataReader
p594
aVRead() method returns false - then you could swap to returning you own data, returning true until you have run out of data
p595
aVNot trivial to implement (mainly because you need to implement a lot of methods to write your own IDataReader), but certainly not impossible
p596
as(dp597
g18
V23354
p598
stp599
a((dp600
g2
(lp601
V[updated] AFAIK, there was no change here to the fundamental delegate handling; the difference is in how DataTable behaves
p602
aVHowever
p603
aVBe very careful using static events, especially if you are subscribing from instances (rather than static methods)
p604
aVThis is a good way to keep huge swathes of objects alive and not be garbage collected
p605
aVRunning the code via csc from 1
p606
aV1 shows that the general delegate side is the same - I think the difference is that the DataTable code that raises RowChanged was swallowing the exception
p607
aVFor example, make the code like below:
p608
aVYou'll see "Before", but no "After"; an exception was thrown and swallowed by the DataTable
p609
as(dp610
g18
V23354
p611
stp612
a((dp613
g2
(lp614
VThe ServicePointManager is for managed code; WebBrowser is a wrapper around shdocvw, so will almost certainly have a very different programming model
p615
aVif you can automate this (and I'm not sure that you can), I would expect to have to reference the COM version to get the full API (see: AxWebBrowser)
p616
aVWebBrowser only exposes a
p617
aVNET-friendly subset of the full functionality - enough to get most common jobs done
p618
aVOne other option might be to get the data yourself (WebClient / WebRequest / etc), and simply push that html into the WebBrowser - but this will mess up external links etc
p619
as(dp620
g18
V23354
p621
stp622
a((dp623
g2
(lp624
VNote that LINQ can do this via Contains (which maps to IN)
p625
aVWith regular TSQL, another option is to pass down the list as a CSV (etc) varchar, and use a table-valued UDF to split the varchar into pieces
p626
aVThis allows you to use a single TSQL query (doing an INNER JOIN to the UDF result)
p627
as(dp628
g18
V23354
p629
stp630
a((dp631
g2
(lp632
VIf you are doing an UPDATE, I would do it in 2 steps; first get rid of the space (RTRIM on a SUBSTRING), and second do the UPPER on the first 2 chars:
p633
aVIf you need it in a SELECT (i
p634
ag50
aVinline), then I'd be tempted to write a scalar UDF
p635
as(dp636
g18
V23354
p637
stp638
a((dp639
g2
(lp640
VMike Taulty has a series of blog entries here that would be worth reading
p641
aVBut first - make sure you really, really want the complexity of EF; NHibernate, LINQ-to-SQL, etc make better answers in many cases
p642
aVThere are a number of issues with the EF approach (not least the forced base class and the much moire complicated xml - barely comprehensible)
p643
aVI'm not saying don't use it: just make sure you need what it offers (at the price of complexity) first
p644
as(dp645
g18
V23354
p646
stp647
a((dp648
g2
(lp649
VCan you give more context as to when this happens, and with which serializer
p650
aVMost serializers have the ability to ignore certain members -  for ,  for , etc
p651
aVHaving a  instance in your class usually means that your class is acting as a property-bag; in which case you may need to do custom serialization (/)
p652
aVIf the field is there for some other reason, just mark it to be ignored
p653
aVThis (or similar symptoms) are also very common when you have an event (such as a change notification event / ) that the UI is hooked into (data binding); in this case, you need to mark the backing field as non-serialized
p654
aVI don't know about VB, but with C# you can do this with "field-like events" as so:
p655
as(dp656
g18
V23354
p657
stp658
a((dp659
g2
(lp660
VIt depends what you mean be serializable
p661
aVIf you mean the CLI marker (i
p662
ag50
aVthe [Serializable] attribute), then this is not inherited (proof below)
p663
aVYou must explicitly mark each derived class as [Serializable]
p664
aVIf, however, you mean the ISerializable interface, then yes: interface implementations are inherited, but you need to be careful - for example by using a virtual method so that derived classes can contribute their data to the serialization
p665
as(dp666
g18
V23354
p667
stp668
a((dp669
g2
(lp670
VFields are always initialized to their default value; 0/false/null - this this is the 0 character, \u005c0
p671
aVIf you want an empty string, use strings directly - i
p672
ag50
aV""
p673
aVYou could use a conditional operator:
p674
aVAlternatively, nullable types might help - i
p675
ag50
as(dp676
g18
V23354
p677
stp678
a((dp679
g2
(lp680
VMany of the ones already mentioned, plus
p681
aVSharpZipLib
p682
aVFast CSV reader
p683
as(dp684
g18
V23354
p685
stp686
a((dp687
g2
(lp688
VRe protobuf-net, there isn't a separate download for the CF version at the moment, but there is a csproj in the source for both CF 2
p689
aV0 and CF 3
p690
aV5
p691
aVTo clarify on your question; actually protobuf-net doesn't even use a
p692
aVproto file (at the moment); a
p693
aVproto file just describes what the data is - protobuf-net simply looks at your classes and infers the schema from that (similar to how XmlSerializer / DataContractSerializer etc work)
p694
aVSo there is not
p695
aVproto - just the classes that look like your data
p696
aVHowever, before you embark on creating classes that look like your data, I wonder if you couldn't simply use GZIP or [PK]ZIP to compress the data, and transfer it "as is"
p697
aVXml generally compresses very well
p698
aVOf course, finding a GZIP (etc) implementation for CF then becomes the issue
p699
aVOf course, if you want to use protobuf-net here, I'll happily advise etc if you get issues
p700
aVThe other option is for your CF app to call into a web-service that has the data locally
p701
as(dp702
g18
V23354
p703
stp704
a((dp705
g2
(lp706
VWhat version of the framework
p707
aVWith 3
p708
aV5 you could presumably use:
p709
aV(edited to remove simpler version; I checked and  only implements the non-generic  form)
p710
as(dp711
g18
V23354
p712
stp713
a((dp714
g2
(lp715
VDepending on the files, one option might be  - i
p716
ag50
aVThe problem is that this depends on the code having the  attribute, and it matching the  attribute
p717
aVI think I'd look at the AssemblyName options suggested by others first, though
p718
as(dp719
g18
V23354
p720
stp721
a((dp722
g2
(lp723
VIf you mean an in-place sort (i
p724
ag50
aVthe list is updated):
p725
aVIf you mean a new list:
p726
as(dp727
g18
V23354
p728
stp729
a((dp730
g2
(lp731
VI assume that since you are using ArrayList, you are using 1
p732
aV1
p733
aVIn which case, I suspect the following would work:
p734
aV(edit - Bill's ToArray usage is more convenient - I didn't know about that one, but then, I very rarely [if ever] use ArrayList)
p735
aVHowever, if MyStruct really is a struct, then I cannot say strongly enough that mutable structs are a bad idea - i
p736
ag50
aVwhere you can set
p737
aVName and
p738
aVContent after creation
p739
aVStructs should almost always be immutable
p740
aVIn reality, your MyStruct looks like it should be a class
p741
aVAlso - I'm not "up" on VB, but are they public fields
p742
aVAgain - not recommended - properties would be preferable
p743
aVI don't know about VB, but C# 3
p744
aV0 has some very terse syntax for this:
p745
aVIf you are using 2
p746
aV0 or above, consider List instead of ArrayList
p747
as(dp748
g18
V23354
p749
stp750
a((dp751
g2
(lp752
VSince the keys are your known fixed values, then either InvariantCultureIgnoreCase or OrdinalIgnoreCase should work
p753
aVAvoid the culture-specific one, or you could hit some of the more "fun" things like the "Turkish i" problem
p754
aVObviously, you'd use a cultured comparer if you were comparing cultured values
p755
aVbut it sounds like you aren't
p756
as(dp757
g18
V23354
p758
stp759
a((dp760
g2
(lp761
VOne option would be to inherit from a common base-Form that sets the Icon in the constructor (presumably from a resx)
p762
aVAnother option might be PostSharp - it seems like it should be possible to do this (set
p763
aVIcon) via AOP; not trivial, though
p764
aVFinally, you could use a simple utility method (perhaps an extension method) to do the same
p765
aVBest of all, with the first option, you could probably risk a Ctrl+H (replace all) from  or  to
p766
as(dp767
g18
V23354
p768
stp769
a((dp770
g2
(lp771
VNo, you don't need explicit transactions if using TransactionScope for your transactions - however: important you should probably set  in the connection string
p772
aVThe full details are here, but otherwise you can end up with the first few operations getting rolled back, and the last few committing (or rather, running outside of any transaction)
p773
as(dp774
g18
V23354
p775
stp776
a((dp777
g2
(lp778
VIt seems to me that you shouldn't be using temporary tables here
p779
aVthese seem more like regular tables (perhaps with a user identifier)
p780
aVWhat is the scenario here
p781
aVNote that using temporary tables in this way can play havoc with the optimiser/query cache - it will have to do lots of recompiles, as the meaning of #FOO changes pretty-much per call
p782
as(dp783
g18
V23354
p784
stp785
a((dp786
g2
(lp787
VIf you want speed, then LockBits
p788
aVSee here for a good walkthrough by Bob Powell
p789
aVIf you just want to edit a few, then GetPixel/SetPixel should do what you want
p790
as(dp791
g18
V23354
p792
stp793
a((dp794
g2
(lp795
VWhen accessed individually, I suspect that having a query that returns IQueryable would work - however, I expect that when this is part of a larger Expression, the expression interpreter will complain (which seems like what you are describing)
p796
aVHowever, I suspect that you might be able to break it down a bit
p797
aVTry adding (to customer):
p798
aVThen you should be able to use:
p799
aVObviously it is hard to run it (from here) to see what TSQL it comes up with, but I'd be surprised if that does roundtrips; I would expect that to do the COUNT() in the TSQL
p800
aVAs a topmost query, you should also be able to wrap this:
p801
aVDoes any of that work
p802
as(dp803
g18
V23354
p804
stp805
a((dp806
g2
(lp807
VIf you are having genuine issues with concurrent updates on the same data, then you might consider performing the entire operation in a transaction - i
p808
ag50
aVgetting the data and committing it
p809
aVAs long as you treat the get/update/commit as a short-lived, atomic operation (i
p810
ag50
aVyou don't pause for user-input in the middle) it should be OK
p811
aVIn particular, with a serializable isolation level, nobody can update data that you have a read lock on (i
p812
ag50
aVanything you have queried)
p813
aVThe only problem is that this might lead to deadlock scenarios if different queries are reading data in different orders
p814
aVAFAIK, there is no way to get LINQ-to-SQL to issue the (UPDLOCK) hint, which is a shame
p815
aVEither a TransactionScope or a SqlTransaction would do, as long as they are set as serializable isolation (which is the default for TransactionScope)
p816
as(dp817
g18
V23354
p818
stp819
a((dp820
g2
(lp821
VIn practice, yes - LINQ keywords map to extension methods
p822
aVBut actually, it is more interesting; it is literally as though the compiler substitutes directly for a few key methods, i
p823
ag50
aVbecomes:
p824
aV(if we had a non-trivial select, it would add
p825
aVSelect(
p826
aVsome projection
p827
aVDifferent LINQ kewords map to different methods - i
p828
ag50
aVthere is OrderBy, GroupBy, ThenBy, OrderByDescending, etc
p829
aVIn the case of /, this then resolves these via extension methods (typically courtesy of /)- however, if your queryable objects declared their own Where/OrderBy/etc then these would get used in preference
p830
aVJon Skeet covers this a lot more in the latter parts of C# in Depth
p831
aVI've also seen an example of Jon's where he discusses some really bizarre implications of this - such as calling static methods on a type
p832
as(dp833
g18
V23354
p834
stp835
a((dp836
g2
(lp837
VNo; an anonymous type can't be made to do anything except have a few properties
p838
aVYou will need to create your own type
p839
aVI didn't read the linked article in depth, but it looks like it uses Reflection
p840
aVEmit to create new types on the fly; but if you limit discussion to things within C# itself you can't do what you want
p841
as(dp842
g18
V23354
p843
stp844
a((dp845
g2
(lp846
VIt is matching the 4; you need ^ and $ to terminate the regex if you want a full match for the entire string - i
p847
ag50
as(dp848
g18
V23354
p849
stp850
a((dp851
g2
(lp852
VA slightly different use is to speed up reflection; i
p853
ag50
aVinstead of using reflection each time, you can use  to create a (typed) delegate to a method (a ), and call that delegate instead
p854
aVThis is then much quicker per call, as the checks have already been done
p855
aVWith , you can also do the same to create code on the fly - for example, you can easily create an  that represents the + operator for a type chosen at runtime (to provide operator support for generics, which the language doesn't provide); and you can compile an  to a typed delegate - job done
p856
as(dp857
g18
V23354
p858
stp859
a((dp860
g2
(lp861
VPersonally, I would store lookup data in a database, and simply try to avoid the type of hard coding that binds rules to things like individual states
p862
aVPerhaps some key property of those states (like
p863
aVApplyDoubleTax or something)
p864
aVAnd non-logic code doesn't need to use intellisense - it typically just needs to list them or find by name, which can be done easily enough however you have stored it
p865
aVEqually, I'd load the data once and cache it
p866
aVArguably, coding the logic against states is hard coding - especially if you want to go international anytime soon - I hate it when a site asks me what state I live in
p867
aVRe the data changing
p868
aVis the USA looking to annex anytime soon
p869
as(dp870
g18
V23354
p871
stp872
a((dp873
g2
(lp874
VYou might need to post some code; the following (with two lists tied together only by the CM) shows that it works fine
p875
aVso to find the bug we might need some code
p876
as(dp877
g18
V23354
p878
stp879
a((dp880
g2
(lp881
VWhat bindings are you using
p882
aVWCF will have some overheads, but if you use basic-http with MTOM you lose most of the base-64 overead
p883
aVYou'll still have the headers etc
p884
aVAnother option would be to (wait for it
p885
aVnot use WCF here - perhaps just a handler (ashx etc) that returns the binary
p886
aVRe compression - WCF itself won't have much hand in compression; the transport might, especially via IIS etc with gzip enabled - however, images are notorious for being hard to compress
p887
as(dp888
g18
V23354
p889
stp890
a((dp891
g2
(lp892
VA number of classes are unavailable as generic contraints - Enum being another
p893
aVFor delegates, the closest you can get is ": class", perhaps using reflection to check (for example, in the static constructor) that the T is a delegate:
p894
as(dp895
g18
V23354
p896
stp897
a((dp898
g2
(lp899
VPersonally I'd go for a simple solution like Jimmy's - however, if you want to do this (with regular win-form bindings), you'd need to use a custom type descriptor to flatten  /  as virtual properties of
p900
aVYou can do this via  or
p901
aVThe latter is more involved, but cleaner from a "separation of concerns" viewpoint
p902
aVIf you really want I can prepare an example (or there are many I've done in the past floating around) - but simple is beautiful: if you only have a few properties, a simple facade (i
p903
ag50
aVpass-thru properties on ) would be preferable
p904
as(dp905
g18
V23354
p906
stp907
a((dp908
g2
(lp909
VXmlSerializer uses xsi:nil - so I expect you'd need to do custom IXmlSerializable serialization for this
p910
aVSorry
p911
as(dp912
g18
V23354
p913
stp914
a((dp915
g2
(lp916
VI'd agree with most of Jon's post - a small note re the dictionary: from a performance perspective, you might want to benchmark this vs just a flat list
p917
aVLast time I did a benchmark (dictionary vs flat list, checking each item until match found), the dividing point (for read access) was around 150 items; below that, the list was quicker (just through simplicity)
p918
aVBut do your own tests
p919
aV(I don't have the numbers to hand to prove one way or another)
p920
aVDepending on the code, you might be able to use generics to further split the data - i
p921
ag50
aVa Cache so that all the info for type T is in one place, populated in the static ctor for Cache
p922
aVThis may or may not be possible, depending on the architecture
p923
aVFinally, it might or might not fit, but there are existing AOP frameworks like PostSharp that might help simplify the injection points
p924
aVRe the generic point - it would be fairly easy to (in your init code) create a typed delegate to a method on the Cache method, to reduce the amount of data it needs to scan through - just a bit of Type
p925
aVMakeGenericType and and Delegate
p926
aVCreateDelegate - after this point, the code just knows about your Func<
p927
aV> delegate, and doesn't need to care about the implementation
p928
as(dp929
g18
V23354
p930
stp931
a((dp932
g2
(lp933
VI think I showed you this one before, but I like the fun here - this took some debugging to track down
p934
aV(the original code was obviously more complex and subtle
p935
aVSo what was T
p936
aVAnswer: any  - such as
p937
aVAll the methods are overridden, except GetType() which can't be; so it is cast (boxed) to object (and hence to null) to call object
p938
aVGetType()
p939
aVwhich calls on null ;-p
p940
aVUpdate: the plot thickens
p941
aVAyende Rahien threw down a similar challenge on his blog, but with a :
p942
aVBut it can be defeated
p943
aVUsing the same indirection used by things like remoting; warning - the following is pure evil:
p944
aVWith this in place, the  call is redirected to the proxy (), which returns
p945
aVNow go and wash your eyes
p946
as(dp947
g18
V23354
p948
stp949
a((dp950
g2
(lp951
VAlternatively, you could create a named template,
p952
aVand then call as:
p953
aVBut to be honest, that looks like more work to me
p954
aVonly useful if drawing a header is complex
p955
aVfor a simple  I'd be tempted to leave it inline
p956
aVIf the header title is always the node name, you could simplifiy the template by removing the "$header" arg, and use instead:
p957
as(dp958
g18
V23354
p959
stp960
a((dp961
g2
(lp962
VXml errors usually only show if the file is open
p963
aVYou can normally disable it by not opening it into the xml editor; the errors don't normally stop a build - they just look like they do
p964
aVRight click -> Open With
p965
aVSource (Text) Editor  (or HTML if you prefer)
p966
aV(and set as default)
p967
as(dp968
g18
V23354
p969
stp970
a((dp971
g2
(lp972
VIf you mean in relation to SQL Server, then there is an issue that you can fix in the connection string; see my reply here, or the full details here
p973
aVThe short version is: ensure you have  in the connection string
p974
aVIt isn't actually doing a vote commit - the transaction (and any early operations) has rolled back, but any subsequent operations (still inside the ) can get performed in the nul-transaction, i
p975
ag50
aVauto-commit
p976
as(dp977
g18
V23354
p978
stp979
a((dp980
g2
(lp981
VI'm not sure it can be done
p982
aVI may be wrong, but I didn't think that would work
p983
aVApart from anything else, even if your user puts in their credentials to get the
p984
aVapplication, the runtime then does separate downloading, for which it needs anonymous access
p985
aVIf you want to protect the client so much, you may have to come up with a different way of deploying it
p986
as(dp987
g18
V23354
p988
stp989
a((dp990
g2
(lp991
VIt sounds like virtual mode would do the job
p992
aVHowever, almost all grid code is oriented around a list (not a matrix) - it is therefore likely that you will need to provide an entire row at a time
p993
aVI'm not sure that  would achieve a lot in this scenario; this is just a custom way to provide metadata - but ultimately, the overall list behavior is comparable to  with custom s
p994
as(dp995
g18
V23354
p996
stp997
a((dp998
g2
(lp999
VThe only way of calling such a method would be via reflection, However, it sounds like it might be possible to wrap that functionality in an interface and use an instance-based IoC / factory / etc pattern
p1000
as(dp1001
g18
V23354
p1002
stp1003
a((dp1004
g2
(lp1005
VCMS mentions an interesting approach, but in reality I would suggest you keep things simple and have different assemblies (projects) for the C# and F# code
p1006
aVThere are well documented communication points between C# and F# (such as here and here) - I'd recommend them instead
p1007
aVThe differences between C# and F# (especially with F# having a different runtime
p1008
aVare quite large
p1009
as(dp1010
g18
V23354
p1011
stp1012
a((dp1013
g2
(lp1014
VDo you want to call DoStuff with T = the type of each property
p1015
aVIn which case, "as is" you would need to use reflection and MakeGenericMethod - i
p1016
ag50
aVHowever, this isn't very pretty
p1017
aVIn reality I wonder if it wouldn't be better just to have:
p1018
aVWhat does the generics give you in this example
p1019
aVNote that value-types will still get boxed etc during the reflection call - and even then boxing isn't as bad as you might think
p1020
aVFinally, in many scenarios, TypeDescriptor
p1021
aVGetProperties() is more appropriate than Type
p1022
aVGetProperties() - allows for flexible object models etc
p1023
as(dp1024
g18
V23354
p1025
stp1026
a((dp1027
g2
(lp1028
V[updated]: I thought of the name ;-p RunSharp
p1029
aVI can't vouch for it, but it might be what you need
p1030
aVHowever; what do you need to generate
p1031
aVCodeDom is one option
p1032
aVFor creating methods, you might find that you can do a lot more than you expect with the Expression class in
p1033
aVNET 3
p1034
aV5 (after compiling it to a typed delegate via Expression
p1035
aVLambda/Compile
p1036
as(dp1037
g18
V23354
p1038
stp1039
a((dp1040
g2
(lp1041
VAs an aside, note that MiscUtil also includes a  class, that is similar; it implements the regular  interface, but is fully mutable - so you can create it and add your own values
p1042
as(dp1043
g18
V23354
p1044
stp1045
a((dp1046
g2
(lp1047
VList or Collection are fine in this case
p1048
aVIn terms of the original question, you can wrap a List in a Collection very simply:
p1049
aVThis is a true wrapper; add an item to the wrapper (col), and it gets added to the list
p1050
aVThis can be slightly confusing, because many such constructors use the argument to do the initial population, but don't link to the original list
p1051
aVCollection is an exception ;-p
p1052
aVSince you are on a web-service boundary, that recommendation from FxCop doesn't apply
p1053
aVThat is useful (inline with Eric Lippert's recent blog) to prevent a caller stomping over the callee's memory - but in a web-service distributed scenario that simply doesn't apply
p1054
aVIn fact, since web-services have a few well documented issues with certain generic scenarios, a simple array is arguably very usable and pragmatic at a web-service boundary
p1055
aVIn the context of Eric's blog - in this case, there is no question of the caller/callee issue, since there is an enforced barrier between the two
p1056
aVIn terms of WSDL/mex, I suspect all 3 (list/collection/array) will just become a block of elements - so you may a well go with whichever is most convenient
p1057
as(dp1058
g18
V23354
p1059
stp1060
a((dp1061
g2
(lp1062
VBasically, you'd either need to create your own editor, or subclass  and mess with the form
p1063
aVThe latter is easier - but not necessarily pretty
p1064
aVThe following uses the regular collection editor form, but simply scans it for  controls, enabling
p1065
aVTo show this in use (note the use of ):
p1066
as(dp1067
g18
V23354
p1068
stp1069
a((dp1070
g2
(lp1071
VRe the "future" - FP is just another tool in the box; sometimes an FP solution is very helpful, and sometimes it isn't so much
p1072
aVBut remember that C# gets increasingly good at the functional side each iteration [although it is unlikely to ever offer some of the very specific FP aspects of F#, such as discriminated unions etc]
p1073
aVLikewise, easier immutability has been discussed by the C# team, so lets keep our fingers crossed for a future C# version
p1074
aVAnd also bear in mind that the parallel extensions / parallel LINQ bring many of the FP "killer features" directly into every
p1075
aVNET language
p1076
aVPersonally, I very much doubt that it [F#] is going to balloon and that we're all going to suddenly switch to F#; for most business-centric goals, C# still makes a lot more sense IMO, aspecially if designed for testability (you can write bad code in any language
p1077
aVBut if you're in one of those areas in which FP makes sense, and you're using
p1078
aVNET, then F# is definitely worth investigation
p1079
as(dp1080
g18
V23354
p1081
stp1082
a((dp1083
g2
(lp1084
VSince you are doing UI binding via event subscription, you might find this helpful; it is an example I wrote a while ago that shows how to subclass  so that the notifications are marshalled to the UI thread automatically
p1085
aVIf there is no sync-context (i
p1086
ag50
aVconsole mode), then it reverts back to the simple direct invoke, so there is no overhead
p1087
aVWhen running in UI thread, note that this essentially uses , which itself just runs the delegate directly if it is on the UI thread
p1088
aVSo there is only any switch if the data is being edited from a non-UI thread - juts what we want ;-p
p1089
as(dp1090
g18
V23354
p1091
stp1092
a((dp1093
g2
(lp1094
VIs the data proper xml, or does it just look like it
p1095
aVIf it is html, then the HTML Agility Pack is worth investigation - this provides a DOM (similar to XmlDocument) that you can use to query the data:
p1096
aVThis outputs:
p1097
aVIf you want the formatting tags, then use
p1098
aVInnerHtml instead of
p1099
aVInnerText
p1100
aVIf it is xml, then to code with the full spectrum of xml, it would be better to use an xml parser
p1101
aVFor small-to-mid size xml, loading it into a DOM such as XmlDocument would be fine - then query the nodes (for example, "//*")
p1102
aVFor huge xml, XmlReader might be an option
p1103
aVIf the data doesn't have to worry about the full xml, then some simple regex shouldn't be too tricky
p1104
aVa simplified example (no attributes, no namespaces, no nested xml) might be:
p1105
as(dp1106
g18
V23354
p1107
stp1108
a((dp1109
g2
(lp1110
VIf you want your data-context to barf at inserts, you can do:
p1111
aVAny good
p1112
aV[was:
p1113
aVCould you simply add it as "clean" - i
p1114
ag50
aVAttach(obj, false);
p1115
aVIf you don't want the object in the model, why add it to the data context
p1116
as(dp1117
g18
V23354
p1118
stp1119
a((dp1120
g2
(lp1121
VBy default (with auto column generation enabled), it will simply obtain (via ComponentModel) the  properties, (or those that omit this attribute)
p1122
aVIf this is the only use of binding for this data, you could add  to the properties you don't want to show
p1123
aVNote that this will also prevent regular data-binding (i
p1124
ag50
aV, , etc) to those properties
p1125
aVIn reality, I expect it would be better to create your own attribute, and use that to find the properties you want to display via reflection (and build the columns yourself)
p1126
as(dp1127
g18
V23354
p1128
stp1129
a((dp1130
g2
(lp1131
VYou need to provide an implicit conversion operator from int to Unit, like so:
p1132
as(dp1133
g18
V23354
p1134
stp1135
a((dp1136
g2
(lp1137
VPersonally, if I regularly expect to do fairly large inserts (10,000 rows would definitely qualify
p1138
aV, I might consider having a separate table for incoming data, and use  to populate this table
p1139
aVThen you just execute a single stored procedure that moves the data over into the real table
p1140
aVAnother approach is to send down xml to the database, and use sqlxml to parse that (much easier with SQL2005 and above) - but this puts extra work on the db server
p1141
as(dp1142
g18
V23354
p1143
stp1144
a((dp1145
g2
(lp1146
VHow about The Art of Unit Testing
p1147
aVThis is
p1148
aVNET specific, and should be fairly up to date
p1149
as(dp1150
g18
V23354
p1151
stp1152
a((dp1153
g2
(lp1154
VC# (at the moment) has very little [co|contra]variance support; as such, the interface implementation must be an exact match, including the return type
p1155
aVTo keep your concreate type on the class API, I would implement the interface explicitly - i
p1156
ag50
aVadd:
p1157
aVAlternatively, simply change the type of the property to  - this may (or may not) give what you need
p1158
as(dp1159
g18
V23354
p1160
stp1161
a((dp1162
g2
(lp1163
VFor info, another related-but-not-quite-the-same thing in
p1164
aVNET is , which lets an assembly designate another assembly (such as a unit test assembly) that (effectively) has "internal" access to types/members in the original assembly
p1165
as(dp1166
g18
V23354
p1167
stp1168
a((dp1169
g2
(lp1170
VWhat serializer are you using
p1171
aVIn many ways, a serializer like XmlSerializer or DataContractSerializer buffers you from many details, and provides simpler extensibility options
p1172
aVAt some point, a new CLR version will undoubtably be necessary - so I don't think anybody can make any guarantees about 2
p1173
ag190
aV50727; you should be safe short-term, though
p1174
aVAnd I would hope for fewer breaking changes
p1175
aV[updated following note on another reply]
p1176
aVIf you want a binary format for space/performance reasons, then another option is to use a  different binary serializer
p1177
aVFor example, protobuf-net works on all
p1178
aVNET variants*, but the binary format (dvised by Google) is cross-platform compatible (Java, C++, etc) - making it very portable, quick, and small
p1179
aV*=I haven't tried it on micro framework, but CF, Silverlight, Mono,
p1180
aVNET 2
p1181
aV0 etc are all supported
p1182
as(dp1183
g18
V23354
p1184
stp1185
a((dp1186
g2
(lp1187
VFor info, you might consider using a "table variable" rather than a temporary table (i
p1188
ag50
aV@FOO rather than #FOO) - this might help a little, and it certainly helps a few tempdb issues
p1189
aVWith temporary tables - no there is no way of explicitly declaring the SPs schema
p1190
aVI would perhaps suggest using a simplified version of the SP while you generate your wrapper classes - i
p1191
ag50
aVhave it do a trivial SELECT of the correct shape
p1192
aVAlternatively, I would use LINQ to consume a UDF, which does have explicit schema
p1193
as(dp1194
g18
V23354
p1195
stp1196
a((dp1197
g2
(lp1198
VIf you are working on an array, it sounds like you are using LINQ-to-Objects, not SQL;  can you confirm
p1199
aVMost LINQ operations don't re-order anything (the output will be in the same order as the input) - so don't apply another sort (OrderBy[Descending]/ThenBy[Descending])
p1200
aV[edit: as Jon put more clearly; LINQ generally creates a new sequence, leaving the original data alone]
p1201
aVNote that pushing the data into a  (ToDictionary) will scramble the data, as dictionary does not respect any particular sort order
p1202
aVBut most common things (Select, Where, Skip, Take) should be fine
p1203
as(dp1204
g18
V23354
p1205
stp1206
a((dp1207
g2
(lp1208
VPutting the data into a database will take time - since you already have it in memory, perhaps LINQ-to-Objects (with DataSetExtensions) is your friend
p1209
aVReplace  etc with the correct types
p1210
as(dp1211
g18
V23354
p1212
stp1213
a((dp1214
g2
(lp1215
VWhat version of
p1216
aVNET are you targetting
p1217
aVThe ExtensionAttribute class is shipped in System
p1218
aVCore
p1219
aVdll (
p1220
aVNET 3
p1221
aV5), but you can re-declare it yourself if you want to use extension methods in
p1222
aVNET 2
p1223
aV0/3
p1224
aV0 (with C# 3
p1225
aV0, obviously)
p1226
aVIn fact, LINQBridge does this
p1227
aV[update] However, I'm slightly confused, because the error you should see is:
p1228
aVError 1	Cannot define a new extension
p1229
aVmethod because the compiler required
p1230
aVtype
p1231
aV'System
p1232
aVRuntime
p1233
aVCompilerServices
p1234
aVExtensionAttribute'
p1235
aVcannot be found
p1236
aVAre you missing a
p1237
aVreference to
p1238
aVSystem
p1239
aVCore
p1240
aVdll
p1241
aV[snipped some path stuff]
p1242
as(dp1243
g18
V23354
p1244
stp1245
a((dp1246
g2
(lp1247
VThe second example is making the field public, not a property (your question)
p1248
aVThis provides a simple way of making simple properties
p1249
aVProperties should be your default, not public fields; the list of reasons is endless, but starts with:
p1250
aVencapsulation
p1251
aVability to add notification
p1252
aVencapsulation
p1253
aVability to do validation
p1254
aVencapsulation
p1255
aVdata binding
p1256
aVencapsulation
p1257
aVsecurity checking
p1258
aVoh - and did I mention encapsulation
p1259
aVChanging from a field to a property after-the-fact is a breaking change - especially if you use a lot of "ref" code or mutable structs (yeuch)
p1260
as(dp1261
g18
V23354
p1262
stp1263
a((dp1264
g2
(lp1265
VAlthough  can be cast to , it doesn't mean that  can be cast to
p1266
aVA simple option would be to create a new  array and copy the data over - or in your case, simply start the original array as
p1267
aVActually, I'd be tempted to use the generic  or  interfaces, or the  delegate - all using generics - this also allows use of  and non-default comparers
p1268
as(dp1269
g18
V23354
p1270
stp1271
a((dp1272
g2
(lp1273
VMy first guess would be that you have re-declared the IPluginInfo interface
p1274
aVAll
p1275
aVNET types are scoped by their assembly; if you have the same class file in 2 assemblies, you have 2 different interfaces that happen to have the same name
p1276
as(dp1277
g18
V23354
p1278
stp1279
a((dp1280
g2
(lp1281
VI might look at ADO
p1282
aVNET Data Services, aka Astoria, in VS2008 SP1
p1283
aVThis allows you to expose data over a web-service (WCF exposing ATOM, IIRC) - but you don't need to know all these details: the tooling worries about that for you: you just get regular IQueryable sources on a data-context (not quite the same as the LINQ-to-SQL data-context, but same concept)
p1284
aVThe good thing here is that a LINQ query (such as filtering (Where), paging (Skip/Take) etc) can get composed all the way from the client, through the web-service, and down to the LINQ-enabled data store (LINQ-to-SQL or Entity Framework, etc)
p1285
aVSo only the right data comes over the wire: if you ask for the first 10 rows (of 20000) ordered by Name, then that is what you get: 10 rows out of the database; 10 rows over the wire, no messing
p1286
as(dp1287
g18
V23354
p1288
stp1289
a((dp1290
g2
(lp1291
VYou will need to use  with  enabled - then you can read the output stream
p1292
aVYou might find it easier to use ">" to redirect the output to a file (via the OS), and then simply read the file
p1293
aV[edit: like what Ray did: +1]
p1294
as(dp1295
g18
V23354
p1296
stp1297
a((dp1298
g2
(lp1299
VFirst, convenience: lambdas are easier to read and write
p1300
aVSecond, expressions: lambdas can be compiled to either a delegate, or an expression tree ( for some delegate-type T, such as )
p1301
aVExpression trees are the more exciting, as it is the key to LINQ to out-of-process data stores
p1302
aVNote that lambda expressions with statement bodies can only be compiled to delegates, not s:
p1303
as(dp1304
g18
V23354
p1305
stp1306
a((dp1307
g2
(lp1308
VTo give a slightly different answer
p1309
aVwhile the values are type-safe from the casting perspective, they are still unchecked once they have been cast - i
p1310
ag50
aVFor this reason, you should take care to check the values - for example with a  in a  that throws an exception
p1311
aVYou can also check the (for non- values) via:
p1312
as(dp1313
g18
V23354
p1314
stp1315
a((dp1316
g2
(lp1317
VWith C# 3
p1318
aV0 and System
p1319
aVData
p1320
aVDataSetExtensions
p1321
aVdll,
p1322
as(dp1323
g18
V23354
p1324
stp1325
a((dp1326
g2
(lp1327
VThere is a pattern (for XmlSerializer), that a property Foo will also look for either "bool FooSpecified", or "bool ShouldSerializeFoo()" - and if found, only serialize Foo if this other member returns true
p1328
aVSo I assume that agencyIdSpecified had never been set to true
p1329
aVRemoving this member would make it always serialize (unless you add a  or similar)
p1330
aVThis type of behaviour is used to model optional values on the occasion that we really need to know whether it was in the original data - i
p1331
ag50
aVdoes it have the value 0 because the caller told us that number, or because that is simply the default
p1332
aVNote that the "FooSpecified" member commonly has  so that XmlSerializer knows that it shouldn't be considered as data for serialization
p1333
aVThis isn't necessary (or legal, in fact) with "ShouldSerializeFoo()", since methods are never serialized
p1334
as(dp1335
g18
V23354
p1336
stp1337
a((dp1338
g2
(lp1339
VPeople have already covered the UI aspect - attributes have other uses, though
p1340
aVfor example, they are used extensively in most serialization frameworks
p1341
aVSome attributes are given special treatment by the compiler - for example,  adds declarative security to a method, allowing you to (automatically) check that the user has suitable access
p1342
aVTo add your own special handling, you can use PostSharp; there are many great examples of using PostSharp to do AOP things, like logging - or just code simplification, such as with automatic  implementation
p1343
as(dp1344
g18
V23354
p1345
stp1346
a((dp1347
g2
(lp1348
VJust a few
p1349
aVsynchronization, inlining, etc:
p1350
aVcomponent model:
p1351
aVserialization:
p1352
aVdeclarative security:
p1353
aVall the COM stuff
p1354
as(dp1355
g18
V23354
p1356
stp1357
a((dp1358
g2
(lp1359
VFirst - you'd need a typed object
p1360
aVThis will obviously be easier if your gridview is already data-bound
p1361
aVYou can use InsertOnSubmit (new record) or Attach (update existing) to associate a record with a data-context
p1362
aVAlternatively, bind to object you got from the data-context in the first place
p1363
aVOne simple way of doing that is via GetNewBindingList (how well this works depends on the scenario)
p1364
aVIf that doesn't help, perhaps explain more about your scenario
p1365
as(dp1366
g18
V23354
p1367
stp1368
a((dp1369
g2
(lp1370
VYes; we do this
p1371
aVIt works very well
p1372
aVMaking changes to the virtual machines is identical to making changes to physical machines; that is one of the biggest advantages of virtualization
p1373
aVIn fact, most apps don't even notice that the machine is virtualized (although I suspect that behemoths like SQL Server might have some subtle internal detection / compensation code)
p1374
aVIf the servers are only hosting SQL server, another alternative is named instances - i
p1375
ag50
aVyou have yourserver\u005cdev and yourserver\u005ctest, which are separate SQL Server instances on the same OS; this reduces isolation and changes your process slightly, but means you don't have to load 3 operating systems (1 host, 2 guest) into memory
p1376
aVYou'll still have 2 complete SQL Server instances in memory, of course
p1377
aVThe other downside is that you can't try a host OS upgrade on "dev" without also impacting "test"
p1378
aVObviously if other custom software runs on the machine, you might want to go for isolated virtuals instead
p1379
aVMost virtualization tools offer a P2V tool; there are usually some limitations about the original and host hardware, however
p1380
aVIf the server is just a SQL Server, you might want to start clean instead
p1381
as(dp1382
g18
V23354
p1383
stp1384
a((dp1385
g2
(lp1386
VOK; how is myGuidColumn defined, and how is myGuid defined
p1387
aVIf myGuid is  and myGuidColumn is , then the error is correct: you will need to use , or  to get the value (which will throw if it is null), or perhaps  to return the zero guid if null
p1388
aVIf myGuid is  and myGuidColumn is , then it should work
p1389
aVIf myGuidColumn is , you probably need  instead of the regular null
p1390
aVOf course, if the column is truly nullable, you might simply want to ensure that it is  in the C# code ;-p
p1391
as(dp1392
g18
V23354
p1393
stp1394
a((dp1395
g2
(lp1396
VIt seems very odd to return a different object each time
p1397
aVactually, I very rarely (if ever) use the SyncRoot approach, as often I need to synchronize between multiple objects etc, so a separate object is more meaningful
p1398
aVBut if the data is truly immutable (readonly), why not just return false from IsSynchronized
p1399
aVRe GC - any such object would typically be short lived and be collected in GEN0
p1400
aVIf you have a field with an object (for the lock), it would last as long as the collection, but most likely won't hurt anyway
p1401
aVIf you need a lock, I'd be tempted to just have a:
p1402
aVYou could also use a lazy approach to only "new" it when needed, which makes a certain amount of sense if you don't actually expect anyone to ask for the sync-lock (by returns false to IsSynchronized)
p1403
aVAnother common approach is to return "this"; it keeps things simple, but risks conflicts with some other code using your object as a lock for an unrelated purpose
p1404
aVRare, but possible
p1405
aVThis is actually the approach that  uses to synchronize
p1406
as(dp1407
g18
V23354
p1408
stp1409
a((dp1410
g2
(lp1411
VYes; every web-service proxy offers a way to do this; with pre-WCF proxies (including WSEx) the address is the  property on the proxy class - just change it before you do anything interesting with the proxy
p1412
aVWith WCF, I believe you specify the endpoint-address via one of the constructors
p1413
aVSo just generate your proxy from your reference wsdl, and off you go ;-p
p1414
as(dp1415
g18
V23354
p1416
stp1417
a((dp1418
g2
(lp1419
Vxsd defines the data structure, not really the access approach
p1420
aVI don't think you can express "this is a lookup" in xsd : everything is either values or set of values/entities
p1421
aVIf you want specific handling, you might consider custom serialization - or alternatively consider your DTOs and your working classes as separate things, and simply translate between the two
p1422
aV[edit] As leppie notes - you can write your own indexer (typically in a partial class if generating cs from the xsd) that loops over the list to find the item: this will give you the caller usage, but not really the full dictionary experience (uniqueness, O(1) retrieval, etc)
p1423
as(dp1424
g18
V23354
p1425
stp1426
a((dp1427
g2
(lp1428
VI must admit that I find the current version of Sandcastle a bit lacking; for large projects it is quite slow, and it isn't easy to integrate (since it is still early)
p1429
aVFor regular use, I actually find it easier just to point reflector at a folder with the dll and xml files - IIRC, it will load the xml file(s) as you navigate around
p1430
aVPlus I almost always have reflector open anyway
p1431
aV[edit] checked, and yes - xml comments show in the disassembler panel
p1432
as(dp1433
g18
V23354
p1434
stp1435
a((dp1436
g2
(lp1437
VI'm using SharpSVN at the moment - works fine for what I need (although it is for an automated process, so no UI work necessary)
p1438
as(dp1439
g18
V23354
p1440
stp1441
a((dp1442
g2
(lp1443
VCurious - it should work IIRC; I'll see if I can do a quick example - however, you might want to check that you have the fully-qualified enum name (i
p1444
ag50
aVincluding the namespace)
p1445
aV[update] From here it seems that the RTM version shipped with a bug when resolving the enum
p1446
aVOne workaround suggested (on that page) was to add the  prefix
p1447
aVIt works fine for me without this workaround, so maybe it is fixed in 3
p1448
aV5 SP1
p1449
aVIt also allegedly works fine in 3
p1450
aV5 if you use the unqualified name if the enum is in the same namespace
p1451
aV[example] Yup, worked fine: with Northwind, I defined an enum for the shipping country:
p1452
aVI then edited the dbml to have:
p1453
aVThis generated:
p1454
aVAnd finally wrote a query:
p1455
aVWorked fine; results:
p1456
as(dp1457
g18
V23354
p1458
stp1459
a((dp1460
g2
(lp1461
VA nasty scenario
p1462
aVI hate to suggest it, but maybe reflector is your friend if it isn't obfuscated
p1463
aVThere may be some IP issues, but in this case reversing it seems the only viable way of finding out what the API is
p1464
aVHowever, I suspect (from methods like
p1465
aVGetErrorCode()) that this is a shim on top of P/Invoke - in which case even reflector will just show you lots of external calls
p1466
aVThe main other thing I can say is: write lots of unit tests that cover how you are trying to use it
p1467
aVthat way if you guess wrong and something changes, you'll know early
p1468
as(dp1469
g18
V23354
p1470
stp1471
a((dp1472
g2
(lp1473
VBasically, no
p1474
aVThere are a few, limited, uses of array covariance, but it is better to simply know which type of array you want
p1475
aVThere is a generic Array
p1476
aVConvertAll that is easy enough (at least, it is easier with C# 3
p1477
aV0):
p1478
aVThe C# 2
p1479
aV0 version (identical in meaning) is much less eyeball-friendly:
p1480
aVOr just create a new Property[] of the right size and copy manually (or via )
p1481
aVAs an example of the things you can do with array covariance:
p1482
aVHere, "asObj" is still a  - it it simply accessible as
p1483
aVIn C# 2
p1484
aV0 and above, generics usually make a better option than array covariance
p1485
as(dp1486
g18
V23354
p1487
stp1488
a((dp1489
g2
(lp1490
VYou can attach
p1491
aVNET Reflector to Visual Studio by simply using "Open with" on the DLL/EXE in the  folder, and choosing Reflector (and set as default)
p1492
aVAlso, many tools (such as TestDriven
p1493
aVNET if I recall, and possibly ReSharper) provide a level of
p1494
aVNET Reflector integration
p1495
as(dp1496
g18
V23354
p1497
stp1498
a((dp1499
g2
(lp1500
VHow about:
p1501
as(dp1502
g18
V23354
p1503
stp1504
a((dp1505
g2
(lp1506
VFor a slightly different answer: LINQ
p1507
aVExtension methods are obtained only via "using" statements
p1508
aVSo either the query syntax or the fluent interface will only work with the right "using" statements
p1509
aVEven without LINQ, I'd say use "using"
p1510
aVreasoning that the more you can understand in fewer characters, the better
p1511
aVSome namespaces are very deep, but add no value to your code
p1512
aVThere are other extension methods too (not just LINQ) that would suffer the same; sure, you can use the static class, but the fluent interface is more expressive
p1513
as(dp1514
g18
V23354
p1515
stp1516
a((dp1517
g2
(lp1518
VNET code is JITted on a method-by-method basis
p1519
aVDoes your "Main" method make reference to the external libraries
p1520
aVIf so, consider:
p1521
aVI can't guarantee it will work, but it is worth a try
p1522
as(dp1523
g18
V23354
p1524
stp1525
a((dp1526
g2
(lp1527
VFor LINQ-to-SQL, the data-context already does a lot of the mapping for you
p1528
aVAs such, I think generics might be the best way to achieve a save while still having some consideration of your interface (although I'm not quite sure what the interface is giving you in this scenario
p1529
aVYou can access the generic aspect of the data-context via :
p1530
aVNote that type-inference should mean that you don't need to specify the  when saving:
p1531
aVIs that any use
p1532
as(dp1533
g18
V23354
p1534
stp1535
a((dp1536
g2
(lp1537
VIs the type converter in the same dll as the enum
p1538
aVTypeDescriptor must be able to resolve the type-converters, UI-type-editors, etc - otherwise it uses the simple defaults
p1539
aVI haven't tried anything sepcifically with Excel, but I'm wondering if it isn't as simple as assembly resolution
p1540
aVIf it helps, you can use the  event to customize assembly loading - but this is a complex area
p1541
aVI'd avoid it unless absolutely necessary
p1542
as(dp1543
g18
V23354
p1544
stp1545
a((dp1546
g2
(lp1547
VWell, the first bit maps quite neatly to a LINQ query
p1548
aVbut there is (deliberately) no ForEach in regular LINQ
p1549
aVWe can annoy Eric and add one, though ;-p
p1550
aVSo the following uses LINQ and a custom extension method - but we could re-write the exact same code (i
p1551
ag50
aVthe same IL) as:
p1552
aVquery syntax (as below)
p1553
aVfluent syntax (
p1554
aVWhere()
p1555
aVSelect() ec)
p1556
aVexplicit static (Enumerable
p1557
aVWhere(
p1558
aVlambdas vs anonymous methods vs named methods (last changes the IL)
p1559
aVdelegates with/without the abbreviated (C# 2
p1560
aV0) delegate "new" syntax
p1561
aVgeneric calls with/without generic type inference (Where() vs Where())
p1562
aVcall to File
p1563
aVDelete vs call to x=>File
p1564
aVDelete(x) etc
p1565
aVetc
p1566
aVWe could write the  code with a custom , but that would be overkill
p1567
aVHowever, I doubt we could ever run out of ways of writing it ;-p
p1568
as(dp1569
g18
V23354
p1570
stp1571
a((dp1572
g2
(lp1573
VWell, xsd
p1574
aVexe should be able to get you an xsd
p1575
aVFor the dtd side, xmlpad3 claims to be able to do this (and is free)
p1576
aVI haven't tried, so I can't vouch for it
p1577
as(dp1578
g18
V23354
p1579
stp1580
a((dp1581
g2
(lp1582
VILOG Diagrammer offers network charting; actually, I haven't tried their Vis product, but am a happy user of their Gantt product which works very well
p1583
as(dp1584
g18
V23354
p1585
stp1586
a((dp1587
g2
(lp1588
VTry adding an (empty) static constructor, or initialize the singleton in a static constructor
p1589
aVJon Skeet has a full discussion of singleton patterns here
p1590
aVI'm not sure why it failed, but at a guess it could relate to the "beforefieldinit" flag
p1591
aVSee his 4th example, where he adds a static constructor to tweak this flag
p1592
aVI don't claim to be an expert on beforefieldinit, but this symptom seems to fit some of the symptoms discussed here
p1593
as(dp1594
g18
V23354
p1595
stp1596
a((dp1597
g2
(lp1598
VNot in full; however, the Dynamic LINQ sample may help a bit
p1599
aVYou can certainly serialize an expression to a string (to an extent - generics look a bit screwy), but there is no inbuilt parser
p1600
as(dp1601
g18
V23354
p1602
stp1603
a((dp1604
g2
(lp1605
VRe little-endian, the short answer (to do I need to do anything) is "probably not, but it depends on your hardware"
p1606
aVYou can check with:
p1607
aVDepending on what this says, you might want to reverse portions of your buffers
p1608
aVAlternatively, Jon Skeet has specific-endian converters here (look for EndianBitConverter)
p1609
aVNote that itaniums (for example) are big-endian
p1610
aVMost Intels are little-endian
p1611
aVRe the specific UDP/IP
p1612
as(dp1613
g18
V23354
p1614
stp1615
a((dp1616
g2
(lp1617
VYou can have overloaded methods though
p1618
aVFor example, if it was Substitute()
p1619
aVYou can't normally have both static and instance versions of a method, but extension methods might be of some use
p1620
aVbut if the two versions of Substitute have different meanings, it would be cleaner to simply have different types being returned, so that the two variants  of Substitute() can't conflict
p1621
as(dp1622
g18
V23354
p1623
stp1624
a((dp1625
g2
(lp1626
VMainly as leppie says
p1627
aVIf you want to test it for a few known types, you can use "is"/"as":
p1628
aVBut in general, you would let the serializer worry about such details
p1629
aVIt is very different with xml-based serializers, of course, since you need to tell the serializer what is expected, rather than the serializer telling you what it got
p1630
as(dp1631
g18
V23354
p1632
stp1633
a((dp1634
g2
(lp1635
VDavid Mohundro shows one approach; one other option is to inherit from Collection and override the various methods:
p1636
aVFinally, you could create your own list (IList, IList) from first principles - lots of work, little benefit
p1637
as(dp1638
g18
V23354
p1639
stp1640
a((dp1641
g2
(lp1642
VI sometimes use (in Load)
p1643
aVor
p1644
aV(change "this" to your form variable if you are handling the event on an instance other than "this")
p1645
aVThis pushes the invoke onto the windows-forms loop, so it gets processed when the form is processing the message queue
p1646
aV[updated on request]
p1647
aVThe Control
p1648
aVInvoke/Control
p1649
aVBeginInvoke methods are intended for use with threading, and are a mechanism to push work onto the UI thread
p1650
aVNormally this is used by worker threads etc
p1651
aVControl
p1652
aVInvoke does a synchronous call, where-as Control
p1653
aVBeginInvoke does an asynchronous call
p1654
aVNormally, these would be used as:
p1655
aVIt does this by pushing a message onto the windows message queue; the UI thread (at some point) de-queues the message, processes the delegate, and signals the worker that it completed
p1656
aVso far so good ;-p
p1657
aVOK; so what happens if we use Control
p1658
aVInvoke / Control
p1659
aVBeginInvoke on the UI thread
p1660
aVIt copes
p1661
aVif you call Control
p1662
aVInvoke, it is sensible enough to know that blocking on the message queue would cause an immediate deadlock - so if you are already on the UI thread it simply runs the code immediately
p1663
aVso that doesn't help us
p1664
aVBut Control
p1665
aVBeginInvoke works differently: it always pushes work onto the queue, even it we are already on the UI thread
p1666
aVThis makes a really simply way of saying "in a moment", but without the inconvenience of timers etc (which would still have to do the same thing anyway
p1667
as(dp1668
g18
V23354
p1669
stp1670
a((dp1671
g2
(lp1672
VDo you mean Convert
p1673
aVToDateTime
p1674
aVThis returns DateTime (not bool)
p1675
aVDo you mean DateTime
p1676
aVTryParse
p1677
aVSimply use any of:
p1678
aVThen use "when" in the query
p1679
aVI'm not sure the purpose of ordering by it if you know they are all equal, though
p1680
aVdid I miss something
p1681
aVIf the issue is that you want only the time part (not the date part), could you clarify that
p1682
as(dp1683
g18
V23354
p1684
stp1685
a((dp1686
g2
(lp1687
VI'm not sure that is surprising
p1688
aVcompare to the same for properties vs fields (since properties before the same function as events: encapsulation via accessors):
p1689
aVAlso - events do not mention anything about fields; they only define the accessors (add/remove)
p1690
aVThe delegate backer is an implementation detail; it just so happens that field-like-events declare a field as a backing member - in the same way that auto-implemented-properties declare a field as a backing member
p1691
aVOther implementations are possible (and very common, especially in forms etc)
p1692
aVOther common implementations:
p1693
aVSparse-events (Controls, etc) - EventHandlerList (or similar):
p1694
aV(the above is pretty-much the backbone of win-forms events)
p1695
aVFacade (although this confuses the "sender" a little; some intermediary code is often helpful):
p1696
aV(the above can also be used to effectively rename an event)
p1697
as(dp1698
g18
V23354
p1699
stp1700
a((dp1701
g2
(lp1702
VOr in C# 3
p1703
ag190
as(dp1704
g18
V23354
p1705
stp1706
a((dp1707
g2
(lp1708
VIndeed, there is special treatment of Type
p1709
aVthis approach is used in the IDE etc to configure meta-data ahead of time
p1710
aVIf you look at IDE-generated bindings, they do things like:
p1711
aVsaying "when we get real data, we expect MyObject isntance(s)"; i
p1712
ag50
aVwhen you ask for "Name", it is looking for the name property on MyObject - not the Name of the Type instance
p1713
aVThis allows grids etc to obtain their metadata without having to wait for the real data; but as a consequence you can't bind to Type "for real"
p1714
aVThe System
p1715
aVComponentModel code is identical between simple bindings and list bindings (give or take a currency manager), so simple bindings also inherit this behaviour
p1716
aVEqually, you can't bind to properties of a class that implements IList/IListSource, since this is interpreted in a special way
p1717
aVYour extra class seems a reasonable approach
p1718
as(dp1719
g18
V23354
p1720
stp1721
a((dp1722
g2
(lp1723
VFor public methods, then yes: it is definitely necessary to check your arguments; for internal/private calls, Eric Lippert might categorise them as "boneheaded" (here); his advice is not to catch them
p1724
aVfix the code
p1725
aVTo avoid code bloat, you might want to consider AOP, for example postsharp
p1726
aVTo illustrate, Jon Skeet has a postsharp attribute that does null-argument checking, here
p1727
aVThen (to quote his example), you can simply attribute the method:
p1728
aVAnother handy trick here might be extension methods; extension methods have the curious feature that you can call them on null instances
p1729
aVso you can do the following (where the use of generics instead of "object" is so you don't accidentally call it by boxing a value-type):
p1730
aVAnd you can do similar things with out-of-range, etc
p1731
as(dp1732
g18
V23354
p1733
stp1734
a((dp1735
g2
(lp1736
VGenerics support (since C# 3
p1737
aV0 doesn't allow use of generics and operators), like here
p1738
as(dp1739
g18
V23354
p1740
stp1741
a((dp1742
g2
(lp1743
VIn general, LINQ-to-SQL will be "about the same", and I'd agree that caching is porbably an issue here
p1744
aVReally you need to look at the generated SQL; the easiest way being:
p1745
aVThen try running the TSQL directly in Query Analyzer
p1746
aVSPROCs have some advantages in terms of being able to optimise access, use table variables, etc; however, LINQ has the advantage of composability - i
p1747
ag50
aVyou can apply your paging, sorting, projections, etc in the single query
p1748
aVYou can at a push do that with an SPROC, but it is very hard work
p1749
aVBut really, the key is in looking at the TSQL; it might be that you haven't loaded all the data, for example (lazy loading)
p1750
as(dp1751
g18
V23354
p1752
stp1753
a((dp1754
g2
(lp1755
VIt depends on the size; for small to mid size xml, a DOM such as XmlDocument (any C#/
p1756
aVNET versions) or XDocument (
p1757
aVNET 3
p1758
aV5/C# 3
p1759
aV0) is the obvious winner
p1760
aVFor using xsd, You can load xml using an XmlReader, and an XmlReader accepts (to Create) an XmlReaderSettings
p1761
aVThe XmlReaderSettings objects has a Schemas property that can be used to perform xsd (or dtd) validation
p1762
aVFor writing xml, the same things apply, noting that it is a little easier to lay out content with LINQ-to-XML (XDocument) than the older XmlDocument
p1763
aVHowever, for huge xml, a DOM may chomp too much memory, in which case you might need to use XmlReader/XmlWriter directly
p1764
aVFinally, for manipulating xml you may wish to use XslCompiledTransform (an xslt layer)
p1765
aVThe alternative to working with xml is to work with an object model; you can use xsd
p1766
aVexe to create classes that represent an xsd-compliant model, and simply load the xml as objects, manipulate it with OO, and then serialize those objects again; you do this with XmlSerializer
p1767
as(dp1768
g18
V23354
p1769
stp1770
a((dp1771
g2
(lp1772
VIf the WCF service doesn't use it, what would you want it for
p1773
aVA WCF service (itself) is purely for data transport - the "mex" approach for metadata doesn't share code, so your MyClass2 would be impotent
p1774
aVIf you want, you can use assembly sharing at the client, but I really don't recommend this in this case; EF objects at the client is a mess
p1775
aV(plus it won't work on the lightweight frameworks like Silverlight, Client Profile, Compact Framework, etc)
p1776
aVAnother option is ADO
p1777
aVNET Data Services; this works over WCF, but gives you a more LINQ-friendly API than the regular WCF approach - and any domain objects that your model exposes should be available on the client data-context
p1778
as(dp1779
g18
V23354
p1780
stp1781
a((dp1782
g2
(lp1783
VThe ISV market definitely has smoe catching up to do with MVC, but that makes sense - it isn't RTM yet (although the last preview at least had an explicit "go live" licence)
p1784
aVRegular Webforms controls will pretty-much need re-writing
p1785
aVI don't imagine it will take long for the major players to catch up, but if you are using something from a smaller company it could be hard getting it to prioritise MVC
p1786
aVOne (really hacky) option might be using an IFRAME or AJAX to treat a portion of the page as a separate aspx page
p1787
aVreally, really nasty
p1788
as(dp1789
g18
V23354
p1790
stp1791
a((dp1792
g2
(lp1793
VI guess one option would be to keep taking chunks off it, and converting individual chunks
p1794
aVA bit of mod/division etc, converting individual fragments
p1795
aVSo: what hex value do you expect
p1796
aVHere's two approaches
p1797
aVone uses the binary structure of decimal; one does it manually
p1798
aVIn reality, you might want to have a test: if bits[3] is zero, do it the quick way, otherwise do it manually
p1799
as(dp1800
g18
V23354
p1801
stp1802
a((dp1803
g2
(lp1804
VThere is a line, somewhere
p1805
aVsharing library code is positively encouraged - but you need to be a little bit careful when apps consume each-other, simply to prevent spaghetti code and circular references
p1806
aVIf the code you mention is really library code (i
p1807
ag50
aVneither project is the "master" for this data), then it should be fine (versioning issues aside)
p1808
aVIf it is the case that Project A wants Project B's data, then it usually isn't long before Project B wants Project A's data, and you have a spider web
p1809
aVIn such cases, it may be preferable to use an SOA approach; have the projects expose their data via something like a WCF service, so that other projects only call into the public mex/wsdl API (ideally without assembly sharing)
p1810
aVBut it is a deceptively complex question, and I don't think any single answer can cater for every scenario
p1811
as(dp1812
g18
V23354
p1813
stp1814
a((dp1815
g2
(lp1816
VOK; it depends on the output you want - with XElement you'd need to do a bit of work to remove all the descendent nodes etc
p1817
aVHowever, it is actually quite simple with XmlDocument:
p1818
aVOutputs:
p1819
aV[was]
p1820
aVCare to define "flatten" in this context
p1821
ag412
ag50
aV"before" and "after"
p1822
aVXDocument has Descendants() and DescendantNodes() which might do the job
p1823
as(dp1824
g18
V23354
p1825
stp1826
a((dp1827
g2
(lp1828
VThe compiler won't optimise away the indexer (i
p1829
ag50
aVif you use row["value"] twice), so yes it is slightly quicker to do:
p1830
aVand then use value twice; using
p1831
aVGetType() risks issues if it is null
p1832
aVis actually a singleton, so to add a 4th option - you could perhaps use ReferenceEquals - but in reality, I think you're worrying too much here
p1833
aVI don't think the speed different between "is", "==" etc is going to be the cause of any performance problem you are seeing
p1834
aVProfile your entire code and focus on something that matters
p1835
aVit won't be this
p1836
as(dp1837
g18
V23354
p1838
stp1839
a((dp1840
g2
(lp1841
V implements , so can't you simply use the extension method:
p1842
aVWhat happens if you execute this
p1843
aVI would have expected the overall query to just do a Count()
p1844
aV(not that I've done much EF
p1845
as(dp1846
g18
V23354
p1847
stp1848
a((dp1849
g2
(lp1850
VRobocopy deployment
p1851
as(dp1852
g18
V23354
p1853
stp1854
a((dp1855
g2
(lp1856
VIf I understand the question, then the most common approach would be to declare a non-generic base-interface, i
p1857
ag50
aVAnother option is for you to code largely in generics
p1858
ag412
ag50
aVyou have methods like
p1859
aVIf the  is an argument to , then usually you don't need to specify the generic type argument yourself - the compiler will infer it - i
p1860
ag50
aVrather than
p1861
aVThere are benefits to both approaches
p1862
as(dp1863
g18
V23354
p1864
stp1865
a((dp1866
g2
(lp1867
VNot without a profiler
p1868
aVIt is hard enough just for a single class - see here
p1869
as(dp1870
g18
V23354
p1871
stp1872
a((dp1873
g2
(lp1874
VCan you define "large"
p1875
aVThe 1000x10000xint example (another post) comes out at 40Mb; and 1000x10000x4 bytes (=int) is 38MB
p1876
aVAs overheads go, that isn't terrible
p1877
aVWhat sort of data is T likely to be
p1878
aVJust primatives
p1879
aVI'm thinking that I could probably edit protobuf-net to support rectangular arrays - but to keep some kind of wire-compatibility we'd probably need a header (one byte) per element - i
p1880
ag50
aV9MB of overhead for the 1000x10000 example
p1881
aVThis probably isn't worth it for things like , , etc (since they are stored verbatim under "protocol buffers") - but there may be savings for things like  simply due to how it packs ints
p1882
aV(especially if they tend to be on the smaller side [magnitude])
p1883
aVFinally, if T is actually objects like  etc, then it should be a lot better than binary serialization, since it is very good at packing objects
p1884
aVIt wouldn't be trivial to shoe-horn in rectangular arrays, but let me know if this is something you'd be interested in trying
p1885
aV: it doesn't at the moment since the "protocol buffers" spec doesn't support them, but we can hack around that
p1886
as(dp1887
g18
V23354
p1888
stp1889
a((dp1890
g2
(lp1891
VThere are lots of things you can do to speed up reflection
p1892
aVFor example, if you are doing lots of property-access, then HyperDescriptor might be useful
p1893
aVIf you are doing a lot of method-invoke, then you can cache methods to typed delegates using  - this then does the type-checking etc only once (during )
p1894
aVIf you are doing a lot of object construction, then  won't help (you can't use it on a constructor) - but (in 3
p1895
aV5)  can be used to do this, again compiling to a typed delegate
p1896
aVSo yes: reflection is slow, but you can optimize it without too much pain
p1897
as(dp1898
g18
V23354
p1899
stp1900
a((dp1901
g2
(lp1902
VThere are 2 main kinds of transactions; connection transactions and ambient transactions
p1903
aVA connection transaction (such as SqlTransaction) is tied directly to the db connection (such as SqlConnection), which means that you have to keep passing the connection around - OK in some cases, but doesn't allow "create/use/release" usage, and doesn't allow cross-db work
p1904
aVAn example (formatted for space):
p1905
aVNot too messy, but limited to our connection "conn"
p1906
aVIf we want to call out to different methods, we now need to pass "conn" around
p1907
aVThe alternative is an ambient transaction; new in
p1908
aVNET 2
p1909
aV0, the TransactionScope object (System
p1910
aVTransactions
p1911
aVdll) allows use over a range of operations (suitable providers will automatically enlist in the ambient transaction)
p1912
aVThis makes it easy to retro-fit into existing (non-transactional) code, and to talk to multiple providers (although DTC will get involved if you talk to more than one)
p1913
aVFor example:
p1914
aVNote here that the two methods can handle their own connections (open/use/close/dispose), yet they will silently become part of the ambient transaction without us having to pass anything in
p1915
aVIf your code errors, Dispose() will be called without Complete(), so it will be rolled back
p1916
aVThe expected nesting etc is supported, although you can't roll-back an inner transaction yet complete the outer transaction: if anybody is unhappy, the transaction is aborted
p1917
aVThe other advantage of TransactionScope is that it isn't tied just to databases; any transaction-aware provider can use it
p1918
aVWCF, for example
p1919
aVOr there are even some TransactionScope-compatible object models around (i
p1920
ag50
aVNET classes with rollback capability - perhaps easier than a memento, although I've never used this approach myself)
p1921
aVAll in all, a very, very useful object
p1922
aVSome caveats:
p1923
aVOn SQL Server 2000, a TransactionScope will go to DTC immediately; this is fixed in SQL Server 2005 and above, it can use the LTM (much less overhead) until you talk to 2 sources etc, when it is elevated to DTC
p1924
aVThere is a glitch that means you might need to tweak your connection string
p1925
as(dp1926
g18
V23354
p1927
stp1928
a((dp1929
g2
(lp1930
VTestDriven
p1931
aVNET has the ability to test (NUnit/MSTest/etc) with Team Coverage (which you already have since you have Team System : Dev)
p1932
aVWalkthrough: here (you also get the coverage results window for looking at the coverage per method) - but this says it all:
p1933
aVYou can use NUnit tests, but use the MS IDE integration for colorization, percentagaes, etc (no need for NCover)
p1934
aVI use this all the time ;-p
p1935
aVThe advantages are:
p1936
aVno need to set up a "Test Run Configuration" (sorry, MSFT, but an own-goal there)
p1937
aVfully integrated with VS (Code Coverage Results and Coloring)
p1938
aVeasy to use (just right-click -> Test With -> Team Coverage)
p1939
aVeasy to debug too (right-click -> Test With -> Debugger)
p1940
aVeasy to use the separate NUnit/NCover apps if you want  (right-click etc)
p1941
as(dp1942
g18
V23354
p1943
stp1944
a((dp1945
g2
(lp1946
VActually, it is a bad idea for something to be both an item and a container
p1947
aVThis breaks a number of binding scenarios that make assumptions about IList; so for a chest, I might be tempted to have an Items property on the chest that is the collection, but let the chest just be a chest
p1948
aVHowever, for the question as asked
p1949
aVI would be tempted to make the MudObject the interface
p1950
aVthat way, you can use something like the following, which gives you a generic container of any concrete objects, along with automatic parenting:
p1951
as(dp1952
g18
V23354
p1953
stp1954
a((dp1955
g2
(lp1956
VThe simplest option (if you have a form/control handy) is to check InvokeRequired
p1957
aVIn the absence if that, you could try using  to simulate a Post or Send, checking what thread that happens on
p1958
aVCalling Send or Post will switch to the UI thread
p1959
as(dp1960
g18
V23354
p1961
stp1962
a((dp1963
g2
(lp1964
VI'd agree with jmcd that WebClient would be far simpler, in particular WebClient
p1965
aVDownloadData
p1966
aVre the actual question, the problem is that you are reading single bytes, when you should probably have a fixed buffer, and loop - i
p1967
ag50
aV[edit to add emphasis] The important bit is that you only process "bytesRead" worth of data each time; everything beyond there is garbage
p1968
as(dp1969
g18
V23354
p1970
stp1971
a((dp1972
g2
(lp1973
VIf the data maps fairly cleanly to an object model, you could try using xsd
p1974
aVexe to generate some classes from the
p1975
aVxsd, and process the classes into your DAL of choice
p1976
aVThe problem is that if the volume is high (you mention thousands of records), you will most likely have a lot of round-trips
p1977
aVAnother option might be to pass the data "as is" through to the database and use SQL/XML to process the data in TSQL - presumably as a stored procedure that accepts a parameter of type xml (SQL Server 2005 etc)
p1978
as(dp1979
g18
V23354
p1980
stp1981
a((dp1982
g2
(lp1983
VWhat did you have in mind
p1984
aVMainly, I doubt it; besides, it will still only handle http[s], so why confuse things with a different scheme name
p1985
aVYou can listen on a different port by adding it to the prefix list (eg "http://127
p1986
ag190
ag190
aV1:90/"), though
p1987
aVIf a client connects on that port using the correct protocol (http vs https) then it would probably work - you'd just have a lot of work to do at the client to tell it how to handle that scheme
p1988
aVI'm not sure I see a point, to be honest
p1989
as(dp1990
g18
V23354
p1991
stp1992
a((dp1993
g2
(lp1994
VThe project properties have a publish version (on the Publish tab), and an (optional) minimum version (on the Updates button on the Publish tab)
p1995
aVNeither is related to any assembly version, and is just used for ClickOnce
p1996
aVIf a minimum version is specified, it must be logical (i
p1997
ag50
aVnot higher than the main version)
p1998
aVIn the csproj, this is the ApplicationVersion/ApplicationRevision and MinimumRequiredVersion elements
p1999
as(dp2000
g18
V23354
p2001
stp2002
a((dp2003
g2
(lp2004
VJust stumbled into this oldie
p2005
aVTo do this without the dynamic LINQ library, you just need the code as below
p2006
aVThis covers most common scenarios including nested properties
p2007
aVTo get it working with  you could add some wrapper methods that go via AsQueryable - but the code below is the core  logic needed
p2008
aVEdit: it gets more fun if you want to mix that with  - although note that  only applies to LINQ-to-Objects (expression-trees for ORMs etc can't really represent  queries -  doesn't support it)
p2009
aVBut here's a way to do it with LINQ-to-Objects
p2010
aVNote that the choice of  is due to favorable locking semantics:
p2011
as(dp2012
g18
V23354
p2013
stp2014
a((dp2015
g2
(lp2016
VNote that the public VS2010 CTP image includes chart functionality built into ASP
p2017
aVNET; overdue, but welcome
p2018
as(dp2019
g18
V23354
p2020
stp2021
a((dp2022
g2
(lp2023
VGenerally, you need to have a working (if primative) cut of the compiler working first - then you can start thinking about making it self-hosting
p2024
aVThis is actually considered an important milestone in some langauges
p2025
aVFrom what I remember from "mono", it is likely they will need to add a few things to reflection to get it working: the mono team keep pointing out that some things simply aren't possible with ; of course, the MS team might prove them wrong
p2026
aVThis has a few real advantages: it is a fairly good unit test, for starters
p2027
aVAnd you only have one language to worry about (i
p2028
ag50
aVit is possible a C# expert might not know much C++; but now thy can fix the C# compiler)
p2029
aVBut I wonder if there isn't an amount of professional pride at work here: they simply want it to be self-hosting
p2030
aVNot quite a compiler, but I've recently been working on a system that is self hosting; the code generator is used to generate the code generator
p2031
aVso if the schema changes I simply run it on itself : new version
p2032
aVIf there is a bug, I just go back to an earlier version and try again
p2033
aVVery convenient, and very easy to maintain
p2034
aV[update]
p2035
aVI've just watched the video of Anders at PDC, and (about an hour in) he does give some much more valid reasons - all about the compiler as a service
p2036
aVJust for the record ;-p
p2037
as(dp2038
g18
V23354
p2039
stp2040
a((dp2041
g2
(lp2042
V is useful when you need to synchronize back to (for example) a UI* thread, eg for affinity reasons
p2043
aVIn this case, it would seem that simply using  would be more than adequate (and much simpler)
p2044
aVIf you have high volumes, then a producer/consumer queue may allow better throttling (so you don't drown in threads) - but I suspect  will be fine here
p2045
aVAlso - I'm not quite sure what you want to achieve by sleeping
p2046
aVThis will just tie up a thread (not using CPU, but doing no good either)
p2047
aVCare to elaborate
p2048
aVIt looks like you are pausing your actual web page (i
p2049
ag50
aVthe Sleep happens on the web-page thread, not the e-mail thread)
p2050
aVWhat are you trying to do here
p2051
aV*=actually, it will use whatever sync-context is in place
p2052
as(dp2053
g18
V23354
p2054
stp2055
a((dp2056
g2
(lp2057
VJon Skeet has a very good walkthrough of this here, and the same for  here
p2058
as(dp2059
g18
V23354
p2060
stp2061
a((dp2062
g2
(lp2063
VBecause of how DataTable (and DataView) sorting works, you can't use the delegate approach directly
p2064
aVOne workaround is to add a column to the data-table that represents the order, and set the value (per row) based on the desired sequence
p2065
aVYou can then add a Sort to the view on this new column
p2066
aVFor example (using LINQ to do the sort, just for brevity):
p2067
aV(if you have a typed data-set, then I don't think you need the Cast step, or you would use your typed DataRow subclass)
p2068
aV[edit to include 2
p2069
aV0]
p2070
aVIn 2
p2071
aV0 (i
p2072
ag50
aVwithout LINQ etc) you could use a  to do the sort - a bit more long-winded, but:
p2073
aV(again, substitute DataRow if you are using a typed data-set)
p2074
as(dp2075
g18
V23354
p2076
stp2077
a((dp2078
g2
(lp2079
VHere's a very simple example; the call to  releases the lock (allowing  to obtain it) and adds the  thread to the lock-object's pending queue
p2080
aVthen obtains the lock, and calls : this moves the  thread into the lock-object's ready queue
p2081
aVWhen  releases the lock,  can resume work
p2082
aVNote that  is just compiler-candy for / in a try/finally block
p2083
aV[edit: I changed the sample to move  earlier, to avoid the (unlikely) risk of a missed Pulse]
p2084
as(dp2085
g18
V23354
p2086
stp2087
a((dp2088
g2
(lp2089
s(dp2090
g18
V23354
p2091
stp2092
a((dp2093
g2
(lp2094
VNo, it isn't safe, see below:
p2095
aVusing System
p2096
aVCollections
p2097
aVGeneric;
p2098
aVclass Foo { }
p2099
aVclass Bar : Foo { }
p2100
aVHowever, you should be able to use an iterator block to do the cast for you
p2101
as(dp2102
g18
V23354
p2103
stp2104
a((dp2105
g2
(lp2106
VIt sounds like you're sorted - but often, another potential approach is to split the data first
p2107
aVObviously this only works with some transformations (i
p2108
ag50
aVwhere different chunks of data can be treated in isolation from the whole) - but then you can use a simple parser (rather than a DOM) to do the splitting into manageable pieces, then process each chunk separately and reassemble
p2109
aVSince I'm a
p2110
aVNET bod, things like  can do the chunking without a DOM; I'm sure there are equivalents for every language
p2111
aVAgain - just for completeness
p2112
aV[edit re question]
p2113
aVI'm not aware of any specific name; maybe Divide and Conquer
p2114
aVFor an example; if your data is actually a flat list of like objects, then you could simply split the first-level children - i
p2115
ag50
aVrather than having 2M rows, you split it into 10 lots of 200K rows, or 100 lots of 20K rows
p2116
aVI've done this before lots of times for working with bulk data (for example, uploading in chunks of data [all valid] and re-assembling at the server so that each individual upload is small enough to be robust)
p2117
as(dp2118
g18
V23354
p2119
stp2120
a((dp2121
g2
(lp2122
VThe whole subject of iterator blocks is covered well in this free sample chapter from Jon Skeet's book C# in Depth
p2123
as(dp2124
g18
V23354
p2125
stp2126
a((dp2127
g2
(lp2128
VLike so:
p2129
aVI have started a blog which will cover a number of expression topics, here
p2130
aVIf you get any problems, another option is to extract the value from  first (using reflection) and then use that value in the , but I suspect it'll be fine "as is"
p2131
as(dp2132
g18
V23354
p2133
stp2134
a((dp2135
g2
(lp2136
VCan I check - do you mean a rectangular array ()or a jagged array ()
p2137
aVIt is quite easy to sort a jagged array; I have a discussion on that here
p2138
aVObviously in this case the  would involve a column instead of sorting by ordinal - but very similar
p2139
aVSorting a rectangular array is trickier
p2140
aVI'd probably be tempted to copy the data out into either a rectangular array or a , and sort there, then copy back
p2141
aVHere's an example using a jagged array:
p2142
aVFor working with a rectangular array
p2143
aVwell, here is some code to swap between the two on the fly
p2144
as(dp2145
g18
V23354
p2146
stp2147
a((dp2148
g2
(lp2149
VYes, using  or  for financials is a common mistake, leading to much, much pain
p2150
aVis the most obvious choice in this scenario
p2151
aVFor general knowledge, a good discussion of each is here (float/double) and here (decimal)
p2152
as(dp2153
g18
V23354
p2154
stp2155
a((dp2156
g2
(lp2157
VPersonally, I would side step the issue by renaming the  method to
p2158
aVThis avoids such issues, and is consistent with existing APIs such as
p2159
aVIt also keeps things clean when the  you want to add implements  (rare,  I'll admit)
p2160
as(dp2161
g18
V23354
p2162
stp2163
a((dp2164
g2
(lp2165
VEric Lippert has a good blog on this, here
p2166
aVThere is no point (except for "vexing" (see blog)) catching an exception unless you can do something useful; and in most cases you simply can't - so let it bubble (your UI should obviously cleanse and display something)
p2167
aVYou might, however, have a "try/finally" to deal with resource management
p2168
aVOr even cleaner, a "using" block to do the same
p2169
as(dp2170
g18
V23354
p2171
stp2172
a((dp2173
g2
(lp2174
VHow about this
p2175
aV(multi-targetting rules for FxCop)
p2176
as(dp2177
g18
V23354
p2178
stp2179
a((dp2180
g2
(lp2181
VXml usually compresses very well, as it tends to have a lot of repetition
p2182
aVAnother option would be to swap to a binary format; BinaryFormatter or NetDataContractSerializer are simple options, but both are notoriously incompatible (for example with java) compared with xml
p2183
aVAnother option would be a portable binary format such as google's "protocol buffers"
p2184
aVI maintain a
p2185
aVNET/C# version of this called protobuf-net
p2186
aVThis is designed to be side-by-side compatible with regular
p2187
aVNET approaches (such as XmlSerializer / DataContractSerializer), but is much smaller than xml, and requires significantly less processing (CPU etc) for both serialization and deserialization
p2188
aVThis page shows some numbers for XmlSerializer, DataContractSerializer and protobuf-net; I thought it included stats with/without compression, but they seem to have vanished
p2189
aV[update] I should have said - there is a TCP/IP example in the QuickStart project
p2190
as(dp2191
g18
V23354
p2192
stp2193
a((dp2194
g2
(lp2195
VOf course, another question would be "why have you got public fields
p2196
aV- properties being preferable
p2197
aVAs an abstraction, note that reflection isn't the only option: it is also possible for a type to expose it's properties on-the-fly at runtime (like how an untyped / exposes columns as properties)
p2198
aVTo support this (while also supporting simple objects), you would use :
p2199
aVThis also allows for numerous extensibility options - for example, vastly speeding up reflection (without changing any code)
p2200
as(dp2201
g18
V23354
p2202
stp2203
a((dp2204
g2
(lp2205
VWell, for starters it would be a lot simpler to use  than mshtml (note that you can still host  in WPF) - this will certainly let you do simple things a lot easier:
p2206
aVHowever, I can't see anything there that would let you work with selections very easily
p2207
aVYou can get the selected element with , but this is the entire element - not the selected portion
p2208
as(dp2209
g18
V23354
p2210
stp2211
a((dp2212
g2
(lp2213
VRe the first point: have you tried the (free) VIsual Studio Express Edition
p2214
aVFor a lot of things, this is perfectly capable
p2215
aVYou just don't get as many helpers / designers, and no plug-in support (for IDE extensions)
p2216
aVRe the second: excluding some nasty tricks, you can't create a pure native executable from
p2217
aVNET; it relies heavily on the framework being available on the local machine
p2218
aVAn assembly is just a package of IL, and can be contained (typically) in either a dll, or bootstrapped into an exe that loads the assemblies entry-point; but in this scenario the exe is just a simple loader plus a regular assembly
p2219
aVActually, the CLR is more like the JVM; the "framework" is really just the equiavalent of a BCL
p2220
aVThe main MS framework+CLR certainly has some Windows specific optimizations, but other runtimes/frameworks (compact, micro, Silverlight, Mono) will have different optimizations
p2221
aVRe multi-core - you have full threading support (for doing it yourself) - but the main automated multi-core support will (hopefully) be in
p2222
aVNET 4
p2223
aV0 with the "parallel extensions" work
p2224
aVRe the last point: should be very familiar indeed
p2225
aVActually, if you want to do some comparisons, "reflector" (free) can take a compiled assembly and show you the code in either C# or delphi (or a few others)
p2226
aV[update re questions]
p2227
aVIL = Intermediate Language;
p2228
aVNET doesn't compile to native CPU instructions, but to something in-between that becomes CPU instruction at runtime (compiled "Just In Time" (JIT) on a method-by-method basis)
p2229
aVThis means that the JIT compiler can optimize the same IL for the local machine
p2230
aVYou can do this in advance using NGen
p2231
aVCLR = Common Language Runtime; essentially the VM
p2232
aVBCL = Base Class Library; the set of classes shared my many apps
p2233
aVRe deployment: first, install the
p2234
aVNET framework on the client ;-p
p2235
aVAfter that - various options
p2236
aVAt the simplest level, you can just copy the exe/etc onto the local machine and run
p2237
aVFor example, I use "robocopy" to push code to web-servers
p2238
aVFor full local installs of a complex client app, msi is an option (and the full VS IDE will help you with this)
p2239
aVFor simple clients, you can use ClickOnce - which packages the app into a signed bundle that provides self-updating etc capabilities and allows you to make statements about what security you need (full trust, etc)
p2240
aVExpress Edition allows you to author  ClickOnce packages
p2241
aVClickOnce can even be used on locked down clients where the user can't install apps, since the app is isolated and sand-boxed
p2242
aVFinally, you can run a
p2243
aVNET app off a network share, but there are some security implications: the "Code Access Security" layer won't give a network share "full trust" (although there were some recent changes to this so that mapped (F: etc) shares are trusted)
p2244
aVSo you'd need to use CASPOL at each client to trust the code
p2245
aVClickOnce would be easier ;-p
p2246
as(dp2247
g18
V23354
p2248
stp2249
a((dp2250
g2
(lp2251
VHave you tried using this CSV reader
p2252
aVIt is generally very respected
p2253
aVPerhaps give it a go
p2254
as(dp2255
g18
V23354
p2256
stp2257
a((dp2258
g2
(lp2259
VPersonally, I'd recommend the simplest binding that gives what you need
p2260
aVI've done quite a lot of WCF (some quite complex), and I've never had to use anything other than BasicHttpBinding; this also allows that greatest possible compatibility with non-
p2261
aVNET clients, and lets you use things like MTOM for efficient binary transfer
p2262
aVRe hosting; IIS is indeed the simplest for a client/server setup; two particular strengths:
p2263
aVeasy to configure SSL (i
p2264
ag50
aVyou just configure IIS, and WCF will use it)
p2265
aVeasy to load balance (just load balance your web farm)
p2266
aV(I believe WCF running over BasicHttpProfile can also leverage your IIS compression [GZip/Deflate] setup, but don't quote me
p2267
aVYou might choose to use a standalone host (usually via a windows service) if (for example) you want a long-running stateful server
p2268
aVIIS has this habit (by design) of recycling the app-pools, which isn't good if you were keeping something in memory
p2269
aVAnother example is where you want it to be already running for fast "first hit" performance (rather than waiting for IIS/ASP
p2270
aVNET to spin up)
p2271
aVAn example covering both of these might be hosting a WF (workflow) server
p2272
aVAgain; if you don't need this complexity, go for the simplest option: hosting in IIS
p2273
as(dp2274
g18
V23354
p2275
stp2276
a((dp2277
g2
(lp2278
VJon's answer is ideal - just one observation: as part of general design, I would:
p2279
aVgenerally avoid reflecting against
p2280
aVnon-public members
p2281
aVavoid having public fields (almost always)
p2282
aVThe upshot of these two is that generally you only need to reflect against public properties (you shouldn't be calling methods unless you know what they do; property getters are expected to be idempotent [lazy loading aside])
p2283
aVSo for a  this is just
p2284
aVActually, I'm a big fan of , so I would be tempted to use:
p2285
aVor for a specific property:
p2286
aVOne advantage of  is that it will work with abstracted data models, such as how a  exposes columns as virtual properties; there are other tricks too (like performance tricks)
p2287
as(dp2288
g18
V23354
p2289
stp2290
a((dp2291
g2
(lp2292
VYou might like to know that you can use  to write a basic web-server very easily - this deals with most of the painful bits, letting you concentrate on writing the actual code
p2293
aVThe MSDN page gives an example
p2294
aVNote that this uses HTTP
p2295
aVSYS, which is good - but means that non-admins need to be explicitly given access to open ports; on xp you can do this with ; on vista you can use
p2296
aVSee here for more
p2297
as(dp2298
g18
V23354
p2299
stp2300
a((dp2301
g2
(lp2302
VThe wrapping is because by dfault C# is unchecked
p2303
aVIf you add a "checked" block, the overflow will be detected:
p2304
aVAs for the compiler: it simply demands valid data
p2305
as(dp2306
g18
V23354
p2307
stp2308
a((dp2309
g2
(lp2310
VWhat exactly are you after
p2311
aVNote that you can use LINQ-to-SQL without the attributes, if you want to use existing classes
p2312
aVyou need to use an external xml file to hold the mappings, and an
p2313
aVNote that this won't work with Entity Framework; only LINQ-to-SQL
p2314
as(dp2315
g18
V23354
p2316
stp2317
a((dp2318
g2
(lp2319
VKilling threads harshly: not a good idea
p2320
aVYou should almost always communicate with a thread (even a simple volatile bit-flag would do), and let the thread commit suicide
p2321
aVKilling it is very risky, and can leave locks on objects etc
p2322
aVFor the more general case - have you heard of parallel extensions
p2323
aVThere is a whole new level of threading management planned for
p2324
aVNET 4
p2325
aV0, including parallel LINQ extensions, etc
p2326
as(dp2327
g18
V23354
p2328
stp2329
a((dp2330
g2
(lp2331
V[updated for clarity]
p2332
aVFirst; cast the  to a
p2333
aVA  has two things of interest:
p2334
aVMember - the  /  to the member
p2335
aVExpression - the expression to evaluate to get the "obj" for the
p2336
aVMember
p2337
ag412
ag50
aVif you can evaluate the  to "obj", and the  is a , then you can get the actual value via  on the  (and  is very similar)
p2338
aVThe problem is that evaluating the  is very tricky ;-p
p2339
aVObviously you get lucky if it turns out to be a  - but in most cases it isn't; it could be a  (in which case you'll need to know the actual parameter value that you want to evaluate), or any other combination of s
p2340
aVIn many cases, a simple (perhaps lazy) option is to use  to get the
p2341
aVNET framework to do the heavy lifting; you can then evaluate the lambda as a typed delegate (passing in any parameters that the lambda requires)
p2342
aVThis isn't always an option, however
p2343
aVTo show how complex this is; consider this trivial example (where I've hard-coded at every step, rather than testing etc):
p2344
as(dp2345
g18
V23354
p2346
stp2347
a((dp2348
g2
(lp2349
VMaintaining a position property is a pain, as you need to make lots of modifications to change something (while keeping everything logical)
p2350
aVIt also makes it hard to serialize/deserialize efficiently
p2351
aVCan you not simply infer the position from the position in a  or similar
p2352
aVThen you can  to the end,  to the middle and  from anywhere
p2353
aVTo move something you simply  it and  it at the position you want
p2354
aVLike so (formatted for space):
p2355
as(dp2356
g18
V23354
p2357
stp2358
a((dp2359
g2
(lp2360
VWell you could do some really messy code involving  - i
p2361
ag50
aVin  it is virtual (for the designer), but in  it is abstract
p2362
aVA real pain to maintain, though
p2363
aVBut other than that: basically, no
p2364
aVIf you want designer support it can't be abstract, so you are left with "virtual" (presumably with the base method throwing a )
p2365
aVOf course, your unit tests will check that the methods have been implemented, yes
p2366
aV;-p
p2367
aVActually, it would probably be quite easy to test via generics - i
p2368
ag50
aVhave a generic test method of the form:
p2369
as(dp2370
g18
V23354
p2371
stp2372
a((dp2373
g2
(lp2374
VRe not loading System
p2375
aVWeb
p2376
aVdll - as others have noted, it isn't worth getting excited unless you know that you need to deal with clients that might not have it ("client profile", "compact framework", "micro framework", "silverlight")
p2377
aVRe space; it won't be a lot really; note that
p2378
aVNET assemblies are JITted on a method-by-method basis, so there won't be any significant overhead just from using a few methods
p2379
aVThe real issue (IMO) is your level of confidence that the client has System
p2380
aVWeb
p2381
aVdll; if you are happy that they are using the full framework, then just go for it
p2382
as(dp2383
g18
V23354
p2384
stp2385
a((dp2386
g2
(lp2387
VHave you tried  and
p2388
aV(in System
p2389
aVConfiguration
p2390
aVdll)
p2391
as(dp2392
g18
V23354
p2393
stp2394
a((dp2395
g2
(lp2396
VBasically, no
p2397
aVThat is an http header, so it is reasonable to cast to  and set the  (as you indicate in the question):
p2398
as(dp2399
g18
V23354
p2400
stp2401
a((dp2402
g2
(lp2403
VHow are you deploying
p2404
aVJust flat files
p2405
aVIf so, it should work as long as the file ends up in the project output directory
p2406
aVDoes it
p2407
aVIf you are using another deployment, you will need to tell that engine to include it
p2408
aVThis is different for each of msi/ClickOnce/etc
p2409
as(dp2410
g18
V23354
p2411
stp2412
a((dp2413
g2
(lp2414
VSince you are talking about tabs, it sounds to me like you want something closer to a dictionary keyed on the tab name, with a set of items per tab
p2415
aVNET 3
p2416
aV5 added the  interface:
p2417
aVNote that the MS implementation is immutable - you can't edit it after creation; however, I wrote an  in MiscUtil that allows you to work more effectively (just like a regular
p2418
aVNET collection):
p2419
aVWithout , you need to build the lookup via the  extension method
p2420
aVIf any part of this sounds like an option, I can add more detail
p2421
as(dp2422
g18
V23354
p2423
stp2424
a((dp2425
g2
(lp2426
VIt works fine for me
p2427
aVwhat version of the
p2428
aVNET framework are you using, and what is the exact exception
p2429
aVAlso - what does you  method look like
p2430
aVis this just a pass-thru to
p2431
aV[update] The problem is that the OP's example code didn't show they are using the IgnorePatternWhitespace regex option; with this option it doesn't work; without this option (i
p2432
ag50
aVas presented) the code is fine
p2433
as(dp2434
g18
V23354
p2435
stp2436
a((dp2437
g2
(lp2438
VAn indirect answer (I don't use that library myself) - if I was looking at complex threading, I'd be very tempted to look at what the TPL has to offer in the current CTP, especially looking forward to
p2439
aVNET 4
p2440
ag190
as(dp2441
g18
V23354
p2442
stp2443
a((dp2444
g2
(lp2445
VHow big are the files
p2446
aVHuge buffers (i
p2447
ag50
aVbyte[fileLength]) are usually a bad idea
p2448
aVPersonally, I'd look at things like this and this, which show reading/writing data as streams (the second shows pushing the stream as an http response)
p2449
aVBut updated to use varchar(max) ;-p
p2450
as(dp2451
g18
V23354
p2452
stp2453
a((dp2454
g2
(lp2455
VParameters should be escaped using :
p2456
as(dp2457
g18
V23354
p2458
stp2459
a((dp2460
g2
(lp2461
VAssuming 0=null, that is probably your best bet
p2462
aVas a minor tweak, you might want to use  when you finally copy the useful data
p2463
as(dp2464
g18
V23354
p2465
stp2466
a((dp2467
g2
(lp2468
VClickOnce simply isn't installed that way
p2469
aVThey don't typically have COM hooks (for CreateObject), and are installed in an isolated part of the user's profile (not that machine's profile)
p2470
aVAnd don't forget you can also get multiple copies/versions of the same app at once via ClickOnce (from different locations)
p2471
aVOne option (in 3
p2472
aV5/VS2008) might be to use the new file associations stuff
p2473
aVassociate your app with "
p2474
aVfoo" files, create an empty "
p2475
aVfoo" file and start it
p2476
aVThat might work
p2477
aVLook on the Publish=>Options dialog in VS2008
p2478
aVOtherwise - basically, if you want this type of usage, I suspect you will need to use msi (i
p2479
ag50
aVa regular installer; not ClickOnce) to register your app as a COM library (dll)
p2480
aVNote that
p2481
aVNET doesn't make a good COM server (exe) - so doesn't compare directly to Word
p2482
aVIf you want a
p2483
aVNET COM server, then "serviced components" are your best bet - but these don't tend to be big on UI
p2484
aVFor info, the isolated area is somewhere around "%userprofile%\u005cLocal Settings\u005cApps\u005c2
p2485
aV0", but this is just for interest so you can see it
p2486
aVdon't try running it from there
p2487
as(dp2488
g18
V23354
p2489
stp2490
a((dp2491
g2
(lp2492
VStrictly, you should avoid too much specialization within generics
p2493
aVIt would be cleaner to put any specialized logic in a member on the interface, so that any implementation can do it differently
p2494
aVHowever, there are a number of ways:
p2495
aVYou can test "obj" (assuming it is non-null)
p2496
aVYou can test T for being typeof(ImplementA):
p2497
aVLikewise you can test it for being ImplementA or a subclass:
p2498
as(dp2499
g18
V23354
p2500
stp2501
a((dp2502
g2
(lp2503
V[edit]: to clarify; this is useful in the generic LINQ /  context, where you can't use an indexer, because a: it doesn't exist on an enumerable, and b: you can't guarantee that you can read the data more than once
p2504
aVSince the OP mentions lambdas, it occurs that LINQ might not be too far away (and yes, I do realise that LINQ and lambdas are not quite the same thing)
p2505
aVIt sounds like you need the missing  operator; you can spoof it:
p2506
as(dp2507
g18
V23354
p2508
stp2509
a((dp2510
g2
(lp2511
VWithout some meaningful code, we can only guess
p2512
aVIn particular, if adding a MessageBox to the start of the Set doesn't appear, then it is likely that the problem is at the calling code (not this)
p2513
aVSome thoughts, though - especially since you have multiple threads:
p2514
aVis there a thread race somewhere
p2515
aVshould some of the code be synchronized
p2516
aVhas the worker got a stale copy of a non-volatile value
p2517
aVthread affinity: is something involving the worker and the UI borking things
p2518
aVare you sure you have the right instance (i
p2519
ag50
aVis it possible that the object firing the event isn't the same object you were listening for)
p2520
aVIt could be none of these; without some example code we can't really help
p2521
aVI've marked thread affinity in bold, as this is a very likely problem if your worker is making changes that (via an event) the UI is listening for; the UI event-handler must switch to the UI thread to update the UI:
p2522
as(dp2523
g18
V23354
p2524
stp2525
a((dp2526
g2
(lp2527
VI actually tend to prefer PascalCase here - but out of habit, I'm guilty of UPPER_CASE
p2528
as(dp2529
g18
V23354
p2530
stp2531
a((dp2532
g2
(lp2533
VString is designed for holding unicode characters; not binary
p2534
aVFor binary, use a  or
p2535
aVOr an  etc for more specialized image handling
p2536
aVDespite the name,  is actually a specialized  - i
p2537
ag50
aVit is a  that reads from a
p2538
aVImages are not text, so this isn't the right option
p2539
as(dp2540
g18
V23354
p2541
stp2542
a((dp2543
g2
(lp2544
VCall me crazy, but I'm not a fan of fighting regex; I limit my patterns to simple things I can understand, and often cheat for the rest - for example via a :
p2545
aV(edited for more terse layout)
p2546
as(dp2547
g18
V23354
p2548
stp2549
a((dp2550
g2
(lp2551
VNot really; events are, by design, a closed box
p2552
aVThere are hacky ways of getting at it, but they all require incestuous knowledge of the implementation (be it a field-like event, or an EventHandlerList, etc)
p2553
aVWhy do you need this
p2554
aVOne other approach might be to get the TextBox pdb from the MS symbol server so you can add a breakpoint (to ) and step through the TextBox code, and step into the delegate invoke
p2555
aVagain, not ideal
p2556
as(dp2557
g18
V23354
p2558
stp2559
a((dp2560
g2
(lp2561
VYou need to reference the ClientID of the control; this is the id in the final html
p2562
aVOf course, another approach might be to use some other attribute (such as the css etc), and use jQuery to find it; jQuery takes a lot of DOM pain away from javascript
p2563
aVIt is interesting that jQuery is now even supported by VS2008 (with intellisense etc)
p2564
aVI'm currently reading jQuery in Action, and liking it much
p2565
aVTo take an example straight from the book (on the subject of radios):
p2566
aVwhich returns the value of the single checked radio button in the group, or  if none is selected
p2567
aVRe getting the name; it uses the internal  property, which does a lot of mangling
p2568
aVAn option (but not an attractive one) would be to use reflection to read
p2569
aVAlternatively, use something simple like a literal control
p2570
aVGawd I hate the ASP
p2571
aVNET forms model
p2572
aVroll on MVC
p2573
aVFianlly - I'm currently looking at the public VS2010 CTP image; one of the new additions for ASP
p2574
aVNET is static s, by setting ClientIdMode = Static on the control
p2575
aVA bit overdue, but not unwelcome
p2576
as(dp2577
g18
V23354
p2578
stp2579
a((dp2580
g2
(lp2581
VI'd agree that with SQL server, using bulk load or SQL/XML is a good option
p2582
aVIf the database isn't SQL server and doesn't support xml natively, another option would be to use a basic xslt to transform the xml into csv or tsv; most databases can import delimited files
p2583
aVOf course, another question would be: why have you got 300 columns
p2584
as(dp2585
g18
V23354
p2586
stp2587
a((dp2588
g2
(lp2589
VIt looks like DataSet has already been covered, but for completeness, note that in
p2590
aVNET 3
p2591
aV5 there are good alternatives for simple data access; in particular, things like LINQ to SQL
p2592
aVThis has a similar objective, but retains a much purer simple OO model to your data classes
p2593
as(dp2594
g18
V23354
p2595
stp2596
a((dp2597
g2
(lp2598
VAFAIK, the simple answer is no
p2599
aVIf you don't mind changing your code, you could inject a wrapper object between the actual object and yours, and make your wrapper deal with serializing the wrapped object (essentially as a serialization surrogate) - but by then it would almost be easier to simply re-write the code
p2600
aVWhat sort of objects are they
p2601
aVTypically, objects for session-state would be simple data classes, so there shouldn't be too much issue serializing them
p2602
as(dp2603
g18
V23354
p2604
stp2605
a((dp2606
g2
(lp2607
VActually, to avoid a race condition, I'd be tempted to use a  here - treat concurrent access as a read lock, and exclusive access as a write lock
p2608
aVThat way, if the conditions change you won't end up with some inappropriate code still executing blindly in the region (under the false assumption that it is safe); a bit verbose, but
p2609
aV(formatted for space):
p2610
as(dp2611
g18
V23354
p2612
stp2613
a((dp2614
g2
(lp2615
VYou have 3 questions there
p2616
aVHttpContext; it actually has two public constructors - but in reality you aren't expected to use them
p2617
aVIn more general terms, you can use non-default constructors like so:
p2618
aVMissing constructor
p2619
aVFairly well covered already, but no:  /  are the simplest, but it also isn't necessary to have a public constructor
p2620
aVToBoolean
p2621
aVBehing the scenes, this will do the moral equivalent of , which simply checks for known strings - in particular "True" and "False" (using OrdinalIgnoreCase, having dealt with null/trimming/etc)
p2622
as(dp2623
g18
V23354
p2624
stp2625
a((dp2626
g2
(lp2627
VThreads count as root objects; I don't know exactly how BackgroundWorker operates, but it seems likely that the primary thread method is going to access state on the worker instance; as such, the worker thread itself will keep the BackgroundWorker instance alive until (at least) the thread has exited
p2628
aVOf course; collection also requires that all other (live) objects have de-referenced the worker object; note also that collection of stack variables can be different in debug/release, and with/without a debugger attached
p2629
aV[edit]
p2630
aVAs has also been noted; the event handlers on the worker (in your code) will keep the "view" and "update" objects alive (via the delegate), but not the other way around
p2631
aVAs long as the worker has a shorter life than the "view" and "update", you don't need to get paranoid about unsubscribing the events
p2632
aVI've edited the code to include a "SomeTarget" object that isonly referenced by the worker: you should see this effect (i
p2633
ag50
aVthe target dies with the worker)
p2634
aVRe worker getting collected when the thread dies: here's the proof; you should see "worker finalized" after the worker reports exit:
p2635
as(dp2636
g18
V23354
p2637
stp2638
a((dp2639
g2
(lp2640
VYou should be calling , which AFAIK was available in 1
p2641
ag733
aVYou probably mean "ref":
p2642
aV[edit re comments] however, this will only work for untyped objects, so not much use without generics
p2643
aVOh for C# 2
p2644
ag190
aVRe the "ref"; if the variables are truly variables (meaning: method variables), then they will go out of scope shortly and get collected
p2645
aVThe "ref" would only be useful to release fields
p2646
aVBut to be honest, it would be simpler just to set them to null
p2647
aVA typical COM pattern is:
p2648
as(dp2649
g18
V23354
p2650
stp2651
a((dp2652
g2
(lp2653
VXmlSerializer supports the  pattern, so you can add a method:
p2654
aVThere is also the  pattern - not sure if XmlSerializer supports that one
p2655
as(dp2656
g18
V23354
p2657
stp2658
a((dp2659
g2
(lp2660
VI would tend to agree with Nicolas; unless you know you need reflection, then  is a viable alternative, with the advantage that you will get the correct metadata even for runtime models (such as /)
p2661
aVFor example:
p2662
aVAs an aside, you can also do some simple performance tricks with this; you can do the same with reflection and , but there is no centralised place to hide the logic away, unlike  with a  (don't worry if these are unfamiliar; you can just use the code "as is" ;-p)
p2663
as(dp2664
g18
V23354
p2665
stp2666
a((dp2667
g2
(lp2668
VIf the handle doesn't yet exist, you can force it by subclassing the control and calling ; however, the bigger question is: why are you doing things with a form that hasn't been loaded
p2669
aVPersonally  I'd only start such an operation after Load
p2670
as(dp2671
g18
V23354
p2672
stp2673
a((dp2674
g2
(lp2675
VIf you are building your own expressions and compiling them, or using AsQueryable, then yes; the LINQ-generated methods will be a royal pain to debug
p2676
aVYou can save some pain by using small fragements of actual methods - at least something useful will show in the stack trace
p2677
aVAnother consideration is: rather than having one huge expression, if you can daisy-chain things a bit more you might have more idea (from the stack trace) where it is failing
p2678
aVThe downside is performance - a Where(foo)
p2679
aVWhere(bar) is two delegate invokes, where-as Where(foo && bar) can be one
p2680
aVOne option might be to swap in a debug version of the extension methods; unfortunately it is a little inconvenient because  and  are in the same namespace
p2681
aVthis works, though
p2682
aVOutput first:
p2683
aVCode:
p2684
as(dp2685
g18
V23354
p2686
stp2687
a((dp2688
g2
(lp2689
V[edit: at the time, the question asked about ]
p2690
aVDo you mean
p2691
aVThis uses an empty  initially, so the answer is 0
p2692
aVAnd you have no option to change it
p2693
aVWhen you first add an item, the capacity jumps to 4, then uses a doubling strategy when it fills
p2694
aVIf you mean , then it is similar (an empty , not an ), but you can initialize a known size if you need (i
p2695
ag50
aVyou know how much data you expect)
p2696
aVAgain, the first time you  to a  the size jumps to 4, then doubles every time it fills up
p2697
as(dp2698
g18
V23354
p2699
stp2700
a((dp2701
g2
(lp2702
Vjust use , or  for today's date
p2703
as(dp2704
g18
V23354
p2705
stp2706
a((dp2707
g2
(lp2708
VI'm pretty sure that anything involving other people's changes would have needed to hit the database
p2709
aVFor two-way binding, all you really need is change notification - i
p2710
ag50
aV(or a  event for every  property)
p2711
aVThis is all abstracted into  - i
p2712
ag50
aVany binding that uses the regular  implementation (which it should) will know about notifications via ,  and
p2713
aVFor validation -  is your friend; by implementing this, you can volunteer validation information (which is used and displayed by several controls, such as )
p2714
ag412
ag50
aVNote that an alternative approach would be to have a  property on the data aobject,  and bind that directly to the textbox etc
p2715
as(dp2716
g18
V23354
p2717
stp2718
a((dp2719
g2
(lp2720
VIf anything, I think it may have heightened the distinction between languages, precisely because they are so interoperable
p2721
aVThe focus now being on the language
p2722
aVThe fact that the same fundamental services and base classes are available means that you can make a sensible decision about the language based on what the language offers, rather than what the framework partnered to the language offers
p2723
aVFor example, for working with late-bound COM, I might (grudgingly) choose VB (or I might wait for C# 4
p2724
aV0)
p2725
aVFor some specific financial/simulation work, I might think seriously about F#
p2726
aVFor regular business programming my out-and-out choice would be C#
p2727
aVBut you can make these choices based on the language suitable for different blocks, and knit the completed app together from the different dlls in different languages
p2728
aVPreviously you might have had to fight with part of the code, because you have to use language x to get it to interoperate with the rest of the code
p2729
as(dp2730
g18
V23354
p2731
stp2732
a((dp2733
g2
(lp2734
VYou note that "I'm still in 2" - you might, then, want to look at LINQBridge
p2735
aVThis is actually aimed at C# 3
p2736
aV0 and
p2737
aVNET 2
p2738
aV0, but you should be able to use it with C# 2
p2739
aV0 and
p2740
aVNET 2
p2741
aV0 - just you'll have to use the long-hand:
p2742
aVOf course, it will be easier if you can switch to C# 3
p2743
aV0 (still targetting
p2744
aVNET 2
p2745
aV0)
p2746
aVAnd if LINQBridge isn't an option, you can implement it yourself:
p2747
as(dp2748
g18
V23354
p2749
stp2750
a((dp2751
g2
(lp2752
VI agree with John that  or sqlxml are the best options in SQL Server 2005; note that in SQL Server 2008 you also have table valued parameters, which would be worth consideration; especially when mixed with the new merge join
p2753
aVNote that if you use , I strongly recommend bulk inserting only to a staging table - i
p2754
ag50
aVa separate table just for the import; then run a stored procedure to move the data to the live table
p2755
aVThat way you get proper logging, and you can have a tightly scoped transaction just at the database while you run the SP (i
p2756
ag50
aVyou don't need a transaction spanning all that network IO)
p2757
aVOne other point; if you are dealing with large volumes of data, you might not want to have to load a  (since that forces you to buffer all the data in memory first); as an alternative, it is also possible to write your own  that pulls data from a stream (such as a file etc); see  here
p2758
aVwill accept data from an  very happily
p2759
as(dp2760
g18
V23354
p2761
stp2762
a((dp2763
g2
(lp2764
VThe issue with demanding a public, parameterless constructor can only be because Populate
p2765
aVGetList demands it - i
p2766
ag50
aVhas the "T : new()" constraint
p2767
aVTo fix this, simply add the same constraint to your method
p2768
aVActually, I doubt that  is a good strategy here
p2769
aVAt a push,  might do (since you don't read the value), but a far simpler (and more expected) option is a return value:
p2770
aVOf course, at that point, the caller might as well just call  directly
p2771
aVI suspect you can remove dataItem too
p2772
aVbut it isn't entirely clear from the question
p2773
aVIf you don't intend it to be generic (and dataItem is the template object), then you can do this via :
p2774
as(dp2775
g18
V23354
p2776
stp2777
a((dp2778
g2
(lp2779
VPersonally I like to use tightly scoped connections; open them late, use them, and close them (in a "using" block, all within the local method)
p2780
aVConnection pooling will deal with re-using the connection in most cases, so there is no real overhead in this approach
p2781
aVThe main advantage in passing connections used to be so that you could pass the transaction around; however,  is a simpler way of sharing a transaction between methods
p2782
aVSince the classes are implementation specific, I'd write each to open it's own native transaction
p2783
aVOtherwise, you can use the ado
p2784
aVnet factory methods to create the appropriate type from the config file (the provider name)
p2785
as(dp2786
g18
V23354
p2787
stp2788
a((dp2789
g2
(lp2790
VHow about here
p2791
aVTo implement the Ctrl / Alt / Shift detection, you can use the properties , ,  and the deprecated Navigator-specific property
p2792
as(dp2793
g18
V23354
p2794
stp2795
a((dp2796
g2
(lp2797
VFirst, I would evaluate whether a web client (ideally MVC+jQuery) can't do the job
p2798
aVAssuming a full client is warranted:
p2799
aVIf it is a business app that demands a client, I would tend to go with the full framework and ClickOnce; the main difference here (re deployment) is that the client must have the framework installed - but  past that, ClickOnce deployment is very pain free
p2800
aVActually, building a ClickOnce manifest is much easier than Silverlight etc, since the IDE will do almost all of it for you; you just have to host the files somewhere (could be a web URL; could be a network UNC)
p2801
aVThis gives you much more control (and power) at the client, as well as a far greater range of existing resources to use (for example, if you need, you can use some legacy winform code on the WPF surface)
p2802
aVThe "requires full framework" is also one of the largest benefits: "has full framework"
p2803
aVYou should also perhaps consider the 3
p2804
aV5 "client profile" setup; not sure how wide-spread this is in reality
p2805
aVbut worth knowing about
p2806
as(dp2807
g18
V23354
p2808
stp2809
a((dp2810
g2
(lp2811
VThe methodBase will be the method on the class, not the interface
p2812
aVYou will need to look for the same method on the interface
p2813
aVIn C# this is a little simpler (since it must be like-named), but you would need to consider things like explicit implementation
p2814
aVIf you have VB code it will be trickier, since VB method "Foo" can implement an interface method "Bar"
p2815
aVTo do this, you would need to investigate the interface map:
p2816
as(dp2817
g18
V23354
p2818
stp2819
a((dp2820
g2
(lp2821
VSee here and here for exmaples of working with streams and databases
p2822
aVEssentially, you need to pass repeated buffers (ideally of multiples of 8040 bytes in SQL Server)
p2823
aVNote that the examples are based on SQL 2000; with SQL 2005, varbinary(max) would be easier
p2824
aVVery similar, though
p2825
as(dp2826
g18
V23354
p2827
stp2828
a((dp2829
g2
(lp2830
V (with foreach) would indeed save the cast, but actually boxing isn't all that bad in the grand scheme of things
p2831
aVIf you have performance issues, I doubt this is the area where you can add much value
p2832
aVUse a profiler, and focus on real problems - otherwise this is premature
p2833
aVNote that if you only want to read the data once (i
p2834
ag50
aVyou are happy to consume the stack), then this may be quicker (avoids the overhead of an enumerator); YMMV
p2835
as(dp2836
g18
V23354
p2837
stp2838
a((dp2839
g2
(lp2840
VThere is one very important thing to remember with CAS: a lot of code (too much code) runs at full trust
p2841
aVAnd with full trust, most of CAS is silently ignored
p2842
as(dp2843
g18
V23354
p2844
stp2845
a((dp2846
g2
(lp2847
VBecause / accepts  (rather than a typed delegate), you need to tell the compiler what type of delegate to create ;  (2
p2848
aV0) or  (3
p2849
aV5) are common choices (note they have the same signature); like so:
p2850
aVIf you need to pass in parameters, then "captured variables" are the way:
p2851
aV(caveat: you need to be a bit cautious if using captures async, but sync is fine - i
p2852
ag50
aVthe above is fine)
p2853
aVAnother option is to write an extension method:
p2854
aVthen:
p2855
aVYou can of course do the same with :
p2856
aVIf you can't use C# 3
p2857
aV0, you could do the same with a regular instance method, presumably in a  base-class
p2858
as(dp2859
g18
V23354
p2860
stp2861
a((dp2862
g2
(lp2863
VI wonder if you couldn't use the regular / here
p2864
aVIf not, then a wait handle (such as a ) might be an option:
p2865
aVNote that you can do this just using object if you really want:
p2866
as(dp2867
g18
V23354
p2868
stp2869
a((dp2870
g2
(lp2871
VThere isn't really a way to do it any quicker - but what you can do is do it less often by caching the data
p2872
aVA generic utility class can be a handy way of doing this, for example:
p2873
aVThen your PropertyCache
p2874
aVCache has the data just for Foo, etc - with lazy population
p2875
aVYou could also use a static constructor if you prefer
p2876
as(dp2877
g18
V23354
p2878
stp2879
a((dp2880
g2
(lp2881
VYes, that is fully possible (i
p2882
ag50
aVI do exactly this); you just need to reference the right dll (System
p2883
aVServiceProcess
p2884
aVdll) and add an installer class
p2885
aVHere's an example
p2886
as(dp2887
g18
V23354
p2888
stp2889
a((dp2890
g2
(lp2891
VOne other option (in
p2892
aVNET 4
p2893
aV0, or with the CTP) would be a form of
p2894
aVNot necessarily viable yet, though
p2895
aVI also saw a good blog entry (can't remember by who) that used  here - i
p2896
ag50
aVwhere the Dispose() method did a join on the thread that was spawned - i
p2897
ag50
aVwhen you exited the block, all are complete
p2898
aVQuite cute
p2899
as(dp2900
g18
V23354
p2901
stp2902
a((dp2903
g2
(lp2904
VNot about measuring - but about improving: I've been working on protobuf-net, an implementation of Google's "protocol buffers" (a compact, low-CPU binary serialization format) for use with
p2905
aVNET - including a WCF hook (to replace the DataContractSerializer)
p2906
aVIt has some pretty good metrics re serialization
p2907
aVWhen used with the basic http binding, it also works with MTOM, so you don't even get the base-64 overhead of binary
p2908
aVThere is a WCF sample here
p2909
aVIt might be of interest
p2910
as(dp2911
g18
V23354
p2912
stp2913
a((dp2914
g2
(lp2915
VClosures are simply great tools
p2916
aVWhen to use them
p2917
aVAny time you like
p2918
aVAs has already been said, the alternative is to write a class; for example, pre C# 2
p2919
aV0, creating a parameterised thread was a real struggle
p2920
aVWith C# 2
p2921
aV0 you don't even need the `ParameterizedThreadStart' you just do:
p2922
aVCompare that to creating a class with a name and value
p2923
aVOr likewise with searching for a list (using a lambda this time):
p2924
aVAgain - the alternative would be to write a class with two properties and a method:
p2925
aVThis is fairly comparable to how the compiler does it under the bonnet (actually, it uses public read/write fields, not private readonly)
p2926
aVThe biggest caveat with C# captures is to watch the scope; for example:
p2927
aVThis might not print what you expect, since the variable i is used for each
p2928
aVYou could see any combination of repeats  - even 10 10's
p2929
aVYou need to carefully scope captured variables in C#:
p2930
aVHere each j gets captured separately (i
p2931
ag50
aVa different compiler-generated class instance)
p2932
aVJon Skeet has a good blog entry covering C# and java closures here; or for more detail, see his book C# in Depth, which has an entire chapter on them
p2933
as(dp2934
g18
V23354
p2935
stp2936
a((dp2937
g2
(lp2938
VAre you sure one isn't the
p2939
aVBut you are responsible for creating all constructors in a ; have you perhaps called  in addition to
p2940
aVThis would create an empty default constructor
p2941
aVso if you don't want an empty constructor, don't call this
p2942
as(dp2943
g18
V23354
p2944
stp2945
a((dp2946
g2
(lp2947
VI'd say that things like DevelopMentor are fine
p2948
aVRe your distinction between the "enthusiastic" versus "average" developer
p2949
aVin many ways the "enthusiastic" developer can  accomplish nearly as much from blogs/trying-it/books/RTFM
p2950
aVSo in many ways courses are more useful for the (in your words) "average" developer who needs to be taken away from things to focus on it
p2951
as(dp2952
g18
V23354
p2953
stp2954
a((dp2955
g2
(lp2956
VFirst, you need to ensure that query string options are enabled (project properties=>publish=>options=>manifests=>allow url parameters
p2957
aV;
p2958
aVThen - to allow parity between standalone and web, I use something like below (the important bit is ; you'll need a reference to  too)
p2959
aVYou could also look at , which MSDN has a good example for here
p2960
as(dp2961
g18
V23354
p2962
stp2963
a((dp2964
g2
(lp2965
VWell, given that they are getting different TextTypeId values, how would you prefer the TSQL to look
p2966
aVIf you do a single JOIN, you'll have to put in a messy  or similar to discriminate between type "1" and type "2"
p2967
aVOne option would be to to simply bring back all the suitable rows and do the final projection in-memory at the client, but to be honest I expect that the SQL optimizer will make light work of that TSQL anyway
p2968
aVespecially if that query hits a good spanning index
p2969
as(dp2970
g18
V23354
p2971
stp2972
a((dp2973
g2
(lp2974
VAssuming that the process writes errors to stderr/stdout, you could set UseShellExecute to false, and redirect stdout/stderr; there is an example on MSDN here (stderr) and here (stdout)
p2975
aVIf you need to read from both stderr and stdout, and use , then things get more interesting - usually involving either a few threads, or async methods
p2976
aVOne other final option is to use pipe redirection in the command - i
p2977
ag50
aV- this pipes stdout into out
p2978
aVtxt, and pipes stderr into stdout, so this also goes into out
p2979
aVtxt
p2980
aVThen read from
p2981
as(dp2982
g18
V23354
p2983
stp2984
a((dp2985
g2
(lp2986
VAssuming that you are using regular
p2987
aVNET (not CF/Silverlight, etc) Accessing files in the user's temp area is entirely expected
p2988
aVI wonder if the problem isn't more that you've accidentally left the file open after creating it, perhaps by not using a "using" or similar
p2989
aVI probably wouldn't suggest using environment variables (%TEMP% etc) when shelling out to a separate process; ideally you'd pass the full path to the file (less things to get wrong
p2990
aV, making sure to quote any path arguments (in case of space) - i
p2991
ag50
aVso your args are @"
p2992
aV""c:\u005csome path\u005cwhatever\u005ctmp""
p2993
aV(if you see what I mean)
p2994
aVFinally, if you are extracting files, you need to think about the existing contents
p2995
aVis fine for creating a single file place-holder, but for extracting an archive you probably want to create a directory - guids are handy for this purpoes (while avioding conflicts, and remember to remove it afterwards):
p2996
as(dp2997
g18
V23354
p2998
stp2999
a((dp3000
g2
(lp3001
VI don't know if it is any better, but I've just been looking at something similar using threads to read both stderr/stdout, like below
p3002
aVIt involves a few extra threads (to avoid deadlocks / complex async code), but seems to work pretty robustly
p3003
aVThe key here is that I  on the two threads handling IO, so I only move on once both output streams have been fully consumed
p3004
as(dp3005
g18
V23354
p3006
stp3007
a((dp3008
g2
(lp3009
VNot really
p3010
aVFor this level of digging you'd probably need something like WinDbg
p3011
aVIf a specific variable is of interest, you can add it to the exception yourself (although even this introduces issues with duplicate keys, re-entrancy, etc):
p3012
as(dp3013
g18
V23354
p3014
stp3015
a((dp3016
g2
(lp3017
V is an oddity; regular xml-serialization doesn't normally work - hence you often need to add your own code, perhaps via :
p3018
aVOutputs:
p3019
as(dp3020
g18
V23354
p3021
stp3022
a((dp3023
g2
(lp3024
VWell,  will give you the method being invoked  but in the case of anonymous methods / lambdas: no, not really
p3025
aVThe compiler-generated names are fairly unintelligible, and you can't easily parse a delegate's IL
p3026
aVYour best bet might be to include an optional string argument (for blame purposes; if omitted, use the )
p3027
as(dp3028
g18
V23354
p3029
stp3030
a((dp3031
g2
(lp3032
VProcess
p3033
aVStart
p3034
aVNote that advanced uses (printing etc) require using a ProcessStartInfo and setting the Verb property
p3035
as(dp3036
g18
V23354
p3037
stp3038
a((dp3039
g2
(lp3040
VWith a given class
p3041
aVIf it is just the one class, then you should be able to do something like
p3042
aVSelectNodes("//*[@class='foo']")
p3043
aVIf it isn't xhtml, then the HTML Agility Pack is worth looking at
p3044
aVAt the client, jQuery would be a good option - and supports composite class names
p3045
aVIf you have multiple class names on individual elements, and need to handle it at the server, I expect you might need to find the candidate classes first ("//*[@class
p3046
aV='']), and then loop over them doing a  and checking for the class-name in the results; i
p3047
ag50
aVpull it apart manually
p3048
aVIn LINQ terms, something like:
p3049
as(dp3050
g18
V23354
p3051
stp3052
a((dp3053
g2
(lp3054
VIf it ain't broke, don't fix it
p3055
aVOf course, if you have confidence in your unit tests, you can give it a whirl, but you shouldn't really go randomly changing code "just because"
p3056
aVOf course - in some cases, simplifying code is a valid reason to make a change - but even something as innocent as switching to an auto-implemented property could break code that makes assumptions and uses reflection to update the fields directly
p3057
aVOr it could break serialization
p3058
aVChanging to "var" can actually give you a different (more specific) type, which might cause a different method overload to get selected, etc
p3059
aVSo again; it comes down to your confidence in the unit tests
p3060
aVOther considerations:
p3061
aVdoes the rest of the team understand the new syntax yet
p3062
aVdoes your project need to support C# 2
p3063
aV0 (for example, some open source projects might want to retain compatibility with C# 2
p3064
aV0)
p3065
aVIf neither of these are an issue, you should be OK to use the new features in new code
p3066
aVjust be a little cautious before hitting "update all" on old code
p3067
aVHere's a trivial example of "var" as a breaking change:
p3068
aVNow switch to  on the line marked
p3069
as(dp3070
g18
V23354
p3071
stp3072
a((dp3073
g2
(lp3074
VNo; I do not believe that it is; if you want it cached, you must hold onto the  reference (typically  or )
p3075
aVLikewise, if you want to get the best performance, you would compile it as a parameterised expression, so you can send in different values when you invoke it
p3076
aVIn this case, re-phrasing would help:
p3077
ag412
ag50
aVmake the numbers parameters of the expression, and pass the actual ones it at runtime (rather than being constants in the expression)
p3078
as(dp3079
g18
V23354
p3080
stp3081
a((dp3082
g2
(lp3083
VFor extensibility reasons,  is very forgiving when it comes to deserialization; things like ,  and  are mainly used during serialization (the exception being , which is set during deserialization as well as queried during serialization)
p3084
aVAs such; there isn't an easy way to do this, unless you implement  and do it yourself
p3085
aVdamagednoob shows an xsd option, which is also an option
p3086
as(dp3087
g18
V23354
p3088
stp3089
a((dp3090
g2
(lp3091
VWhat is the volume of data here
p3092
aVFor it to hang up the UI it must be non-trivial
p3093
aVOne extreme answer would be to switch to virtual mode - but that is a lot of work
p3094
aVIf you simply don't want to hang the UI, perhaps just do the first x (20
p3095
aV50
p3096
aVrows immediately, and do the remainder in batches - essentially emulating , just without the code-smell of
p3097
aV(untested)
p3098
as(dp3099
g18
V23354
p3100
stp3101
a((dp3102
g2
(lp3103
VCan you clarify : are you asking specifically about WebServiceHostFactory (emph: "Web")
p3104
aVOr just the  difference between IIS hosting it vs starting your own server through code
p3105
aVWebServiceHostFactory is new in
p3106
aVNET 3
p3107
aV5, and supports some of the newer AJAX/JSON stuff
p3108
aVActually, within IIS (using
p3109
aVsvc), you are already using a ServiceHostFactory - simply the default one shipped with WCF
p3110
aVYou can write your own factory if you want, and I've done this in the past to create a factory that only listens on https (I had an issues on a farm hosting multiple sites, where it couldn't identify the correct site for http, but https was fine - so I completely disabled http via the factory)
p3111
aVPerformance shouldn't be any different as long as you don't go mad and listen on 200 end-points
p3112
aVGenerally, manually creating the server is used when you are hosting the server in (for example) a windows service
p3113
aVIIS is fine for some things, but app-pools get recycled, so aren't ideal for a server that needs to retain long-lived state
p3114
aVIIS has the advantage of being much easier to configure, especially with security (SSL etc) and compression
p3115
as(dp3116
g18
V23354
p3117
stp3118
a((dp3119
g2
(lp3120
VAn alternative approach is an extension method:
p3121
aVthen call:
p3122
aVThe  pervents us accidentally boxing ints etc
p3123
aVRe AOP; Jon Skeet has a sample for something similar here - but covering a single method/parameter
p3124
aVHere's the aspect reproduced; note that this aspect covers only 1 argument at a time, and is method-specific, but in general I'd argue that this is perfectly reasonable
p3125
aVhowever, you could probably change it
p3126
as(dp3127
g18
V23354
p3128
stp3129
a((dp3130
g2
(lp3131
VWhat is the specific load balancer
p3132
aVUsing an F5 BIG-IP we got it working fairly easily, but we were using the same port and (relative) uri on the nlb as individual machines (so we can treat an individual machine the same as the farm if we choose)
p3133
aVObviously each machine has a different name, but this setup also allows you to test individual servers by spoofing the host - for example, by editing your HOSTS file to point [your farm name] to [test server IP]
p3134
aVThe biggest pain we had was SSL; using TransportWithMessageCredential security, WCF refuses inbound http connections - so we had to set up the nlb to re-encrypt between the nlb and the server node - but not a biggie
p3135
aVThe only other issue we had was with hosting WCF inside IIS, and WCF not being able to correctly identify the intended site (although IIS was fine) over http (but fine over https)
p3136
aVTo fix this I wrote a custom factory that simply ignored http completely (only listened on https) - which ties in neatly with the TransportWithMessageCredential requirements anyway, so I wasn't bothered by this
p3137
aVI wonder if you wouldn't get more joy by hosting on a standard port but as a different site (IP/host-header/etc)
p3138
as(dp3139
g18
V23354
p3140
stp3141
a((dp3142
g2
(lp3143
VWCF is a curious beast that lives slightly outside of regular IIS; it may be that the standard debugging gets glitchy
p3144
aVHowever, you could try enabling debug exceptions, and/or implementing (and configuring) your own  to log the issues
p3145
aVAnother option: is there perhaps an iterator block () somewhere in the mix here
p3146
aVNothing in an iterator block is evaluated until the enumerator is iterated, which can lead to some odd looking issues with data that should have been validated earlier
p3147
aVIn the case above, this isn't an issue (no ), but it is one to watch
p3148
aVFor example, the following is very different:
p3149
as(dp3150
g18
V23354
p3151
stp3152
a((dp3153
g2
(lp3154
VIf you are catching a , you should have access to , which gives you the SQL error number; this is probably your best approach
p3155
aV(you can get the same from the  event as well for non-fatal errors)
p3156
aVOf course, this won't distinguish between tables - you could argue that if you need this level of granularity, you should check first (in a serializable isolation level, ideally with UPDLOCK), raising your own error if there is conflicting data
p3157
as(dp3158
g18
V23354
p3159
stp3160
a((dp3161
g2
(lp3162
VAdd a , and then:
p3163
aVThen look at the various properties of :
p3164
aVetc
p3165
as(dp3166
g18
V23354
p3167
stp3168
a((dp3169
g2
(lp3170
VYou can't do implict conversions (except for zero), and you can't write your own instance methods - however, you can probably write your own extension methods:
p3171
aVThis doesn't give you a lot, though (compared to just doing an explicit cast)
p3172
aVOne of the main times I've seen people want this is for doing  manipulation via generics - i
p3173
ag50
aVa  method
p3174
aVUnfortunately, C# 3
p3175
aV0 doesn't support operators on generics, but you can get around this using things like this, which make operators fully available with generics
p3176
as(dp3177
g18
V23354
p3178
stp3179
a((dp3180
g2
(lp3181
VHow about an extension method that calls the actual () implementation
p3182
aVThe only downside is you have to add
p3183
aVThis works because the  parameter (via ) infers a type for
p3184
aVAs an alternative (if the  is a pain), consider making it static, with an instance argument that is used primarily for type inference:
p3185
as(dp3186
g18
V23354
p3187
stp3188
a((dp3189
g2
(lp3190
VOne other observation; if you aren't using typed datasets, you might also want to know about the  extension method:
p3191
aVOr using the query syntax:
p3192
aVI'm not saying it is better or worse - just another viable option
p3193
aV(Actually, I don't use  very much, so YMMV)
p3194
as(dp3195
g18
V23354
p3196
stp3197
a((dp3198
g2
(lp3199
V[edit - if it was me, I'd look at adzm's answer ;-p]
p3200
aVAs I understand it, regular TWAIN is a "pull", not a "push" from the scanner
p3201
aVI could well be wrong
p3202
aVI expect such interfaces do exist for high end, high volume scanners (you know, the ones the size of a billiard table) - but not (AFAIK) for regular consumer scanners
p3203
aVFor use with
p3204
aVNET (and before that, COM), I've always managed with ImageMan
p3205
as(dp3206
g18
V23354
p3207
stp3208
a((dp3209
g2
(lp3210
VI don't know anything about the tool in question, but (assuming it isn't a limitation of the tool) I really doubt the wisdom of public fields
p3211
aVProperties would also give you the opportunity to shim the values:
p3212
aVAgain - I have no idea if the tool would support this, but it would be a viable way of implementing it
p3213
aVOf course, the "h" values would do just as well (actually, slightly more efficient - no array on the heap and no de-reference) as direct members:
p3214
as(dp3215
g18
V23354
p3216
stp3217
a((dp3218
g2
(lp3219
VThis sounds like a deadlock; this would typically happen if the thread calling
p3220
aVInvoke already held a lock / mutex / etc which the UI thread needs to complete it's work
p3221
aVThe simplest approach would be to use BeginInvoke instead: that way, the current thread can keep running, and will (presumably) release the lock shortly - allowing the UI to aquire it
p3222
aVAlternatively, if you can identify the offending lock, you could deliberately release it for a duration
p3223
as(dp3224
g18
V23354
p3225
stp3226
a((dp3227
g2
(lp3228
VWell, ignoring the dashes is fairly innocent
p3229
aVIf you want to include them, perhaps use  in the overload
p3230
aVReading the docs for , it uses word sort rules, which from here means :
p3231
aVWord sort performs a culture-sensitive
p3232
aVcomparison of strings
p3233
aVCertain
p3234
aVnonalphanumeric characters might have
p3235
aVspecial weights assigned to them
p3236
aVFor
p3237
aVexample, the hyphen ("-") might have a
p3238
aVvery small weight assigned to it so
p3239
aVthat "coop" and "co-op" appear next to
p3240
aVeach other in a sorted list
p3241
aVAt least it is transitive: I logged a bug with "connect" about something very similar involving dashes - where A < B, B < C and C < A
p3242
aVsince a non-transitive comparison essentially breaks the rules of sorting
p3243
aVIt was closed "will not fix"
p3244
aVHere it is:
p3245
aV(returns 1,1,-1 on my machine)
p3246
as(dp3247
g18
V23354
p3248
stp3249
a((dp3250
g2
(lp3251
VNo, there is no copy-constructor equivalent in C#
p3252
aVWhat you are passing (by value) is a reference
p3253
aVis also risky, since it is poorly defined whether that is deep vs shallow (plus it isn't very well supported)
p3254
aVAnother option is to use serialization, but again, that can quickly draw in much more data than you intended
p3255
aVIf the concern is that you don't want the method making changes, you could consider making the class immutable
p3256
aVThen nobody can do anything nasty to it
p3257
as(dp3258
g18
V23354
p3259
stp3260
a((dp3261
g2
(lp3262
VWell, one obvious answer would be when you need to support clients without the SP that it ships in (it isn't actually in 3
p3263
aV5 - it is in 2
p3264
aV0 SP1, which shipped at the same time)
p3265
as(dp3266
g18
V23354
p3267
stp3268
a((dp3269
g2
(lp3270
VNET does not have enforced ("checked") exceptions like java
p3271
aVThe intellisense might show this information, if the developer has added a  block - but ultimately more exceptions can happen than you expect (, , , etc can all happen fairly unpredictably)
p3272
aVIn general, you should have an idea of what things are likely to go wrong, and which ones you can actually do something useful about
p3273
aVIn most cases, the correct behaviour is to let the exception bubble up (just running any "finally" code to release resources)
p3274
aVEric Lippert has a good blog on this subject here
p3275
as(dp3276
g18
V23354
p3277
stp3278
a((dp3279
g2
(lp3280
VGiven the description, the best I can suggest is to manually track the image key/index in the
p3281
aVTag of the cell, and then run your distinct count on the
p3282
aVTag
p3283
aVAlternatively, if you also have the data in a list/collection, count the data from the original source
p3284
aV[update following reply]
p3285
aVSince the data is data-bound, you should be able to iterate the  of the , obtaining the  of each
p3286
aVThen for each underlying object, you should be able to obtain the actual property value using :
p3287
aVThat any help
p3288
as(dp3289
g18
V23354
p3290
stp3291
a((dp3292
g2
(lp3293
VNot really; since the number of arguments isn't fixed, there isn't really a better way of doing it
p3294
aVThe problem with regular tuples is that you are still working positionally - just with "
p3295
aVValue0" instead of "[0]"
p3296
aVAnd anonymous types can't be directly exposed in an API
p3297
aVOf course, you could subsequently wrap the values in your own class with properties, and just do a projection:
p3298
aV(where Foo is your class that represents whatever this result is, with named, typed properties)
p3299
aVAlternatively you could throw them into a dictionary, but this doesn't help the caller any more than an array does
p3300
aVThe only other option is something really grungy like accepting a params array of  that you use to assign each
p3301
aVI'll elaborate on the last just for fun - I don't suggest you do this:
p3302
as(dp3303
g18
V23354
p3304
stp3305
a((dp3306
g2
(lp3307
VEven if you can't use
p3308
aVNET 3
p3309
aV5 yet, the C# 3
p3310
aV0 language features (especially if you use LINQBridge) are well worth it
p3311
aVIt also has better support for WCF etc (since you mention 3
p3312
aV0 - this is a kludge in VS2005)
p3313
aVAdd to that the IDE improvements, and it is a no-brainer IMO
p3314
as(dp3315
g18
V23354
p3316
stp3317
a((dp3318
g2
(lp3319
VIs this error on your dev machine when building (which is what it looks like)
p3320
aVOr on the target machine when installing
p3321
aVIf the former: do what it says: add the required reference; References->Add Reference->System
p3322
aVConfiguration
p3323
aVInstall
p3324
aVIt should already be installed in the GAC of the target machine, so there shouldn't be anything else to do
p3325
as(dp3326
g18
V23354
p3327
stp3328
a((dp3329
g2
(lp3330
VWell, something is going to have to look, and looping is more efficient than recursion (since tail-end recursion isn't fully implemented)
p3331
aVso if you just don't want to loop yourself, then either of:
p3332
aVor
p3333
aVFor info: avoid names like var - this is a keyword in C# 3
p3334
ag190
as(dp3335
g18
V23354
p3336
stp3337
a((dp3338
g2
(lp3339
VIs this a web site project, or a web application project
p3340
aVWith the latter, references are handled via the
p3341
aVcsproj - i
p3342
ag50
aVvia the "References" node in Solution Explorer
p3343
as(dp3344
g18
V23354
p3345
stp3346
a((dp3347
g2
(lp3348
VEven with
p3349
aVNET 2
p3350
aV0, you could get the same with LINQBridge
p3351
aVThis will be easier to use with C# 3
p3352
aV0 (even with
p3353
aVNET 2
p3354
aV0), but should be usable with C# 2
p3355
aV0 and
p3356
aVNET 2
p3357
aV0 - you'd simply have to use Enumerable
p3358
aVDistinct(x) rather than x
p3359
aVDistinct();
p3360
aVOf course, ultimately these are just pre-wrapped versions of the code you posted earlier (give-or-take things like iterator blocks), so you could just push that code into a utility class and (re)use it from there
p3361
as(dp3362
g18
V23354
p3363
stp3364
a((dp3365
g2
(lp3366
VEssentially, which-ever makes the code simpler
p3367
aVSingle point of exit is a nice ideal, but I wouldn't bend the code out of shape just to achieve it
p3368
aVAnd if the alternative is declaring a local variable (outside the lock), initializing it (inside the lock) and then returning it (outside the lock), then I'd say that a simple "return foo" inside the lock is a lot simpler
p3369
aVTo show the difference in IL, lets code:
p3370
aV(note that I'd happily argue that  is a simpler/cleaner bit of C#)
p3371
aVAnd look at the IL (release mode etc):
p3372
aVSo at the IL level they are [give or take some names] identical (I learnt something ;-p)
p3373
aVAs such, the only sensible comparison is the (highly subjective) law of local coding style
p3374
aVI prefer  for simplicity, but I wouldn't get excited about either
p3375
as(dp3376
g18
V23354
p3377
stp3378
a((dp3379
g2
(lp3380
VWoah there
p3381
aVDon't mess with the ThreadPool count unless you know what you are doing - lots of essential
p3382
aVNET services may be using that, and relying on it not being saturated
p3383
aVYou've almost certainly deadlocked some of the basic IO code through saturation
p3384
aVI would imagine that it is the IO completion ports that are tripping you up in this particular case
p3385
aVJoe Duffy (who knows more about threading than I ever will) has some thoughts on this here
p3386
aVRe how to deadlock it through saturation - that is simple to reproduce in a thought experiment; assume you have a bit of worker code that needs to do 2 things
p3387
aVwe'll push 1 of them onto the ThreadPool, and do one ourself; after doing our own work we'll Join() [or the ThreadPool equivalent] the second task so that we know both have finished
p3388
aVNow imagine that we start this worker code on the last available ThreadPool thread: we do our own work, and then wait for a signal that the 2nd task has finished - but there are no threads available to do it on
p3389
aVAnd we can't release our own, as we're still waiting
p3390
aVYou can do the same with IO completion ports
p3391
as(dp3392
g18
V23354
p3393
stp3394
a((dp3395
g2
(lp3396
VThe closest you can get in C# 3
p3397
aV0 is to have a separate  method (like your  method) that does the actual work and can be overridden, then use  to re-declare the public method
p3398
ag412
ag50
aVin the base:
p3399
aVand in the subclass:
p3400
as(dp3401
g18
V23354
p3402
stp3403
a((dp3404
g2
(lp3405
VPreamble: note that adding a "new"  doesn't stop people calling the old  simply by casting
p3406
aVAlso, in terms of "mex", that is a very vague data-contract - does it need to be so open-ended
p3407
aV(lots of  etc
p3408
aVFirst: haven't you missed a few / markers there
p3409
aVIn particular:
p3410
aVResultClass
p3411
aVValue
p3412
aVParamData
p3413
aVParamData
p3414
aVValue
p3415
aVParameterClass
p3416
aVData
p3417
aVCan you clarify exactly which version of
p3418
aVNET you are using
p3419
aVetc have been tweaked via service packs
p3420
aVWith 3
p3421
aV5 SP1 installed (the only thing I have to hand) it does at least serialize and deserialize via  (no WCF stack), and the correct  method is called
p3422
aVCan you check whether the following works with your local version
p3423
aV(it works for me with 3
p3424
aV5 SP1 and with the missing attributes) [output first]:
p3425
aVCode:
p3426
aVObviously this just tests  (without the entire WCF stack), but it seems to work
p3427
aVso: does the same code work with your local version of
p3428
aVNET
p3429
aVIf not, is installing the latest 3
p3430
aV0 service pack an option
p3431
aV(ideally via installing 3
p3432
aV5 SP1)
p3433
aVFor info, I get xml:
p3434
as(dp3435
g18
V23354
p3436
stp3437
a((dp3438
g2
(lp3439
VCan you please clarify whether this is winforms vs webforms
p3440
aVBoth have a
p3441
aVFrom the  I'm assuming winforms
p3442
aVWould  be a pragmatic option
p3443
aVThis will support multi-column binding out of the box
p3444
as(dp3445
g18
V23354
p3446
stp3447
a((dp3448
g2
(lp3449
V[update: kudos to Corbin March, who (in the same time) wrote the same, but in code
p3450
aVMost streams are one way
p3451
aVI imagine you'd have to:
p3452
aVcreate a  reading from the (file etc)
p3453
aVread the data (for example into )
p3454
aVdo your code (read the document, make changes, etc)
p3455
aVcrate a new  writing to the (file etc) [starting with the same IV etc)
p3456
aVsave the docuemnt to the stream
p3457
aVDepending on what the underlying stream is (, , etc) you may well also have to completely close/re-open it between the read and write (i
p3458
ag50
aVthe  will probably feel ownership of the base-stream, and will  it)
p3459
as(dp3460
g18
V23354
p3461
stp3462
a((dp3463
g2
(lp3464
VThis is a limitation of
p3465
aVNote that  and  do not require this - they can create an uninitialized object out of the ether and initialize it during deserialization
p3466
aVSince you are using xml, you might consider using  and marking your class with /], but note that this changes the schema (for example, there is no equivalent of  - everything becomes elements)
p3467
aVUpdate: if you really want to know,  et al use  to create the object without invoking the constructor
p3468
aVProbably dangerous; I don't recommend using it too often ;-p See also the remarks on MSDN:
p3469
aVBecause the new instance of the object
p3470
aVis initialized to zero and no
p3471
aVconstructors are run, the object might
p3472
aVnot represent a state that is regarded
p3473
aVas valid by that object
p3474
aVThe current
p3475
aVmethod should only be used for
p3476
aVdeserialization when the user intends
p3477
aVto immediately populate all fields
p3478
aVIt
p3479
aVdoes not create an uninitialized
p3480
aVstring, since creating an empty
p3481
aVinstance of an immutable type serves
p3482
aVno purpose
p3483
aVI have my own serialization engine, but I don't intend making it use ; I quite like knowing that a constructor (any constructor) has actually executed
p3484
as(dp3485
g18
V23354
p3486
stp3487
a((dp3488
g2
(lp3489
VIt sounds like your collection implements , not , hence you need:
p3490
aVNote that  is defined on , not  - if you have the non-generic type, you need to use  (or ) to get the right type
p3491
aVThe difference being that  will throw an exception if it finds something that isn't a , where-as  simply ignores anything that isn't a
p3492
aVSince you've stated that your collection only contains , it is reasonable to check that assumption using , rather than silently drop data
p3493
aVCheck also that you have "using System
p3494
aVLinq" (and are referencing System
p3495
aVCore (
p3496
aVNET 3
p3497
aV5; else LINQBridge with
p3498
aVNET 2
p3499
aV0) to get the  extension method(s)
p3500
aVActually, it would be worth having your collection implement  - which you could do quite simply using either the  method, or an iterator block ()
p3501
aV[edit]
p3502
aVTo build on Richard Poole's note - you could write your own generic container here, presumably with  (and using that  in the , and implementing  or )
p3503
aVJust a thought
p3504
as(dp3505
g18
V23354
p3506
stp3507
a((dp3508
g2
(lp3509
VNot that I know of
p3510
aVNote that if you do add a variable, it will get removed by the compiler in release builds anyway
p3511
aVThis function has been added to VS2013 where you are able to see all the return values in the autos window (only limited support for structs) or by using  in the immediate window
p3512
as(dp3513
g18
V23354
p3514
stp3515
a((dp3516
g2
(lp3517
VThe expected API is to add via the two argument  method (or the  indexer); as such, it uses explicit interface implementation to provide the  method
p3518
aVIf you use the  interface instead, you will have access to the missing method (since you can't hide anything on an interface)
p3519
aVAlso, with the collection initializer, note that you can use the alternative syntax:
p3520
aVwhich uses the  method
p3521
as(dp3522
g18
V23354
p3523
stp3524
a((dp3525
g2
(lp3526
VThere are precious few immutable collections in the current framework
p3527
aVI can think of one relatively pain-free option in
p3528
aVNET 3
p3529
aV5:
p3530
aVUse  - the  class is immutable (but multi-valued on the rhs); you can do this from a  quite easily:
p3531
as(dp3532
g18
V23354
p3533
stp3534
a((dp3535
g2
(lp3536
VI don't think there are any public/protected methods that would let you get at this directly
p3537
aVYou'd probably have to use reflection, like I did about 3 messages down here, looking at the  property of the
p3538
aVVery ugly, I'm afraid
p3539
as(dp3540
g18
V23354
p3541
stp3542
a((dp3543
g2
(lp3544
VAttributes are a compile-time feature (unless you are dealing with ComponentModel - but I suspect it is using reflection)
p3545
aVAs such, you cannot add attributes at runtime
p3546
aVIt would a similar question to "how do I add an extra method to a type at runtime
p3547
aVIn regular C# /
p3548
aVNET (pre-DLR), you can't
p3549
as(dp3550
g18
V23354
p3551
stp3552
a((dp3553
g2
(lp3554
VThis might be nave, but how about:
p3555
aVAlso - aren't you missing the final  (you state double-null-terminated) in
p3556
aVAnd it might be easier to call if the array was a  array - something like:
p3557
aV[edited after clarification about final \u005c0]
p3558
as(dp3559
g18
V23354
p3560
stp3561
a((dp3562
g2
(lp3563
VFrom MSDN ():
p3564
aVIf you provide an open connection, the
p3565
aVDataContext will not close it
p3566
aVTherefore, do not instantiate a
p3567
aVDataContext with an open connection
p3568
aVunless you have a good reason to do
p3569
aVthis
p3570
aVSo basically, it looks like your connections are waiting for GC to finalize them before they will be released
p3571
aVIf you have lots of code that does this, one approach might be to overide  in the data-context's partial class, and close the connection - just be sure to document that the data-context assumes ownership of the connection
p3572
aVPersonally, I would happily give it (regular data-context, w/o the hack above) an open connection as long as I was "using" the connection (allowing me to perform multiple operations) - i
p3573
ag50
as(dp3574
g18
V23354
p3575
stp3576
a((dp3577
g2
(lp3578
VAs already stated, it doesn't set values
p3579
aVIn addition to the ,  is also used by various serializer implementations, such as  and
p3580
aVFor info, there is also a second pattern:  that is respected by all 3
p3581
as(dp3582
g18
V23354
p3583
stp3584
a((dp3585
g2
(lp3586
VIn terms of read performance, there are two factors:
p3587
aVan extra dereference (i
p3588
ag50
aVthe  will contain a  field, and has to de-reference it)
p3589
aVit can't use some compiler optimisations that that exist for  - such as eliminating bounds checking during loops
p3590
aVHowever, it is much easier to add to a , in particular because it retains spare space - i
p3591
ag50
aVit doesn't have to resize/blit the entire array just to add a single element
p3592
as(dp3593
g18
V23354
p3594
stp3595
a((dp3596
g2
(lp3597
VYou can do it, but it isn't CLS compliant:
p3598
aVShows:
p3599
aVor regular reflection usage, it may be preferable to have multiple attributes, i
p3600
ag50
aVHowever, this won't work with /, where only a single instance of any attribute is supported (either the first or last wins, I can't recall which)
p3601
as(dp3602
g18
V23354
p3603
stp3604
a((dp3605
g2
(lp3606
VYou need to  the  after adding all the data you want to compress; it retains a buffer of unwritten bytes internally (even if you ) that needs to be written
p3607
aVMore generally,  is , so you should also be  each
p3608
aV(yes, I know that  isn't going to lose any data, but if you don't get into this habit, it will bite you with other s)
p3609
aV[edit : updated re comment]
p3610
aVRe not  things like  - this is always a fun one, with lots of votes on either side of the fence: but ultimatey
p3611
aV(rhetorical - we all know the answer
p3612
aVHow is  implemented
p3613
aVis it a byte[] (owned by
p3614
aVNET)
p3615
aVis it a memory-mapped file (owned by the OS)
p3616
aVThe reason you aren't  it is because you are letting knowledge of internal implementation details change how you code against a public API - i
p3617
ag50
aVyou just broke the laws of encapsulation
p3618
aVThe public API says: I am ; you "own" me; therefore, it is your job to  me when you are through
p3619
as(dp3620
g18
V23354
p3621
stp3622
a((dp3623
g2
(lp3624
VOK, that's an interesting one
p3625
aVI've seen similar issues with serializers, but not with  specifically
p3626
aVFrom the title, I was expecting it to be an issue loading included/imported transforms, which would probably have been fixable by supplying an
p3627
aVNot finding the self-generated dlls is very odd
p3628
aVAs a stop-gap (while you investigate the issue), you might want to see if it still happens with
p3629
aVI realise this isn't ideal (given the optimisations etc in ), but it might at least let your app work while you investigate
p3630
aVThe first investigative thing I would do is look at the event log
p3631
aVAnything interesting
p3632
aVAlso worth checking if your anti-virus software hasn't gone mad with false positives (unlikely)
p3633
aVThe next thing I would do is isolate the app - i
p3634
ag50
aVsnip off the 1
p3635
aV1 stuff - since you're calling it via an asmx page (to a separate application) it shouldn't be a factor, so you should (theoretically) be able to reproduce it just from a flat xml file
p3636
aVIdeally, it would be good to have a page (maybe an ashx for simplicity) in you project that just tries to do a transform from a local file
p3637
aVIs it reproducable with simple xslt/xml
p3638
aVThe simpler you can make the code that has an issue, the closer you are to either finding/fixing it, or having something that you can fire at MS via "connect"
p3639
as(dp3640
g18
V23354
p3641
stp3642
a((dp3643
g2
(lp3644
VThe simplest way is to simply write either csv, or html (in particular, a ) to the output, and simply pretend that it is in excel format via the content-type header
p3645
aVExcel will happily load either; csv is simpler
p3646
aVHere's a similar example (it actually takes an IEnumerable, but it would be similar from any source (such as a , looping over the rows)
p3647
as(dp3648
g18
V23354
p3649
stp3650
a((dp3651
g2
(lp3652
V"fast" and "slow" are subjective, especially with today's PC's
p3653
aVI'm not saying deliberately make the thing slow, but there isn't nearly as much overhead in writing a managed application as you might think
p3654
aVThe JIT etc work very well to make the code execute very fast
p3655
aVAnd you can also NGEN for extra start-up speed if you really need
p3656
aVActually, if you have time to learn it, you might want to consider WPF rather than winform - this is a different skill-set, but allows you to make very good use of graphics hardware etc
p3657
aVAlso -
p3658
aVNET framework comes with new OS installs, and is still very common on those that pre-date it
p3659
aVSo for me it would be a fairly clear choice to develop with C#/
p3660
aVNET
p3661
aVThe time to develop a robust and fully tested C++ app (with no leaks, etc) is (for me at least) much greater than the same with C#
p3662
as(dp3663
g18
V23354
p3664
stp3665
a((dp3666
g2
(lp3667
VIs the ActiveX for the client, or for the server
p3668
aVIf for the server, just use a direct reference to the managed assembly (no need for COM)
p3669
aVRe the client, frankly I'm not sure it is a good idea to be writing ActiveX controls - most browsers won't love them
p3670
aVYou'd do better with AJAX and DHTML, or Silverlight / Acrobat / etc for something more complex
p3671
aV[update]
p3672
aVSo you want ActiveX at the client
p3673
aVmy next though would be "can Silverlight access the certificate store
p3674
aVI can't find anything, though
p3675
aVDistributing an ActiveX control (for IE) is usually a matter of packaging the dll into a cab, marking it as safe for scripting and safe for activation
p3676
aVYou then place the cab on the web-server, and on the bage you have an  element specifying the source (code-base) of the cab
p3677
aVI have to stress that this approach is going to be very hit-and-miss; it won't work on many browsers, and will work soem of the time on IE (depending on the user's security settings)
p3678
aVI don't recommend it
p3679
aVA more practical option might be to write a standalone
p3680
aVNET exe that you package via ClickOnce ("Publish" in VS); drop the ClickOnce deployment on the web-site, and navigate to the application
p3681
aVVoila - full
p3682
aVNET code at the client, without the browser issues
p3683
as(dp3684
g18
V23354
p3685
stp3686
a((dp3687
g2
(lp3688
VProbably the forums here, or (for bugs) connect (they've added options for
p3689
aVNET 4
p3690
aV0 CTP and VS2010 CTP)
p3691
as(dp3692
g18
V23354
p3693
stp3694
a((dp3695
g2
(lp3696
VI can see three ways to get this going:
p3697
aV1: write the files you need to flat files in the temp area, navigate the  to the html file, and delete them once the page has loaded
p3698
aV2: as you say, an embedded web-server - herhaps  - but note that this uses HTTP
p3699
aVSYS, and so requires admin priveleges (or you need to pre-open the port)
p3700
aV3: like 1, but using named-pipe server to avoid writing a file
p3701
aVI have to say, the first is a lot simpler and requires zero configuration
p3702
as(dp3703
g18
V23354
p3704
stp3705
a((dp3706
g2
(lp3707
VIn days-gone-by, there were considerable performance benefits from using stored procedures, but query plan re-use is now significantly better, such that the two are nearly the same in many cases
p3708
aVIf you are building dynamic SQL at the server, you can further increase query plan re-use (and injection safety) by using sp_ExecuteSQL (rather than just EXEC) to execute the SQL
p3709
aVThere are some advantages to using stored procedures:
p3710
aVThey fix exactly what will happen at the db
p3711
aVFor tight security scenarios, you can tightly control access to the stored procedure (rather than the table)
p3712
aVYou can sub-divide the query if the plan is going freaky in spots (sniffing)
p3713
aVHowever, there are advantages to SQL too:
p3714
aVIt allows ORM tools (LINQ, for example) to write composable queries (page 4, ordered by Foo,Bar) on the fly
p3715
aVIt allows you to write dynamic code in a more expressive language (TSQL is not really intended to be used to write TSQL
p3716
aVYou generally have better tooling
p3717
aVSome thing where I would definitely use an SP is in (for example) a data-migration step - i
p3718
ag50
aVfor a bulk operation I might use SqlBulkCopy to push the data into a staging table, then a stored procedure to move the data over
p3719
aVBeyond that, I'm fairly flexible
p3720
as(dp3721
g18
V23354
p3722
stp3723
a((dp3724
g2
(lp3725
VIn short, you can't do it from the attribute constructor, When the attribute is constructed it has no access to the target method/class/field/etc to which it is being applied
p3726
aVFrom the code, I'm assuming you want the code to auto-register on startup
p3727
aVOne way to do this might be to probe your assembly (once, at startup) - enumerate all classes (), finding those with candidate error handlers
p3728
aVThis reduces the maintenance burden
p3729
aVAnother option would be something similar using a configuration file
p3730
as(dp3731
g18
V23354
p3732
stp3733
a((dp3734
g2
(lp3735
VThe system treats anything that implements  (or ) as a container, rather than an item
p3736
aVAs such, you cannot bind to properties of anything that implements
p3737
aVAs such, encapsulation (i
p3738
ag50
aVwhat you already have) is the best approach if you want to be able to bind to properties of the container
p3739
aVHowever, you should note that many bindings support dot-notation in the source - i
p3740
ag50
aVeither binding to "Items
p3741
aVSomeProperty", or setting the auxiliary property (typically ) to specify sub-lists
p3742
aVThis allows you to have a single , and have different controls bound to different levels in the hierarchy - i
p3743
ag50
aVyou might have a  bound to , and a  (with the same ) that has
p3744
as(dp3745
g18
V23354
p3746
stp3747
a((dp3748
g2
(lp3749
VIt doesn't do pooling like SqlConnection, if that is what you mean
p3750
aV[caveat: I use "connection" here loosely to mean a logical connection, not necessarily a physical connection]
p3751
aVBetween using a connection on-demand, and keeping one around, there are advantages and disadvantages to both approaches
p3752
aVThere is some overhead in initializing a connection, so if you are doing 5 things you should try to do them on the same proxy - but I wouldn't keep a long term proxy around just for the sake of it
p3753
aVIn particular, in terms of life-cycle management, once a proxy has faulted, it stays faulted - so you need to be able to recover from the occasional failure (which should be expected)
p3754
aVEqually, in some configurations (some combinations of session/instancing), a connection has a definite footprint on the server - so to improve scalability you should keep connections short-lived
p3755
aVOf course, for true scalability you'd usually want to disable those options anyway
p3756
aVThe cost of creating a connection also depends on things like the security mode
p3757
aVIIRC, it will be more expensive to open a two-way validated connection using message security than it will to set up a TransportWithMessageCredential connection - so "YMMV" is very much the case here
p3758
aVPersonally, I find that the biggest common issue with proxy performance isn't anything to do with the time to set up a conncetion - it is the chattiness of the API
p3759
ag412
ag50
aVScenario A:
p3760
aVopen a connection
p3761
aVperform 1 operation with a large payload (i
p3762
ag50
aVa message that means "do these 19 things")
p3763
aVclose the proxy
p3764
aVScenario B:
p3765
aVopen a connecton
p3766
aVperform 19 operations with small payloads
p3767
aVclose the connection
p3768
aVThen scenario A will usually be significantly faster due to latency etc
p3769
aVAnd IMO don't even think about distributed transactions over WCF ;-p
p3770
as(dp3771
g18
V23354
p3772
stp3773
a((dp3774
g2
(lp3775
VThe question is unclear, but it looks like you are trying to do the equality match that isn't returning the rows you expect, so I'm guessing that the problem is that the milliseconds are being problematic
p3776
aVThere are several approaches here:
p3777
aVformat both values (as varchar
p3778
aVetc) using CONVERT : expensive for
p3779
aVCPU, can't use index
p3780
aVuse DATEDIFF/DATEPART to do the
p3781
aVmath - similar, but not quite as
p3782
aVexpensive
p3783
aVcreate a range to search between
p3784
aVThe 3rd option is almost always the most efficient, since it can make good use of indexing, and doesn't require masses of CPU
p3785
aVFor example, in the above, since your precision is seconds*, I would use:
p3786
aVthen add a WHERE of the form:
p3787
aVThis will work best if you have a clustered index on column_datetime, but should still work OK if you have a non-clustered index on column_datetime
p3788
aV[*=if @p_date includes milliseconds you'd need to think more about whether to trim those ms via , or do a smaller range, etc]
p3789
as(dp3790
g18
V23354
p3791
stp3792
a((dp3793
g2
(lp3794
VAs an alternative, you might do this as rtf or html in a suitable control (such as WebBrowser)
p3795
aVIt would probably take a bit more resources that you'd ideally like, but it'll work fairly quickly
p3796
as(dp3797
g18
V23354
p3798
stp3799
a((dp3800
g2
(lp3801
VFirst off, you might consider the existing  for keeping friendly names
p3802
aVAs has already been covered, you simply can't get this information inside the attribute
p3803
aVYou can look up the attribute from Bar, but in general, the only way to do it from the attribute would be to pass the type into the attribute - i
p3804
ag50
aVWhat exactly is it you want to do
p3805
aVThere may be other options
p3806
aVNote that for i18n, resx, etc; you can subclass  and provide lookup from keys by overriding the  getter
p3807
as(dp3808
g18
V23354
p3809
stp3810
a((dp3811
g2
(lp3812
V[update: I don't know why, but both examples below now work fine
p3813
aVOriginally I was also seeing a 403 on the page2 example
p3814
aVMaybe it was a server issue
p3815
aVFirst,  is easier
p3816
aVActually, I've seen this before
p3817
aVIt turned out to be case sensitivity in the url when accessing wikipedia; try ensuring that you have used the same case in your request to wikipedia
p3818
aV[updated] As Bruno Conde and gimel observe, using %27 should help make it consistent (the intermittent behaviour suggest that maybe some wikipedia servers are configured differently to others)
p3819
aVI've just checked, and in this case the case issue doesn't seem to be the problem
p3820
aVhowever, if it worked (it doesn't), this would be the easiest way to request the page:
p3821
aVI'm afraid I can't think what to do about the leading apostrophe that is breaking things
p3822
as(dp3823
g18
V23354
p3824
stp3825
a((dp3826
g2
(lp3827
VHave you tried MSBee
p3828
aVThis is an add-on to VS2005 (well, strictly speaking: MSBuild in 2
p3829
aV0), but it may well work with VS2008 too
p3830
aVOf course, you can always use the IDE to write code, and simply use MSBuild from the 2
p3831
aV0 folder to build
p3832
aVEither way, if you target
p3833
aVNET 1
p3834
aV1, you can only use
p3835
aVNET 1
p3836
aV1 / C# 1
p3837
aV2 features
p3838
aVPersonally, I'd target 3
p3839
aV5SP1, using (if it needs to be free) C# Express 2008
p3840
aV(I've removed this since you need to target such an old OS)
p3841
as(dp3842
g18
V23354
p3843
stp3844
a((dp3845
g2
(lp3846
VFor any reference-type, that is fine - you have passed the reference to the object, but there is only one object, so changes are visible to the caller
p3847
aVThe main time that won't work is for "structs" (value-types) - but they really shouldn't be mutable anyway (i
p3848
ag50
aVthey shouldn't really have editable properties)
p3849
aVIf you needed to do this with a struct, you could add "ref" - i
p3850
ag50
as(dp3851
g18
V23354
p3852
stp3853
a((dp3854
g2
(lp3855
VHave you tried a network sniffer to see what actually got requested from where
p3856
aVSomething like Fiddler or Wireshark (depending on the scenario)
p3857
aVAlso - I note that you are missing  on the  element
p3858
as(dp3859
g18
V23354
p3860
stp3861
a((dp3862
g2
(lp3863
VIMO, not at the moment
p3864
aVIt is clear (from recent announcements especially) that EF is in for some heavy revisions as the "thunderdome" scenario plays out between LINQ-to-SQL and EF
p3865
aVWhatever happens, EF (in a few years) will almost certainly look quite different to EF today
p3866
aVOr certainly "different enough" ;-p
p3867
aVAs such, my view is: stick with simple
p3868
aVAnd simple is LINQ-to-SQL
p3869
aVI don't see much benefit learning a notoriously complex system if I know it is going to change very soon
p3870
aVAnd I'm 100% with you on LINQ-to-SQL ;-p
p3871
aVIf I needed something more than LINQ-to-SQL right now, I'd look at NHibernate or maybe LLBLGen Pro
p3872
aV(edit - as an update, my position has softened a little bit, here and here - but I'm still using LINQ-to-SQL as my primary tool; also - LINQ-to-SQL isn't quite dead yet ;-p)
p3873
as(dp3874
g18
V23354
p3875
stp3876
a((dp3877
g2
(lp3878
VPart of the fun of POCO is that you can't be sure that the object knows who is tracking him
p3879
aVIf the object has data-aware / lazy-loading properties, then you might be able to trace the context via reflection, but in reality this would be a mess
p3880
aVIt would be far cleaner to simply pass the data-context to the code that needs it
p3881
as(dp3882
g18
V23354
p3883
stp3884
a((dp3885
g2
(lp3886
VIn WCF, with a "push" from the server you're really talking about duplex comms; the  is largely redundant here (AFAIK)
p3887
aVThe page here discusses various scenarios, including duplex/callbacks
p3888
aVIf the issue is xml (for some philosophical reason), then simply using  rather than  might help
p3889
aVThe other approach is to have the clients "pull" data periodically; this works well if you need to support basic http, etc
p3890
as(dp3891
g18
V23354
p3892
stp3893
a((dp3894
g2
(lp3895
VYou don't specify which flavor of VS2008 you are using
p3896
aVIf it is Pro or above, then MSTest is bundled, but a lot of people have issues with it - it isn't always very intuitive, and it takes far too much setup to do simple things like coverage / file deployment
p3897
aVA walkthrough is here
p3898
aVAs a recommendation, I suggest using VS2008 with NUnit (free) and TestDriven
p3899
aVNET (not free)
p3900
aVIt takes away all the pain, allowing you to just write simple things like:
p3901
aVThen just right-click (on the class, on the method, on the project, on the solution) and use the Test options that TestDriven
p3902
aVNET provides, including (if you have MSTest) "Test With -> Team Coverage", which runs your NUnit tests with the MSTest coverage tools, including giving the colorization back into the IDE to show which lines executed
p3903
aVNo messing with "testrunconfig" and the other files that MSTest wants you to use
p3904
as(dp3905
g18
V23354
p3906
stp3907
a((dp3908
g2
(lp3909
VYou can't just cast a string ("1") to a decimal, and even if you could I doubt that the generic version would know about it
p3910
aVit would try to do a reference-preserving cast, where-as you'd need an operator conversion (they share syntax in C#, but are very different)
p3911
aVSo basically, I think Convert
p3912
aVChangeType is your only sensible option here
p3913
aVI do have some code that will allow you to use operator conversion via generics, but there is no operator conversion between string and decimal, so it wouldn't help
p3914
as(dp3915
g18
V23354
p3916
stp3917
a((dp3918
g2
(lp3919
VThe easiest way to write any iterator is with an iterator block, for example:
p3920
aVThe key here is the "", which turns the method into an iterator block, with the compiler generating an enumerator () that does the same
p3921
aVWhen called, generic type inference handles the  automatically, so you just need:
p3922
aVThe above can be used with anonymous types just fine
p3923
aVYou can, of coure, specify the  if you want (as long as it isn't anonymous):
p3924
aVRe  (non-generic), well, the simplest approach is for the caller to use  or  to get an  first
p3925
aVYou can pass in  in the above, but the caller will have to specify  themselves, rather than having the compiler infer it
p3926
aVYou can't use this with  being an anonymous type, so the moral here is: don't use the non-generic form of  with anonymous types
p3927
aVThere are some slightly more complex scenarios where the method signature is such that the compiler can't identify the  (and of course you can't specify it for anonymous types)
p3928
aVIn those cases, it is usually possible to re-factor into a different signature that the compiler can use with inference (perhaps via a pass-thru method), but you'd need to post actual code to provide an answer here
p3929
aV(updated)
p3930
aVFollowing discussion, here's a way to leverage  with anonymous types
p3931
aVThe key is to provide an argument that can be used for the type inference (even if the argument is never used)
p3932
aVFor example:
p3933
as(dp3934
g18
V23354
p3935
stp3936
a((dp3937
g2
(lp3938
VAnother recommendation for protocol buffers - nice tight binary with little effort
p3939
aVNote, however, that while the binary protocol is well defined, there isn't yet an agreed RPC standard (several are in progress, tending to lean towards TCP or HTTP)
p3940
aVThe spec makes it very easy to have the client and server in different architectures, which is good - plus it is extensible
p3941
aVCaveat: I'm the author of one of the
p3942
aVNET versions, so I may well be biased ;-p
p3943
as(dp3944
g18
V23354
p3945
stp3946
a((dp3947
g2
(lp3948
VIf I'm reading the question correctly, you simply want to store the data efficiently
p3949
aVObviously simple options like compressed xml are simple, but there are more direct binary serialization methods
p3950
aVOne the leaps to mind is Google's protocol buffers
p3951
aVFor example, in C# with protobuf-net, you can simply create a class to hold the data:
p3952
aVThen just [de]serialize a List or Foo[] etc, via the ProtoBuf
p3953
aVSerializer class
p3954
aVI'm not claiming it will be quite as space-efficient as rolling your own, but it'll be pretty darned close
p3955
aVThe protocol buffer spec makes fairly good use of space (for example, using base-128 for integers, such that small numbers take less space)
p3956
aVBut it would be simple to try it out, without having to write all the serialization code yourself
p3957
aVThis approach, as well as being simple to implement, also has the advantage of being simple to use from other architectures, since there are protocol buffers implementations for various languages
p3958
aVIt also uses much less CPU than regular [de]compression (GZip/DEFLATE/etc), and/or xml-based serialization
p3959
as(dp3960
g18
V23354
p3961
stp3962
a((dp3963
g2
(lp3964
VThere are a number of things you can do in order to effect a simple string replacement;, however, I strongly suggest that you look into parameterization, to provide both injection  safety and query-plan re-use
p3965
aVParameters also benefit by avoiding the quote issue - so just replace  with (for example)  and you're sorted
p3966
aVThis replace can be:
p3967
aVor
p3968
aVFrom C#, this would a  with parameters; from T-SQL you might consider
p3969
aVEither way, you'd want to end up with:
p3970
aVAnd supply @p1 as the parameter
p3971
aVSo from C#:
p3972
aVOr from TSQL:
p3973
aV(replace  with the correct type)
p3974
as(dp3975
g18
V23354
p3976
stp3977
a((dp3978
g2
(lp3979
VMicrosoft Windows SDK for Windows Server 2008 and
p3980
aVNET Framework 3
p3981
ag691
aVActually, you only need the SDK for a few things (the RDL reports compiler  file leaps to mind, since that one has bitten me recently)
p3982
aVThe framework itself can do most things
p3983
as(dp3984
g18
V23354
p3985
stp3986
a((dp3987
g2
(lp3988
VThe easiest option is to start a windows forms project, then change the output-type to Console Application
p3989
aVAlternatively, just add a reference to System
p3990
aVWindows
p3991
aVForms
p3992
aVdll, and start coding:
p3993
aVThe important bit is the  on your  method, required for full COM support
p3994
as(dp3995
g18
V23354
p3996
stp3997
a((dp3998
g2
(lp3999
VYou don't need to implement Dispose() on every class - just those with something that needs deterministic cleanup
p4000
aVRe a Disposable base-class, I'm not entirely sure it provides a whole lot -  isn't a complex interface
p4001
aVThe main time it might be useful is if you are handling unmanaged resources and want a finalizer, but even then it isn't much code
p4002
aVPersonally, I wouldn't bother with such a base class
p4003
aVIn particular, inheritance (in a single-inheritance world) gets restrictive very quickly
p4004
aVBut more to the point, overriding a method isn't much different to simply providing a public Dispose() method
p4005
aVAgain: you only need a finalizer etc if you are handling unmanaged objects
p4006
aVIf I had a lot of these (unmanaged resouces), I might see whether I could get PostSharp to do the work for me
p4007
aVI don't know if one already exists, but it might be possible to create an aspect that handles (in particular) the finalizer etc
p4008
aVWho knows
p4009
as(dp4010
g18
V23354
p4011
stp4012
a((dp4013
g2
(lp4014
VJust a thought - could you use TlbExp to create two interop assemblies (with different names and assemblies), and use an interface/factory to code against the two via your own interface
p4015
aVOnce you have the interop dll, you don't need the COM dependency (except of course for testing etc)
p4016
aVTlbImp has a /asmversion for the version, so it could be done as part of the build script; but I'm sure you even need this: just make sure that "specific version" is false in the reference (solution explorer)
p4017
aVAlso - I know it doesn't help, but C# 4
p4018
aV0 with  and/or "No PIA" might help here (in the future; maybe)
p4019
as(dp4020
g18
V23354
p4021
stp4022
a((dp4023
g2
(lp4024
VRe obfuscated - well  with break might be clearer (plus it'll  the enumerator, which you aren't doing)
p4025
aVActually, a "params cleanStep[] targets" might help:
p4026
aVthen you can call:
p4027
as(dp4028
g18
V23354
p4029
stp4030
a((dp4031
g2
(lp4032
VHmmm
p4033
aVI don't know
p4034
aVHowever, you could force the dll to load early on
p4035
aVSince you are using IIS, this would presumably be in your global
p4036
aVasax - something like creating and throwing away a TransactionScope should do the job
p4037
as(dp4038
g18
V23354
p4039
stp4040
a((dp4041
g2
(lp4042
VUltimately, though; since  expressions are burned into the caller, this is identical to using "GET" etc, just without the risk of a typo
p4043
as(dp4044
g18
V23354
p4045
stp4046
a((dp4047
g2
(lp4048
VAn  is not an ; it is simply a delegate (that might have been an expression at some point, might have been a lambda, and might not have been either)
p4049
aVTo make this workable, you would need to refactor to:
p4050
aVAlso, C# 3
p4051
aV0 /
p4052
aVNET 3
p4053
aV5 lambda expressions don't work very well for -type expressions
p4054
aVYou are very limited in what you can express
p4055
aV-type expressions work better
p4056
aVIn
p4057
aVNET 4
p4058
aV0 (CTP) there is much more flexibility here, although it still isn't clear what the language (C# 4
p4059
aV0) will offer by way of lambdas
p4060
aVBasically, I'm not sure that you can (conveniently) do what you hope using
p4061
as(dp4062
g18
V23354
p4063
stp4064
a((dp4065
g2
(lp4066
VHow about:
p4067
aVif this barfs, then  etc might be useful, else just use an extension method (as already suggested)
p4068
as(dp4069
g18
V23354
p4070
stp4071
a((dp4072
g2
(lp4073
VSomething like:
p4074
aVYou might find this helpful
p4075
as(dp4076
g18
V23354
p4077
stp4078
a((dp4079
g2
(lp4080
VYes, GetSchema() should return null
p4081
aVIXmlSerializable
p4082
aVGetSchema Method This
p4083
aVmethod is reserved and should not be
p4084
aVused
p4085
aVWhen implementing the
p4086
aVIXmlSerializable interface, you should
p4087
aVreturn a null reference (Nothing in
p4088
aVVisual Basic) from this method, and instead,
p4089
aVif specifying a custom schema is
p4090
aVrequired, apply the
p4091
aVXmlSchemaProviderAttribute to the
p4092
aVclass
p4093
aVFor both read and write, the object element has already been written, so you don't need to add an outer element in write
p4094
aVFor example, you can just start reading/writing attributes in the two
p4095
aVFor write:
p4096
aVThe WriteXml implementation you
p4097
aVprovide should write out the XML
p4098
aVrepresentation of the object
p4099
aVThe
p4100
aVframework writes a wrapper element and
p4101
aVpositions the XML writer after its
p4102
aVstart
p4103
aVYour implementation may write
p4104
aVits contents, including child
p4105
aVelements
p4106
aVThe framework then closes
p4107
aVthe wrapper element
p4108
aVAnd for read:
p4109
aVThe ReadXml method must reconstitute
p4110
aVyour object using the information that
p4111
aVwas written by the WriteXml method
p4112
aVWhen this method is called, the reader
p4113
aVis positioned at the start of the
p4114
aVelement that wraps the information for
p4115
aVyour type
p4116
aVThat is, just before the
p4117
aVstart tag that indicates the beginning
p4118
aVof a serialized object
p4119
aVWhen this
p4120
aVmethod returns, it must have read the
p4121
aVentire element from beginning to end,
p4122
aVincluding all of its contents
p4123
aVUnlike
p4124
aVthe WriteXml method, the framework
p4125
aVdoes not handle the wrapper element
p4126
aVautomatically
p4127
aVYour implementation
p4128
aVmust do so
p4129
aVFailing to observe these
p4130
aVpositioning rules may cause code to
p4131
aVgenerate unexpected runtime exceptions
p4132
aVor corrupt data
p4133
aVI'll agree that is a little unclear, but it boils down to "it is your job to  the end-element tag of the wrapper"
p4134
as(dp4135
g18
V23354
p4136
stp4137
a((dp4138
g2
(lp4139
V[oops; note that this reply applies to Linq-to-SQL, not Entity Framework
p4140
aVI've left it here (rather than delete) because it is partly on-topic, and might be useful
p4141
aVFurther to the other replies, note that the data-context also has the ability to avoid doing a round-trip for simply "by primary key" queries - it will check the cache first
p4142
aVUnfortunately, it was completely broken in 3
p4143
aV5, and is still half-broken in 3
p4144
aV5SP1, but it works for some queries
p4145
aVThis can save a lot of time if you are getting individual objects
p4146
aVSo basically, IIRC you need to use:
p4147
aVBut not:
p4148
as(dp4149
g18
V23354
p4150
stp4151
a((dp4152
g2
(lp4153
VEntity Framework does not have true persistence ignorance
p4154
aVThat is one of the biggest criticisms (i
p4155
ag50
aVa forced base class, lots of EF ties, etc)
p4156
aVLINQ-to-SQL can have persistence ignorance, but in reality people tend to use the lazy loading and attributed approach, which means that it still doesn't have persistence ignoance
p4157
aVRe being persistence agnostic - it (EF) would still need a provider
p4158
aVSure, if you want to write an EF provider that talks to the file system, go ahead
p4159
aVIt would be a lot of work though
p4160
aVIt would be easier to use a SQL Express database (flat file) etc
p4161
as(dp4162
g18
V23354
p4163
stp4164
a((dp4165
g2
(lp4166
VBeing pragmatic,  vs  isn't all-or-nothing (unless you are on Silverlight) - so if  does something you need, and  doesn't, then perhaps use  (with  etc)
p4167
aVThat said, even with , you could presumably use  to import each, then simply  it to the main collection
p4168
aVOf course, if the files are big,  might be more efficient
p4169
aVbut more complex
p4170
aVFortunately,  has a  method that accepts an , so you can navigate to the first child in the  and then just blitz it to the output file
p4171
aVSomething like:
p4172
as(dp4173
g18
V23354
p4174
stp4175
a((dp4176
g2
(lp4177
VHowever, this is not robust, especially as optimisations (such as JIT inlining) can monkey with the perceived stack frames
p4178
as(dp4179
g18
V23354
p4180
stp4181
a((dp4182
g2
(lp4183
VFirst off, there are better ways of dealing with streams that using an array for the entire thing (i
p4184
ag50
aVmight be unnecessary here)
p4185
aVI would envisage a loop:
p4186
aVYou should also do this with buffering disabled ()
p4187
aVRe the problem, my suspicion is that you haven't written enough data / closed the response ()
p4188
as(dp4189
g18
V23354
p4190
stp4191
a((dp4192
g2
(lp4193
VWell, not specific to MVC, but this approach allows you to keep the core public API clean
p4194
aVIt is also useful if there is ever a risk of different interfaces / etc having the same name & signature, but different meaning
p4195
aVIn reality this is rare
p4196
aVIt also allows you to provide an implementation where you want the return type to change in subclasses:
p4197
aV( chosen for simplicity - don't get hung up on the fact that it is a poorly defined interface
p4198
aVa better example would have been things like  etc, which do this - but that is harder to show in a short example)
p4199
aVIf we had used a public virtual method, we wouldn't be able to  it and use  in the base-class, as you aren't allowed to do both:
p4200
aVUsing the protected virtual approach, any usage:
p4201
aVFoo
p4202
aVClone()
p4203
aVBar
p4204
aVClone()
p4205
aVICloneable
p4206
aVClone()
p4207
aVall use the correct  implementation for the concrete type
p4208
as(dp4209
g18
V23354
p4210
stp4211
a((dp4212
g2
(lp4213
VHow long does the tool take to execute
p4214
aVOne lazy option might be to simply edit the csproj such that it always runs the tool during build (presumably via  or a custom  file) - of course, this depends on it being quick to execute
p4215
aVAnother way would be to write a shim that works as the "Custom Tool" in VS, and simply calls the existing exe (or whatever) with the right args
p4216
aVNot trivial, but doable (see here) - I believe this then supposedly plays fairly nicely with change detection
p4217
aVIt is actually on my list of things to do for a current project, so I'll find out soon enough
p4218
as(dp4219
g18
V23354
p4220
stp4221
a((dp4222
g2
(lp4223
VLINQ-to-SQL supports use with UDFs, if that is what you mean
p4224
aVJust drag the UDF onto the designer surface and you're done
p4225
aVThis creates a matching method on the data-context, marked  or similar, telling LINQ-to-SQL that it can use this in queries (note that EF doesn't support this usage)
p4226
aVYou would then use it in your query like:
p4227
aVwhich will become TSQL something like:
p4228
aV(or there-abouts)
p4229
aVThe fact that it is composable means that you can use the value in queries - for example in a / - and so reduce the data brought back from the server (although obviously the UDF will still need to be executed in some way)
p4230
aVHere's a similar example, showing a pseudo-UDF at use on a data-context, illustrating that the C# version of the method is not used
p4231
aVActually, I'm currently looking at such UDFs to provide "out of model" data in a composable way - i
p4232
ag50
aVa particular part of the system needs access to some data (that happens to be in the same database) that isn't really part of the same model, but which I want to  in interesting ways
p4233
aVI also have existing SPs for this purpose
p4234
aVso I'm looking at porting those SPs to tabular UDFs, which provides a level of contract/abstraction surrounding the out-of-model data
p4235
aVSo because it isn't part of my model, I can only get it via the UDF - yet I retain the ability to compose this with my regular model
p4236
as(dp4237
g18
V23354
p4238
stp4239
a((dp4240
g2
(lp4241
VI'd echo the "don't" (either from a dll or a UI project)
p4242
aVThere are several things you can do to make library code play nicely with a UI,including the same threading tricks (with events and/or callbacks) that you might use from the UI
p4243
aVThe simplest approach is for the library code to simply execute "as is", and if the UI happens to spawn it on a worker thread, then it is the UI's job to handle any events and marshal them () to the UI thread for UI updates
p4244
aVFor more complex scenarios, you can use the sync-context () to post messages to the UI thread (this is actually how  etc work, but it is implementation independent - so a WPF sync-context can go through the WPF dispatcher)
p4245
aVCan you add more context on what the scenario is
p4246
aVThere are many things that can be done
p4247
as(dp4248
g18
V23354
p4249
stp4250
a((dp4251
g2
(lp4252
VWhat is the objective here
p4253
aVYou mention that / etc were just examples, so I don't think we need to focus on those
p4254
aVIf you simply want to be able to manipulate the dictionary contents, then "done" - that already works
p4255
aVsince  is a reference-type, the caller will already see any changes you make
p4256
aVYou can remove the  too
p4257
as(dp4258
g18
V23354
p4259
stp4260
a((dp4261
g2
(lp4262
V does what you need:
p4263
aV(or invariant / ordinal / etc depending on the data you are comparing)
p4264
as(dp4265
g18
V23354
p4266
stp4267
a((dp4268
g2
(lp4269
VFor that to work, firstly "newItem" would have to be "ref"
p4270
aVSecondly, you'd need to do something with the updated value after the delegate invoke (an enumerator doesn't offer any ability to update contents)
p4271
aVBut most updates to collections will break enumerators anyway
p4272
aVYour replacing "newItem" will not be visible to the client otherwise
p4273
aVHowever, changes to properties of the tag (assuming it is a reference type and mutable) will be
p4274
aVFor this to work, itemsToActOn would have to be  - then you could use:
p4275
aVOr if you could use
p4276
as(dp4277
g18
V23354
p4278
stp4279
a((dp4280
g2
(lp4281
VPersonally, I find that having individual methods as synchronized generally isn't as useful as it sounds
p4282
aVCommonly, you might want to do a related "get" and "put" in close succession, and if another thread is looking at the same values you have an immediate thread race
p4283
aVLikewise (depending on the scenario) you don't want somebody reading values that you are working on
p4284
aVFor a broad approach, simply using an external  ( can work well for many situations
p4285
aVIt is simple, light-weight, and unless you are under heavy thread load, more than adequate
p4286
aVFor more complex scenarios, things like  etc are more flexible
p4287
aVBut I'd start simple, and only change things if profiling shows there is a genuine contention issue
p4288
aVAs Jon notes, with Parallel Extension comes a a whole new slew of high performance synchronization devices; from what I can see (for example here, here and here), this is part of
p4289
aVNET 4
p4290
ag190
as(dp4291
g18
V23354
p4292
stp4293
a((dp4294
g2
(lp4295
VHave you tried comparing the IL (for example, with Reflector)
p4296
aVAll three become (give or take the name):
p4297
aVSo no: there is exactly zero difference
p4298
as(dp4299
g18
V23354
p4300
stp4301
a((dp4302
g2
(lp4303
VDo you mean using statements
p4304
aVFirst, note that they generally do no harm other that take space
p4305
aVTools like ReSharper offer automated tricks to do this, however: there was a link in the VS feed a little while ago; it boils down to:
p4306
aVgo to Tools -> Macros -> Macros IDE
p4307
aVin the Project Explorer, Add -> Add Module
p4308
aV(put in a name - I've used OrganiseUsings)
p4309
aVpaste over with the code below
p4310
aVFile -> Save MyMacros, exit
p4311
aVNow if you right-click on the toolbar and Customize
p4312
aV- you should be able to find MyMacros
p4313
aVOrganiseUsings
p4314
aVRemoveAndSortAll - drag this somewhere handy (maybe the Tools menu; you might also want to change the name after placing it)
p4315
aVYou can now use this option to run the Remove and Sort command for an entire solution
p4316
aVA big time-saver
p4317
aV==== code ====
p4318
as(dp4319
g18
V23354
p4320
stp4321
a((dp4322
g2
(lp4323
VIf the value is changing inside the method, you will need to declare a temp () variable to pass () to the method, and unbox it yourself afterwards:
p4324
aVNote that this will not allow you to update the value after the event
p4325
aVSomething like an event or callback might be an alternative way of passing changes back to the caller
p4326
aVNote also that C# 4
p4327
aV0 has some tricks to help with this only in the context of COM calls (where  is so common [plus of course  for late binding, as Jon notes])
p4328
as(dp4329
g18
V23354
p4330
stp4331
a((dp4332
g2
(lp4333
VLook up "Word Automation"
p4334
aVFor example, KB316384, which covers:
p4335
aVThe sample code in this article demonstrates how to do the following:
p4336
aVInsert paragraphs with text and formatting
p4337
aVBrowse and modify various ranges within a document
p4338
aVInsert tables, format tables, and populate the tables with data
p4339
aVAdd a chart
p4340
as(dp4341
g18
V23354
p4342
stp4343
a((dp4344
g2
(lp4345
VYou could try using SGEN to avoid it having to create the dll at runtime
p4346
aVHowever, I would be tempted to log that as a bug on connect
p4347
aVNote that the SGEN approach won't help web-servers:
p4348
aVThese generated assemblies cannot be
p4349
aVused on the server side of a Web
p4350
aVservice
p4351
aVThis tool is only for Web
p4352
aVservice clients and manual
p4353
aVserialization scenarios
p4354
as(dp4355
g18
V23354
p4356
stp4357
a((dp4358
g2
(lp4359
VHmmm
p4360
aVI guess you'd have to parse the tree, checking the node-type and member of each
p4361
aVI'll knock up an example
p4362
as(dp4363
g18
V23354
p4364
stp4365
a((dp4366
g2
(lp4367
VIf you are using a , try changing ShowInTaskbar to false
p4368
aVTo remove it from the Alt+Tab screen, try changing your window border style; I believe some of the tool-window styles don't appear
p4369
aVsomething like:
p4370
aVIf it still appears in the Alt+Tab, you can change the window styles through p/invoke (a bit hackier):
p4371
as(dp4372
g18
V23354
p4373
stp4374
a((dp4375
g2
(lp4376
VWithout trying to second guess Jon, I believe he is suggesting that you would create a class Car ("some appropriate object") with the necessary properties, and the ability to populate a Car from a line:
p4377
ag412
ag50
aVtreating the lines as objects
p4378
aVThen with LINQ things become quite simple:
p4379
aVNote that you can do this without LINQ too, for example (using a  array) - an in-place array sort:
p4380
aVor the same with :
p4381
as(dp4382
g18
V23354
p4383
stp4384
a((dp4385
g2
(lp4386
VNot tested, but how about via an :
p4387
aVAlternatively (from the cmoment), something like:
p4388
aVBut actually I'm not a fan of that
p4389
aVit forces an additional xml-parse step (one of the more CPU-expensive operations) for no good reason
p4390
aVIf the original is being glitchy, then perhaps consider a sub-reader:
p4391
as(dp4392
g18
V23354
p4393
stp4394
a((dp4395
g2
(lp4396
VIt depends on the scenario
p4397
aVis certainly one way, and has the advantage of mapping directly to an object model
p4398
aVIn
p4399
aVNET 3
p4400
aV5,  etc are also very friendly
p4401
aVIf the size is very large, then  is your friend
p4402
aVFor an  example:
p4403
aVOr the same with :
p4404
aVIf you are writing a large stream of data, then any of the DOM approaches (such as / etc) will quickly take a lot of memory
p4405
aVSo if you are writing a 100MB xml file from csv, you might consider ; this is more primative (a write-once firehose), but very efficient (imagine a big loop here):
p4406
aVFinally, via :
p4407
aVThis is a nice model for mapping to classes etc; however, it might be overkill if you are doing something simple (or if the desired xml doesn't really have a direct correlation to the object model)
p4408
aVAnother issue with  is that it doesn't like to serialize immutable types : everything must have a public getter and setter (unless you do it all yourself by implementing , in which case you haven't gained much by using )
p4409
as(dp4410
g18
V23354
p4411
stp4412
a((dp4413
g2
(lp4414
VIt isn't the list that stores the current position - it is the
p4415
aVAny controls (with the same ) with the same reference as a  will share a
p4416
aVBy using different list instances you get different  instances, and thus separate position
p4417
aVYou could achieve the same simply by using , or creating a new  with the same contents (as per your original post), or by assigning a new  to one of the controls:
p4418
as(dp4419
g18
V23354
p4420
stp4421
a((dp4422
g2
(lp4423
VYou missed
p4424
aVNET 3
p4425
aV5, which is actually a bigger package than
p4426
aVNET 3
p4427
aV0;
p4428
aVNET 3
p4429
aV0 adds things like WCF/WPF/WF, which are nicer ways to do things that were (generally) already there in the framework
p4430
aVHowever,
p4431
aVNET 3
p4432
aV5 adds LINQ, which is huge and broad-reaching
p4433
aVLINQ-to-Objects is the most used, providing a more convenient model for regular code
p4434
aVBut LINQ-to-SQL, and EF (in SP1) are ORM tools (with many others available)
p4435
aVNET 4
p4436
aV0 targets a few problems, in particular threading (TPL/CCR) and dynamic objects (DLR)
p4437
aVC# 4
p4438
aV0 has mainly changes to make dynamic objects easier to work with
p4439
as(dp4440
g18
V23354
p4441
stp4442
a((dp4443
g2
(lp4444
VAs has been observed,  is the bitwise AND operator
p4445
aVRaw binary math is seeming to be less and less common over time, with an increasing number of developers not really understanding bitwise arithmetic
p4446
aVWhich can be a pain at times
p4447
aVHowever there are a lot of tasks that are best solved with such, in particular anything that looks at data as flags
p4448
aVThe  operator is 100% necessary, and isn't going anywhere - it simply isn't used as frequently as the boolean short-circuiting  operator
p4449
aVFor example:
p4450
as(dp4451
g18
V23354
p4452
stp4453
a((dp4454
g2
(lp4455
VJonathan mentions data-contracts, which is a good option
p4456
aVI guess part of the reason that there isn't massive support for this is that it is already fairly easy to do through code, for example via a conversion operator (although a regular instance method would work just as well, and arguably be clearer)
p4457
aVIf you don't control the classes (and partial classes aren't an option), then in C# 3
p4458
aV0 you could use an extension method to simulate an instance method:
p4459
as(dp4460
g18
V23354
p4461
stp4462
a((dp4463
g2
(lp4464
VIf you want to read a file line-by-line via foreach (in a reusable fashion), consider the following iterator block:
p4465
aVNote that this this is lazily evaluated - there is none of the buffering that you would associate with
p4466
aVThe  syntax will ensure that the iterator is d correctly even for exceptions, closing the file:
p4467
aV(this bit is added just for interest
p4468
aVAnother advantage of this type of abstraction is that it plays beautifully with LINQ - i
p4469
ag50
aVit is easy to do transformations / filters etc with this approach:
p4470
aVAnd again, all evaluated lazily (no buffering)
p4471
as(dp4472
g18
V23354
p4473
stp4474
a((dp4475
g2
(lp4476
VSearch for "extern alias"; it is a very rarely used feature that is only needed to disambiguate between two dlls that contribute the same types (for example, two different versions of the same assembly, or two assemblies that have a class which shares a fully-qualified-name)
p4477
aVglobal" is the default
p4478
aVFor example, if you have a class called , you can unambiguously refer to the main  namespace via
p4479
as(dp4480
g18
V23354
p4481
stp4482
a((dp4483
g2
(lp4484
VI posted a full example of this here (see also the post about "" underneath it)
p4485
aVNote it deals with the  etc
p4486
aVAs an update to the code as posted, you can add a bit more to make it easier to use in some scenarios:
p4487
aVThen you can use generic type-inference for the return value:
p4488
as(dp4489
g18
V23354
p4490
stp4491
a((dp4492
g2
(lp4493
VYou could give an "extern alias" a go
p4494
aVThis is one of those times when the VB late binding (option strict off) approach works well
p4495
aVRoll on C# 4
p4496
aV0 and
p4497
aVYou might try writing an interface for the bits you need (in a base library), and write 2 dlls: one referencing each version of the sharepoint dll
p4498
aVFor both projects, implement the interface (throwing  for the bits you can't do), and load the appropriate dll at runtime
p4499
aV(factory approach)
p4500
aVJust try it with a single method before you get too absorbed
p4501
aVdon't do the whole thing until you know it works for the simplest of simple methods
p4502
as(dp4503
g18
V23354
p4504
stp4505
a((dp4506
g2
(lp4507
VIf you just want the args to , you'll need to include that in the regex:
p4508
aVFrom the question, I am using quote detection here
p4509
aVAlternatively - if you just want the values:
p4510
aVThe main change here is that the group is now inside the quotes
p4511
as(dp4512
g18
V23354
p4513
stp4514
a((dp4515
g2
(lp4516
VThis would be trivial with a scalar function (UDF) rather than an SP
p4517
aVHowever, it should work easily enough - although if the SP is complex (i
p4518
ag50
aVFMT_ONLY can't inspect it 100%) then you might need to "help" it
p4519
aVHere's some dbml that I generated from a simplfied SP that returns an integer; you can edit the dbml via "open with
p4520
aVxml editor):
p4521
aV(note you obviously need to tweak the names and data-types)
p4522
aVAnd here is the generated C#:
p4523
aVIf your current SP uses SELECT (instead of RETURN), then the DBML will need to reflect this
p4524
aVYou can fix this by hiding the implementation details, and providing a public wrapper in a partial class; for example:
p4525
aVThe above describes an SP that returns a single table with a single column; but I've made the SP "private" to the data-context, and the result-type "internal" to the assembly (hiding it):
p4526
aVNow in my own class file I can add a new partial class (a new
p4527
aVcs file) in the correct namespace, that exposes the method more conveniently:
p4528
aV(the namespace and context names need to be the same as the actual data-context)
p4529
aVThis adds a public method that hides the grungy details from the caller
p4530
aVDon't edit the designer
p4531
aVcs file directly; your changes will be lost
p4532
aVOnly edit either the dbml or partial classes
p4533
as(dp4534
g18
V23354
p4535
stp4536
a((dp4537
g2
(lp4538
VThe most likely answer (deadlock) has already been suggested
p4539
aVAnother way to simulate this behaviour is to reduce the number of pool threads and IO completion ports; you haven't called  by any chance
p4540
as(dp4541
g18
V23354
p4542
stp4543
a((dp4544
g2
(lp4545
VI'd agree with Jon's , but if you are stuck with C# 2
p4546
aV0, or C# 3
p4547
aV0 with
p4548
aVNET 2
p4549
aV0/3
p4550
aV0 and no LINQBridge, then another approach is  or
p4551
aVI'll illustrate with , since  got posted just as I was about to hit the button ;-p
p4552
as(dp4553
g18
V23354
p4554
stp4555
a((dp4556
g2
(lp4557
VImportant: be very careful about subscribing to a static event from instances
p4558
aVStatic-to-static is fine, but a subscription from a static event to an instance handler is a great (read: very dangerous) way to keep that instance alive forever
p4559
aVGC will see the link, and will not collect the instance unless you unsubscribe (or use something like a WeakReference)
p4560
aVThe pattern for creating static events is the same as isntance events, just with :
p4561
aVTo make life easier (re null checking), a useful trick here is to add a trivial handler:
p4562
aVThen you can simply invoke it without the null-check:
p4563
aVNote that because delegate instances are immutable, and de-referencing is thread-safe, there is never a race condition here, and no need to lock
p4564
aVwho-ever is subscribed when we de-reference gets invoked
p4565
aV(adjust for your own event-args etc)
p4566
aVThis trick applies equally to instance events
p4567
as(dp4568
g18
V23354
p4569
stp4570
a((dp4571
g2
(lp4572
VRegExp is a poor tool for xml
p4573
aVcould you not juts load it into an XDocument / XmlDocument and use xpath
p4574
aVIf you clarify the modifications you want to make, I expect we can fill in the blanks
p4575
aVnamespaces are probably the main thing to make it complex in this case, so we just need to use an
p4576
aVHere's an example that is, granted, more complex than just a regex - however, I would expect it to cope a lot better with the nuances of xml:
p4577
as(dp4578
g18
V23354
p4579
stp4580
a((dp4581
g2
(lp4582
VWell, the first option (without the MS offerings) would have to be NHibernate
p4583
aVI think it plays nicely on mono
p4584
as(dp4585
g18
V23354
p4586
stp4587
a((dp4588
g2
(lp4589
VI took the existing code, and hard-wired the inputs (rather than using Console
p4590
aVReadLine()), I get:
p4591
aVYou are 28 years old Salary= 30000
p4592
aVTax= 3000 Family bonus= 750 Net= 25500
p4593
aVThe main problem seems to be not initializing values - i
p4594
ag50
aVtreating fields as variables:
p4595
aVOK - and what does  start at if , etc
p4596
aVLikewise  in
p4597
aVBy the way, how can Salary be both  and
p4598
aVTo illustrate, I've changed the output to:
p4599
aVWhich shows:
p4600
aVTax= 3000 Tax= 6000 Tax= 9000
p4601
aVMy advice would be: don't store calculated values unless you know the math is so complex that it is worth it
p4602
aVJust calculate them as needed (no field at all)
p4603
as(dp4604
g18
V23354
p4605
stp4606
a((dp4607
g2
(lp4608
VI've got ReSharper 4
p4609
aV1, and it does offer this option (in either direction)
p4610
aVActually, I'd recommend challenging the standard
p4611
aVthe former is far more readable than the latter (especially if you call the variable  or something similar)
p4612
aVI would't use "var" for , but it is ideally suited to the above
p4613
aVFor bulk changing, go to:
p4614
aVCleanup Code
p4615
aV(pick a profile => "Edit Profiles" => Tools => Code Cleanup)
p4616
aVC#
p4617
aVUse 'var' in declaration
p4618
aVReplace direction = Can 'var' to type usage
p4619
aVforeach' iterator declaration style = Always use explicit type
p4620
aVLocal variable declaration style = Always use explicit type
p4621
aVand run
p4622
as(dp4623
g18
V23354
p4624
stp4625
a((dp4626
g2
(lp4627
VI would not use  here; since you have
p4628
aVNET 2
p4629
aV0, use  and all becomes simple:
p4630
aVOr with C# 3
p4631
aV0 (still targetting
p4632
aVNET 2
p4633
aV0)
p4634
aVOr with C# 3
p4635
aV0 and either LINQBridge or
p4636
aVNET 3
p4637
aV5:
p4638
aV(the  usage will work with more types, not just )
p4639
as(dp4640
g18
V23354
p4641
stp4642
a((dp4643
g2
(lp4644
VThere are three ways of doing this; the first is to use GetGetMethod()/GetSetMethod() and create a delegate with Delegate
p4645
aVCreateDelegate
p4646
aVThe second is a lambda (not much use for reflection
p4647
aV[i
p4648
ag50
aVx=>x
p4649
aVFoo]
p4650
aVThe third is via Expression (
p4651
aVNET 3
p4652
aV5)
p4653
aVThe lambda is the easiest ;-p
p4654
aVTo show usage:
p4655
aVNote that if you want the delegate pointing to the specific instance, you can use closures for the lambda, or the overload of CreateDelegate that accepts and instance
p4656
as(dp4657
g18
V23354
p4658
stp4659
a((dp4660
g2
(lp4661
VThree approaches leap to mind:
p4662
aV1: create a property to use for the serialization, and hide the others with
p4663
aV2: implement  and do it yourself
p4664
aV3: create a separate DTO just for the serialization
p4665
aVHere's an example that re-factors the "text" portion into objects that  will like, while retaining the original public AIP:
p4666
as(dp4667
g18
V23354
p4668
stp4669
a((dp4670
g2
(lp4671
VNo, that (static/no ctor) isn't true
p4672
aVQuite the opposite, in fact, since COM will need to create an instance
p4673
aVYou simply need to make the class COM visible
p4674
aVMainly, this is just adding some attributes, and registering it as a COM dll (regasm)
p4675
aVhttp://msdn
p4676
aVmicrosoft
p4677
aVcom/en-us/library/zsfww439
p4678
aVaspx
p4679
as(dp4680
g18
V23354
p4681
stp4682
a((dp4683
g2
(lp4684
VThere are two separate concerns here - the base model (EF), and the WCF/mex layer
p4685
aVYour additional properties will not be part of the edmx model, but I wonder if the issue isn't more related to the WCF/mex aspect
p4686
aVHowever, even if it worked, ADO
p4687
aVNET Data Services transfers data, not logic
p4688
aVSo relying on calculated properties isn't a safe option : the client won't have the formulae - just the original values
p4689
aVTo find out which it is, try making the property read/write (even if the write doesn't do anything useful), and ensure the value has a [DataMember] attribute, etc
p4690
as(dp4691
g18
V23354
p4692
stp4693
a((dp4694
g2
(lp4695
VYes
p4696
aVBasically, you can't do any harm by adding TDD for any new code you write, and any changes you make to existing code
p4697
aVObviously it would be tricky to go back and retro-fit accurate tests to existing code, but it certainly couldn't hurt to cover the primary use-cases
p4698
aVMaybe consider having a look at Brownfield Application Development in
p4699
aVNET
p4700
aVIt is full of pragmatic and practical advice for exactly this scenario (one of the definitions offered for "Brownfield" is "without proper unit tests")
p4701
as(dp4702
g18
V23354
p4703
stp4704
a((dp4705
g2
(lp4706
VHow are you currently deploying the app
p4707
aVClickOnce can do assembly (GAC) checks before launch, and with msi you should have a whole range of pre-check options available
p4708
aValthough not always feasible, you might consider one of these deployment options
p4709
aVRe catching the exception - just be sure to split the Main up so that it does nothing except catch the exception - otherwise JIT can stop your Main from loading:
p4710
aVIf you put too much in the outer Main, it can barf before running any of it, since JIT might need the types
p4711
as(dp4712
g18
V23354
p4713
stp4714
a((dp4715
g2
(lp4716
VMultiple queues would be useful if you want to actively separate the work - i
p4717
ag50
aVhave different threads/pools for different types of event
p4718
aVIf you want to share the load, there is another option - use an interface (rather than a base-class)
p4719
aVBase-class is fine, but I can't think of anything that would mandate a base-class over an interface
p4720
aVOr even just a delegate to the work to do
p4721
aVAlso - I'm not sure you need a reset event in this case; you can often handle producer/consumer with just lock and Monitor
p4722
aVPulse / Wait (which has less overhead, as no OS-objects are involved - just managed objects)
p4723
aVHowever, if the code is currently stable, perhaps leave "as is" - threading is hard enough to get right once, let alone twice
p4724
aVBut for reference, it would be something like:
p4725
aV(and remember to PulseAll when clearing down the queues)
p4726
as(dp4727
g18
V23354
p4728
stp4729
a((dp4730
g2
(lp4731
VYou can't do much about the actual binding itself, since forms have thread affinity
p4732
aVHowever, you can load the data (from the database or where-ever) on a separate thread - look at BackgroundWorker, for example
p4733
aVIf the db-load is fast, but the binding is slow, you can look at things like "virtual mode" that exists for many standard list-based controls
p4734
aVThis can reduce the time taken to bind by only looking at the immediately visible data
p4735
aVOther than that, you can do things like changing the cursor, showing a splash on another thread, etc
p4736
aVIt really depends where the time is being spent (have you profiled
p4737
as(dp4738
g18
V23354
p4739
stp4740
a((dp4741
g2
(lp4742
VHave you checked PreviousPage for null
p4743
aVFrom msdn:
p4744
aVThe PreviousPage property is a null
p4745
aVreference (Nothing in Visual Basic)
p4746
aVwhen the user requests that page
p4747
aVdirectly from the server
p4748
aVAlso -  in a web form, not a great idea
p4749
aVperhaps use the inbuilt trace
p4750
aVaxd
p4751
as(dp4752
g18
V23354
p4753
stp4754
a((dp4755
g2
(lp4756
VTo check each listener in turn, you need to manually get the handlers via GetInvocationList:
p4757
as(dp4758
g18
V23354
p4759
stp4760
a((dp4761
g2
(lp4762
VA bit of a shift, but you ask about different patterns - how about LINQ
p4763
aVSince you are using VS2008, it is possible (although not guaranteed) that you might also be able to use
p4764
aVNET 3
p4765
ag691
aVA LINQ-to-SQL data-context provides much more managed access to data (filtered, etc)
p4766
aVIs this an option
p4767
aVI'm not sure I'd go "Entity Framework" at the moment, though (see here)
p4768
aVEdit per request:
p4769
aVto get a row from the data-context, you simply need to specify the "predicate" - in this case, a primary key match:
p4770
aVThe use of Single above is deliberate - this particular usage [Single(predicate)] allows the data-context to make full use of local in-memory data - i
p4771
ag50
aVif the predicate is just on the primary key columns, it might not have to touch the database at all if the data-context has already seen that record
p4772
aVHowever, LINQ is very flexible; you can also use "query syntax" - for example, a slightly different (list) query:
p4773
aVetc
p4774
as(dp4775
g18
V23354
p4776
stp4777
a((dp4778
g2
(lp4779
VOne option that might work is using  (and change the thread principal) to become the desired user, like so
p4780
aVBack to p/invoke, though, I'm afraid
p4781
aVAnother cheeky (and equally far from ideal) option might be to spawn a process to do the work
p4782
aVaccepts a ,  and
p4783
aVFinally - perhaps run the service in a dedicated account that has access
p4784
aV(removed as you have clarified that this isn't an option)
p4785
as(dp4786
g18
V23354
p4787
stp4788
a((dp4789
g2
(lp4790
VPossibly a captured variable issue; try adding:
p4791
as(dp4792
g18
V23354
p4793
stp4794
a((dp4795
g2
(lp4796
Vor to control a collection property on a wrapper class:
p4797
as(dp4798
g18
V23354
p4799
stp4800
a((dp4801
g2
(lp4802
VYou could try making your  method more robust to catch (and display) the exception
p4803
aVlike so
p4804
aVFrequently, the problem is that too much code gets into the outermost  method
p4805
aVJIT has to be able to fully understand , otherwise none of your code can run
p4806
aVBy making  simpler, you stand a chance
p4807
aVIn the linked example, if  fails: fine, we can still catch the exception in
p4808
aVThis works because JIT is done on a method-by-method basis
p4809
ag412
ag50
aVis not JITted until it is invoked, by which time we already have our try/catch in place
p4810
as(dp4811
g18
V23354
p4812
stp4813
a((dp4814
g2
(lp4815
VIt depends what you need
p4816
aVthere is  for example
p4817
aVFor working with strings; you could just loop
p4818
aVnot very interesting, but it'll work
p4819
aVWith 3
p4820
aV5, you could use , but this gives you a sequence of strings, not a compound string
p4821
aVIf you are going to use this a lot, you could use a bespoke C# 3
p4822
aV0 extension method:
p4823
as(dp4824
g18
V23354
p4825
stp4826
a((dp4827
g2
(lp4828
VXml namespaces:
p4829
as(dp4830
g18
V23354
p4831
stp4832
a((dp4833
g2
(lp4834
VThey are different models
p4835
aVREST is data-centric, where-as SOAP is operation-centric
p4836
ag412
ag50
aVwith SOAP you tend to have discreet operations "SubmitOrder", etc; but with REST you are typically a lot more fluid about how you are querying the data
p4837
aVSOAP also tends to be associated with a lot more complexity (which is sometimes necessary) - REST is back to POX etc, and YAGNI
p4838
aVIn terms of
p4839
aVNET, tools like "wsdl
p4840
aVexe" will give you a full client-side proxy library to represent a SOAP service (or "svcutil
p4841
aVexe" for a WCF service):
p4842
aVFor REST with
p4843
aVNET, I guess ADO
p4844
aVNET Data Services is the most obvious player
p4845
aVHere, the tooling (datasvcutil
p4846
aVexe) will give you a full client-side data-context with LINQ support
p4847
aVLINQ is
p4848
aVNET's relatively new way of forming complex queries
p4849
aVSo something like (with strong/static type checking and intellisense):
p4850
aV(this will be translated to/from the appropriate REST syntax for ADO
p4851
aVNET Data Services)
p4852
as(dp4853
g18
V23354
p4854
stp4855
a((dp4856
g2
(lp4857
VEither use the assembly-qualified-name, or get hold of the Assembly and use
p4858
aVIn this case, since you want the types in the config file, assembly-qualified is a valid way to go - but since you know all your types are in the same assembly:
p4859
aVThe static  has probing rules that often cause confusion
p4860
aVit looks at the calling assembly, and a few system assemblies - but not all loaded assemblies
p4861
as(dp4862
g18
V23354
p4863
stp4864
a((dp4865
g2
(lp4866
VSee msdn or codeproject
p4867
aVI believe what you want would come under the "Adding Custom Objects to the My Namespace" umbrella
p4868
as(dp4869
g18
V23354
p4870
stp4871
a((dp4872
g2
(lp4873
VHmm
p4874
aVcan't say I've seen that myself, but (as a workaround) you could try toggling the resize mode after you change the columns:
p4875
aVWorth a try
p4876
as(dp4877
g18
V23354
p4878
stp4879
a((dp4880
g2
(lp4881
VIn short: no
p4882
aVNull-check the reference before trying to use it
p4883
aVOne useful trick here might be C# 3
p4884
aV0 extension methods
p4885
aVthey allow you to appear to invoke something on a null reference without error:
p4886
aVOther than that - perhaps some use of the conditional operator
p4887
as(dp4888
g18
V23354
p4889
stp4890
a((dp4891
g2
(lp4892
V1: If you change the class name, you must also change the
p4893
aVasmx (or
p4894
aVsvc for WCF) page, which has a (text) marker to
p4895
aVRight-click the asmx and "View markup" - it should look something like:
p4896
aVChange the  and  to match your current setup
p4897
aV2: ws 1-1 doesn't support overloading
p4898
aVYou simply need to add an attribute to give a unique name to each method on the SOAP interface
p4899
aVHowever, note that this becomes the method name that your proxies will see
p4900
aVFor example, you might change one of the messages as below:
p4901
aVNow update the client; you (if you use wsdl
p4902
aVexe etc) will probably have an  method
p4903
as(dp4904
g18
V23354
p4905
stp4906
a((dp4907
g2
(lp4908
VI can't remember which settings
p4909
aVNET uses (I suspect WinHTTP), but one simple thing to try is (at the command line):
p4910
aVThis imports the Internet Explorer proxy settings into WinHTTP
p4911
aVBeyond that, you can also tweak the proxy settings via configuration (app
p4912
aVconfig/web
p4913
aVconfig/machine
p4914
aVconfig/etc) via the  node
p4915
aVPersonally, I'd try to avoid this (configuration) option - it just increases the number of things you need to remember to maintain
p4916
as(dp4917
g18
V23354
p4918
stp4919
a((dp4920
g2
(lp4921
VIn terms of performance, there is no real difference; field initializers are implemented as constructor logic
p4922
aVThe only difference is that field initializers happen before any "base"/"this" constructor
p4923
aVThe constructor approach can be used with auto-implemented properties (field initializers cannot) - i
p4924
ag50
aVOther than that, I tend to prefer the field initializer syntax; I find it keeps things localized - i
p4925
ag50
aVI don't have to go hunting up and down to find where it is assigned
p4926
aVThe obvious exception is where you need to perform complex logic or deal with constructor parameters - in which case constructor-based initialization is the way to go
p4927
aVLikewise, if you have multiple constructors, it would be preferable for the fields to always get set the same way - so you might have ctors like:
p4928
aVedit: as a side comment, note that in the above, if there are other fields (not shown) with field initializers, then they are only directly initialized in the constructors that call  - i
p4929
ag50
aVthe  ctor
p4930
aVThe other constructor does not run field initializers, since it knows they are done by the  ctor
p4931
as(dp4932
g18
V23354
p4933
stp4934
a((dp4935
g2
(lp4936
VFor the specific question "Will pClass be garbage collected": the event subscription has no effect on the collection of pClass (as the publisher)
p4937
aVFor GC in general (in particular, the target): it depends whether MyFunction is static or instance-based
p4938
aVA delegate (such as an event subscription) to an instance method includes a reference to the instance
p4939
aVSo yes, an event subscription will prevent GC
p4940
aVHowever, as soon as the object publishing the event (pClass above) is eligible for collection, this ceases to be a problem
p4941
aVNote that this is one-way; i
p4942
ag50
aVif we have:
p4943
aVthen "publisher" will keep "target" alive, but "target" will not keep "publisher" alive
p4944
aVSo no: if pClass is going to be collected anyway, there is no need to unsubscribe the listeners
p4945
aVHowever, if pClass was long-lived (longer than the instance with MyFunction), then pClass could keep that instance alive, so it would be necessary to unsubscribe if you want the target to be collected
p4946
aVStatic events, however, for this reason, are very dangerous when used with instance-based handlers
p4947
as(dp4948
g18
V23354
p4949
stp4950
a((dp4951
g2
(lp4952
VExisting answers already show how to add your own indexers
p4953
aVYou might want to look at some of the existing key-based collections, such as , which acts similarly to , but allows key and position indexer usage
p4954
aVAlso - you should be able to use inheritance for much of this type of thing - for example, inheriting from  or
p4955
aVNote that if your collection implements /, I don't recommend the following (which I see occasionally):
p4956
aVThe point is, people expect the integer indexer of an  to be positional
p4957
as(dp4958
g18
V23354
p4959
stp4960
a((dp4961
g2
(lp4962
VIs this winforms, wpf, or asp
p4963
aVnet
p4964
aV[update: ahh
p4965
aVwinforms ;-p]
p4966
aVwinforms wants data to be  (or, indirectly, via ) - so I'm guessing (from the comment) that you are using winforms
p4967
aVNone of the inbuilt dictionary-like collections implement , but to be honest it doesn't matter: if you are data-binding, the volume is probably fairly small, so a regular list should be fine
p4968
aVThe best option is something like a  or , where  has all the properties you want to bind to
p4969
aVIs this an option
p4970
aVIf you are stuck with 1
p4971
aV1 (since you mention  rather than ), then use
p4972
aVExample (in C#):
p4973
as(dp4974
g18
V23354
p4975
stp4976
a((dp4977
g2
(lp4978
VI looked at a few options here, mirroring what F# can do
p4979
aVF# has much better support for type-based switching (although I'm still sticking to C# ;-p)
p4980
aVYou might want to see here and here
p4981
as(dp4982
g18
V23354
p4983
stp4984
a((dp4985
g2
(lp4986
VThe simple option is just to set the forms's AcceptButton to the button you want pressed (usually "OK" etc):
p4987
aVIf this isn't an option, you can look at the KeyDown event etc, but that is more work
p4988
as(dp4989
g18
V23354
p4990
stp4991
a((dp4992
g2
(lp4993
VWell, you could do things with delegates (BeginInvoke, with a callback setting a flag - and the original code waiting for that flag or timeout) - but the problem is that it is very hard to shut down the running code
p4994
aVFor example, killing (or pausing) a thread is dangerous
p4995
aVso I don't think there is an easy way to do this robustly
p4996
aVI'll post this, but note it is not ideal - it doesn't stop the long-running task, and it doesn't clean up properly on failure
p4997
as(dp4998
g18
V23354
p4999
stp5000
a((dp5001
g2
(lp5002
VNick is right to suggest  - in fact, as a matter of routine I always use , which has a (small) performance benefit - but more importantly, this detail is an implementation detail - so you code shouldn't care
p5003
aVIf you want to return a value (such as number of rows updated), use any of:
p5004
aVreturn value
p5005
aVoutput parameter
p5006
aVSELECT statement
p5007
aVThe last has the most overhead
p5008
as(dp5009
g18
V23354
p5010
stp5011
a((dp5012
g2
(lp5013
VRe "Using Other
p5014
aVNet synchronization classes"- some of the others you should know about:
p5015
aVReaderWriterLock - allows multiple readers or a single writer (not at the same time)
p5016
aVReaderWriterLockSlim - like above, lower overhead
p5017
aVManualResetEvent - a gate that allows code past when open
p5018
aVAutoResetEvent - as above, but shuts automatically once opened
p5019
aVThere are also more (low overhead) locking constructs in CCR/TPL (the Parallel Extensions CTP) - but IIRC, these will be made available in
p5020
aVNET 4
p5021
ag190
as(dp5022
g18
V23354
p5023
stp5024
a((dp5025
g2
(lp5026
VNo - there is more
p5027
aVComponentModel allows you to do a few DLR-type things, such as runtime-properties
p5028
aVThis is how a DataView exposes columns to a grid - they aren't reflection properties - they are runtime properties
p5029
aVThe keywords here are  and
p5030
aVThis model also allows abstraction and indirection
p5031
aVFor example, if you are doing a lot of reflection on properties, consider HyperDescriptor - this is a utility I wrote that uses a custom  implementation to swap the reflection model for a pre-compiled model, for huge performance boosts
p5032
aVIn terms of usage, there are some other differences; ComponentModel only supports a single instance of any attribute on a member (unlike reflection, where multiple alike attributes are allows)
p5033
aVAnd it is data-centric - so properties exist, as do events (primarily intended for change notification) - but there are no fields nor methods
p5034
aVIt also has good support for i18n - since the DisplayName etc can be customized on the fly
p5035
aVHowever, ComponentModel is not (directly) compatible with things like LINQ (MemberExpression in particular) - since this wants to bind to reflection data
p5036
aVFinally, ComponentModel is highly used in the IDE by things like PropertyGrid (this is how things like the extra properties for tool-tips work), but equally almost all UI data binding happens via ComponentModel (since this allows the binding to support DataTable, classes, and anything else you can think of)
p5037
as(dp5038
g18
V23354
p5039
stp5040
a((dp5041
g2
(lp5042
VIn
p5043
aVNET, the difference between  and  is primarily that the former  is a generic type, so you get all the benefits of generics in terms of static type checking (and reduced boxing, but this isn't as big as people tend to think in terms of performance - there is a definite memory cost to boxing, though)
p5044
as(dp5045
g18
V23354
p5046
stp5047
a((dp5048
g2
(lp5049
VHmmm
p5050
aVto save some code you could wrap most of the common signatures via delegates, like below (note I've only included the core bits to keep it clear - but you can add your  stuff trivially):
p5051
aVThen you can re-use this for implementations via:
p5052
aVObviously you could add a few signatures for related code, such as:
p5053
as(dp5054
g18
V23354
p5055
stp5056
a((dp5057
g2
(lp5058
VIs this a certificate issue
p5059
aVI haven't had to do this with msi (I usually use ClickOnce, which makes this very easy), but a quick search shows things like this or on MSDN here
p5060
aVNote that your certificate would have to be in the clients trust chain - i
p5061
ag50
aVindirectly from someone "pucka"
p5062
as(dp5063
g18
V23354
p5064
stp5065
a((dp5066
g2
(lp5067
VGC is provided by the CLR
p5068
aVC# is everything that the language spec states, and no more
p5069
aVSome of the more-interesting things that are actually C# features:
p5070
aViterator blocks [yield return]
p5071
aVanonymous methods / closures / lambdas [the syntax, not to be confused with expression trees]
p5072
aVBut anything that relates to the code you type, but which isn't directly provided by either the CLR or the framework is a language feature
p5073
aVOther languages may implement them too, of course
p5074
aVusing [try/finally/Dispose]
p5075
aVlock [Monitor
p5076
aVEnter/try/finally/Monitor
p5077
aVExit]
p5078
aVforeach [GetEnumerator()/while/[Dispose]]
p5079
aVextension method resolution
p5080
aVquery syntax ["where pred" to
p5081
aVWhere(x=>pred) etc]
p5082
aV(these are just a few examples of course; and again - other languages are at liberty to also provide these features
p5083
as(dp5084
g18
V23354
p5085
stp5086
a((dp5087
g2
(lp5088
VYou should be able to use tlbimp with a /keyfile:FileName or /keycontainer:FileName switch to do this
p5089
aVOr I think you used to be able to do it in the IDE, simply by adding a COM reference (there was a checkbox to apply the same key to such)
p5090
aVObviously you could use your existing key
p5091
aVYou might also want to check that  doesn't already do everything you need
p5092
as(dp5093
g18
V23354
p5094
stp5095
a((dp5096
g2
(lp5097
VFirst - don't disable the cross-thread checks
p5098
aVforms have thread affinity
p5099
aVSecond - try to avoid aborting threads; it isn't nice - you should prefer clean shutdown (such as the cancellation that BackgroundWorker supports)
p5100
aVOne option might be to write a wrapper method that:
p5101
aVaccepts a typed delegate (so you can call it more simply)
p5102
aVdoes the necessary checking (throwing an exception to terminate and unroll)
p5103
aVFor example:
p5104
aVThis is still a little messy, but arguably cleaner than aborting threads left and right
p5105
as(dp5106
g18
V23354
p5107
stp5108
a((dp5109
g2
(lp5110
VOperators on  are "lifted" operators
p5111
aVWhat this means is: if T has the operator, T
p5112
aVwill have the "lifted" counterpart
p5113
aV&& and || aren't really operators in the same sense as & and | - for example, they can't be overloaded - from the ECMA spec 14
p5114
aV2
p5115
aV2 Operator overloading:
p5116
aVThe overloadable binary operators are:
p5117
aV+ - * / % & | ^ << >> ==
p5118
aV= > < >= <= Only the operators listed above can be
p5119
aVoverloaded
p5120
aVIn particular, it is not
p5121
aVpossible to overload member access,
p5122
aVmethod invocation, or the =, &&, ||,
p5123
aV,
p5124
aV:, checked, unchecked, new,
p5125
aVtypeof, as, and is operators
p5126
aVLikewise, from the ECMA spec, 14
p5127
ag5115
aV7 Lifted operators, the lifted operators are:
p5128
aVFor the unary operators
p5129
aV+ ++ - --
p5130
aV~
p5131
aVFor the binary operators
p5132
aV+ - * / % & | ^ << >>
p5133
aVFor the equality operators
p5134
aV==
p5135
aV=
p5136
aVFor the relational operators < > <= >=
p5137
aVSo basically, the short-circuiting operators aren't defined as lifted operators
p5138
aV[edit: added crib sheet]
p5139
aVLifted operator: a compiler provided operator on , based on the operators of T - for example: the  "+" operator gets "lifted" onto , defined as:
p5140
aV(int
p5141
aVx, int
p5142
aVy) => (x
p5143
aVHasValue && y
p5144
aVHasValue)
p5145
aV(x
p5146
aVValue + y
p5147
aVValue) : (int
p5148
aVnull;
p5149
aVOperator overloading: the act of providing a custom operator implementation for a given type; for example  and  provide various operator overloads
p5150
aVShort-circuiting: the normal behavior of  and  (in many languages, including C++ and C#) - i
p5151
ag50
aVthe second operand might not be evaluated - i
p5152
ag50
aV(expression1, expression2) => expression1()
p5153
aVexpression2() : false;
p5154
aVOr perhaps a simpler example:
p5155
aVif  returns false, then  isn't executed (since the compiler already knows that the overall answer is false)
p5156
aVThis is important if  has side-effects, since as saving to the database
p5157
as(dp5158
g18
V23354
p5159
stp5160
a((dp5161
g2
(lp5162
VPrior to C# 5, you need to re-declare a variable inside the foreach - otherwise it is shared, and all your handlers will use the last string:
p5163
aVSignificantly, note that from C# 5 onwards, this has changed, and specifically in the case of , you do not need to do this any more: the code in the question would work as expected
p5164
aVTo show this not working without this change, consider the following:
p5165
aVRun the above prior to C# 5, and although each button shows a different name, clicking the buttons shows "Wilma" four times
p5166
aVThis is because the language spec (ECMA 334 v4, 15
p5167
aV8
p5168
aV4) (before C# 5) defines:
p5169
aVis then expanded to:
p5170
aVNote that the variable  (which is your ) is declared outside of the loop
p5171
aVSo by the rules of captured variables, all iterations of the list will share the captured variable holder
p5172
aVFrom C# 5 onwards, this is changed: the iteration variable () is scoped inside the loop
p5173
aVI don't have a specification reference, but it basically becomes:
p5174
aVRe unsubscribing; if you actively want to unsubscribe an anonymous handler, the trick is to capture the handler itself:
p5175
aVLikewise, if you want a once-only event-handler (such as Load etc):
p5176
aVThis is now self-unsubscribing ;-p
p5177
as(dp5178
g18
V23354
p5179
stp5180
a((dp5181
g2
(lp5182
VI suspect you have re-declared the attribute - i
p5183
ag50
aVthe SchemeNameAttribute type is declared (separately) in two assemblies (perhaps by copying a
p5184
aVcs)
p5185
aVThis will not work; types are scoped by their assembly, so SchemeNameAttribute in Foo
p5186
aVdll is a different type to SchemeNameAttribute in Bar
p5187
aVdll/Bar
p5188
aVexe
p5189
aVYou should ensure that the SchemeNameAttribute type is declared once only - if necessary, by moving it to a dll that both the existing assemblies can reference
p5190
as(dp5191
g18
V23354
p5192
stp5193
a((dp5194
g2
(lp5195
VJust a small addition to Jon's post: when used in the normal C# way (i
p5196
ag50
aVvia lambdas / anonymous methods / event handlers / etc), then they are definitely very quick - but note that another important use of delegates can be to execute dynamic code (either methods built at runtime, or existing methods via reflection and Delegate
p5197
aVCreateDelegate)
p5198
aVWhen used in this second way, delegates offer a very significant speed improvement (compared to reflection Invoke etc)
p5199
aVSo don't be shy about using delegates
p5200
aVAnd in particular, if in doubt - measure it for realistic code: it is meaningless whether it takes 1 or 100 micro-weasels*, if this still only accounts for 0
p5201
aV01% of your overall execution time
p5202
aV*=just some arbitrarily small amount of time
p5203
as(dp5204
g18
V23354
p5205
stp5206
a((dp5207
g2
(lp5208
VThe only real way of doing this in C# would be to declare a variable at the start of the method to hold the value - i
p5209
ag50
aVIn VB, you might be able to access the result directly - since IIRC it kinda works like the above (with the method name as "result") anyway
p5210
aVCaveat: I'm really not a VB person
p5211
as(dp5212
g18
V23354
p5213
stp5214
a((dp5215
g2
(lp5216
VIf you are starting with something that has a  or  (such as , , , etc) - then this will be the fastest option, since it doesn't need to go through the // sequence required by  to check for a non-empty  sequence
p5217
aVFor just , then  will generally be quicker, as it only has to look at one iteration
p5218
aVHowever, note that the LINQ-to-Objects implementation of  does check for  (using  as an optimisation) - so if your underlying data-source is directly a list/collection, there won't be a huge difference
p5219
aVDon't ask me why it doesn't use the non-generic
p5220
aVOf course, if you have used LINQ to filter it etc ( etc), you will have an iterator-block based sequence, and so this  optimisation is useless
p5221
aVIn general with  : stick with  ;-p
p5222
as(dp5223
g18
V23354
p5224
stp5225
a((dp5226
g2
(lp5227
VIn terms of efficiency, yes, TryParse is generally the preferred route
p5228
aVIf you can know (for example, by reflection) the target type in advance - but don't want to have to use a big  block, you might be interested in using  - for example:
p5229
as(dp5230
g18
V23354
p5231
stp5232
a((dp5233
g2
(lp5234
VThe main "ugly" there is the stuff at the bottom
p5235
aVI would probably add an extension method  (or just a utility method) - something like:
p5236
aVthen you should be able to use something like:
p5237
aV(unchecked)
p5238
as(dp5239
g18
V23354
p5240
stp5241
a((dp5242
g2
(lp5243
VI was (back in the day) a VB6 dev, and I would expect it to help
p5244
aVThere is a much-commented tendency for VB6 developers to keep writing VB6 in
p5245
aVNET; even just a brief look at C# might help you think about VB
p5246
aVNET as a
p5247
aVNET language, rather than a Visual Studio 6 ancestor
p5248
aVOf course, you might find (as I did) that you don't want to go back to VB
p5249
aVNET after C# ;-p
p5250
aVBut as has already been mentioned - the framework is identical
p5251
aVAnd with C# 4
p5252
aV0, many of the differences will become even less (with "dynamic" making it easier for C# to talk to late-bound COM, and the named arguments / auto-ref stuff making it easier for typed COM)
p5253
aVThere is a lot of drive for converging the feature sets of C# 4
p5254
aV0 and VB
p5255
aVNET in VS2010
p5256
as(dp5257
g18
V23354
p5258
stp5259
a((dp5260
g2
(lp5261
VJust to add - the "xsi" etc is there to support things like xsi:nil on values later on - a well-known pattern for nullable values
p5262
aVIt has to write the stream "forwards only", and it doesn't know (when it writes the first bit) whether it will need nil or not, so it assumes that writing it unnecessarily once is better than having to use the full namespace potentially lots of times
p5263
as(dp5264
g18
V23354
p5265
stp5266
a((dp5267
g2
(lp5268
VTry tweaking the config so it knows about 3
p5269
aV5 - see the config example here
p5270
as(dp5271
g18
V23354
p5272
stp5273
a((dp5274
g2
(lp5275
VIt would be easier (and more appropriate IMO) to serialize the data from the queue - perhaps in a flat array or
p5276
aVSince  implements , you should be able to use:
p5277
as(dp5278
g18
V23354
p5279
stp5280
a((dp5281
g2
(lp5282
VGenerally,  does most of what you normally want
p5283
aVIf you want to customize behaviour, you should inherit from  - this has  methods so you can  tweak behaviour when adding/removing/updating etc
p5284
aVYou can't do this with  since there are no (uesful)  methods
p5285
as(dp5286
g18
V23354
p5287
stp5288
a((dp5289
g2
(lp5290
VNote that another option is to use  (
p5291
aVNET 3
p5292
aV0) - this supports serialization of private members (properties or fields)
p5293
as(dp5294
g18
V23354
p5295
stp5296
a((dp5297
g2
(lp5298
VI believe  is mainly looking at code demands (the assembly etc) - not specific demands such as principal permissions
p5299
aVTo do what you want:
p5300
as(dp5301
g18
V23354
p5302
stp5303
a((dp5304
g2
(lp5305
VWell, is it read only
p5306
aVIn
p5307
aVNET 3
p5308
aV5 / C# 3
p5309
aV0 you could probably use a LINQ join and an anonymous output type pretty easily:
p5310
aVYou can then bind to "Name" and "Value" of data
p5311
aVNote it is easier with typed data-sets, since you can lose the  and  rubbish
p5312
as(dp5313
g18
V23354
p5314
stp5315
a((dp5316
g2
(lp5317
VIn
p5318
aVNET 3
p5319
aV5, there is  and  that act as a multi-map
p5320
aVThe in-built implementation () is immutable, but I have written an  in miscutil
p5321
aVIn that version; yes - I remove the key if the last item (with that key) is removed
p5322
aVThis makes it easier to look at which keys exist (i
p5323
ag50
aVetc)
p5324
as(dp5325
g18
V23354
p5326
stp5327
a((dp5328
g2
(lp5329
VThe null-checking with static methods is different
p5330
aVNot necessarily better or worse - but different, and the developer needs to understand that
p5331
aVBeing able to call a method on a null value can be unexpected, and can (at times) be very useful
p5332
aVNo polymorphism (although overloading is supported)
p5333
aVYou can get into a mess with ambiguity if two extension methods conflict for the source type (and neither qualifies as "better")
p5334
aVThe compiler then refuses to use either
p5335
aVwhich means adding an extension method in assembly A can break* unrelated code in assembly B
p5336
aVI've seen this a couple of times
p5337
aVYou can't use in with C# 2
p5338
aV0, so if you are writing a library for C# 2
p5339
aV0 it doesn't help
p5340
aVIt needs [ExtensionAttribute] - so if you are writing a library for
p5341
aVNET 2
p5342
aV0 you get into a pickle: if you declare your own  [ExtensionAttribute], it might conflict from a
p5343
aVNET 3
p5344
aV5 caller
p5345
aVDon't get me wrong though - I'm a big fan
p5346
aVYou can probably guess I'm currently writing a library that needs to work for C# 2
p5347
aV0 and
p5348
aVNET 2
p5349
aV0 callers - and where (annoyingly) extension methods would be really, really useful
p5350
aV*=for the compiler only; code that is already compiled will be fine
p5351
as(dp5352
g18
V23354
p5353
stp5354
a((dp5355
g2
(lp5356
VThe first 0 means "the first argument" (i
p5357
ag50
aVnumber); the 00 after the colon is the format specifier (2 numeric digits)
p5358
aVHowever, note that
p5359
aVNET strings are UTF-16, so a 2-character string is 4 bytes, not 2
p5360
aV(edit: question changed from  to )
p5361
aVTo get the bytes, use :
p5362
aV(obviously different encodings may give different results; UTF8 will give 2 bytes for this data)
p5363
aVActually, a shorter version of the first bit is:
p5364
aVBut the  version is more flexible
p5365
as(dp5366
g18
V23354
p5367
stp5368
a((dp5369
g2
(lp5370
VIt must allow anonymous access, and publish a "mex" endpoint
p5371
aVIf (as a temporary measure) you host the service in IIS and navigate to the
p5372
aVsvc, it will give you detailed instructions on how to publish "mex"
p5373
aVOr just fire up a clean WCF projet to get this info
p5374
as(dp5375
g18
V23354
p5376
stp5377
a((dp5378
g2
(lp5379
VWith a few exceptions with compiler-sepcific meaning (such as  etc) attributes can't interact directly with code without being asked to
p5380
aVHowever, if you use the AOP tool "PostSharp", your aspect attributes can add behaviour to the class
p5381
aVNot simple, but a very useful trick sometimes
p5382
as(dp5383
g18
V23354
p5384
stp5385
a((dp5386
g2
(lp5387
VAs I recall, there is a  marker
p5388
aV2 secs
p5389
aVPlus the name will be freaky, and it will be a generic type ;-p
p5390
aVActually, for a "get" etc I would probably just use a static (non-extension) method
p5391
aVIf you just want a way to get the value from an instance of an anon-type (at a later point in time), a lambda is probably the best option - note you need a few tricks to pull this off:
p5392
aV(edit re the comment) There definitely is this attribute:
p5393
as(dp5394
g18
V23354
p5395
stp5396
a((dp5397
g2
(lp5398
s(dp5399
g18
V23354
p5400
stp5401
a((dp5402
g2
(lp5403
VAs a guess, I wonder if your connection pool is counting against you - i
p5404
ag50
aVyou have previously executed some commands on  a  that is now being kept around for re-use
p5405
aVYou could try disabling pooling
p5406
aV(pooling=false in the connection string, IIRC)
p5407
aVAlso - have you been careful to close all your commands/connections/readers etc
p5408
aVIdeally via
p5409
aVAs a last resort, you could try using T-SQL to kill all the other spids from your machine - hacky, but it might work
p5410
as(dp5411
g18
V23354
p5412
stp5413
a((dp5414
g2
(lp5415
VExceptions will fault the proxy
p5416
aVYou can't AFAIK do much about that: don't cause exceptions ;-p
p5417
aVI'm a little surprised that one-way is still causing a problem, but for swallowing in general, there are 3 aspects:
p5418
aVare you throwing faults
p5419
aVor exceptions
p5420
aVit matters (and should be "faults")
p5421
aVas a hack, you can enable debug exception messages - but turn it off please
p5422
aVare you "using" the service object
p5423
aVI've just blogged on this exact subject
p5424
aVbasically, your "using" can swallow the exception
p5425
aV3 options:
p5426
aVdon't use "using"
p5427
aVsubclass the proxy and override Dispose()
p5428
aVwrap it, as per the blog
p5429
as(dp5430
g18
V23354
p5431
stp5432
a((dp5433
g2
(lp5434
VFirst, swallowing exceptions is generally a bad idea - could you not write a method that checks the keys etc for existance, and returns the value if one
p5435
aVIf that absolutely, positively isn't possible, you can refactor the code into multiple calls to a single method that (for each) does a try/catch (swallow):
p5436
as(dp5437
g18
V23354
p5438
stp5439
a((dp5440
g2
(lp5441
VYou can clone the old node, append the clone, and remove the original:
p5442
aV(edit; I forgot that AppendChild will move the node if it is already there
p5443
aVno need to clone and remove
p5444
as(dp5445
g18
V23354
p5446
stp5447
a((dp5448
g2
(lp5449
VIt depends on the complexity
p5450
aVIf you only have a few options, a simple for/switch would suffice
p5451
aVIf the options are complex, you might want a class that allows you to map "-c" to "Color" etc
p5452
aVExamples (just the first 2 from google; not a specific recommendation) of this second approach are here and here
p5453
as(dp5454
g18
V23354
p5455
stp5456
a((dp5457
g2
(lp5458
VCSV, when dealing with things like multi-line, quoted, different delimiters* etc - can get  trickier than you might think
p5459
aVperhaps consider a pre-rolled answer
p5460
aVI use this, and it works very well
p5461
aV*=remember that some locales use [tab] as the C in CSV
p5462
as(dp5463
g18
V23354
p5464
stp5465
a((dp5466
g2
(lp5467
VIf this is a  screen, I tend to throw the text into a
p5468
aVtxt file that I embed via a resx file
p5469
aVThen I just edit the txt file
p5470
aVThis then gets exposed as a string property on the generated resx class
p5471
aVIf needed, I embed standard  symbols into my txt for replacement
p5472
as(dp5473
g18
V23354
p5474
stp5475
a((dp5476
g2
(lp5477
VVery, very unsuitable
p5478
aVUse decimal
p5479
aV(example from Jon's page here - recommended reading ;-p)
p5480
as(dp5481
g18
V23354
p5482
stp5483
a((dp5484
g2
(lp5485
VIn reality, creating a dummy file isn't going to have a huge performance impact in most applications
p5486
aVOf course, if you have advanced permissions with create but not destroy it might get a bit hairy
p5487
aVGuids are always handy for random names (to avoid conflicts) - something like:
p5488
as(dp5489
g18
V23354
p5490
stp5491
a((dp5492
g2
(lp5493
VAssuming I read the question correctly, and you want to return  where  (for some  and )
p5494
aVAs an aside - subclassing  isn't usually very useful
p5495
aVdoesn't provide any useful virtual methods
p5496
aVSubclassing  provides more flexibility
p5497
aVOf course, you can make your code not care, by simply coding against the  interface, perhaps adding  so you can create the list itself:
p5498
as(dp5499
g18
V23354
p5500
stp5501
a((dp5502
g2
(lp5503
VNormally, I'd go for the two grids approach - however, you might also want to look at FOR XML - it is fairly easy (in SQL Server 2005 and above) to shape the parent/child data as xml, and load it from there
p5504
aVAlso - LINQ-to-SQL supports this type of model, but you need to tell it which data you want ahead of time
p5505
aVVia DataLoadOptions
p5506
aVLoadWith:
p5507
aVIf you don't use , you will get n+1 queries - one master, and one child list per master row
p5508
as(dp5509
g18
V23354
p5510
stp5511
a((dp5512
g2
(lp5513
VI think you're going to have to simply pass the DataContext to the code (manually)
p5514
aVSorry
p5515
as(dp5516
g18
V23354
p5517
stp5518
a((dp5519
g2
(lp5520
VNo,  items are not disposed when they go out of scope
p5521
aVIt is for precisely this reason that we need  - for deterministic cleanup
p5522
aVThey will eventually get garbage collected, and if there is a finalizer it will (maybe) be called - but that could be a long time in the future (not good for connection pools etc)
p5523
aVGarbage collection is dependent on memory pressure - if nothing wants extra memory, there is no need to run a GC cycle
p5524
aVInterestingly (perhaps) there are some cases where "using" is a pain - when the offending class throws an exception on  sometimes
p5525
aVWCF is an offender of this
p5526
aVI have discussed this topic (with a simple workaround) here
p5527
aVBasically - if the class implements , and you own an instance (i
p5528
ag50
aVyou created it or whatever), it is your job to ensure that it gets disposed
p5529
aVThat might mean via "using", or it might mean passing it to another piece of code that assumes responsibility
p5530
aVI've actually seen debug code of the type:
p5531
aV(where the  calls )
p5532
as(dp5533
g18
V23354
p5534
stp5535
a((dp5536
g2
(lp5537
V"yield" creates an iterator block - a compiler generated class that can implement either  or
p5538
aVJon Skeet has a very good (and free) discussion of this in chapter 6 of C# in Depth
p5539
aVBut basically - to use "yield" your method must return an  or
p5540
aVIn this case:
p5541
as(dp5542
g18
V23354
p5543
stp5544
a((dp5545
g2
(lp5546
VIt sounds like a simple selectmany, group and average should do the job; here I'm using anonymous types and arrays purely for convenience of typing
p5547
as(dp5548
g18
V23354
p5549
stp5550
a((dp5551
g2
(lp5552
VCan you clarify what you want to do
p5553
aVIf the question related to the use of text - as I understand it, the WKT format is pretty normal here, so not a problem
p5554
aVIf you want to return multiple geometry values, something like:
p5555
aVIf you want to work with multiple geometries, declare a table variable and insert the results of such a query:
p5556
aVand work with @data as a set of data
p5557
as(dp5558
g18
V23354
p5559
stp5560
a((dp5561
g2
(lp5562
VI'm a little confused by the question, but here are some thoughts:
p5563
aVhas an s property; if you don't want it to create its own columns, set this to false
p5564
aVTo bind to existing columns, the  must be set on each
p5565
aV(in cmomon with any list control using ) will hugely prefer  (for some
p5566
aV= ) to , since it can get meta-data even for an empty list
p5567
aVIn general, in 2
p5568
aV0 using  is a mistake
p5569
as(dp5570
g18
V23354
p5571
stp5572
a((dp5573
g2
(lp5574
VTo capture stdout you need to redirect it via  - there is an example on MSDN
p5575
aVMake sure also that the exe is marked to be copied to the output directory (bin/release etc)
p5576
aVIf you need to read from both stdout and stderr it gets tricky (with a nave implementation there is a risk of deadlock due to buffering etc)
p5577
aVhere's an example using worker threads
p5578
as(dp5579
g18
V23354
p5580
stp5581
a((dp5582
g2
(lp5583
VUnfortunately, with partial classes you cannot add attributes to a member from another part of the partial class - i
p5584
ag50
aVif SqlMetal defines property , you can't add an attribute to  in your own half of the
p5585
aVThis takes away one of (usually) the more powerful ways of customizing such files
p5586
aVyou would probably have to either take a chance and hand-edit the generated file (after detaching it from the dbml completely) - or write your own dbml parser frmo scratch (mayhbe using xslt)
p5587
aVNot easy
p5588
as(dp5589
g18
V23354
p5590
stp5591
a((dp5592
g2
(lp5593
VA thread per client seems massively overkill, especially given the low overall CPU usage here
p5594
aVNormally you would want a small pool of threads to service all clients, using BeginReceive to wait for work async - then simply despatch the processing to one of the workers (perhaps simply by adding the work to a synchronized queue upon which all the workers are waiting)
p5595
as(dp5596
g18
V23354
p5597
stp5598
a((dp5599
g2
(lp5600
VI'm assuming that a network share isn't an option (perhaps an external site etc)
p5601
aVNote that IIS isn't the only way of hosting a web-service
p5602
aVWith WCF, you can use a console exe or a windows service to host the WCF service, which would allow you to run WCF on the server without any mention of IIS
p5603
aVSee here
p5604
aVThen all you need is line-of-sight to the server, and some code that returns the file (or chunks of it, or a stream of it)
p5605
as(dp5606
g18
V23354
p5607
stp5608
a((dp5609
g2
(lp5610
VMarxidad's answer is good (note you only need , since the upper bound is exclusive) - but watch out for timing
p5611
aVIf you do this in a tight loop, you will get lots of repeats
p5612
aVTo make it more random, consider keeping the Random object in a field - i
p5613
ag50
aVIf it is a static field, you will need to synchronize access
p5614
as(dp5615
g18
V23354
p5616
stp5617
a((dp5618
g2
(lp5619
VWell, you can use an unchecked block and a cast:
p5620
aVor
p5621
aVNot terribly convenient, though
p5622
aVperhaps just use a literal integer
p5623
as(dp5624
g18
V23354
p5625
stp5626
a((dp5627
g2
(lp5628
VI haven't tried it (although I'm a happy customer of their Gantt product), but ILOG have a similar tool here
p5629
aVTo quote:
p5630
aVThe ILOG Diagram for
p5631
aVNET algorithms
p5632
aVshare generic goals such as:
p5633
aVMinimizing the number of overlapping
p5634
aVnodes
p5635
aVMinimizing the number of link
p5636
aVcrossing
p5637
aVMinimizing the total area
p5638
aVof the drawing
p5639
aVMinimizing the number
p5640
aVof bends (in orthogonal drawings)
p5641
aVMaximizing the smallest angle formed
p5642
aVby consecutive incident links
p5643
aVMaximizing the display of symmetries
p5644
aVSupporting incremental layout,
p5645
aVpartial layout, subgraphs,
p5646
aVintergraph links and nested layouts
p5647
aVPerhaps worth a look, at least
p5648
as(dp5649
g18
V23354
p5650
stp5651
a((dp5652
g2
(lp5653
VHave you got the binding's update mode set to DataSourceUpdateMode
p5654
aVOnPropertyChanged
p5655
aVEither via , or using one of the  overloads
p5656
aVThe following works for me to push values to the business object
p5657
as(dp5658
g18
V23354
p5659
stp5660
a((dp5661
g2
(lp5662
VIf I understand FillChar correctly, it sets all elements of an array to the same value, yes
p5663
aVIn which case, unless the value is 0, you probably have to loop:
p5664
aVFor setting the values to the type's 0, there is
p5665
aVObviously, with the loop answer you can stick this code in a utility method if you need
p5666
aVfor example, as an extension method:
p5667
aVThen you can use:
p5668
aVIf you absolutely must have block operations, then  can be used to blit data between array locatiosn - for example, you could write the first chunk, then blit it a few times to fill the bulk of the array
p5669
as(dp5670
g18
V23354
p5671
stp5672
a((dp5673
g2
(lp5674
VNo - you can use any type
p5675
aVFor example, XAttribute has a range of conversions defined that make various conversions simple:
p5676
aVAnother useful example is Jon's  - this is intended to work neatly with classes while disallowing nulls
p5677
aVThe conversion operators make it easy to use
p5678
as(dp5679
g18
V23354
p5680
stp5681
a((dp5682
g2
(lp5683
VCan you illustrate what (if it was regular C#) you want the expression to evaluate
p5684
aVI can write the expression easily enough - I just don't fully understand the question
p5685
aV(edit re comment) - in that case, it'll be something like:
p5686
aVOr if the type refuses to bind, you'll need to inject a cast/convert:
p5687
as(dp5688
g18
V23354
p5689
stp5690
a((dp5691
g2
(lp5692
VI suspect that in your real code you are writing to a  and not rewinding it; if this is the case, set Position to 0 before you try to re-load it
p5693
as(dp5694
g18
V23354
p5695
stp5696
a((dp5697
g2
(lp5698
VIf you are getting problems with deadlocks, it would be better to look at what the SQL code is doing
p5699
aVFor example, lock-escalation deadlocks are very easy to create if you have serializable isolation level (or whatever the equivalent is in your rdbms) - and can be mitigated in a few ways, such as re-ordering queries, or (in SQL Server at least) using the (UPDLOCK) to take a write lock earlier (so you don't get a competing read-lock)
p5700
aVRe-trying is going to be mixed
p5701
aVfor example, if you are in a TransactionScope, it might already have aborted
p5702
aVBut just at the purist level - if I get problems talking to the db I want my code to panic, and panic early
p5703
aVre-try seems a bit hacky in this particular scenario
p5704
as(dp5705
g18
V23354
p5706
stp5707
a((dp5708
g2
(lp5709
VYou would need to consume the
p5710
aVNET dll as a COM callable wrapper
p5711
aVThis generally involves marking it as COM-visible (via attributes), and registering it as a COM component (regasm
p5712
aVSee MSDN for more
p5713
aVThe server will need the
p5714
aVNET framework, of course
p5715
as(dp5716
g18
V23354
p5717
stp5718
a((dp5719
g2
(lp5720
VSetting a field is, as already discussed, problematic
p5721
aVYou can can (in 3
p5722
aV5) a single method, such as a property-setter - but only indirectly
p5723
aVThis gets much easier in 4
p5724
aV0, as discussed here
p5725
aVHowever, if you actually have properties (not fields), you can do a lot simply with :
p5726
as(dp5727
g18
V23354
p5728
stp5729
a((dp5730
g2
(lp5731
VThe whole idea of serializing a delegate is very risky
p5732
aVNow, an expression might make sense, but even that is hard to express - although the dynamic-LINQ samples go some way to allowing a form of text-based expression
p5733
aVWhat exactly is it you want to do with a serialized delegate
p5734
aVI really don't think this is a good idea
p5735
as(dp5736
g18
V23354
p5737
stp5738
a((dp5739
g2
(lp5740
VThe "best" approach is probably to use the helpers:
p5741
aVWhere "data" could be an array of anonymous types, such as:
p5742
aVAnother approach might be to select the correct item client-side through script, but obviously that only works with script enabled
p5743
aVNote it was missing comma and semicolon in data declaration, stopped it from working
p5744
as(dp5745
g18
V23354
p5746
stp5747
a((dp5748
g2
(lp5749
VActually, for the above type of query, the dynamic LINQ stuff is quite a good fit
p5750
aVOtherwise you'll have to write pretty-much the same anyway - a parser, and a mechanism for mapping that to attributes
p5751
aVUnfortunately it isn't an exact hit, since you need to split things like OrderBy, and dates need to be parameterized - but here's a working example:
p5752
aVOf course, you could take the dynamic LINQ sample and customize the parser to do more of what you need
p5753
as(dp5754
g18
V23354
p5755
stp5756
a((dp5757
g2
(lp5758
VWhat exactly does this "custom made program" look like
p5759
ag412
ag50
aVhow is it talking to the data
p5760
aVMinimising the amount of network IO (from a db server to an app) would be a good start
p5761
aVtypically this might mean doing a lot of work in TSQL, but even just running the app on the db server might help a bit
p5762
aVIf the app is re-writing large chunks of data, it might still be able to use bulk insert to submit the new table data
p5763
aVEither via command-line (bcp etc), or through code ( in
p5764
aVNET)
p5765
aVThis will typically be quicker than individual inserts etc
p5766
aVBut it really depends on this "custom made program"
p5767
as(dp5768
g18
V23354
p5769
stp5770
a((dp5771
g2
(lp5772
VTo talk to the same instance between AppDomains, it must inherit from MarshalByRefObject
p5773
aVDone this way, every method call to the object (including properties etc) is actually a remoting call to the other app-domain
p5774
aVDoes that help
p5775
as(dp5776
g18
V23354
p5777
stp5778
a((dp5779
g2
(lp5780
VThe form is a representation of what the client sent in the request
p5781
aVWhat is it you want to do
p5782
aVPersonally, I would try to separate the "read the form" code from the "do something with the values" code - that way, you can do any pre-processing early on (when reading from the form), and none of the later code needs to know about what was actually sent - it just takes the values given to it (i
p5783
ag50
aVit never talks to the request directly)
p5784
aVIf also means you can test your logic without the need for a form, or even an http-request at all
p5785
aVActually, ASP
p5786
aVNET MVC will do a lot of this (the above paragraph) for you
p5787
aVNote that you can update the
p5788
aVItems collection - but this is a bit more vague (i
p5789
ag50
aVit doesn't relate specifically to the form)
p5790
aV(cheers for fixing the typo btw)
p5791
as(dp5792
g18
V23354
p5793
stp5794
a((dp5795
g2
(lp5796
VTo be honest, since you are using DataTable, you might as well just sort at the client
p5797
aVDynamic sorting (at the server) via SPs etc is always a pain; to do it in pure TSQL, you either need some horribly inefficient CASE block at the end of the SELECT, or you need to use dynamic SQL (for example via sp_ExecuteSQL), manipulating the ORDER BY in the final query
p5798
aVThe only other option (in raw TSQL) would be to EXEC/INTO to get the data into a table variable (or temp table), then SELECT from this with an ORDER BY
p5799
aVIf it is an option, LINQ-to-SQL actually does OK at this; it supports querying (and composing against) UDFs - so rather than an SP, code the query in a UDF (the SP can always just SELECT from the UDF if you need to support legacy callers)
p5800
aVThen you can use "order by" etc in a LINQ query:
p5801
aV(or there are various methods for adding a dynamic sort to a LINQ query - the above is just a simple example)
p5802
aVthe final TSQL will be something like:
p5803
ag412
ag50
aVit will get it right, and do the "ORDER BY" at the server
p5804
aVThis is particularly useful when used with  and  to get paged data
p5805
as(dp5806
g18
V23354
p5807
stp5808
a((dp5809
g2
(lp5810
VI suspect tracing is the most robust option
p5811
aVSome things (like LINQ-to-SQL) allow query logging, but certainly not all
p5812
aVBut you have more safety that a trace will catch everything
p5813
aVNote that "minor syntax differences" will make it very painful to compare, of course
p5814
as(dp5815
g18
V23354
p5816
stp5817
a((dp5818
g2
(lp5819
VWhat do you call "very large"
p5820
aVAnd what is the string
p5821
aVCLOB
p5822
aVBLOB
p5823
aVxml
p5824
aVI suspect you should be using things like , which (via ) exposes methods for reading such columns in chunks:
p5825
aVObviously with xml you might want an  via
p5826
aVUpdated re LINQ comment (now deleted):
p5827
aVTo use  directly from LINQ-to-SQL, I expect the closest you can get is , passing it a query
p5828
aVYou would then use  or  as above
p5829
aVI don't know much about EF
p5830
aVIf you give an example of the type of query that is failing, there might be some tricks possible - for example, if you are filtering or selecting subsets of the xml, there are things you can do in SQL/XML - perhaps in a UDF called via LINQ-to-SQL
p5831
as(dp5832
g18
V23354
p5833
stp5834
a((dp5835
g2
(lp5836
VIt sounds like you are talking about a work queue
p5837
aV(and I sound like clippy
p5838
aVFor the record, thread-pool threads should typically be used for short pieces of work
p5839
aVYou should ideally create your own threads for a long-lived queue
p5840
aVNote that
p5841
aVNET 4
p5842
aV0 may be adopting the CCR/TPL libraries, so we'll get some inbuilt work queues for free - but it isn't hard to write a threaded work-queue
p5843
aVAnd you can make it generic, too ;-p
p5844
aVRe the question - I prefer the captured variables approach to passing state into threads (be they , , or ):
p5845
aVThis gives you much more granular control over the thread, without saturating the
p5846
as(dp5847
g18
V23354
p5848
stp5849
a((dp5850
g2
(lp5851
VThe keys are all strings
p5852
aVthen  would probably do the job
p5853
aVbut when getting values out, you would either need to use , or you'd need to cast:
p5854
as(dp5855
g18
V23354
p5856
stp5857
a((dp5858
g2
(lp5859
VYour current code is broken
p5860
aVthere is only one static field; the last static ctor to execute wins
p5861
aVRe using a non-static method - note that calling virtual/abstract methods in a constructor is a bit dangerous - the concrete class won't have initialized yet, so the override could attempt to use data that isn't yet available
p5862
aVCan ResourceManager not be an argument to the base-constructor
p5863
aVIf they pass null, you use a sensible default
p5864
aVProcessError would then accept a ResourceManager, etc
p5865
aVand:
p5866
aVClasses that don't want to provide their own manager just use the other ctor:
p5867
as(dp5868
g18
V23354
p5869
stp5870
a((dp5871
g2
(lp5872
VHow about moving the processing of Name etc into a method (accepting either a User or a T : User), and call that from both
p5873
aVAs an alternative, you could reduce the line count, but increase the complexity, using generics:
p5874
as(dp5875
g18
V23354
p5876
stp5877
a((dp5878
g2
(lp5879
VWith some effort, you can make regex work on html - however, have you looked at the HTML agility pack
p5880
aVThis makes it much easier to work with html as a DOM, with support for xpath-type queries etc (i
p5881
ag50
aV"//div[@class='article']")
p5882
as(dp5883
g18
V23354
p5884
stp5885
a((dp5886
g2
(lp5887
VBased on the March files in my %tmp%, I'd say not
p5888
aVRe why they are called temporary - because that is their expected usage
p5889
aVThey aren't system files; they aren't application files, and they aren't user documents
p5890
aVthey exist only to allow an app to do temporary processing (perhaps on large volumes of data), or often to pass data via IPC to another process
p5891
aVHence they really are temporary
p5892
aVYou should aim to delete any temp files you create, fatal "kill" etc not withstanding
p5893
aVI often use "using" for this - I create a wrapper class - i
p5894
ag50
as(dp5895
g18
V23354
p5896
stp5897
a((dp5898
g2
(lp5899
VEdit: The following works with , but does not work with the JavascriptSerializer from the OP
p5900
aVSo this is just for refernence
p5901
as(dp5902
g18
V23354
p5903
stp5904
a((dp5905
g2
(lp5906
VRegular expressions are often over-used, but this is a pretty good example of when a regex is ideal
p5907
aVso: why can't you use them here
p5908
as(dp5909
g18
V23354
p5910
stp5911
a((dp5912
g2
(lp5913
VIs the textbox for editing the node
p5914
aVor for secondary data
p5915
aVIf the node, it can already be editable (Edit/BeginEdit or something)
p5916
aVIf secondary data, I would be quite tempted to push this into a single textbox that displays/edits the data for the current selected node
p5917
aVThat may text-boxes is going to be confusing
p5918
aVAlternatively, there are some treeview/grid combined controls available from 3rd parties
p5919
aVMight be a good fit
p5920
aVHere's (look for ) a quick search hit (not a specific recommendation - just a search result)
p5921
as(dp5922
g18
V23354
p5923
stp5924
a((dp5925
g2
(lp5926
VAhh
p5927
aVtry:
p5928
aVThis then should allow you to pass any sequence of things that implement  - and the generic type inference should mean you don't need to specify the  (as ) yourself - the compiler will handle it
p5929
aVBy the way - avoid concatenation here;  is preferable:
p5930
as(dp5931
g18
V23354
p5932
stp5933
a((dp5934
g2
(lp5935
VIf you want performance, you want a direct hit on the index, without any CPU etc per row; as such, I would calculate the range first, and then use a simple WHERE query
p5936
aVI don't know what db you are using, but in SQL Server, the following works:
p5937
as(dp5938
g18
V23354
p5939
stp5940
a((dp5941
g2
(lp5942
VFrom comment: " So how would I go about implementing a similar method"
p5943
aVAll you need here is any generic method:
p5944
aVthen you can have:
p5945
aVThe compiler provides the  via generic type inference
p5946
aVA bit cheeky, but you can even do it without actaully ever creating an instance of the anon-type:
p5947
aVAgain, the  is provided by the compiler via the return value of the lambda
p5948
as(dp5949
g18
V23354
p5950
stp5951
a((dp5952
g2
(lp5953
VFor info, it is likely (here) that
p5954
aVNET 4
p5955
aV0 will inherit the CCR/TPL from Parallel Extensions
p5956
aVTPL, in particular, introduces a range of collections and other constructs designed for advanced threading scenarios (with minimal locks etc)
p5957
aVFor now, there are a limited number of threaded collections etc, plus the usual locking primatives, plus , etc
p5958
as(dp5959
g18
V23354
p5960
stp5961
a((dp5962
g2
(lp5963
VHard to diagnose without more detail - perhaps permissions
p5964
aVa little bit of exception handling (perhaps writing stack-trace to stderr) would help enormously
p5965
aVbut not much help if you don't own the app
p5966
aVIf you don't get anywhere, you could try using reflector to see what the
p5967
aVNET app is doing during "Detecting" - it might help identify the cause
p5968
as(dp5969
g18
V23354
p5970
stp5971
a((dp5972
g2
(lp5973
VIf you want simple, and all the methods are in the same class, ou can just use :
p5974
aVFor instance methods, this locks on ; for static methods, this locks on
p5975
aVAs such, these lock objects are public - so there is a remote (but genuine) chance that another bit of code might be locking on them
p5976
aVIt is generally considered better practice to create your own lock object:
p5977
aVetc
p5978
aVAside: a curious fact; the ECMA spec doesn't define a specific pattern for [MethodImpl], even including an example of a private lock, as "valid"
p5979
aVThe MS spec, however, insists on this/typeof
p5980
as(dp5981
g18
V23354
p5982
stp5983
a((dp5984
g2
(lp5985
VI haven't looked in depth, but it is curious that your SharpZipLib wrapper ignores  and  in BeginRead:
p5986
aVCall me crazy, but probably use  etc directly (or the System
p5987
aVCompression counterparts)
p5988
aVsaves a lot of implementation details
p5989
as(dp5990
g18
V23354
p5991
stp5992
a((dp5993
g2
(lp5994
VPersonally, I like the simplicity of a single timestamp/row-version column; set this as the only column to be checked (IIRC, happens automatically for ), and you're sorted - you should then get TSQL like:
p5995
aVThis relies on their not being concurrent (non-conflicting) updates to the same record; with a timestamp/row-version etc, any conflicting update will cause the second to abort, even if they updated different columns etc
p5996
as(dp5997
g18
V23354
p5998
stp5999
a((dp6000
g2
(lp6001
VWith linq-to-sql (from tags), then yes: you can mark the dmbl as serializable, which uses the [DataContract]/[DataMember] approach
p6002
aVYou do this by setting the "Serialization Mode" to "Unidirectional" in the designer, or you can do it in the dbml itself:
p6003
aVYou can then use DataContractSerializer or NetDataContractSerializer to write this (as xml or binary respectively)
p6004
aVIf you need something portable (i
p6005
ag50
aVnot MS/
p6006
aVNET specific), then protobuf-net will serialize data-contracts using the "protocol buffers" spec
p6007
as(dp6008
g18
V23354
p6009
stp6010
a((dp6011
g2
(lp6012
VLINQ-to-SQL only translates a subset of operations - and it trying (and failing) to write ConvertTimeFromUtc as TSQL
p6013
aVSome operations have TSQL counterparts (dateadd/datediff/etc) - but not all
p6014
aVYou might choose to do your projection (select) using the raw value, and only do the ConvertTimeFromUtc once you have the object in memory (via LINQ-to-Objects)
p6015
aVFor example - you could create the objects just using p
p6016
aVCreatedOn, then do the rest afterwards
p6017
aVNot ideal, but life
p6018
aVLINQ-to-Entities claims better translation options, but is significantly more complex
p6019
aVDepending on your scenario, LINQ-to-SQL also offers udf support, which sometimes lets you offload these things to the db - if there is a way of writing it as a udf - for example, you could write a method on the data-context and mark is as a composable function (), then something like:
p6020
aVWhich would then use the TSQL from  - i
p6021
ag50
aVsomething like:
p6022
as(dp6023
g18
V23354
p6024
stp6025
a((dp6026
g2
(lp6027
VWCF should not be treated as simply http - i
p6028
ag50
aVit won't normally make sense to do what you have suggested above
p6029
aVYou can do something comparable by writing a "message inspector" that adds a WCF header
p6030
aVA WCF service is not a , and can't be treated as one
p6031
aVFor the request, there is as as ASP
p6032
aVNET compatibility flag that can be enabled (providing access to ), but the general advice is: don't
p6033
aVSo: what is it you are actually trying to do
p6034
aVWhat is your objective here
p6035
as(dp6036
g18
V23354
p6037
stp6038
a((dp6039
g2
(lp6040
VCF, in general contains a subset of the classes from the regular framework - but you can't directly execute code from one on t'other
p6041
aVAdditionally, rather than just being a subset, there are probably a few things in compact that aren't in the regular version, such as the GUI things specific for mobile devices (soft keys, etc) - assuming you are writing a winform exe, and not a web page (which might be the simplest way to get compatibility)
p6042
aVWith some effort, it it possible to share logic code, in particular utility dlls - but they need different csproj files (since they have completely different compile-time "targets")
p6043
aVTo reduce maintenance, you can often cheat by hacking the csproj to use wildcards, like from here:
p6044
aVFor UI, things get a lot tricker
p6045
aVIn general the expectation would be to have shared business logic and separate UI for different target devices
p6046
as(dp6047
g18
V23354
p6048
stp6049
a((dp6050
g2
(lp6051
VCan I clarify
p6052
aVIt sounds like you want to use client-side activex controls embedded in the html (via )
p6053
aVIs that correct
p6054
aVThis isn't a very safe approach; many browsers / platfroms simply won't work this way
p6055
aVIf you know your client is IE/windows, then you can perhaps sign the ocx in a cab, marked with the safe-for-scripting / safe-for-initialization flags
p6056
aVBUT - this is not recommended
p6057
aVIf you want a rich client-side experience, consider Silverlight, or a ClickOnce-deployed smart-client if you need richer access to things like scanners etc
p6058
aVIf you mean server-side, then you probably need to install the components on the server
p6059
aVRegistry-free COM might work, but isn't easy to configure
p6060
aVIf you don't own the server (i
p6061
ag50
aVit is hosted for you), then perhaps COM isn't the way to go in the first place
p6062
as(dp6063
g18
V23354
p6064
stp6065
a((dp6066
g2
(lp6067
VWhat are you using as the data-source
p6068
aVa
p6069
aVThe sort is most commonly provided by the list itself, so you could actually write a custom list with your own specific sort behaviour
p6070
aVThe simplest approach (although still non-trivial) would be to inherit from , and override , , , ,  and  (phew
p6071
aVIn particular, the  would have to detect the specific , and perform the bespoke search
p6072
aVI'm not saying it is trivial (quite the opposite) - but it can be done within the standard binding mechanisms
p6073
aVAn alternative idea might be to make the id something else, that isn't actually an int, but is a custom class/struct
p6074
aVIt would need to implement /, and have a  that displays the desired text
p6075
aVThen you could presumably (untested) bind directly to that column
p6076
aVHowever
p6077
aVIf you aren't already familiar with , I would suggest avoiding this complexity
p6078
aVIf the above makes sense, then fine - if not, I'm not sure I would attempt it for your first stab into that area
p6079
as(dp6080
g18
V23354
p6081
stp6082
a((dp6083
g2
(lp6084
VWell, you've got complications if the two vectors are of different sizes
p6085
aVAs has already been pointed out, this doesn't increase the overall complexity of the issue, so I'd stick with the simplest code - which is probably 2 loops, rather than 1 loop with complicated test conditions re the two different lengths
p6086
aVActually, these length tests could easily make the two loops quicker than a single loop
p6087
aVYou might also get better memory fetch performance with 2 loops - i
p6088
ag50
aVyou are looking at contiguous memory - i
p6089
ag50
aVA[0],A[1],A[2]
p6090
aVB[0],B[1],B[2]
p6091
aV, rather than A[0],B[0],A[1],B[1],A[2],B[2]
p6092
aVSo in every way, I'd go with 2 separate loops ;-p
p6093
as(dp6094
g18
V23354
p6095
stp6096
a((dp6097
g2
(lp6098
VWell,
p6099
aVNET 4
p6100
aV0 will require CLR 4
p6101
aV0; however, it is a little harder to answer what parts of C# 4
p6102
aV0 will work on
p6103
aVNET 2
p6104
aV0/3
p6105
aVx
p6106
aVWe can hope that VS2010 will still be multi-targeting(I  don't have the CTP "on me" so to speak, so I can't check
p6107
aVBut some of the language features don't seem hugely tied to the runtime (named parameters, some of the COM changes such as "ref") - so I can't think of a good reason why they wouldn't be available when talking to
p6108
aVNET 2
p6109
aV0/3
p6110
ag6106
aVI haven't checked, though
p6111
aVHowever, as with C# 3
p6112
aV0, some of the features are tied to the runtime - in particular
p6113
aVI need to dig out the CTP and have another play, methinks
p6114
as(dp6115
g18
V23354
p6116
stp6117
a((dp6118
g2
(lp6119
VThere is no such thing as "a DateTime of type yyyyMMdd"; a DateTime is just a large integer, indicating the amount of time in an epoch - it doesn't have a format
p6120
aVBut that is fine, since you should be using parametrized TSQL anyway - so just add the DateTime as the value of a DbParameter, and it will be handed to the db in an unambiguous way (don't use string concatenation to build a TSQL command):
p6121
aVor for a :
p6122
aVIf you genuinely need a string, then just use the string directly as a [n][var]char parameter
p6123
aVAlso - in this case, to parse the date I would use the invariant culture (since culture doesn't feature in the format):
p6124
aVFrom the conversation, it seems you might also need to go from a DateTime to a string, in which case simply reverse it:
p6125
as(dp6126
g18
V23354
p6127
stp6128
a((dp6129
g2
(lp6130
VYou would need to create a class for the state:
p6131
as(dp6132
g18
V23354
p6133
stp6134
a((dp6135
g2
(lp6136
VWouldn't  here actually return the xml itself
p6137
aVIf so:
p6138
as(dp6139
g18
V23354
p6140
stp6141
a((dp6142
g2
(lp6143
VWell, what does the final file look like
p6144
aV(compared to the original)
p6145
aVYou don't show the zipping code, which might be part of the puzzle, especially as you are partially swallowing the exception
p6146
aVI would also try ensuring everything  is d, ideally via ; also - in case the problem is with path construction, use
p6147
aVAnd note that if  contains sub-directories, you will need to create them manually
p6148
aVHere's what I have - it works for unzipping ICSharpCode
p6149
aVSharpZipLib
p6150
aVdll:
p6151
aVIt could also be that the problem is either in the code that writes the zip, or the code that reads the generated file
p6152
as(dp6153
g18
V23354
p6154
stp6155
a((dp6156
g2
(lp6157
VIf you implement the partial method, then I would expect there to be no noticeable difference
p6158
aVC# always uses  to invoke instance methods, even if they aren't virtual, so there won't be much change
p6159
aVIf you don't implement the partial method, then the call itself is removed - so there is never a stack to prepare etc
p6160
aVThis will be infintessimally quicker, which is why it is fine for generated code to include a ludicrous number of partial method stubs: if you don't use them, they don't exist
p6161
aVThe bigger reason to use partial methods is simply so you don't have to subclass the object
p6162
aVYou can't declare "abstract"/"virtual" and "override" parts of a virtual method in the same class (even if partial)
p6163
aVPartial methods solves this problem, and the problem of advertising extensibility points (without having to use reflection)
p6164
aVVery good for code-generation tools ;-p
p6165
as(dp6166
g18
V23354
p6167
stp6168
a((dp6169
g2
(lp6170
VA finalizer (aka destructor) is part of garbage collection (GC) - it is indeterminate when (or even if) this happens, as GC mainly happens as a result of memory pressure (i
p6171
ag50
aVneed more space)
p6172
aVFinalizers are usually only used for cleaning up unmanaged resources, since managed resources will have their own collection/disposal
p6173
aVHence  is used to deterministically clean up objects, i
p6174
ag50
aVnow
p6175
aVIt doesn't collect the object's memory (that still belongs to GC) - but is used for example to close files, database connections, etc
p6176
aVThere are lots of previous topics on this:
p6177
aVdeterministic finalization
p6178
aVdisposing objects
p6179
aVusing block
p6180
aVresources
p6181
aVFinally, note that it is not uncommon for an  object to also have a finalizer; in this case,  usually calls , meaning that GC doesn't run the finalizer - it simply throws the memory away (much cheaper)
p6182
aVThe finalizer still runs if you forget to  the object
p6183
as(dp6184
g18
V23354
p6185
stp6186
a((dp6187
g2
(lp6188
VGeneric operators (in MiscUtil) is a pretty well utilised bit of code based on expression trees; very simple, but very versatile
p6189
aVSome other ideas:
p6190
aVcloning objects
p6191
aVdynamic ordering
p6192
aVdynamic LINQ
p6193
aV(lots of others)
p6194
as(dp6195
g18
V23354
p6196
stp6197
a((dp6198
g2
(lp6199
V(based on the edited version that doesn't swallow exceptions)
p6200
aVHow long do the operations take
p6201
aVIf any of them are very long running, it is possible that the Transaction Binding bug feature has bitten you - i
p6202
ag50
aVthe connection has become detached
p6203
aVTry adding  to the connection string
p6204
as(dp6205
g18
V23354
p6206
stp6207
a((dp6208
g2
(lp6209
V isn't alone here; , , , etc are also custom types
p6210
aVI guess the main reason is that they don't map to CPU primatives
p6211
aV(IEEE 754), , etc are pretty ubiquitous here, but  is bespoke to
p6212
aVNET
p6213
aVThis only really causes a problem if you want to talk to the operators directly via reflection (since they don't exist for int etc)
p6214
aVI can't think of any other scenarios where you'd notice the difference
p6215
aV(actually, there are still structs etc to represent the others - they are just lacking most of what you might expect to be in them, such as operators)
p6216
as(dp6217
g18
V23354
p6218
stp6219
a((dp6220
g2
(lp6221
VYou should also see a reset () between uses of the same connection in the pool; will that not reset the isolation level
p6222
aVHave you tried reproducing a serializable issue (for example, lock escalation deadlocks)
p6223
as(dp6224
g18
V23354
p6225
stp6226
a((dp6227
g2
(lp6228
VThere is nothing special about a console exe; it is just a PE file
p6229
aVSo regardless of console vs winform exe vs windows service, it is just going to run in whatever mode it was compiled
p6230
aVVisual Studio etc will never generate a 16-bit exe
p6231
aVx86 vs x64 is more interesting ;-p
p6232
aVProbably, your friend doesn't have the
p6233
aVNET framework installed (or only has 1
p6234
aV1)
p6235
as(dp6236
g18
V23354
p6237
stp6238
a((dp6239
g2
(lp6240
VPretty much every serialization engine is going to want to know that your objects are suitable
p6241
aVThis can take the form of:
p6242
aV/ (,)
p6243
aV/ (and ) ()
p6244
aV/ (or most of the above) ( and variants)
p6245
aVAFAIK, there is no way of avoiding this step
p6246
as(dp6247
g18
V23354
p6248
stp6249
a((dp6250
g2
(lp6251
VThis scenario typically doesn't scale very well
p6252
aVyou could look into SQL notification services, but this has the same issues
p6253
aVIn one system, I do this by having triggers that write a brief summary of changes to a (single) delta table, including the table, change-type, and row-id
p6254
aVEach client maintains a "where I've read to", and simply asks for all delta records with id > this number
p6255
aVThe problem is you need to do some clever stuff to clear down the table without trashing any individual clients change history
p6256
ag412
ag50
aVtrack logoffs, assume they are dead past a given time, and log when they do a full refresh
p6257
aVDefinitely doable, but lots of work
p6258
as(dp6259
g18
V23354
p6260
stp6261
a((dp6262
g2
(lp6263
VIf you are using reflection (and hence lots of ), why not just cast as an  (non-generic) instead
p6264
ag412
ag50
aVAlso - for your original code with , you don't mean  - you should just cast (since we expect  to be an )
p6265
as(dp6266
g18
V23354
p6267
stp6268
a((dp6269
g2
(lp6270
Vprotobuf-net (my version of protocol buffers in
p6271
aVNET) has primitive support for generating proto files, but it wouldn't be hard to fill in the blanks
p6272
aVI concentrated on the core engine first, then the generation of C# from proto
p6273
aVWriting an xslt to generate a proto from the object model wouldn't be much different
p6274
aVIt would take a few days though
p6275
aV(I have limited time at the moment)
p6276
aVIf this would be useful, please let me know
p6277
aVFor info, the protobuf-net engine is compatible with most  classes (and , and recently ) - so if your code currently works as xml, we can probably get it working in protobuf-net
p6278
aVNo guarantees, of course
p6279
as(dp6280
g18
V23354
p6281
stp6282
a((dp6283
g2
(lp6284
VWhat is the issue you are having
p6285
aVAnd what LINQ provider is this
p6286
aVAn in-memory set (LINQ-to-Objects)
p6287
aVOr LINQ-to-SQL
p6288
aVOr LINQ-to-Entities
p6289
aVI suspect you are getting something about the db LINQ provider not knowing about Trim() - in which case, try doing the trim first:
p6290
aVThis addresses two three separate issues:
p6291
aV1: captures: in the original, it is  that is captured into the query, which has complications; by evaluating the  first, it is  that is captured, which is a simple immutable string
p6292
aV2: expression complexity: with expression-based LINQ (i
p6293
ag50
aVto a database), the entire expression (including , , etc) is part of the expression
p6294
aVIf the LINQ provider doesn't recognise one or more of those, it will fail
p6295
aVBy reducing it to a string first, all the LINQ provider needs to handle is a string, which every provider should be fine with
p6296
aV(added)
p6297
aV3: repeated computation: LINQ-to-Objects is very literal; if you ask it to use a complex operation in a Where (etc), it will, even if it is obvious that the answer is unchanged per row; i
p6298
ag50
aVshouldn't change per row, so why evaluate it per row
p6299
aVEvaluate it before the query and it is only done once
p6300
as(dp6301
g18
V23354
p6302
stp6303
a((dp6304
g2
(lp6305
VWhat tool are you using
p6306
aVwsdl
p6307
aVexe
p6308
aVor svcutil
p6309
aVexe
p6310
aVIf you are adding a "service reference", then that is WCF, so svcutil
p6311
aVexe is used - this names things as clients
p6312
aVThere is, however, still the option to use the old wsdl
p6313
aVexe tool
p6314
aVIn the IDE you do this via "Advanced
p6315
aV-> "Add Web Reference
p6316
aV- this will generate a 2
p6317
aV0 style service proxy
p6318
aVRe the names; WCF is correct - the proxy class is a client, not a service
p6319
as(dp6320
g18
V23354
p6321
stp6322
a((dp6323
g2
(lp6324
VCan't you simply check whether GetProductName returns null
p6325
as(dp6326
g18
V23354
p6327
stp6328
a((dp6329
g2
(lp6330
VHere's an example of both approaches
p6331
aVIf I have missed something, or you want more information, just let me know
p6332
aVPersonally, I would aim towards the first method; it it both simpler and more efficient
p6333
aVThis might involve passing the original parameter throughout a stack of nested code, but so be it
p6334
aVI have got some code somewhere that takes the "Invoke" approach (composite), and re-writes the tree as the first approach (single) - but it is quite complex and long
p6335
aVBut very useful for Entity Framework (which doesn't support Expression
p6336
aVInvoke)
p6337
as(dp6338
g18
V23354
p6339
stp6340
a((dp6341
g2
(lp6342
VI think that is a mistake in MSDN
p6343
aVIt happens
p6344
aVClient Profile is "RTM", so no: this isn't a beta release AFAIK
p6345
aVI will try to look a bit more
p6346
aVReally interesting question, BTW
p6347
as(dp6348
g18
V23354
p6349
stp6350
a((dp6351
g2
(lp6352
V(edit: after replying, I found an exact duplicate, by searching "XElement InnerXml")
p6353
aVWith  that would be just  - not sure about , though
p6354
aVPerhaps cheat
p6355
as(dp6356
g18
V23354
p6357
stp6358
a((dp6359
g2
(lp6360
VWell, relying on a single huge array has a range of associated issues - memory fragmentation, contiguous blocks, the limit on the maximum object size, etc
p6361
aVIf you need a lot of data, I would recommend creating a class that simulates a large array using lots of smaller (but still large) arrays, each of fixed size - i
p6362
ag50
aVthe indexer divides to to find the appropriate array, then uses % to get the offset inside that array
p6363
aVYou might also want to ensure you are on a 64-bit OS, with lots of memory
p6364
aVThis will give you the maximum available head-room
p6365
aVDepending on the scenario, more sophisticated algorithms such as sparse arrays, eta-vectors, etc might be of use to maximise what you can do
p6366
aVYou might be amazed what people could do years ago with limited memory, and just a tape spinning backwards and forwards
p6367
as(dp6368
g18
V23354
p6369
stp6370
a((dp6371
g2
(lp6372
VI can reproduce that it doesn't work
p6373
aVthe  returns  each time
p6374
aV(edit)
p6375
aVA quick search yields this, which seems on topic
p6376
as(dp6377
g18
V23354
p6378
stp6379
a((dp6380
g2
(lp6381
VIn addition to the simpler administration, there are performance advantages of option 3 on web-servers; this allows pooling of connections - i
p6382
ag50
aVa low number of physical database connections can be re-used continuously to service a large number of app users
p6383
aVThis is known as the "trusted subsystem" model - i
p6384
ag50
aVyour app-server validates external callers, but then the app-server itself is used as the identity for calling downwards
p6385
aVThe biggest issue here is that for audit etc you need to keep telling the db who made the current change (things like ,  cease to be useful) - and of course, this is relatively easy to spoof
p6386
aVIf the web-server used security per user, this wouldn't be possible - and so you'd essentially have to disable connection pooling
p6387
aVThe act of establishing a connection is (relatively) expensive, so this would have a significant impact on performance
p6388
aVYou wouldn't want to keep the (per-user) connection around between requests, as this would lead to a huge pool and a lot of open connections (also expensive)
p6389
aVThe "per role" option site between them - but it is rare that roles are truly mutually exclusive, which makes this hard to implement
p6390
aVWith client apps that talk directly to the database, option 1 is the simplest to maintain, since you don't need to distribute any special account details to the client
p6391
aVThe pooling likewise isn't an issue, since the client's machine is only acting as 1 user
p6392
as(dp6393
g18
V23354
p6394
stp6395
a((dp6396
g2
(lp6397
VBased on the other replies, perhaps an extension method on Html (which is very common for MVC), similar to Eduardo's answer:
p6398
aVWith:
p6399
as(dp6400
g18
V23354
p6401
stp6402
a((dp6403
g2
(lp6404
VIdeally, you shouldn't be persisting the UI state; you should be persisting the state of some object model representing your data
p6405
aVWith the exception of , it is fairly trivial to use data-binding to tie an object model to the UI
p6406
aVThis could be either a -based approach, or a custom class hierarchy (my preference)
p6407
aVOnce you have separated data from UI, saving data is simple
p6408
aVThere are plenty of examples for  etc
p6409
as(dp6410
g18
V23354
p6411
stp6412
a((dp6413
g2
(lp6414
VThat is pretty much my view
p6415
aVSee my previous reply here
p6416
aVThis other question wasn't specifically about the problems in EF, but yes: it has a fair few glitches
p6417
aVFor example (in addition to your existing options):
p6418
aVno support for  (re-using expression trees to form a more complex expression)
p6419
aVno support for table-UDFs, which can be used to create well-defined, callable methods in the database that are still composable with sort/skip/take etc
p6420
aVLINQ-to-SQL handles both just fine
p6421
as(dp6422
g18
V23354
p6423
stp6424
a((dp6425
g2
(lp6426
VC# 2
p6427
ag190
aVOr C# 3
p6428
ag190
aVThe LINQ answer (C# 3
p6429
aV0, with either
p6430
aVNET 3
p6431
aV5 or
p6432
aVNET 2
p6433
aV0/3
p6434
aV0 with LINQBridge) is a lot easier ;-p
p6435
ag412
ag50
aVvs:
p6436
aVEither way, that gives you a  of the column header text values
p6437
as(dp6438
g18
V23354
p6439
stp6440
a((dp6441
g2
(lp6442
VWell, assuming that the foreign key has an object representation, something like:
p6443
aVUnfortunately, some of the specifics depend on the SQL provider - i
p6444
ag50
aVwhich functions (like DayOfWeek etc) it can map successfully as TSQL
p6445
aVLet me know if you get problems
p6446
as(dp6447
g18
V23354
p6448
stp6449
a((dp6450
g2
(lp6451
VFor complex queries with multiple optional sections, you may find that it is better to create the SQL to suit
p6452
aVYou can do this either at the caller (for example, in C#), or in the database (at least, with SQL Server) - but either way, you must ensure it remains parameterised
p6453
aVWith the caller doing the work, it is just a case of adding suitable parameters to the command
p6454
aVIf the db is generating the TSQL, then the approach depends on the RDBMS
p6455
aVWith SQL-Server,  is your friend - i
p6456
ag50
aVyou might build a  variable based on the query, then:
p6457
aVWhere  is the declaration inside , and  is the value to pass in at execution time
p6458
as(dp6459
g18
V23354
p6460
stp6461
a((dp6462
g2
(lp6463
VWith winform, "virtual mode" - but AFAIK, this isn't the same in WPF
p6464
aVYou could see this MSDN forum post
p6465
aVI largely agree with Drew Marsh - let the user filter the data, rather than scroll through it
p6466
as(dp6467
g18
V23354
p6468
stp6469
a((dp6470
g2
(lp6471
VWhat type of web-service
p6472
aVasmx
p6473
aVor wcf (svc)
p6474
aVWith asmx, you can use  to get the current ASP
p6475
aVNET request, so you can get pretty-much anything you can get with ASP
p6476
aVNET; try looking at the  property of
p6477
aVWith wcf, this is not recommended - but it can be made to work if you enable ASP
p6478
aVNET compatibility
p6479
as(dp6480
g18
V23354
p6481
stp6482
a((dp6483
g2
(lp6484
VWhat web-server is it that doesn't support POST in this scenario
p6485
aVWhat does the comparable HTML form do
p6486
aVA POST or a GET
p6487
aVJust do the same
p6488
aVI suspect that WebClient or HttpWebRequest will do the job fine
p6489
as(dp6490
g18
V23354
p6491
stp6492
a((dp6493
g2
(lp6494
VHow about a source-code obfuscator
p6495
aVThey generally abbreviate names, etc - and certainly remove white space
p6496
aVFor example, here, with demo here (although you'd probably want to disable the string encoding if possible)
p6497
aVNote that this isn't a direct recommendation: this is just the first hit I got for C# code obfuscator
p6498
as(dp6499
g18
V23354
p6500
stp6501
a((dp6502
g2
(lp6503
VAbsolutely -  and  achieve paging, and are supported by pretty-much all LINQ providers
p6504
aVIn this case it looks like you are using LINQ-to-Xml, so feel free to ignore the following bit - but for general info: note that if the data is coming from a database via a stored procedure, it is hard to page at the server
p6505
aVYou can, however, compose (i
p6506
ag50
aVpage) "UDF"s
p6507
aVLINQ-to-SQL supports UDFs (via ), but not Entity Framework
p6508
aVIf you are using auto-generated database queries this isn't an issue
p6509
aVNote that with xml, you could also do a lot with xpath - here using :
p6510
aVor with / (still with ):
p6511
as(dp6512
g18
V23354
p6513
stp6514
a((dp6515
g2
(lp6516
VYowser
p6517
aVHave you perchance got some huge resx files (or other embedded content) that are getting embedded in the dll
p6518
aVPerhaps treat those as external content
p6519
aVI'd start by looking at the files in the project tree
p6520
aVthat 20Mb has to come from somewhere obvious - large graphics, etc
p6521
as(dp6522
g18
V23354
p6523
stp6524
a((dp6525
g2
(lp6526
VUsually, a  means that you are loading a different version of the dll to the one you referenced during build, and the actual dll you are loading (at run-time) doesn't have the method the compiler found (at compile-time)
p6527
aVCheck that you haven't somehow got various versions of the dll referenced by different projects
p6528
aVIt could be that when you run it in debug mode, some other code makes the correct dll load first, but when running in-context, this other code doesn't run - so the incorrect version loads instead
p6529
aVThis would apply doubly if the failing method was added recently, so might not be in the older version referenced
p6530
aVIf you are using full assembly versioning, you might be able to watch the debug output to see exactly which assembly loads
p6531
as(dp6532
g18
V23354
p6533
stp6534
a((dp6535
g2
(lp6536
VCan you clarify - is this a web app or a client (winform) app
p6537
aVForm1 sounds like a winform
p6538
aVASP
p6539
aVNET runs at the server, so showing a form would be inappropriate - it would happen at the server, not the client
p6540
aVIn short, don't do this
p6541
aVI also can't see where "stored procedures" figures in this, so I've removed the tag
p6542
aVWhat are you trying to do
p6543
aVOptions for showing something more complex at the client include:
p6544
aVdhtml
p6545
aVflash
p6546
aVsilverlight
p6547
aVclickonce [requires windows client]
p6548
aVocx [not recommended]
p6549
as(dp6550
g18
V23354
p6551
stp6552
a((dp6553
g2
(lp6554
VHave you looked in the server's event log
p6555
aVMany ASP
p6556
aVNET errors will end up there, this sounds like it might qualify
p6557
as(dp6558
g18
V23354
p6559
stp6560
a((dp6561
g2
(lp6562
VMSDN
p6563
aVSocketError; or from the native ErrorCode, the MSDN page states: "For more information about socket error codes, see the Windows Sockets version 2 API error code documentation in MSDN
p6564
aVA few searches shows this here
p6565
as(dp6566
g18
V23354
p6567
stp6568
a((dp6569
g2
(lp6570
VWhy have you converted binary (image) data to a string
p6571
aVThis makes no sense
p6572
aVunless you are using base-64
p6573
aVAnyway, to reverse what you have done, you could try using
p6574
aVThis will create a new MemoryStream primed with the string (via UTF8)
p6575
aVPersonally, I doubt it will work - you are going to run into a lot of encoding issues treating raw binary as UTF8 data
p6576
aVI expect either the read or write (or both) to throw an exception
p6577
aV(edit)
p6578
aVI should add that to work with base-64, simply get the data as a , then call ; and to get back the array, just use
p6579
aVRe your edit, this is precisely what I tried to warn about above
p6580
aVin
p6581
aVNET, a string is not just a , so you can't simply fill it with binary image data
p6582
aVA lot of the data simply won't make sense to the encoding, so might be quietly dropped (or an exception thrown)
p6583
aVTo handle raw binary (such as images) as strings, you need to use base-64 encoding; this adds size, however
p6584
aVNote that  might make this simpler, as it exposes  functionality directly:
p6585
aVAnyway, using a standard  approach, here's how to encode and decode the base-64:
p6586
as(dp6587
g18
V23354
p6588
stp6589
a((dp6590
g2
(lp6591
VPartial classes are primarily for code-generator usage, such as designers - but I use the approach you have cited - in particular when an object implements multiple (non-trivial) interfaces, I find it useful to break it up 1 file per interface implementation
p6592
aVI also commonly have a file for the static methods, which are usually different enough from instance methods to warrant separation
p6593
as(dp6594
g18
V23354
p6595
stp6596
a((dp6597
g2
(lp6598
VI'm very unclear how the  related to the  stuff
p6599
aVCan you clarify
p6600
aVIn general, you might want to look at providing a custom /, or , or an
p6601
aVAlternatively, LINQ has lots of ways to make this simple - do you have access to LINQ
p6602
as(dp6603
g18
V23354
p6604
stp6605
a((dp6606
g2
(lp6607
VThe abstracted view of identity is often the /:
p6608
aVThis allows the same code to work in many different models (winform, asp
p6609
aVnet, wcf, etc) - but it relies on the identity being set in advance (since it is application-defined)
p6610
aVFor example, in a winform you might use the current user's windows identity:
p6611
aVHowever, the principal can also be completely bespoke - it doesn't necessarily relate to windows accounts etc
p6612
aVAnother app might use a login screen to allow arbitrary users to log on:
p6613
as(dp6614
g18
V23354
p6615
stp6616
a((dp6617
g2
(lp6618
VFor the grungy implementation details, have you looked at "principals"
p6619
aVSee my reply here
p6620
aVWith this approach, you can use roles-based security in the code - such as:
p6621
aVThe runtime itself will now verify that the user has to have your "ADMIN" role to get into that method (obviously you could also disable the option in the UI by checking )
p6622
aVVery powerful
p6623
as(dp6624
g18
V23354
p6625
stp6626
a((dp6627
g2
(lp6628
VA very unclear question; the short answer is AD - have you looked at MSDN
p6629
as(dp6630
g18
V23354
p6631
stp6632
a((dp6633
g2
(lp6634
VIf you are talking to a database, you might want to do the random fetch at the database
p6635
aVWith LINQ-to-SQL you can (for smallish volumes) do this via a [Function] pointing at NEWID (on the data-context):
p6636
aVthen in a query via:
p6637
aVwhich gives TSQL (here using Northwind):
p6638
aVYou can obviously mix this with Take(1) etc
p6639
aVIt doesn't work in entity framework, though
p6640
as(dp6641
g18
V23354
p6642
stp6643
a((dp6644
g2
(lp6645
VYou can look at Array
p6646
aVRank
p6647
aVHowever, T[] is one dimensional
p6648
aVYou mainly need to check the rank when all you know is "Array"
p6649
aVThis is because the actual method is exposed via Array, not T[]
p6650
aVSo in short - don't worry about it in this scenario ;-p
p6651
as(dp6652
g18
V23354
p6653
stp6654
a((dp6655
g2
(lp6656
VIn many ways, a static class and a singleton are similar
p6657
aVOne big difference is that a singleton might implement some interfaces, which isn't possible with a static class
p6658
aVFor example,  /  provide (via the interface) the ability to use the item in sorting / dictionary usage
p6659
aVIt is also possible (though tricky) to use a singleton with the standard serialization frameworks
p6660
aVWith a static class, you'd have to manage any state persistence manually
p6661
as(dp6662
g18
V23354
p6663
stp6664
a((dp6665
g2
(lp6666
VIf you mean fields, then no
p6667
aVThe compiler injects "this" (ldarg
p6668
aV0) whether you use it explicitly (this
p6669
aVfoo) or implicitly (foo)
p6670
aVIt does, however, take 5 more characters in your source code
p6671
aVso a handful of bytes on your development hard disk
p6672
aVIt will make exactly zero difference in the compiled IL or at runtime
p6673
aVThere are two scenarios where use of "this" changes things:
p6674
aVwhen there is a variable/parameter with the same name ()
p6675
aVwhen resolving extension methods (;)
p6676
as(dp6677
g18
V23354
p6678
stp6679
a((dp6680
g2
(lp6681
VWell, you could check  flag
p6682
aVOr more recently:
p6683
aVWhere @tableId is OBJECT_ID('TableName')
p6684
as(dp6685
g18
V23354
p6686
stp6687
a((dp6688
g2
(lp6689
VI believe this is one of the options that you can't do directly at the command line
p6690
aVYou may indeed have to edit the dbml
p6691
aVHowever, this isn't a tricky change, so you should be able to automate it with a basic command-line tool
p6692
as(dp6693
g18
V23354
p6694
stp6695
a((dp6696
g2
(lp6697
VIndirectly, like so
p6698
aVPersonally, I leave the storage int public (for example as , where the enum property is ) - that way I can still write lambdas against the column for execution at the DB, for example:
p6699
aVIf you don't expose the storage value, you can't do this as cleanly
p6700
aVYou could equally leave it internal, and have some methods in the context to do the filtering
p6701
aVhere's one I wrote earlier today:
p6702
aVwhere  is my internal constant
p6703
aVIn this case, I couldn't use a discriminated subclass, as it was interfering with ADO
p6704
aVNET Data Services
p6705
as(dp6706
g18
V23354
p6707
stp6708
a((dp6709
g2
(lp6710
VIs this data discriminated
p6711
ag412
ag50
aVdoes AccountType define which type it is
p6712
aVIf so:
p6713
aVEF should create the Account entity from the storage
p6714
aVyou then create 2 subclasses (UserAccount and GroupAccount)
p6715
aVin the mapping for Account, specify a predicate "add a condition"
p6716
aVhave it map to UserAccount where the AccountType (storage) field is 1 (or whatever)
p6717
aVhave it map to GroupAccount where the AccountType (storage) field is 2 (or whatever)
p6718
aVThe account type then should completely disappear from the Account object (unmap it if not)
p6719
aVTo get just the UserAccount records, you use
p6720
aVThe Account class should probably be abstract in this model
p6721
aVThe interface stuff can be added via a partial class - i
p6722
ag50
aVin a separate file, define:
p6723
aVetc
p6724
aVA reasonable walkthrough is here
p6725
as(dp6726
g18
V23354
p6727
stp6728
a((dp6729
g2
(lp6730
VActually,  is often slower than a linear search, due to the inherent complexities of doing the dictionary logic (haches, buckets, etc)
p6731
aVIn my tests, the cutoff (where  starts being faster) is often around 150 elements
p6732
aVAnd since you generally have a lot fewer tables than 150, I'd be happy with a linear list for performance
p6733
aV(which doesn't at all mean "don't use ; it just means that performance might not be the main reason for this particular use-case; the unique key enforcement and the foo["bar"] model might be)
p6734
aVPart of this is due to the complexity of getting the hash - the  for  in particular is relatively expensive (although  is blindingly fast ;-p)
p6735
aVIn reality, in most small sets of data you will never notice the difference between the two
p6736
aVIf you have large data, then obviously you need to plan for that and code accordingly
p6737
aVOther differences between a  and something like a  is things like uniqueness: a  won't let you have duplicated keys (although a  in
p6738
aVNET 3
p6739
aV5 will)
p6740
as(dp6741
g18
V23354
p6742
stp6743
a((dp6744
g2
(lp6745
VAt the moment, you'd have to use a constructor with lots of args, or a builder
p6746
aVIn C# 4
p6747
aV0 (VS2010), you can use named/optional arguments to achieve something similar to C# 3
p6748
aV0 object-initializers - see here
p6749
aVThe example on the blog is:
p6750
aVBut you can easily see how something similar can apply for any constructor (or other complex method)
p6751
aVCompare to the C# 3
p6752
aV0 object-initializer syntax (with a mutable type):
p6753
aVNot much to tell them apart, really
p6754
aVJon Skeet has posted some thoughts on this subject too, here
p6755
as(dp6756
g18
V23354
p6757
stp6758
a((dp6759
g2
(lp6760
VOne cheeky option might be to create an instance with the default constructor, to use as a template:
p6761
aVThen tuck this away and re-use it
p6762
aVAny help
p6763
as(dp6764
g18
V23354
p6765
stp6766
a((dp6767
g2
(lp6768
VIf you Process
p6769
aVStart a URL, it is loading a browser app, which isn't (for Vista/etc) going to display for a service (for the same reasons as your last question)
p6770
aVIf you want the app to interact with the user/desktop, it shouldn't be a service - it should simply run when the user logs in
p6771
aVNote that any child-process that your service spawns will also be in the service's session
p6772
aVIf you just want to get data (through code) from the site, use  etc
p6773
as(dp6774
g18
V23354
p6775
stp6776
a((dp6777
g2
(lp6778
VAre you trying to save the data in tables
p6779
aVor as blob/clob data
p6780
aVSince you mention files, I assume the latter: any of the standard
p6781
aVNET serializers should be fine - they all support inheritance etc
p6782
aVI'd consider for , as this combines the field-level support (like ), and the assembly-independence of
p6783
aVYou could also consider more esoteric things like protobuf-net
p6784
aVSo: what is it you need to do that won't work under the standard serializers
p6785
as(dp6786
g18
V23354
p6787
stp6788
a((dp6789
g2
(lp6790
VIt sounds like you haven't set the virtual as an application in IIS, or it is running the wrong version of ASP
p6791
aVNET (i
p6792
ag50
ag733
aV1, when it should be 2
p6793
ag190
aVblah)
p6794
aVThe virtual should have the cog icon in the IIS view, and in the properties pane, must have an application name
p6795
as(dp6796
g18
V23354
p6797
stp6798
a((dp6799
g2
(lp6800
VIf you want to pass complex state around, package it in an object - i
p6801
ag50
aVAnd have the methods accept this object as an argument
p6802
aVThen you just create an instance of this and pass it along
p6803
aVGlobal is a big no-no; ASP
p6804
aVNET is highly threaded - this would be a nightmare
p6805
aVPer-request state is possible, but a bit messy
p6806
as(dp6807
g18
V23354
p6808
stp6809
a((dp6810
g2
(lp6811
VHow about:
p6812
aVor in query syntax:
p6813
aVOf course, if you will use this repeatedly, you could add an extension method:
p6814
aVThen you can use:
p6815
as(dp6816
g18
V23354
p6817
stp6818
a((dp6819
g2
(lp6820
VI very rarely comment on method variables, and equally rarely fields (since they are usually covered by a property, or simply don't exist if using auto-implemented properties)
p6821
aVGenerally I try hard to add meaningful comments to all public/protected members, which is handy, since if you turn on the xml comments during build, you get automatic warnings for missing comments
p6822
aVDepending on the complexity, I might not fill out every detail - i
p6823
ag50
aVif it is 100% obvious what every parameter has to do (i
p6824
ag50
aVthere is no special logic, and there is only 1 logical way of interpreting the variables), then I might get lazy and not add comments about the parameters
p6825
aVBut I certainly try to describe what methods, types, properties, etc represent/do
p6826
as(dp6827
g18
V23354
p6828
stp6829
a((dp6830
g2
(lp6831
VI have some code that does exactly this; I use it in our bespoke build process to a: figure out the build order (without having to maintain it), and b: cascade changes upwards through a tree of random projects
p6832
aVUnfortunately I'm not in my usual office at the moment, and the code is too complex to reproduce "off the cuff" (it does lots of graph mapping and dependency tracking)
p6833
aVI should add that it currently works by having a custom marker (xml file) in the root of every project that tracks what needs building; our code promotion process sets the flag, and the build process clears it
p6834
aVThe way it works at the moment is you get to the root that contains all the projects (at any depth), and just type  (with a few switches), and it emits all the project paths that need building, in the right order
p6835
aVLet me know if it is of interest
p6836
as(dp6837
g18
V23354
p6838
stp6839
a((dp6840
g2
(lp6841
VYou can subclass DisplayNameAttribute to provide i18n, by overriding one of the methods
p6842
aVLike so
p6843
aVedit: You might have to settle for using a constant for the key
p6844
as(dp6845
g18
V23354
p6846
stp6847
a((dp6848
g2
(lp6849
VRather than regex, you could try loading it into the HTML agility pack
p6850
aVIf it was xhtml, then an xslt transformation might be a good option
p6851
as(dp6852
g18
V23354
p6853
stp6854
a((dp6855
g2
(lp6856
VIt could be because of how the lambda is interpreted; with "Guid
p6857
aVEmpty", the "Guid
p6858
aVEmpty" is part of the final lambda
p6859
aVI wonder whether the LINQ-provider is treating this as a special case somehow
p6860
aVYou could try:
p6861
aVBut actually, other than  vs some compiler-generated capture class, the expression tree for this is the same (they both involve lambda=>BinaryExpression=>MemberExpression)
p6862
aVIf the above also complains, then try putting a TSQL trace on, or enabling your LINQ-providers logging - for LINQ-to-SQL, something like below works (don't quote me
p6863
aV:
p6864
as(dp6865
g18
V23354
p6866
stp6867
a((dp6868
g2
(lp6869
VDecrementing a variable (between threads) is a little bit risky unless done with , but that approach should be fine if you have the last thread (i
p6870
ag50
aVwhen it gets to zero) raise an event
p6871
aVNote that it would have to be in a "finally" block to avoid losing it in the case of exceptions (plus you don't want to kill the process)
p6872
aVIn "Parallel Extensions" (or with
p6873
aVNET 4
p6874
aV0), you might also look at the  options here
p6875
aVthat might be another way of getting everything done as a block
p6876
aVWithout having to watch them all manually
p6877
as(dp6878
g18
V23354
p6879
stp6880
a((dp6881
g2
(lp6882
VWhat is the data-type
p6883
aVint
p6884
aV(int both TSQL and in C#
p6885
aVWhat auto-sync setting do you have
p6886
aVFor a primary key, it should be "OnInsert"
p6887
as(dp6888
g18
V23354
p6889
stp6890
a((dp6891
g2
(lp6892
VInterface hierarchies are a pain - they don't really "inherit" as such, since you can have multiple "parents" (for want of a better term)
p6893
aVFlattening" (again, not quite the right term) the hierarchy might involve checking for all the interfaces that the interface implements and working from there
p6894
as(dp6895
g18
V23354
p6896
stp6897
a((dp6898
g2
(lp6899
VTo improve the experience with , consider marking your data-types with
p6900
aVAlso, there is a  attribute that defines the operations possible
p6901
as(dp6902
g18
V23354
p6903
stp6904
a((dp6905
g2
(lp6906
VYou need to set an  for the property, giving it a  that does the edit; like so (with your own editor
p6907
aVYou might be ablt to track down an existing Editor by looking at existing properties that behave like you want
p6908
as(dp6909
g18
V23354
p6910
stp6911
a((dp6912
g2
(lp6913
V(note: this might seem an over-complicated solution, but I'm assuming that the source data is large (lots of rows), so loading it into a  might not be feasible)
p6914
aVThe file reading would be done quite well with an iterator block
p6915
aVif the data is large, you only want to handle one row at a time, not a 2D array
p6916
aVThis actually looks like a good fit for MiscUtil's PushLINQ approach, which can perform multiple aggregates at the same time on a stream of data, without buffering
p6917
aVAn example is below
p6918
aVwhy is this useful
p6919
aVBecause it allows you to write multiple queries on a data source using standard LINQ syntax, but only read it once
p6920
aVExample
p6921
as(dp6922
g18
V23354
p6923
stp6924
a((dp6925
g2
(lp6926
VFrom the silverlight perspective, WCF is heavily constrained anyway, so most of the usual benefits of WCF don't apply
p6927
aVHowever, it is still a fairly nice, consistent programming model
p6928
aVWCF is primarily a SOAP stack, so it is very good at presenting data as rigid operations
p6929
aVADO
p6930
aVNET Data Services is a REST stack, and allows very expressive queries to be performed dynamically over the wire
p6931
aVI don't know how it is in Silverlight, but a regular ADO
p6932
aVNET Data Services proxy (the bit on your client app) has very rich support for both query and data changes back to the server
p6933
aVNote that applying changes requires either a: Entity Framework, or b: lots of work
p6934
aVBut you should get query and update very cheaply with this approach
p6935
aVWith WCF, you get a much more controlled stack, so you will need to code all the distinct operations you want to be able to do
p6936
aVBut this also means you have a known attack surface etc; it is much harder to exploit a locked down API like a fixed SOAP endpoint
p6937
aVRe regular web-services (pre-WCF): only go down that route if you want to support very specific legacy callers
p6938
as(dp6939
g18
V23354
p6940
stp6941
a((dp6942
g2
(lp6943
VEverything leppie said - plus:
p6944
aVThis just uses the existing FindIndex to locate a car with id 1, then replace or add it
p6945
aVNo LINQ; no SQL - just a lambda and
p6946
as(dp6947
g18
V23354
p6948
stp6949
a((dp6950
g2
(lp6951
VYou seem to be double-reading the lines, or maybe you've mixed up rows and cells - this bit in particular looks really odd:
p6952
ag412
ag50
aVre-declaring rows, two calls to  per loop, etc
p6953
aVI suspect you mean
p6954
aVEither way, either use , or look at some of the options presented yesterday
p6955
aVIf you are desperate to use arrays, the core might look something like:
p6956
aVAgain - I cannot stress enough how much you should be doing this with LINQ instead of manual looping
p6957
as(dp6958
g18
V23354
p6959
stp6960
a((dp6961
g2
(lp6962
VDo you mean:
p6963
aVThis works with  (for ), else falls back to
p6964
aVThere is also  for inequality comparisons (greater/less):
p6965
aVThis uses , or  otherwise
p6966
aVBy the way,  should just use the regular reference compare provided by , so it should just work fine with the above
p6967
as(dp6968
g18
V23354
p6969
stp6970
a((dp6971
g2
(lp6972
VDid you try ValueMember = "" or ValueMember = "
p6973
aVReally hacky, but you could add a property on  that is itself
p6974
aV(perhaps via a partial class)
p6975
aVthen set `ValueMember = "Self";'
p6976
aVOther than that, you'd probably need a
p6977
aVThe other option might be to override  on  to return , and not have a value/display member
p6978
aV(update: no it doesn't)
p6979
aVHave checked, and  seems to work :
p6980
aVand just don't set a  or a
p6981
aVWell whad'ya know - the "Self" trick works too
p6982
as(dp6983
g18
V23354
p6984
stp6985
a((dp6986
g2
(lp6987
VIt might be something to do with the user that IIS is running as; try changing the app-pool to run in your identity to see if it works
p6988
aVOf course, winzip is a UI tool - you might do better using a command-line zip utility
p6989
aVpkzip ;-p
p6990
aVPersonally, I'd look at using #ZipLib instead - this will allow you to manipulate zip files in managed code
p6991
as(dp6992
g18
V23354
p6993
stp6994
a((dp6995
g2
(lp6996
VI suspect the ideas will take more importance than the actual F# usage
p6997
aVfor example, I expect (especially as multi-core escalates) that immutable design will flourish in C#
p6998
aVBut I don't see people switching from C# to F#
p6999
aVI've tried both, and C# definitely (for me) keeps things more maintainable and understandable
p7000
aVDon't forget that with delegates, and with lambdas for closures, we have a lot of ability to write in the functional style from within C#
p7001
as(dp7002
g18
V23354
p7003
stp7004
a((dp7005
g2
(lp7006
VYou could (in both cases) make the button simply raise an event
p7007
aVThe shell exe references both assemblies, and hooks up the even to show the other form
p7008
aVSo the exe knows about both; neither of the forms knows about the other
p7009
aVFor example (same concept):
p7010
as(dp7011
g18
V23354
p7012
stp7013
a((dp7014
g2
(lp7015
VIs the list of types fixed or does it change
p7016
aVIf fixed, I would encapsulate it in an enum:
p7017
aVThen just cast
p7018
aVYou can use attributes (and a few lines of bespoke code) to store an extra description per enum item
p7019
aVIf the list changes I would probably read it once early on in the app, and cache the list in a lookup somewhere (perhaps static, perhaps in a specific cache)
p7020
aVThen just do the lookups from the cached copy
p7021
aVYou can take this further by adding properties that change between the two representations
p7022
as(dp7023
g18
V23354
p7024
stp7025
a((dp7026
g2
(lp7027
VHow about you just save the xml to a file, and use xsd
p7028
aVWrite the file to disk (I named it foo
p7029
aVxml)
p7030
aVGenerate the xsd:
p7031
aVGenerate the C#:
p7032
aVEt voila - and C# code file that should be able to read the data via :
p7033
aV(include the generated foo
p7034
aVcs in the project)
p7035
as(dp7036
g18
V23354
p7037
stp7038
a((dp7039
g2
(lp7040
VWSDL (SOAP) is fairly interchangeable
p7041
aVIf you want something less chatty, anything like Google's "protocol buffers", "ICE" (ZeroC), etc offer interchangeable binary serialization and code generation
p7042
aVFor
p7043
aVNET / C#, there are currently two viable protocol buffers implementations here; protosharp is essentially inactive and incomplete) - either would be fine, but neither currently has a complete RPC stack, so you'd have to handle message passing yourself
p7044
as(dp7045
g18
V23354
p7046
stp7047
a((dp7048
g2
(lp7049
VFor use with ADO
p7050
aVNET Data Services (which you mention), Entity Framework is the one that works out of the box
p7051
aVIf you want to update data with LINQ-to-SQL (via ADO
p7052
aVNET Data Services), you need to do some work to implement
p7053
aVLuckily I've been blogging about that this week
p7054
aVMy overall thoughts between the two are covered here, but I've softened a little since then, see here
p7055
aVBasically, at the moment I prefer LINQ-to-SQL, but I expect EF to be more usable in the next version
p7056
aVHence why I am working to get LINQ-to-SQL working with ADO
p7057
aVNET Data Services
p7058
as(dp7059
g18
V23354
p7060
stp7061
a((dp7062
g2
(lp7063
VThe  bit is optional, of course; without the , you'll get an enumerable sequence of doubles instead of an array - it depends whether you need to read it once or twice
p7064
aVIf you have nulls in the data, use  instead
p7065
aV(note that this needs a reference to System
p7066
aVData
p7067
aVDataSetExtensions
p7068
aVdll, and a "using System
p7069
aVData;" statement - this brings the  extension methods into play)
p7070
as(dp7071
g18
V23354
p7072
stp7073
a((dp7074
g2
(lp7075
VHere's a slightly different one - you can use them (like this) to simulate the missing "infoof"/"nameof" operators in C# - i
p7076
ag50
aVso that instead of hard-coding to a property name as a string, you can use a lambda
p7077
aVThis means that it is validated at compile time (which strings can't be)
p7078
aVThere is obviously a performance cost to this, hence "just for fun", but interesting
p7079
as(dp7080
g18
V23354
p7081
stp7082
a((dp7083
g2
(lp7084
VLINQ has many incarnations
p7085
aVSince you mention LINQ-to-SQL, I'll focus on that: it is neither
p7086
aVit is most comparable to  - i
p7087
ag50
aVit executes a constructed TSQL command, and then returns the processed records row-by-row (see below) as it receives them from the SQL Server
p7088
aVAs with , you only get one chance per row, unless you buffer the data using , , etc
p7089
aVThe TSQL command executed is constructed from the LINQ query you build, and is parameterized to prevent SQL injection - so if you use "where", the TSQL executed includes "WHERE", etc
p7090
aVIn reality, the client is consuming records on demand via , so there needs to be a small buffer to handle the incoming TDS stream - but it isn't the same as a database cursor
p7091
aVNote that most operations (Sort, etc) can be sent down to the server and translated into TSQL - but it is possible that some things have to be done at the client, which might again force it to buffer more data in memory
p7092
aVThis is especially true if you force it via , which switches to LINQ-to-Objects
p7093
aVIf LINQ-to-Objects does a buffering operation (sort, group, etc), then it will need to load the data into memory
p7094
aVThere are a few things of note here; for example, if you want to compute completely separate aggregates etc on a query, you must (normally) either execute it twice (etc), or buffer it all in memory (not necessarily an option for large data)
p7095
aVFor this type of scenario (and others), Jon Skeet and myself wrote an alternative LINQ implementation that works as a push rather than a pull, allowing you to feed data through multiple parallel processes at once
p7096
aVJon explains it better here
p7097
aVThis type of thing is mainly of use if you have a very large, once-only data stream that you want to do complex processing on
p7098
aVInteresting, though
p7099
as(dp7100
g18
V23354
p7101
stp7102
a((dp7103
g2
(lp7104
VWell, Red/Green/Blue are fairly easy to identify by inspection; what range of values do you need to support
p7105
aVThe problem is that unless you start with a named color, it is very hard to get back to one;  will return false even if you create an obvious color via FromArgb
p7106
aVIf you only need the actual expected standard colors, you could enumerate the known colors via reflection
p7107
aVYou might also be able to use this approach as a source of known colors for a more sophisticated algorithm
p7108
as(dp7109
g18
V23354
p7110
stp7111
a((dp7112
g2
(lp7113
VWhich TreeView is this
p7114
aVIn winforms, you simply catch the returned TreeNode from Add, and add more items to the Nodes property:
p7115
as(dp7116
g18
V23354
p7117
stp7118
a((dp7119
g2
(lp7120
VThe existing answers are fine; just an alternative perspective: in many scenarios it is desirable to use System
p7121
aVComponentModel rather than direct reflection, as this allows for runtime property scenarios - i
p7122
ag50
aVhow a DataTable's DataView exposes the columns as properties
p7123
aVPerformance wise - by default this is largely identical, but if you are doing lots of this (for example, bulk data import/export), you can actually get significant performance increases using this approach, courtesy of HyperDescriptor
p7124
aVTo use System
p7125
aVComponentModel, the code is similar, but subtly different:
p7126
aVThis then gives you the same handling as though you had used data-binding to bind to "Address
p7127
aVZipCode" (glossing over some details like lists etc)
p7128
aV(note that you could cast zip as string etc if you know that is the expected type)
p7129
aVTo get the value from a deep path (including the same list handling that data-binding uses), you would use something like:
p7130
aVThe list stuff roughly mirrors the behaviour of regular data-binding (although it omits a few things like binding-contexts, currency-managers, etc)
p7131
as(dp7132
g18
V23354
p7133
stp7134
a((dp7135
g2
(lp7136
VIn most cases, a database isn't the ideal place for video
p7137
aVYou can force it (varbinary(max), or image on older versions), but if you do this, you'll need to be very careful to use steraming access rather than "get all" access (if you see what I mean)
p7138
aVAnd you'd probably want the video on a different file-group (and probably drive) than regular data
p7139
aVIn SQL Server 2008 there is the filestream type, which is a hybrid between db and file system
p7140
aVMaybe this will do what you need
p7141
aVIf not, just use the file system
p7142
aVOne other reason not to use video in the DB; if you have a small system, SQL Server Express might be ideal - but has a db size cap that video will quickly swamp
p7143
as(dp7144
g18
V23354
p7145
stp7146
a((dp7147
g2
(lp7148
VI just read the error report
p7149
aVBinary serialization fails for object
p7150
aVgraphs with more than ~13
p7151
aV2 million
p7152
aVobjects
p7153
aVif you have a graph that big, you always may have some problems
p7154
aVWould you like to try an alternative serializer
p7155
aV"protobuf-net" is a bespoke binary serializer following Google's protocol buffers format, and may work for larger sets, especially in "group" mode
p7156
as(dp7157
g18
V23354
p7158
stp7159
a((dp7160
g2
(lp7161
VThere are frameworks for this
p7162
aVICE (ZeroC), "protocol buffers", etc
p7163
aVFor example, my protocol buffers implementation (protobuf-net) works on mono, MS
p7164
aVNET, CF, Silverlight etc - and the binary format is compatible with a range of languages (java, etc)
p7165
aVIf you start from a
p7166
aVproto (a bespoke definition language), you can use it to generate the object layer in each language you need
p7167
as(dp7168
g18
V23354
p7169
stp7170
a((dp7171
g2
(lp7172
VYou can actually use enums directly in LINQ-to-SQL (but not Entity Framework); just change the type of the property (in the dbml/designer) to the fully qualified enum type, and it will do the cast for you
p7173
aVYou might want to call it AchievementType, of course - and this assumes a straight (cast) translation
p7174
aVIf this doesn't fit your scenario, you'll probably have to select it as an integer, and then do the final cast in LINQ-to-Objects (via AsEnumerable())
p7175
aVYou could also try a straight cast (assuming this is sufficient) instead of your generic extension method:
p7176
aVNot that if the  type is defined in the dbml, you can't create it this way - you have to simple select it
p7177
aVBut if this is not part of the db-model then it is fine
p7178
aVHere's a related example for mapping strings to enums in LINQ-to-SQL
p7179
aVIf neither of these suits, the other approach is to declare the enum property as a shim in a partial class
p7180
aVI gave an example of this here (for EF, but it works the same), but note that if you do this, you can't use the enum property in  clauses etc, since it isn't mapped in the model
p7181
as(dp7182
g18
V23354
p7183
stp7184
a((dp7185
g2
(lp7186
VHow about r
p7187
aVComments
p7188
aVOrderByDescending(x=>x
p7189
aVId)
p7190
aVFirstOrDefault()
p7191
aVEssentially, order it (most recent first), and then take the first
p7192
as(dp7193
g18
V23354
p7194
stp7195
a((dp7196
g2
(lp7197
VUnless I'm mistaken, that still only counts as one group
p7198
aVI'm guessing you'll need to do a string
p7199
aVSplit(',') to do what you want
p7200
aVIndeed, it looks a lot simpler to not bother with regex at all here
p7201
aVDepending on the data, how about:
p7202
as(dp7203
g18
V23354
p7204
stp7205
a((dp7206
g2
(lp7207
VFor causes
p7208
aVwell, some hint of the symptom would help
p7209
aVOne possibility is that you have code to a method like  that has side effects (i
p7210
ag50
aVmakes it work)
p7211
aVCalls to methods marked with  are not compiled unless you have the right symbols defined - so anything marked  will be silently dropped
p7212
aVIt could also be a compiler bug, but that is a bit unlikely (but not impossible)
p7213
aVWhat is the symptom
p7214
aVHow does it break
p7215
aVAs an example of the above:
p7216
aVCompiled in DEBUG mode it prints "I'm working"; compiled in RELEASE mode it prints "I'm broken"
p7217
aVDoes this sound similar
p7218
aVCheck you aren't calling any debug methods directly with things that have side-effects
p7219
aVIn most cases, you can fix by indirection:
p7220
aVNow it gets called in either mode
p7221
as(dp7222
g18
V23354
p7223
stp7224
a((dp7225
g2
(lp7226
VMaybe an obvious question, but did you try using wsdl
p7227
aVexe to see what it spits out
p7228
aVYou can always just use this for guidance (i
p7229
ag50
aVyou don't have to use the class directly)
p7230
as(dp7231
g18
V23354
p7232
stp7233
a((dp7234
g2
(lp7235
VWell, you seem to have answered it yourself
p7236
aVIf you need fast query against a set of data, then a dictionary may be better than a flat list (for largish data sizes, which yours is)
p7237
aVYou could, for example, use the object as its own key -
p7238
aVNote that the meaning of equality depends on the context
p7239
aVIf you are passing in the original reference, then that is fine -  would do the job
p7240
aVIf you have a different but similar-for-the-purposes-of-equality object to compare to, then you'll need to implement your own , , and ideally
p7241
aVEither in  itself, or in a custom
p7242
as(dp7243
g18
V23354
p7244
stp7245
a((dp7246
g2
(lp7247
VFirst - why is that an EXEC
p7248
aVShouldn't that just be
p7249
aVThe current SP doesn't make sense
p7250
aVIn particular, that would look for a column matching @template, not the varchar value of @template
p7251
ag412
ag50
aVif @template is , it would search , which is very rare (to have table and column named the same)
p7252
aVAlso, if you do have to use dynamic SQL, you should use  (keeping the values as parameters) to prevent from injection attacks (rather than concatenation of input)
p7253
aVBut it isn't necessary in this case
p7254
aVRe the actual problem - it looks OK from a glance; are you sure you don't have a different copy of the SP hanging around
p7255
aVThis is a common error
p7256
as(dp7257
g18
V23354
p7258
stp7259
a((dp7260
g2
(lp7261
VBasically, no
p7262
aVThe  class has an internal  property that is assigned by the data-context, which is how it gets at the data on-demand
p7263
aVHowever, there is nothing similar for the data classes themselves
p7264
aVHowever, I believe that Entity Framework has a lot more access to this, at the cost of the enforced object hierarchy
p7265
aVUnlike Entity Framework, LINQ-to-SQL (by design) can be used with regular, persistence-ignorant classes - so it doesn't assume that it has access to this type of data
p7266
as(dp7267
g18
V23354
p7268
stp7269
a((dp7270
g2
(lp7271
VI don't know how accurate it is, but it is suggested that this might not be possible - see here
p7272
aVIt might be simplest to port it into a service
p7273
aVfor debugging purposes, it is fairly easy to write code that can work either as a service or as a console exe (making it easy to debug, albeit in the wrong identity)
p7274
aVI do this all the time
p7275
aVHere's an example of this; search in the code for the switches:
p7276
ag412
ag50
aVwith "-c", it runs the code directly, rather than starting the service infrastructure
p7277
aVThe code also shows how to have the exe act as a self-installer, which can be very handy
p7278
as(dp7279
g18
V23354
p7280
stp7281
a((dp7282
g2
(lp7283
V won't do much unless it is shown and has a UI thread associated; are you showing the form on which it resides
p7284
aVYou need to, to use the DOM etc
p7285
aVThe form could be off-screen if you don't want to display it to the user, but it won't work well in a service (for example)
p7286
aVFor scraping purposes, you can normally simulate a regular HTML browwser using  etc
p7287
aVIS this not sufficient
p7288
aVYou can use tools like "Fiddler" to investigate the exact request you need to make to the server
p7289
aVFor more than that, you might look at the HTML Agility Pack, which offers DOM access to HTML without a browser
p7290
as(dp7291
g18
V23354
p7292
stp7293
a((dp7294
g2
(lp7295
VIf it needs , then  is more convenient
p7296
aVjust , ,  etc (and cast)
p7297
aV(use the same  instance however - don't create  each time)
p7298
aVIt depends on what the intent is as to whether this offers enough randomness
p7299
aVSince this is just the seed, it should be OK
p7300
as(dp7301
g18
V23354
p7302
stp7303
a((dp7304
g2
(lp7305
VWell, don't you already know the structure
p7306
aVThe "SET FMT_ONLY ON", or "WHERE 1 = 0" tricks are both very tested (with different results)
p7307
aVIs the query here dynamic
p7308
aVI can't help thinking you should know the schema already
p7309
as(dp7310
g18
V23354
p7311
stp7312
a((dp7313
g2
(lp7314
VOne thing that immediately occurs is that using a  in a key is asking for trouble; equality comparisons on floating point numbers are notoriously flakey
p7315
aVI'm still looking, though
p7316
aVI believe the main problem here is that there is simply no automatic equality on lists based on contents; you are returning different lists (from ), so they simply never equal eachother
p7317
aVYou might be able to provide a custom comparer
p7318
aVThis is messy, but gets something returning:
p7319
aVAnd pass  in as the final (optional) arg to
p7320
aVUpdate: found my bug - I'd borked ; fixed
p7321
aVYou could probably also do something similar by building an expression at runtime for use as the comparer (and just returning the row itself as the key), but this is more complex
p7322
as(dp7323
g18
V23354
p7324
stp7325
a((dp7326
g2
(lp7327
VActually, C# (the language) doesn't know anything about serailization, but
p7328
aVNET (the framework) provides lots of ways
p7329
aV, ,  (
p7330
aVNET 3
p7331
aV0) - or there are a few bespoke serialization frameworks too
p7332
aVWhich to use depends on your requirements;  is simple to use, but burns assembly metadata information into the file - making it non-portable (you couldn't open it in Java, for example)
p7333
aVand  are primarily xml-based, making it quite portable, but fairly large unless you compress it
p7334
aVSome proprietary serializers are half-way between the two; protobuf-net is a binary formatter (so very dense data), but which follows a portable standard for the data format (Google's protocol buffers spec)
p7335
aVWhether this is useful depends on your scenario
p7336
aVTypical code (here using ):
p7337
as(dp7338
g18
V23354
p7339
stp7340
a((dp7341
g2
(lp7342
VAssociated data is usually handled via the  class (the property is is created for you if you use the dbml-generated code)
p7343
aVAssociations can be lazy or early loaded; by default, lazy (i
p7344
ag50
aVit is loaded when first needed) - but to force it to load early using / - see here
p7345
aVTo duplicate the example from the MSDN page:
p7346
aVHere, the  means that when a  is loaded, their  are fetched at the same time
p7347
aVThis is useful if you know which associated data you are going to need
p7348
aVWithout this, it would perform another TSQL query *per ** to get this data (but only if/when you asked for it)
p7349
as(dp7350
g18
V23354
p7351
stp7352
a((dp7353
g2
(lp7354
VInteresting question; don't know the answer - but if it really bugs you, you could declare an extension method, but it would still use the stack etc
p7355
aVIt would be nicer (for the syntax) if C# had extension properties, but the above is about the closest you can get at the moment, but it should "inline" quite well anyway
p7356
aVUpdate; thinking about it, there is another difference between static and instance; C# always calls instance methods with "" rather than "", even if ther type is sealed an non-nullable
p7357
aVSo perhaps there is a performance benefit from having it static
p7358
aVLuckily, extension methods still count as static, so you get to retain this behavior
p7359
as(dp7360
g18
V23354
p7361
stp7362
a((dp7363
g2
(lp7364
VIn 2
p7365
aV0 and above, there is  which has all the necessary hooks for an observable collection
p7366
aVThere is also (as already mentioned) now an  class, which is very similar
p7367
aVDeriving a new collection from  is also pretty reasonable in many circumstances
p7368
aVBut don't derive from , as this has no (useful) virtual methods
p7369
as(dp7370
g18
V23354
p7371
stp7372
a((dp7373
g2
(lp7374
VFirst off - don't use  here
p7375
aVUse parameters, and add parameters to the command
p7376
aVRight now, you are wide open to SQL injection attacks
p7377
aVThink "Bobby Tables"
p7378
aVRe "stating that my SQL Syntax is wrong" - can you please quote the exact error
p7379
as(dp7380
g18
V23354
p7381
stp7382
a((dp7383
g2
(lp7384
VI would expect that "test for null" pattern more if it was a factory method - i
p7385
ag50
aVThere is one other case worth knowing about, but which doesn't apply here (since we know the type we are creating)
p7386
aV; this is mainly an issue with generics:
p7387
aVThis is covered more here
p7388
as(dp7389
g18
V23354
p7390
stp7391
a((dp7392
g2
(lp7393
VThis might be one of the cases where LINQ by itself isn't enough
p7394
aVHave you considered writing this logic as a UDF or an SPROC instead, and simply using LINQ to call it
p7395
aVLINQ-to-SQL is very good at calling either (Entity Framework isn't so great with UDFs)
p7396
aVThen you could do the tag combining at the database, and return it as a varchar, for example
p7397
aVThere is a TSQL trick for doing this without a cursor:
p7398
aV(perhaps removing the trailing comma)
p7399
aVAfter running this,  will be the CSV of the values - very effective if you are returning a single row
p7400
aVNot so great if you are returning multiple main rows
p7401
as(dp7402
g18
V23354
p7403
stp7404
a((dp7405
g2
(lp7406
VYes, it is important if your item will be used as a key in a dictionary, or , etc - since this is used (in the absence of a custom ) to group items into buckets
p7407
aVIf the hash-code for two items does not match, they may never be considered equal ( will simply never be called)
p7408
aVThe  method should reflect the  logic; the rules are:
p7409
aVif two things are equal () then they must return the same value for
p7410
aVif the  is equal, it is not necessary for them to be the same; this is a collision, and  will be called to see if it is a real equality or not
p7411
aVIn this case, it looks like "" is a suitable  implementation
p7412
aVIf you are testing multiple properties, it is common to combine them using code like below, to reduce diagonal collisions (i
p7413
ag50
aVso that  has a different hash-code to ):
p7414
aVOh - for convenience, you might also consider providing  and  operators when overriding  and
p7415
aVA demonstration of what happens when you get this wrong is here
p7416
as(dp7417
g18
V23354
p7418
stp7419
a((dp7420
g2
(lp7421
VWell, you can declare it:
p7422
aVand use them as  and
p7423
aVOr with lambdas:
p7424
as(dp7425
g18
V23354
p7426
stp7427
a((dp7428
g2
(lp7429
VWell, protobuf-net (my version) is based on regular
p7430
aVNET types, so no (since it won't cope with different schemas all the time)
p7431
aVBut Jon's version might allow dynamic types
p7432
aVPersonally, I'd just use CSV and run it through GZipStream - I expect that will be fine for the purpose
p7433
aVEdit: actually, I forgot: protobuf-net does support extensible objects, but you need to be a bit careful
p7434
aVit would depend on the full context, I expect
p7435
aVPlus Jon's approach of nested data would probably work too
p7436
as(dp7437
g18
V23354
p7438
stp7439
a((dp7440
g2
(lp7441
VTo update an existing but disconnected object, you need to "attach" it do the data context
p7442
aVThis will re-use the existing primary key etc
p7443
aVYou can control how to handle changes- i
p7444
ag50
aVtreat as dirty, or treat as clean and track future changes, etc
p7445
aVThe Attach method is on the table - i
p7446
ag50
as(dp7447
g18
V23354
p7448
stp7449
a((dp7450
g2
(lp7451
VWell, protobuf-net will simply handle this for you; it runs off the properties of types, and has full support for
p7452
aVSince there is no direct way of expressing  in proto, it won't (currently) generate a  property from a "
p7453
aVproto" file, but it would be a nice tweak to recognise some common type ("BCL
p7454
aVDecimal" or similar) and interpret it as decimal
p7455
aVAs for representing it - I had a discussion document on this (now out of date I suspect) in the protobuf-net wiki area; there is now a working version in protobuf-net that simply does it for you
p7456
aVNo doubt Jon and I will hammer this out more later today ;-p
p7457
aVThe protobuf-net version of this (in
p7458
aVproto) is something like (from here):
p7459
as(dp7460
g18
V23354
p7461
stp7462
a((dp7463
g2
(lp7464
VYou cannot directly parameterize the table name
p7465
aVYou can do it indirectly via sp_ExecuteSQL, but you might just as well build the (parameterized) TSQL in C# (concatenating the table-name but not the other values) and sent it down as a command
p7466
aVYou get the same security model (i
p7467
ag50
aVyou need explicit SELECT etc, and assuming it isn't signed etc)
p7468
aVAlso - be sure to white-list the table name
p7469
as(dp7470
g18
V23354
p7471
stp7472
a((dp7473
g2
(lp7474
V adds a single record
p7475
aVdoes the same, but for a set () of records
p7476
aVThat's about it
p7477
as(dp7478
g18
V23354
p7479
stp7480
a((dp7481
g2
(lp7482
VIt is seeking for input
p7483
aVIn particular, I notice that you are redirecting stdin, but not closing it - so if it is reading from stdin it will hang
p7484
as(dp7485
g18
V23354
p7486
stp7487
a((dp7488
g2
(lp7489
VGenerally, I tend to have a lot more  than
p7490
aVUsually, there isn't much specific you can do with an exception, so let it bubble
p7491
aVBut the  ensures you can close things down cleanly etc
p7492
as(dp7493
g18
V23354
p7494
stp7495
a((dp7496
g2
(lp7497
VThe compiler has special treatment for string concatenation, which is why the second example is only ever one string
p7498
aVAnd "interning" means that even if you run this line 20000 times there is still only 1 string
p7499
aVRe testing the results
p7500
aVthe easiest way (in this case) is probably to look in reflector:
p7501
aVAs you can see (), the compiler has done this for you already
p7502
as(dp7503
g18
V23354
p7504
stp7505
a((dp7506
g2
(lp7507
VIs this code in the constructor/OnLoad of a form, by any chance
p7508
aVThere are known differences in this area between with / without debugger
p7509
aVThe fix is usually to defer the code until the UI thread is processing events
p7510
aVFor example:
p7511
as(dp7512
g18
V23354
p7513
stp7514
a((dp7515
g2
(lp7516
VIf you have access to a UI element, you can push to the UI thread by using things like:
p7517
aV(the  in MessageBox
p7518
aVShow helps parent the message-box)
p7519
aVIf you don't have access to a UI control, you can also use sync-context:
p7520
aVBut it is easier to keep hold of a control ;-p
p7521
as(dp7522
g18
V23354
p7523
stp7524
a((dp7525
g2
(lp7526
VHow about , and use the
p7527
aVRe "because that doesn't store times of the day
p7528
aV- well, it does if you think of a  as the time since midnight
p7529
aVA "duration", for example, screams
p7530
as(dp7531
g18
V23354
p7532
stp7533
a((dp7534
g2
(lp7535
VI have certainly seen some glitches in MDI at times, but to be honest I would probably suggest looking at WPF instead of winforms if you want something complex
p7536
as(dp7537
g18
V23354
p7538
stp7539
a((dp7540
g2
(lp7541
VYou cannot forcibly inject an event handler in front of other handlers already subscribed to an event
p7542
aVIf you need method A to be called first, then you'll need to subscribe A first
p7543
aVRe your comment, that is incredibly hacky
p7544
aVFirst, you can't even rely on an event having a delegate-field backer; it can be an  or other - which don't nevessarily expose handy hooks short of reversing the removal
p7545
aVSecond (and more important), it breaks every rule of encapsulation
p7546
aVIn general, if you want to be first, the best approach is to override the  method
p7547
aVThe second-best is to subscribe first
p7548
as(dp7549
g18
V23354
p7550
stp7551
a((dp7552
g2
(lp7553
VWell, you could implement  and seize full control
p7554
aVIt isn't entirely clear (without pseudo code) what the setup is - sometimes  can help, but I'm not sure in this case without an example of what you have, and what you do/don't want
p7555
as(dp7556
g18
V23354
p7557
stp7558
a((dp7559
g2
(lp7560
VWhat sort of data are you sending, and at what rate
p7561
aVAnd are you using lots of calls to remote () objects
p7562
aVIn reality, it is hard to fully control the data with remoting
p7563
aVPersonally, I would recommend something message-based, for example WCF
p7564
aVThis makes the interfaces between systems much more explicit and predictable
p7565
aVIf the proxy is being a pinch-point, you can still bypass this for remote addresses via proxycfg
p7566
aVexe
p7567
as(dp7568
g18
V23354
p7569
stp7570
a((dp7571
g2
(lp7572
VIf you have clients that can't yet understand the different cars, perhaps the most reliable option is to treat it as closed, and add a separate method:
p7573
ag412
ag50
aVonly the callers of the new  method will ever see  results
p7574
aVTaking this to the extreme, you could have a v2 endpoint, and leave the original v1 unchanged
p7575
aVYou can then migrate clients to the new API as-and-when
p7576
as(dp7577
g18
V23354
p7578
stp7579
a((dp7580
g2
(lp7581
VDon't concatenate the string () - use parameters ( etc) - then you can pass  to mean null to SQL Server
p7582
aVThis also protects you from SQL injection
p7583
as(dp7584
g18
V23354
p7585
stp7586
a((dp7587
g2
(lp7588
VThere are two types of nullable -  and reference-type
p7589
aVJon has corrected me that it is hard to get type if boxed, but you can with generics:
p7590
aV- so how about below
p7591
aVThis is actually testing type , but using the  parameter purely for generic type inference (to make it easy to call) - it would work almost identically without the  param, though
p7592
aVBut this won't work so well if you have already boxed the value to an object variable
p7593
as(dp7594
g18
V23354
p7595
stp7596
a((dp7597
g2
(lp7598
Vis a short-circuiting logic test - it only evaluates the right-hand-side if the left-hand-side is true
p7599
aVContrast to "a & b", which always evaluates both sides (and does a bitwise "and")
p7600
as(dp7601
g18
V23354
p7602
stp7603
a((dp7604
g2
(lp7605
VI don't know if it will work, but you could try this, pointing at the drive root
p7606
as(dp7607
g18
V23354
p7608
stp7609
a((dp7610
g2
(lp7611
VI'd agree with Jon on using lambdas where possible to avoid typos etc
p7612
aVHowever, if you genuinely can't do this (for whatever reason), I've looked at fully-dynamic  in the past
p7613
aVSee here for an example tested on LINQ-to-SQL (but it should be OK with EF in theory)
p7614
as(dp7615
g18
V23354
p7616
stp7617
a((dp7618
g2
(lp7619
VNote that whatever route you use, you should really encode the values -  should do that for you:
p7620
as(dp7621
g18
V23354
p7622
stp7623
a((dp7624
g2
(lp7625
VHere's another random thought - use neither ;-p I'm thinking of other exchange formats
p7626
aVI've done a lot of work lately with protocol buffers - this offers contract-first usage (via a "
p7627
aVproto" definition), but is designed with safe extensibility in mind - i
p7628
ag50
aVyou can design things to pass through unexpected data without breaking or loss
p7629
aVUnfortunately, the main protocol buffers spec doesn't actually include inheritance, but my implementation (protobuf-net) shims this via extensions
p7630
aVWhether it is mature enough depends on the scenario - I just thought it might be of interest
p7631
aVAs an aside, it (protobuf-net) also plugs into WCF for the convenience of a pre-rolled RPC stack ;-p
p7632
as(dp7633
g18
V23354
p7634
stp7635
a((dp7636
g2
(lp7637
VUnless you go for simple classes (POCO etc), your own implementation is likely to have nearly as much overhead as
p7638
aVPersonally, I'd look more at using tools like LINQ-to-SQL, Entity Framework, etc
p7639
aVThen you can use either LINQ-to-Objects against local data, or the provider-specific implementation for complex database queries without pulling all the data to the client
p7640
aVLINQ-to-Objects can do all the things you mention, but it involves having all the data in memory
p7641
aVIf you have non-trivial data, a database is recommended
p7642
aVSQL Server Express Edition would be a good starting point if you look at LINQ-to-SQL or Entity Framework
p7643
aVEdited re comment:
p7644
aVRegular TSQL commands are fine and dandy, but you ask about the difference
p7645
aVthe biggest being that LINQ-to-SQL will provide the entire DAL for you, which is a huge time saver, as well as making it possible to get a lot more compile-time safety
p7646
aVBut is also allows you to use the same approach to look at your local objects and your database - for example, the following is valid C# 3
p7647
aV0 (except for [someDataSource], see below):
p7648
aVIf [someDataSource] is local data, such as a , this will execute locally; but if this is from your LINQ-to-SQL data-context, it can build the appropriate TSQL at the database server
p7649
aVThis makes it possible to use a single query mechanism in your code (within the bounds of LOLA, of course)
p7650
as(dp7651
g18
V23354
p7652
stp7653
a((dp7654
g2
(lp7655
VOut of interest, how are you hosting the WCF server
p7656
aVIIS has convenient pooling (via a NLB such as F5), but has the app-pool recycle issue, and the lag caused by IIS spawning (on first demand) the app-pool/domain/etc in the first place
p7657
aVSelf hosted (windows service etc) tends to be more linear and predictable for performance, especially if (during service-start) you forcibly load everything, perhaps by making a request to yourself (if you see what I mean)
p7658
aVIf you don't need to cluster the service, consider self-hosting it
p7659
aVSee if that helps
p7660
as(dp7661
g18
V23354
p7662
stp7663
a((dp7664
g2
(lp7665
VIf you have the values, you should be able to use LINQ's GroupBy
p7666
as(dp7667
g18
V23354
p7668
stp7669
a((dp7670
g2
(lp7671
VReflection would be it, but the issue is the contained types - for example, you can't just use  or , since the sub-data also won't be conveniently comparable if it is a  etc
p7672
aVHow often do you need to do this
p7673
aVCould you serialize them and compare the serialized value
p7674
aVThat might be the most robust option
p7675
as(dp7676
g18
V23354
p7677
stp7678
a((dp7679
g2
(lp7680
VAttributes are burned at compile time, so as indicated, you can only use them with  constants
p7681
aVYou also can't change attributes, since even if it seems to let you, it doesn't "stick" next time you fetch the value back out
p7682
aVtvanfosson's  is probably the best option (he has my +1)
p7683
aVJust to illustrate the issue with updating attributes:
p7684
aVPrints:
p7685
as(dp7686
g18
V23354
p7687
stp7688
a((dp7689
g2
(lp7690
VYou should only use interop as a mechanism for pushing data between systems - not for core logic code; the performance hit of all the marshalling etc will be too much
p7691
aVI suggest you look at using the more recent VB variants in VS2008 etc
p7692
aVIt is a big shift, but if you can afford to make the change, you won't regret it
p7693
aVPersonally, when I moved from VB6 I switched to C#, but that decision has to be based on local context etc
p7694
as(dp7695
g18
V23354
p7696
stp7697
a((dp7698
g2
(lp7699
VWell, there don't seem to be any obvious events for this either on the  or the , and neither implements , so it looks like data-binding might not be possible here
p7700
aVUpdate: It does, however, raise the DateChanged, so you could hook some stuff together manually, or (more usefully) by subclassing the control to expose the values and events in a fashion suitable for binding
p7701
aVNote the  are useful because the end (otherwise) is just before midnight, rather than midnight itself
p7702
as(dp7703
g18
V23354
p7704
stp7705
a((dp7706
g2
(lp7707
VThere is  if you are using ordinals (which you are)
p7708
aVSo:
p7709
aVIf you are working with string column names, then to use this you'll have to call  first, for example:
p7710
aVOf course, it is faster to only look up ordinals once, not once per row
p7711
aVA similar approach can be used for  etc, or using a default instead of a null
p7712
as(dp7713
g18
V23354
p7714
stp7715
a((dp7716
g2
(lp7717
VCollections generally don't make good places for extra properties
p7718
aVBoth during serialization and in data-binding, they will be ignored if the item looks like a collection (, , etc - depending on the scenario)
p7719
aVIf it was me, I would encapsulate the collection - i
p7720
ag50
aVThe other option is to implement  (quite a lot of work), but that still won't work for data-binding etc
p7721
aVBasically, this isn't the expected usage
p7722
as(dp7723
g18
V23354
p7724
stp7725
a((dp7726
g2
(lp7727
VOddly, I was discussing this with Jon the other evening
p7728
aVThere is a precedence issue - the overridden method is defined in the base-class, so for "best method" purposes, the overload (even with an implicit cast) is preferable, since it is defined in the most-specific type (the subclass)
p7729
aVIf you re-declared the method (), then it would get precedence, but you can't  and  a method with the same name and signature in the same type - you'd have to add an extra level of inheritance to achieve this
p7730
aVThe exact logic for this is detailed in 14
p7731
ag691
aV5 and 14
p7732
aV4
p7733
aV2 of ECMA 334 v4
p7734
aVBasically, to make the base method callable, you'll either have to cast to the base-type, or add a shim method:
p7735
as(dp7736
g18
V23354
p7737
stp7738
a((dp7739
g2
(lp7740
Vwell, yes
p7741
aVIn order to compile, it needs to be able to resolve everything in the public/protected API
p7742
aVOtherwise it can't enforce the constraint
p7743
aVI imagine it needs to recognise the types to see if the extension method is a candidate for a method
p7744
aVYou could try placing the extension methods in a child namespace that has "Web" in it - at least then it won't spill into regular code
p7745
aVI've checked, and this fixes the issue
p7746
aVIt is good practice to separate the namespaces of extension methods to allow the caller to control when they should be in scope
p7747
aVIn order to execute, it would also need to be able to resolve anything used internally but not exposed in the API
p7748
aVThis is standard behavior
p7749
as(dp7750
g18
V23354
p7751
stp7752
a((dp7753
g2
(lp7754
VI've used timestamp columns as a matter of routine for years
p7755
aVAnother option is a row-version, but then you need to update it etc
p7756
aVI've never had any problems with timestamp
p7757
aVOne word of caution - if you ever select into a temp-table/table-var for processing, you need to use , not , in the temp table - otherwise your temp table will get its own unique timestamps upon update ;-p
p7758
aVAs you acknowledge,  only helps with concurrency
p7759
aVDespite the name, it has nothing directly to do with time, so won't help with auditing
p7760
aVIt is nicely supported in the MS db offerings (LINQ-to-SQL / EF / etc)
p7761
as(dp7762
g18
V23354
p7763
stp7764
a((dp7765
g2
(lp7766
VWell, web-servers present an interesting challenge in that they are already highly threaded, servicing parallel requests
p7767
aVSo on a busy site, you can't rely on being able to steal lots of cores for your ends
p7768
aVOf course, if you only expect light traffic, and your site requires lots of crunching (data processing etc), then you might be able to get some savings
p7769
aVI would expect Parallel Extensions to work better at the client, or dedicated service apps, where you can reasonably expect the cores to be available for your [ab]use
p7770
as(dp7771
g18
V23354
p7772
stp7773
a((dp7774
g2
(lp7775
VWhat is the relationship between the  class and
p7776
aVIf  returns the set of  object, note you can't normally  a mapped entity
p7777
aVI wonder if it would work any better if you did the OrderBy before the Select
p7778
aVOne final trick might be to create a fake composable , using trivial TSQL
p7779
aVFor example,  might be enough
p7780
ag412
ag50
aVsomething like (on the context):
p7781
aVThen try:
p7782
aVI haven't tested the above, but can give it a go later
p7783
aVit works for some other similar cases, though
p7784
aVWorth a shot
p7785
as(dp7786
g18
V23354
p7787
stp7788
a((dp7789
g2
(lp7790
VType converters are a lot more complex than they seem; a type-converter has access to a range of meta-data about the context of the conversion - for example, the property and object that are involved
p7791
aVThis is used to provide custom options per scenario (think: linked drop-downs, i
p7792
ag50
aVCountry / County / City / etc)
p7793
aVYou can also specify the type-converter on a per-property basis, which I use in lots of places to provide different handling of various string properties
p7794
aVAn operator would treat all strings identically
p7795
aVAn implicit operator only knows about the value that is being converted, but has far greater compile-time support
p7796
aVOr another way:
p7797
aVis a framework feature with framework support;
p7798
aVoperators are (primarily) a language feature with language support
p7799
aVTo add more - type-converters (despite the name) don't just convert:
p7800
aVthey provide sub-property metadata (think: expanding properties on )
p7801
aVthey suggest available options for a type (think: drop-down choices on )
p7802
aVNote they are used in more places than just , though ;-p
p7803
as(dp7804
g18
V23354
p7805
stp7806
a((dp7807
g2
(lp7808
VJon Skeet has an EndianBitConverter here that should do the job
p7809
aVJust use big/little endian as desired
p7810
aVAlternatively, just shift the data a few times ;-p
p7811
as(dp7812
g18
V23354
p7813
stp7814
a((dp7815
g2
(lp7816
VI'm from a maths background, and have looked at F#, but I still prefer C# for most purposes
p7817
aVThere are a couple of things that F# makes easier, but in general I still prefer C# by a large margin
p7818
aVSome of the touted F# benefits (immutability, higher-order functions, etc) can still be done in C# (using delegates etc for the latter)
p7819
aVThis is even more apparent when using C# 3
p7820
aV0 with lambda support, which makes it very easy and expressive to declare functional code
p7821
aVFrom a maintenance angle, I'm of the view that suitably named properties etc are easier to use (over full life-cycle) than tuples and  head/tail lists, but that might just be me
p7822
aVOne of the areas where C# lets itself down for maths is in generics and their support for operators
p7823
aVSo I spend some time addressing this ;-p My results are available in MiscUtil, with overview here
p7824
as(dp7825
g18
V23354
p7826
stp7827
a((dp7828
g2
(lp7829
VIf you are used to , presumably you are used to the change tracking and the persistence support that adapters (etc) bring
p7830
aVIn which case, have you considered LINQ-to-SQL and/or Entity Framework
p7831
aVThese both support rich chaneg tracking and automated persistence, while offering various other DAL use-cases such as composable queries and all that other LINQ goodness
p7832
aVDefinitely worth investigation
p7833
aVNote that changing to typed POCO entities (i
p7834
ag50
aVnot  nor a subclass there-of) is still a big deviation, so it won't be a simple change
p7835
aVIf you haven't the time for a major change, it would be pragmatic to stick with  (perhaps typed)
p7836
aVThis will provide , , etc for you, or you can just use ,  etc for ad-hoc usage
p7837
as(dp7838
g18
V23354
p7839
stp7840
a((dp7841
g2
(lp7842
VWell, you could perhaps add a  method:
p7843
aVThe  patten is recognised, and the method is called to see whether to include the property in the serialization
p7844
aVThere is also an alternative  pattern that allows you to also detect things when deserializing (via the setter):
p7845
as(dp7846
g18
V23354
p7847
stp7848
a((dp7849
g2
(lp7850
VIn
p7851
aVNET 3
p7852
aV5, there is an  that represents this
p7853
aVThe regular implementation () is immutable, but I have an  in MiscUtil that should do the job nicely
p7854
as(dp7855
g18
V23354
p7856
stp7857
a((dp7858
g2
(lp7859
VWell, you could use the Linq  method, and multiple loops
p7860
aVBeyond that, you're into conditional statements
p7861
aVI did look at this here in relation to F#, which does this more cleanly
p7862
aVAs an aside; if this was using PushLINQ (in MiscUtil) you could do this in a single iteration, by pushing the different types through different branches - not sure it warrants it just for this, though
p7863
as(dp7864
g18
V23354
p7865
stp7866
a((dp7867
g2
(lp7868
VWell, it isn't really singleton - since you can't control , there can be as many  instances as you like
p7869
aV(removed thread-race; noted the double-checked usage)
p7870
as(dp7871
g18
V23354
p7872
stp7873
a((dp7874
g2
(lp7875
s(dp7876
g18
V23354
p7877
stp7878
a((dp7879
g2
(lp7880
VAs part of a projection, LINQ-to-SQL should handle that - have you tried
p7881
aVIf you want those properties to become part of the object model itself
p7882
aVtrickier, and not very entity related
p7883
aVYou could add properties in the partial class, but you'd have to do lots of load-options to make them load eagerly
p7884
aVIn reality, it probably isn't worth it given how it complicated the object model
p7885
as(dp7886
g18
V23354
p7887
stp7888
a((dp7889
g2
(lp7890
VNo,  is a good thing to return here, since all you are promising is "a sequence of (typed) values"
p7891
aVIdeal for LINQ etc, and perfectly usable
p7892
aVThe caller can easily put this data into a list (or whatever) - especially with LINQ (, , etc)
p7893
aVThis approach allows you to lazily spool back values, rather than having to buffer all the data
p7894
aVDefinitely a goodie
p7895
aVI wrote-up another useful  trick the other day, too
p7896
as(dp7897
g18
V23354
p7898
stp7899
a((dp7900
g2
(lp7901
VDo you mean:
p7902
as(dp7903
g18
V23354
p7904
stp7905
a((dp7906
g2
(lp7907
VIf the inner query is inline in the , you may struggle to select multiple values
p7908
aVHowever, it is often possible to  to a sub-query instead; that way, the sub-query can be named and you can get multiple results
p7909
aVWhich might help
p7910
aVdoes what it says
p7911
aVIIRC, you can  etc to query distinct data
p7912
as(dp7913
g18
V23354
p7914
stp7915
a((dp7916
g2
(lp7917
VIt might not be possible, but you might want to consider switching to
p7918
aVNET, where VB has full support for threading
p7919
aVAnother cheeky approach (not very good, but it works) might to shell an exe to do the work, and have your VB6 simply poll for a results file
p7920
aVThis will be a separate process, so completly isolated thread(s)
p7921
aVReally messy, and I don't recommend it
p7922
as(dp7923
g18
V23354
p7924
stp7925
a((dp7926
g2
(lp7927
VAs an aside - you can always simply inherit from  as a starting point
p7928
aVthis provides the raw code, while letting you customize things
p7929
aVYou can inherit from , but unlike  there are no useful  methods on
p7930
as(dp7931
g18
V23354
p7932
stp7933
a((dp7934
g2
(lp7935
VYour original code was not legal
p7936
aVYour edited code is fine; all 3 variables are assigned the same string ("a String")
p7937
aVWhat exact error are you seeing
p7938
aV(question updated to include "Object reference not set to an instance of an object")
p7939
aVThis error has nothing to do with the code posted (unless you mis-represented the code when pasting it), and nothing to do with the  comment
p7940
aVYou need to look elsewhere
p7941
aVTry looking at the stack-trace, or injecting debug/output messages
p7942
aVOr just step through the code to see where it actually blows up
p7943
as(dp7944
g18
V23354
p7945
stp7946
a((dp7947
g2
(lp7948
VWell, you could close the file
p7949
aVthat would probably do it
p7950
aVIn reality, with HAL abstraction, virtualization, and disk hardware now having more processing power and cache memory than computers did a few years ago, you're going to have to live with hoping the disk does its job
p7951
aVThe transactional file system never really materialized ;-p Of course, you could perhaps look at using a database as a back end, and use the transaction system of that
p7952
aVAside: note that not all streams even guarantee to  - for example,  etc retain a working buffer of uncommitted data even after a flush - the only way to get it to flush everything is to  it
p7953
as(dp7954
g18
V23354
p7955
stp7956
a((dp7957
g2
(lp7958
VI would fully expect the write-lock to function as a memory barrier (within the write-lock, in particular), but I can't prove it off-hand
p7959
aVWhether you need the complexity of  depends on the context; , ,  or  might each do the job far more simply
p7960
aVYou mainly need  if you have lots of readers and few writers
p7961
aVHowever, the  is not currently protected by the lock; you'll need to us an explicit property implementation and take out a read lock yourself if you ever need multiple operations to be spanned by the write-lock (without readers seeing intermediate values)
p7962
aVAs an aside, the  usage would probably be more familiar to people
p7963
aVYou should also use / to ensure you release the lock on exception
p7964
aVTo avoid the issue of taking write then read locks, perhaps:
p7965
aVUpdated re your edit;
p7966
aVThat looks pretty solid
p7967
aVA  would be my recommendation (over a  array), since it will do all the doubling etc internally, saving you lots of code
p7968
aVSince only one thread can update  at a time, there is no need for , and this property saves the need for a lock when reading , as long as you're fine for callers to get the old  while another thread is adding rows (rather than being blocked)
p7969
as(dp7970
g18
V23354
p7971
stp7972
a((dp7973
g2
(lp7974
VNote that you don't actually submit those changes, and that ideally you should be  the context to ensure it gets d
p7975
aVRe being optimal - there is a glitch in LINQ-to-SQL where-by the best way to get an individual record is via the  or  methods, since these methods use the identity manager for primary-key queries
p7976
aVMeaning: if you ask juts by the primary key, and the data-context already knows about the record, it won't hit the database
p7977
aVMost other queries do hit the database (including )
p7978
aVSo if the  is the primary key, I Would tweak to:
p7979
aVIn this case it might not make much difference (since the context probably won't have seen it), but it is good to know about
p7980
as(dp7981
g18
V23354
p7982
stp7983
a((dp7984
g2
(lp7985
VWell, you can cast
p7986
aVor you can use a non-public instance method for both:
p7987
aVPersonally, though, I prefer to see a public GetEnumerator() - same as I like a public Dispose() - it makes it easier for the consumer to know it is there
p7988
aVI don't think all interface implementations should be public (far from it), but  and  are so fundamental that a little advertising doesn't hurt
p7989
as(dp7990
g18
V23354
p7991
stp7992
a((dp7993
g2
(lp7994
VYou can use  to build any iterator
p7995
aVThat could be a lazily evaluated series (reading lines from a file or database, for example, without reading everything at once, which could be too much to hold in memory), or could be iterating over existing data such as a
p7996
aVC# in Depth has a free chapter (6) all about iterator blocks
p7997
aVI also blogged very recently about using  for smart brute-force algorithms
p7998
aVFor an example of the lazy file reader:
p7999
aVThis is entirely "lazy"; nothing is read until you start enumerating, and only a single line is ever held in memory
p8000
aVNote that LINQ-to-Objects makes extensive use of iterator blocks ()
p8001
aVFor example, the  extension is essentially:
p8002
aVAnd again, fully lazy - allowing you to chain together multiple operations without forcing everything to be loaded into memory
p8003
as(dp8004
g18
V23354
p8005
stp8006
a((dp8007
g2
(lp8008
VReflector will do this (and is free)
p8009
aVFind the interface, and expand the "Derived Types" node in the tree
p8010
aVAlternatively, the "Class Diagram" project item in Visual Studio should do it, but I like the clean nature of Reflector
p8011
as(dp8012
g18
V23354
p8013
stp8014
a((dp8015
g2
(lp8016
VTo be honest, that doesn't look terrible (although I also have very little F# experience)
p8017
aVDoes F# offer an easy way to iterate (foreach)
p8018
aVIf this was C#, I might use something like (where  is a  argument):
p8019
aVI wonder how that translates to F#
p8020
as(dp8021
g18
V23354
p8022
stp8023
a((dp8024
g2
(lp8025
VNo, unless the type (with the protected member) is itself internal
p8026
aVInternal types cannot be part of a public/protected API, as the consumer would have no way of using it
p8027
aVYou could, however, consider using a public interface to abstract the type - i
p8028
ag50
aVGenerics can be useful for this too:
p8029
as(dp8030
g18
V23354
p8031
stp8032
a((dp8033
g2
(lp8034
VI always keep a copy of Express Edition running; this can execute and debug projects without needing a proper file location (as long as you don't hit save)
p8035
aVDoes the job for me
p8036
as(dp8037
g18
V23354
p8038
stp8039
a((dp8040
g2
(lp8041
VSubclassing is about inheriting implementation; and fields are an implementation detail
p8042
aVThe fields are indeed present, and are available via reflection
p8043
aVBut ultimately, it is the base-classes job to manage the state of those fields via any public/protected/etc members
p8044
aVBut ultimately - if a base-class declares a property (and field) for property , then when you set that property the data has to go somewhere
p8045
aVThe sub-class has to include all the fields from the base-class for it to make sense
p8046
aVThis is also critical for field-based serialization frameworks (such as )
p8047
as(dp8048
g18
V23354
p8049
stp8050
a((dp8051
g2
(lp8052
V(edited - small bug)
p8053
aVFor info, in
p8054
aVNET 3
p8055
aV5 you might want to use the  delegate instead of rolling your own, since people will recognise it more
p8056
aVEven in 2
p8057
aV0, there are lots of  delegates: , , etc - but  is the easiest to follow ;-p
p8058
as(dp8059
g18
V23354
p8060
stp8061
a((dp8062
g2
(lp8063
VThe "deep" is the tricky bit
p8064
aVFor a shallow copy, you could use reflection to copy the fields (assuming none are readonly, which is a big assumption) - but it would be very hard to get this to work (automatically) otherwise
p8065
aVThe other option is to provide the serializer yourself (and serialize to deep-clone) - a "serialization surrogate"
p8066
aVHere's a VB example
p8067
as(dp8068
g18
V23354
p8069
stp8070
a((dp8071
g2
(lp8072
VCould you possibly re-write the xml as unicode (perhaps to a ) and send that
p8073
aVNote: if you are just storing the data, you can use  (and it will actually be quicker)
p8074
aVThis has no encoding difficulties, and will also allow you to audit any corrupt xml that you receive
p8075
aVIf you are querying the data as xml inside the database server then  is obviously the way to go
p8076
as(dp8077
g18
V23354
p8078
stp8079
a((dp8080
g2
(lp8081
VThere are a few sectors where it is (or OCaml) is quite common - such as finance, or other statistical analysis
p8082
aVHowever, I severely doubt that it is suddlenly going to leap to the fore for mainstream code
p8083
aVOne of the bigger issues here is that since C# gets more functional (and hopefully with better immutability in C# 5
p8084
aV0), it has less and less to distinguish it from the regular
p8085
aVNET languages like C#
p8086
aVSee also here and here
p8087
as(dp8088
g18
V23354
p8089
stp8090
a((dp8091
g2
(lp8092
VThere are things like discriminated unions, but I reached the exact same conclusion that you did
p8093
aVAnd I'm not a big fan of the tuples - I like named properties, so I don't need to remember everything by position
p8094
aVThings like immutabiliy is a false lead - since you can do that in C#, and hopefully C# 5 will make it easier too
p8095
aVRe syntactic neatness
p8096
aVI find C# neater and easier to follow, bugt that might be familiarity
p8097
aVThere is a better switch syntax, but that can be introduced into C# - see here (including replies)
p8098
aVRe anon-methods, nobody is forcing you to use them, but lambdas are a very tidy way of expressing intent in many cases
p8099
as(dp8100
g18
V23354
p8101
stp8102
a((dp8103
g2
(lp8104
VObvious question, but are you sure the column is mapped in the dbml / mapping file
p8105
aVAlso - is it a calculated column
p8106
aV(i
p8107
ag50
aVprice => units * unitprice)
p8108
as(dp8109
g18
V23354
p8110
stp8111
a((dp8112
g2
(lp8113
VI wonder if you can add a calculated+persisted+indexed field to the database, that does this for you
p8114
aVIt would be fairly trivial to write a UDF that gets the value as an integer (just using string values), but then you can sort on this column at the database
p8115
aVThis would allow you to use  and  effectively, rather than constantly fetching all the data to the
p8116
aVNET code (which simply doesn't scale)
p8117
as(dp8118
g18
V23354
p8119
stp8120
a((dp8121
g2
(lp8122
VUnfortunately, double-quotes have special meaning inside FTI, so even if you parameterize it, the FTI engine treats it as a phrase delimiter
p8123
aVI am not sure there is an easy way to include double-quotes in an FTI search
p8124
aVBrackets are also a special character, but can be encased in quotes to treat as a query term - but not AFAIK double-quotes
p8125
aVUpdate
p8126
aVA bit of searching suggests that doubling the quote to "" may fix it - worth a try
p8127
aVPersonally, I'd do this inside the DB, since this is a TSQL implementation detail
p8128
aVLikewise, ' needs to be doubled to '' before passing to FTI (completely separate to TSQL escaping),
p8129
as(dp8130
g18
V23354
p8131
stp8132
a((dp8133
g2
(lp8134
VYou need to use a  to get a value; values exist in the data, not the column headers
p8135
aVIn LINQ, there is an extension method that might help:
p8136
aVor without LINQ:
p8137
aV(assuming the data is a string
p8138
aVif not, use )
p8139
aVIf you have a  rather than a , then the same works with a :
p8140
as(dp8141
g18
V23354
p8142
stp8143
a((dp8144
g2
(lp8145
VDoes the CustomerId help uniquely identify the row past @Id
p8146
aVI didn't really follow the "triggers" bit, since the predicate used for the update is not known by the trigger
p8147
aVOr you do want to re-update the CustomerId each time (detectable from  in the trigger)
p8148
aVThe easiest option is to do it as object updates:
p8149
aVIf you know you are expecting one record, you could use:
p8150
aVYou might also be able to write it as Entity-SQL, but I'm not sure I'd bother, personally
p8151
aV(update: I've just checked, and I don't think Entity-SQL includes DML, so no, you can't - you'd have to use either the above, or a regular SQL command/SPROC)
p8152
as(dp8153
g18
V23354
p8154
stp8155
a((dp8156
g2
(lp8157
VI don't think so
p8158
aVIn this case, LINQ to Objects will probably just treat the two sides as regular enumerable objects, and do the join manually (without looking at the )
p8159
as(dp8160
g18
V23354
p8161
stp8162
a((dp8163
g2
(lp8164
VNot so much in the ASP
p8165
aVNET stuff, but before that (with VB6) I used to use it almost exclusively (at the server) to transform xml to html
p8166
aVI've always found it incredibly versatile
p8167
aVI also use it in my "protocol buffers" project as the code-generator engine: the main framework produces xml, and then I use an xsl transform to spit out the C#
p8168
aVI've heard people say they don't find xsl intuitive, but I really like it, and it is my default ttool when processing xml
p8169
aVRight now, I'm looking lots at ASP
p8170
aVNET MVC, which doesn't necessarily lend itself to xsl much - although in some ways, there isn't much between  and
p8171
as(dp8172
g18
V23354
p8173
stp8174
a((dp8175
g2
(lp8176
VTo my view, the main answer has to be regular windows forms, or if you prefer (and to be up-to-date) WPF
p8177
aVBoth have good support for data-binding etc, however, neither are directly comparable to ms-access forms
p8178
aVAnd such forms cannot be stored in isolation, but only really exist as part of an assembly
p8179
aVWell, WPF can exist a bit more standalone as xaml, but even then there is almost always plenty of code-behind (that is part of the assembly, not detachable)
p8180
as(dp8181
g18
V23354
p8182
stp8183
a((dp8184
g2
(lp8185
VIn terms of how this is implemented, this changes the method - from OrderBy/ThenBy to OrderByDescending/ThenByDescending
p8186
aVHowever, you can apply the sort separately to the main query
p8187
aVAny use
p8188
aVYou can create the entire "order" dynamically, but it is more involved
p8189
aVAnother trick (mainly appropriate to LINQ-to-Objects) is to use a multiplier, of -1/1
p8190
aVThis is only really useful for numeric data, but is a cheeky way of achieving the same outcome
p8191
as(dp8192
g18
V23354
p8193
stp8194
a((dp8195
g2
(lp8196
VThe idea with generics is usually to do the same logic with whichever inputs you are given, although obviously you need to be practical
p8197
aVPersonally, I'd probably use two different methods, rather than brute-force them into the same method, but that would make it hard to call from a generic method just knowing about
p8198
aVThere is no way of satisfying the  /  from static code, although the  approach might work, but will be an order of magnitude slower
p8199
aV(substitute  with the type that hosts the methods)
p8200
aVThe alternative (as Jon notes) is to cache the (typed) delegate to the method:
p8201
aVMore work, but will be plenty quick
p8202
aVThe static constructor (or you could use a property/null check) ensures we only do the hard work once
p8203
as(dp8204
g18
V23354
p8205
stp8206
a((dp8207
g2
(lp8208
VNot impossible to do
p8209
aValthough not necessarily through managed code
p8210
aVAnything that has access to a process dump (windb / sos / etc) will have no difficulty looking for strings
p8211
as(dp8212
g18
V23354
p8213
stp8214
a((dp8215
g2
(lp8216
VIf you want a list of the open forms, that is
p8217
aVYou could iterate over this, using GetType() and checking the  to find those from a different assembly
p8218
aVBeyond that, I'm not entire clear on the question
p8219
aVIf you just want to track forms you have opened yourself, then cache that instance
p8220
aVOr if you use "owned forms", you can just check by name:
p8221
as(dp8222
g18
V23354
p8223
stp8224
a((dp8225
g2
(lp8226
VHow about , with the overload that accepts a string, the font, and the max width
p8227
aVThis returns a , so you can round round-off the
p8228
as(dp8229
g18
V23354
p8230
stp8231
a((dp8232
g2
(lp8233
VTry just using  for the  - also, you should be  this (it is ):
p8234
as(dp8235
g18
V23354
p8236
stp8237
a((dp8238
g2
(lp8239
VI'd agree with the first definitely - the second most of the time ("never say never"), but wouldn't get excited by the third; apart from anything else, it creates an unnecessary distinction between structs and classes
p8240
aVIn some cases, having an implicit conversion can vastly simplify a calling convention
p8241
aVFor explicit conversions, all things are possible
p8242
aVIt isn't that often you need to write conversion operators, though
p8243
aVAnd in many cases, explicit operators are more useful, with the acceptance that they can break if conditions aren't right (for example, with , if they don't have a value)
p8244
as(dp8245
g18
V23354
p8246
stp8247
a((dp8248
g2
(lp8249
VHow have you done your timings
p8250
aVAre you in the debugger
p8251
aVIn debug mode
p8252
aVIt looks like you are using , so I used your code as the template for a test rig (creating 1000 rows each time), and used the harness as below, in release mode at the command line; the results were as follows (the number in brackets is a check to see they both did the same work):
p8253
aVTest harness:
p8254
aV(note you shouldn't normally use , but it has uses for levelling the field for performance tests)
p8255
aVThe only other change I made was to the  loop, to avoid repetition:
p8256
aVSo I don't reproduce your numbers
p8257
as(dp8258
g18
V23354
p8259
stp8260
a((dp8261
g2
(lp8262
VYou'll be able to use the LINQ extension methods directly with , but not with , unless you inject a  /  (thanks to  vs )
p8263
aVThat's worth quite a bit, even if you don't need type safety etc
p8264
aVThe speed will be about the same; structs will still be boxed, etc - so there isn't much else to tell them apart
p8265
aVExcept that I tend to see  as "oops, somebody is writing legacy code again
p8266
aV;-p
p8267
as(dp8268
g18
V23354
p8269
stp8270
a((dp8271
g2
(lp8272
VAn  (or ) is basically anything that is responsible for serving content
p8273
aVAn ASP
p8274
aVNET page (aspx) is a type of handler
p8275
aVYou might write your own, for example, to serve images etc from a database rather than from the web-server itself, or to write a simple POX service (rather than SOAP/WCF/etc)
p8276
as(dp8277
g18
V23354
p8278
stp8279
a((dp8280
g2
(lp8281
VApparently it has been added in 3
p8282
aV5 via RemoteEndpointMessageProperty; see here
p8283
as(dp8284
g18
V23354
p8285
stp8286
a((dp8287
g2
(lp8288
VThere are two;
p8289
aVDataContractJsonSerializer in 3
p8290
ag691
aVJavaScriptSerializer in 3
p8291
aV5 SP1
p8292
aVIn the traditional way, they aren't 100% compatible with each-other, especially re ; DCJS uses (IIRC) a literal string; JSS uses  - and neither can read t'other correctly
p8293
aVOf course, if the text if opaque, you could also use any concise binary serializer, and simply base-64 encode it; for example, protobuf-net is pretty terse
p8294
aVBut using JSON minimizes the external code needed at each end, so may well be your best bet
p8295
as(dp8296
g18
V23354
p8297
stp8298
a((dp8299
g2
(lp8300
VThe  type is essentially , but will resolve all method / property / operator etc calls at runtime via the DLR or other provider (such as reflection)
p8301
aVThis makes it much like VB with , and makes it very versatile for calling into COM, or into DLR types
p8302
aVThere is no type checking at compile time with dynamic; convesely, anonymous types are proper static-typed, type-checked beasts (you can see them in reflector, although they aren't pretty)
p8303
aVAdditionally, anonymous types can be handled exclusively by the compiler;  requires extensive runtime support - so anonymous types are a C# feature, but  will largely be implemented by
p8304
aVNET 4
p8305
aV0 (with some C# 4
p8306
aV0 support)
p8307
as(dp8308
g18
V23354
p8309
stp8310
a((dp8311
g2
(lp8312
VYes, it is
p8313
aVFor proof:
p8314
as(dp8315
g18
V23354
p8316
stp8317
a((dp8318
g2
(lp8319
VCan't you just override  and check
p8320
aVYou might also want to override  to catch that
p8321
as(dp8322
g18
V23354
p8323
stp8324
a((dp8325
g2
(lp8326
VOK, that is really quite dangerous
p8327
aVControls are not meant to be parented by multiple forms / controls
p8328
aVYou would do much better to share the data (via an observable collection, such as , or  if you are so inclined)
p8329
aVObviously this means setting the data-member/data-source, or doing all the updates (to all the grids) yourself
p8330
aVBut seriously;  (nor any other control AFAIK) is not meant to be used like that
p8331
aVFor info, assuming that VB's  is comparable to C#'s , then you don't need that anyway
p8332
aVyou are already only passing the reference (by value)
p8333
aVBut that isn't important since it won't work either way
p8334
as(dp8335
g18
V23354
p8336
stp8337
a((dp8338
g2
(lp8339
VWell, the regular implementation does check up the control stack, to ensure that all parents are visible
p8340
aVThe only way I know to dodge this is to cheat with reflection, and ask for , but that is brittle:
p8341
as(dp8342
g18
V23354
p8343
stp8344
a((dp8345
g2
(lp8346
VWell,  allows re-entrancy, so you can't deadlock yourself
p8347
aVso no: it shouldn't do
p8348
as(dp8349
g18
V23354
p8350
stp8351
a((dp8352
g2
(lp8353
VThe best thing I can suggest is to replace the combo-box with a read-only textbox (or just perhaps a label) - that way the user can still select/copy the value, etc
p8354
aVOf course, another cheeky tactic would be to set the  to , and just remove all other options - then the user has nothing else to pick ;-p
p8355
as(dp8356
g18
V23354
p8357
stp8358
a((dp8359
g2
(lp8360
VLINQ to Entities is really simply the standard LINQ extension methods (Where, OrderBy, etc), when used to query Entity Framework
p8361
aVThis isn't the only option; EF can also be queried in a custom dialect of SQL - Entity SQL
p8362
aVIn reality, the LINQ extension methods are used to generate Entity SQL, and then that Entity SQL is passed down to the provider
p8363
aVThat way, people implementing a new EF provider (since it is extensible) only have to worry about one thing for query: Entity SQL
p8364
aVOf course, to strictly count as LINQ, you would need to use the language part too, i
p8365
ag50
aVetc - but since this boils down to extension methods anyway (on /), most people would count direct extension usage as LINQ - i
p8366
ag50
as(dp8367
g18
V23354
p8368
stp8369
a((dp8370
g2
(lp8371
VWell, I'm assuming each int is the composite ARGB value
p8372
aVIf there isn't an easy option, then LockBits might be worth looking at - it'll be a lot quicker than , but is more complex
p8373
aVYou'll also have to make sure you know how the int is composed (ARGB
p8374
aVRGBA
p8375
aVI'll try to see if there is a more obvious option
p8376
as(dp8377
g18
V23354
p8378
stp8379
a((dp8380
g2
(lp8381
VSecurity isn't the only issue; simply, serialization only makes sense for certain classes
p8382
aVFor example, it makes little snse to serialize a "connection"
p8383
aVA connection string, sure, but the connection itself
p8384
aVnah
p8385
aVLikewise, anything that requires an unmanaged pointer/handle is not going to serialize very well
p8386
aVNor are delegates
p8387
aVAdditionally,  and  (by default) are tree serializers, not graph serializers - so any recursive links (like ) will cause it to break
p8388
aVMarking the class with the serializer's preferred token is simply a way of saying "and it should make sense"
p8389
aVIIRC, both  and  used to be very rigid about demanding things like ,  or , but they have become a bit more liberal lately
p8390
as(dp8391
g18
V23354
p8392
stp8393
a((dp8394
g2
(lp8395
VThe  takes control of these buttons itself, to enable/disable them as appropriate; i
p8396
ag50
aVyou can't go prev/next if there is no more data, you can't add/delete without the underlying source letting you (/
p8397
aVWhich buttons do you want to tweak
p8398
aVFor example, you can disable add/remove by using a data-source such as , and setting /
p8399
aVAlternatively, simply write your own buttons completely (forget ) - it isn't a lot of work, especially if you start with a  on the form (since that has all the necessary  etc
p8400
as(dp8401
g18
V23354
p8402
stp8403
a((dp8404
g2
(lp8405
VTo be honest, I wouldn't worry about it - it should be more than sufficient
p8406
aVI use an extension object to do things like regex-replace and other complex string manipulations (not always simple in xslt) and it works a treat
p8407
aVIf you are only doing a few global strings, then you could also use template-level parameters (rather than an extension); but if you have lots to look up (or they are dynamic), then an extension object makes pretty good sense
p8408
aVIf possible, use , which will improve performance (and certainly, a C# method in an extension method will out-perform a  method in the xslt)
p8409
aVOther than that, if you have a bottle-neck, it is most-likely things like not using xsl-indexes correctly, Muenchian-grouping, etc
p8410
as(dp8411
g18
V23354
p8412
stp8413
a((dp8414
g2
(lp8415
VThis is a common problem with code-generation; while you can add members and class level attributes via an additional partial class, you can't add attributes to the generated members
p8416
aVTo compensate, some attribute-based mechanisms allow you to specify the attributes at the class (naming the member), but not any of the ones you cite
p8417
aVOne hardcore option would be to write a  that supplies custom  definitions for the properties
p8418
aVThis would allow you to fully control the metadata used by UI binding tools like , , etc
p8419
aVHowever, this is possibly too much work simply to set a few UI propertiex if you can also set them by hand
p8420
aVBut if you are interested in pursuing that option, let me know - it is a familiar area to me, but too much code to write an example if you don't want it
p8421
aVNote: if you are using , then you can't set the properties by hand, but you can write a , which is a bit less work than a full ; just inherit from  and override
p8422
aVYou'll still need a shim , so still not trivial
p8423
as(dp8424
g18
V23354
p8425
stp8426
a((dp8427
g2
(lp8428
VThat is an interesting question
p8429
aVit works with , for example, but not , which are both proper
p8430
aVNET types (unlike  etc that are primatives) and both have an + operator
p8431
aVCurious
p8432
aVOf course, you can twist the arm with:
p8433
aVAnd it you just use  it'll work for free, of course - plus you get the compiler + runtime (boxing) support
p8434
aVIs there a reason not to use  here
p8435
aVI'll look at the spec; in the interim, you might think about promoting the operator to the ; with regular , the C# compiler provides "lifted" operators for those supported by the type, but you can't do that yourself
p8436
aVThe best you can do is offer all the obvious ones and hope the type supports it ;-p To access operators with generics, see here, available for free download here
p8437
aVNote you'd probably want to apply the appropriate "lifted" checks - i
p8438
ag50
aVUpdate
p8439
aVThe different handling looks to relate to 14
p8440
aV7
p8441
aV4 (ECMA 334 v4) "Addition operator", where it is pre-defined for a range of types including decimal (so that was a bad test by me), since by 14
p8442
ag5115
aV4 (same) "Binary operator overload resolution", the pre-defined operators do get special mention
p8443
aVI don't claim to understand it fully, though
p8444
as(dp8445
g18
V23354
p8446
stp8447
a((dp8448
g2
(lp8449
VHow about:
p8450
aVWorks fine for  and most other types
p8451
as(dp8452
g18
V23354
p8453
stp8454
a((dp8455
g2
(lp8456
VWell, delegates and closures allow it to operate in a largely functional way
p8457
aVfor example:
p8458
aVetc
p8459
aVYou can write most higher-order functions using lambdas / delegates
p8460
aVThe type inference isn't quite the same as pure functional languages such as F#, but C# generic-type-inference is still pretty good (especially in C# 3
p8461
aV0)
p8462
aVThis is especially true in
p8463
aVNET 3
p8464
aV5 and C# 3
p8465
aV0, where LINQ takes a highly-functional approach to many of the problems
p8466
aVBut you can still use the functional aspects of C# with
p8467
aVNET 2
p8468
aV0 and C# 2
p8469
ag190
aVIt is just easier with C# 3
p8470
aV0 and lambdas ;-p
p8471
aVActually, C# is a pragmatic programming language
p8472
aVIt aims to make it possible to use a number of paradigms, without punishing you hideously if you want to do something different
p8473
as(dp8474
g18
V23354
p8475
stp8476
a((dp8477
g2
(lp8478
VEntity Framework tends to fight you even harder when it comes to disconnecting data
p8479
aVYou should be able to use LINQ-to-SQL with attach/detach fairly easily
p8480
aVOf course, you don't always need to set a reference to associate data; you also have the option of setting the related id - i
p8481
ag50
aVyou commonly have a pair of properties:
p8482
aVSomethingId (the foreign key identity value)
p8483
aVSomething (the reference)
p8484
aVYou might be able to just set the Id without touching the reference
p8485
as(dp8486
g18
V23354
p8487
stp8488
a((dp8489
g2
(lp8490
VThe biggest difference between  and xml serialization is portability; BinaryFormatter is hard to guarantee between versions, so is only really suitable for shortterm storage or transfer
p8491
aVHowever, you can get the best of both, and have it smaller and have it quicker, by using bespoke binary serialization - and you don't even have to do it yourself ;-p
p8492
aVprotobuf-net is a
p8493
aVNET implementation of Google's protocol buffers binary serialization spec; it is smaller than either  or , fully portable (not just between versions - you can load a pb stream in, for example, java, etc), extensible, and fast
p8494
aVIt is also pretty comprehensively tested, with a fair number of users
p8495
aVA full breakdown of size and speed, covering , ,  and protobuf-net is here
p8496
as(dp8497
g18
V23354
p8498
stp8499
a((dp8500
g2
(lp8501
VWell, it doesn't necessarily apply in your case (since it, like , wants concrete types), but protobuf-net is a binary serialization engine that works on all
p8502
aVNET variants, including CF 2
p8503
aV0 and CF 3
p8504
aV5; this would allow you to store data, and to exchange it with your full-fat 3
p8505
aV5 server (or, indeed, with java, perl, php, etc)
p8506
aVIt is certainly quick and easy, so would definitely be worth a look-in if you want portable data in WM
p8507
as(dp8508
g18
V23354
p8509
stp8510
a((dp8511
g2
(lp8512
VIt depends on how you define your layers; for example, my "business logic" is usually logic related to the problem I am trying to solve, and knows nothing of the UI
p8513
aVSo it can't do a redirect, as it has no access to the request/response
p8514
aVPersonally, I'd do this at the UI layer; dealing with the raw interactions such as being gate-keeper and custodian is part of the UI layer's job for a web app
p8515
aVIMO
p8516
aVFor example, via an http-module, which is (by definition) a UI-level component
p8517
as(dp8518
g18
V23354
p8519
stp8520
a((dp8521
g2
(lp8522
VThe
p8523
aVNET framework supports them, but as Vilx mantions, the designers simply do not - and any of the xml/markup-based platforms (xaml (wpf) or ASP
p8524
aVNET) will not like generics at all
p8525
aVSo the best advice is: don't use them
p8526
aVA common compromise is to have a  property (or an  template-property upon which you call ), and simply cast etc inside the control
p8527
aVLikewise, such usage will commonly make use of things like , and  (for metadata lookup etc)
p8528
as(dp8529
g18
V23354
p8530
stp8531
a((dp8532
g2
(lp8533
VThe only / delegate that is similar to  is
p8534
aVIt won't be directly usable; however, you can wrap delegates inside eachother:
p8535
aVTo return a result, one option is to update external state
p8536
aVLambdas / anon-methods are good for this, since they offer closure support:
p8537
aVAfter execution,  (from the above context) will be updated
p8538
aVHowever, a callback is more common:
p8539
aVWhere the callback function does something useful with the result
p8540
aVHopefully that also shows how you can execute arbitrary functions in a thread-pool thread
p8541
aVRe synchronization; you are on a secondary thread, so you definitely would need synchronization if talking to any shared state
p8542
aVHowever, you might choose to use the UI to synchronize the result (if suitable) - i
p8543
ag50
aV(from a winform):
p8544
as(dp8545
g18
V23354
p8546
stp8547
a((dp8548
g2
(lp8549
VIn addition to jalf's excellent and comprehensive answer, keep in mind that "Parallel Extensions" (which should be rolled into
p8550
aVNET 4
p8551
aV0) has a lot of code dedicated to allocating work (from queues) to cores evenly, including work stealing, and potentially nuggets like caring which core is "closest" to the memory in which the work resides
p8552
aVSo with
p8553
aVNET 4
p8554
aV0, using things like  etc, you should get a lot of this for free
p8555
aVAnd in general, the OS is clever enough that it just works from the outsider's view
p8556
aVjalf has given a lot of details about what happens under the hood, but most of the time you don't need this level of detail, unless you are ironing out some performance issues with highly threaded code
p8557
as(dp8558
g18
V23354
p8559
stp8560
a((dp8561
g2
(lp8562
VNo, not all
p8563
aVNET classes are thread safe
p8564
aVIn fact, very few have a need to be
p8565
aVIn general, static members should be thread-safe, but that is about it
p8566
aVImmutable / semi-immutable objects are automatically thread safe (this includes things like XslTransform etc) - and there are a mutable few cases (such as threaded containers) where you can expect things to be thread safe
p8567
aVMSDN states thread-safety for each class
p8568
aVI would have no expectation for a cookie-container to be thread-safe, so you will probably have to synchronize this yourself
p8569
aV(updated)
p8570
aVRe your second point; exactly which variables are you thinking of
p8571
aVYour own local state variables won't be directly updated during the async request, so it simply falls to you to synchronize access when preparing requests are when processing responses
p8572
aVMost commonly, via a  - i
p8573
ag50
aVand then in the callback
p8574
aVWhere  is just a lock object (perhaps held against an instance):
p8575
as(dp8576
g18
V23354
p8577
stp8578
a((dp8579
g2
(lp8580
VThe memory of a string vs a stream is fairly inconsequential
p8581
aVStrings are utf-16, so there may be a small multiple involved, but because of the volumes involved, you would probably be best off writing the data to a scratch file
p8582
aVTo read the data out of the database, use streaming techniques; i
p8583
ag50
aVuse IDataReader (ExecuteReader), with it in sequential-mode, and read chunks of bytes/characters
p8584
aVDon't attempt to read the entire column
p8585
aVAlso, with SQL Server 2008 you miht want to look at the file-stream type
p8586
aVExamples:
p8587
aVreading large blob/clob
p8588
aVwriting large blob/clob
p8589
as(dp8590
g18
V23354
p8591
stp8592
a((dp8593
g2
(lp8594
VI would simply build against the dll+pdb
p8595
aVThe pdb is enough to step into code, without ever being able to edit it
p8596
aVYou can enable pdb (debug symbols) as an output in project properties
p8597
aVFor loading pdb files, Shawn Burke's walkthrough here (for the
p8598
aVNET framework itself, but the same concept applies, just from a different location) should get you started
p8599
as(dp8600
g18
V23354
p8601
stp8602
a((dp8603
g2
(lp8604
VFxCop and StyleCop will advise on usage
p8605
aVFor actual bugs, perhaps PEX
p8606
aVThere was a PDC video, too
p8607
as(dp8608
g18
V23354
p8609
stp8610
a((dp8611
g2
(lp8612
VI don't know if it works in MySQL, but in SQL Server you can use a trick for this:
p8613
aVThen in the main select
p8614
aVThe result of  line is that  becomes the comma-separated list of all matching records from the source table (after predicate)
p8615
aVWorth trying in MySQL
p8616
as(dp8617
g18
V23354
p8618
stp8619
a((dp8620
g2
(lp8621
VInteresting issue
p8622
aVIf it is truly just time related (i
p8623
ag50
aVnot an exception), then I wonder if you can simply periodically recycle the timer - i
p8624
ag50
aVYou could probably merge chunks of this with the  /  etc to reduce duplication
p8625
as(dp8626
g18
V23354
p8627
stp8628
a((dp8629
g2
(lp8630
VFirst, define subtract ;-p What do you want the answer to look like
p8631
aVThe most performance way to do this is probably  - it should be much quicker than lots of  calls, but you'll need to decode the bytes yourself
p8632
aVEasy if it is just something like 32bpp ARGB, but tricky for some more complex cases
p8633
as(dp8634
g18
V23354
p8635
stp8636
a((dp8637
g2
(lp8638
VIf you mean the indexer of a , then you should see an exception ()
p8639
aVIf you don't want it to error:
p8640
as(dp8641
g18
V23354
p8642
stp8643
a((dp8644
g2
(lp8645
VIndeed, LINQ will work fine
p8646
aVOf course, if you know you can optimise the situation in a given case, you can always write your own LINQ extension method for the more-specific type
p8647
aVSince the type is more sepcific, your own method should be used in preference to the default  one
p8648
aVWhich is nice ;-p
p8649
as(dp8650
g18
V23354
p8651
stp8652
a((dp8653
g2
(lp8654
V is a very commonly seen container, because it is so very versatile (with lots of handy methods like , , etc) - but has no extension points if you want to override any of the behaviour (check items on insert, for example)
p8655
aVis a wrapper around any  (defaulting to ) - it has the extension points ( methods), but not as many support methods like
p8656
aVBecause of the indirection, it is slightly slower than , but not by much
p8657
aVWith LINQ, the extra methods in  become less important, since LINQ-to-Objects tends to provide them anyway
p8658
aVfor example , , etc
p8659
as(dp8660
g18
V23354
p8661
stp8662
a((dp8663
g2
(lp8664
VActually, strictly speaking, all you need to use  is a public  method that returns something with a  method and a  property
p8665
aVHowever, the most common meaning of this is "something that implements /, returning an /
p8666
aVBy implication, this includes anything that implements /, such as anything like , , arrays (), etc
p8667
aVSo any standard "collection of data" will generally support
p8668
aVFor proof of the first point, the following works just fine:
p8669
aVHow does it work
p8670
aVA foreach loop like  kinda equates to:
p8671
aVHowever, there are variations
p8672
aVFor example, it the enumerator (tmp) supports , it is used too (similar to )
p8673
aVNote the difference in the placement of the declaration "" inside (C# 5
p8674
aV0) vs
p8675
aVoutside (up C# 4
p8676
aV0) the loop
p8677
aVIt's important if you use  in an anonymous method/lambda inside your code-block
p8678
aVBut that is another story ;-p
p8679
as(dp8680
g18
V23354
p8681
stp8682
a((dp8683
g2
(lp8684
Vjust to say
p8685
aVI'm not sure that hosting a WCF client inside SQL-Server is a particularly desirable option
p8686
aVThere are some uses of SQL/CLR, for example if you (for whatever reason) want to use bespoke
p8687
aVNET types in the database, or (more likely) you want some very tightly scoped utility methods such as Split, Regex, etc
p8688
aVHowever, I wouldn't run my main app-logic (such as WCF clients) inside the SQL runtime
p8689
aVThe closest I might get is to have a queue table in the database, and have a windows service dequeue work, process it, and mark it completed (or delete it)
p8690
aVThis allows you to scale out such work without overloading the database
p8691
aVI'm sure it might work
p8692
aVI just wouldn't do it myself
p8693
as(dp8694
g18
V23354
p8695
stp8696
a((dp8697
g2
(lp8698
VNothing is guaranteed if the process is killed prematurely, however, I use "" to do this
p8699
aVNow when the  is disposed or garbage-collected the file is deleted (if possible)
p8700
aVYou could obviously use this as tightly-scoped as you like, or in a collection somewhere
p8701
as(dp8702
g18
V23354
p8703
stp8704
a((dp8705
g2
(lp8706
VWell, is it correct
p8707
aVIs this already the working path for a SVN folder
p8708
aVAre there any hidden svn folders in that location
p8709
aVI use SharpSVN in a "get to scratch area, work locally, throw away" cycle, so I always start with a clean (empty) folder (with no SVN folders in the ancestors)
p8710
aVThis has always worked fairly well
p8711
as(dp8712
g18
V23354
p8713
stp8714
a((dp8715
g2
(lp8716
VYou would have to use the  overload (which does limit the length) and do your own end-of-line detection; shouldn't be too tricky
p8717
aVFor a slightly lazy version (that uses the single-characted reading version):
p8718
as(dp8719
g18
V23354
p8720
stp8721
a((dp8722
g2
(lp8723
VIt looks like it is using VB to do bitwise AND in this case, so perhaps:
p8724
aVHowever, this is a constant
p8725
aVAre you sure there isn't a variable in there somewhere
p8726
aV2 ^ 1 is 3; 1 & 3 is 1; so this would always be true
p8727
aV(at least, under C#, where ^ is XOR; I'm told that in VB ^ is POWER, so 2 ^ 1 is 2; 1 & 2 is 0; so this would always be false
p8728
as(dp8729
g18
V23354
p8730
stp8731
a((dp8732
g2
(lp8733
VWell, you never actually associate the new act with any gig - is that what is missing
p8734
aVor maybe:
p8735
aVor something with the ids
p8736
ag412
ag50
aVare you sure the act in the db is for the gig
p8737
as(dp8738
g18
V23354
p8739
stp8740
a((dp8741
g2
(lp8742
VI don't know about JSON
p8743
aVNET, but it works fine with  from  (
p8744
aVNET 3
p8745
aV5 SP1):
p8746
aVEdit:
p8747
aVJson
p8748
aVNET works using the same JSON and classes
p8749
aVLink: Serializing and Deserializing JSON with Json
p8750
aVNET
p8751
as(dp8752
g18
V23354
p8753
stp8754
a((dp8755
g2
(lp8756
VAt the simplest level, they have different compilation switches - i
p8757
ag50
aVetc is only toggled if you have the  compilation symbol (not common for release builds), where-as  will usually be included even in release builds
p8758
aVThe  route has customizable trace-listeners, that can be plumbed in via configuration;  generally goes to a debugger as the listener
p8759
aVOf course, there are 3rd-party trace systems that offer much more flexibility
p8760
as(dp8761
g18
V23354
p8762
stp8763
a((dp8764
g2
(lp8765
VWell, there is no need to initialize a field to  - it will be that automatically
p8766
aVAnd there isn't a huge benefit in  over just , which I find more readable (since the compiler automatically uses interned strings for any literals in the source code)
p8767
aVSo personally, I would either use:
p8768
aVor just:
p8769
aVI make a habit of using  for most tests, which removes much of the difference between the two
p8770
as(dp8771
g18
V23354
p8772
stp8773
a((dp8774
g2
(lp8775
VIf any of the page is being compiled by ASP
p8776
aVNET (i
p8777
ag50
aVyou aren't pre-compiling the WAP), then you'll need to ensure that ASP
p8778
aVNET knows about the C# 3
p8779
aV0 (
p8780
aVNET 3
p8781
aV5) compiler
p8782
aVEnsure the following is in the :
p8783
aVAlso, if you are hosting in IIS, ensure that the correct folder is set as an application, and that it is using ASP
p8784
aVNET v2
p8785
aVblah (not v1
p8786
ag733
aVblah)
p8787
as(dp8788
g18
V23354
p8789
stp8790
a((dp8791
g2
(lp8792
VThe good thing about "express" (or even just "csc") is that even if it doesn't have a designer to help with some things (like setting up the connection string to most useful databases), the core framework is not limited
p8793
aVSo you'll probably have to put in the connection string yourself and add a reference to the MySQL/
p8794
aVNET provider, but it should work at runtime, even in debug
p8795
aVWhich is very nice ;-p
p8796
as(dp8797
g18
V23354
p8798
stp8799
a((dp8800
g2
(lp8801
VAt some point, you need that thing called lawyers
p8802
aVOr alternatively, using web-services etc simply don't deply your important code into the public domain
p8803
aVUltimately, anything that gets to the client can be opened regardless of the technology and/or protection (obfuscation etc)
p8804
aVDon't forget, you own the IP regardless of whether people try to open it
p8805
as(dp8806
g18
V23354
p8807
stp8808
a((dp8809
g2
(lp8810
VAs Jon notes, I use them to provide generic operators with
p8811
aVNET 3
p8812
ag691
aVI also use them (again in MiscUtil) to provide fast access to non-default constructors (you can't use  with constructors, but  works fine)
p8813
aVOther uses of manually created expression trees:
p8814
aVobject cloning
p8815
aVdynamic LINQ sorting
p8816
aVas a compiler
p8817
aVBut really, Expression is a very versatile way of writing any dynamic code
p8818
aVMuch simpler than , and for my money, simpler to understand than CodeDOM
p8819
aVAnd in
p8820
aVNET 4
p8821
aV0, you have even more options available
p8822
aVI show the fundamentals of writing code via  on my blog
p8823
as(dp8824
g18
V23354
p8825
stp8826
a((dp8827
g2
(lp8828
VI would simply use  at the start of the loop to find the column indexes first (and store in a variable)
p8829
aVThen just check whether it is
p8830
aVThis has the advantage of improving performance too (as long as you then use this integer for all access, not the name)
p8831
aVAnd no, there is no elegant way of ignoring a particular exception
p8832
aVYou could catch and swallow, but that is not a good approach
p8833
as(dp8834
g18
V23354
p8835
stp8836
a((dp8837
g2
(lp8838
VIn addition to the other answers, extension methods are a great way of adding boiler-plate implementation to interfaces
p8839
aVFor example, if you want all lists tto be sortable, add an extension method for
p8840
aVYou can (as already stated) also use extension methods to add methods to classes outside of your control; ever wanted a  method on
p8841
aVAdd one
p8842
aVThe only difference is that extension methods don't use virtual, and there is no null-check
p8843
aVYou can use this to your advantage if you like:
p8844
aVUnlike regular utility methods, they make it very easy to write fluent interfaces; this is one of the reasons for their existance - i
p8845
ag50
aVwith LINQ:
p8846
aVis a lot more readable than:
p8847
aVWith regular methods, to use the first approach it would have to be regular instance methods, which would require changes (for example) to  - not desirable
p8848
as(dp8849
g18
V23354
p8850
stp8851
a((dp8852
g2
(lp8853
VFrom Jon's FAQ:
p8854
aVHaving said the above, there are
p8855
aVproducts which build everything you
p8856
aVneed from the framework for your
p8857
aVapplication, along with your
p8858
aVapplication itself, into one big
p8859
aVbundle:
p8860
aVRemoteSoft's linker and mini-deployment tool
p8861
aVThinstall Studio
p8862
aVXenocode
p8863
as(dp8864
g18
V23354
p8865
stp8866
a((dp8867
g2
(lp8868
VIt seems like you need a lot of data out
p8869
aVThe last option should be fine, and is extensible; it you wanted (to simplify the  usage), you could encapsulate things a bit more, but the fact that C# doesn't directly support named indexed properties means you'd need a few classes, unless you just wrap with methods like:
p8870
aVI'm not quite clear what the  is, so I can't say whether this is sensible (so I've just left it alone)
p8871
aVAlso - with the first option, you probably wouldn't need  - it would be sufficient to use
p8872
as(dp8873
g18
V23354
p8874
stp8875
a((dp8876
g2
(lp8877
VThis is easiest in 3
p8878
aV5 via RemoteEndpointMessageProperty; see here
p8879
as(dp8880
g18
V23354
p8881
stp8882
a((dp8883
g2
(lp8884
VWell, it might be POX - but for true REST, the URIs themselves would be representative of the data being requested, such as /Orders/12345; is this the case
p8885
aVAlso - the data coming back would be data-centric, rather than operation-centric (which tends to be the norm for SOAP-based services)
p8886
ag412
ag50
aVresults would generally be directly related to data
p8887
aVNote that you can create REST services in
p8888
aVNET with ADO
p8889
aVNET Data Services (aka Astoria)
p8890
aVThis is part of 3
p8891
aV5 SP1, and uses WCF under the bonnet
p8892
aVBy default, full REST is available for Entity Framework, or query-only on any  API
p8893
aVBut you can also enable full REST on LINQ-to-SQL (or anything else for that matter) by implementing
p8894
aVI cover this in a series starting here
p8895
as(dp8896
g18
V23354
p8897
stp8898
a((dp8899
g2
(lp8900
VC# 3
p8901
aV0 is (to me) the biggest bonus:
p8902
aVlambdas statements / expressions
p8903
aVanonymous types
p8904
aVpartial methods
p8905
aVauto-implemented properties
p8906
aVimproved generic type inference
p8907
aVextension methods
p8908
aVexpression trees (when using
p8909
aVNET 3
p8910
aV5)
p8911
aVLINQ
p8912
aVetc
p8913
aVNote that this is different to
p8914
aVNET 3
p8915
aV5; C# 3
p8916
aV0 can be used even when targetting
p8917
aVNET 2
p8918
aV0, especially when using something like LINQBridge to provide the LINQ extension methods
p8919
aVThere are also improvements for ASP
p8920
aVNET debugging and WCF hosting etc
p8921
as(dp8922
g18
V23354
p8923
stp8924
a((dp8925
g2
(lp8926
VThere is a gotcha with , that is particularly apparent when using  and generics to watch for:
p8927
aVBasically,  is unusual in that it isn't , so it always gets cast (boxed) to
p8928
aVThe unusual boxing rules mean that this calls  on , which isn't possible
p8929
aVSo void calling  if you think you might have empty  objects
p8930
aVAlso - note that some data-binding methods don't like  very much
p8931
as(dp8932
g18
V23354
p8933
stp8934
a((dp8935
g2
(lp8936
VNote that unhandled exceptions are still pretty fatal; you can only really use this for logging, or maybe some hasty close-down
p8937
aVNeither this nor  can be used as a global sink for errors
p8938
aVThe better approach is to add proper handling - for example, around your entire  logic
p8939
aVNote that even this can't catch a few exceptions, such as errors during form-load (which get particularly nasty - you can catch them with a debugger attached, but not without)
p8940
as(dp8941
g18
V23354
p8942
stp8943
a((dp8944
g2
(lp8945
VSince you need (/) to return an , do you mean
p8946
aVUpdated: for counting leaves and nodes, how about (as instance methods of ):
p8947
aVIf I've missed the point, let me know
p8948
as(dp8949
g18
V23354
p8950
stp8951
a((dp8952
g2
(lp8953
VIf you are using int/string/etc, then  has some more complex jump options that might make  more efficient if you have lots of conditions
p8954
aVHowever, the difference isn't likely to be huge, and  isn't an option for all types (only integer-based, and string)
p8955
as(dp8956
g18
V23354
p8957
stp8958
a((dp8959
g2
(lp8960
VAs an iterator block:
p8961
aVThis is now fully lazy, and using LINQ's / etc allows you to control the start/end easily
p8962
aVFor example, for your "between" query:
p8963
as(dp8964
g18
V23354
p8965
stp8966
a((dp8967
g2
(lp8968
VIf you want , then just
p8969
as(dp8970
g18
V23354
p8971
stp8972
a((dp8973
g2
(lp8974
VDoes any code bypass the property, setting the field () directly
p8975
as(dp8976
g18
V23354
p8977
stp8978
a((dp8979
g2
(lp8980
VSince you mention  (tags), I assume you mean winforms
p8981
aVAccessing sub-properties is a pain; the currency-manager is bound to the list, so you only have access to immediate properties by default; however, you can get past this if you absolutely need by using a custom type descriptor
p8982
aVYou would need to use a different token too, like "Foo_Bar" instead of "Foo
p8983
aVBar"
p8984
aVHowever, this is a major amount of work that requires knowledge of ,  and probably , and almost certainly isn't worth it,
p8985
aVThe simplest fix is to expose the property as a shim / pass-thru:
p8986
aVThen bind to "Value2Description" etc
p8987
as(dp8988
g18
V23354
p8989
stp8990
a((dp8991
g2
(lp8992
VI use reflector during development to examine how the compiler turns C# into IL, as I do a lot of work with things like Reflection
p8993
aVEmit and Expression
p8994
aVI also use it to quickly look at my code; when you have a large dll library, I find it quicker to simply drag the dll+xml from the build server into reflector than it is to load each project into VS, especially if I'm not 100% sure where a bit of code is
p8995
aVYou can also use with with plugins like snippy as a test rig for snippets of code
p8996
as(dp8997
g18
V23354
p8998
stp8999
a((dp9000
g2
(lp9001
VIf you want the SQL repository to be able to use the existing xml layer, then I'm sure some kind of interface-based abstraction (provider / IoC / DI / etc) is possible, so that the SQL repository can consume the xml stack without having to know about it explicitly
p9002
aVOf course, if the object model itself defined the xml structure (via the attributes for  etc), then this is simpler, and the xml repo becomes fairly trivial
p9003
aVAs for knowing the structure inside the db: it depends whether you need to query the data inside the database
p9004
aVIf so, there is a lot you can do in SQL Server - for example, you can bind the xml column to an xsd, or you can promote portions of the xml (via udf/xquery) to persisted, indexed columns
p9005
aVHowever, if you are just using the database for storage, then this isn't necessary - and indeed, using xsd in the database is a major PITA if you need to change the xsd at a later date (it isn't trivial)
p9006
as(dp9007
g18
V23354
p9008
stp9009
a((dp9010
g2
(lp9011
VThere aren't any built in, but you can supply your own
p9012
aVFor this specific scenario, you might want to encapsulate the logic in (for example) a wrapper (lock) class, so that you don't have  scattered through all the code; of course, if you are only doing a little locking it might not be worth the trouble
p9013
aVI use different configurations and/or projects to build for a variety of platforms - i
p9014
ag50
aVprotobuf-net builds for
p9015
aVNET 2
p9016
aV0,
p9017
aVNET 3
p9018
aV0, mono, CF 2
p9019
aV0, CF 3
p9020
aV5 using this trick
p9021
aVThe code has  blocks based on different symbols to control logic - so, for example,  isn't available on CF,  is only available with
p9022
aVNET 3
p9023
aV0,  isn't on CF 2
p9024
aV0, etc
p9025
as(dp9026
g18
V23354
p9027
stp9028
a((dp9029
g2
(lp9030
VNo spec yet, but the CTP is available for playing with - but note that this doesn't yet include all the features discussed in the the (preliminary) documentation - in particular, many of the  features (in particular operator support) are missing (meaning: the C# language / compiler features that work with ; for all I know the runtime supports them but the language doesn't yet)
p9031
aVIt will also be interesting to see how many of the new  methods are supported by the language when compiling a lambda
p9032
as(dp9033
g18
V23354
p9034
stp9035
a((dp9036
g2
(lp9037
VWell, the "test" stuff is now available in "pro" (but not profiling) so that removes one major comparator
p9038
aVIn many ways, the MSDN subscription is a bigger factor than the VS product suite, assuming you don't need the full bredth of tools
p9039
aVThe VS feature list here; the MSDN feature list is here
p9040
aVI used to use pro, and I never felt I missed much
p9041
aVOf course, you could always get pro plus something like dotTrace for profiling, ReSharper for code analysis/refactoring, and maybe TestDriven
p9042
aVNET for testing - you'd probably still have change left over
p9043
aVI now have a team suite license (which is very nice), but if I had to pay for it I'd have to think very carefully; I'd probably get developer edition + MSDN
p9044
as(dp9045
g18
V23354
p9046
stp9047
a((dp9048
g2
(lp9049
V(updated)
p9050
aVWith your newly posted rig, I get the numbers below, which are in line with what I would expect:
p9051
aV(original)
p9052
aVI cannot reproduce your numbers in release at the console
p9053
aVI did 25M iterations, with results:
p9054
aV1556ms, (825000000) (testIndexOf)
p9055
aV1798ms, (825000000) (testManualIndexOf)
p9056
aVSo  is quicker
p9057
aVI suspect your test rig is not being run in release mode at the command line (you can't run performance tests with the debugger attached; even the IDE adds too much overhead)
p9058
aVHere is my rig:
p9059
as(dp9060
g18
V23354
p9061
stp9062
a((dp9063
g2
(lp9064
VArray
p9065
aVIndexOf:
p9066
aVOr just use LINQ:
p9067
aVLINQ should be "fast enough" for most purposes
p9068
as(dp9069
g18
V23354
p9070
stp9071
a((dp9072
g2
(lp9073
Vfold =
p9074
aVTell use what  and  do, and we might fill in the blanks
p9075
aVI'm guessing iter= and partition might involve /
p9076
aV(update) I looked up Partition - here's a crude implementation that does some of it:
p9077
as(dp9078
g18
V23354
p9079
stp9080
a((dp9081
g2
(lp9082
VRe  - this serves a few uses; it provides a single exception that (for example) your unit tests can lock onto for incomplete work
p9083
aVBut also, it really does do what is says: this simply isn't there (yet)
p9084
aVFor example, "mono" throws this all over the place for methods that exist in the MS libs, but haven't been written yet
p9085
aVRe  - not everything is available
p9086
aVFor example, many interfaces support a pair "can you do this
p9087
aV/ "do this"
p9088
aVIf the "can you do this
p9089
aVreturns false, it is perfectly reasonable for the "do this" to throw
p9090
aVExamples might be  /  etc
p9091
as(dp9092
g18
V23354
p9093
stp9094
a((dp9095
g2
(lp9096
VWell, you can use consts in attributes, since they exist as compile time
p9097
aVYou can't predict the value of a static readonly variable, since the  could initialize it from configuration etc
p9098
aVIn terms of usage, constants are burnt into the calling code
p9099
aVThis means that if you recompile a library dll  to change a public constant, but don't change the consumers, then he consumers will still use the original value
p9100
aVWith a readonly variable this won't happen
p9101
aVThe flip of this is that constants are (very, very slightly) quicker, since it simply loads the value (rather than having to de-reference it)
p9102
aVRe interning; although you can do this manually, this is most commonly a compiler/runtime feature of literals; if you init a readonly field via a literal:
p9103
aVthen the  will be interned
p9104
aVIf you read it from config, it won't be
p9105
aVBecause a constant string must be a literal, it will also be interned, but it is accessed differently: again, reading from the field is a de-reference, rather than a
p9106
as(dp9107
g18
V23354
p9108
stp9109
a((dp9110
g2
(lp9111
VNo, it isn't leaking memory - it is just making the garbage collector work harder than it might
p9112
aVActually, the MSDN article is slightly misleading: if the property created a new collection every time it was called, it would be just as bad (memory wise) as with an array
p9113
aVPerhaps worse, due to the usual over-sizing of most collection implementations
p9114
aVIf you know a method/property does work, you can always minimise the number of calls:
p9115
aVor even easier, use :
p9116
aVBoth approaches only call the property once
p9117
aVThe second is clearer IMO
p9118
aVOther thoughts; name it a method
p9119
ag412
ag50
aV- this sets expectation that it does work, and avoids the undesirable  (which would be the case for arrays)
p9120
aVFinally, Eric Lippert has a good article on this subject
p9121
as(dp9122
g18
V23354
p9123
stp9124
a((dp9125
g2
(lp9126
VYes, any calls required for arguments are removed too
p9127
aVThis means that for the typical use-case (debug builds) you remove the entire expression, which is usually what is intended
p9128
aVBasically, you need to be very careful when using either  methods, or equally (in C# 3
p9129
aV0) partial methods - which have very similar behaviour if the other half of the partial method isn't implemented
p9130
aVAs an example (for partial methods), see below
p9131
aVNote that the call to  is removed (uncomment the other half of  to see it work):
p9132
as(dp9133
g18
V23354
p9134
stp9135
a((dp9136
g2
(lp9137
VThe LINQ-to-SQL code-generator supports this directly
p9138
aVThe base-class for the data-context can be set in the designer, as the  property
p9139
aVAlternatively, edit the dbml directly: right click, "Edit With
p9140
aV, "XML Editor"
p9141
aVTo change the base class for the entities, set the type:
p9142
aVTo change the base class for the data-context, set the type:
p9143
aVIn both cases, use the fully-qualified type in the attribute
p9144
aVEt voila
p9145
aVNote that because it is very literal, you can also use this approach to make your entities implement an interface - for example, when my classes have properties like  and , I might have an  interface that defines these
p9146
aVThen I can put code in my data-context's  (override) that calls  and sets these values for all the  entities being updated; very sweet
p9147
as(dp9148
g18
V23354
p9149
stp9150
a((dp9151
g2
(lp9152
VI don't know much about this, but browsing at MSDN it states that post zero usage returns a , and a  has a  method; does that include the port number
p9153
aV(you might need to parse, via )
p9154
aVAgain, complete guess-work
p9155
aVIf not, just say ;-p
p9156
aVedit by AakashM to add This is the correct approach
p9157
aVFollowing
p9158
aVthe dynamically-allocated post of the contained server channel can be retrieved with
p9159
aVThe ugly cast is necessary because the  property is typed as
p9160
as(dp9161
g18
V23354
p9162
stp9163
a((dp9164
g2
(lp9165
VWell, that sounds just like encapsulation (the wrapper class) and abstraction (the interface)
p9166
aVHowever, once you have the interface, you could then use the decorator pattern
p9167
aVStrictly, in decorator usage each layer has the same interface; the decoration is essentially a daisy-chain of different concrete classes that (when implementing the interface) either pass the method to the next link in the chain, or do something bespoke
p9168
aV(update: I'm not saying you should do it this way - this is just an example of how the decorator pattern might work, in the context of the original e-mail question)
p9169
aVFor example, you might have an interface , a basic implementation  (that uses the built-in
p9170
aVNET code), a  that accepts an , and just passes things along (but logs things as you go), and a  that accepts an  and changes the  etc (perhaps for dev/test/live purposes)
p9171
aVThen you could have:
p9172
aV(where the first three are only known as )
p9173
aVThis allows you to extend functionality without changing the API
p9174
aVVery common in factory / IoC setups, and even more so with AOP
p9175
as(dp9176
g18
V23354
p9177
stp9178
a((dp9179
g2
(lp9180
VWell, most ORM tools can emit standard POCO
p9181
aVNET classes, and most standard POCO classes lend themselves to serialization quite well
p9182
aVFor example, LINQ-to-SQL has support for  (not ) by setting  to
p9183
aVEntity Framework does the same (I don't think you need to change any settings for EF, though)
p9184
aVFor "simpler" - well, what is the complexity
p9185
aVSetting up an Entity Framework (or LINQ-to-SQL) model isn't usually very tricky
p9186
aVAnything specific being problematic
p9187
aVNote that xml serializers, by default, are tree serializers, not graph serializers
p9188
aVcan support proper graphs, but you need to enable it (it isn't enabled by default in xml mode, since it produces very odd-looking xml)
p9189
aVYou mention WCF; that is a communications technology; you don't mention comms in the question, so it isn't clear what you mean here
p9190
aVNote that "ADO
p9191
aVNET Data Services" is another option here, if you want REST-based data-access, but most ORMs should work OK with WCF
p9192
aVThere are alternatives, of course
p9193
as(dp9194
g18
V23354
p9195
stp9196
a((dp9197
g2
(lp9198
VOne other thought here is mutation; an array () is fully mutable, and cannot be protected
p9199
aVdoesn't provide any useful extension points, but things like  (or many other  implementations) allow you to add code, for example, to check items before they are added; likewise, you can have readonly  implementations, which is useful for thread safety where immutability is desirable
p9200
aVI tend to use arrays either in internal method logic (perhaps as a local variable), as  arguments, or in a few highly optimised cases where I know the length of the items, and I know the code chooses not to mutate it (as a private field)
p9201
aVOther than that,  etc tend to be more common, as they have much less overhead when adding/removing items
p9202
as(dp9203
g18
V23354
p9204
stp9205
a((dp9206
g2
(lp9207
VThe problem with that approach is that much of the time the entity is going to come from the LINQ-to-SQL back-end, and so isn't going to use your constructor (LINQ-to-SQL creates objects in its own way; you cannot force LINQ-to-SQL to use your constructor) - so this would only be useful for the (few) objects you create yourself
p9208
aVData-binding (etc) will also commonly use the parameterless constructor by default
p9209
aVI wonder if this wouldn't work better as a utility method that accepts the service, or obtains the service itself via a factory / singleton
p9210
as(dp9211
g18
V23354
p9212
stp9213
a((dp9214
g2
(lp9215
VSince  is the set/object that might be null, can you check
p9216
aV( /  might be interchangeable (a typo in the question); the original question talks about  but only defines )
p9217
ag412
ag50
aVor if you want the default to be  (not ):
p9218
aVUpdate; in response to the downvote, I've investigated more
p9219
aVthe fact is, this is the right approach
p9220
aVHere's an example on Northwind:
p9221
aVAnd here's the TSQL - pretty much what we want (it isn't , but it is close enough):
p9222
aVQED
p9223
as(dp9224
g18
V23354
p9225
stp9226
a((dp9227
g2
(lp9228
VIn general all they do is add clutter
p9229
aVHowever, they can in some specific circumstances cause problems with duplicate names in scope, or duplicate extension methods
p9230
aVFor example, if there are classes  and , and you have  and , then references to  will need disambiguating
p9231
aVThe extension methods work similarly where static classes in different namespaces contribute conflicting extension methods
p9232
aVThe VS2008 tools (including express) include options to remove unnecessary  statements, which is very useful for tidying the code
p9233
as(dp9234
g18
V23354
p9235
stp9236
a((dp9237
g2
(lp9238
VThe current status of this question is a bit unclear; it was possibly a duplicate (noted in a deleted reply), but the comments suggest that this isn't quite suitable
p9239
aVRe serialization slowing things down - well, unfortunately, there is no properly supported "deep clone" functionality in
p9240
aVNET
p9241
aVThere is , but that is a: rarely used, and b: not stated as either shallow or deep
p9242
aVAs such, the only remaining reliable way to deep clone data is to use serialization
p9243
aVRe "slow as hell", can you quantify that
p9244
aVWhich serialization mechanism was that using
p9245
aV(
p9246
aVFor info, you might be interested in protobuf-net, which is a pretty fast and efficient alternative binary serializer (and which offers a very handy  method) - however, it only works with classes that are marked in specific ways (for example, it can use either  markers, or the bespoke  markers)
p9247
aVIt is quicker than the inbuilt serializers, though
p9248
aVThe only other viable option is to write you own, per-type, deep copy routine, and perhaps pass that in (as a  or  delegate) to your extension method
p9249
aVIf you only want a shallow copy, things are easier, as you can use reflection etc
p9250
aVHere's an option that creates a shallow copy using a compiled  (
p9251
aVNET 3
p9252
aV5) for improved performance
p9253
as(dp9254
g18
V23354
p9255
stp9256
a((dp9257
g2
(lp9258
VMSTest includes code coverage, at least it does in the version of VS I have
p9259
aVHowever, you need to enable the instrumentation in the testrunconfig, which is just ugly and a major PITA
p9260
aVA much easier option is to use TestDriven
p9261
aVNET, which can automate coverage, even for MSTest
p9262
aVAnd since it uses the MSTest core, you still get all the VS goodness such as colorization (red/blue lines for covered code)
p9263
aVSee here (including a screencast), or since an image says a thousand words:
p9264
as(dp9265
g18
V23354
p9266
stp9267
a((dp9268
g2
(lp9269
VCan you clarify the exact scenario
p9270
aVI'm very familiar with , and passably familiar with using it with DLR trees / 4
p9271
aV0, but I'm not 100% sure what you're trying to do
p9272
aVNote also that there are some limitations anyway with this type of usage (whether it is C# or raw trees)
p9273
as(dp9274
g18
V23354
p9275
stp9276
a((dp9277
g2
(lp9278
VHow about LINQ to Amazon ;-p
p9279
aV(see also how it works, and the source)
p9280
as(dp9281
g18
V23354
p9282
stp9283
a((dp9284
g2
(lp9285
VThe wrapper is a "box"; re garbage collection of boxes - there is no difference as far as the grabage collector is concerned
p9286
aVA box is collected with exactly the same rules and treatment as any other object
p9287
aVhowever, if a value-type overrides a method (such as ), it is not necessary to box it to call the method
p9288
aVHence, value-types should (as a matter of routine) override as many of the  methods as possible ;-p
p9289
aVYou can see the difference in the IL (via reflector) - so for the C#:
p9290
aVWe have the IL:
p9291
aVNote that  doesn't involve a box, but  does at  (since it isn't (can't be) overridden)
p9292
as(dp9293
g18
V23354
p9294
stp9295
a((dp9296
g2
(lp9297
VWell, depending on the complexity of the final uri, it might be that the "GET" requests are being cached
p9298
aV"POST" is not cached by default, but "GET" often is (as it should be idempotent)
p9299
aVHave you tried sniffing to see if there is any difference here
p9300
aVAlso - you might find  easier to use - something like:
p9301
as(dp9302
g18
V23354
p9303
stp9304
a((dp9305
g2
(lp9306
VWell, I like LINQ (update: excluded via comments) for querying, especially if I can do it without buffering the data (so I can process a huge file efficiently)
p9307
aVFor example below (update: removed LINQ); note the use of iterator blocks () makes this fully "lazy" - only one record is held in memory at a time
p9308
aVThis also shows separation of concerns: one method deals with reading a file line by line; one method deals with parsing a line into a typed data record; one (or more) method(s) work with those data record(s)
p9309
aVThe advantage of writing things as iterators is that you can easily use either streaming or buffering - for example, you can do:
p9310
aVand then manipulate  all day long (assuming it isn't too large) - useful for multiple aggregates, mutating data, etc
p9311
as(dp9312
g18
V23354
p9313
stp9314
a((dp9315
g2
(lp9316
VThe fusion log might help, but another option might be to hook the  event:
p9317
aVThere are two main causes of this error:
p9318
aVcoincidental naming - i
p9319
ag50
aVFoo
p9320
aVdll and Bar
p9321
aVdll both have a  type
p9322
aVdifferent versions (mainly GAC) referenced by different components - i
p9323
ag50
aVyour DAL loads v2 of some dll, and your UI/utility code loads v4 of the same dll
p9324
aVOf course, another option is that your s have infected each-other (it is very (too
p9325
aVeasy to accidentally suck a reference over an  boundary by exposing it on the API of the  object)
p9326
as(dp9327
g18
V23354
p9328
stp9329
a((dp9330
g2
(lp9331
VWell, how does your custom serializer choose the order
p9332
aVAnd do you control this serializer
p9333
aVOr is it 3rd party
p9334
aVThe "2, 3, 1, 4, 5" pattern you describe makes we wonder if your object isn't a "property bag", and it is simply serializing data in the order it was set - this would be highly risky
p9335
aVThe order in which you set properties shouldn't (normally) matter
p9336
aVProperties do not have a defined order, and you should not rely on this order between builds
p9337
aVThe system also makes no guarantee re the order of properties from reflection vs source code vs anything in fact
p9338
aVSo you need to define the order yourself somehow, perhaps alphabetically (but this is brittle when somebody adds an  property), perhaps via a custom attribute
p9339
aVI have a custom (binary) serializer, and I use the custom attribute approach, although I support alphabetical for some scenarios
p9340
aVFor example:
p9341
aVThen it doesn't matter in what order reflection orders the properties - the serializer always reads/writes data in the order ,
p9342
aV(And for the observant: yes, the above example looks a lot like WCF / data-contracts with the  property set, so I support that too ;-p)
p9343
as(dp9344
g18
V23354
p9345
stp9346
a((dp9347
g2
(lp9348
VC# doesn't have the concept of macros; however, you can use other tools in your build script (csproj / NANT / etc) to manipulate the source before it compiles
p9349
aVI use this, for example, to set the revision number to the current SVN revision
p9350
aVA cheap option is a pre-build event (you can do this via the project properties dialog in VS): essentially a bat file that runs before build; you can then script whatever changes you need
p9351
aVA more sophisticated option is build tasks
p9352
aVFor example, the utility library here includes a  task and a  task; it should (in theory) be possible to chain the two together to emulate what you need
p9353
aVPersonally, I'd use the  details rather than the time - if you link this to your source-control system, this makes it very easy to find the offending version; so for my SVN version, I then use (in my build proj):
p9354
aVAnd now my assembly-version is correct, including the file-version that gets reported by the OS
p9355
as(dp9356
g18
V23354
p9357
stp9358
a((dp9359
g2
(lp9360
VTo target specific members, I believe you just match the signature:
p9361
aVTo be honest, I'm not sure how to generate an "all overloads" link; I'd assume that any sensible generator did this automatically
p9362
as(dp9363
g18
V23354
p9364
stp9365
a((dp9366
g2
(lp9367
VNote that you can't actually destroy an object; you are subject to the rules of garbage collection
p9368
aVAt a push, you could check for  and call Dispose(),
p9369
aVYou can use the  samples provided, but I'm not sure there is much point; it is simpler just to clear the field with "obj = null;"
p9370
aVThe  usage could get confusing, since that works on the variable - i
p9371
ag50
aVif you do:
p9372
aVthen  will still be the original value
p9373
aVUnless you have a good reason, I don't recommend the  approach
p9374
as(dp9375
g18
V23354
p9376
stp9377
a((dp9378
g2
(lp9379
VOne though; consider renaming the class; calling it  is just asking for trouble, although you get a bit of scope here because it is nested ()
p9380
aVI wouldn't get too excited about this, though (the nesting does save a lot of pain for the consumer)
p9381
aVDon't call arguments thing like  - that isn't meaningful
p9382
aVThat said,  calls it , so I can't be too critical
p9383
aVBut I've got to grant you, a 10x performance figure isn't bad ;-p (although it only supports one format, of course)
p9384
aVOne other thing; a start and length is a more common pattern than a start and end
p9385
aVFinally - is there an off-by-one in the ParseSimple checks
p9386
aVShouldn't that be >=
p9387
aVIf length is 1, end can only be 0
p9388
as(dp9389
g18
V23354
p9390
stp9391
a((dp9392
g2
(lp9393
VIt it an array of  references, so you will need to iterate over it and extract the objects, For example:
p9394
aVIf you know what the objects are, you can cast etc - or you can use the LINQ OfType/Cast extension methods:
p9395
aVOr you can test each object:
p9396
aVBeyond that, you are going to have to add more detail
p9397
as(dp9398
g18
V23354
p9399
stp9400
a((dp9401
g2
(lp9402
VThe query returns  for some , but most binding sources (except ASP
p9403
aVNET) require  (such as any  implementation) - try adding  - i
p9404
ag50
aVA  might work even better (if it is supported in CF 3
p9405
aV5) since it has better support for some of the common binding scenarios; if you need this (and assuming  exists on CF 3
p9406
aV5), you can add an extension method:
p9407
aVthen call:
p9408
aVFor completeness, an alternative to an  is  (or even  for purely-metadata scenarios), which is why  is commonly typed as ; if it wasn't for this issue, the compiler probably would have been able to tell you the problem (i
p9409
ag50
aVif  was defined as )
p9410
as(dp9411
g18
V23354
p9412
stp9413
a((dp9414
g2
(lp9415
VI take it that you have an exception in your Form's  method or  event, then
p9416
aVThis is a notorious issue, which isn't helped by the IDE making it behave differently
p9417
aVBasically, you need to make sure that your / don't throw
p9418
aVperhaps put the  in there, and set a property you can check afterwards
p9419
as(dp9420
g18
V23354
p9421
stp9422
a((dp9423
g2
(lp9424
VYou need to call the default constructor for this to work:
p9425
aVA bigger problem here is that you have a mutable struct
p9426
aVThis is never a good idea
p9427
aVI would make it:
p9428
aVNot technically immutable, but close enough
p9429
as(dp9430
g18
V23354
p9431
stp9432
a((dp9433
g2
(lp9434
VThe short version is that I suspect you are going to have to pass the arg more directly, i
p9435
ag50
aVAlthough you can set environment variables (for use within the process), I don't think you can use them during the process start
p9436
as(dp9437
g18
V23354
p9438
stp9439
a((dp9440
g2
(lp9441
VWell, you could code it using explicit iteration:
p9442
aVThe bool flag option (with ) is probably easier though
p9443
aVthat is what I (almost) always do
p9444
aVAnother option would be LINQ:
p9445
aVThe downside of the above is that it tries to look at the list 3 times
p9446
aVsince we know it is a list, that is fine - but if all we had was an , it would only be sensible to iterate it once (since the source might not be re-readable)
p9447
as(dp9448
g18
V23354
p9449
stp9450
a((dp9451
g2
(lp9452
VBecause it is expected that  will be called lots of times
p9453
aVyou need to use:
p9454
aV(only call it at the start of a sequence) and write that; this is where the BOM lives
p9455
as(dp9456
g18
V23354
p9457
stp9458
a((dp9459
g2
(lp9460
VFor info, re the relative path issue - I discussed this here (the same concept applies to any page, not just master pages)
p9461
aVThe approach I used is like so:
p9462
aV1: declare an extension method for adding scripts:
p9463
aV2: when needed (for example in the ) use this method:
p9464
aVThe advantage of this is that it will work even if the web app is hosted in a virtual directory (i
p9465
ag50
aVyou can't use "/Scripts" because you aren't necessarily at the site root) - yet it is a lot clearer (and less messy) than the full script with munged src, i
p9466
ag50
as(dp9467
g18
V23354
p9468
stp9469
a((dp9470
g2
(lp9471
VI've been playing with it for a while; some thoughts:
p9472
aV(ide) the new WPF interface, while shiny, plays merry heck with remote desktop to my VM
p9473
aVI'm hoping that will be optimized (or an option etc) before RTM
p9474
aV(language/framework) liking the new  support; shame it isn't complete (it doesn't provide operator support, which
p9475
aVNET 4
p9476
aV0 is meant to deliver)
p9477
aV(framework) interesting new  support - shame the language doesn't offer it directly, but very powerful for  fans
p9478
aVI haven't had time to play with the COM stuff (no-PIA/no-ref), but looks useful
p9479
as(dp9480
g18
V23354
p9481
stp9482
a((dp9483
g2
(lp9484
VTo call generic methods using a  at runtime, you need to use reflection - and  in particular, something like:
p9485
aVOtherwise, the compiler infers the  from the variable type -  in this case
p9486
aVOne side point here is that you can improve things by only doing the reflection once - i
p9487
ag50
aVdon't use , but use a generic constraint instead:
p9488
aVDefines the method without an arg, but with a default constructor; then:
p9489
aVcalls the method just using the type - the instance is created inside the method
p9490
aVThis is usually faster than repeated reflection
p9491
as(dp9492
g18
V23354
p9493
stp9494
a((dp9495
g2
(lp9496
VNo - at the IL level you can't return from inside an exception-handled block
p9497
aVIt essentially stores it in a variable and returns afterwards
p9498
ag412
ag50
aVsimilar to:
p9499
aVfor example (using reflector):
p9500
aVcompiles to:
p9501
aVThis basically declares a local variable (), places the value into the variable (inside the handled block), then after exiting the block loads the variable, then returns it
p9502
aVReflector renders this as:
p9503
as(dp9504
g18
V23354
p9505
stp9506
a((dp9507
g2
(lp9508
VYou can do this if you introduce an extra method to override (since you can't  and  a method with the same name in the same type):
p9509
aVNow you have a  method at each level with the correct type
p9510
as(dp9511
g18
V23354
p9512
stp9513
a((dp9514
g2
(lp9515
VIs it a typed or untyped
p9516
aVFor typed, this probably isn't a good idea to start with
p9517
aVBut for untyped, just manipulate the  etc on tables, or add/remove tables/associations
p9518
aVWas there something specific that was being painful
p9519
aVOr do you mean the schema for the adapter
p9520
aVPersonally, I very rarely use , preferring standard POCO classes for the entities (perhaps with ORM like LINQ-to-SQL/Entity Framework/NHibernate)
p9521
aVBut some people like them
p9522
as(dp9523
g18
V23354
p9524
stp9525
a((dp9526
g2
(lp9527
VIs the exception being thrown in
p9528
aVOr before then
p9529
aVIt is bad practice for  to throw, but not unheard of
p9530
aVSometimes (for example, with WCF) it is desirable to swallow these, but in this case the error sounds like something that shouldn't be swallowed
p9531
aVA quick search for  +  shows that this isn't uncommon - but there isn't enough info (database
p9532
aVscenario
p9533
aVin the question to narrow it down
p9534
aVPersonally, I'd start by looking at some of the google hits
p9535
aV(perhaps filtered by your rdbms)
p9536
as(dp9537
g18
V23354
p9538
stp9539
a((dp9540
g2
(lp9541
VThere are two common answers here:
p9542
aVif you try to log in, and are already logged in, offer to break (reset) the existing login
p9543
aVuse a polling/timeout - i
p9544
ag50
aVhave the app call a method every 2 minutes (for example) that updates a "last heard from"; if you haven't heard from somebody in 5 minutes (for example), then clear the flag
p9545
as(dp9546
g18
V23354
p9547
stp9548
a((dp9549
g2
(lp9550
VI'm not a big VB user, but something like:
p9551
aVTo rename it, you might need  (at a guess):
p9552
as(dp9553
g18
V23354
p9554
stp9555
a((dp9556
g2
(lp9557
VI don't know about any specific issues or workarounds for working with  in the settings, but perhaps side-step the issue and just work with a string
p9558
aVYou could serialize the data as xml, or (perhaps simpler) just a key/value delimited string
p9559
aVNote that  offers a simple way of doing this (as below)
p9560
aVThe tokenized string is "abc=def;ghi=jkl", but it will automatically handle escaping rules etc for more complex data
p9561
aVWorth a try
p9562
as(dp9563
g18
V23354
p9564
stp9565
a((dp9566
g2
(lp9567
VDateTime is immutable; functions like AddMinutes return a new DateTime; so you need to catch the returned value:
p9568
as(dp9569
g18
V23354
p9570
stp9571
a((dp9572
g2
(lp9573
VWell, don't forget that a  stores 2
p9574
aV3
p9575
aVversions of the data - original and updated (possibly one other
p9576
aVIt also has a lot of references since it is cell-based, and boxing for any value-types
p9577
aVIt would be hard to quantify the exact memory
p9578
aVPersonally, I very rarely use  - typed POCO classes are a much more sensible bet in my view
p9579
aVI wouldn't use an array (directly), though -  or  or similar would be far more common
p9580
aVAs a crude measure, you could create a lot of tables etc and look at the memory usage; for example, the following shows a ~4
p9581
aV3 factor - i
p9582
ag50
aVmore than 4 times as expensive, but obviously that depends a lot on the number of columns vs rows vs tables etc:
p9583
aVvs
p9584
aV(based on)
p9585
as(dp9586
g18
V23354
p9587
stp9588
a((dp9589
g2
(lp9590
VFor a lambda, no: you need
p9591
aVIs it for a delegate or an expression
p9592
aVFor delegates, another option is
p9593
aVThis may or may not be desirable, depending on the scenario
p9594
aVIt is more keys, certainly
p9595
aVIn some cases (not this one) you can use a target method directly - i
p9596
ag50
as(dp9597
g18
V23354
p9598
stp9599
a((dp9600
g2
(lp9601
VAttributes are a compile-time feature, so no: you can't add them (or set values against them) using IoC
p9602
as(dp9603
g18
V23354
p9604
stp9605
a((dp9606
g2
(lp9607
VNeither is a fad, and neither is going away any time soon, but in reality I only expect to see one of those two in regular usage by most
p9608
aVNET devs
p9609
aVThere's a big difference between F# and ASP
p9610
aVNET MVC; F# is a functional language - this has a number of advantages in a few scenarios, but for most line of business programming a general purpose language such as C# is generally more usable
p9611
aVThere is, however, lots to be gained from knowing about the functional style of programming (especially re immutability)
p9612
aVI looked at F#, and I hope it improves my C# even if I never write any production code in F#
p9613
aVFortunately, thanks to delegates and lambdas, C# can be used in a functional way, even if it isn't formally FP
p9614
aVASP
p9615
aVNET MVC, however, is a very different beast; MVC (more generally) is a known, established and trusted pattern that:
p9616
aVvastly improves the testability of the presentation tier
p9617
aVmakes a logical separation of concerns at the UI tier
p9618
aVprovides more direct access to the underlying html of the page
p9619
aVand a lot of other things (model binding, etc)
p9620
aVOr another way: to a lot of people, it makes ASP
p9621
aVNET finally make sense; I fully expect to make a lot of use of ASP
p9622
aVNET MVC in the coming year
p9623
as(dp9624
g18
V23354
p9625
stp9626
a((dp9627
g2
(lp9628
VYou should be able to use closure:
p9629
aVIs that what you mean
p9630
as(dp9631
g18
V23354
p9632
stp9633
a((dp9634
g2
(lp9635
VI suspect you might have to put the threads into a  for that to work - but why do you want it anyway
p9636
aVThere are usually other ways of communicating between threads (any of the lock / wait objects)
p9637
aVTo work at the process level (i
p9638
ag50
aVnot thinking of the  object), see here - you could limit it to the current process, but you won't be able to interact with the thread
p9639
as(dp9640
g18
V23354
p9641
stp9642
a((dp9643
g2
(lp9644
VBasically, unit test like crazy
p9645
aVI support both mono and C# on a pet project (protobuf-net), and getting it to even compile on the range of different platforms was fun (I support mono, CF, Silverlight, etc)
p9646
aVThere are a number of compiler bugs in mono (even in the current release), in particular relating to generics - which mean you might need to use slightly different code to get it to compile in all flavors
p9647
aVThen you need to think about which framework features you need
p9648
aVAvoid anything like WPF/WCF/WF, for example
p9649
aVBut if you stick to core 2
p9650
aV0 features you are generally OK
p9651
aVThere are still a lot of places where mono throws , though
p9652
aVIn one recent case, there were two ways of doing something: the "old" way worked on mono but was  in MS; the "new" version worked on MS, but was  on mono
p9653
aVFun
p9654
as(dp9655
g18
V23354
p9656
stp9657
a((dp9658
g2
(lp9659
VWell, you could simply not use the navigation property - i
p9660
ag50
aVuse the parent id directly and select from the child set
p9661
ag412
ag50
aVI also suspect that doing a  by using the navigation properties inside a query would work:
p9662
aVTSQL (sorry about the format - console dump
p9663
ag6864
aVNote that it both cases the date condition went down to the database
p9664
as(dp9665
g18
V23354
p9666
stp9667
a((dp9668
g2
(lp9669
VRe the second query () - see here
p9670
aV(er, hang on
p9671
aVThat is you as well
p9672
aVYou've asked this question before
p9673
aVduplicate
p9674
as(dp9675
g18
V23354
p9676
stp9677
a((dp9678
g2
(lp9679
VYou don't have much control over / serialization
p9680
aVIMO, the best answer here is: don't use / on web-services
p9681
aVPersonally, I'd declare a class with the properties I need, attribute them as I like, and return an array () or  of that type
p9682
aVFar cleaner, you have more control over the xml, and it is usable from different types of client (not just
p9683
aVNET)
p9684
as(dp9685
g18
V23354
p9686
stp9687
a((dp9688
g2
(lp9689
VCould that be done with an extension method instead
p9690
aVThen you can just use the interface
p9691
aVExtension methods are a good way of adding common implementation logic to an interface
p9692
aVThis works best of you primarily talk about  (not concrete types) - since extension resolution prefers types - i
p9693
ag50
aVcould declare a bespoke  method, which would (if you are typing variables as ) take preference
p9694
aVBut this is no different to your example, since  could re-implement the interface, stealing the implementation:
p9695
aVAt least with the extension method approach your code can't be fooled into running the re-implemented version; your code only knows about , so only the  version will be used
p9696
aVEver
p9697
aVExample (edit reworked from your example):
p9698
as(dp9699
g18
V23354
p9700
stp9701
a((dp9702
g2
(lp9703
VYou shouldn't use the  version - you should either accept and store something repeatable like an , or create a new, local collection of the data:
p9704
aVActually, I'd use  myself; then you can do (although this isn't the reason to use ):
p9705
as(dp9706
g18
V23354
p9707
stp9708
a((dp9709
g2
(lp9710
VYou can use a separate thread (as below), but this is getting into dangerous territory - you should only go near this option if you understand the implications of threading (synchronization, cross-thread access, etc):
p9711
aV(obviously, you wouldn't actually structure the code like the above - this is just the shortest way of showing the behavior; in real code you'd have a class per form etc)
p9712
as(dp9713
g18
V23354
p9714
stp9715
a((dp9716
g2
(lp9717
VIt doesn't make sense to consider  members, as they aren't per-instance; but if you just mean non-public instance members: consider  (
p9718
aVNET 3
p9719
aV0) - this is similar to , but can serialize non-public properties (although it is "opt in")
p9720
aVSee here for more
p9721
as(dp9722
g18
V23354
p9723
stp9724
a((dp9725
g2
(lp9726
s(dp9727
g18
V23354
p9728
stp9729
a((dp9730
g2
(lp9731
VI use it in a binary serializer (protobuf-net)
p9732
aVI use reflection only to build the model - when it is used (i
p9733
ag50
aVduring [de]serialization) it is using delegates etc for maximum performance
p9734
aVI also used it (along with ComponentModel and Reflection
p9735
aVEmit) in HyperDescriptor, to build accelerated property access (~100x the speed of regular reflection)
p9736
aVAnd by necessity, you need to use reflection if you are building your own s
p9737
as(dp9738
g18
V23354
p9739
stp9740
a((dp9741
g2
(lp9742
VNone that I know of
p9743
aVOf course, if you use one of the many binding approaches available, then you won't have to - the binding will do the update in both directions (including change via notifications)
p9744
aVSo for winforms:
p9745
aVetc
p9746
as(dp9747
g18
V23354
p9748
stp9749
a((dp9750
g2
(lp9751
VWell, "ngen" can pre-JIT an app
p9752
aVThere are other tools for avoiding having a full
p9753
aVNET install, but I try to avoid them
p9754
aVIn general: yes, you need a framework (but it could be Client Profile, Compact Framework, Micro Framework, or Silverlight if you want light-weight; all are MS CLR variants)
p9755
as(dp9756
g18
V23354
p9757
stp9758
a((dp9759
g2
(lp9760
VDoes it have to be free
p9761
aVLast time I looked at ABCpdf it looked quite good, and claims to support css (here)
p9762
aVHTMLDOC should support css at some point, but last time I checked the css stuff was still in beta
p9763
aVAnd has been for "some time"; I've given up waiting
p9764
aVIt isn't
p9765
aVNET, but you can use  to invoke it
p9766
as(dp9767
g18
V23354
p9768
stp9769
a((dp9770
g2
(lp9771
VPerhaps just use a zip with compression set to "none"; SharpZipLib would suffice
p9772
aVBe careful about assuming that compression is slower, though - it might actually (depending on the scenario) be quicker with compression, since you reduce the amount of physical IO and IPC (often a bottleneck), and simply do a bit more CPU work; but you generally have plenty of CPU
p9773
as(dp9774
g18
V23354
p9775
stp9776
a((dp9777
g2
(lp9778
VNo they aren't the same
p9779
aVThe biggest difference would be in the forming of relative uris from that base; with the slash, the relative uri would be a descendent; without the slash it would be a sibling - i
p9780
ag50
aV(C# example):
p9781
as(dp9782
g18
V23354
p9783
stp9784
a((dp9785
g2
(lp9786
VDepending on the requirements, you could simply enable regular CRUD via Astoria
p9787
aVI have a series covering how to do this with LINQ-to-SQL here
p9788
aVJust a thought
p9789
as(dp9790
g18
V23354
p9791
stp9792
a((dp9793
g2
(lp9794
VAs far as I know, a faulted state is usually terminal to a WCF proxy
p9795
aVSo no, I don't think so
p9796
as(dp9797
g18
V23354
p9798
stp9799
a((dp9800
g2
(lp9801
VWhy do you want to write an iterator class
p9802
aVThe whole point of an iterator block is so you don't have to
p9803
ag412
ag50
aVIf you add more context (i,e, why the above can't work), we can probably help more
p9804
aVBut if possible, avoid writing an iterator class
p9805
aVThey are lots of work, and easy to get wrong
p9806
aVBy the way, you don't really have to bother with  - it is largely deprecated, and shouldn't really ever be used (since it can't be relied to work for an arbitrary enumerator)
p9807
aVIf you want to consume an inner iterator, that is fine too:
p9808
aVor if you only have an enumerator:
p9809
aVYou might also consider adding the state (as a tuple) to the thing you yield:
p9810
aVFinally, you could use a LINQ-style extension/delegate approach, with an  to supply the position and value to the caller:
p9811
aVOutputs:
p9812
as(dp9813
g18
V23354
p9814
stp9815
a((dp9816
g2
(lp9817
V(update - I meant , not ;  will do the import)
p9818
aVFirst, there is nothing special about "express" here
p9819
aVSecond, contoso is a dummy url
p9820
aVWhat OS are you on
p9821
aVAnd do you go through a proxy server
p9822
aVIf so, you might need to configure the OS's http stack -  will do the job on XP, and can be used to import the user's IE settings
p9823
aVThe sample is fine, although it doesn't correctly handle the multiple  objects - the following is much simpler:
p9824
as(dp9825
g18
V23354
p9826
stp9827
a((dp9828
g2
(lp9829
VYou can't resize an existing array, however, you can use:
p9830
aVThis allocates a new array, copies the data from the old array into the new array, and updates the  variable (which is passed by-ref in this case)
p9831
aVIs that what you mean
p9832
aVHowever, any other references still pointing at the old array will not be updated
p9833
aVA better option might be to work with  - then you don't need to resize it manually, and you don't have the issue of out-of-date references
p9834
aVYou just / etc
p9835
aVGenerally, you don't tend to use arrays directly very often
p9836
aVThey have their uses, but they aren't the default case
p9837
aVRe your comments;
p9838
aVboxing:  doesn't box
p9839
aVThat is one of the points about generics; under the hood,  is a wrapper around , so a  has an  - no boxing
p9840
aVThe older  is a wrapper around , so that does box; of course, boxing isn't as bad as you might assume anyway
p9841
aVworkings of ; if I recall, it finds the size of , then uses  to blit the contents the actual details are hidden by an internal call - but essentially after allocating a new array it is a blit (memcpy) of the data between the two arrays, so it should be pretty quick; note that for reference-types this only copies the reference, not the object on the heap
p9842
aVHowever, if you are resizing regularly,  would usually be a lot simpler (and quicker unless you basically re-implement what  does re spare capacity to minimise the number of resizes)
p9843
as(dp9844
g18
V23354
p9845
stp9846
a((dp9847
g2
(lp9848
VI'm pretty sure the javascript has no idea which file it has loaded from, so there shouldn't be a problem merging it, however
p9849
aVPersonally, I'd keep them separate
p9850
aVIt will make it simpler to co-ordinate versioning etc
p9851
aVFor most repeat visits, the script will be cached by the browser anyway, so 2 vs 1 isn't really a huge issue
p9852
aVBut when you do upgrade one (or the other), the client only needs to download half as much
p9853
aVBut again, since it is generally cached it isn't a biggie
p9854
aVSo for simplicity - keep the scripts in their original forms
p9855
aVGiven your opening comment "I don't know too much about javascript", this is by far the best approach; I don't mean that disparagingly - simply that if something goes wrong, you don't want to have to find if you broke it, or it was broke already
p9856
aVEdit: it also makes it easy to re-order, for example if you are using two scripts that use the same terminology like  in jQuery, which also supports a mode with the explicit naming
p9857
as(dp9858
g18
V23354
p9859
stp9860
a((dp9861
g2
(lp9862
VWell, a cryptographic hash shouldn't compromise security as long as it is salted and has reasonable complexity; personally, though, I'd probably try to set it up so that data corruption (due to incorrect password) is obvious early on
p9863
aVAny possibility of injecting checksums in the data at regular intervals
p9864
aVOr if the stream represents records, can you read it with an iterator ( etc) so that it reads lazily and breaks early
p9865
aV(edit) Also - forcing it to decrypt a non-trivial chunk of data (but not the entire stream) before it can tell if the password was right should be enough to make it hard to brute-force
p9866
aVIf it only has to work with the first 128 bytes (or whatever) that might be fast enough to make it worth-while trying (dictionary etc)
p9867
aVBut for regular usage (one try, password either right or wrong) it should have no performance impact
p9868
as(dp9869
g18
V23354
p9870
stp9871
a((dp9872
g2
(lp9873
VWith LINQ-to-SQL, there are specific ways of doing this from the data-context; basically,
p9874
aVThis returns an , but it is a little tricky to work with an untyped
p9875
aVYou can enumerate it, at least
p9876
aVTo get the , you normally need the , which you can get with (for example) :
p9877
aVOf course, once you have the , you use use  to create new entity instances:
p9878
aVbut if you want to use the property-name, that can work too:
p9879
aVRunning filters () etc is tricky with untyped data, as building the  would be tortuous
p9880
aVI'd probably start switching to a typed model at that point
p9881
as(dp9882
g18
V23354
p9883
stp9884
a((dp9885
g2
(lp9886
VServer-side, "(
p9887
aVi)" can be used, but this doesn't work client-side
p9888
aVSee here for more discussion and workaround
p9889
ag412
ag50
aV"
p9890
ag9246
aVi)(jpg|jpeg|gif|png|wpf|
p9891
as(dp9892
g18
V23354
p9893
stp9894
a((dp9895
g2
(lp9896
VWell, for most table use, you'd need , but this isn't easy to do without messing with the partial classes
p9897
aVHowever, if you just want it available, you could declare your own attribute against the class, and add it there:
p9898
aVThen use reflection to get it out; that do
p9899
aVIf so, something like:
p9900
as(dp9901
g18
V23354
p9902
stp9903
a((dp9904
g2
(lp9905
VYou can't, basically
p9906
aVYou can only use fixed aliases, such as:
p9907
as(dp9908
g18
V23354
p9909
stp9910
a((dp9911
g2
(lp9912
VMS Chart Controls (VS tools) work with winforms too:
p9913
aVMicrosoft Chart Controls for Microsoft
p9914
aVNET Framework 3
p9915
aV5 will install new
p9916
aVassemblies that contain the ASP
p9917
aVNET
p9918
aVand Windows Forms Chart Controls
p9919
aVI haven't had time to use it yet, so I don't know whether it supports charting/plotting (rather than data-graphing)
p9920
as(dp9921
g18
V23354
p9922
stp9923
a((dp9924
g2
(lp9925
VWell, they are types - of sorts:
p9926
aVSo you can check by the number of args, and check the signature
p9927
aVBut nothing cleaner
p9928
as(dp9929
g18
V23354
p9930
stp9931
a((dp9932
g2
(lp9933
VWell, there are the spatial types in the SQL Server library that might help with some of your needs
p9934
aV(certainly things like distance/area on 2D/3D surfaces)
p9935
aVThese are intended to be used from TSQL, but as I understand it you should be able to use them in
p9936
aVNET too (since they are just assemblies)
p9937
as(dp9938
g18
V23354
p9939
stp9940
a((dp9941
g2
(lp9942
VIt depends if you ever want to be able to change the tag-text globally
p9943
aVYou could, of course, issue a wide  on , but if you need to be able to do this, then being able to just update the value in  would be simpler
p9944
aVSome servers offer automatic updates (such as  in SQL Server), but these aren't necessarily cheap (it still has to  a lot of rows and any indexes defined)
p9945
aVBut if you don't need this, then it should be a bit quicker with the literal in , as it can remove a join - a lot of times
p9946
aVObviously, index it etc
p9947
aVThe additional space required for the repeated literal is a factor, but disk space is usually cheaper than a faster server
p9948
aVAs for being a primary key; unless you have other data to store, why would you even need the table any more
p9949
aVYou could use  on  just as easily, especially as  should be indexed (so this should be pretty cheap)
p9950
aV(edit Bill Karwin correctly points out the merits of being able to keep eligible tags, not just current tags)
p9951
as(dp9952
g18
V23354
p9953
stp9954
a((dp9955
g2
(lp9956
VI've written Sort variants using a selector before - it isn't hard
p9957
aVsomething like:
p9958
as(dp9959
g18
V23354
p9960
stp9961
a((dp9962
g2
(lp9963
VYou can create a shallow copy efficiently with reflection by pre-compiling it, for example with
p9964
aVFor example, like so
p9965
aVFor deep copies, serialization is the most reliable approach
p9966
as(dp9967
g18
V23354
p9968
stp9969
a((dp9970
g2
(lp9971
VAny particular browser
p9972
aVMainly it works with IE, and needs script debugging enabled in the IE internet options (advanced => browsing)
p9973
as(dp9974
g18
V23354
p9975
stp9976
a((dp9977
g2
(lp9978
VWell, the "join" is tricky, because it is very hard to express a join - but things like where / select / orderby are pretty easy
p9979
aVReally, it is just a case of combining the various LINQ methods on , which generally accept  for some combination
p9980
aVSo a basic select with an optional predicate would be:
p9981
aVI would tend to return  too, since that is fully composable
p9982
aVIf the caller wants a list, they can always use  on it
p9983
aVor (for example):
p9984
aVwhich (using Northwind) does the query:
p9985
aVThe problem with including the "select" (projection) in the query is that you would end up with multiple generic types
p9986
aVSince you often want the projection the be an anonymous type, it would then be pretty impossible to specify the projection type (anonymous) and the table-type, and it would not be callable
p9987
aVIn reality, I wonder if there is much benefit writing such a method at all
p9988
aVI might just stick with a base method:
p9989
aVAnd let the caller compose it in their preferred way - perhaps with query syntax:
p9990
aVWhich uses:
p9991
aVAlternatively, if you really do want to include the order by and projection, then an extension method is the most practical approach; then you don't need to specify the original (source) T (which is what makes it uncallable when mixed with anon-types):
p9992
aVThen consider a DAL method such as:
p9993
aVWhich uses (again, with Northwind):
p9994
as(dp9995
g18
V23354
p9996
stp9997
a((dp9998
g2
(lp9999
V only implements  by associaton; i
p10000
ag50
aVit implements  precisely because it inherits  which is
p10001
aVYou'd get the same with type hierarchies (although only single inheritance:
p10002
aVso  is an ; in the same way,  is
p10003
aVFor example, if I write:
p10004
aVAnd look at the metadata, then it appears that  - but this is only indirect; here's the IL:
p10005
as(dp10006
g18
V23354
p10007
stp10008
a((dp10009
g2
(lp10010
VWell, a very good and well-used streaming CSV reader is on CodeProject; that is the first thing I'd try
p10011
aVbut it sounds like your encoding may be borked, which might not make it simple
p10012
aVof course, it could just be odbc that is breaking, in which case the above might work fine
p10013
aVFor simple CSV you could try parsing it yourself ( etc), but there are enough edge-cases that a pre-rolled parser is worth using
p10014
as(dp10015
g18
V23354
p10016
stp10017
a((dp10018
g2
(lp10019
VNot that I know of; for some scenarios, you could use something like a  and use
p10020
aVHowever, I don't think you can push arbitrary data back into the stream unless you are using something like  and can thus monkey with the data
p10021
aVEven if you have a  that is both readable and writeable (rare), then there is still only one cursor, so you would need to be careful to reset the position after writing (so it would need to be seekable too; again, not common); however, this is not robust - some streams (the network streams in TCP, for example) would treat the write as a "send this to the other machine", and it would never be returned by a read
p10022
aVAnd it isn't seekable ;-p
p10023
as(dp10024
g18
V23354
p10025
stp10026
a((dp10027
g2
(lp10028
VIt is rare, in reality, that you would want to use an array
p10029
aVDefinitely use a  any time you want to add/remove data, since resizing arrays is expensive
p10030
aVIf you know the data is fixed length, and you want to micro-optimise for some very specific reason (after benchmarking), then an array may be useful
p10031
aVoffers a lot more functionality than an array (although LINQ evens it up a bit), and is almost always the right choice
p10032
aVExcept for  arguments, of course ;-p
p10033
aVAs a counter -  is one-dimensional; where-as you have have rectangular (etc) arrays like  or  - but there are other ways of modelling such data (if you need) in an object model
p10034
aVSee also:
p10035
aVHow/When to abandon the use of Arrays in c#
p10036
aVnet
p10037
aVArrays, What's the point
p10038
aVThat said, I make a lot of use of arrays in my protobuf-net project; entirely for performance:
p10039
aVit does a lot of bit-shifting, so a byte[] is pretty much essential for encoding
p10040
aVI use a local rolling  buffer which I fill before sending down to the underlying stream (and v
p10041
aVv
p10042
aV; quicker than  etc
p10043
aVit internally uses an array-based model of objects ( rather than ), since the size is fixed once built, and needs to be very fast
p10044
aVBut this is definitely an exception; for general line-of-business processing, a  wins every time
p10045
as(dp10046
g18
V23354
p10047
stp10048
a((dp10049
g2
(lp10050
VYou could try to connect
p10051
aVFor quick (offline) validation, perhaps use  to parse it
p10052
aVBut to check whether the db exists, you'll need to try to connect
p10053
aVSimplest if you know the provider, of course:
p10054
aVIf you only know the provider as a string (at runtime), then use :
p10055
as(dp10056
g18
V23354
p10057
stp10058
a((dp10059
g2
(lp10060
VIf you simply invoke a delegate, it will call all the target methods in order
p10061
aVYou need to use  if you want to execute them individually - for example:
p10062
aVto check  after each
p10063
aVto capture the return value of each
p10064
aVto continue after failure of an individual target
p10065
aVAs for the best way to use it: how do you want it to behave
p10066
aVIt isn't clear to me
p10067
aVfor example, this might suit an extension method quite well:
p10068
aVThen you can just call  (for example)
p10069
aVAnother example might be:
p10070
aVwhich stops after the first event requests cancellation
p10071
as(dp10072
g18
V23354
p10073
stp10074
a((dp10075
g2
(lp10076
VWell, firstly I'd try to avoid mistakes due confusion with java concepts (since you're from a java background)
p10077
aVFor example:
p10078
aVint/Int32 (etc): in C# they are the same
p10079
aVgenerics: how they differ from java
p10080
aVdelegates/events: don't exist in java
p10081
aVclosures: java captures the value; C# captures the variable (allowing updates)
p10082
aVstructs, how they work, and why you very rarely need them ;-p
p10083
aVBut C# is not a tiny language, and the
p10084
aVNET framework is huge
p10085
aVSo there is a lot to cover
p10086
as(dp10087
g18
V23354
p10088
stp10089
a((dp10090
g2
(lp10091
VA reference-type field's get/set (ldfld/stfld) is (IIRC) guaranteed to be atomic, so there shouldn't be any risk of corruption here
p10092
aVSo it should be thread-safe from that angle, but personally I'd lock the data at a higher level - i
p10093
ag50
aVor maybe:
p10094
aVThis allows you to make multiple reads/updates to the same object as an atomic operation, so that other threads can't get an invalid object-state
p10095
as(dp10096
g18
V23354
p10097
stp10098
a((dp10099
g2
(lp10100
VWell, you could return  and let the caller check the
p10101
aVOf course, returning an array may not be the best option in the first place (depending on the scenario): Arrays considered somewhat harmful
p10102
as(dp10103
g18
V23354
p10104
stp10105
a((dp10106
g2
(lp10107
VI'm pretty sure that CSVReader (CodeProject) can read to
p10108
aVNote that manually setting up the schema is optional; if you don't, I believe it assumes that everything is
p10109
as(dp10110
g18
V23354
p10111
stp10112
a((dp10113
g2
(lp10114
VHow exactly are you using it
p10115
aVIIRC, you need to access the grids in the right order (it is just an , ultimately)
p10116
aVOr to quote: "Retrieves the next result as a sequence of a specified type
p10117
aVSee also the note on MSDN:
p10118
aVYou must use the GetResult(TElement)
p10119
aVpattern to obtain an enumerator of the
p10120
aVcorrect type, based on your knowledge
p10121
aVof the stored procedure
p10122
aVSo if you want the 3rd grid, I expect you need to call  twice (with appropriate types, and discard them) before you can read the 3rd grid
p10123
as(dp10124
g18
V23354
p10125
stp10126
a((dp10127
g2
(lp10128
VWell, docs
p10129
aVjquery
p10130
aVcom would be a good start (especially the Manipulation section)
p10131
aVUsually lots of good examples as well as the documentation
p10132
aVI picked up jQuery in Action which was well-worth a read
p10133
as(dp10134
g18
V23354
p10135
stp10136
a((dp10137
g2
(lp10138
VThe simplest option would probably be a hidden input:
p10139
aV(name accordingly; in each form)
p10140
aVThe two controller would then take an argument called "key" (rename to suit)
p10141
aVIf you want to parse the object from multiple inputs, you'll need a
p10142
aVOf course, rather than 2*n forms, you might consider either query-string based urls, or use something like jQuery (or some other script helper) to submit the data without needing the forms (if script is available)
p10143
as(dp10144
g18
V23354
p10145
stp10146
a((dp10147
g2
(lp10148
VWell, since you are using  it would be a lot simpler to just use a , for example:
p10149
aVOf course, with LINQ you could just use:
p10150
aVBut you can re-introduce this in  (for in-place re-ordering) quite easily; Here's an example that allows  on  with lambda syntax:
p10151
as(dp10152
g18
V23354
p10153
stp10154
a((dp10155
g2
(lp10156
VI believe the csproj has to be radically different to build for different frameworks
p10157
aVHowever, there are tricks; for example, you can use wildcards in the csproj
p10158
aVI use this in protobuf-net, which builds on
p10159
aVNET 2
p10160
aV0/3
p10161
aV0/CF 2
p10162
aV0/CF 3
p10163
aV5/Silverlight/Mono - so I know what you mean
p10164
aVHave a look at my CF 2
p10165
aV0 csproj; in particular:
p10166
ag412
ag50
aVfind all
p10167
aVcs files at any level in the main project
p10168
as(dp10169
g18
V23354
p10170
stp10171
a((dp10172
g2
(lp10173
V(updated)
p10174
aVRight; I see what you mean
p10175
aVI suspect that with LINQ-to-SQL you can only associate to the base-class, and it will give you the appropriate types
p10176
aVYou can filter with  etc
p10177
aVYou can't simply add the id to the derived class, as it needs to be resolvable by LINQ when examining query expressions - and a bespoke standalone property won't be
p10178
aVHowever, I also recall that this is possible in EF (even if I don't like EF overly ;-p)
p10179
as(dp10180
g18
V23354
p10181
stp10182
a((dp10183
g2
(lp10184
VIf the message is a class, you don't need to pass any of it by reference; you simply either update the existing message object, or create a new message object and swap it in the list (via the indexer, or with Remove/Add)
p10185
aVYou only need  if you are creating a new list
p10186
aVSo if  is a mutable class, just:
p10187
aVIf not, use the 's indexer (or, as stated /) - i
p10188
ag50
aVNote that if you do change the list contents during the , the  iterator will almost certainly break; there are ways of handling that, but if you can: just update a property of the message itself
p10189
as(dp10190
g18
V23354
p10191
stp10192
a((dp10193
g2
(lp10194
VYou add data to rows - so:
p10195
aVHowever, there are probably easier options; a  seems massively overkill to bind a single value
p10196
as(dp10197
g18
V23354
p10198
stp10199
a((dp10200
g2
(lp10201
VHow about with LINQ-to-Objects:
p10202
aVIf you only have C# 2, you can use a utility method instead:
p10203
as(dp10204
g18
V23354
p10205
stp10206
a((dp10207
g2
(lp10208
VI believe that  only supports properties of the immediate type
p10209
aVIs repeater or anything similar an option
p10210
aVThat gives you more flexibility
p10211
aVAlternatively, you can add shim properties to the type via a partial class:
p10212
aVYou can't use this in filters ( etc), but you should be able to use it on returned objects without issue
p10213
aVNote that you might want to use  to save the round-trips:
p10214
as(dp10215
g18
V23354
p10216
stp10217
a((dp10218
g2
(lp10219
VHow about this
p10220
aVIt avoids the exception often thrown by the in-built recursive search (i
p10221
ag50
aVyou get access-denied to a single folder, and your whole search dies), and is lazily evaluated (i
p10222
ag50
aVit returns results as soon as it finds them, rather than buffering 2000 results)
p10223
aVThe lazy behaviour lets you build responsive UIs etc, and also works well with LINQ (especially , , etc)
p10224
as(dp10225
g18
V23354
p10226
stp10227
a((dp10228
g2
(lp10229
VCan you define "not working"
p10230
aVSimply not doing anything
p10231
aVThrowing an exception
p10232
aVI would expect the problem to be in the  method - i
p10233
ag50
aVisn't being called
p10234
aVAnother common issue is not rebuilding it in the correct configuration, so  (or whatever) isn't updated
p10235
aVHave you built the app as a console exe
p10236
ag412
ag50
aVis the "Output Type" = "Console Application" in project properties
p10237
aVIt needs to be in order to access the console
p10238
aVFor info, I find the easiest way to do a console help screen (once it gets beyond a handful of lines) is to embed a
p10239
aVtxt file into the exe; then I just write out the text file (perhaps still using  if I want to replace tokes)
p10240
aVAlternatively, there is the alternative string format:
p10241
as(dp10242
g18
V23354
p10243
stp10244
a((dp10245
g2
(lp10246
VEdit: for clarification there is an insane edge case where you can get  from a class constructor, but frankly I don't think any real code should ever expect to deal with this level of crazy: What's the strangest corner case you've seen in C# or
p10247
aVNET
p10248
aVTo all normal intents : it won't happen
p10249
aVNo, you can't get null from a class constructor ( is a class)
p10250
aVThe only case I know of where a constructor can (seem to) return  is  - i
p10251
ag50
aVThis is a slightly bigger problem with generics:
p10252
aV(of course, there are ways of checking/handling that scenario, such as )
p10253
aVOther than that, a constructor will always either return an object (or initialize a struct), or throw an exception
p10254
as(dp10255
g18
V23354
p10256
stp10257
a((dp10258
g2
(lp10259
VYes, it does - to a small extent
p10260
aVThere is an edge-case to do with scoping / local names, see Eric Lippert's blog
p10261
aVFor a concrete example (specific to alias usage):
p10262
as(dp10263
g18
V23354
p10264
stp10265
a((dp10266
g2
(lp10267
VWell, is it right
p10268
aVDo the column names exist on both sides
p10269
aVTo be honest, I've never bothered with mappings
p10270
aVI like to keep things simple - I tend to have a staging table that looks like the input on the server, then I  into the staging table, and finally run a stored procedure to move the table from the staging table into the actual table; advantages:
p10271
aVno issues with live data corruption if the import fails at any point
p10272
aVI can put a transaction just around the SPROC
p10273
aVI can have the bcp work without logging, safe in the knowledge that the SPROC will be logged
p10274
aVit is simple ;-p (no messing with mappings)
p10275
aVAs a final thought - if you are dealing with bulk data, you can get better throughput using  (since this is a streaming API, where-as  is a buffered API)
p10276
aVFor example, I tend to hook CSV imports up using CsvReader as the source for a SqlBulkCopy
p10277
aVAlternatively, I have written shims around  to present each first-level element as a row in an  - very fast
p10278
as(dp10279
g18
V23354
p10280
stp10281
a((dp10282
g2
(lp10283
VAt the simplest level,  should do the job:
p10284
aVFor more complex scenarios, you might want to try adding a Reset method; for example:
p10285
as(dp10286
g18
V23354
p10287
stp10288
a((dp10289
g2
(lp10290
VJust to second Yossi's/Rich's thoughts:
p10291
aVyes, you can add a reference to the shared dll (rather than using the generated proxy class)
p10292
aVyes, it defeats a lot of the intent of data-contracts, and if any kind of custom serialization is happening, you may have issues extending your service
p10293
aVI have gone down this road before, and in some ways wish I hadn't
p10294
aVRe extensibility / custom serialization - you have to be very careful
p10295
aVA bit easier if you use a pre-rolled serializer such as protobuf-net (which can integrate directly into WCF, and which is designed with extensibility in mind), but not easy
p10296
aVActually, one advantage of sharing the classes is that it makes it a bit easier to test: since you have the same  everywhere, you can mock that  with reasonable chance of success
p10297
aVIt is harder to mock when the proxy gets involved (as you change more moving parts between the test code and the production code)
p10298
as(dp10299
g18
V23354
p10300
stp10301
a((dp10302
g2
(lp10303
VJust a thought, but have you looked at ADO
p10304
aVNET Data Services
p10305
aVThis provides a REST-enabled API much like the above with a lot of standard LINQ functionality built in
p10306
aVI can't think of an interest dynamic LINQ exploit of the top of my head, but if this was me I'd be at least white-listing members (, , etc) - but I'd probably write the  logic directly; it isn't especially hard if you are only supporting direct properties
p10307
aVFor example, here is  (using your  logic):
p10308
aVI've covered  previously, here
p10309
as(dp10310
g18
V23354
p10311
stp10312
a((dp10313
g2
(lp10314
VLINQ in Action is a good book for understanding the principles of LINQ, and LINQ-to-SQL in particular
p10315
aVC# in Depth is good for understand how LINQ works at the language level, including query syntax, extension methods and expression trees
p10316
aVEF
p10317
aVtrickier
p10318
aVOne problem is that it is likely to change quite a bit between now and the next version due to the "thunderdome" scenario
p10319
as(dp10320
g18
V23354
p10321
stp10322
a((dp10323
g2
(lp10324
VIt depends on the scenario
p10325
aVWCF, for example, decorates interfaces for the operation contracts
p10326
aVHowever, if you are going to be talking about objects (rather than the interface itself), note that it can be painful for calling code to get hold of interface metadata, especially if the class uses explicit interface implementation
p10327
aVIt would be more common to decorate the class, but that isn't quite the same question ;-p
p10328
aVIf the attribute really is specific to the interface (not the instances), then fine - decorate the interface and talk about  etc
p10329
aVBut if you expect code to be able to set per-type values for the attributes, it will have to be at the class level
p10330
aVWhat is the scenario
p10331
as(dp10332
g18
V23354
p10333
stp10334
a((dp10335
g2
(lp10336
VAt the IL level, you could probably issue a  rather than a , and get the job done - but if we limit ourselves to C# ;-p (edit darn
p10337
aVthe runtime stops you: : "Operation could destabilize the runtime
p10338
aV; remove the  and it works fine; too clever by half
p10339
aVInside the  type, you can use  - however, this is not possible externally
p10340
aVNor can you go down more than one level - there is no  support
p10341
aVHowever, if you disable polymorphism using method-hiding, you can get the answer you want, but for bad reasons:
p10342
aVNow you can get a different answer from the same object depending on whether the variable is defined as a  or a
p10343
as(dp10344
g18
V23354
p10345
stp10346
a((dp10347
g2
(lp10348
VI had a similar problem when trying to get  to work; I just used the / approach instead; however - it is complicated because it is a generic method
p10349
aVThis should be the right  - but it is hard to give a full (runnable) answer without a bit more clarity on  and :
p10350
aVNote that extension methods work backwards - so you actually want to call  with the two args (the source and the predicate)
p10351
aVSomething like:
p10352
aVIf in doubt, use reflector (and fiddle it a bit ;-p) - for example, I wrote a test method as per your spec:
p10353
aVAnd decompiled it and toyed with it
p10354
as(dp10355
g18
V23354
p10356
stp10357
a((dp10358
g2
(lp10359
VLikely uses:
p10360
aVcreating LINQ expressions by hand
p10361
aVserialization, either inbuilt or bespoke
p10362
aVdata-binding
p10363
aVdata import/export, for example via
p10364
aVdynamic code generation ()
p10365
as(dp10366
g18
V23354
p10367
stp10368
a((dp10369
g2
(lp10370
VI'm pretty sure you can't make the one compiled-query span multiple tables (if that is what you mean); how would it know where to look
p10371
aVEF supports something like this with inheritance (and multiple tables), but even with inheritance LINQ-to-SQL only supports single-table discriminated inheritance
p10372
aVThe heart of this question is largely identical to this one from earlier today
p10373
aVThe tricky bit is the primary key, since that is hard to define abstractly
p10374
aVThe rest is just  (with LINQ-to-SQL at least)
p10375
aVYou don't need a superclass in this case - just a way to get the primary key
p10376
aVFortunately, I seem to recall that LINQ-to-SQL offers a way to do this (without needing to use the attributes, which is not a pre-req of LINQ-to-SQL); the following doesn't pre-compile (and is untested), but should be fairly close:
p10377
aV(update fixed and tested)
p10378
aVUsage first:
p10379
aVcode:
p10380
aVI'll see if I can find a way to pre-compile it
p10381
as(dp10382
g18
V23354
p10383
stp10384
a((dp10385
g2
(lp10386
VNo, most winforms bindings do not support child properties like this
p10387
aVYou can do it directly with custom type-descriptors, but that is a lot of work and not worth it
p10388
aVCheck the generated code; it should (with any recent version of the tools) be a ; that means you can add extra members in a second class file, so you don't break the wsdl-generated code - i
p10389
ag50
aVYou should now be able to bind to "InfoDescription" fairly easily
p10390
as(dp10391
g18
V23354
p10392
stp10393
a((dp10394
g2
(lp10395
VWell, you end up locking on a string, which isn't a good idea (although the concatenation means that interning shouldn't be a huge issue)
p10396
aVWhat is a bigger issue is that:
p10397
aVyou don't seem to remove the locks from  - is that an issue
p10398
aVyou access the dictionary outside the ; the  should be inside the
p10399
aVFor this second, this would be simpler:
p10400
aVIf this code is fairly local (i
p10401
ag50
aVyour objects haven't escaped yet), you might simply  the record itself
p10402
aVA lot simpler
p10403
as(dp10404
g18
V23354
p10405
stp10406
a((dp10407
g2
(lp10408
VIs it possible thatthe arg-value is null
p10409
aVIf so the param won't be added
p10410
aVFor nulls, you need to use ; for example (not the only way to do it):
p10411
as(dp10412
g18
V23354
p10413
stp10414
a((dp10415
g2
(lp10416
VDo you know the structure of the  and the typed object ahead of time
p10417
aVYou could use a delegate to do the mapping
p10418
aVIf you don't (i
p10419
ag50
aVall you know is a  and properties) there are ways of accelerating dynamic member access (such as )
p10420
aVEither way, consider an iterator block; that way you don't have to buffer the objects an entire second time; of course, if you are only dealing with smallish rowcounts this isn't an issue
p10421
aVCan you clarify any of those points
p10422
aVI can add a lot more detail
p10423
aVAt the simplest, what is wrong with:
p10424
aV(the problems in the above might steer the right approach
p10425
as(dp10426
g18
V23354
p10427
stp10428
a((dp10429
g2
(lp10430
VIn
p10431
aVNET 3
p10432
aV5, there is , which provides a lot of functionality in this area; 2
p10433
aV0SP1 has , but this is much more limited
p10434
aVGetting  and adding a fixed offset is part of the job, but isn't DST-aware
p10435
aVSo in 3
p10436
aV5 I think you can do something like:
p10437
aVBut this simply doesn't exist in 2
p10438
aV0; sorry
p10439
as(dp10440
g18
V23354
p10441
stp10442
a((dp10443
g2
(lp10444
VYour definition ("struct has data, class has logic") of struct vs class is incorrect for
p10445
aVNET; structs can have logic perfectly well
p10446
aVStructs define a type with value-type semantics
p10447
aVClasses define a type with reference-type semantics
p10448
aVThat is the only (albeit major) difference
p10449
aVI wouldn't, no
p10450
aVStructs in
p10451
aVNET should generally be immutable; this would force you to update all the values at once
p10452
aVWith a mutable class, you can update individual properties / fields as you like
p10453
aVIn a CPU-intensive use-case designed around mutating objects, this could make a big difference
p10454
aVOf course, if you don't mutate state, it doesn't matter as much, but I might still be inclined to stick with a class:
p10455
aVWhen you pass a class instance around, all you pass is the reference; with a struct, you need to clone and pass around as much data as is in the struct
p10456
aVThis can make intensive work more intensive when using struct (unless you use  a lot)
p10457
aVRe "and return a class with written variables" - do you mean public fields
p10458
aVThis is not recommended
p10459
aVProperties are far preferable, for countless oft-repeated reasons
p10460
as(dp10461
g18
V23354
p10462
stp10463
a((dp10464
g2
(lp10465
VNow you can use
p10466
as(dp10467
g18
V23354
p10468
stp10469
a((dp10470
g2
(lp10471
VThe first options is to separate the two concerns:
p10472
aVone type to be the entity
p10473
aVone type to be the factory
p10474
aVThen you can create an interface for the factory, and use that (essentially like the previously static methods on the entity)
p10475
aVAnother options is to talk in delegates - i
p10476
ag50
aVa  (for some list type); then you can create a delegate trivially:
p10477
aVthen you can pass  around, and (later) use it as:
p10478
as(dp10479
g18
V23354
p10480
stp10481
a((dp10482
g2
(lp10483
VThe person could be in the view-data
p10484
aVI don't personally think that there is a huge issue with the view accessing instances of model types that the controller has already obtained, so personally I would let the view see the  directly
p10485
aVIt might be desirable to flatten the model into a view-model if there are lots of deep properties required, such as  to  in the view-model
p10486
aVIf you are dealing with a single object, another option is to place each value separately into the dictionary - but this is a bit messy
p10487
aVAnother option is an abuse of anonymous types; but don't do this
p10488
aVI won't even repeat the details here, it is that grotty; but here t'is
p10489
as(dp10490
g18
V23354
p10491
stp10492
a((dp10493
g2
(lp10494
VThere isn't a simple way to mechanically translate from SQL to LINQ; however, you could re-use your SQL, just using LINQ-to-SQL for the plumbing:
p10495
aVThis executes the TQSL from , using  and  to replace argument place-holders ({0}, {1} IIRC), and treats the result grid as a sequence of  instances (so you don't have to write parsing code)
p10496
aVThere is also:
p10497
aVfor when your sql doesn't return a result
p10498
aVAlternatively, create SPROCs from your SQL and consume those from either LINQ-to-SQL or Entity Framework
p10499
as(dp10500
g18
V23354
p10501
stp10502
a((dp10503
g2
(lp10504
VYes, that should work if the sequence is a sequence of  items; what problem are you having
p10505
aVNote that if  doesn't apply to any instance, it might be worth making it static
p10506
aVAnother option is to make the Score() method an instance method on a , or an extension method
p10507
aVNote that this only applies to LINQ-to-Objects; if you are using LINQ-to-SQL / LINQ-to-Entities, etc you either need to use a lambda for the whole thing, or (in LINQ-to-SQL only) use a UDF-mapped function (on the data-context) to calculate the value
p10508
aVExample (LINQ-to-Objects) with your original syntax:
p10509
aVAdd a  (i
p10510
ag50
aV), and you can use:
p10511
as(dp10512
g18
V23354
p10513
stp10514
a((dp10515
g2
(lp10516
VAFAIK, you can't do that directly; anything wrong with something like:
p10517
aVIf you have a lot of values, consider using a  (temp table) or  (table variable) - i
p10518
ag50
aVthen just / into
p10519
as(dp10520
g18
V23354
p10521
stp10522
a((dp10523
g2
(lp10524
VA static lock should do the job quickly and simply:
p10525
aVthen
p10526
aVYou can also use  (on a static method that accepts the instance as an argument - for example, an extension method), but an explicit lock is more versatile
p10527
as(dp10528
g18
V23354
p10529
stp10530
a((dp10531
g2
(lp10532
VReplaced by SP1:
p10533
aV\u201cRather than give it a new version
p10534
aVstring (and force existing users to
p10535
aVupgrade to a new version), we decided
p10536
aVto release the functionality using a
p10537
aVservice pack for the existing shipping
p10538
aVproduct
p10539
aVAll the functionality that
p10540
aVwas in previous Blend 2
p10541
aV5 builds is
p10542
aVnow included in SP1
p10543
aV\u201d
p10544
as(dp10545
g18
V23354
p10546
stp10547
a((dp10548
g2
(lp10549
VYou say it is an "object list"; rather than fixate on , how about the non-generic
p10550
aVThat should support arrays, lists, etc
p10551
aVRe the index-out-of-range; C# indexes are almost always zero-based, so if you have 9 items in the list, the last item is
p10552
aVIf you want to add an item,  is preferred:
p10553
as(dp10554
g18
V23354
p10555
stp10556
a((dp10557
g2
(lp10558
VI suspect that is a dead avenue
p10559
aVPerhaps try jetBrains dotTRACE; you can get a free 10 day trial to see if it is suitable
p10560
as(dp10561
g18
V23354
p10562
stp10563
a((dp10564
g2
(lp10565
VIt isn't clear what you want to pass and fail; in particular, the  demands 5 characters before the , so I'm not sure how "akeywordc" should match
p10566
aVThe  says "5 white-space or non-whitespace"
p10567
aVso again, that demands 5 characters after (and could probably be )
p10568
aVSo: how do you want it to behave
p10569
aVFor example,  will match 1-thru-5 characters before or after (greedily)
p10570
as(dp10571
g18
V23354
p10572
stp10573
a((dp10574
g2
(lp10575
VI suspect the most common values would be camelCased - i
p10576
ag50
aVIn particular, the spaces cause a few glitches if mixed with code-generators (i
p10577
ag50
aVto [de]serialize xml to objects), since not many languages allow enums with spaces (demanding a mapping between the two)
p10578
as(dp10579
g18
V23354
p10580
stp10581
a((dp10582
g2
(lp10583
VThoughts
p10584
aVYou haven't said how it is better
p10585
aV(or how it is better to a flat BLOB/database/file solution)
p10586
aVAlso, regular
p10587
aVNET (binary) serialization isn't well-suited to long-term storage (in a database), since it is implementation-specific (and tied to the assemblies)
p10588
aVFor serialization, you might want to look at platform-independent solutions such as Google's protocol buffers (which has implementations for C++, java, C#, and others- including one of my own)
p10589
as(dp10590
g18
V23354
p10591
stp10592
a((dp10593
g2
(lp10594
VYou would need to redirect both the input and output streams, using ; it is slightly trickier handling both, since you need to be careful that things aren't lost in the buffers (causing deadlock)
p10595
aVMSDN : Redirecting input
p10596
aVMSDN : Redirecting output
p10597
aVHere's a basic alternative example
p10598
aVYou might also want to look at OutputDataReceived for event-based responses
p10599
as(dp10600
g18
V23354
p10601
stp10602
a((dp10603
g2
(lp10604
VYou should be able to name the buttons and give them a value; then map this name as an argument to the action
p10605
aVAlternatively, use 2 separate action-links or 2 forms
p10606
as(dp10607
g18
V23354
p10608
stp10609
a((dp10610
g2
(lp10611
VIn addition to the other replies, many controls have a  method that you can use to reduce flickering when editing the contents - for example:
p10612
as(dp10613
g18
V23354
p10614
stp10615
a((dp10616
g2
(lp10617
VOne huge advantage is offline use
p10618
aVI write a fair amount of code on the train without mobile data - so having the js in my web project is very useful
p10619
aVIt also allows me to have complete control and confidence over change management
p10620
as(dp10621
g18
V23354
p10622
stp10623
a((dp10624
g2
(lp10625
VWinforms
p10626
aVWebforms
p10627
aVWhat
p10628
aVOne option is to (after initialization) hook the event your self - intellisense supplies the event name, and [Tab][Tab] creates the method stub - i
p10629
ag50
aVand it does the rest
p10630
aVlikewise in web-forms at the appropriate place
p10631
aVThis gives you:
p10632
as(dp10633
g18
V23354
p10634
stp10635
a((dp10636
g2
(lp10637
VI assume from  that this is LINQ-to-SQL / Entity Framework / similar (not LINQ-to-Objects);
p10638
aVGenerally, you do better with the conditional syntax ( a
p10639
aVb : c) - however, I don't know if it will work with your different queries like that (after all, how would your write the TSQL
p10640
aVFor a trivial example of the type of thing you can do:
p10641
aVYou can do much richer things, but I really doubt you can pick the table in the conditional
p10642
aVYou're welcome to try, of course
p10643
as(dp10644
g18
V23354
p10645
stp10646
a((dp10647
g2
(lp10648
VTry checking that the app
p10649
aVconfig (myapp
p10650
aVexe
p10651
aVconfig once deployed) file exists and has at the top (possibly with other bits)
p10652
as(dp10653
g18
V23354
p10654
stp10655
a((dp10656
g2
(lp10657
VI don't think you can get PropertyGrid to swap to asterisks, but you could perhaps use a one-way type-converter and a modal editor
p10658
aVlike so:
p10659
as(dp10660
g18
V23354
p10661
stp10662
a((dp10663
g2
(lp10664
VLINQ-to-SQL supports mapping lots of operations (including CRUD) to stored procedures, but you lose composability - i
p10665
ag50
aVyou can't just add
p10666
aVOne option there is table-valued functions (UDFs) in place of stored procedures that query data; this also presents a more rigid meta model (rather than , which is hit'n'miss)
p10667
aVThat way, your query methods are composable at the database; but note that Entity Framework does not support this, even though LINQ-to-SQL does
p10668
as(dp10669
g18
V23354
p10670
stp10671
a((dp10672
g2
(lp10673
VUpdated: nope, it looks like that is blocked (404); you'll have to keep them outside, it seems
p10674
aVThis makes sense, comparable to App_Code blocking, etc
p10675
aV(original answer)
p10676
aVHow are you referencing the css in your view/master page
p10677
aVAre you using "/views/foo
p10678
aVcss", "~/views/foo
p10679
aVcss", "foo
p10680
aVcss", or what
p10681
aVRecall that the browser will think that it is in "Some/Invented/Path", so your css resolution needs to be relative to that - "~/" (app-root) being the simplest
p10682
aVI'm just taking a look now
p10683
as(dp10684
g18
V23354
p10685
stp10686
a((dp10687
g2
(lp10688
VIf possible in this scenario, I would use  (
p10689
aVNET 3
p10690
aV0), and I would use something like:
p10691
aVthus side-stepping the issue
p10692
aVYou can do similar with , but you'd need to make  public (although you could decorate it with  - but this isn't ideal)
p10693
aVOf course, if you have multiple values on the struct
p10694
aVtrickier
p10695
aVYou can have multiple shim properties, of course, but that is a bit scrappy
p10696
aVBasically, [de]serialization and immutable objects (as structs should be) don't mix all that well
p10697
aVAnother option is to maintain a separate POCO version that uses mutable classes throughout, and translate between the two; again, not very attractive as an option for large object models
p10698
as(dp10699
g18
V23354
p10700
stp10701
a((dp10702
g2
(lp10703
VWell, you could use:
p10704
aVbut no, there is no direct conversion support
p10705
aVOobviously you'll need to add accessors, etc (don't make the fields public) - I'd guess:
p10706
aVOf course, the other option is to start with the data how you want it:
p10707
aVThere are also things you could do to map the data with reflection (perhaps using an  to compile and cache the strategy), but it probably isn't worth it
p10708
as(dp10709
g18
V23354
p10710
stp10711
a((dp10712
g2
(lp10713
V(edit - the answer here is very good for ; this pattern might be useful for other controls that lack the  or equivalent)
p10714
aVYou can use the  and  events to change the  fairly easily, for example:
p10715
as(dp10716
g18
V23354
p10717
stp10718
a((dp10719
g2
(lp10720
VWell, what is the data source
p10721
aVYour action could take a few defaulted arguments, i
p10722
ag50
aVdefaulted in the routes setup so that startIndex is 0 and pageSize is (say) 20:
p10723
aVTo split the feed, you can use LINQ quite easily:
p10724
aV(or do a multiplication if you use "pageNumber" rather than "startIndex")
p10725
aVWith LINQ-toSQL, EF, etc - this should "compose" down to the database, too
p10726
aVYou should then be able to use action-links to the next page (etc):
p10727
as(dp10728
g18
V23354
p10729
stp10730
a((dp10731
g2
(lp10732
VOrdered by which comment date
p10733
aVthe first
p10734
aVthe last
p10735
aVYou cuold try:
p10736
aVfor example
p10737
aVAlso - your  suggests you expect exactly one row, in which case there isn't much point sorting it
p10738
aVDo you mean
p10739
aVOr do you mean that you want to sort the
p10740
aVIn which case, get the  first;
p10741
aVNow
p10742
aVsorting the  is a little tricky because of your  - if you don't mind it being a little inefficient, this is simple:
p10743
aVOf course, if the  was , you could do:
p10744
aVThere are also tricks you can do to make an extension method of the form:
p10745
ag412
ag50
as(dp10746
g18
V23354
p10747
stp10748
a((dp10749
g2
(lp10750
VThat dictionary will be created anew each time; otherwise, for example, you could put other things into the dictionary, and the intent would be lost
p10751
as(dp10752
g18
V23354
p10753
stp10754
a((dp10755
g2
(lp10756
VOne option is serviced components - i
p10757
ag50
aVhost it in COM+ as the shell exe
p10758
aVSee also the howto here
p10759
as(dp10760
g18
V23354
p10761
stp10762
a((dp10763
g2
(lp10764
VReflection should provide what you want - in particular,
p10765
aVHowever, you might want to do this before the loop:
p10766
aVThis gives you a set of re-usable  instances that you can use per row:
p10767
aV(should that  be a , by the way
p10768
aVThat should be a bit more efficient than repeatedly finding each property
p10769
aVThere are other ways of doing this too (faster again)
p10770
as(dp10771
g18
V23354
p10772
stp10773
a((dp10774
g2
(lp10775
VWell, to answer the specific question: the last two are the only ones that are cached, since they don't capture anything
p10776
aVYou can see this in reflector (but it isn't pretty)
p10777
aVOf course, you can tweak them to make them re-usable by passing in args:
p10778
aVAnd pass  into /, and  into
p10779
aVBecause none of them directly capture anything any more, they can all be cached ( thru  for me, at least)
p10780
aVOf course, they then lose the ability to re-assign the (previously captured) variable directly, but FP advocates won't like that anyway ;-p You can always pass the updated value back as a return value, or declare a delegate type with  arguments (I don't recommend it, though)
p10781
as(dp10782
g18
V23354
p10783
stp10784
a((dp10785
g2
(lp10786
VWhy do you need to know if it is nullable
p10787
aVAnd do you mean "reference-type", or ""
p10788
aVEither way, with string values, the easiest option would be via the , which is more-easily (and more accurately) available on :
p10789
aVThis should use the correct converter, even if set per-property (rather than per-type)
p10790
aVFinally, if you are doing lots of this, this allows for acceleration via , without changing the code (other than to enable it for the type, done once only)
p10791
as(dp10792
g18
V23354
p10793
stp10794
a((dp10795
g2
(lp10796
VShort version: no
p10797
aVYou code simply perform two invokes; the runtime guarantees that those methods will execute (on a single thread, at least) in sequence
p10798
aVThe complexity of the article centred around the complexities of 2 threads accessing shared state (you need the  method for the example to make sense)
p10799
aVThe code you have pasted is, I'm pretty sure, not re-orderable - not least because this is successive instructions (on dependent data) on the same thread
p10800
aVYou'd need to get a lot deeper than I understand to go into the full details
p10801
aVBut unless you're doing something complex with lock-free, threaded programming, this is not likely to bite you
p10802
as(dp10803
g18
V23354
p10804
stp10805
a((dp10806
g2
(lp10807
VTry:
p10808
aVNote you can monitor what LINQ-to-SQL does quite easily:
p10809
as(dp10810
g18
V23354
p10811
stp10812
a((dp10813
g2
(lp10814
VMSDN: DataView
p10815
aVSort
p10816
aVMSDN: DataView
p10817
aVRowFilter
p10818
as(dp10819
g18
V23354
p10820
stp10821
a((dp10822
g2
(lp10823
VTry using:
p10824
aVIt needs to know which argument you mean (as in the more general case, you can have lots of parameters), which it can infer from the above
p10825
aVThe anonymous type pattern (above) is very cmomon in ASP
p10826
aVNET MVC, although in many cases
p10827
aVI believe you can also give it a populated dictionary to mean the same
p10828
aVAlso - there is no need for two actions in this case; you can set up your routes to supply default values; here's some I posted earlier:
p10829
aVwith routes:
p10830
aVNow if I don't supply a startIndex, it passes 0 to my Search by default
p10831
aVSo I can navigate to "/Foo" for a default search, or "/Foo/100" to do the same search starting at 100
p10832
aVAlternatively, the args can be on the query string, and will still get defaulted using the values from the anon-type
p10833
as(dp10834
g18
V23354
p10835
stp10836
a((dp10837
g2
(lp10838
VYou may well be able to use jquery to perform local DHTML manipulation, but AFAIK, jQuery and ASP
p10839
aVNET (regular) don't make good bed-mates
p10840
aVHowever, jQuery and ASP
p10841
aVNET MVC work very tidily together
p10842
aVThe viewstate etc in regular ASP
p10843
aVNET makes it a bit messy, and I'd stick with the MS offering for talking to the server with regular ASP
p10844
aVNET
p10845
as(dp10846
g18
V23354
p10847
stp10848
a((dp10849
g2
(lp10850
VWouldn't an abstract method / property in the base-class be more suitable
p10851
aVVia attributes, like so:
p10852
as(dp10853
g18
V23354
p10854
stp10855
a((dp10856
g2
(lp10857
VWhat are the main problems you are having at the moment
p10858
aVThe big thing to remember is to think in terms of streams - i
p10859
ag50
aVkeep the minimum amount of data in memory that you can
p10860
aVLINQ is excellent at working with sequences (although there are some buffering operations you need to avoid, such as OrderBy)
p10861
aVFor example, here's a way of handling simple records from a large file efficiently (note the iterator block)
p10862
aVFor performing multiple aggregates/analysis over large data from files, consider Push LINQ in MiscUtil
p10863
aVCan you add more context to the problems you are thinking of
p10864
as(dp10865
g18
V23354
p10866
stp10867
a((dp10868
g2
(lp10869
VThere isn't direct support for , but you can simulate it from an  (i
p10870
ag50
aVwhat  returns); I'm afraid I only "do" C#, so you'll have to translate to VB
p10871
aVHere's a Northwind example:
p10872
aVThe TSQL isn't quite what we'd like, but it does the job:
p10873
aVThe results, however, are correct- verifyable by running it manually:
p10874
aVWith definition:
p10875
as(dp10876
g18
V23354
p10877
stp10878
a((dp10879
g2
(lp10880
VHow are you doing the bulk insert
p10881
aVUsually, the problem (in this scenario) is whether "c:\u005c" is the server's "c:\u005c", or the client's "c:\u005c"
p10882
aVHowever
p10883
aVfrom C# code, the simplest approach is to use
p10884
aVThis class provides direct access to bulk-insert functionality from managed code, including mappings (although I never bother with them)
p10885
aVIf the file is something like csv / tsv / similar, then CsvReader is highly recommended
p10886
aVThis provides the  interface that  uses most efficiently
p10887
as(dp10888
g18
V23354
p10889
stp10890
a((dp10891
g2
(lp10892
VIn all cases, there is no performance difference with/without the  - the compiler still does it implicitly, injecting a  into the IL
p10893
aVJust for completeness, there is one other mandatory use of  (excluding disambiguation, -chaining, and passing  to other methods): extension methods
p10894
aVTo call an extension method on the current instance, you must qualify with  (even though for a regular method it would be implicit)
p10895
aVOf course, in most cases, you would simply add a regular instance method to the class or a base-class
p10896
as(dp10897
g18
V23354
p10898
stp10899
a((dp10900
g2
(lp10901
VEach EF object is tightly associated to the manager (for want of a better word) that created it
p10902
aVor to which it has been associated
p10903
aVSince you don't pass  to your  method, I assume that  has either used it's own , or the object has been created standalone (perhaps deserialized)
p10904
aVIn order to delete it, it must know about it first
p10905
aVThat might mean by attaching an object to the manager - but in this case, it seems like an easier option is just to pass  into , so that the  is done in the same context (since  will automatically attach objects that it creates itself)
p10906
as(dp10907
g18
V23354
p10908
stp10909
a((dp10910
g2
(lp10911
V"Parallel Extensions" is designed for this, in particular the  class (which allows you to split work up between the threads very easily)
p10912
aVThe aggregation of results is trickier; some quick searching shows some mixed results  - but I don't know what will be in the final release (i
p10913
ag50
aVit could be easier)
p10914
aVThe CTP is  available here, or wait for
p10915
aVNET 4
p10916
ag190
as(dp10917
g18
V23354
p10918
stp10919
a((dp10920
g2
(lp10921
VThere is a reasonable discussion document on this topic here, which covers a range of templating tools
p10922
aVNot specific to jQuery, though
p10923
as(dp10924
g18
V23354
p10925
stp10926
a((dp10927
g2
(lp10928
Vedit after I posted this, the question was edited to qualify as C++; I'm going to leave this answer here for reference only
p10929
aVwhat sort off coding goes into application":
p10930
aVThat depends hugely on the platform and language
p10931
aVFor example, here are examples for Windows via C#/
p10932
aVNET or VB/
p10933
aVNET
p10934
aVFor C++, Delphi, etc - the tricks will be different
p10935
as(dp10936
g18
V23354
p10937
stp10938
a((dp10939
g2
(lp10940
VThere is a use for singletons (and similar) in languages that don't allow static interface members - such as in
p10941
aVNET
p10942
aVBy providing a singleton, you have an instance that can provide the interface as an instance
p10943
aVSo in
p10944
aVNET, examples might be:
p10945
aV- provides an  implementation for sorting
p10946
aV- provides an  implementation for hashing/equality-testing
p10947
aVThis is as a means-to-an-end; it isn't what we are trying to do, just a reasonable "how"
p10948
aVIn terms of the "identity map" example, personally I would rather keep that on an instance, and make the instance available to all my code
p10949
aVApart from anything else, it aids testability if you can discard the map between tests, or have the flexibility (later) to have multiple identity maps at the same time
p10950
as(dp10951
g18
V23354
p10952
stp10953
a((dp10954
g2
(lp10955
VThe choice of view is defined by the controller
p10956
aVWhat does the home controller do for the Index action
p10957
aVIf this is the vanilla site generated by the system, then it is expecting to find "~/Views/Home/Index
p10958
aVaspx", via the controller's action (below)
p10959
aVSo: does this index page exist
p10960
aV(the default view has the pattern {controller}/{action}; you can specify other views via overloads on )
p10961
as(dp10962
g18
V23354
p10963
stp10964
a((dp10965
g2
(lp10966
VProbably lost to the depths of time, and an artifact of different teams working on different designers
p10967
aVThis next note doesn't apply to the original days, but one interesting point in the current incarnation of ASP
p10968
aVNET is that the page inherits from the code-behind, so the proper-case names would make sense if they were exposed as protected properties
p10969
aVBut they aren't: they are exposed as protected fields
p10970
aVso that is 2 standard guidelines broken at once (non-private fields and casing of fields)
p10971
as(dp10972
g18
V23354
p10973
stp10974
a((dp10975
g2
(lp10976
VIf you are writing individual files, then you could just treat it as a stream and use the inbuilt  /  (although in some tests I did, #ZipLib out-performed the MS offering for both ratio and speed)
p10977
aVOr there is inbuilt zip support somewhere in the framework
p10978
aVI don't know about LZMA, though
p10979
as(dp10980
g18
V23354
p10981
stp10982
a((dp10983
g2
(lp10984
V(note - pre-dates edit re external 1
p10985
aV0 dlls)
p10986
aVAre you using any external dlls
p10987
aVPerhaps some 3rd-party xna dll that is referencing the 1
p10988
aV0 version
p10989
aVIf this gets discovered first, all bets may be off
p10990
aVTry looking at any external dlls in reflector, so see what version they reference
p10991
aVYou could also try adding a version policy for the xna dll
p10992
as(dp10993
g18
V23354
p10994
stp10995
a((dp10996
g2
(lp10997
V is the binary And operator; you mean , i
p10998
ag50
aVHowever, I suspect you are doing this the hard way
p10999
aVIt is easier to use things like:
p11000
aVFor example:
p11001
as(dp11002
g18
V23354
p11003
stp11004
a((dp11005
g2
(lp11006
VIt depends how close your code is to the nuts'n'bolts; for example, you could work in s instead, and pass a  to the code (and check the contents)
p11007
aVYou could just write to the file-system (in the temp area), check the contents and ditch it afterwards
p11008
aVOf if your code is a bit above the file system, you could write a mockable  interface with the high-level methods you need (like  / )
p11009
aVIt would be a pain to mock the streaming APIs, though
p11010
aVFor downloading from the internet (or pretending to)
p11011
aVyou could (for example) write an  interface with the functions you need (like , etc); mock it to return fixed content, and use something like  as the basis for an actual implementation
p11012
aVOf course, you'll need to test the actual implementation against real sites
p11013
as(dp11014
g18
V23354
p11015
stp11016
a((dp11017
g2
(lp11018
VWith MVC, jQuery would be the first choice (IMO)
p11019
aVThis has intellisense in VS2008, and is very widely used, so easy to get samples, and fairly well documented
p11020
aVYou might also be interested in:
p11021
aVjQuery in Action
p11022
aVASP
p11023
aVNET MVC in Action
p11024
as(dp11025
g18
V23354
p11026
stp11027
a((dp11028
g2
(lp11029
VWell, what architecture are you using
p11030
aVwinforms
p11031
aVasp
p11032
aVnet
p11033
aVwpf
p11034
aVThe high level is that if you have objects such as:
p11035
aVThen you can get the binding framework to do all the hard work, and you just say what you want bound - for example (winforms):
p11036
aVThis sets the textbox's Text property based on the person's Name, and can update the person's Name when the user changes the text
p11037
aVMulti-record binding is more complex, and is based on  in winforms/wpf, and  in ASP
p11038
aVNET; this allows you to bind multiple records (for example into a grid)
p11039
aVIf the list offers extra features (sorting, filtering etc, via , , etc), then more functionality might be available
p11040
aVBinding also allows "observer" usage - i
p11041
ag50
aVchange notification: if you indirectly change the person's Name, then the textbox gets automatically updated
p11042
aVThis relies on events - either of the form , or (more commonly now) via the  event (allowing one event to notify for multiple properties)
p11043
aVSome lists (such as , ) have similar notification loops
p11044
as(dp11045
g18
V23354
p11046
stp11047
a((dp11048
g2
(lp11049
VFirst - I've added  to this, as I believe it is important
p11050
aVSecond, note that providers are an alternative here:
p11051
aVIf you must go generic, how about:
p11052
as(dp11053
g18
V23354
p11054
stp11055
a((dp11056
g2
(lp11057
VThe  just makes it absolutely clear that you know you are stomping over an existing method
p11058
aVSince the existing code was , it isn't as big a deal - you can safely add the  to stop it moaning
p11059
aVThe difference comes when your method does something different; any variable that references the derived class and calls  would do something different (even with the same object) as one that references the base class and calls :
p11060
aVThis could obviously have an impact on any existing code that knows about  and calls  - i
p11061
ag50
aVit is now running a completely different method
p11062
aVAlso, note that you could mark it , and use  to provide access to your unit test (this is the most common use of ; then your unit-tests can access it directly without the derived class
p11063
as(dp11064
g18
V23354
p11065
stp11066
a((dp11067
g2
(lp11068
VThe best fix is to simplify things
p11069
aVfor example, is that utility code data utility code, or ui utility code
p11070
aVPerhaps split it into 2 dlls; that might make things simpler
p11071
aVAfter that, interfaces are a reasonable option, but you might need some IoC framework to provide the implementations
p11072
aVIoC is the most common way of getting around this type of problem
p11073
aVFor example, you declare your  in a reference assembly; everything references that
p11074
aVYour DAL implements the interface, but the utils project no longer needs to reference the DAL - just the interface assembly
p11075
aVYour DAL can now reference the utils - or it might just know about another interface  (better to split it up more meaningfully, of course)
p11076
aVThe glue here is the IoC container, such as Castle Windsor
p11077
aVFinally, and don't do this, but even though the IDE doesn't let you, it is possible to create circular references in
p11078
aVNET (via the command line tools); it is legal, but it gets very messy very quickly, and it is hard to repair a broken build
p11079
aVDon't go there
p11080
as(dp11081
g18
V23354
p11082
stp11083
a((dp11084
g2
(lp11085
VNot directly from the iterator block, no
p11086
aVHowever, the caller can always buffer the results, for example into a , or just call  - but this doesn't always apply
p11087
as(dp11088
g18
V23354
p11089
stp11090
a((dp11091
g2
(lp11092
VYou should be able to use  to rig a crude test - set a flag when the event is fired (you'll probably have to clear the flag once binding has completed)
p11093
aVBut what is the data
p11094
aVFor example, LINQ-to-SQL and DataTable both offer ways of querying for changes
p11095
aV( and )
p11096
aVMost DAL-based mechanisms will usually have a way to do this too
p11097
as(dp11098
g18
V23354
p11099
stp11100
a((dp11101
g2
(lp11102
VWell, there is no inbuilt  extension method on enumerable
p11103
aVI wonder if a simple  loop might not be easier
p11104
aVIt is trivial to write, though
p11105
aVAt a push, maybe you could usefully use  here:
p11106
aVBut personally, I'd just use a simple loop:
p11107
as(dp11108
g18
V23354
p11109
stp11110
a((dp11111
g2
(lp11112
Vedit this answer was before edit; for an answer to the updated problem, see this reply
p11113
aVWhy use LINQ
p11114
aVThere is a constructor for this:
p11115
aVYou could add a  - but I wouldn't bother
p11116
as(dp11117
g18
V23354
p11118
stp11119
a((dp11120
g2
(lp11121
VThat is a known difficult area
p11122
aVSome systems try this by executing the stored procedure with  enabled, but that has a range of problems (i
p11123
ag50
aVit will still execute some code, which can be bad)
p11124
aVIt is also notoriously hard to get the schema for non-trivial queries (for example, where different branches do different selects)
p11125
aVIf you know that the procedures are side-effect-free, and don't  in branches, then try the  trick - but at least understand the possible impact
p11126
aVFor queries, in some ways table-valued-functions (UDFs) can be more practical, since the schema is formalised
p11127
as(dp11128
g18
V23354
p11129
stp11130
a((dp11131
g2
(lp11132
VHow have you referenced the images
p11133
aVThey should start "~/" to mean "app root" ("/" is "site root") - i
p11134
ag50
aV"/Content/images/myimage
p11135
aVpng"
p11136
aVHowever, some controls will send this to the client without substituting the virtual path; for a related thread (talking about js, but the concept is the same), see here (includes a simple solution / example approach)
p11137
aVAlso - is the virtual an app
p11138
aVcog icon
p11139
aVConsider a  tag in the master page (to the app root)
p11140
as(dp11141
g18
V23354
p11142
stp11143
a((dp11144
g2
(lp11145
VI'm pretty sure that you cannot do this
p11146
aVClickOnce is designed for side-effect free deployments, and don't impact registry (except perhaps for file associations) or "Program Files" (having their own repository)
p11147
aVI'm pretty sure you'll need msi for this
p11148
as(dp11149
g18
V23354
p11150
stp11151
a((dp11152
g2
(lp11153
V is only useful if you also use ; the  modifier is easier to use, but I wonder if it wouldn't be simpler to use synchronization - perhaps a  (since it sounds like you have lots of readers)
p11154
aVsimply performs the get and set as an atomic operation; it doesn't (AFAIK) make any volatility claims (indeed, the compiler even tells you that a  field won't be treated as  when used as a  argument)
p11155
aVEdit to clarify "it doesn't (AFAIK) make any volatility claims" - the behaviour of  is predictable, and you should see updates immediately on other thread as long as they also use ; my point is that if one thread uses , and another relies on  (to talk to the same field), I don't know of any guarantees
p11156
aVStick to one or the other for all access
p11157
as(dp11158
g18
V23354
p11159
stp11160
a((dp11161
g2
(lp11162
VWelbog has answered it well - but just to note you appear to be doing a cartesion (cross) join - is that intentional
p11163
aVIf you are trying to do a regular join (with a predicate etc), then you want want to look into  - i
p11164
ag50
aVdeclare a key:
p11165
aVthen consume in your predicate:
p11166
aVThis should be equivalent to (but much faster than) the predicate:
p11167
aVIf you are grouping the data, then look at Muenchian grouping
p11168
as(dp11169
g18
V23354
p11170
stp11171
a((dp11172
g2
(lp11173
VIf you can reproduce it, it would be worth sending it as feedback (do you have the "send feedback" links on every window like I do
p11174
aVI could give it a try, but I've already installed Team Suite on my physical Windows 7 machine, so I'd need to sort out a fresh VM to give it a go
p11175
aVActually, though - it probably isn't a good idea to activate your upgrade (for real) on the beta Windows 7; at some point, you are going to have to scratch that OS completely
p11176
aVI agree that if the option is meant to be there, then it's absense is a problem
p11177
aVBut I haven't used "trial" before, so I don't know if it is meant to exist
p11178
as(dp11179
g18
V23354
p11180
stp11181
a((dp11182
g2
(lp11183
VWinforms controls don't serialize especially well, and you might have a lot of difficulty getting the base-classes (i
p11184
ag50
aVnot your code) to play ball
p11185
aVThings like , for example, regularly provide surprisingly troublesome to serialize
p11186
aVXml would be an obvious (if somewhat predictable) choice, but you generally need to nominate sub-classes ahead of time
p11187
aVAnd of course, the base-classes won't be marked serializable
p11188
aVwould avoid some of that, but as a field-based serializer, you'd have problems with the "handles" etc in the base-classes, which are meaningless serialized
p11189
aVI'm not saying it can't be done - but it won't be trivial either
p11190
aVAs a starter, you'd want to look at , and use the  of each to get the value as an invariant string
p11191
as(dp11192
g18
V23354
p11193
stp11194
a((dp11195
g2
(lp11196
VIt doesn't matter whether you use a database id or a "natural key" - the security issue is the same: you need a way to uniquely identify a record, and that knowledge can potentially be abused
p11197
aVThe main advantage of a natural key would be if you need to store the record mid-to-long term disconnected from the system, or transfer the record between parallel systems (where a primary key ceases to be useful) - but that doesn't seem to be the issue here
p11198
aVIf security is a major concern, you could issue transient keys (perhaps guids) for objects that only exist for a client's session - re-map them back at the server
p11199
aVHowever, this would be quiet painful in practice
p11200
aVOf course, you could use Guids as the primary key (): another advantage of guid-based keys is that (if generated randomly) they don't let you use the "key+1, key+2" approach to data querying
p11201
aVEither way, you should validate that the client is allowed to [create/read/update/delete as appropriate] the record they are attempting to manipulate
p11202
as(dp11203
g18
V23354
p11204
stp11205
a((dp11206
g2
(lp11207
VPersonally, I wouldn't use LINQ / extension methods in this scenario; LINQ is a powerful tool, but it shouldn't be used for every problem
p11208
aVThe existing LINQ extension methods using  and  etc will, by definition, add some overhead to your scenario
p11209
aVThe question is: is it significant to your  scenario
p11210
aVFor example, if you are about to do a network transmit of the data, a few picoseconds here won't matter
p11211
aVBut if you are precessing xml in a tight loop, it might
p11212
aVA better fix would be to encode it directly with framework code
p11213
aVI'll see if I can find the easiest option for this
p11214
aVNote: another micro-optimisation here would be to pre-init the  with the length of the existing string
p11215
as(dp11216
g18
V23354
p11217
stp11218
a((dp11219
g2
(lp11220
VVery easy to measure
p11221
aVIn a small number of tight-loop processing code where I know the length is fixed I use arrays for that extra tiny bit of micro-optimisation; arrays can be marginally faster if you use the indexer / for form - but IIRC believe it depends on the type of data in the array
p11222
aVBut unless you need to micro-optimise, keep it simple and use  etc
p11223
aVOf course, this only applies if you are reading all of the data; a dictionary would be quicker for key-based lookups
p11224
aVHere's my results using "int" (the second number is a checksum to verify they all did the same work):
p11225
aV(edited to fix bug)
p11226
aVbased on the test rig:
p11227
as(dp11228
g18
V23354
p11229
stp11230
a((dp11231
g2
(lp11232
VFor parsing the xml - how about using  to deserialize an object graph
p11233
aVDoes it need to return xml
p11234
aVHow about returning regular grids, that you can read over directly
p11235
aVFor example, one option is to use ORM such as a LINQ-to-SQL  - then you can just execute the generated method which gives you the data as objects
p11236
aVAlternatively - perhaps render the xml via an xsl transform
p11237
as(dp11238
g18
V23354
p11239
stp11240
a((dp11241
g2
(lp11242
VYou can do crash dumps with
p11243
aVNET, and look at them with windbg / sos (and sosassist)
p11244
aVNot simple, but it works
p11245
aVBut fairly hardcore
p11246
aVSearches on "+windbg +
p11247
aVNET" should prove interesting
p11248
aVOther than that - resource counters
p11249
aVlog files
p11250
aVLots of things you might look at that can be enabled fairly easily
p11251
as(dp11252
g18
V23354
p11253
stp11254
a((dp11255
g2
(lp11256
VIf you are looking at AJAX, then rather than vanilla ASP
p11257
aVNET, I'd look at ASP
p11258
aVNET MVC; this is a much cleaner model (more logical too, IMO) - and it plays very well with jQuery for the ajax, since you have much more control over both the html and the paths
p11259
aVAlso, jQuery now has intellisense in VS20008, making it even more inviting
p11260
aVI can't comment on PHP - but the ASP
p11261
aVNET MVC is at least in roughly familiar territory
p11262
aVBut note that ASP
p11263
aVNET (including MVC) is a lot more than just a straight upgrade to ASP
p11264
as(dp11265
g18
V23354
p11266
stp11267
a((dp11268
g2
(lp11269
VIf  can be null, then either exclude it first, or use / - otherwise a single  will break the entire sequence
p11270
aVIt is more efficient to exclude it with a :
p11271
as(dp11272
g18
V23354
p11273
stp11274
a((dp11275
g2
(lp11276
VProbably the best way of doing this would be with logging tools on your web server
p11277
aVLog downloads to the
p11278
aVapplication etc (or maybe the actual dll/exe files, since the
p11279
aVapplication might get proped for auto-update checks)
p11280
aVPerhaps via an http-module, but any web-server logging tool should suffice
p11281
aVYou can approximately deduce location from the IP (but you'd need to find your own provider)
p11282
aVHowever, ClickOnce is passive - there is no way to inject extra code into it
p11283
aVYou could perhaps run some code on first run, but
p11284
as(dp11285
g18
V23354
p11286
stp11287
a((dp11288
g2
(lp11289
VHow about "Class to transform ofx (Microsoft Money) file into DataSet"
p11290
aVNote I'm not hugely familiar with OFX - that is just a quick search result
p11291
as(dp11292
g18
V23354
p11293
stp11294
a((dp11295
g2
(lp11296
VI don't know if you can override the deserialization process with MVC, but note that  supports non-public accessors, and there is a JSON version:  - maybe worth a look
p11297
aVPersonally, though, I'd just accept the public setter in this case
p11298
aVthis is a pretty common feature of
p11299
aVNET DTOs and
p11300
aVNET-based serializations
p11301
aVThe immutable/factory pattern, while common in java, hasn't really taken as much hold in
p11302
aVNET; I can't say I mind overly
p11303
as(dp11304
g18
V23354
p11305
stp11306
a((dp11307
g2
(lp11308
VIn a Where expression, you are looking at an  - which means that  the outermost lambda should have a single  with type
p11309
aVIf a comparison relates to the row, it will have (as an ancestor) this ; if it is local variable, it will have (as an ancestor) a  - however, the type of this constant expression will be compiler generated to cope with all of the captured variables used in the expression
p11310
aVLike so:
p11311
as(dp11312
g18
V23354
p11313
stp11314
a((dp11315
g2
(lp11316
VFirst, note that one big difference in your example (between  and ) is that  guarantees to call  on the iterator if the iterator is
p11317
aVThis is important for many iterators (which might be consuming an external data feed, for example)
p11318
aVActually, there are cases where  isn't as helpful as we'd like
p11319
aVFirst, there is the "first item" case discussed here (foreach  / detecting first iteration)
p11320
aVBut more; if you try writing the missing  method for stitching two enumerable sequences together (or the  method), you find that you can' use  on both sequences, since that would perform a cross-join
p11321
aVYou need to use the iterator directly for one of them:
p11322
as(dp11323
g18
V23354
p11324
stp11325
a((dp11326
g2
(lp11327
VReleasing any additional references during  is certainly something I try to do, for two reasons:
p11328
aVit allows the inner objects to be garbage collected even if the disposed object is still in scope
p11329
aVif the inner objects are disposable, it means we only dispose them once even if  is called repeatedly on the outer object
p11330
aVFor example, I tend to use things like:
p11331
aVYou might also want to set any events to null:
p11332
aVThis can help minimise the impact if the caller can't fully release their reference (or simply forgets) at the moment
p11333
aVWhile you should try to release the outer object (for GC), it is relatively easy to accidentally extend the life of the object, for example via a captured variable (anonymous method/lambda), an event, etc
p11334
aVIf you have a finalizer, then during the GC process there is no benefit doing this, and you shouldn't really call methods on external objects (even ) - so in short: don't do any of this during a GC sweep
p11335
as(dp11336
g18
V23354
p11337
stp11338
a((dp11339
g2
(lp11340
VAs you say, constructors are not inherited
p11341
aVForcing the derived class to supply the details in the constructor would be the ideal case if you need to know the values during construction
p11342
aVIf you don't, consider an abstract property that the derived class must provide:
p11343
aVNote that unless you document it very clearly (and understand the implications) you shouldn't call a virtual method (such as the above) inside the constructor (since the derived type's constructor hasn't executed yet) - but it is fine after that
p11344
aVSince the file-name isn't really dependent on the sub-type, I suspect I would leave that as a ctor parameter either way
p11345
as(dp11346
g18
V23354
p11347
stp11348
a((dp11349
g2
(lp11350
VThis is a known nuisance; you simply can't add metadata to the generated members
p11351
aVThere are 6 options here (in order of increasing effort):
p11352
aVif you own the attribute, make it possible to declare it against the class, for example:  - then add multiple attributes to the partial class definition
p11353
aVuse a virtual / interface / etc method to query this, rather than via attributes
p11354
aVsublass the generated type; override or re-declare the member, adding the metadata (really messy)
p11355
aVuse a custom  to provide dynamic metadata (lots and lots of work) - assuming that the consumer respects ; most binding-related consumers do, but for example,  (used by many LINQ providers) doesn't
p11356
aVchange the code-generator / write your own
p11357
aVtry to extend something like PostSharp to do the work (I haven't found a way to do this, but I've love to hear if you find a way
p11358
aVI usually have success with the first option, unless it is a system-defined attribute (, etc)
p11359
aVIf  is defined by dynamic data, then you might not be able to do this
p11360
as(dp11361
g18
V23354
p11362
stp11363
a((dp11364
g2
(lp11365
VThere is no way that the server can possibly read from the client's clipboard
p11366
aVSo if you mean what the user has in their clipboard (at the server): it can't be done
p11367
aVYou might be able to do some things with javascript, but then ASP
p11368
aVNET becomes largely irrelevant as a detail
p11369
aVAlternatively, put it this way: have you ever seen this done
p11370
aVNormally, to get a web-site to do something with non-text data, you need to use a file/upload control (Browse
p11371
aVto send the data to the server
p11372
aVYou might want to investigate this option
p11373
aVIf you need more power at the client, consider Silverlight, Flash, ClickOnce, etc (but try to avoid OCX - that is a dead technology)
p11374
as(dp11375
g18
V23354
p11376
stp11377
a((dp11378
g2
(lp11379
VWell, you're going to end up using ADO
p11380
aVNET either way
p11381
aVit sounds like you mean stored procedures vs command-text
p11382
aVThere are advantages of both, unfortunately, so it isn't a simple question, however, if you are looking at tools like LINQ, there are more advantages to command-text, since it can be more "composable" (i
p11383
ag50
aVthe caller can add /// and have it impact the overall query)
p11384
aVAnother option that mixes the benefits of both is table-valued-functions (via UDFs) - they also have the advantage of stronger metadata (it is hard to accurately query the schema of a stored-procedure)
p11385
aVAny approach should be injection-safe as long as you correctly use parameters
p11386
as(dp11387
g18
V23354
p11388
stp11389
a((dp11390
g2
(lp11391
VI would expect that to simply not work; the  is deferred, so no data has been consumed at this point
p11392
aVHowever, since you have disposed the data-context (before leaving ), it will never be able to get data
p11393
aVA better option is to pass the data-context into the method, so that the consumer can choose the lifetime
p11394
aVAlso, I would recommend returning  so that the consumer can "compose" the result (i
p11395
ag50
aVadd  /  /  /  etc, and have it impact the final query):
p11396
aVUpdate: if you (comments) don't want to defer execution (i
p11397
ag50
aVyou don't want the caller dealing with the data-context), then you need to evaluate the results
p11398
aVYou can do this by calling  or  on the result to buffer the values
p11399
aVIf you want to keep it deferred in this case, then you need to use an "iterator block":
p11400
aVThis is now deferred without passing the data-context around
p11401
as(dp11402
g18
V23354
p11403
stp11404
a((dp11405
g2
(lp11406
VIs the accelerator set on the user's (IE) proxy setting, the machines (WinHTTP) proxy setting, or both
p11407
aVIf IE, you might like to try using  to import the IE settings into WinHTTP (since I believe this is what  (and
p11408
aVNET generally) uses)
p11409
as(dp11410
g18
V23354
p11411
stp11412
a((dp11413
g2
(lp11414
VThe easiest way to handle this is to treat the  as your unit of work
p11415
aVPerform an atomic set of related operations on a single , then after either success or failure,  it (ideally via ) and throw it away
p11416
aVStart you next set of operations on a new
p11417
aVLikewise, you can re-query for data
p11418
aVOn an object-by-object basis, you can use  (on the table) to get the original values, but you'd need to re-apply to a "live" object, and this doesn't handle the delete/insert cases
p11419
as(dp11420
g18
V23354
p11421
stp11422
a((dp11423
g2
(lp11424
VWell, this adds confusion for little purpose - you could just as easily write:
p11425
aVor (simpler)
p11426
aVor (simplest)
p11427
aVIn all of the above, I don't have to squint and think about any edge-cases; it is pretty clear what happens when
p11428
aVIf you are modifying the loop index, you can quickly make it quite hard to understand at a glance
p11429
as(dp11430
g18
V23354
p11431
stp11432
a((dp11433
g2
(lp11434
VNo, there is no namespace-specific modifier
p11435
aVOne option would be to use inheritance and a "protected" modifier, but having an internal constructor on the base-class so that external code can't subclass it
p11436
aVThat might help
p11437
as(dp11438
g18
V23354
p11439
stp11440
a((dp11441
g2
(lp11442
VInteresting
p11443
aVfor info, I tried it with the attribute-based approach (below), and it behaves the same
p11444
aVvery curious
p11445
aVI can't explain it - I'm just replying to confirm reproduced, and to mention the  behaviour:
p11446
aVEdit - found "connect" issue here
p11447
aVTry adding to your callback:
p11448
as(dp11449
g18
V23354
p11450
stp11451
a((dp11452
g2
(lp11453
VHow about:
p11454
aVNot sure it is much clearer like this, though
p11455
aVpersonally I think I might just use the original  version
p11456
aVmaybe splitting out the  bit:
p11457
as(dp11458
g18
V23354
p11459
stp11460
a((dp11461
g2
(lp11462
VWell, you can use  /  etc to combine logical expressions, but the problem is the parameters; are you working with the same  in expr1 and expr2
p11463
aVIf so, it is easier:
p11464
aVThis also works well to negate a single operation:
p11465
aVOtherwise, depending on the LINQ provider, you might be able to combine them with :
p11466
aVSomewhere, I have got some code that re-writes an expression-tree replacing nodes to remove the need for , but it is quite lengthy (and I can't remember where I left it
p11467
aVGeneralized version that picks the simplest route:
p11468
aVStarting from
p11469
aVnet 4
p11470
ag190
aVThere is the ExpressionVistor class which allows you to build expressions that are EF safe
p11471
as(dp11472
g18
V23354
p11473
stp11474
a((dp11475
g2
(lp11476
VWhat type of  do you mean
p11477
aVThe raw file-stream data
p11478
aVIn which case, how about something like (using  in a client application):
p11479
aVOr use  with a  if you really do have a :
p11480
as(dp11481
g18
V23354
p11482
stp11483
a((dp11484
g2
(lp11485
VYou are going to have to concatenate the table name directly into the string, as this cannot be parameterized:
p11486
aVTo prevent injection attacks, you should white-list this table name
p11487
aVThis also isn't robust if the table has other non-nullable columns, etc
p11488
aVnote: Personally, though, I don't think this is a good use of TSQL; it might be more appropriate to construct the command in the client (C# or whatever), and execute it as a parameterized command
p11489
aVThere are use-cases for dynamic-SQL, but I'm not sure this is a good example of one
p11490
aVBetter yet, use your preferred ORM tool (LINQ-to-SQL, NHibernate, LLBLGen, Entity Framework, etc) to do all this for you, and concentrate on your actual problem domain
p11491
as(dp11492
g18
V23354
p11493
stp11494
a((dp11495
g2
(lp11496
VWriting robust threaded code is not trivial
p11497
aVThere are numerous thread-pools around that you might look at for reference, but also note that Parallel Extensions (available as CTP, or later in
p11498
aVNET 4
p11499
aV0) includes a lot of additional threading constructs out-of-the-box (in the TPL/CCR)
p11500
aVFor example,  / , which deal with work-stealing, and handling the available cores effectively
p11501
aVFor an example of a pre-rolled thread-pool, see Jon Skeet's  here
p11502
as(dp11503
g18
V23354
p11504
stp11505
a((dp11506
g2
(lp11507
VWell, it could be something like:
p11508
aVHowever, you will perhaps have to clarify how to get a task-type
p11509
aVYou should be able to consume this either as an , or using
p11510
as(dp11511
g18
V23354
p11512
stp11513
a((dp11514
g2
(lp11515
VGeneral certificate issues:
p11516
aVcertificate not issued by a trusted certificate provider (must be in your trust chain)
p11517
aVcertificate expired
p11518
aVThis specific error usually means that the certificate isn't issued for the site you are hitting
p11519
aVExamples:
p11520
aVdifference between "www
p11521
aVyoursite
p11522
aVcom" and "yoursite
p11523
aVcom" (they are different; some big names get this wrong, which really annoys me
p11524
aVaccessing as an IP address instead of the name on the cert; or v/v
p11525
aVa load balancer redirecting you to "server1,yoursite
p11526
aVcom" but giving you the cert from "yoursite
p11527
aVcom"
p11528
aVa load balancer silently passing you to "server1", which is issuing certificates for "server1", not the site
p11529
aV(edit see comments) a wildcard certificate issued for multiple levels - i
p11530
ag50
aVissued to *
p11531
aVsomesite
p11532
aVorg, when you are hitting foo
p11533
aVbar
p11534
aVsomesite
p11535
aVorg
p11536
aVMost of these are readily identifiable by navigating to the site and reading the warnings that your browser gives you, and inspecting the certificate that got issued
p11537
as(dp11538
g18
V23354
p11539
stp11540
a((dp11541
g2
(lp11542
Vfor example:
p11543
aV(see MSDN)
p11544
as(dp11545
g18
V23354
p11546
stp11547
a((dp11548
g2
(lp11549
V hooks into HTTP
p11550
aVSYS even without IIS, I believe
p11551
aVYou'll need to add priveleges to the service account, though -  on vista,  on xp ("how" covered here)
p11552
as(dp11553
g18
V23354
p11554
stp11555
a((dp11556
g2
(lp11557
VThe point is: it might work, but it isn't guaranteed to work by the spec
p11558
aVWhat people are usually after is code that works for the right reasons, rather than working by a fluke combination of the compiler, the runtime and the JIT, which might change between framework versions, the physical CPU, the platform, and things like x86 vs x64
p11559
aVUnderstanding the memory model is a very very complex area, and I don't claim to be an expert; but people who are real experts in this area assure me that the behaviour you are seeing is not guaranteed
p11560
aVYou can post as many working examples as you like, but unfortunately that doesn't prove much other than "it usually works"
p11561
aVIt certainly doesn't prove that it is guaranteed to work
p11562
aVIt would only take a single counter-example to disprove, but finding it is the problem
p11563
aVNo, I don't have one to hand
p11564
aVUpdate with repeatable counter-example:
p11565
aVOutput:
p11566
aVbut still running, at full CPU; note that  has been set to  by this point
p11567
aVThe  is so that the process doesn't terminate
p11568
aVThe optimization seems to be dependent on the size of the code inside the loop (hence )
p11569
aVIt only works in "release" mode obviously
p11570
aVAdd  and it all works fine
p11571
as(dp11572
g18
V23354
p11573
stp11574
a((dp11575
g2
(lp11576
VHow are you generating the WCF proxies
p11577
aVI used "Add Service Reference
p11578
aVfrom an SL2 project in VS2008, and my generated proxies do implement  (even though the server-side types don't)
p11579
aVFor regular WCF (not SL2),  has a  switch that does all this
p11580
aVIf you are using the IDE, there may be a checkbox
p11581
aVBecause these proxies are generated from the metadata, they are completely independent of the server-side code, so there is no issue with the SL2 version implementing
p11582
as(dp11583
g18
V23354
p11584
stp11585
a((dp11586
g2
(lp11587
VFrom the download page:
p11588
aVNote: This CTP is for testing purposes
p11589
aVonly
p11590
aVFeatures and functionality may
p11591
aVchange before final release, and
p11592
aVMicrosoft may choose not to provide a
p11593
aVfinal release
p11594
aVAlso, in the EULA
p11595
aVrtf:
p11596
aVTERM
p11597
aVThe term of this agreement is until 1 January 2009, or commercial
p11598
aVrelease of the software, whichever is
p11599
aVfirst
p11600
aVSo actually it has expired and you are not licensed to use it
p11601
aVAnd even if it hadn't:
p11602
aVYou may install and use any number
p11603
aVof copies of the software on your
p11604
aVpremises to design, develop and test
p11605
aVyour programs for use with the
p11606
aVsoftware
p11607
aVYou may not test the
p11608
aVsoftware in a live operating
p11609
aVenvironment unless Microsoft permits
p11610
aVyou to do so under another agreement
p11611
aVSo no, you can not use it in a production environment without violating the license
p11612
as(dp11613
g18
V23354
p11614
stp11615
a((dp11616
g2
(lp11617
VYou need to allocate the converter
p11618
aVOn a property-by-property basis, you can use:
p11619
aVThis would then work for usage of the form:
p11620
aVThis will work for most common binding scenarios
p11621
aV(edit)
p11622
aVTo set the converter for any :
p11623
aVNow your sample code should work
p11624
as(dp11625
g18
V23354
p11626
stp11627
a((dp11628
g2
(lp11629
VAFAIK you can't really use ClickOnce end-to-end to deploy a service; there are issues with both the file locations (ClickOnce installs into a user's profile) and installation (ClickOnce is largely side-effect free)
p11630
aVYou can, however, write a service as an exe that can self-install/uninstall from the services list, like so; basically, you write it as as a console exe and handle some command line args, using  to [un]install from the current assembly
p11631
aVAnother advantage is that the same approach can be used to help debugging, since you can run it from the command line
p11632
as(dp11633
g18
V23354
p11634
stp11635
a((dp11636
g2
(lp11637
VNot unless your e-mail backend supports DTC, in which case you can use ; note that  is not limited just to SQL-providers; some middleware tools support it, and there is even a -based provided for
p11638
aVNET objects (not any object - only those written using the library's base-class / property-bag / etc)
p11639
aVAs it stands, you'll probably have to roll back manually
p11640
as(dp11641
g18
V23354
p11642
stp11643
a((dp11644
g2
(lp11645
VWhy do you want to pass it
p11646
aVIt seems to me that a regular pass should do; this passes the reference by value - which is what you want (unless you are creating a new page
p11647
aVAlso, isn't "" the
p11648
aVCan't you just:
p11649
aVwhere  takes a
p11650
aVSee also: Jon Skeet's page on parameter passing in C#; that might fix a few misconceptions (hint:  is a reference-type (a class))
p11651
as(dp11652
g18
V23354
p11653
stp11654
a((dp11655
g2
(lp11656
VYou mean:
p11657
aV(note I tweaked the names slightly to be more C#-idiomatic)
p11658
aVThis is an "object initializer" that creates a new  (per record) and assigns the properties from the source data
p11659
aVWhat you had was an "anonymous type" initializer, which isn't the same
p11660
aVNote that if you have a non-default constructor, you could also use something like:
p11661
aVwhich uses the specified constructor, passing in the supplied values from the source data
p11662
aVThis will then be ; you don't need to call
p11663
aVNote it would be better for your function to return the typed form () than the untyped
p11664
as(dp11665
g18
V23354
p11666
stp11667
a((dp11668
g2
(lp11669
VIt depends on where the DTOs are defined and how you want to test it
p11670
aVIf you use DBML, then LINQ to SQL wants to generate the data objects in the data layer
p11671
aVWhile LINQ to SQL  supports persistance ignorance, it doesn't go out of its way to make it easy
p11672
aVEntity Framework doesn't support it at all
p11673
aVThis means that in the standard model, your data layer is defining all the domain entities, which is tricky if you want to test the user interface/business layers in true isolation from the data layer
p11674
aVA pragmatic approach might be to use the data object definitions from the data layer in unit tests, but not the data-context (i
p11675
ag50
aVhide the data-context behind the repository interface, but expose the entity types) - but this is muddying the waters a little, and means your UI, etc
p11676
aVneed to strongly reference the data layer
p11677
aVBut if you think of this as a "domain model layer which happens to also contain a repository implementation that we may or may not be using" you might justify it
p11678
aVKeeping completely separate domain entities makes unit testing and inversion of control (IoC) more "pure", but increases the amount of code you have (so double-edged)
p11679
as(dp11680
g18
V23354
p11681
stp11682
a((dp11683
g2
(lp11684
V"equivalent code" is tricky
p11685
aVfor example, under the bonnet and out of sight, code might use things like  /  /  to generate dynamic (but highly optimized) code
p11686
aVThese don't work universally (not on CF 2
p11687
aV0, for example)
p11688
aVEven for basic code, the JIT/GC may work very differently between platforms and or frameworks (or even on different CPUs / cores)
p11689
aVServer GC is different to desktop GC, for example
p11690
aVThere are difference between x86 and x64 (different optimizations and costs)
p11691
aVSo I'm afraid it boils down to specific tests on specific areas
p11692
aVA broad brush "is 20% faster" won't necessarily apply to the CPU-intensive part of your code
p11693
as(dp11694
g18
V23354
p11695
stp11696
a((dp11697
g2
(lp11698
VBecause the code isn't usable "as is", it is very hard to discuss the actual problem
p11699
aVcan you simplify the example to something that doesn't depend on external libraries / classes
p11700
aVCan I confirm: is  generated from NetTiers
p11701
aVIn which case, does NetTiers generate "partial" classes
p11702
aVIf so, you can add the interface-implementation in a second class file:
p11703
aVThis adds functionality to the  class without requiring you to edit the generated code
p11704
as(dp11705
g18
V23354
p11706
stp11707
a((dp11708
g2
(lp11709
VThe platform / language etc isn't clear, so this answer is necessarily vague
p11710
aVhowever, in general a child control can't access properties from the parent (directly), because lots of different types of parent controls could be hosting the child control
p11711
aVThe child shouldn't be hard-coded to a single parent, otherwise it might as well be part of the parent
p11712
aVGenerally, you might want to try to simply remove the requirement - it sounds like an odd design
p11713
aVHowever, some frameworks support something like this - for example, dependency properties in WPF
p11714
aVAn interface-based design (for the parent(s)) is one approach, but this isn't very clean
p11715
aVFor
p11716
aVNET, events etc are another common way for a child to communicate with a parent - the child exposes events which different parents can consume in different ways
p11717
aVOther than that, you're into the territory of testing/casting the parent (either against a class or an interface) to access details from the parent - for example:
p11718
aV(could also use an interface here; still a bit hacky either way
p11719
aVPersonally, rather than use this type of cast from the child, I'd prefer the parent to take control; the parent sets properties on the child, and listens to events (rather than the child set properties back on the parent):
p11720
aVThis way, the child doesn't know or care about the parent
p11721
aVAll it knows is that it has properties (etc), and can notify other people to interesting changes
p11722
as(dp11723
g18
V23354
p11724
stp11725
a((dp11726
g2
(lp11727
VNo, the column headers don't support data binding, since it is understood that this metadata will be (largely) static
p11728
aVIn this case, I would simply do it manually, as you propose (read from a property and subscribe to an event to update the column header)
p11729
aVFor more complex requirements (for completeness only), you can take more control if you write your own  implementation, exposed by either  or  - or even better, an  implementation where you raise  events of type ; however any of these is a significant amount of work, and it simply isn't worth it just for what you are suggesting
p11730
as(dp11731
g18
V23354
p11732
stp11733
a((dp11734
g2
(lp11735
VAn
p11736
aVNET exe is still a standard PE file; so you could try using  to set the flag, but note that this won't work if you are using something like ClickOnce (since that maintains a cryptographic hash of the files)
p11737
aVHowever, note that you'll still have the same
p11738
aVNET limits in terms of the maximum size of a single object/array
p11739
aVFor huge amounts of memory, x64 is a better idea
p11740
as(dp11741
g18
V23354
p11742
stp11743
a((dp11744
g2
(lp11745
VPersonally, I doubt that this is ever going to be "clean" - serialization works well for data, but not so well for objects tightly connected to objects outside of the serialization graph
p11746
aVAt the point of deserialization, the object is in the ether (in fact,  doesn't even use any constructor)
p11747
aVAs such, it has no way of getting to a form, etc
p11748
aVYou could perhaps do some horrible hacks with a static field (perhaps [ThreadStatic]) to hold the current form, but it would be brittle and ugly
p11749
aV(I'm hopeful that somebody will have a better answer, though
p11750
as(dp11751
g18
V23354
p11752
stp11753
a((dp11754
g2
(lp11755
VIf you want a standalone deployment (i
p11756
ag50
aVwithout needing the framework), there are a few options - see here
p11757
aVHowever, I'm not aware of anything that will reliably produce purely unmanaged code
p11758
aVWhat is the use-case you have in mind
p11759
aVFor embedded etc there is micro-framework, CF, etc
p11760
as(dp11761
g18
V23354
p11762
stp11763
a((dp11764
g2
(lp11765
VYou can't change the implementation of a compiled method; polymorphism is one option; the other is encapsulation, perhaps via a decorator pattern over an interface, using a factory to create the instance - i
p11766
ag50
aV(I won't bother with an example of polymorphism)
p11767
aVPolymorphism and decoration achieve a similar end, but have different pros/cons - for example, decorators can be assembled in flexible chains for different scenarios
p11768
aVWith any other approach (such as extension methods), you end up calling a different method; if that suits, then fine
p11769
as(dp11770
g18
V23354
p11771
stp11772
a((dp11773
g2
(lp11774
VBasically, that list is huge
p11775
aVit is everything outside of the relatively small set of things that are handled
p11776
aVUnfortunately, the Law Of Leaky Abstractions kicks in, and each provider has different answers
p11777
aVLINQ-to-Objects will do anything (pretty much), since it is delegates; LINQ-to-SQL and Entiy Framework have different sets of support
p11778
aVIn general, I've had a fair amount of success using the  properties etc - but in reality, you're going to have to ensure that your query expressions are covered by unit tests, so that if you ever change providers (or the provider gets updated) you know it all still works
p11779
aVI guess one view is to think in terms of TSQL; there is no , but there is a  (re the ); In terms of , you could be quite literal: ; and with  you can probably do quite a bit with  / the various components
p11780
aVAnother option with LINQ-to-SQL is to encapsulate the logic in a UDF - so you could write a UDF that takes a  and returns a , and expose that via the dbml onto the data-context
p11781
aVYou can then use that in your queries:
p11782
aVThis approach, however, doesn't necessarily make good use of indexes
p11783
aVUpdate:
p11784
aVThe supported method translations etc are here
p11785
aVThe supported query operations etc are here
p11786
aVFor the full gory details, you can look at  in reflector - in particular the  methods; some  functions are handled separately
p11787
aVSo not a huge selection - but this is an implementation detail
p11788
as(dp11789
g18
V23354
p11790
stp11791
a((dp11792
g2
(lp11793
V"The same question also applies to LinqToSql
p11794
aVFor LINQ-to-SQL, look at ; this has 3 separate collections for the pending ,  and
p11795
aVNote that the  is a snapshot of when the  method is called; you need to re-query to see any additional changes
p11796
as(dp11797
g18
V23354
p11798
stp11799
a((dp11800
g2
(lp11801
VI wouldn't try to mix the two; they are very different approaches, and aren't really compatible with each-other during the same page request
p11802
aVRenderPartial might work, but I wouldn't wager any money
p11803
aVNote that for MVC views, the code-behind file (usually empty) is also being removed in the RC
p11804
as(dp11805
g18
V23354
p11806
stp11807
a((dp11808
g2
(lp11809
V(caveat, this is per-database; I don't know of anything server-wide, since the database is the main standalone unit)
p11810
aVPresumably your user isn't the owner of the schema (or dbo)
p11811
aVIn which case, they already shouldn't have access to, well, anything unless you GRANT it
p11812
aVSo don't GRANT the access they don't need, REVOKE any access you have granted incorrectly, and DENY anything that you absolutely don't want them ever being able to do
p11813
aVSee also MSDN
p11814
as(dp11815
g18
V23354
p11816
stp11817
a((dp11818
g2
(lp11819
VExpression trees are designed to perform a fixed operation - in particular, the member-access is going to want a known  (etc) at the point of expression tree creation (since they are immutable)
p11820
aVYou could duplicate the generated code from  if you are playing with 4
p11821
aV0, but to be honest, the better approach in this scenario is simply: don't use an expression tree
p11822
aVEither reflection or  () would be ideal for this dynamic access to a member
p11823
aVAlso - calling  on something you use only once isn't saving any time, and using  isn't either
p11824
aVyou need to use the typed delegate form ()
p11825
as(dp11826
g18
V23354
p11827
stp11828
a((dp11829
g2
(lp11830
VThis sounds like a duplicate of "How to enumerate threads in
p11831
aVNET using the Name property
p11832
aV- If so, the short answer is "keep track of your own threads yourself" - i
p11833
ag50
aVin a  or similar
p11834
as(dp11835
g18
V23354
p11836
stp11837
a((dp11838
g2
(lp11839
VNo fixed-length value can ever guarantee to be 100% unique (just call it enough times, give or take the universe ending ;-p) - but it can be very, very, very unlikely to duplicate
p11840
as(dp11841
g18
V23354
p11842
stp11843
a((dp11844
g2
(lp11845
VThe easiest option (if the columns are known ahead of time) is to add them as you would normally, then set  as appropriate (on each) at runtime
p11846
aVYou can also add extra columns completely at runtime (if you can't predict the schema) - but note that this might work differently depending on whether you are using data-binding (i
p11847
ag50
aVa )
p11848
as(dp11849
g18
V23354
p11850
stp11851
a((dp11852
g2
(lp11853
VHow about:
p11854
as(dp11855
g18
V23354
p11856
stp11857
a((dp11858
g2
(lp11859
VDo you actually need this path during the constructor
p11860
aVIf you don't need it until the main page cycle begins, consider deferring it - just using a regular property; something like
p11861
aVThen when this is used during the page cycle, it should be fine
p11862
aVYou could cache it if you really want to, but I don't imagine this is going to be a bottleneck:
p11863
as(dp11864
g18
V23354
p11865
stp11866
a((dp11867
g2
(lp11868
VThe simplest approach is simply to keep two copies of the sln files - a 2005 set and a 2008 set
p11869
aVActually, I often consider the sln file completely transient and developer specific (rarely in source control), but different people find different setups helpful
p11870
aVMSTest is a big culprit here (darned testrunconfig files
p11871
aVpure crazy
p11872
aVNote that using 2005 and 2008 also carries the risk of your 2008 devs using C# 3 features accidentally
p11873
aVSome of them aren't obvious, such as the improved generic type inference - for example:
p11874
aVWhich requires the  in C# 2
p11875
aV0, but not in C# 3
p11876
ag190
aVA similar risk would be any designers / other tools that generate code - the VS2008/C# 3
p11877
aV0 versions might include "partial methods", which won't work in C# 2
p11878
ag190
aVIf you can, try to upgrade everybody in a fairly short time-frame to minimize any pain from this risk
p11879
as(dp11880
g18
V23354
p11881
stp11882
a((dp11883
g2
(lp11884
VThis gets asked a lot
p11885
aVBasically, no there isn't
p11886
aVYou have to do it manually at the start of each new thread (or  function)
p11887
aVYou could perhaps store the culture name (or just the culture object) in a static field to save having to hit the DB, but that it about it
p11888
as(dp11889
g18
V23354
p11890
stp11891
a((dp11892
g2
(lp11893
VHow about using ASP
p11894
aVNET MVC
p11895
aVYou should be able to map that to a route pretty easily - either as  or
p11896
aVI personally would drop the , but that is up to you
p11897
as(dp11898
g18
V23354
p11899
stp11900
a((dp11901
g2
(lp11902
VThe simplest option would be to simply show a different screen/control that only has the chart on it
p11903
aVIf isn't entirely clear if you are using standard controls like  for the tabbed view - if so, you should be able to take the chart out of the  and re-add it at a higher level (hiding the  etc) - something like (purely for illustration):
p11904
as(dp11905
g18
V23354
p11906
stp11907
a((dp11908
g2
(lp11909
VIt sounds like a deadlock, perhaps due to the sync-context
p11910
aVWhat is the client
p11911
aVWinform
p11912
aVWPF
p11913
aVWCF respects sync-context, which means "switch to the UI thread" for winforms and WPF
p11914
aVIf you are making the blocking request on the UI thread, then game over
p11915
aVTry performing your WCF request on a background thread, so that the UI thread is available to service the incoming request; this could be as simple as using , or maybe
p11916
as(dp11917
g18
V23354
p11918
stp11919
a((dp11920
g2
(lp11921
VJust cast using an anonymous method:
p11922
aVor with C# 3
p11923
aV0, a lambda:
p11924
as(dp11925
g18
V23354
p11926
stp11927
a((dp11928
g2
(lp11929
VAside: Note that the standard LINQ operators (as per the earlier example) don't change the existing list -  will create a new list based on the re-ordered sequence
p11930
aVIt is pretty easy, however, to create an extension method that allows you to use lambdas with :
p11931
aVThen you can use:
p11932
aVThis updates the existing list in the same way that  usually does
p11933
as(dp11934
g18
V23354
p11935
stp11936
a((dp11937
g2
(lp11938
VThe conditional operator should be pretty familiar to most devs
p11939
aVActually, I would use simply:
p11940
aVwhich I find pretty easy to follow
p11941
aVThe  /  seems (IMO) overkill for bools
p11942
aVA more common "olde world" usage is:
p11943
aVThis "const == variable" is to avoid the issue of "=" vs "==", but since C# doesn't treat numbers as booleans, it is very rare that this is an issue, and it is more common (in C#) to see the clearer:
p11944
aVSince if you miss the extra = it usually won't compile
p11945
as(dp11946
g18
V23354
p11947
stp11948
a((dp11949
g2
(lp11950
VYou can get this functionality from the  (via ), but it isn't trivial - you need to set up an , an , and ideally an  - quite a bit of faff
p11951
aVIt might be simpler to do it by hand if you aren't familiar with those tools
p11952
aVAlternatively - take a look at SmartPropertyGrid
p11953
aVNET, an alternative to
p11954
aVUpdate: here's a working example
p11955
aVdefinitely non-trivial, but feel free to steal the code
p11956
aVIt only works for modal editors, not drop-down
p11957
aVIt also isn't a great example of "separation of concerns"
p11958
aVThe  class is the interesting one
p11959
as(dp11960
g18
V23354
p11961
stp11962
a((dp11963
g2
(lp11964
VWell, "easily" is the trick
p11965
aVhowever dotTRACE might be worth a look
p11966
as(dp11967
g18
V23354
p11968
stp11969
a((dp11970
g2
(lp11971
VIt seems to me that the concrete class should only deal with the raw data; this could be writing a local file (that is then handled by the base code), or to a stream
p11972
aVFor example, perhaps something like:
p11973
aVSo the  is responsible for providing a stream (that could be a memory stream, a transport stream, a temp file stream, etc), and optionally doing extra work when that stream is closed (by encapsulating an inner-stream via a decorator pattern)
p11974
aVAll the subclass does is write to a stream
p11975
aVLoading is a bit trickier, since the base-class must presumably (given your suggested static load from the base-class) peek at the stream to identify the type
p11976
aVBut ultimately, you could have something similar:
p11977
as(dp11978
g18
V23354
p11979
stp11980
a((dp11981
g2
(lp11982
VFirst, read the object names into an array or list; I'll fake that part
p11983
aVThen it should be something like:
p11984
aV(edit)
p11985
aVTo get the selected names (the bit I faked) you could try (untested):
p11986
aV(note no need to use  in the above, since  does that anyway)
p11987
as(dp11988
g18
V23354
p11989
stp11990
a((dp11991
g2
(lp11992
Vprotobuf-net supports most inheritance routes (even though the spec doesn't)
p11993
aVThere is one known glitch (I'm working on it ;-p) - but it covers most options
p11994
as(dp11995
g18
V23354
p11996
stp11997
a((dp11998
g2
(lp11999
VAs many have said - there isn't a direct route
p12000
aVI expect one close option is :
p12001
aVOf course, you may need / to handle exceptions
p12002
aVSuch is life
p12003
as(dp12004
g18
V23354
p12005
stp12006
a((dp12007
g2
(lp12008
VNo, I don't expect any direct language suport (i
p12009
ag50
aVinside the query syntax) any time soon
p12010
aVIt sounds like you mean the mythical  extension method; trivial to add, but Eric Lippert has commented numerous times about the cross between side-effect-free functional code and  with side-effects
p12011
aVIn particular, C# 3
p12012
aV0 /
p12013
aVNET 3
p12014
aV5 expression trees are lousy at side-effecs (making full lambda support tricky)
p12015
aVThe runtime side is much better in
p12016
aVNET 4
p12017
aV0, but it is unclear at the moment how much of this will make it into the language (lambda compiler) in C# 4
p12018
ag190
aVAll you need (for delegate version) is:
p12019
aVThen from any query you can simply use
p12020
as(dp12021
g18
V23354
p12022
stp12023
a((dp12024
g2
(lp12025
V supports parameters, and also extension objects (both via
p12026
aVFor anything simple, try to use a parameter; extension objects allow much richer functionality (up to your imagination), but are not as portable to other xslt vendors
p12027
aVA third option is an external file for options, loaded into a variable with
p12028
aVOf course, if you are feeling brave, you can use xslt to write an xslt dynamically - not trivial, though
p12029
aVIn most non-trivial cases, it is simplest to use  against a flat file (in the %tmp% area, or against a local web-server (such as ); changing the html directly tends to leave the control slightly confused re the effective security context
p12030
as(dp12031
g18
V23354
p12032
stp12033
a((dp12034
g2
(lp12035
VOne of the ways of developing for Microsoft Surface is through WPF
p12036
aVSo any of the Surface examples might help show possibilities
p12037
as(dp12038
g18
V23354
p12039
stp12040
a((dp12041
g2
(lp12042
VGiven your rebuttal to partial classes
p12043
aVthere is no way that I know of in a single file, short of documentation
p12044
aVOther options
p12045
aVinheritance; but the protected code in the base-class (in an assembly you control); inheritors can only call the / members
p12046
aVpostsharp - stick the protected logic in attributes declared externally
p12047
aVHowever, both of these still require multiple files (and probably multiple assemblies)
p12048
as(dp12049
g18
V23354
p12050
stp12051
a((dp12052
g2
(lp12053
VI use  only when writing crude performance/profiler test rigs; i
p12054
ag50
aVI have two (or more) blocks of code to test - something like:
p12055
aVSo that  and  run with as similar state as possible - i
p12056
ag50
aVdoesn't yet hammered just because  left it very close to the tipping point
p12057
aVA classic example would be a simple console exe (a  method sort-enough to be posted here for example), that shows the difference between looped string concatenation and
p12058
aVIf I need something precise, then this would be two completely independent tests - but often this is enough if we just want to minimize (or normalize) the GC during the tests to get a rough feel for the behaviour
p12059
aVDuring production code
p12060
aVI have yet to use it ;-p
p12061
as(dp12062
g18
V23354
p12063
stp12064
a((dp12065
g2
(lp12066
VAn easier option may be to use an attribute provider instead:
p12067
aVYou could try using the assembly-qualified name
p12068
aVand specifying the editor
p12069
aVActually, you can abbreviate this to be version-independent just by specifying the assembly:
p12070
as(dp12071
g18
V23354
p12072
stp12073
a((dp12074
g2
(lp12075
VMost of the time it is redundant and can be omitted; a few exceptions:
p12076
aVto call a chained constructor:
p12077
aVto disambiguate between a local argument/variable and a field:  etc
p12078
aVto call an extension method on the current instance:  (where defined as )
p12079
aVto pass a reference to the current instance to an external method:
p12080
as(dp12081
g18
V23354
p12082
stp12083
a((dp12084
g2
(lp12085
VThere is , but this is rarely used and poorly supported - and of course not enforced (you could mark a mutable object with
p12086
aVAFAIK, the only thing this this affects is the way the IDE handles attributes (i
p12087
ag50
aVto show / not-show the named properties options)
p12088
aVIn reality, you would have to check the , but this only applies to truly 100% immutable types (assuming no reflection abuse, etc); it doesn't help with popsicle immutability, nor things that are immutable in practice, but not in their implementation; i
p12089
ag50
aVthey can't be made to be publicly mutable, but in theory the object supports it
p12090
aVA classic example here would be string
p12091
aVeveryone "knows" that  is immutable
p12092
aVof course,  does mutate a string under the bonnet
p12093
aVNo, seriously
p12094
aVIt is so hard to define immutability given this, let alone robustly detect it
p12095
as(dp12096
g18
V23354
p12097
stp12098
a((dp12099
g2
(lp12100
VYou need to cast the array - the returned array is actually of the requested type, i
p12101
ag50
aVif you ask for :
p12102
aVThen  etc
p12103
as(dp12104
g18
V23354
p12105
stp12106
a((dp12107
g2
(lp12108
VThe two are very different; but  will always deserialize entire objects; with XPath you can pick and choose
p12109
aVI'd use  personally, though - harder to get wrong
p12110
aVXPath, however, is a complex beast that depends on the back-end
p12111
aVFor example,  (mutable) will behave differently to  (read-only, optimized for query)
p12112
as(dp12113
g18
V23354
p12114
stp12115
a((dp12116
g2
(lp12117
VThe problem with pushing data back into a stream is that any readers that sit on top of the stream may already have a local buffer of data
p12118
aVThis makes this approach very brittle
p12119
aVPersonally, I would try to avoid this scenario, and use data constructs where I either don't need to push back, or can use single-byte Peek etc
p12120
as(dp12121
g18
V23354
p12122
stp12123
a((dp12124
g2
(lp12125
VThat is very, very vague
p12126
aVYou can enforce ACLs on files using ; beyond that, you'll need to be more specific
p12127
aVFor example, you might want to look at System
p12128
aVSecurity
p12129
aVCryptography
p12130
as(dp12131
g18
V23354
p12132
stp12133
a((dp12134
g2
(lp12135
VI guess primarily because:
p12136
aVit can't properly be enforced, even in C++ (you can cast it)
p12137
aVa single const at the bottom can force a whole chain of const in the call tree
p12138
aVBoth can be problematic
p12139
aVBut especially the first: if it can't be guaranteed, what use is it
p12140
aVBetter options might be:
p12141
aVimmutable types (either full immutability, or popsicle immutability)
p12142
as(dp12143
g18
V23354
p12144
stp12145
a((dp12146
g2
(lp12147
VActually, if you use a custom descriptor, you can bind to fields
p12148
aVBut I wouldn't recommend it
p12149
aVBut data-binding is designed t be 2-way; with a field, there is no notification possible
p12150
as(dp12151
g18
V23354
p12152
stp12153
a((dp12154
g2
(lp12155
VThe latter (deferred);  is an iterator block (because of ); this means that you have a chain of iterators
p12156
aVNothing is read until the final caller starts iterating the data; then each record is read in turn during the final caller's  (between which the connection/command is open)
p12157
aVThe  that surrounds  (under the bonnet) ensures that the connection is closed if the  is abandoned half-way-through
p12158
aVIf you want to load the data earlier, use  or  to buffer the data locally - but note that this breaks "composition" - i
p12159
ag50
aVthe caller can no longer add extra  etc clauses (which they can if it returns a raw )
p12160
aVRe your question:
p12161
aVThe  is the key here; it ends the composable  chain, and uses LINQ-to-Objects for the rest
p12162
as(dp12163
g18
V23354
p12164
stp12165
a((dp12166
g2
(lp12167
VActually, hidden spec feature: you can ;-p
p12168
aVThis is genuinely parsed by the compiler as a decimal (not a float and a cast)
p12169
aVSee the IL to prove it
p12170
aVNote that the precision gets truncated, though (this has 1 decimal digit, not the 2 you get from the  version)
p12171
aVIL generated:
p12172
aVCompared to:
p12173
aVWhich generates:
p12174
aVThe only difference is the decimal digits (1 vs 2, and a factor of 10, accordingly)
p12175
as(dp12176
g18
V23354
p12177
stp12178
a((dp12179
g2
(lp12180
VWell, the first thing to ask would be: what is
p12181
ag412
ag50
aVdid the adapter do anything
p12182
aVIf not, it has nothing to do with the binding
p12183
aVAssuming it is non-empty, then what exact code are you using to set up  and
p12184
aVI expect it should be:
p12185
aVAlternatively, you could set the 's DataSource to  and leave the table blank
p12186
aVBasically, I expect that you've told it the type of data to anticipate, but so far you haven't actually given it the data-set/data-table you want to use
p12187
as(dp12188
g18
V23354
p12189
stp12190
a((dp12191
g2
(lp12192
VAssuming you mean a string-based query: the dynamic LINQ library will work fine; just call  first:
p12193
aVThis gives you an  wrapper around your list, which provides access to the dynamic LINQ extension methods
p12194
as(dp12195
g18
V23354
p12196
stp12197
a((dp12198
g2
(lp12199
Vpostsharp, which uses attributes to inject code (AOP)
p12200
aVwhich can be used to provide a custom runtime property model - either completely different properties, or perhaps faster ones
p12201
aVAnd some core ones that are often overlooked:
p12202
aV- used to move types between assemblies without re-building
p12203
aV- used to automatically enforce security on members
p12204
as(dp12205
g18
V23354
p12206
stp12207
a((dp12208
g2
(lp12209
VThe  version is wasteful on this occasion
p12210
aVis useful if you want to perform -like work, but don't want an actual file
p12211
aVIf you are writing a file, then just write to the file
p12212
aVThis avoids the need to buffer all the data in memory
p12213
as(dp12214
g18
V23354
p12215
stp12216
a((dp12217
g2
(lp12218
VIf you know the structure you want, the simplest option is to work back from the xml; write the xml into a file ( in my case), then (at the command line):
p12219
aVThen look at  to see how it can be done; it turns out that you simply mark the value with
p12220
aVHere's the xsd output:
p12221
as(dp12222
g18
V23354
p12223
stp12224
a((dp12225
g2
(lp12226
VIn short, yes - a type inherits the type arguments from any types that contain it: this is the key to things like  and many other scenarios, etc - it is critical that they share the  from the outer class (not just any )
p12227
aVThe ECMA ref is 25
p12228
aV1:
p12229
aVAny class nested inside a generic
p12230
aVclass declaration or a generic struct
p12231
aVdeclaration (25
p12232
aV2) is itself a
p12233
aVgeneric class declaration, since type
p12234
aVparameters for the containing type
p12235
aVshall be supplied to create a
p12236
aVconstructed type
p12237
as(dp12238
g18
V23354
p12239
stp12240
a((dp12241
g2
(lp12242
VI can't think of an easy way to do that
p12243
aVYou can't inject into the middle of the LINQ-to-SQL pipeline without breaking composability
p12244
aVThe easiest way to do this would be as a last step via LINQ-to-Objects:
p12245
aVBut note that this breaks composability - everything downstream is LINQ-to-Objects
p12246
aVSince you have a common base-class / interface for your entities, this could alternatively be wrapped in an extension method for very similar behaviour (but better re-use):
p12247
aVwith something like:
p12248
as(dp12249
g18
V23354
p12250
stp12251
a((dp12252
g2
(lp12253
VYou can only bind to immediate properties of the data-source
p12254
aVFor , this means columns
p12255
aVTwo options leap to mind:
p12256
aVdon't use  - just use a  or
p12257
aV(or) override  to return
p12258
aVThe second isn't very flexible - I'd go with the first
p12259
aVAfter all, what is a 1-column  really doing for you
p12260
as(dp12261
g18
V23354
p12262
stp12263
a((dp12264
g2
(lp12265
VThat really doesn't seem like a great idea
p12266
aVEvery commentary I've read has said "don't use the code-behind; we wish it wasn't there"
p12267
aVAnd I agree
p12268
aVYou could try writing your logic in extension methods (traditionally on ) like here
p12269
as(dp12270
g18
V23354
p12271
stp12272
a((dp12273
g2
(lp12274
Vwindbg isn't really an IDE debugger; it is more commonly used directly on compiled exes on the machine
p12275
aVAs such, yes, it should be OK to use with an exe compiled with Express Edition, but no: there is no direct involvement of Express Edition in this
p12276
aVUltimately, the Express, Pro, Team etc products all use the same compiler that can be used at the command line ( - although they might access it more directly than the exe
p12277
aVLook also at "SOS" (Son Of Strike)
p12278
as(dp12279
g18
V23354
p12280
stp12281
a((dp12282
g2
(lp12283
VAt the simplest, you just use:
p12284
aVBut there are overloads to load from other sources (an unmanaged pointer, a raw stream, or a resx)
p12285
as(dp12286
g18
V23354
p12287
stp12288
a((dp12289
g2
(lp12290
VI expect that in this case you'd have to construct your own proxy, constructing your own http requests etc (perhaps via )
p12291
aVThankfully, creating a REST request is a lot easier than raw SOAP, as is parsing the result
p12292
aVHowever, I wonder if consuming an  service (i
p12293
ag50
aVNET 2
p12294
aV0 web-service) wouldn't be more pragmatic
p12295
aVIf the ADO
p12296
aVNET Data Services service is out of your control, perhaps host a
p12297
aVNET 3
p12298
aV5 wrapper on another server that shims between  and Astoria
p12299
aV(i
p12300
ag50
aVexposes the data from the REST service via a 2
p12301
aV0 web-service)
p12302
as(dp12303
g18
V23354
p12304
stp12305
a((dp12306
g2
(lp12307
VInside TSQL, you should use  to execute any dynamic commands you need (for example, to provide flexible searching/sorting)
p12308
aVNote that unless you jump through some hoops with certificates, you still need direct  (etc) permission to the table (unlike a SPROC which cab provide access implicitly), but it should be injection safe
p12309
aVFor example:
p12310
aVThere is obviously no need to use dynamic SQL in the above - this is for illustration only
p12311
aVThe main times this is useful is when (inside a SPROC) you have multiple optional search conditions, or a flexibly  clause
p12312
aVIn non-TSQL clients, you can do the same with parameters to the command
p12313
aVNote also that  also makes use of the procedure cache, so can be more efficient than raw
p12314
as(dp12315
g18
V23354
p12316
stp12317
a((dp12318
g2
(lp12319
VI don't think that  sounds like an enum, which is usually a set of choices
p12320
aVFor something different, if it was a , then maybe
p12321
aVbut currently it is a mutable field
p12322
aVNote that enums are limited to integer-based types, so it can't be used for , , etc
p12323
as(dp12324
g18
V23354
p12325
stp12326
a((dp12327
g2
(lp12328
VI think that looking at the WinAPI could be counter-productive to WPF, since it has a largely re-written stack
p12329
aVEven more so if you are looking at WPF in parallel to Silverlight
p12330
aVIt might be marginally useful occasionally for winforms - but I've been writing winforms for years, and have only once or twice needed lower level details
p12331
aVEvery time I did, "google" did the job fine; or more recently, stackoverflow ;-p
p12332
aVIf you were writing raw windows directly, then maybe
p12333
aVBut that would be unusual for C#
p12334
as(dp12335
g18
V23354
p12336
stp12337
a((dp12338
g2
(lp12339
VIs there any reason the list needs to have a setter
p12340
aVOften, collection properties are read-only - you just // them
p12341
aVThe  makes this trickier - normally I'd just do:
p12342
aVIn this case, perhaps (since we don't want to call a virtual method in the ctor):
p12343
aVIf this still doesn't work, try a concrete list type
p12344
as(dp12345
g18
V23354
p12346
stp12347
a((dp12348
g2
(lp12349
VJust write your own extension method:
p12350
aVand call:
p12351
aVOr if you want the default to be evaluated lazily, use a  for the default:
p12352
aVThis form, for example, would allow you to use a pre-defined item (the first, for example):
p12353
aVor more flexibly:
p12354
aVor
p12355
as(dp12356
g18
V23354
p12357
stp12358
a((dp12359
g2
(lp12360
VWhat is the list type you are using as the data-source
p12361
aVCan you use
p12362
aVIf so, this has a settable  property, allowing you to turn off notifications
p12363
aVThis will probably get very messy re your last points, though (sort/filter)
p12364
aVPersonally, I'd work with 2 lists - the bound one, and the one that the server is updating
p12365
aVWhen paused, simply stop pumping data between the two
p12366
aVThis should leave the paused view free for sorting / filtering etc
p12367
as(dp12368
g18
V23354
p12369
stp12370
a((dp12371
g2
(lp12372
VI don't fully understand the use-case - but you can add filters easily via :
p12373
aVetc
p12374
aVYou can do more sophisticated things by building an  manually, but the above has the advantage of being easy to debug, and compiler-checked (the compiler will ensure there is a suitable  property, etc)
p12375
as(dp12376
g18
V23354
p12377
stp12378
a((dp12379
g2
(lp12380
VWell, arguably it allows you to distribute a url for the page, but a better approach here might be something involving a guid as an opaque identifier to a permalink
p12381
aVperhaps it is useful for scripting purposes
p12382
aVIf it is between pages on the same app, then a POST over SSL would indeed seem to make more sense
p12383
aVCan you ask the original designers
p12384
aVRead the design documents
p12385
as(dp12386
g18
V23354
p12387
stp12388
a((dp12389
g2
(lp12390
VWell, what code is it
p12391
aVMost of the MS tools include this header
p12392
aVdoes,  (LINQ-to-SQL) does, etc
p12393
aVTry looking down a few lines
p12394
aVfor example, a quick xsd test for me shows a second comment block:
p12395
aVBut this doesn't exist in the LINQ-to-SQL code
p12396
aV;-(
p12397
as(dp12398
g18
V23354
p12399
stp12400
a((dp12401
g2
(lp12402
VOne option is LINQ - a bit inefficient, but OK for non-huge arrays:
p12403
aVOr with a jagged array:
p12404
aVIn reality, I would probably use a dictionary/count
p12405
aVThis example without LINQ, just "because":
p12406
as(dp12407
g18
V23354
p12408
stp12409
a((dp12410
g2
(lp12411
VWell, you could try using the "Silverlight-enabled WCF Service" template in VS2008, and comparing the differences
p12412
aVI expect that you need to use the  and are using something more exotic
p12413
aVFor info, here is the web
p12414
aVconfig section for a default Silverlight/WCF service:
p12415
as(dp12416
g18
V23354
p12417
stp12418
a((dp12419
g2
(lp12420
Vre "so no LINQ" - have you looked at LINQBridge
p12421
aVSince you are using C# 3
p12422
aV0 this would be ideal
p12423
aVI'm afraid for the main question, I don't fully understand what you are trying to do and what you are trying to avoid - can you clarify at all
p12424
aVBut if you use the LINQBridge approach you can combine filters using successive  calls
p12425
aVOne interpretation of the question is that you don't want lots of filter methods - so perhaps pass in one or more further predicates into the method - essentially as a  - or in pure 2
p12426
aV0 terms, a :
p12427
aVwhich is then used (to be as above) as:
p12428
as(dp12429
g18
V23354
p12430
stp12431
a((dp12432
g2
(lp12433
VDo you mean constants ()
p12434
aVor readonly variables
p12435
aVAlso - if you can't tell what the value represents from the name, then you haven't named it right; most times you don't need to scrutinize the actual value of a , since it doesn't change very often ;-p
p12436
aVIf you mean  - then by definition the value is right next to it
p12437
aVbut even so, when debugging hover works fine for me (I could post a screenshot if you like)
p12438
aVThe hover doesn't work when not debugging - it only shows the value in the hover when debugging
p12439
as(dp12440
g18
V23354
p12441
stp12442
a((dp12443
g2
(lp12444
VWith LINQ-to-SQL, there are two ways inheritance can work:
p12445
aVdiscriminator over a single table (not suitable since your data is not homogeneous)
p12446
aVbase-class / multi-table (not that this isn't supported in the dbml - only if you write the classes manually)
p12447
aVLINQ-to-SQL does not support multi-table inheritance (i
p12448
ag50
aVa single object with data from multiple tables)
p12449
aVEntity Framework does, but is more complex; you use  and  in EF to cast/filter based on sub-types
p12450
aVYou might want to look at:
p12451
aVquerying based on an ID (combine with )
p12452
aVspecifying a base-class in the dbml
p12453
aVWhat is the purpose of the base class here
p12454
aVIf it adds behaviour, then you can edit the dbml to specify a common base-class for all your entities
p12455
aVIf it has data properties then it gets trickier
p12456
aVPersonally, I simply wouldn't do it this way
p12457
aVI would keep separate classes for the different types, and use the data-context correctly, using the separate tables per type:
p12458
aVSo - can you clarify what the  does here
p12459
as(dp12460
g18
V23354
p12461
stp12462
a((dp12463
g2
(lp12464
VThe SDK has a couple of additional tools that are **sometimes** used, depending on the contents of your project - such as (IIRC) the reports compiler
p12465
aVBut for most things, no: you don't need the SDK
p12466
aVI installed in on my build server just to get clean output ;-p
p12467
as(dp12468
g18
V23354
p12469
stp12470
a((dp12471
g2
(lp12472
VFirst - IMPORTANT - your SQL is vulnerable to injection; the inner command should be parameterized:
p12473
aVThis passes the value of  in as the  parameter in the dynamic command - preventing injection attacks
p12474
aVSecond - you don't really need the temp table
p12475
aVIt isn't doing anything for you
p12476
aVyou just INSERT and SELECT
p12477
aVPerhaps just EXEC and let the results flow to the caller naturally
p12478
aVIn other circumstances a table-variable would be more appropriate, but this doesn't work with INSERT/EXEC
p12479
aVAre the columns the same for every call
p12480
aVIf so, either write the dbml manually, or use a temp SP (just with "WHERE 1=0" or something) so that the  can work
p12481
aVIf not (different columns per usage), then there isn't an easy answer
p12482
aVPerhaps use regular ADO
p12483
aVNET in this case (/ - and perhaps even )
p12484
aVOf course, you could let LINQ take the strain
p12485
aV(C#):
p12486
aVetc
p12487
as(dp12488
g18
V23354
p12489
stp12490
a((dp12491
g2
(lp12492
VHow about SourceGrid
p12493
aVI haven't used it in production, but I played with it and it seems pretty flexible
p12494
as(dp12495
g18
V23354
p12496
stp12497
a((dp12498
g2
(lp12499
VTry just using :
p12500
aVNote I changed  to  to clean up the output; in 1
p12501
aV1,  would be another option, although that has different case-sensitivity rules
p12502
as(dp12503
g18
V23354
p12504
stp12505
a((dp12506
g2
(lp12507
VIn C# terms; you could assume int:
p12508
aVor if you don't want the assumption:
p12509
as(dp12510
g18
V23354
p12511
stp12512
a((dp12513
g2
(lp12514
VRe mousing over, perhaps
p12515
aVHowever, perhaps a better approach is to follow the guidelines, and make the properties idempotent, with methods to populate them
p12516
ag412
ag50
aVcall the "populate" method (telling it what you need to know) before passing the object to the grid
p12517
aVFor a struct
p12518
aVwell, a struct should (except for very specific reasons) always be immutable
p12519
aVSo a lazy-loading struct is pretty much an oxymoron
p12520
aVYou would probably run the risk of losing track of what is going on here
p12521
aVshort version: make it a class (quite possibly one that is , and possibly has a finalizer)
p12522
as(dp12523
g18
V23354
p12524
stp12525
a((dp12526
g2
(lp12527
g9575
aV5SP1 won't have any real effect if your code already works side-by-side with 2
p12528
aV0; the important factor is the choice of CLR: if it already gets this right, then you shouldn't be hugely affected
p12529
aVIn this case, even if the 2
p12530
aV0 CLR is chosen (1
p12531
aV1 code can run in 2
p12532
aV0), you will only see changes from the 2
p12533
aV0 service packs that are bundled in 3
p12534
aV5SP1
p12535
aVThis might have some subtle impacts on  usage etc, but they should be minimal
p12536
aVOf course, if your 1
p12537
aV1 code isn't already 2
p12538
aV0-safe, then there are a lot more changes to watch out for - things like thread exceptions always being fatal
p12539
aVyou would want to actively request 1
p12540
ag733
as(dp12541
g18
V23354
p12542
stp12543
a((dp12544
g2
(lp12545
VFirst, I'd question whether you need  - it seems unusual; that would mean you intend to re-assign the variable inside the method
p12546
aV(different to changing properties of the passed instance)
p12547
aVFor , it must be an exact match; you could use:
p12548
aVAlternatively, consider generics:
p12549
aVThen you can use  and it will infer
p12550
aV(updated re comment)
p12551
aVIn the generic example, we declare  as a generic method "of T", where T is at least a
p12552
aVThis "at least" ensures that we still have access to all the members of  inside the method (since any subclass of  still has those members)
p12553
aVGenerics act a bit like templates (but not quite)
p12554
aVThe caller gets to specify the T when calling the method
p12555
aVSo the caller could use , which would compare to calling your existing
p12556
aVOr they could use , which is like calling  - in both cases the  gets substituted throughout the method
p12557
aVHowever, the C# compiler is intelligent enough that often you don't need to tell it the bit in angle brackets; it can see that you are passing a , so it will assume (unless you tell it otherwise) that it should use  - this is called generic type inference
p12558
aVThe point here is that it makes it easy to use  with subclasses of the data
p12559
as(dp12560
g18
V23354
p12561
stp12562
a((dp12563
g2
(lp12564
VI would expect it to be some bizarre setting that is different from the iSeries tools and the
p12565
aVNET client - for example:
p12566
aVtransaction mode
p12567
aVansi settings
p12568
aVother connection options
p12569
aV(for SQL Server, I'd mean things like SET CONCAT_NULL_YIELDS_NULL, etc)
p12570
aVI don't know much about iSeries, but with SQL Server, for example, it can only use "indexed persisted calculated" columns if everything is just right; otherwise it re-computes the formula per row
p12571
aVHave you tried a trace
p12572
as(dp12573
g18
V23354
p12574
stp12575
a((dp12576
g2
(lp12577
VI'd disagree with Sean's answer; firstly, finalizers should not be routinely added to classes, even if they are  - finalizers should only really be used in classes that represent unmanaged resources
p12578
aVConversely, a class with a finalizer often is also
p12579
aVRe the question: is  called - no, it isn't
p12580
aVThe object will be garbage collected at some point in the future (indeterminate), but that is about it
p12581
aVA finalizer wouldn't add much here, as any encapsulated objects will also already be eligible for collection (assuming that they aren't referenced elsewhere)
p12582
as(dp12583
g18
V23354
p12584
stp12585
a((dp12586
g2
(lp12587
VUseful cases for GAC:
p12588
aVCOM-callable code - i
p12589
ag50
aVyou want some non-
p12590
aVNET code to be able to access you without messing with dlls etc
p12591
aVServiced Components (COM+)
p12592
aVIf you are writing code that is so common it is actually meaningful to use GAC - primarily
p12593
aVNET framework components etc
p12594
aVIf you want to use NGEN to pre-JIT the code
p12595
aVOther than that, I tend to avoid the GAC like the plague
p12596
aVIt is far easier to just deploy the necessary dlls with your app via  etc; this gives isolation and easy deployment
p12597
as(dp12598
g18
V23354
p12599
stp12600
a((dp12601
g2
(lp12602
VIf you already have the contract dll at the client, you don't even need a service reference (unless you are using it to write the setup code for you) - you can simply subclass ClientBase and expose the Channel, and use that directly - something like (no IDE handy
p12603
ag6864
aVThen you can just do things like:
p12604
aVYou still need the configuration settings in the config to determine the address, binding, etc - but less messy than proxy generation
p12605
aVAlso, you might choose to re-implement  to deal with the fact that WCF proxies can throw in  (which is bad):
p12606
as(dp12607
g18
V23354
p12608
stp12609
a((dp12610
g2
(lp12611
VAs always, it depends ;-p
p12612
aVIf you want to use the LINQ extension methods or query syntax, then no: this is tightly coupled to , where  is the source type
p12613
aVGenerics might be an option, depending on the scenario:
p12614
aVThe above could be made to work with LINQ-to-SQL, for example, by using  (and specially hand-crafted data objects)
p12615
aVOf course, to get from a string to generics you'd have to use reflection () - so not trivial
p12616
aVCan you clarify the exact scenario here
p12617
aVIt sounds like maybe you should just use a regular command here
p12618
aVfor example, perhaps with ExecuteQuery, which takes a string command and loads the data into typed objects
p12619
as(dp12620
g18
V23354
p12621
stp12622
a((dp12623
g2
(lp12624
VWell, designers tend to use Expression Blend, which is a powerful xaml designer
p12625
aVBut yes, I know a lot of developers who edit xaml as text and find it easier than designers
p12626
as(dp12627
g18
V23354
p12628
stp12629
a((dp12630
g2
(lp12631
V(edit: assumes web usage; protocol not clear in original question)
p12632
aVCan you use WCF
p12633
aVThe  supports non-public members:
p12634
aVIf not, you'll have to simply consider it a DTO, and make the property public
p12635
aVOther options - binary serialization
p12636
aVBinaryFormatter is not portable between platforms (so not ideal for all web services), but things like protocol buffers are more friendly
p12637
aVBut there is no WDSL support for this, nor any IPC stack (it is raw data only)
p12638
as(dp12639
g18
V23354
p12640
stp12641
a((dp12642
g2
(lp12643
VFirstly, it begs the question: why is the repository returning the UI types
p12644
aVIf the repo returned the database types, this wouldn't be an issue
p12645
aVConsider refactoring so that the repo deals only with the data model, and the UI does the translation at the end (after any composition)
p12646
aVIf you mean "and have it translate down to the database" - then basically, no
p12647
aVComposable queries can only use types defined in the LINQ-to-SQL model, and a handful of supported standard functions
p12648
aVSomething similar came up recently on a related question, see here
p12649
aVFor some scenarios (unusual logic, but using the typed defined in the LINQ-to-SQL model), you can use UDFs at the database, and write the logic yourself (in TSQL) - but only with LINQ-to-SQL (not EF)
p12650
aVIf the volume isn't high, you can use LINQ-to-Objects for the last bit
p12651
aVJust add an  before the affected  - this will do this bit of logic back in managed
p12652
aVNET code (but the predicate won't be used in the database query):
p12653
as(dp12654
g18
V23354
p12655
stp12656
a((dp12657
g2
(lp12658
VShould  be a  rather than an
p12659
aVIt is more efficient to cast a single varchar to a guid and compare the guids than it is to cast all the guids to varchar, and hope that it uses the same format (else equality will fail anyway)
p12660
aVAs others have pointed out, the  clause looks funky, but my money is on the varchar conversion being the culprit
p12661
as(dp12662
g18
V23354
p12663
stp12664
a((dp12665
g2
(lp12666
VThat is just how  works; with auto-generate columns enabled, extra (unmapped) columns are appended to the end
p12667
aVYou can unbind and re-bind to fix it; set the DataSource to null and back to the table:
p12668
as(dp12669
g18
V23354
p12670
stp12671
a((dp12672
g2
(lp12673
VCan I ask: why don't you want the individual properties
p12674
aVThat is the idiomatic
p12675
aVNET way of expressing the data associated with an object
p12676
aVPersonally, assuming the data isn't sparse, I would keep the properties and have the overall method use reflection - this will make your compiled code as fast as possible:
p12677
aVOf course, if you don't care about the properties themselves being defined, then an indexer and lookup (such as dictionary) would be OK
p12678
aVThere are also things you might be able to do with postsharp to turn a set of properties into a property-bag - probably not worth it, though
p12679
aVIf you want the properties available for data-binding and runtime discovery, but can't define them at compile-time, then you would need to look at dynamic type descriptors; either  or  - a fair bit of work, but very versatile (let me know if you want more info)
p12680
as(dp12681
g18
V23354
p12682
stp12683
a((dp12684
g2
(lp12685
VA bit indirect, but there are  constants:
p12686
aVbut no "DELETE" - suggest you make your own
p12687
aVAnnoyingly, there is a , but it is , so not usable - and it is an enum, so to use the name in an attribute you'd need a bit of hackery
p12688
as(dp12689
g18
V23354
p12690
stp12691
a((dp12692
g2
(lp12693
VIf you mean the number of public properties, use explicit interface implementation
p12694
aVIf you mean fields (and object space for sparse objects): you can always use a property bag for the property implementation
p12695
aVFor a C# example:
p12696
aVwith a dictionary for the values:
p12697
aVNote that  would also be a good place for any notifications - for example,  in
p12698
aVNET to implement the observer pattern
p12699
aVMany other architectures have something similar
p12700
aVYou can do the same with object keys (like how  works), but string keys are simpler to understand ;-p
p12701
aVThis only then takes as much space as the properties that are actively being used
p12702
aVA final option is to encapsulate the various facets;
p12703
aVHere  doesn't implement any of the interfaces, but provides access to them as properties
p12704
as(dp12705
g18
V23354
p12706
stp12707
a((dp12708
g2
(lp12709
VGenerally, objects should internally handle multiple  calls, and only do the main code once; so a stream getting d multiple times is not usually a problem
p12710
aVPersonally, I would use lots of  there; note that you don't need to indent/nest, though (unless different levels have different life-times):
p12711
aVAs you say, this ensures that if an error happens during initialization, everything is still cleaned up correctly
p12712
aVThis also ensures that every level gets a chance (in the right order) to deal correctly with any buffered data, etc
p12713
aVRe ownership;  is actually an oddity in the first place
p12714
aVmost streams are either input xor output
p12715
aVbends a few rules and shims two directions into one API; so this is an exception
p12716
aVnormally the ownership would be clearer
p12717
aVAdditionally, many wrappers have a flag to determine whether they should close the wrapped stream
p12718
aVdoesn't, but some do (such as , which has a  ctor option)
p12719
aVIf you don't want to flow ownership, this is an option - or use a non-closing stream intermediary - one is here ( or similar)
p12720
aVRe books; I picked up a copy of "TCP/IP Sockets in C#: Practical Guide for Programmers" (here) - adequate, but not great
p12721
as(dp12722
g18
V23354
p12723
stp12724
a((dp12725
g2
(lp12726
VWell, I doubt  uses  - more likely it uses jQuery / load to simply update a div, using ASP
p12727
aVNET MVC as the source (rather than ASP
p12728
aVNET vanilla, which has a more complex page cycle)
p12729
aVWith this approach, it is trivial
p12730
aVthe jQuery examples tab largely says it all
p12731
aVRe returning the Json - that is simply  from the controller in ASP
p12732
aVNET MVC - but personally I'd return the html (simpler)
p12733
as(dp12734
g18
V23354
p12735
stp12736
a((dp12737
g2
(lp12738
VHave you renamed it
p12739
aVChanged the base/project namespace
p12740
aVIn particular look at  - is that the correct name
p12741
aVFor simplicity, consider re-creating the page, copying the markup etc
p12742
as(dp12743
g18
V23354
p12744
stp12745
a((dp12746
g2
(lp12747
Vre the efficiency question; the two are identical, and in release mode will be reduced to the same thing
p12748
aVEither way,  is a reference-type, so the  itself is always on the heap
p12749
aVThe only thing on the stack would be the reference to the  - a few bytes (no matter the string length)
p12750
aVdo all local variables go on the stack": no; there are two exceptions:
p12751
aVcaptured variables (anonymous methods / lambdas)
p12752
aViterator blocks ( etc)
p12753
aVIn both cases, there is a compiler generated class behind the scenes:
p12754
aVis similar to:
p12755
aVHence  is on an object, hence on the heap
p12756
aVIterator blocks work in a similar way, but with the state machine
p12757
as(dp12758
g18
V23354
p12759
stp12760
a((dp12761
g2
(lp12762
VWith LINQ, and using C# (I don't know VB much these days):
p12763
aVor (shorter and more efficient, but arguably less clear):
p12764
aVIf you were testing equality, it would be worth looking at  etc, but this won't help with partial matches unless you split it into fragments and add an order of complexity
p12765
aVupdate: if you really mean "StartsWith", then you could sort the list and place it into an array ; then use  to find each item - check by lookup to see if it is a full or partial match
p12766
as(dp12767
g18
V23354
p12768
stp12769
a((dp12770
g2
(lp12771
VIf the person was created as an employee, then just cast:
p12772
aVIf the person is just a person: you can't; you could have the employee encapsulate the Person - or you can copy the fields:
p12773
aVor
p12774
as(dp12775
g18
V23354
p12776
stp12777
a((dp12778
g2
(lp12779
V2 will be a performance killer (the necessary dynamic/relection invoke in particular is slow)
p12780
aV1 is a common answer to this problem, especially with explicit implementation; the problem is getting hold of the type
p12781
aVdoes unity allow query with a  instance, rather than via generics
p12782
aVIf so something like below
p12783
aVof course, you might still have to use :
p12784
aVWhere  is perhaps via
p12785
aVFor similar reasons, it might be helpful to expose the  as a  on the :
p12786
aVOf course, an (optional) base-class might allow you to avoid some of this per-implementation:
p12787
as(dp12788
g18
V23354
p12789
stp12790
a((dp12791
g2
(lp12792
VDaft question, but isn't that the purpose of the Contributions Directory
p12793
aVThere is an example of automatic property-change implementation - INotifyPropertyChanged
p12794
as(dp12795
g18
V23354
p12796
stp12797
a((dp12798
g2
(lp12799
VYou shouldn't split for memory reasons
p12800
aVthe reason to split is usually to avoid having to re-download everything in case of failure
p12801
aVIf memory is an issue, you are doing it wrong
p12802
aVyou shouldn't be buffering in memory, for example
p12803
aVThe easiest way to download a file is simply:
p12804
aVRe your split/join code - again, the problem is that you are buffering everything in memory;  is a bad thing unless you know you have small files
p12805
aVWhat you should have is something like:
p12806
aVThis uses a moderate buffer to pump data between the two as a stream
p12807
aVA lot more efficient
p12808
aVThe loop says:
p12809
aVtry to read some data (at most, the buffer-size)
p12810
aV(this will read at least 1 byte, or we have reached the end of the stream)
p12811
aVif we read something, write this many bytes from the buffer to the output
p12812
as(dp12813
g18
V23354
p12814
stp12815
a((dp12816
g2
(lp12817
VIn general, I try to work with short-lived locks where I can do an entire unit of work in a single (serializable) transaction; this avoids the need for an additional locking mechanism, as the db locks will do everything needed
p12818
aVWhen working with long-lived locks:
p12819
aVIt is a bad idea to use rdbms-locks for that purpose - it simply doesn't scale
p12820
aVTimestamp or row-version columns are a good way of doing optimistic concurrency to prevent against accidental over-writing
p12821
aVTo publish / enforce the fact that a row is being edited, I would store the user-id/user-name of the locking user in a column (null if not locked)
p12822
aVThis makes it clear who owns the row - i
p12823
ag50
aVwhen you want to edit the row, first UPDATE it, setting your user-id (and ensuring that it isn't already locked)
p12824
aVTo cope with locks that aren't removed correctly (because of a dead terminal etc) there are 3 common options:
p12825
aVwhen the lock owner logs in again, allow them to break their own locks
p12826
aVallow an administrator to break the user's locks
p12827
aVstore a lock-timeout column (datetime), and have a scheduled task automatically unlock rows that are overdue
p12828
aVSo to summarise - consider something like:
p12829
aVetc
p12830
as(dp12831
g18
V23354
p12832
stp12833
a((dp12834
g2
(lp12835
VFirst, I wonder if the entire scenario isn't a little artificial; are you really going to need this level of abstraction
p12836
aVPerhaps subscribe to YAGNI
p12837
aVWhy does your  only work with a
p12838
aVCan it work with an
p12839
aVThat would be a better use of interfaces, and would avoid this entire issue
p12840
aVOne option might be a bit of a re-design, so that the  just describes the metadata for the font (size, font-face, etc), and you have things on the concrete  like:
p12841
aVand it becomes the job of the graphics to do the translation - so then used something like:
p12842
aVOf course,  might need translation too ;-p
p12843
as(dp12844
g18
V23354
p12845
stp12846
a((dp12847
g2
(lp12848
VYou can use the TryParse pattern:
p12849
as(dp12850
g18
V23354
p12851
stp12852
a((dp12853
g2
(lp12854
VI'm not sure that "decent design" and "never get concrete UI definition" are that connected
p12855
aVpersonally, I'm an "under the bonnet" guy, so I concentrate on the underlying design/architecture - as long as the overall use-cases are understood (i
p12856
ag50
aV"I'm going to need to be able to get all [this] info efficently given just [this], etc") then you should be able to design the overall system (and unit test it) independently of the UI
p12857
aVOr do you just mean the UI design
p12858
aVWell, regarding the UI; if you have separate design ("pretty") and developer ("code") heads, then consider WPF; the xaml split between blend and VS allows much cleaner separation, allowing your designers to tweak the UI largely in isolation (give or take a few hooks to the dev team)
p12859
aVFor deployment; ClickOnce is pretty painless if it is an option
p12860
as(dp12861
g18
V23354
p12862
stp12863
a((dp12864
g2
(lp12865
VA daily task
p12866
aVSounds like it should just be a scheduled task (control panel) - no need for a service here
p12867
as(dp12868
g18
V23354
p12869
stp12870
a((dp12871
g2
(lp12872
VWell, the first is more expressive of your intent
p12873
aVThe last is clearly messy (hard-coded length etc)
p12874
aVI doubt you'd find much performance difference between the first & second, so I'd use the simplest -
p12875
aVOf course, if you are doing this lots, you could write a udf that encapsulates this - then if you change your mind you only have one place to change
p12876
as(dp12877
g18
V23354
p12878
stp12879
a((dp12880
g2
(lp12881
VI would always pass the stream into the function
p12882
aVThis allows it to work with any stream of the caller's choosing, for example straight into a file without any buffering
p12883
as(dp12884
g18
V23354
p12885
stp12886
a((dp12887
g2
(lp12888
VI wonder if you can't use something like:
p12889
as(dp12890
g18
V23354
p12891
stp12892
a((dp12893
g2
(lp12894
VI expect so, yes
p12895
aVA quick test agrees (but this is not evidence):
p12896
aVIn general, try to work with comparers that do what you want
p12897
aVFor example, if you want a case-insensitive dictionary, use one:
p12898
aVLikewise:
p12899
as(dp12900
g18
V23354
p12901
stp12902
a((dp12903
g2
(lp12904
VSo, kinda like virii, then
p12905
as(dp12906
g18
V23354
p12907
stp12908
a((dp12909
g2
(lp12910
VHowever, you'd need to write your own translation () to your type; and the  would still be using LINQ-to-Objects; the only purpose (in this scenario) of using  over  would be to use expressions for some other reason - perhaps for the dynamic LINQ library
p12911
as(dp12912
g18
V23354
p12913
stp12914
a((dp12915
g2
(lp12916
VIf the controls are freely placed, then yes - you'd have to move things up or down
p12917
aVYou can reduce the amount of work by encapsulating groups of related controls into panels: then you just have to move the panels
p12918
aVIf the panels are docked (for example, "top") - then just hide / show the panel and everything should fall into place automatically
p12919
as(dp12920
g18
V23354
p12921
stp12922
a((dp12923
g2
(lp12924
VNot quite the same, but note that ClickOnce installs are generally per-user - more comparable to  than the GAC, though
p12925
as(dp12926
g18
V23354
p12927
stp12928
a((dp12929
g2
(lp12930
VThat is a type alias, not a namespace alias; it is useful to disambiguate - for example, against:
p12931
aV(ps: thanks for the choice of  ;-p)
p12932
aVOtherwise, if you use both  and  in the same file you'd have to keep giving the full names (since  could be confusing)
p12933
aVIt also plays a part with  aliases for using types with the same fully-qualified type name from different assemblies - rare, but useful to be supported
p12934
aVActually, I can see another use: when you want quick access to a type, but don't want to use a regular  because you can't import some conflicting extension methods
p12935
aVa bit convoluted, but
p12936
aVhere's an example
p12937
as(dp12938
g18
V23354
p12939
stp12940
a((dp12941
g2
(lp12942
VActually, I very rarely use a catch block except for logging purposes
p12943
aVis much more common for me
p12944
aVMost times,  or  do everything I can usefully do (and indeed, that is a  also)
p12945
aVEric Lippert has a blog entry on exceptions that may be useful
p12946
as(dp12947
g18
V23354
p12948
stp12949
a((dp12950
g2
(lp12951
VThis is now done via the http "Accept" header; use "application/json" for json
p12952
aVYou could try "text/xml" for POX, but it isn't mentioned in the article here
p12953
aV(update: text/xml will return atom, based on the table here)
p12954
as(dp12955
g18
V23354
p12956
stp12957
a((dp12958
g2
(lp12959
VHave you tried catching/logging any exceptions
p12960
aVThe most likely cause is security (i
p12961
ag50
aVthe service account not having access to some resource)
p12962
aVThere is also often an isue locating the
p12963
aVconfig file for a service (watch that if you are using config)
p12964
aVFinally, for simplicity, try using a command arg just in case  is reporting incorrectly - I tend to use "-c" for console/debug mode
p12965
as(dp12966
g18
V23354
p12967
stp12968
a((dp12969
g2
(lp12970
VIt has been argued that objects shouldn't be responsible for this; their job is to represent instantiated object; it is the job of another (repository) class to persist it
p12971
aVObjectContext can be a pain when it comes to attaching/detaching objects, since (unlike LINQ-to-SQL) there is a much tighter coupling between the context and the entity
p12972
aVPersonally, I wouldn't use this approach; I'd use the entity itself (or a working copy) as a transient unit of work along with a short-lived context
p12973
as(dp12974
g18
V23354
p12975
stp12976
a((dp12977
g2
(lp12978
VMost of the time, people want names, not ints
p12979
aVYou could add a shim property for the purpose
p12980
aVOr you could use , but that is lots of work
p12981
as(dp12982
g18
V23354
p12983
stp12984
a((dp12985
g2
(lp12986
VYou are blocking the UI thread - no updates will usually show until you leave the event-handler
p12987
aVA hacky approach is to use , but this is lazy and risks re-entrancy especially if you are pausing
p12988
aVA better approach is to do the work on a background thread, and use  to push the data to the UI (don't talk to the UI from the worker thread)
p12989
aVOr just add individual items in separate ticks
p12990
aVHere's an example using  for the work, using  to push items onto the UI:
p12991
as(dp12992
g18
V23354
p12993
stp12994
a((dp12995
g2
(lp12996
VI suspect recursion may be an issue; by default (if not set explicitly) a control inherits color from the parent
p12997
aVThis leads to the scenario where the child's color (if not set) asks the parent, which asks the child (forever)
p12998
aVTextBox, however, overrides this behaviour to return  if there isn't an explicit color set
p12999
aVHence no recursion
p13000
aVEither way, I'm not sure this is a good idea - the designer might start duplicating controls if you aren't careful
p13001
as(dp13002
g18
V23354
p13003
stp13004
a((dp13005
g2
(lp13006
VTry this:
p13007
aVAside: it is close to the format used in xml, but not quite close enough - otherwise  wraps this:
p13008
as(dp13009
g18
V23354
p13010
stp13011
a((dp13012
g2
(lp13013
VYou can do this with  in any version of
p13014
aVNET (except Silverlight, where only  exists):
p13015
as(dp13016
g18
V23354
p13017
stp13018
a((dp13019
g2
(lp13020
VI suspect the difference is that one is a regular argb color, and one is a system/known color
p13021
aVControls in
p13022
aVNET keep track of whether the color is explicit (set on this control) or inherited
p13023
aVThis makes it hard to change back properly
p13024
aVbut you might be able to do it with , like so:
p13025
aVA bit clunky, but it should work
p13026
as(dp13027
g18
V23354
p13028
stp13029
a((dp13030
g2
(lp13031
VYou are only copying a reference (think "pointer"); the two references are separate (but happen to have the same value), but there is only a single string object
p13032
as(dp13033
g18
V23354
p13034
stp13035
a((dp13036
g2
(lp13037
VHow about polymorphism on  - i
p13038
ag50
aVa virtual method
p13039
aVIf this isn't appropriate (separation of concerns etc), then the overload would seem preferable
p13040
aVRe web-methods; very different: neither polymorphism nor overloading are very well supported (at least, not on basic-profile)
p13041
aVThe detection option "Check for type here and do something" might be the best route
p13042
aVOr have different named methods for each type
p13043
aVper request:
p13044
as(dp13045
g18
V23354
p13046
stp13047
a((dp13048
g2
(lp13049
VThere is no SQL for arbitrary delegates
p13050
aVIf  can be expressed as a lambda, you can invoke the lambda as a sub-expression using , but you'd need to build the expression tree yourself, like so
p13051
as(dp13052
g18
V23354
p13053
stp13054
a((dp13055
g2
(lp13056
VUnfortunately, there is no mixin support in C#
p13057
aVSo you'd need to implement all methods, or use some heavy-duty reflection
p13058
aVemit to do it
p13059
aVThe other alternative is an (optional) proxy /decorator base class
p13060
aVthen
p13061
aVNoting that use of the  is strictly optional; any IFoo is allowed
p13062
as(dp13063
g18
V23354
p13064
stp13065
a((dp13066
g2
(lp13067
VIIRC, you can have different prefixes - but only one per protocol - so you could have a tcp prefix, and perhaps an https prefix (need to check that one)
p13068
aVHowever, you should also be able to give the full address on the service, rather than using the base-address and relative portion
p13069
aVYou might need multiple endpoints, though
p13070
as(dp13071
g18
V23354
p13072
stp13073
a((dp13074
g2
(lp13075
VYou've got two answers that cover generics
p13076
aVjust an aside: it is unusual is C# to need , since you are already passing just the reference ( is a reference-type object)
p13077
aVThe  is needed only if you are assigning new lists inside the method and want the client to see the re-assignment
p13078
aVChanges to the list(s) will already be seen without the
p13079
as(dp13080
g18
V23354
p13081
stp13082
a((dp13083
g2
(lp13084
VHow about  in 3
p13085
ag691
aVI recently wrote an expression parser/compiler using this
p13086
as(dp13087
g18
V23354
p13088
stp13089
a((dp13090
g2
(lp13091
VIs the IIS folder set as an application
p13092
aVIt should have a cog icon in the IIS explorer
p13093
as(dp13094
g18
V23354
p13095
stp13096
a((dp13097
g2
(lp13098
VHow about , catching the exception if it isn't installed
p13099
as(dp13100
g18
V23354
p13101
stp13102
a((dp13103
g2
(lp13104
VGenerally, you need to show splash screens on a separate thread, and let the primary thread carry on with loading
p13105
aVNot trivial - in particular, you will need to use  to ask the splash screen to close itself when ready (thread affinity)
p13106
as(dp13107
g18
V23354
p13108
stp13109
a((dp13110
g2
(lp13111
V"Name" should be "name" - likewise "Location" to "location"
p13112
as(dp13113
g18
V23354
p13114
stp13115
a((dp13116
g2
(lp13117
VThe second is safe; the first isn't
p13118
aVWith , the variable is declared outside the loop - i
p13119
ag50
aVThis means that there is only 1  in terms of the closure scope, and the threads might very likely get confused - calling the method multiple times on some instances and not at all on others
p13120
aVYou can fix this with a second variable declaration inside the loop:
p13121
aVThis then has a separate  in each closure scope, so there is no risk of this issue
p13122
aVHere's a simple proof of the problem:
p13123
aVOutputs (at random):
p13124
aVAdd a temp variable and it works:
p13125
aV(each number once, but of course the order isn't guaranteed)
p13126
as(dp13127
g18
V23354
p13128
stp13129
a((dp13130
g2
(lp13131
VI suspect the better approach here would be to set the app-pool's identity to have access (no impersonation)
p13132
aVAlso, ensure you are using UNC paths - not network share names ("\u005c\u005cfoo\u005cbar", not "f:" etc)
p13133
as(dp13134
g18
V23354
p13135
stp13136
a((dp13137
g2
(lp13138
VHave you tried setting Precision and Scale
p13139
aVNote you need to cast first
p13140
as(dp13141
g18
V23354
p13142
stp13143
a((dp13144
g2
(lp13145
VWell, are the long names hurting something
p13146
aV(edit) two other thoughts:
p13147
aVuse  in C# 3
p13148
aV0 - that'll save half the width
p13149
aVif you are using the type multiple times in a file, consider a type alias if it is annoying you:
p13150
as(dp13151
g18
V23354
p13152
stp13153
a((dp13154
g2
(lp13155
VPerhaps consider a serializer that isn't tied to the type and field-names
p13156
aVFor example, protobuf-net is a binary serializer, but uses numeric tags set (via an attribute) against each member
p13157
aVThis means:
p13158
aVserialization isn't tied to the assembly version at all
p13159
aVthe field name information isn't in the serialized file
p13160
aV(by the above) it won't matter whether the code is obfuscated
p13161
aV(and) the file can't be used to trivially break the obfuscation (although the data might still suggest intent unless encrypted)
p13162
aVFor example:
p13163
aVHere, the  is all that identified the member in the file
p13164
aVThe key here is that it is contract-based, so can be deserialized later with an unrelated type:
p13165
aV(which is fine since obfuscation preserves metadata, IIRC)
p13166
aVContrast this to other contract-based serializers (such as  or ) - where you would be forced to put the member-name in the attributes, which would pretty much render obfuscation pointless:
p13167
as(dp13168
g18
V23354
p13169
stp13170
a((dp13171
g2
(lp13172
VFirst  is easier to use; GET arguments are specified on the query-string - the only trick is to remember to escape any values:
p13173
as(dp13174
g18
V23354
p13175
stp13176
a((dp13177
g2
(lp13178
VHow do you mean
p13179
aVWhat exactly are you after
p13180
aVYou can create an exe project and change the output type (project properties)
p13181
aVor you can use  at the command line
p13182
as(dp13183
g18
V23354
p13184
stp13185
a((dp13186
g2
(lp13187
VFor loading csv, consider CsvReader - fully managed, very fast, and robust
p13188
aVI've used in in numerous projects
p13189
aVMore importantly, no messing with OLEDB
p13190
as(dp13191
g18
V23354
p13192
stp13193
a((dp13194
g2
(lp13195
VFirst - which version of Excel must you support
p13196
aVFor example, xslx (2007) is just a zip file with xml files inside - so you should be able to use #ZipLib and xml generation / copying
p13197
aVAnother option is to write CSV and let the user import it - obviously more appropriate for data than for calculations
p13198
aVThere is also the 2003 xml-spreadsheet format - with contents like:
p13199
aVPretty easy to create by hand
p13200
as(dp13201
g18
V23354
p13202
stp13203
a((dp13204
g2
(lp13205
VThis often happens if you have a partial class for the data-context (etc), and have a using statement before the namespace
p13206
aVFreaky, I know
p13207
aVso if you have (in your partial class):
p13208
aVTry rearranging:
p13209
aVI have no idea why, but this often fixes it
p13210
aVNote you might need to restart VS as well to get it working again, and maybe even go into the dbml designer
p13211
as(dp13212
g18
V23354
p13213
stp13214
a((dp13215
g2
(lp13216
VWhich version of VS are you using
p13217
aVI'm running VS2008 Team Suite (SP1), and I get all 8 templates mentioned
p13218
aVPerhaps try a re-install on a virtual machine, to see if it was an install failure
p13219
as(dp13220
g18
V23354
p13221
stp13222
a((dp13223
g2
(lp13224
VIf you are using C#, must it be xpath
p13225
aVFor example (edited to support multiple files with the same version - post mentioned plural):
p13226
aVOr with 2
p13227
aV0 (from OP comment):
p13228
as(dp13229
g18
V23354
p13230
stp13231
a((dp13232
g2
(lp13233
VIf you are subclassing , you can call  directly, or expose it on the API:
p13234
aVHowever, you can't do this for arbitrary controls
p13235
aVYou could change the  to-and-fro
p13236
aVAlternatively, you could use reflection, but that is hacky:
p13237
as(dp13238
g18
V23354
p13239
stp13240
a((dp13241
g2
(lp13242
VI expect you might have to put the data into a wrapper class - for example:
p13243
aVThen bind to a  instead (as ) - for example using something like (C# 3
p13244
aV0):
p13245
aVor C# 2
p13246
aV0:
p13247
as(dp13248
g18
V23354
p13249
stp13250
a((dp13251
g2
(lp13252
VThis can often relate to:
p13253
aVbad query plans due to over-eager plan-reuse (parameter sniffing)
p13254
aVdifferent SET options - in particular ANSI_NULLS and CONCAT_NULL_YIELDS_NULL
p13255
aVlocking (you might have a higher isolation level)
p13256
aVindexing needs to be rebuilt / stats updated / etc
p13257
aVThe SET options can lead to certain index types not being usable (indexes on persisted calculated columns, for example - including "promoted" xml/udf queries)
p13258
as(dp13259
g18
V23354
p13260
stp13261
a((dp13262
g2
(lp13263
VFuther to Anton's reply- note that this is also the only way to specify this type of thing in a lambda expression (for LINQ-to-[some db] etc)
p13264
aVThe downside is that if you are testing multiple things, it can get confusing
p13265
aVSee the discussion here for an example covering type-testing with/without predicates
p13266
as(dp13267
g18
V23354
p13268
stp13269
a((dp13270
g2
(lp13271
VFirst - writing xml through concatenation is really flakey - consider using  /  /  instead, which will automatically escape any necessary symbols (, , etc) rather than  result in invalid xml
p13272
aVDid you clear the response buffer before writing to it
p13273
aVIn reality, it would be a lot simpler to do this from a raw handler () than from within the aspx page life-cycle
p13274
aVOr switch to MVC, which works similarly to the ashx result
p13275
aVAlso - from within the jquery, you should probably speficy the  as  - see here
p13276
aVHere's an example of a suitable handler:
p13277
as(dp13278
g18
V23354
p13279
stp13280
a((dp13281
g2
(lp13282
V(edit: d'oh
p13283
aVWhile I was debugging you found it too
p13284
aVIn SQL Server:
p13285
as(dp13286
g18
V23354
p13287
stp13288
a((dp13289
g2
(lp13290
VThat can't be done in C#; you need to declare a new class type
p13291
aVThe closest you can get in C# is probably a named nested class:
p13292
as(dp13293
g18
V23354
p13294
stp13295
a((dp13296
g2
(lp13297
VFor 20 rows, just use linear scanning - it will be the most efficient in every way
p13298
aVFor larger sets; hzere's an approach using LINQ's  and delayed indexing:
p13299
as(dp13300
g18
V23354
p13301
stp13302
a((dp13303
g2
(lp13304
VYou can do this in this source by adding a reference to the second assembly and using  - but this might quickly get you into a circular mess of projects
p13305
aVYou can also specify these options at runtime, into the serializer's constructor:
p13306
aVRe the extension method; you could add a , and pass  into the  - then you can use it either as you do now, or as
p13307
as(dp13308
g18
V23354
p13309
stp13310
a((dp13311
g2
(lp13312
Vor slightly more verbose (but easier to understand):
p13313
as(dp13314
g18
V23354
p13315
stp13316
a((dp13317
g2
(lp13318
VWell, rather than use the IDE, you could use  at the command line via a build script
p13319
aVThen all you have to do is re-execute the bat/script/whatever
p13320
as(dp13321
g18
V23354
p13322
stp13323
a((dp13324
g2
(lp13325
VInterface members are a public API; things like  etc are implementation details - and interfaces don't have any implementation
p13326
aVI suspect what you are looking for is explicit interface implementation:
p13327
as(dp13328
g18
V23354
p13329
stp13330
a((dp13331
g2
(lp13332
VA
p13333
aVNET object has no persistance unless you write it yourself - for example by serializing to a file in the user's profile (or isolated storage for ClickOnce)
p13334
aVNote: personally, I wouldn't use  at all in this scenario; if you are downloading the data as a list of objects, then just keep them like that -  etc
p13335
aVRe xml: 9-10Mb is big but not immense
p13336
aVIt really depends on the nature of the data and other requirements; unless you are already using web-compression (GZIP etc), you might find that the data transfers quicker with a more compact format, such as csv, or a binary format such as protocol buffers
p13337
as(dp13338
g18
V23354
p13339
stp13340
a((dp13341
g2
(lp13342
VThe simplest answer is to be explicit: add a reference to B
p13343
aVdll and set it how you want it
p13344
as(dp13345
g18
V23354
p13346
stp13347
a((dp13348
g2
(lp13349
V would usually be fine (especially if  is immutable and unique) - the main idea is to avoid collisions
p13350
aVHowever, think also about pending data - what is the  of the 27 rows you haven't saved yet
p13351
aVAlso note that the  and  implementations must agree
p13352
as(dp13353
g18
V23354
p13354
stp13355
a((dp13356
g2
(lp13357
VIt really depends on the example
p13358
aVIf there is a need to know the parent (for example, to perform bidirectional navigation - like  etc) then you'll need it
p13359
aVThis only really works for a single parent
p13360
aVIf you just need change-notifications, then events might be more versatile - in particular, events allow for multiple "parents" without prejudice
p13361
aVIf the child doesn't need to care about the parent, then don't bother
p13362
as(dp13363
g18
V23354
p13364
stp13365
a((dp13366
g2
(lp13367
VWith WCF, you can do this by using  security (over SSL) and providing your own password validator
p13368
aVAt this point, however, you don't (I'm told) have access to the client IP; for that you'd need to check the IP in your method itself - you can do this using , like so
p13369
aVIf you don't want to go down the  route, then it is also valid (but ungainly) to pass the username and password as arguments to the method (as long as the transport is secure)
p13370
as(dp13371
g18
V23354
p13372
stp13373
a((dp13374
g2
(lp13375
V(repeated from here)
p13376
aVFirst - note that you can add constructors (and other code) to WCF classes - you just need to do it in a partial class (and leave the generated code alone)
p13377
aVIt sounds like the type of the items in the list need to be changed - so we can't just cast
p13378
aVReflection is an option, but is slow
p13379
aVSince you are using 3
p13380
aV5, we can perhaps write an  to do it for us more efficiently
p13381
aValong these lines, but using the second class too:
p13382
as(dp13383
g18
V23354
p13384
stp13385
a((dp13386
g2
(lp13387
VYou can use  (and execute it) - but this is a bit hit-n-miss
p13388
aVIt doesn't cover all scenarios (branches, etc) - and can still execute some code (extended stored procedures etc)
p13389
aVAlternatively - use table-valued-functions (udfs) - they have much richer/more-formal metadata
p13390
as(dp13391
g18
V23354
p13392
stp13393
a((dp13394
g2
(lp13395
V(Update re edit) If it is just for display purposes, you can probably just set the ToString() on the class that implements
p13396
aV(original)
p13397
aVNo - 2-way data binding wants either , or an  event
p13398
aVYou can shim this into a custom model by implementing  or , but then you need to write your own  implementation
p13399
aVRe  - that is  in  terms
p13400
as(dp13401
g18
V23354
p13402
stp13403
a((dp13404
g2
(lp13405
VAFAIK, you can't
p13406
aVI asked this at Barcelona a year or so ago - I don't think anything has changed
p13407
aVBasically, as I understand it, this is done directly (not via an editable snippet)
p13408
as(dp13409
g18
V23354
p13410
stp13411
a((dp13412
g2
(lp13413
VHow about simply putting that logic into  instead, and check
p13414
as(dp13415
g18
V23354
p13416
stp13417
a((dp13418
g2
(lp13419
VDoes it error if you use  directly at the command line
p13420
as(dp13421
g18
V23354
p13422
stp13423
a((dp13424
g2
(lp13425
VThis would work
p13426
aVWhen you say "because changes to cloneList seem to be affecting originalList
p13427
aV- do you mean changes to the list, or changes to the items
p13428
aVAdding / removing / swapping items is changing the list - so if we do:
p13429
aVyou should find that  is longer than
p13430
aVHowever, if the contents are reference-types (classes), then both lists are still pointing at the same underlying objects - so if we do:
p13431
aVthen this will also show against  - there is only a single object (shared between both lists)
p13432
aVIf this is the problem, you will have to clone the objects in the list - and then you get into the whole deep vs shallow issue
p13433
aVis this the problem
p13434
aVFor a shallow copy, you might be able to use something very much like the answer here - simply with  (perhaps simplify to a single )
p13435
as(dp13436
g18
V23354
p13437
stp13438
a((dp13439
g2
(lp13440
VAre you sure that the data is in pure ASCII
p13441
aVIs it perhaps in one of the many, many code-pages
p13442
aVIs it perhaps because of [CR] vs [LF] vs [CR][LF]
p13443
aVCan you tell use the bytes that are around "Players
p13444
aVAnd what you expect to see
p13445
aVWe might be able to recognize the code-page
p13446
aVPresumably the byte is either in the codepage zone (128-255), or control characters (0-31)
p13447
as(dp13448
g18
V23354
p13449
stp13450
a((dp13451
g2
(lp13452
VUnfortunately, the data-binding in  doesn't support regular (item) change notification events ( / )
p13453
aVHowever, if you know about the change, you can get the list to re-bind itself
p13454
aVSince you are subclassing, you can call:
p13455
aVor for a single item:
p13456
aVOtherwise, since this isn't public, you can simulate it by changing the :
p13457
aVA little hacky, maybe, but it works, and maintains the current selection etc (unlike clearing the )
p13458
as(dp13459
g18
V23354
p13460
stp13461
a((dp13462
g2
(lp13463
VNot a keyword - the null literal
p13464
aVan identifier (oops, no it isn't)
p13465
as(dp13466
g18
V23354
p13467
stp13468
a((dp13469
g2
(lp13470
VThe  method would be ambiguous, so I'm content with an explicit implementation
p13471
aVand  have similar behaviour
p13472
aVFor other (non-collection) curious explicit members - how about  and
p13473
aVRe the issue transferring between the two - you could always write a  extension method on
p13474
aVAlternatively - an  extension method goes a long way
p13475
aV(EDIT) You could also use a "fluent" API if you want to be able to use it as a single expression:
p13476
as(dp13477
g18
V23354
p13478
stp13479
a((dp13480
g2
(lp13481
VIn SQL 2008 there are table-valued-parameters, that make a friendly alternative to parsing CSV; see here for an example
p13482
aVOtherwise, another option is xml - the  data type in SQL Server allows you to read this pretty easily (although it takes more transfer bytes)
p13483
as(dp13484
g18
V23354
p13485
stp13486
a((dp13487
g2
(lp13488
VWell, it isn't entire clear what the scenario is, but the thing with random is you never can tell ;-p
p13489
aVAnything you try to do to "guarantee" thins will probably reduce the randomness
p13490
aVHow are you doing it
p13491
aVPersonally I'd do something like:
p13492
aVThis should be fairly uniform over the entire set
p13493
aVThe trick here is that by treating the queues as a single large queue, the tendency is that the queue's with lots of items will get dequeued more quickly (since there is more chance of getting an index in their range)
p13494
aVThis means that it should automatically balance consumption between the queues so that they all run dry at (roughly) the same time
p13495
aVIf you don't have LINQ, just change the first line:
p13496
aVExample usage:
p13497
as(dp13498
g18
V23354
p13499
stp13500
a((dp13501
g2
(lp13502
VIf you are using data-binding to a , then you are already updating the  /
p13503
aVIf you mean changes down to the database, then that is where adapters come into play
p13504
aVHere's an example:
p13505
as(dp13506
g18
V23354
p13507
stp13508
a((dp13509
g2
(lp13510
VWhy are you doing the Join
p13511
aVI would raise a callback at the end of each thread - perhaps decrementing a counter
p13512
aVWhen the counter gets to 0, then call back to the UI thread and do the "all done" code; something like:
p13513
as(dp13514
g18
V23354
p13515
stp13516
a((dp13517
g2
(lp13518
VWell, a common approach is some marker attribute, such as  (although this is just an example)
p13519
as(dp13520
g18
V23354
p13521
stp13522
a((dp13523
g2
(lp13524
VSince this is beta, perhaps try the feedback route
p13525
aVconnect
p13526
aVnewsgroup
p13527
as(dp13528
g18
V23354
p13529
stp13530
a((dp13531
g2
(lp13532
VTry putting the keys into a simple list and using Contains:
p13533
as(dp13534
g18
V23354
p13535
stp13536
a((dp13537
g2
(lp13538
VIt can potentially be a problem, yes:
p13539
aVthe old client may barf when receiving the unexpected property from the server
p13540
aVthe server may barf when not receiving the expected property from old clients
p13541
aVIt can also work
p13542
aVit just needs testing / planning
p13543
aVA safer option (if you have complex deployment that can't all go at once) is to consider the API sealed and add a new "v2" end-point etc
p13544
as(dp13545
g18
V23354
p13546
stp13547
a((dp13548
g2
(lp13549
VInteresting - I've done a lot with  and I haven't seen this
p13550
aVPerhaps the pragmatic option might be to build the columns manually
p13551
aVProbably not what you want to hear
p13552
as(dp13553
g18
V23354
p13554
stp13555
a((dp13556
g2
(lp13557
VYou need to use the "this" constructor:
p13558
aVDoing this calls the default constructor and by doing so, it initializes all the fields, thus allowing  to be referenced in the custom constructor
p13559
as(dp13560
g18
V23354
p13561
stp13562
a((dp13563
g2
(lp13564
VUnlike , you need to consume one service at a time, but you can re-use types from existing assemblies
p13565
aVWith , you can use the /reference switch
p13566
aVI believe you can also do this in the IDE in the designer
p13567
as(dp13568
g18
V23354
p13569
stp13570
a((dp13571
g2
(lp13572
VPersonally, I'd avoid the "state" param - it loses type safety (the cast isn't checked by the compiler)
p13573
aVAnonymous methods are cleaner:
p13574
as(dp13575
g18
V23354
p13576
stp13577
a((dp13578
g2
(lp13579
VPersonally, I wouldn't use constants here - they make it hard to spot errors (and since you probably aren't re-using them, don't add much)
p13580
aVFor example:
p13581
aVLooks suspect to me
p13582
aVAn easier approach is to write the xml you want to a file (, say) and use:
p13583
aVThen look at
p13584
as(dp13585
g18
V23354
p13586
stp13587
a((dp13588
g2
(lp13589
VMy first choice would be "use a  and let the user make their picks themselves" - this will save their sanity
p13590
aVwould you want to look for "ABCEFH" in a long list
p13591
aVIf you want the strings:
p13592
aVHow about just using binary arithmetic
p13593
ag412
ag50
aVuse a number (bit-length as per the number of elements), and simply keep incrementing, including the set bits each time
p13594
aVSo in C#, for example:
p13595
aVIf you want the data in the order per your example, LINQ is helpful:
p13596
as(dp13597
g18
V23354
p13598
stp13599
a((dp13600
g2
(lp13601
VI honestly don't know if this is supported during an installer - but my first question would be: are you calling  on
p13602
as(dp13603
g18
V23354
p13604
stp13605
a((dp13606
g2
(lp13607
Vthe trigger runs as part of the UPDATE statement (after the data in the table has been updated); the proc resumes after this
p13608
aVThere are also "instead of" triggers that replace the UPDATE statement
p13609
aVSee here for more
p13610
as(dp13611
g18
V23354
p13612
stp13613
a((dp13614
g2
(lp13615
VIt doesn't claim to be low priority - background means a: not the UI thread, and b: it won't keep a process alive
p13616
aVIn reality, it probably relates to  threads
p13617
aVIf you want a specific priority thread, then use your own  object - but I wouldn't recommend even this normally
p13618
aVAdditionally - "background" doesn't mean "when idle"
p13619
aVEven on a single core machine, you will probably see both threads get as much rnutime (if they want it)
p13620
aVEven more so on multi-core
p13621
as(dp13622
g18
V23354
p13623
stp13624
a((dp13625
g2
(lp13626
VIt looks thread-safe, but you might want to think about exception handling; setting a field shouldn't error (except perhaps ), but if the code was more complex, you'd want to ensure you release the mutex upon exception
p13627
aVI'd also look at  ("lock" in C#)
p13628
aVOne other thought: even if you lock the field access, an array is inherently mutable
p13629
aVConsider using  instead, since this is immutable
p13630
as(dp13631
g18
V23354
p13632
stp13633
a((dp13634
g2
(lp13635
VTrivial with System
p13636
aVNet
p13637
aVWebClient:
p13638
aVThere is also:
p13639
aVUploadData - binary ()
p13640
aVUploadFile - from a file
p13641
aVUploadValues - name/value pairs (like a form)
p13642
as(dp13643
g18
V23354
p13644
stp13645
a((dp13646
g2
(lp13647
VThe compiler removes all unused references, and doesn't deploy the dll unnecessarily
p13648
aVA  (by itself) does not count as a use
p13649
aVEither mark the dll for deployment via the "Copy to output directory" setting, or add some code that really uses types declared in the dll
p13650
as(dp13651
g18
V23354
p13652
stp13653
a((dp13654
g2
(lp13655
VThe strategy pattern doesn't necessarily knit well with the common interface-based repository approach
p13656
aVPersonally, I'd probably go one of two ways here:
p13657
aVOne search method that supports combinations of options:
p13658
aV(then selectively apply the combinations of filters (i
p13659
ag50
aVmeans "any") - either when building a command, or pass down to a SPROC that does something similar
p13660
aVWith LINQ, maybe a predicate expression
p13661
aVOf course, with LINQ you could also use composition by the caller, but that is harder to write a closed / fully-tested repository for:
p13662
aV(and have the caller use
p13663
aVWhere(x=>x
p13664
aVCategory == "foo")) - I'm not so sure about this last one long-term
p13665
as(dp13666
g18
V23354
p13667
stp13668
a((dp13669
g2
(lp13670
VWhat architecture
p13671
aVIn winforms () you can use the  event - that do
p13672
aVOn the older , there is the  event that works similarly
p13673
aVI'm not sure about WPF
p13674
aVThis demonstrates both ( first, then ):
p13675
as(dp13676
g18
V23354
p13677
stp13678
a((dp13679
g2
(lp13680
VASP
p13681
aVNET (and HTML generally) isn't directly suited to compete with flash - they simply work differently
p13682
aVPerhaps look at Silverlight; that is the MS offering that is closest to flash, and you can use C#
p13683
as(dp13684
g18
V23354
p13685
stp13686
a((dp13687
g2
(lp13688
VThe disabled state for most winform controls is largely fixed by the Win32 control set
p13689
aVIf  you don't like it, then either:
p13690
aVdon't actually disable it - just change the color manually, disable tab-stops, and ignore clicks while it is "kinda-disabled"
p13691
aVuse WPF, which has a completely separate implementation and doesn't suffer from the Win32 roots
p13692
aVwrite your own button control from scratch (don't touch the Win32 one)
p13693
aVuse a 3rd-party button control
p13694
as(dp13695
g18
V23354
p13696
stp13697
a((dp13698
g2
(lp13699
V(edit) What version of C# are you using
p13700
aVWith C# 3
p13701
aV0 you could place the "logic" bits (calculations etc) in extension methods in a busines logic assembly, but still see them via the DTO - i
p13702
ag50
aV(data layer)
p13703
aV(business layer)
p13704
aV(ui layer)
p13705
aVWhat model are you using to transfer the data
p13706
aVweb services
p13707
aVxml
p13708
aVdata-contracts
p13709
aVbinary
p13710
aVMost would allow you to ignore the extra properties without any extra code (i
p13711
ag50
aVno need for a wrapper/facade object):
p13712
ag6864
ag6864
aVIf you are talking binary, there are portable java/C#-friendly models such as "protocol buffers" - Jon Skeet has a C# port of the official java version (allowing you to use very similar code on both sides) - or I have a more C#-idiomatic version (protobuf-net):
p13713
ag6864
as(dp13714
g18
V23354
p13715
stp13716
a((dp13717
g2
(lp13718
VWell, you'll have to do it at the server to be able to e-mail - so at worst, simply:
p13719
aVIt might also be possible to do it directly within MVC - perhaps
p13720
as(dp13721
g18
V23354
p13722
stp13723
a((dp13724
g2
(lp13725
VNo, you don't need a  to do binding - in fact, most binding now is object based, especially with LINQ (which generates an object model, not a )
p13726
aVJust use the public property names (from your class) as the data-members for different columns, etc
p13727
as(dp13728
g18
V23354
p13729
stp13730
a((dp13731
g2
(lp13732
Vrun the work inside an AppDomain; use the primary AppDomain to monitor it (doesn't guard against process kill, though)
p13733
aVlots of exception handling
p13734
ag412
ag50
aVdon't let a fatal error tear down the process
p13735
aVrun it in something that already has recycling built in - IIS for example
p13736
as(dp13737
g18
V23354
p13738
stp13739
a((dp13740
g2
(lp13741
VWhich architecture
p13742
aVFor 1-way binding, you don't need anything other than public properties - and maybe some  implementations for any bespoke data types (s etc)
p13743
aVFor full 2-way binding, you'll need an eventing implementation - any of:
p13744
aVa "public event EventHandler FooChanged" for every property "Foo"
p13745
aVan `INotifyPropertyChanged implementation
p13746
aVa bespoke component-model (don't go there - overkill)
p13747
aVFor an example of a  implementation (note you might want to move some of the code for re-use) :
p13748
aVTo bind sets of data (grids etc), the easiest thing is to use generics; basically, the minumum is  - but you get extra metadata from a  indexer - which ,  etc all have
p13749
aVMore -  implements  allowing collection-based notification events (but only to  - not to the  pattern)
p13750
as(dp13751
g18
V23354
p13752
stp13753
a((dp13754
g2
(lp13755
VFurther to JaredPar's (correct) answer - also query syntax:
p13756
as(dp13757
g18
V23354
p13758
stp13759
a((dp13760
g2
(lp13761
VYou can always add a property to the data-context / entities objects in a partial class file:
p13762
aVThen any queries started from  will be pre-ordered (but still composable)
p13763
as(dp13764
g18
V23354
p13765
stp13766
a((dp13767
g2
(lp13768
VWhy not simply use the user's long date/time format(s)
p13769
as(dp13770
g18
V23354
p13771
stp13772
a((dp13773
g2
(lp13774
VThe best answer here simply is to create a new type
p13775
aVYou can do get anonymous types back from  (see here) but it is ugly and brittle
p13776
aVDon't do it
p13777
aVYou could use reflection () - but that also isn't a great idea
p13778
aVIn this case - perhaps use the existing  from the original select
p13779
aVOr your own
p13780
as(dp13781
g18
V23354
p13782
stp13783
a((dp13784
g2
(lp13785
VIf the form submit does a POST (submit) to the comments page (i
p13786
ag50
aVhas the action of the comments page, and the method of POST), then it is indeed the POST version that chouls be used
p13787
aVThe GET version would be used if you (for example) use a standard anchor/link to show the standalone comments page (or when issuing an AJAX "get" to that address)
p13788
aVHow are you currently hitting the pages
p13789
aVAt the moment it sounds like your index page is adding the form manually - so there is no place for the comments GET to be used, unless you are adding the form via AJAX
p13790
as(dp13791
g18
V23354
p13792
stp13793
a((dp13794
g2
(lp13795
VFor large corporations, SP1 might still be slow to deploy to desktops - simply that it is a fair amount of testing etc, and unless you've got a good reason to do it, you'd be tempted not to
p13796
aVAnd for individuals - it can be a big download unless you've got a fat pipe (which not everyone does)
p13797
aVFor example, at my work we've deployed to the web-servers (since they need it), but not to user desktops
p13798
aVIf I had a need to push SP1 I would, but I don't see much point until then
p13799
aVYou might also want to see if your code would run on Client Profile
p13800
aVThis is then only a <30MB install away
p13801
aValthough I've never actually seen anyone use Client Profile in anger (if you're going to have to do a deployment, heck: push the big one
p13802
aVSo it really depends: who are the users of this app
p13803
aVCan you strong-arm them to upgrade
p13804
aVOr at least "encourage" them ;-p
p13805
as(dp13806
g18
V23354
p13807
stp13808
a((dp13809
g2
(lp13810
VI would expect that  with  would be the fastest managed approach
p13811
aVIt certainly shouldn't take seconds to read 40KB
p13812
aVwhat is the input approach you are using
p13813
aVDo you perhaps have some external (schema etc) entities to resolve
p13814
aVIf so, you might be able to write a custom  (set via ) that uses locally cached schemas rather than a remote fetch
p13815
aVThe following does ~300KB virtually instantly:
p13816
as(dp13817
g18
V23354
p13818
stp13819
a((dp13820
g2
(lp13821
s(dp13822
g18
V23354
p13823
stp13824
a((dp13825
g2
(lp13826
VFor a dense 2D matrix, a rectangular array is ideal
p13827
aVWhat is the issue you are having with
p13828
aVNote that you can create dynamic arrays either with , or with generics:
p13829
aV(perhaps using  if you want to use ad-hoc types)
p13830
as(dp13831
g18
V23354
p13832
stp13833
a((dp13834
g2
(lp13835
VFirst - unless you are on
p13836
aVNET 1
p13837
aV1, you should a avoid  - prefer typed collections such as
p13838
aVWhen you say "copy" - do you want to replace, append, or create new
p13839
aVFor append (using ):
p13840
aVTo replace, add a  before the
p13841
aVOf course, if you know the second list is long enough, you could loop on the indexer:
p13842
aVTo create new:
p13843
as(dp13844
g18
V23354
p13845
stp13846
a((dp13847
g2
(lp13848
VDo you mean statically typed variables
p13849
aVNote that anonymous types are statically typed
p13850
aV(removed due to question edit)
p13851
aVThere are 2 problems with C# anonymous types:
p13852
aVyou can't expose them through a method API
p13853
aVyou can't mutate them (the members are read-only)
p13854
aVIf you only need to know about the data within a single method, and it is read-only, then an anonymous type is handy (and this covers a lot of cases, in reality)
p13855
aVIf you need to mutate the data or pass it out to a caller, then use either a bespoke class, or simple variables (etc)
p13856
aVIn the case given, I can't see a reason to use an anonymous type; if you just want the values, use the separate variable approach
p13857
aVIf a "message" has a defined meaning, declare a  class and populate that
p13858
as(dp13859
g18
V23354
p13860
stp13861
a((dp13862
g2
(lp13863
VI wonder
p13864
aVwhat does  return for a non-attached object
p13865
aVEven if it throws an exception, it'll probably be faster than a refresh
p13866
aV(update) - a test shows it returns null:
p13867
aVSo perhaps use  and check for null returned value
p13868
as(dp13869
g18
V23354
p13870
stp13871
a((dp13872
g2
(lp13873
VInteresting
p13874
aVHowever, at the CLI level there is no such thing as "out" - only "ref"; there is an attribute that helps compilers (for definite assignment) that says "you don't need to pass it in"
p13875
aVMaybe this restriction is because the CLI doesn't have "out", only "ref"
p13876
as(dp13877
g18
V23354
p13878
stp13879
a((dp13880
g2
(lp13881
VIf this is database-backed, try using navigation properties (if you have them defined):
p13882
aVOn Northwind, this generates the TSQL:
p13883
aVWhich does the job quite well
p13884
as(dp13885
g18
V23354
p13886
stp13887
a((dp13888
g2
(lp13889
VWhy is it "out of question for normal websites"
p13890
aVjQuery can do a lot of this fairly easily
p13891
aVIE does support calculations in styles, but it is not recommended, performs like a dog, and is completely incompatible with everything else
p13892
as(dp13893
g18
V23354
p13894
stp13895
a((dp13896
g2
(lp13897
V" This prevents using base
p13898
aVRead/WriteXml
p13899
aVTypically, if the base-class implemented , you might make it a  method so that the concrete version is used
p13900
aVTypically, you'd also use explicit implementation (rather than public properties) - perhaps with some  methods for the implementation details (although keeping track of where the reader/writer is across different classes would be a nightmare)
p13901
aVAFAIK, there is no way to re-use  to write the base bits, while you add the derived bits
p13902
aVis all-or-nothing
p13903
as(dp13904
g18
V23354
p13905
stp13906
a((dp13907
g2
(lp13908
VAs an aside
p13909
aVmost type-converters only work to/from strings
p13910
aVAnother interesting option here might be the static conversion operators defined against the type(s) - I have some
p13911
aVNET 3
p13912
aV5 code that does this in MiscUtil - see the  method mentioned here
p13913
aVRe your comment:
p13914
aVthe way I'm using this method is to
p13915
aVtranslate an EF object into a
p13916
aVDataContract object for WCF
p13917
aVso
p13918
aVList(Hotels)
p13919
aVConvertTo(SerializableHotels,
p13920
aVHotels)()
p13921
aVIt sounds like you should either be using serialization, or if the property names have a direct relationship, maybe something like  - this is again from MiscUtil (but some of Jon's work this time) - i
p13922
ag50
aVOther than that, you're probably better-off talking about a  rather than a
p13923
as(dp13924
g18
V23354
p13925
stp13926
a((dp13927
g2
(lp13928
VWhat is it you are trying to do
p13929
aVFor example,  will return an instance of , not an  (and for objects, you should probably be using  anyway)
p13930
aVIt feels like you want:
p13931
aVOf course, you could do this globally as an extension method via something like:
p13932
aV(edit includes  from question edit)
p13933
aV(I'm not sure it is much harder for the caller to do this themselves, though)
p13934
as(dp13935
g18
V23354
p13936
stp13937
a((dp13938
g2
(lp13939
VI suspect you might have to use regular ADO
p13940
aVNET and ExecuteReader/ExecuteScalar
p13941
as(dp13942
g18
V23354
p13943
stp13944
a((dp13945
g2
(lp13946
VIt looks like a bug handling the "+" marker for nested names
p13947
aVthe following (cheating with LINQ) works:
p13948
aVOf course, in most cases you would just use  or  (or maybe ) to test against an interface
p13949
aVwhat is the use-case here
p13950
as(dp13951
g18
V23354
p13952
stp13953
a((dp13954
g2
(lp13955
VImportant edit: this should be compatible and allow binding
p13956
aVCertainly worth a try, no
p13957
aVYes, this will cause problems if client/server are out of sync
p13958
aVNET remoting uses BinaryFormatterm which (without a bespoke  implementation) uses the field names
p13959
aVUsing automatic properties breaks the field names
p13960
aVAs long as you update client and server at the same time, it should work
p13961
aVAnother option is to use name-independent serialization, such as protobuf-net
p13962
aVI can provide an example if you want (it supports  usage)
p13963
aV(by the way, adding properties should not affect , since it is field-based)
p13964
aVAs requested, here's an example of using protobuf-net to control remoting serialization (taken directly from one of my unit tests); note that this will also be incompatible until both client and server agree, but should withstand changes after that (it is designed to be very extensible)
p13965
aVNote that there are lots of ways of using it - either explicit member notation (like data-contracts) or implicit fields (like ), etc (everything in between)
p13966
aVthis is just one way of using it:
p13967
aVHere, the bottom 2 methods satisfy , and simply pass execution to the protobuf-net engine
p13968
aVThe  defines fields (with unique identification markers)
p13969
aVAs already stated, it can also infer these, but it is safer (less brittle) to be explicit
p13970
as(dp13971
g18
V23354
p13972
stp13973
a((dp13974
g2
(lp13975
VI've already answered this for you a few days ago
p13976
aVIn your class, you need to do the translation:
p13977
aVetc
p13978
aVThe  is the version that  uses - but when invoked, it does the translation and passes the value through to  (which is ignored by  due to the attribute)
p13979
aVThis means you have a  on the class, and a number in the xml
p13980
as(dp13981
g18
V23354
p13982
stp13983
a((dp13984
g2
(lp13985
VIf you want to go crazy - here's a  that does notifications back on the UI thread automatically
p13986
aVHowever, it would still only be safe for one thread to be making updates etc at a time
p13987
as(dp13988
g18
V23354
p13989
stp13990
a((dp13991
g2
(lp13992
VYour xsl file should have:
p13993
aVan output of html
p13994
aVomit namespaces for all used in the xslt
p13995
ag412
ag50
aVAnd you should ideally use the overloads that accept either a  or a  (not ) - i
p13996
ag50
aVsomething like:
p13997
aVIn the xslt, if you really want standalone  /  (i
p13998
ag50
aVyou want it to be malformed for some reason), then you need to disable output escaping:
p13999
aVHowever, in general it is correct to escape the characters
p14000
as(dp14001
g18
V23354
p14002
stp14003
a((dp14004
g2
(lp14005
VThis is normally handled in the UsernamePasswordValidator - which is the only place you'll have access to the password
p14006
aVHowever, this isn't where you set the principal - that would be in the 's  method, which might look something like:
p14007
aV(where  is the name of our password validator)
p14008
aVWith this in place, the thread's principal will be set, and we can identify ourselves (and use roles-based security etc)
p14009
as(dp14010
g18
V23354
p14011
stp14012
a((dp14013
g2
(lp14014
VJust for info, C# 4
p14015
aV0 will have something like this sugar, but only when calling interop methods - partly due to the sheer propensity of  in this scenario
p14016
aVI haven't tested it much (in the CTP); we'll have to see how it pans out
p14017
as(dp14018
g18
V23354
p14019
stp14020
a((dp14021
g2
(lp14022
VIf you want all bits in the test mask to match:
p14023
aVIf you want any single bit in the test mask to match:
p14024
aVThe difference is most apparent when you are testing a value for multiple things
p14025
aVTo test for exclusion:
p14026
as(dp14027
g18
V23354
p14028
stp14029
a((dp14030
g2
(lp14031
VIt sounds like you are adding controls in the constructor
p14032
aVPerhaps add the columns slightly later - perhaps something like overriding ; you'll then be able to check  so you only add the columns during execution (not during design)
p14033
as(dp14034
g18
V23354
p14035
stp14036
a((dp14037
g2
(lp14038
VThat looks very unsafe (very little synchronization); how about something like:
p14039
aV(edit)
p14040
aVIn reality, you'd want a way to close the queue so that readers start exiting cleanly - perhaps something like a bool flag - if set, an empty queue just returns (rather than blocking):
p14041
as(dp14042
g18
V23354
p14043
stp14044
a((dp14045
g2
(lp14046
VNote that if the object you are talking about has a custom property model (such as  etc for ), then you need to use ; the good news is that this still works fine for regular classes (and can even be much quicker than reflection):
p14047
aVThis also provides easy access to things like  for formatting:
p14048
as(dp14049
g18
V23354
p14050
stp14051
a((dp14052
g2
(lp14053
VIf you mean the non-generic  class, then you can just override :
p14054
aVHowever, if you mean the generic  class, then note that there is no suitable virtual method to override
p14055
aVYou might do better to encapsulate the queue with your own class:
p14056
aV(** important edit: removed base-class
p14057
aV**)
p14058
aVHowever, looking at your code, it seems possible that you are using multiple threads here
p14059
aVIf that is the case, consider a threaded queue instead
p14060
as(dp14061
g18
V23354
p14062
stp14063
a((dp14064
g2
(lp14065
VThe lists make it tricky
p14066
aVmy earlier reply (below) only applies to like-for-like properties (not the lists)
p14067
aVI suspect you might just have to write and maintain code:
p14068
aVedit; only applies to shallow copies - not lists
p14069
aVReflection is an option, but slow
p14070
aVIn 3
p14071
aV5 you can build this into a compiled bit of code with
p14072
aVJon Skeet has a pre-rolled sample of this in MiscUtil - just use as:
p14073
aVBecause this uses a compiled  it will vastly out-perform reflection
p14074
aVIf you don't have 3
p14075
aV5, then use reflection or ComponentModel
p14076
aVIf you use ComponentModel, you can at least use  to get it nearly as quick as
p14077
as(dp14078
g18
V23354
p14079
stp14080
a((dp14081
g2
(lp14082
VWhenever they are a field on a class
p14083
aVUnusual examples of this:
p14084
aVa: When a value-type variable is captured:
p14085
aVThis is compiled to something more like:
p14086
aVb: When a value-type variable is used in an iterator block:
p14087
aV(the compiler generates a state machine to represent the iterator, of which all local variables (such as ) are fields)
p14088
as(dp14089
g18
V23354
p14090
stp14091
a((dp14092
g2
(lp14093
VNot unless you could the anchor styles (which has more)
p14094
aVI'd roll my own for this
p14095
aVIn the standard winforms library there are separate  and  that might be useful
p14096
as(dp14097
g18
V23354
p14098
stp14099
a((dp14100
g2
(lp14101
VTo work as above, you'd need to have it immutable (no setter) - perhaps with some implicit conversion operators for convenience
p14102
aVOtherwise, people could change the value without changing the (volatile) reference
p14103
aVBeyond that - locking would be the best option
p14104
as(dp14105
g18
V23354
p14106
stp14107
a((dp14108
g2
(lp14109
VIf you use  at the command line, you can pick the key with the  switch
p14110
aVThe  is just what the IDE chooses as a default; that way, you can use the same key from multiple apps
p14111
aVIn this scenario, it sounds like you might also want to create an assembly that purely represents the web-service (that all your web-applications reference); this will properly represent the fact that they represent the same essential service
p14112
as(dp14113
g18
V23354
p14114
stp14115
a((dp14116
g2
(lp14117
VBasically, you can't
p14118
aVis strictly constructive
p14119
aVThe only interesting thing you can do to customize  is to implement  and do everything yourself - not an attractive option (and it will still create new instances with the default constructor, etc)
p14120
aVIs  a strict requirement
p14121
aVIf you can use a different format, protobuf-net supports merging fragments into existing instances, as simply as:
p14122
as(dp14123
g18
V23354
p14124
stp14125
a((dp14126
g2
(lp14127
VNot directly
p14128
aVIndirectly, you could:
p14129
aVspin up a second , specify the config-file for that (), and execute the code in the app domain
p14130
aVhave two exes; the first () simply copies the config (into ) and shells the 2nd exe () [warning: thread race]
p14131
as(dp14132
g18
V23354
p14133
stp14134
a((dp14135
g2
(lp14136
VYou can use
p14137
aVOrderByDescending(
p14138
aV- but note that with the LINQ methods you are creating a new ordered list, not ordering the existing list
p14139
aVIf you have a  and want to re-order the existing list, then you can use  - and you can make it easier by adding a few extension methods:
p14140
aVThen you can use  and
p14141
as(dp14142
g18
V23354
p14143
stp14144
a((dp14145
g2
(lp14146
VCan I recommend - perhaps look at ClickOnce - a click-once application can be hosted on a network share, but has much better security deployment factors
p14147
aVYou just run the  rather than the  (VS2005 and VS2008 have all the tools you need to publish a ClickOnce application trivially)
p14148
aVAlso - in one of the recent service packs (perhaps with 3
p14149
aV5 SP1), I believe that mapped shares get more priveleges - so  would still error, but  (to the same location) should work
p14150
as(dp14151
g18
V23354
p14152
stp14153
a((dp14154
g2
(lp14155
VI would use a table-variable / temp-table; insert the values into this, and join to it
p14156
aVThen you can use the same set multiple times
p14157
aVThis works especially well if you are (for example) passing down a CSV of IDs as varchar
p14158
aVAs a SQL Server example:
p14159
as(dp14160
g18
V23354
p14161
stp14162
a((dp14163
g2
(lp14164
VIf the context is going to be disposed immediately, it probably isn't worth it - but here's a few thoughts:
p14165
aVperhaps write a "fluent" extension method for data-contexts (below)
p14166
aVmake it the default, by adding a partial  method that does it
p14167
aVFluent extension example:
p14168
aVThen you can use:
p14169
aVPartial method example:
p14170
as(dp14171
g18
V23354
p14172
stp14173
a((dp14174
g2
(lp14175
VI don't know about SQLite, but yes: I believe you'd want to use  with ClickOnce, since that points to the area in the user's profile where the app's data/settings can be stored
p14176
as(dp14177
g18
V23354
p14178
stp14179
a((dp14180
g2
(lp14181
VWith Delegate
p14182
aVBeginInvoke, the exception will be retrieved by calling
p14183
aVEndInvoke - which you must do anyway to prevent a leak
p14184
aVWith BackgroundWorker, it will appear on the completion event
p14185
aVOn a vanilla , an unhandled exception will tear down the process
p14186
aVHowever, the simplest approach is: don't let it throw
p14187
aVIf you currently aren't using , then perhaps switch to the above pattern and just use  directly (rather than )
p14188
as(dp14189
g18
V23354
p14190
stp14191
a((dp14192
g2
(lp14193
VWith regular ASP
p14194
aVNET (2
p14195
aV0) you would want to create a "handler"
p14196
aVThe easiest option is to add a "generic handler" (ashx) template - then put a regular link on the page to (for example) "download
p14197
aVashx
p14198
aVid=2"
p14199
aVInside the handler, parse the query-string, and stream the file to the user:
p14200
aVwhere  resolves the physical file from the query-string link
p14201
aVIf this was ASP
p14202
aVNET MVC, you could just use the  action-result
p14203
as(dp14204
g18
V23354
p14205
stp14206
a((dp14207
g2
(lp14208
VOnce you get more than a couple of these, then yes: it starts to get pretty slow
p14209
aVIn such cases, I tend to use generated TSQL - i
p14210
ag50
aVetc
p14211
aVNote that sp_ExecuteSQL caches query-plans, so any queries with the same args can potentially re-use the plan
p14212
aVThe downside is that unless you sign the SPROC, the caller needs SELECT permissions on the table (not just EXEC permissions on the SPROC)
p14213
as(dp14214
g18
V23354
p14215
stp14216
a((dp14217
g2
(lp14218
VFirst, web-services use  - so you'd need  for custom serialization
p14219
aVThe standard  serialization only acts on public properties that have both a getter and setter
p14220
aVSecond, structs generally don't work very well as web-service DTO objects; in particular,  demands things be mutable
p14221
aVwhich structs shouldn't be
p14222
aVI'd use a class, personally
p14223
aVIf you can give more info, I might be able to say more
p14224
aVFor example:
p14225
aV(note you can tweak the xml layout / names in various ways)
p14226
as(dp14227
g18
V23354
p14228
stp14229
a((dp14230
g2
(lp14231
VDelegate
p14232
aVEndInvoke is documented as a thou shalt call this (i
p14233
ag50
aVnecessary - else leaks happen) - from msdn:
p14234
aVImportant Note
p14235
aVNo matter which technique you use,
p14236
aValways call EndInvoke to complete your
p14237
aVasynchronous call
p14238
aVControl
p14239
aVEndInvoke is OK to ignore for fire-and-forget methods - from msdn:
p14240
aVYou can call EndInvoke to retrieve the
p14241
aVreturn value from the delegate, if
p14242
aVneccesary, but this is not required
p14243
aVHowever - if you are using  and don't want the result, consider using  instead - it'll make life a lot easier, and avoid the pain of  etc
p14244
as(dp14245
g18
V23354
p14246
stp14247
a((dp14248
g2
(lp14249
VThe main thing I can think of with  is that you have to use the  delegate type, which looks tricky if you already have a  instance and some args
p14250
aVThe good news is that you can fix this with a closure:
p14251
aVThis pattern also ensures you get proper strong typing at compile time (unlike passing an  state arg to  and casting it in the target method)
p14252
aVThis pattern can also be used when calling methods directly:
p14253
aVObviously, without an  equivalent, you also can't get a return value back out unless you call a method / raise an event / etc at the end of your method
p14254
aVon a related note, you need to be careful with exception handling
p14255
as(dp14256
g18
V23354
p14257
stp14258
a((dp14259
g2
(lp14260
VYou'd have to write a method - of course, with C# 3
p14261
aV0 it could be an extension method:
p14262
aVthen:
p14263
as(dp14264
g18
V23354
p14265
stp14266
a((dp14267
g2
(lp14268
VYou can configure the security with , without needing the msc
p14269
aVHowever, it would be easier to use ClickOnce deployment ("publish") from VS2005 - this avoids most of the security issues with network shares (but can be hosted on a network share)
p14270
as(dp14271
g18
V23354
p14272
stp14273
a((dp14274
g2
(lp14275
V(relates to messages/classes, not just primitives)
p14276
aVGoogle designed "protocol buffers" for this type of scenario (they shift a huge amount of data around) - their format is compact (using things like base-128 encoding) but extensible and version tolerant (so clients and servers can upgrade easily)
p14277
aVIn the
p14278
aVNET world, I can recommend 2 protocol buffers implementations:
p14279
aVprotobuf-net (by me)
p14280
aVdotnet-protobufs (by Jon Skeet)
p14281
aVFor info, protobuf-net has direct support for  and remoting (it is part of the unit tests)
p14282
aVThere are performance/size metrics here
p14283
aVAnd best of all, all you do is add a few attributes to your classes
p14284
aVCaveat: it doesn't claim to be the theoretical best - but pragmatic and easy to get right - a compromise between performance, portability and simplicity
p14285
as(dp14286
g18
V23354
p14287
stp14288
a((dp14289
g2
(lp14290
VEntity Framework supports only a subset of the sql functionality available (partly to remain compatible over a range of providers)
p14291
aVHowever, even LINQ-to-SQL (which supports a lot more SQL-Server specific constructs, such as UDFs) doesn't support full-text AFAIK
p14292
aVI believe you need to use a stored procedure / udf
p14293
aVThe UDF approach is preferred, as the metadata layer is much stronger, and it is composable at the db server - however, Entity Framework doesn't (or didn't, last time I checked) like UDFs ;-p So you may have to use a stored procedure
p14294
as(dp14295
g18
V23354
p14296
stp14297
a((dp14298
g2
(lp14299
VIsn't that just:
p14300
aVAlternatively, just put the xml into a file ("foo
p14301
aVxml") and use:
p14302
aVand look at the generated foo
p14303
aVcs
p14304
as(dp14305
g18
V23354
p14306
stp14307
a((dp14308
g2
(lp14309
VI'd probably use either a UDF/CTE, or (for very deep structures) a stored procedure that does the same manually
p14310
aVNote that if you can change the schema, you can pre-index such recursive structures into an indexed/ranged tree that lets you do a single BETWEEN query - but the maintenance of the tree is expensive (i
p14311
ag50
aVquery becomes cheap, but insert/update/delete become expensive, or you need a delayed scheduled task)
p14312
aVRe 2 - you can only  the type specified in the enumeration (the  in  / )
p14313
aVYou could  an  if the method returned  - does that make sense
p14314
aVImprovements:
p14315
aVperhaps a udf (to keep composability, rather than a stored procedure) that uses the CTE recursion approach
p14316
aVuse , since  is
p14317
aVso:
p14318
aVLoadWith is worth a try, but I'm not sure I'd be hopeful
p14319
aVthe list of searched ids is risky as a field - I guess you're OK as long as you don't call it twice
p14320
aVpersonally, I'd use an argument on a private backing method
p14321
aV(i
p14322
ag50
aVpass the list between recursive calls, but not on the public API)
p14323
as(dp14324
g18
V23354
p14325
stp14326
a((dp14327
g2
(lp14328
VI'd simplify it with an extension method to do the tricky lookup:
p14329
aV(updated 12/02/09 to exclude empty elements)
p14330
as(dp14331
g18
V23354
p14332
stp14333
a((dp14334
g2
(lp14335
VIt is unusual to write an extension method for an unrestricted
p14336
aVNot least, this approach will quickly make your intellisense quite hard to use
p14337
aVWhile valid, I'd probably avoid this as an extension method - perhaps just use a standard static utility method
p14338
aVThe C# 3 array initializer syntax might be easier
p14339
aVOf course, for large sets of data, you might want to cache a  somewhere ;-p
p14340
as(dp14341
g18
V23354
p14342
stp14343
a((dp14344
g2
(lp14345
VYou can't do this directly in C# - the enum type is not usable as a constraint
p14346
aVOne option (grungy) is to use a type-initializer (static constructor) to do the checking at runtime
p14347
aVIt'll stop it using inappropriate types at runtime, but not at compile time
p14348
as(dp14349
g18
V23354
p14350
stp14351
a((dp14352
g2
(lp14353
V(btw - the lambda-based predicates used with LINQ-to-SQL are C# 3
p14354
aV0 /
p14355
aVNET 3
p14356
aV5, not C# 2
p14357
aV0)
p14358
aVWell, what specifically are you trying to do
p14359
aVPredicates are just filters (either as a delegate or an Expression); they don't directly allow you to modify the TSQL etc, unless you combine them with functions that the LINQ-to-SQL provider can handle (these), or UDFs mapped onto your data-context as composable functions ()
p14360
aVAt the simplest:
p14361
aVwho are male AND > have zipcode = 90210
p14362
aVOr  for a non-trivial example (a dynamic search form / combining separately)
p14363
aVetc
p14364
aVYou can also build expression-based predicates by hand, but that is more work, and requires knowledge of the Expression API
p14365
as(dp14366
g18
V23354
p14367
stp14368
a((dp14369
g2
(lp14370
VIn addition to Andrey's reply (which I agree with, +1) - when  is done, you can also choose explicit implementation to make the public  return a typed object:
p14371
aVOf course there is a second issue with a generic  - inheritance
p14372
aVIf I have:
p14373
aVAnd I implemented , then do I implement
p14374
aVYou quickly start implementing a lot of identical interfaces
p14375
aVCompare to a cast
p14376
aVand is it really so bad
p14377
as(dp14378
g18
V23354
p14379
stp14380
a((dp14381
g2
(lp14382
VI'd happily use  - but if in doubt, consider a third option - Json
p14383
aVNET
p14384
aVBecause it is 3rd party, it is unrelated to the MS decisions
p14385
aVthat is a double-edged sword, of course - but it is often easier to get a minor fix applied to a standalone 3rd-party libary
p14386
as(dp14387
g18
V23354
p14388
stp14389
a((dp14390
g2
(lp14391
V(edit) As has already been observed - there are no immediate memory concerns with , since it is a
p14392
aVHowever, if you want to be paranoid:
p14393
as(dp14394
g18
V23354
p14395
stp14396
a((dp14397
g2
(lp14398
VIt sounds like you're sorted with regular reflection, but for info, the code to build an expression for nested properties would be very similar to this order-by code
p14399
aVNote that to set a value, you need to use  on the property and invoke that - there is no inbuilt expression for assigning values after construction (although it is supported in 4
p14400
aV0)
p14401
aV(edit) like so:
p14402
as(dp14403
g18
V23354
p14404
stp14405
a((dp14406
g2
(lp14407
VI'm a little confused
p14408
ag9890
aVBar" isn't a  - it is a
p14409
aVis the parameter
p14410
aVWhat exactly is it that you want to do
p14411
aVNote that one option is to load the sample code into reflector, turn of the
p14412
aVNET 3
p14413
aV5 hints, and read how it does it - it'll look like the code here, but is usually easy enough to follow
p14414
as(dp14415
g18
V23354
p14416
stp14417
a((dp14418
g2
(lp14419
VYou don't show the code where you are adding the parameters and executing the command
p14420
aVBoth may be critical
p14421
aVI know one way of reproducing this - if your procedure also returns rows (for example, from a DELETE trigger), and you haven't consumed those rows
p14422
aVbasically, the out/return parameter values follow the grids in the TDS stream, so if you haven't read the grids yet (when using ExecuteReader) - then you can't get the updated parameters / return value
p14423
aVBut if you are using  this shouldn't be a factor
p14424
as(dp14425
g18
V23354
p14426
stp14427
a((dp14428
g2
(lp14429
VLINQ is a bit fussy about querying data; it wants the schema to match
p14430
aVI suspect you're going to have to bring that back into an automatically generated type, and do the mapping to you entity type afterwards in LINQ to objects (i
p14431
ag50
aVafter AsEnumerable() or similar) - as it doesn't like you creating instances of the mapped entities manually inside a query
p14432
aVActually, I would recommend challenging the requirement in one respect: rather than SPs, consider using UDFs to query data; they work similarly in terms of being owned by the database, but they are composable at the server (paging, sorting, joinable, etc)
p14433
aV(this bit a bit random - take with a pinch of salt)
p14434
aVUDFs can be associated with entity types if the schema matches, so another option (I haven't tried it) would be to have a GetAddress(id) udf, and a "main" udf, and join them:
p14435
aV(where the udf just returns the ids - actually, you might have the join to the other udfs, making it even worse)
p14436
aVor something - might be too messy for serious consideration, though
p14437
as(dp14438
g18
V23354
p14439
stp14440
a((dp14441
g2
(lp14442
VAnother LINQ-style answer (without the overhead of a dictionary):
p14443
aVre group by (edit):
p14444
as(dp14445
g18
V23354
p14446
stp14447
a((dp14448
g2
(lp14449
VFirst, how long do the workers execute
p14450
aVpool threads should generally be used for short-lived tasks - if they are going to run for a while, consider manual threads
p14451
aVRe the problem; do you actually need to block the main thread
p14452
aVCan you use a callback instead
p14453
aVIf so, something like:
p14454
aVThis is a fairly lightweight (no OS primitives) way of tracking the workers
p14455
aVIf you need to block, you can do the same using a  (again, avoiding an OS object):
p14456
as(dp14457
g18
V23354
p14458
stp14459
a((dp14460
g2
(lp14461
VYou can't force this - the mex/WDSL descriptors only contain a tiny subset of the information associated with a type
p14462
aVIf you control the client, one option is to declare the enum (or even all the types) locally, and consume from there
p14463
aVYou should be able to use the svcutil /reference: switch to use types from an existing assembly (the IDE offers the same)
p14464
aVBut note that this partly breaks the rules of SOA (i
p14465
ag50
aVyou are using more information than the service contract promises)
p14466
as(dp14467
g18
V23354
p14468
stp14469
a((dp14470
g2
(lp14471
VHow high is "relatively high"
p14472
aVFor example, one option that occurs is to use a wrapper object:
p14473
aVThen you should be able to send a single message with any number of ,  and/or  records
p14474
aVMy inclusion of the  attribute was deliberate - if you want to reduce the size of the stream, you might consider protobuf-net - with the above layout, protobuf-net can hook into WCF simply by including  on the method  (in the operation-contract interface) that you want to attack (at both client and server)
p14475
aVThis switches the transfer to use google's "protocol buffers" binary format, using base-64 to encode
p14476
aVIf you are using the basic-http binding, this can also use MTOM if enabled, so even the base-64 isn't an issue
p14477
aVUsing this, you can get significant data transfer savings (~1/5th the space based on the numbers shown)
p14478
aV(edit 1 - protobuf-net assumes that ,  and  also use the  attribute)
p14479
aV(edit 2 - note that you could always break up the request into a number of mid-size  messages, then call a method to apply all the changes once you have them at the server (presumably in a staging table in the database))
p14480
as(dp14481
g18
V23354
p14482
stp14483
a((dp14484
g2
(lp14485
VYou can't force this - the mex/WDSL descriptors only contain a tiny subset of the information associated with a type
p14486
aVIf you control the client, one option is to declare the enum (or even all the types) locally, and consume from there
p14487
aVYou should be able to use the  switch to use types from an existing assembly (the IDE offers the same)
p14488
aVBut note that this partly breaks the rules of SOA (i
p14489
ag50
aVyou are using more information than the service contract promises)
p14490
as(dp14491
g18
V23354
p14492
stp14493
a((dp14494
g2
(lp14495
VWell, "params" arrays on attributes are sometimes just so tempting (but non-compliant)
p14496
aVBut I'd recommend using CLS-compliant approaches whenever possible
p14497
as(dp14498
g18
V23354
p14499
stp14500
a((dp14501
g2
(lp14502
VIf you want to work with them based on their concrete type - that sounds like a case for polymorphism
p14503
aVcan you (in a partial class) add a few methods
p14504
aVOtherwise, if you want to filter the set, you can use the  extension method - i
p14505
ag50
aVPerhaps you could add properties for the above too (in the parent object) - i
p14506
ag50
as(dp14507
g18
V23354
p14508
stp14509
a((dp14510
g2
(lp14511
VNo
p14512
aVWhenever implementing an interface or overriding members in a derived class, you need to re-declare the attributes
p14513
aVIf you only care about ComponentModel (not direct reflection), there is a way () of suggesting attributes from an existing type (to avoid duplication), but it is only valid for property and indexer usage
p14514
aVAs an example:
p14515
aVoutputs:
p14516
as(dp14517
g18
V23354
p14518
stp14519
a((dp14520
g2
(lp14521
VIf you are using mex-generated WCF proxies, then I suspect reflection (or ComponentModel) is indeed the simplest option - something like:
p14522
aVOr if you want to use it even with the variable types as the base-class:
p14523
as(dp14524
g18
V23354
p14525
stp14526
a((dp14527
g2
(lp14528
VIn
p14529
aVNET, the most immediate answer would be to use a dictionary (perhaps nested) of some kind
p14530
aVC# 4
p14531
aV0 introduces some dynamic concepts, but you'd need to write a fair bit of code to get it to behave like javascript
p14532
aVAlternatively, store them as typed records in a flat list and use LINQ:
p14533
as(dp14534
g18
V23354
p14535
stp14536
a((dp14537
g2
(lp14538
VThe fastest way is probably with binary search:
p14539
aVBut the cost of sorting the array will outweigh any benefit if you are only doing it a few times; in which case, just scan the array - either with LINQ etc, or just:
p14540
as(dp14541
g18
V23354
p14542
stp14543
a((dp14544
g2
(lp14545
VYou are looking for the  method
p14546
as(dp14547
g18
V23354
p14548
stp14549
a((dp14550
g2
(lp14551
Vgolden rule: never concatenate user input
p14552
aVif you write your own command strings in
p14553
aVNET, use the Parameters collection
p14554
aVif you use LINQ, it will usually do it for you
p14555
aVif you write commands  in TSQL, use sp_executesql or your vendor's equivalent
p14556
as(dp14557
g18
V23354
p14558
stp14559
a((dp14560
g2
(lp14561
VWell, if it is a full copy, I wonder if you shouldn't look into bulk load tools
p14562
aVBULK INSERT (TSQL)
p14563
aVSqlBulkCopy (
p14564
aVNET)
p14565
aVbcp (command line)
p14566
aVetc
p14567
aVIf you had a  clause, I'd check that it was suitably indexed
p14568
aVAdditionally:
p14569
aVperhaps drop indexes and triggers before doing the INSERT (recreate afterwards)
p14570
aVconsider dropping the entire table and using SELECT INTO
p14571
aV(see comments)
p14572
as(dp14573
g18
V23354
p14574
stp14575
a((dp14576
g2
(lp14577
VAreNotSame uses reference equality () - i
p14578
ag50
aVare they the same actual instance of an object; AreNotEqual uses conceptual equality () - i
p14579
ag50
aVare they considered equal
p14580
as(dp14581
g18
V23354
p14582
stp14583
a((dp14584
g2
(lp14585
VThey are identical; if no name is specified (and the right-hand-side is a simple member-access) then the name of the existing member is assumed
p14586
aVThe name is only necessary to:
p14587
aVchange the name to something else (for example )
p14588
aVto give a name to a non-member-access expression (for example )
p14589
as(dp14590
g18
V23354
p14591
stp14592
a((dp14593
g2
(lp14594
VThat won't be an actual leak, but it could be stressing things unnecessarily
p14595
aVHow many rows are you working over
p14596
aVNote that reflection is a pain, and that every call to things like  can return a new array (so you want to do that once, not once per-property-per-row)
p14597
aVPersonally, I'd pre-construct the work I intend to do
p14598
aVsomething like below
p14599
aVNote that if I was doing this lots, I'd either switch to HyperDescriptor, or if
p14600
aVNET 3
p14601
aV5 was an option, maybe a compiled Expression
p14602
aVSince  isn't strongly typed,  would be a logical next step (for performance) after the below
p14603
as(dp14604
g18
V23354
p14605
stp14606
a((dp14607
g2
(lp14608
VWell, I'd have to agree with the "design" point
p14609
aVbut you can probably use a Monitor to let one know when the other is past the critical section
p14610
as(dp14611
g18
V23354
p14612
stp14613
a((dp14614
g2
(lp14615
VIntroducing a new field smacks of messy
p14616
aVAnd either way you need to be careful not to break polymorphism and inheritance (what if the base-class talks to the private field
p14617
aVWith regard to adding a new accessor while overriding; the simple answer is "no, you can't"
p14618
aVWhen you override, you can only impact the existing accessors, since that is what is defined in the virtual-table for the member (an overridden member is still "owned" by the base/declaring class, not the overriding class)
p14619
aVOne option (not ideal) is to re-declare the property, but you would still need a way to talk down to the base-class
p14620
aVSo if the accessor in the base-class was :
p14621
as(dp14622
g18
V23354
p14623
stp14624
a((dp14625
g2
(lp14626
VBy DefaultText do you mean the initial text before editing
p14627
aVPerhaps declare this in a constant / field / etc somewhere, and set it programatically rather than in the markup - i
p14628
ag50
aVin the first load,  - then later you can just compare again to  to track changes
p14629
as(dp14630
g18
V23354
p14631
stp14632
a((dp14633
g2
(lp14634
VIn most cases when uses sensibly (i
p14635
ag50
aVa simple type initializer where the type and value are the same), then it is fine
p14636
aVThere are some times when it is unclear that you've broken things by changing it - mainly, when the initialized type and the (original) variable type are not the same, because:
p14637
aVthe variable was originally the base-class
p14638
aVthe variable was originally an interface
p14639
aVthe variable was originally another type with an implicit conversion operator
p14640
aVIn these cases, you can get into trouble with any type resolution - for example:
p14641
aVmethods that have different overloads for the two competing types
p14642
aVextension methods that are defined differently for the two competing types
p14643
aVmembers that have been re-declared (hidden) on one of the types
p14644
aVgeneric type inference will work differently
p14645
aVoperator resolution will work differently
p14646
aVIn such cases, you change the meaning of the code, and execute something different
p14647
aVThis is then a bad thing
p14648
aVExamples:
p14649
aVImplicit conversion:
p14650
aVMethod hiding:
p14651
aVetc
p14652
as(dp14653
g18
V23354
p14654
stp14655
a((dp14656
g2
(lp14657
VYou want the  extension method (LINQ):
p14658
aVor just:
p14659
aV(it will return false if they are different lengths, or any item is different)
p14660
as(dp14661
g18
V23354
p14662
stp14663
a((dp14664
g2
(lp14665
VIf the number of dimensions is fixed, this is simply :
p14666
aVHowever, if the number of dimensions is controlled by the data, you need to use recursion:
p14667
as(dp14668
g18
V23354
p14669
stp14670
a((dp14671
g2
(lp14672
VIs it defined with
p14673
aVOr perhaps a struct
p14674
as(dp14675
g18
V23354
p14676
stp14677
a((dp14678
g2
(lp14679
VIL is by definition very expressive in terms of what remains in the body; you'll just have to either:
p14680
aVfind a better (read: more expensive) obfuscator
p14681
aVkeep the key source under your control (for example, via a web-service, so key logic is never at the client)
p14682
as(dp14683
g18
V23354
p14684
stp14685
a((dp14686
g2
(lp14687
VIf the data isn't in the xml, then xslt will be a pain
p14688
aVYou can provide additional documents with , or you can use xslt extension methods (but that is not well supported between vendors)
p14689
aVSo unless you are dead set on xslt, it doesn't sound like a good option on this occasion (although I'm a big fan of xslt when used correctly)
p14690
aVSo: I would probably use regular imperative code - streaming () if possible
p14691
aVOf course, unless you have a lot of data, such nuances are moot
p14692
as(dp14693
g18
V23354
p14694
stp14695
a((dp14696
g2
(lp14697
VCall me crazy, but I'm a big fan of readability - so I tend to just have a sequence of individually-innocent-looking expressions that I then combine
p14698
aVOf course, it depends how you define LINQ: if you mean query-syntax in C#, then I don't tend to go overboard
p14699
aVbut if you mean meta-programming (i
p14700
ag50
aVC# code that creates a LINQ expression), I've got a few good examples:
p14701
aVhow about some object-construction with DbLinq
p14702
aVI've got the (LINQ) Expression-based maths interpreter/compiler that I wrote for Finguistics kicking around somewhere
p14703
aVthe generic operators code I wrote for MiscUtil is all Expression-based
p14704
aVvarious object copying examples (like this)
p14705
aVcomplex OrderBy construction
p14706
as(dp14707
g18
V23354
p14708
stp14709
a((dp14710
g2
(lp14711
VI must admit I'm not hugely surprised -  basically breaks most of the rules of structured data
p14712
aVWhy not simply project from the data-table into a typed object
p14713
aVA related question came up earlier
p14714
aVor if you know the schema of the  just do the conversion in C#
p14715
aVManually building the JSON might work, but there are a lot of edge-cases to avoid; I'd rather let an existing framework handle it, to be honest
p14716
as(dp14717
g18
V23354
p14718
stp14719
a((dp14720
g2
(lp14721
VTo quote from here
p14722
aVWhen the light syntax option is
p14723
aVenabled 'in' is optional
p14724
aVThe token after the '='
p14725
aVof a 'let' definition begins a new block, where
p14726
aVthe pre-parser inserts an implicit separating 'in'
p14727
aVtoken between each 'let' binding that begins at
p14728
aVthe same column as that token
p14729
aVWithout the light syntax option 'in'
p14730
aVis very often required
p14731
aVThe 'in' is
p14732
aVoptional when  the light syntac option
p14733
aVis used
p14734
aVSo I'm guessing you're using light syntax
p14735
as(dp14736
g18
V23354
p14737
stp14738
a((dp14739
g2
(lp14740
VFirstly, WCF proxies are , so you can kind of use :
p14741
aVUnfortunately, WCF also has a buggy  implementation that regularly throws exceptions
p14742
aVHowever, here's a really cool trick to get it to work correctly
p14743
aVI also blogged about this myself, but I think the first link is a lot better
p14744
aVSo: use  and , but use it with caution (in this case)
p14745
aVSetting a field usually makes no difference
p14746
aVThere are a few edge-cases (such as variables captured by multiple delegates, static fields, long-life objects, etc), but in general leave it alone
p14747
aVIn particular, do not do this, as this can theoretically extend the life:
p14748
as(dp14749
g18
V23354
p14750
stp14751
a((dp14752
g2
(lp14753
VIf you are after fairly simple data (i
p14754
ag50
aVthe first-level children), then an option I've used successfully in the past is to use an  to read the xml (on child at a time), presenting the data in a lightweight  that  can consume to pump the data in
p14755
aVLike so
p14756
aVIf the data is more complex, use sqlxml / bulk load
p14757
as(dp14758
g18
V23354
p14759
stp14760
a((dp14761
g2
(lp14762
VYou might want to see this for something similar; it appears to be doable, but a lot of work
p14763
aVor you could build the entire request manually (even worse
p14764
as(dp14765
g18
V23354
p14766
stp14767
a((dp14768
g2
(lp14769
VI can't fully follow the question, but it sounds like you're using IIS to host a web-service, and it isn't working
p14770
aVThe usual cause is that you haven't configured the virtual directory in IIS; you must:
p14771
aVensure it is marked as an "application" (it should have a cog icon) - you do this on the properties dialog ("create application" or similar - a button on the right hand side, about 2-thirds down)
p14772
aVensure it is using ASP
p14773
aVNET 2
p14774
aVx (same dialog is IIS, ASP
p14775
aVNET tab)
p14776
aVOther than that, yuo'll have to describe the problem more
p14777
as(dp14778
g18
V23354
p14779
stp14780
a((dp14781
g2
(lp14782
VFirst, this looks like it could be a case-sensitivity issue; even if the TSQL isn't case-sensitive, the C# will be
p14783
aVBut why return the password at all (in fact, youshouldn't even store a password - only a hash)
p14784
aVPersonally, I'd just have:
p14785
aVThen just check for the existance of rows; if , they are validated
p14786
aVOf course,  is also overkill here, but it should work
p14787
as(dp14788
g18
V23354
p14789
stp14790
a((dp14791
g2
(lp14792
VAs the author, I would invite you to try protobuf-net; it ships with binaries for both Mono 2
p14793
aV0 and Silverlight 2
p14794
aV0, and is fast and efficient
p14795
aVIf you have any problems whatsoever, just drop me an e-mail (see my StackOverflow profile); support is free
p14796
aVJon's version (see the earlier accepted answer) is also very good, but IMO the protobuf-net version is more idiomatic for C# - Jon's would be ideal if you were talking C# to Java, so you could have a similar API at both ends
p14797
as(dp14798
g18
V23354
p14799
stp14800
a((dp14801
g2
(lp14802
VOne way to do this is with generics - i
p14803
ag50
aVa generic method:
p14804
aVNow you can call Foo only with other variables that are a  that implements  - you don't need to specify the generic, though:
p14805
aVis all you need
p14806
aVIf you've given it something that isn't both a  and , the compiler will tell you
p14807
aVUpdate: I don't "do" VB, but reflector tells me that the above translates as:
p14808
as(dp14809
g18
V23354
p14810
stp14811
a((dp14812
g2
(lp14813
VIt isn't entirely clear what you mean, but it sounds like like you just want:
p14814
aVRe the title and description; well, you could do something kludgy involving , but as an alternative, why don't you simply disassemble the title and description (split on whitespace/punctuation), and place these into the WORD2PHOTO table (with a marker to indicate that they are from the title/description) - then this becomes:
p14815
aVAnd just include different combinations of K/T/D to suit
p14816
aVYou'd just need a trigger so that when you INSERT/UPDATE the title/description, it removes all existing T/D entries and replaces with the new ones
p14817
as(dp14818
g18
V23354
p14819
stp14820
a((dp14821
g2
(lp14822
VIs this just a producer/consumer queue
p14823
aVThere are lots of pre-rolled examples - I posted one here myself a few days ago (but I can't find it at the moment)
p14824
aVput it this way - the version I posted was much simpler - i
p14825
ag50
aV"obviously no bugs" rather than "no obvious bugs"
p14826
aVI'll see if I can find it
p14827
aV(edit: found it)
p14828
aVThe point is; with that version, the worker thread just does:
p14829
as(dp14830
g18
V23354
p14831
stp14832
a((dp14833
g2
(lp14834
VIf untyped (replace  with the correct data type):
p14835
aVor:
p14836
aVIf typed:
p14837
as(dp14838
g18
V23354
p14839
stp14840
a((dp14841
g2
(lp14842
VI'm a little surprised it downloaded a symbol file for that; last time I looked, there were only symbols for a small subset (mainly 2
p14843
aV0) of the framework
p14844
aVAre you having a problem with this code at the moment
p14845
aVIf so, post details of the exception / unexpected behaviour
p14846
aVIf you are simply curious, then either a: read the documentation, or b: perhaps have a snoop with reflector (caveat: "IANAL")
p14847
as(dp14848
g18
V23354
p14849
stp14850
a((dp14851
g2
(lp14852
VThe standard for dates/times in xml is much more formal than that; most xml parsers will respect (for example):
p14853
aV2009-02-15
p14854
aV2009-02-15T10:20:34
p14855
aV0000000
p14856
aV2009-02-15T10:20:34
p14857
aV0000000+00:00
p14858
aVThis is always yyyy-MM-dd; the time portion is optional, as is the UTC offset
p14859
aV(edit: lucas-insasho correctly cited the spec)
p14860
as(dp14861
g18
V23354
p14862
stp14863
a((dp14864
g2
(lp14865
VYou could join
p14866
aVI'd use two steps myself, though:
p14867
aVIf you only have
p14868
aVNET 2
p14869
aV0, then either install LINQBridge and use the above (or similar with a  if LINQBridge doesn't include ), or perhaps use nested :
p14870
aVnote though that the  approach is O(n*m), where-as the  approach is O(n+m)
p14871
as(dp14872
g18
V23354
p14873
stp14874
a((dp14875
g2
(lp14876
VReverse engineering is usually something you do because you have to, not because you want to
p14877
aVFor example, there are legal issues with simply reverse engineering a product
p14878
aVBut there are necessary cases - where (for example) the supplier has gone and no longer exists or is not contactable
p14879
aVA good example would be the WMD editor that you typed your question into
p14880
aVThe SO team/community had to reverse engineer this from obfuscated source to apply some bug fixes
p14881
as(dp14882
g18
V23354
p14883
stp14884
a((dp14885
g2
(lp14886
VIn 10 years, I've only been personally involved in one project that was canned - and that was because the customer pulled out
p14887
aVI've seen a number of projects for other teams/companies evaporate though - usually due to:
p14888
aVover-engineered / too much complexity causing it to spiral like crazy, without actually delivering the original project goals
p14889
aVlack of commitment / involvement from the customer
p14890
aVWith the former, it often takes a very brave person (perhaps director level) to pull the plug; the problem is, when you've already spent $VeryBig, it is very hard to be the person to say "throw it away" - if you can keep saying "just another $RelativelyBig and it'll be OK", well
p14891
aVand the cycle repeats with different people playing budget-chicken, until something gives and a scapegoat needs to be found
p14892
as(dp14893
g18
V23354
p14894
stp14895
a((dp14896
g2
(lp14897
VFirst, try not to store passwords in the database; it is better to store a hash
p14898
aVI'm not quite sure what you mean "assign a role to the user" - are you having difficulty getting the role from the db
p14899
aVOr are you unsure what to do with it afterwards
p14900
aVIf the latter, the "principal" is the way to go; at the simplest level:
p14901
aVNow you can use role-based security, either declarative or imperative
p14902
aVDeclarative:
p14903
aVImperative:
p14904
as(dp14905
g18
V23354
p14906
stp14907
a((dp14908
g2
(lp14909
VA  simply acts to reduce the number of read/write calls to the underlying stream (which may be IO/hardware bound)
p14910
aVIt cannot provide seek capability (and indeed, buffering and seeking are in many ways contrary to eachother)
p14911
aVWhy do you need to seek
p14912
aVPerhaps copy the stream to something seekable first - a  or a  - then do your actual work from that second, seekable stream
p14913
aVDo you have a specific purpose in mind
p14914
aVI may be able to suggest more appropriate options with more details
p14915
aVIn particular: note that  is a curiosity - with most streams, read/write relate to the same physical stream; however, a  actually represents two completely independent pipes; read and write are completely unrelated
p14916
aVLikewise, you can't seek in bytes that have already zipped past you
p14917
aVyou can skip data, but that is better done by doing a few  opdrations and discarding the data
p14918
as(dp14919
g18
V23354
p14920
stp14921
a((dp14922
g2
(lp14923
VIn today's i18n world, nvarchar makes a lot of sense
p14924
aVvarchar might make sense for data that is specified not to be unicode (perhaps you have some system fields that are demanded to be ASCII)
p14925
aVI'd use nvarchar by default for things like names, descriptions, addresses, etc
p14926
aVis smaller, so there are perhaps some IO savings with  over  (but note that code-page becomes a bigger issue too)
p14927
as(dp14928
g18
V23354
p14929
stp14930
a((dp14931
g2
(lp14932
VNo, this doesn't exist
p14933
aVYou have to remove the tab and re-add it when you want it
p14934
aVOr use a different (3rd-party) tab control
p14935
as(dp14936
g18
V23354
p14937
stp14938
a((dp14939
g2
(lp14940
VWhile the StackTrace answers are correct, they do have an overhead
p14941
aVIf you simply want safety against changing the name, consider
p14942
aVSince static methods can't be virtual, this should usually be fine
p14943
as(dp14944
g18
V23354
p14945
stp14946
a((dp14947
g2
(lp14948
VWell, the code you have posted () can only work with an array (not a list) - but you would use simply (where  and  are the two values):
p14949
aVOr possibly (if you want atomic):
p14950
aVPersonally, I don't think I'd bother with a swap method, though - just do it directly; this means that you can use (either for a list or for an array):
p14951
aVIf you really wanted to write a swap method that worked on either a list or an array, you'd have to do something like:
p14952
aV(it would be trivial to make this generic) - however, the original "inline" version (i
p14953
ag50
aVnot a method) working on an array will be faster
p14954
as(dp14955
g18
V23354
p14956
stp14957
a((dp14958
g2
(lp14959
V(update)
p14960
aVActually - there is one scenario where the  construct is more efficient; looping on an array
p14961
aVThe compiler/JIT has optimisations for this scenario as long as you use  in the condition:
p14962
aVIn this very specific case, it skips the bounds checking, as it already knows that it will never be out of bounds
p14963
aVInterestingly, if you "hoist"  to try to optimize it manually, you prevent this from happening:
p14964
aVHowever, with other containers ( etc), hoisting is fairly reasonable as a manual micro-optimisation
p14965
aV(end update)
p14966
aVNeither; a for loop is evaluated as a while loop under the hood anyway
p14967
aVFor example 12
p14968
ag9575
ag9575
aV9 of ECMA 334 (definite assignment) dictates that a for loop:
p14969
aVis essentially equivalent (from a Definite assignment perspective (not quite the same as saying "the compiler must generate this IL")) as:
p14970
aVwith continue statements that target
p14971
aVthe for statement being translated to
p14972
aVgoto statements targeting the label
p14973
aVLLoop
p14974
aVIf the for-condition is omitted
p14975
aVfrom the for statement, then
p14976
aVevaluation of definite assignment
p14977
aVproceeds as if for-condition were
p14978
aVreplaced with true in the above
p14979
aVexpansion
p14980
aVNow, this doesn't mean that the compiler has to do exactly the same thing, but in reality it pretty much does
p14981
as(dp14982
g18
V23354
p14983
stp14984
a((dp14985
g2
(lp14986
VI haven't tested it, but how about:
p14987
as(dp14988
g18
V23354
p14989
stp14990
a((dp14991
g2
(lp14992
VBuffers aren't generally allocated inside the FileStream
p14993
aVPerhaps the problem is the line "writing thousands of small buffers" - do you really mean that
p14994
aVNormally you re-use a buffer many, many, many times (i
p14995
ag50
aVon different calls to Read/Write)
p14996
aVAlso - is this a single file
p14997
aVA single FileStream is not guaranteed to be thread safe
p14998
aVso if you aren't doing synchronization, expect chaos
p14999
as(dp15000
g18
V23354
p15001
stp15002
a((dp15003
g2
(lp15004
VNow; fields should pretty-much always be private anyway, so it is an edge case whether you should bother
p15005
aVFor the wider subject, I remember a comment by Eric Lippert - essentially saying that given a method / class / whatever:
p15006
aVThen it isn't clear whether they are private/internal deliberately, or whether the developer has thought about it, and decided that they should be private/internal/whatever
p15007
aVSo his suggestion was: tell the reader that you are doing things deliberately instead of by accident - make it explicit
p15008
as(dp15009
g18
V23354
p15010
stp15011
a((dp15012
g2
(lp15013
VIt looks like it will accept , so just call  on your  and it should work
p15014
aVPersonally, though, I'd just use  and  to get the page - so  is page 3 based on a page size of 10
p15015
aVYou can easily wrap this into an extension method:
p15016
aVThen that would be
p15017
as(dp15018
g18
V23354
p15019
stp15020
a((dp15021
g2
(lp15022
VWhile it is definitely a good thing knowing how to build at the command line, for most work it might be easier to use an IDE
p15023
aVThe C# express edition is free and very good for the money ;-p
p15024
aVAlternatively, things like snippy can be used to run fragments of C# code
p15025
aVFinally - note that the command line is implementation specific; for MS, it is ; for mono, it is  and friends
p15026
aVLikewise, to execute: it is just "exename" for the MS version, but typically "mono exename" for mono
p15027
aVFinally, many projects are build with build script tools; MSBuild, NAnt, etc
p15028
as(dp15029
g18
V23354
p15030
stp15031
a((dp15032
g2
(lp15033
VThe use with generics is problematic, since C# doesn't support operators on generics - meaning you'd have to write the expression manually
p15034
aVAnd as we've already seen, string works differently
p15035
aVBut for the rest, how about something like (untested):
p15036
aV(edited for multiple ranges)
p15037
aVNote; the use of Expression
p15038
aVInvoke means it will probably work on LINQ-to-SQL but not EF (at the moment; hopefully fixed in 4
p15039
aV0)
p15040
aVWith usage (tested on Northwind):
p15041
aVGenerating TSQL (re-formatted):
p15042
aVJust what we wanted ;-p
p15043
as(dp15044
g18
V23354
p15045
stp15046
a((dp15047
g2
(lp15048
VNo, that is not safe
p15049
aVIf you want to ensure mutually exclusive without blocking, you can use Monitor
p15050
aVTryEnter:
p15051
as(dp15052
g18
V23354
p15053
stp15054
a((dp15055
g2
(lp15056
VAttributeUsageAttribute ;-p
p15057
aVNote, however, that if you are using ComponentModel (), it only supports one attribute instance (per attribute type) per member; raw reflection supports any number
p15058
as(dp15059
g18
V23354
p15060
stp15061
a((dp15062
g2
(lp15063
VI really doubt that calling  on an enum returns xml
p15064
aVcan you clarify what is happening
p15065
aVYou probably want to either cast the enum to an byte/int (and work in terms of numbers much of the time), or use  at some point - but it is hard to say without understanding how you have got it hooked together
p15066
as(dp15067
g18
V23354
p15068
stp15069
a((dp15070
g2
(lp15071
VActually, Visual Studio doesn't care about this at all
p15072
aVI assume you have ReSharper installed
p15073
aVThis validates a lot of common errors, including incorrect use of patterns such as  etc
p15074
aVIt also has better  checking - not quite "contracts", but still pretty helpful
p15075
aVIt only attempts this when it can see a string literal used in a known pattern - the analysis to chase how you assign variables is simply too much for realistic analysis
p15076
as(dp15077
g18
V23354
p15078
stp15079
a((dp15080
g2
(lp15081
VRead the inner-exceptions:
p15082
aVThere was an error reflecting type 'SomeType'
p15083
aVCannot serialize member 'SomeType
p15084
aVData' of type 'System
p15085
aVInt32[,,]', see inner exception for more details
p15086
aVCannot serialize object of type System
p15087
aVInt32[,,]
p15088
aVMultidimensional arrays are not supported
p15089
aVSo no: multi-dimensional arrays simply aren't supported
p15090
aVYou may have to shim it through as a single-dimension array
p15091
aVyou can do this by having a separate property that does the translation:
p15092
as(dp15093
g18
V23354
p15094
stp15095
a((dp15096
g2
(lp15097
VIt is returning an , assuming that that  is the type of data in
p15098
aVIf you want the strings, you need to , not just
p15099
aVYou shouldn't need to cast (since  implements ); it should also tell you this if you hover on
p15100
as(dp15101
g18
V23354
p15102
stp15103
a((dp15104
g2
(lp15105
VYour intent is very unclear; however, one option is generics and  in particular
p15106
aVWhat do you want to do with this
p15107
aVFor example:
p15108
aVSo now we have the value, typed as  via generics - but there still isn't much we can do with it except for calling other generic methods
p15109
aVwhat was it you want to do here
p15110
as(dp15111
g18
V23354
p15112
stp15113
a((dp15114
g2
(lp15115
VThat is simply reflector struggling to keep up with the IL that has been generated (since iterator blocks don't have to relate to "normal" C# as long as they are valid IL)
p15116
aVIn particular, the  is after the  block
p15117
as(dp15118
g18
V23354
p15119
stp15120
a((dp15121
g2
(lp15122
VHey, lets take our least scalable component, and make it do intensive CPU work ;-p
p15123
aVOK, that was tongue in cheek
p15124
aVXml as arguments and return values have uses in a few specific cases with structured data, but in general a flat TDS stream (i
p15125
ag50
aVgrids) is far more efficient
p15126
aVFor input, either CSV (split via udf) or table-valued-parameters (SQL 2008) are good options
p15127
aVSql/xml in 2005+ is much better than with openxml - and indeed, once xml is stored and indexed in the server (using the  data type) it is quite efficient - but as input and output it can be a bottleneck if you aren't careful
p15128
aVDon't make it the default, but consider it as one of the available options
p15129
as(dp15130
g18
V23354
p15131
stp15132
a((dp15133
g2
(lp15134
VWell, are you volume-bound (i
p15135
ag50
aVbig messages) or round-trip bound (lots of small messages)
p15136
aVFor big messages, consider compression (if network IO is the overhead) or more efficient serialization such as protobuf-net
p15137
aVFor chatty APIs, consider bunching messages to take fewer round trips
p15138
as(dp15139
g18
V23354
p15140
stp15141
a((dp15142
g2
(lp15143
VIf you are using offsets such as ,  you probably shouldn't be increasing p at all
p15144
aVSurely you've already handled that ( and ) with the multiplication
p15145
aVAlso,  is not (as far as I can see) a meaningful number
p15146
aVthe stride is the rows size including padding
p15147
aVEither remove the "" code, or change the offset algorithm
p15148
aVAt the moment you are skipping data (bad) and accessing data outside of the object (very bad)
p15149
as(dp15150
g18
V23354
p15151
stp15152
a((dp15153
g2
(lp15154
VAs long as you use the  marker, the contract is identical regardless of whether the field or property is used
p15155
aVHowever, there may be some permissions issues accessing private members, in particular on silverlight and CF - in which case I would recommend using the public property as the data-member
p15156
aVActually, I would tend to always use a property unless I had a very good reason
p15157
as(dp15158
g18
V23354
p15159
stp15160
a((dp15161
g2
(lp15162
VDo you have LINQ available to you
p15163
aVYour logic seems similar to Any:
p15164
aVwhich is the same as:
p15165
aVIf you don't have LINQ, then this is still the same as:
p15166
aVIf you want to run additional logic, there are things you can do (with LINQ) with  etc
p15167
as(dp15168
g18
V23354
p15169
stp15170
a((dp15171
g2
(lp15172
V(note: I'm assuming that all you know is  or  or similar, and that the list could be any type at runtime)
p15173
aVIf you know it is a , then:
p15174
aVAnother option is to look at the indexer:
p15175
aVUsing new TypeInfo:
p15176
as(dp15177
g18
V23354
p15178
stp15179
a((dp15180
g2
(lp15181
VIt sounds like it is duplicating the properties
p15182
aVhave you perhaps left an abandoned model in the project somewhere
p15183
aVAlternatively, do you have two tables that are so similar that the escaping rules might be making them the same
p15184
as(dp15185
g18
V23354
p15186
stp15187
a((dp15188
g2
(lp15189
VUsing the stack here is slow and unnecessary; I would simply use:
p15190
aV(hint: I've done a lot of work with custom property models; I know that this works well
p15191
aVAnother alternative is an object key (use reference equality to compare) - a lot of  works this way, as do some of the properties in WF/WPF:
p15192
aVOf course, you could declare a type for the keys (with a  property), and use that:
p15193
aVetc; however, to answer the question: mark it (but don't do this) with:
p15194
aVor
p15195
aVor
p15196
as(dp15197
g18
V23354
p15198
stp15199
a((dp15200
g2
(lp15201
VSimply: a leading // means "at any level" in the same document as the selected node
p15202
aVFrom the spec:
p15203
aV//para selects all the para descendants of the document root and thus selects all para elements in the same document as the context node
p15204
aV//para selects the para element descendants of the context node
p15205
as(dp15206
g18
V23354
p15207
stp15208
a((dp15209
g2
(lp15210
VWell, I haven't used it myself - but I've helped somebody using it (various bits of  code - I believe some made it into the DbLinq codebase), and they were generally happy with it
p15211
aVUltimately, I suggest you need to find which are the critical features you need, and run tests (unit, integration or ad-hoc) to see if it can meet your specific requirements
p15212
as(dp15213
g18
V23354
p15214
stp15215
a((dp15216
g2
(lp15217
VYour line of code is identical to:
p15218
aVwhich is identical to:
p15219
aVAs you can see; when the constructor executes,  is not yet set
p15220
as(dp15221
g18
V23354
p15222
stp15223
a((dp15224
g2
(lp15225
VThreadPool threads are background threads; they won't keep a process alive
p15226
aVI suspect you need a "proper" thread
p15227
aVTry:  or similar
p15228
as(dp15229
g18
V23354
p15230
stp15231
a((dp15232
g2
(lp15233
VWell, a more natural approach might be to send the file in a sequence in mid-size chunks, with a final message to commit; this also makes it possible to resume from error
p15234
aVThere is perhaps a slight DOS issue with fully open numbers
p15235
as(dp15236
g18
V23354
p15237
stp15238
a((dp15239
g2
(lp15240
VYou can't, basically
p15241
aVNot for  (since it already exists), but in general: one option with C# 3
p15242
aV0 is extension methods:
p15243
aVNow you can use:
p15244
aVBut there is no interface here
p15245
as(dp15246
g18
V23354
p15247
stp15248
a((dp15249
g2
(lp15250
VI suspect you are adding the same instance multiple times - i
p15251
ag50
aV(I'll use C# here
p15252
aVWhat you have done is add 2 references to the same object to the list
p15253
aVWhat you should have done was:
p15254
aVThis is because classes are reference-types; all you are adding is a reference
p15255
aVStructs are value-types, and would work like you expect, except that unless you really know what you are doing, structs should be immutable (i
p15256
ag50
aVno editable properties once created)
p15257
as(dp15258
g18
V23354
p15259
stp15260
a((dp15261
g2
(lp15262
V"return" simply won't work here (since it would try to return a , and the method declares an
p15263
aVJon Skeet has a good write-up of iterator blocks (what this is) in the free chapter 6 of C# in Depth (then buy the whole book - it really is worth it ;-p)
p15264
aVedit - here's a very rough version of what you would have to do in order to write this yourself; note that it doesn't quite do the same, but achieves the goal
p15265
aVI think you'll agree that the  version is easier
p15266
as(dp15267
g18
V23354
p15268
stp15269
a((dp15270
g2
(lp15271
VWell, I would marshal and specify a window, if only so the  can get the correct focus
p15272
aVIt might be they simply can't see it because it is behind one of your forms, and doesn't know it should be in the foreground
p15273
as(dp15274
g18
V23354
p15275
stp15276
a((dp15277
g2
(lp15278
VSimply - so you have a true history of the code - to investigate changes (reasons for bugs), revert to versions, audit, etc
p15279
aVBackup isn't enough - you simply have a copy of the current picture
p15280
aVEver change a file and wish you could remember what you did
p15281
as(dp15282
g18
V23354
p15283
stp15284
a((dp15285
g2
(lp15286
VFrom a "repository pattern" angle, there is something to be said for having separate aggregates and minimizing the navigation properties between aggregates
p15287
aVI'm not 100% sure what that something is though
p15288
aVat the moment I'm considering using a moderately-sized dbml, with multiple repositories using it (the UI doesn't use the datacontexts directly - only the repository classes), with the navigation properties marked internal so the DAL can use them
p15289
aVMaybe
p15290
as(dp15291
g18
V23354
p15292
stp15293
a((dp15294
g2
(lp15295
VSince this is LINQ-to-SQL, you can usually use  to bring a sub-expression into play
p15296
aVI'll see if I can come up with an example (update: done)
p15297
aVNote, however, that EF doesn't support this - you'd need to rebuild the expression from scratch
p15298
aVI have some code to do this, but it is quite lengthy
p15299
aVThe expression code (using ) is quite simple:
p15300
aVHere's example usage on Northwind:
p15301
aVWith TSQL (reformatted to fit):
p15302
as(dp15303
g18
V23354
p15304
stp15305
a((dp15306
g2
(lp15307
VIt isn't boxed, but the data will be a copy of the original, and every time you get the data out, it will copy again
p15308
aVThis tends to make it easy to lose changes
p15309
aVAs such, you should aim to not write mutable structs
p15310
aVUnless  actually represents a unit-of-measure (or similar), make it a class
p15311
aVAnd if it is a measure, make it immutable (no public settable members)
p15312
aVAnd either way, don't expose fields
p15313
aVUse properties ;-p
p15314
aVFor example:
p15315
aVOr alternatively (C# 3
p15316
aV0):
p15317
as(dp15318
g18
V23354
p15319
stp15320
a((dp15321
g2
(lp15322
VWell, since the method is private, does it make sense for the caller to know the method name
p15323
aVIf it was public, you could pass the method in:
p15324
aVHowever, for a private method, I suspect an enum/switch is the best option
p15325
aVAlternatively, you can get the method via reflection
p15326
as(dp15327
g18
V23354
p15328
stp15329
a((dp15330
g2
(lp15331
VAre you passing additional arguments into your XmlSerializer
p15332
ag412
ag50
aVusing a non-default constructor
p15333
aVyup, it does this (as it builds a new serialization assembly each time)
p15334
aVconsider creating the serializer in a type initializer and caching it:
p15335
aVthen use the cached  serializer instance repeatedly
p15336
as(dp15337
g18
V23354
p15338
stp15339
a((dp15340
g2
(lp15341
VThe fact that it tried to insert the link before saving the rhs suggests that one of more of the relationships isn't marked as a foreign key: it shouldn't have done this (if correctly configured)
p15342
aVDoes your link table have any extra data of its own
p15343
aVIf not, you can actually remove this table from the model competely - simply associate the two interesting tables (many-to-many), and select the link table as the storage mechanism of the assication (you'll need to click on the link between the two tables in the designer)
p15344
aVAlternatively, if your link table has a compsoite key: "lhsid, rhsid", then I believe the tooling will do all this for you automatically
p15345
as(dp15346
g18
V23354
p15347
stp15348
a((dp15349
g2
(lp15350
VHow about use of  and  - hard to miss it then
p15351
as(dp15352
g18
V23354
p15353
stp15354
a((dp15355
g2
(lp15356
VWell, with  all bets are off, as no schema is guaranteed
p15357
aVHowever, for the rest:
p15358
aVFrom MSDN:
p15359
aV/t[ype]:typename Specifies the name of
p15360
aVthe type to create a schema for
p15361
aVYou
p15362
aVcan specify multiple type arguments
p15363
aVIf typename does not specify a
p15364
aVnamespace, Xsd
p15365
aVexe matches all types
p15366
aVin the assembly with the specified
p15367
aVtype
p15368
aVIf typename specifies a
p15369
aVnamespace, only that type is matched
p15370
aVIf typename ends with an asterisk
p15371
aVcharacter (*), the tool matches all
p15372
aVtypes that start with the string
p15373
aVpreceding the *
p15374
aVIf you omit the /type
p15375
aVoption, Xsd
p15376
aVexe generates schemas for
p15377
aVall types in the assembly
p15378
aVClasses to XSD Generates an XML schema
p15379
aVfrom a type or types in a runtime
p15380
aVassembly file
p15381
aVThe generated schema
p15382
aVdefines the XML format used by
p15383
aVSystem
p15384
aVXml
p15385
aVSerialization
p15386
aVXmlSerializer
p15387
as(dp15388
g18
V23354
p15389
stp15390
a((dp15391
g2
(lp15392
VWell, an  doesn't contain the output; typically, you have a backing object (maybe a  or ) that is the dumping place
p15393
aVIn this case,  is probably the most efficient
p15394
aVperhaps something like:
p15395
as(dp15396
g18
V23354
p15397
stp15398
a((dp15399
g2
(lp15400
VNot as far as I know
p15401
aVwell, the theoretical limit would be the int32 limit for the array, but you'd hit the string length limit long before that, I guess
p15402
aVJust don't go mad with it ;-p It may be better to write lots of small fragments to (for example) a file or response, than one huge hit
p15403
aVedit - it looked like there was a limit in the IL (0xf4240), but apparently this isn't quite as it appears; I can make it get quite large (2^24) before I simply run out of system memory
p15404
aVUpdate; it seems to me that the bounding point is the format string
p15405
aVthose {1000001}{1000002} add up
p15406
aVa quick bit of math (below) shows that the maximum useful number of arguments we can use is 206,449,129:
p15407
as(dp15408
g18
V23354
p15409
stp15410
a((dp15411
g2
(lp15412
VYou are simply changing the local variable - not the item in the list
p15413
aVTo do this, you want , which creates a new list/array:
p15414
aVwith:
p15415
aVThis can also be written with an anonymous method:
p15416
aVOr in C# 3
p15417
aV0 as a lambda:
p15418
aVOther than that
p15419
aVa  loop:
p15420
aVBut one way or another, you are going to have to get a value out of your method
p15421
aVUnless you change the signature, you can't
p15422
as(dp15423
g18
V23354
p15424
stp15425
a((dp15426
g2
(lp15427
VIf you expose it as a /, it will do its own serialization anyway (via , IIRC)
p15428
aVNote that / don't make for good data-types on web services if you want the service to be portable to other patforms (i
p15429
ag50
aVa java client, etc)
p15430
aVBut you can simply expose it as such if you want
p15431
ag2958
aVNET will deal with the translation
p15432
as(dp15433
g18
V23354
p15434
stp15435
a((dp15436
g2
(lp15437
VRe protobuf-net, which I maintain:
p15438
aVThe issue here isn't value-types (which it will often handle fine) - it is the open  usage, which means it simply doesn't know what data to expect, and thus how to encode/decode it
p15439
aVAt the moment, I can't think of an easy/clean way to handle that
p15440
aVIt will handle a range of common value-type scenarios, lists, and any level of hierarchy based on contracts (data-contract, proto-contracts, or some xml-schemas), but it needs a clue
p15441
aVPerhaps if you can clarify the use-case, I might be able to help more
p15442
aVFor example, the above wouldn't work very with  or  either
p15443
aVRe dotnet-protobufs; I can't really comment, but I'm pretty sure it would be even less forgiving; it is intended to be used with classes generated from a
p15444
aVproto file, so  would simply never enter into the model (Jon: correct me if I am wrong)
p15445
aVIf you do leave more info, could you kindly post a comment here
p15446
aVSo I can find it easily
p15447
aVAlternatively, drop me a mail directly (see my SO profile)
p15448
aVedit - here's the hacky thing I had in mind - it isn't working at the moment, but I'll figure out why tomorrow (probably)
p15449
aVNote that in theory the extra members could all be private - I'm just trying to make it easy while debugging
p15450
aVNote that this doesn't take any extra storage
p15451
aVLike I say, it doesn't work today, but it should - I'll find out why
p15452
as(dp15453
g18
V23354
p15454
stp15455
a((dp15456
g2
(lp15457
VWell, that row hasn't actually been saved to the database yet, so it doesn't have a database id (so sql server express isn't an issue)
p15458
aVYou need to use the adapter to save the changes, and then the id of  should reflect the database
p15459
as(dp15460
g18
V23354
p15461
stp15462
a((dp15463
g2
(lp15464
VWhat needs to see the attributes
p15465
aVIf it is things like data-binding etc,  should work:
p15466
aVThis only affects  usage (not direct reflection), but that is often enough - for example, you can associate a  via the above
p15467
aVIf by "attributes" you mean "properties", then (again, as far as data-binding is concerned)  also has potential there - but it is non-trivial; you need to either implement  on the object, or to write a  for the type - and in either case, you need to write your own  implementation (often talking to a per-instance dictionary etc)
p15468
aVThis will get used by anything that uses:
p15469
aVAgain, this covers a wide range of data-binding and similar scenarios
p15470
aVFor an example of this, see here - it is far from trivial, however
p15471
aVThe example usage (from the link) adds two properties at runtime:
p15472
as(dp15473
g18
V23354
p15474
stp15475
a((dp15476
g2
(lp15477
VHow about letting the system deal with it:
p15478
as(dp15479
g18
V23354
p15480
stp15481
a((dp15482
g2
(lp15483
VThat will be a feature in 4
p15484
aV0, thanks to code-contracts, which allow you to declare exactly that
p15485
aVBut not yet
p15486
aVYou'll need to have validation code at runtime:
p15487
as(dp15488
g18
V23354
p15489
stp15490
a((dp15491
g2
(lp15492
VFirst: how big are the xml files
p15493
aVdoesn't scale to "huge"
p15494
aVbut can handle "large" OK
p15495
aVSecond: can you perhaps put the data into a regular database structure (perhaps SQL Server Express Edition), index it, and access via regular TSQL
p15496
aVThat will usually out-perform an xpath search
p15497
aVEqually, if it is structured, SQL Server 2005 and above supports the  data-type, which shreds data - this allows you to index and query xml data in the database without having the entire DOM in memory (it translates xpath into relational queries)
p15498
as(dp15499
g18
V23354
p15500
stp15501
a((dp15502
g2
(lp15503
VHere's a nice 2013 update using FastMember from NuGet:
p15504
aVThis uses the FastMember's meta-programming API for maximum performance
p15505
aVIf you want to restrict it to particular members (or enforce the order), then you can do that too:
p15506
aVYes, this is pretty much the exact opposite of this one; reflection would suffice - or if you need quicker,  in 2
p15507
aV0, or maybe  in 3
p15508
ag691
aVActually,  should be more than adequate
p15509
aVFor example:
p15510
aVNow with one line you can make this many many times faster than reflection (by enabling  for the object-type )
p15511
aVedit re performance query; here's a test rig with results:
p15512
aVI suspect that the bottleneck has shifted from member-access to  performance
p15513
aVI doubt you'll improve much on that
p15514
aVcode:
p15515
as(dp15516
g18
V23354
p15517
stp15518
a((dp15519
g2
(lp15520
VWCF/NetTcpBinding is not the same as remoting
p15521
aVWCF is a message-based API; remoting is an activation/proxy framework (essentially) (see also)
p15522
aVI very much doubt you could consume a WCF/NetTcpBinding service via a remoting client; they are just too different
p15523
aVWCF is a framework that provides unified access to a number of messaging protocols - and indeed you can add your own - but it wouldn't be easy
p15524
aVI suggest using a proper WCF client, or (if this isn't possible) use a basic-http client, or (my least preferred option) old-style remoting if you really, really must
p15525
as(dp15526
g18
V23354
p15527
stp15528
a((dp15529
g2
(lp15530
VPerhaps SqlBulkCopy; use SqlCommand
p15531
aVExecuteReader to get the reader that you use in the call to SqlBulkCopy
p15532
aVWriteToServer
p15533
aVThis is the same as bulk-insert, so very quick
p15534
aVIt should look something like (untested);
p15535
as(dp15536
g18
V23354
p15537
stp15538
a((dp15539
g2
(lp15540
VIf you can work with arrays, perhaps just :
p15541
aVAlternatively, it looks like you'll have to create an array and loop/cast
p15542
aV(for info, it works fine "as is" on 2
p15543
aV0 - although you'd use  instead)
p15544
as(dp15545
g18
V23354
p15546
stp15547
a((dp15548
g2
(lp15549
VNo, basically
p15550
aVYou can't pass an  either, since it talks to  nodes
p15551
aVYour best bet is a string representation of the predicate
p15552
as(dp15553
g18
V23354
p15554
stp15555
a((dp15556
g2
(lp15557
VLINQ-to-SQL still works via standard SQL parameters, so writing a fancy expression isn't going to help
p15558
aVThere are 3 common options here:
p15559
aVpack the ids into (for example) csv/tsv; pass down as a  and use a udf to split it (at the server) into a table variable; join to the table variable
p15560
aVuse a table-valued-parameter in SQL Server 2008
p15561
aVhave a table on the server that you could push the ids into (perhaps via SqlBulkCopy) (perhaps with a "session guid" or similar); join to this table
p15562
aVThe first is the simplest; getting a "split csv udf" is trivial (just search for it)
p15563
aVDrag the udf onto the data-context and consume from there
p15564
as(dp15565
g18
V23354
p15566
stp15567
a((dp15568
g2
(lp15569
VProtocol Buffers
p15570
aVOf the C#, protobuf-net and dotnet-protobufs are pretty robust
p15571
aVI haven't tried the AS versions personally
p15572
aVMarc
p15573
as(dp15574
g18
V23354
p15575
stp15576
a((dp15577
g2
(lp15578
VWell, there is Micro Framework; I don't hear a lot of noise about it, but I'm not into "embedded"
p15579
aVBut it would depend on what it was doing
p15580
aVC# is a good general purpose language, but there are still times when something hard-core is needed (and hang the code-complexity)
p15581
as(dp15582
g18
V23354
p15583
stp15584
a((dp15585
g2
(lp15586
VWell, the closest would be reflection, but that is on the slow side
p15587
aVbut look at MethodInfo
p15588
aVInvoke
p15589
as(dp15590
g18
V23354
p15591
stp15592
a((dp15593
g2
(lp15594
s(dp15595
g18
V23354
p15596
stp15597
a((dp15598
g2
(lp15599
VThe parameters should be available in the metadata tables (I seem to recall they might even be in syscolumns against the object_id of the proc)
p15600
aVOr the info-schemas
p15601
aVHowever, results are tricker, since SPs don't have very formalilsed output
p15602
aVUDFs have much stronger metadata
p15603
aVThe best you can do with an SP (and it is still hit'n'miss) is SET FMT_ONLY ON, and execute it and hope it doesn't use any extended stored procedures
p15604
as(dp15605
g18
V23354
p15606
stp15607
a((dp15608
g2
(lp15609
V(edited post clarification)
p15610
aVStep 1; change the final select to select all three entities into an anonymous type; for me (testing on Northwind), that is:
p15611
aVStep 2; apply your filters to this using the extension method I've added below; for me this filtering looks like:
p15612
aVStep 3; now select the entity/entities you actually want from this filtered query:
p15613
aVAnd here's the extension method:
p15614
as(dp15615
g18
V23354
p15616
stp15617
a((dp15618
g2
(lp15619
VI'm guessing
p15620
aVserialize less objects at a time
p15621
aV2 main questions:
p15622
aVwhat objects are they
p15623
aVPOCO
p15624
aVDataTable
p15625
aVwhat type of serialization is it
p15626
aVxml
p15627
aVXmlSerializer
p15628
aVDataContractSerializer
p15629
aVbinary
p15630
aVBinaryFormatter
p15631
aVSoapFormatter
p15632
aVother
p15633
aVjson
p15634
aVbespoke
p15635
aVSerialization needs to have some consideration of what the data volume is; for example, some serialization frameworks support streaming of both the objects and the serialized data, rather than relying on a complete object graph or temporary storage
p15636
aVAnother option is to serialize homogeneous sets of data rather than full graphs - i
p15637
ag50
aVserialize all the "customers" separately the "orders"; this would usually reduce volumes, at the expense of having more complexity
p15638
aVSo: what is the scenario here
p15639
as(dp15640
g18
V23354
p15641
stp15642
a((dp15643
g2
(lp15644
VWhat version of
p15645
aVNET is it
p15646
aVFor shallow copy:
p15647
aVIn 3
p15648
aV5, you can pre-compile an  to do this
p15649
aVIn 2
p15650
aV0, you can use  very easily to do the same
p15651
aVBoth will vastly out-perform reflection
p15652
aVThere is a pre-canned implementation of the  approach in  - :
p15653
aV(end shallow)
p15654
aVBinaryFormatter (in the question) is not an option here - it simply won't work since the original and destination types are different
p15655
aVIf the data is contract based, XmlSerializer or DataContractSerializer would work if all the contract-names match, but the two (shallow) options above would be much quicker if they are possible
p15656
aVAlso - if your types are marked with common serialization attributes ( or ), then protobuf-net can (in some cases) do a deep-copy / change-type for you:
p15657
aVBut this depends on the types having very similar schemas (in fact, it doesn't use the names, it uses the explicit "Order" etc on the attributes)
p15658
as(dp15659
g18
V23354
p15660
stp15661
a((dp15662
g2
(lp15663
VAbsolutely you can
p15664
aVYou can even do it with
p15665
aVThe only thing in VS is the template
p15666
aVBut you can reference the System
p15667
aVServiceProcess
p15668
aVdll yourself
p15669
aVKey points:
p15670
aVwrite a class that inherits from
p15671
aVin your , use
p15672
aVin the  override, spawn whatever new thread etc you need to do the work ( needs to exit promptly or it counts as a failed start)
p15673
aVSample Code
p15674
aVVery basic template code would be:
p15675
aVProgram
p15676
aVcs:
p15677
aVCronService
p15678
aVcs:
p15679
aVCronInstaller
p15680
aVcs:
p15681
aVAnd a
p15682
aVNET service application is not installed the same way as normal service application (i
p15683
ag50
aVyou can't use  or some other command line argument
p15684
aVInstead you must use the
p15685
aVNET SDK's :
p15686
aVResources
p15687
aVCreating a Windows Service in
p15688
aVNET by Mark Strawmyer
p15689
aVWriting a Useful Windows Service in
p15690
aVNET in Five Minutes by Dave Fetterman
p15691
aVInstalling and Uninstalling Services
p15692
aVWalkthrough: Creating a Windows Service Application in the Component Designer
p15693
as(dp15694
g18
V23354
p15695
stp15696
a((dp15697
g2
(lp15698
VYou have two options here - , or expression combination
p15699
aVI'd generally favor the latter, via  - which (with LINQ-to-SQL at least) you can do with 2 expressions (see below) - but in either case it should get composed:
p15700
aVBoth  and  each only perform 1 database hit (although the TSQL is different; the first has an  in the  clause; the second has two separate queries with )
p15701
aVHere's the extension method I used:
p15702
as(dp15703
g18
V23354
p15704
stp15705
a((dp15706
g2
(lp15707
VWhat you are trying will only work with "full"
p15708
aVNET to "full"
p15709
aVNET (or at least, matched); and even then, it breaks the rules of SOA
p15710
aVThe whole idea of a data-contract is that you share the shape of the data, but not the implementation
p15711
aVThis means that it doesn't matter that Silverlight doesn't know about EDMX, or some of the more unusual flavors of DataContract attributes (like callbacks) - the data is still intact
p15712
aVBy consuming the mex-generated version of the classes, you will still have the same essential data behaviour - that is the intended use-case of WCF with Silverlight
p15713
aVSo just use a service reference
p15714
aVAlternatively, you'll need to have a DTO class that sits between the EDMX and WCF; as long as the DTO only uses WCF attributes (but no EDMX) you should be OK, but obviously this has a huge maintenance cost
p15715
aVI personally doubt that it is worth it in most simple scenarios
p15716
as(dp15717
g18
V23354
p15718
stp15719
a((dp15720
g2
(lp15721
VIf you are after simple, lightweight and efficient binary serialization, consider protobuf-net; based on google's protocol buffers format, but implemented from scratch for typical
p15722
aVNET usage
p15723
aVIn particular, it can be used either standalone (via protobuf-net's ), or via  by implementing  (and delegating to )
p15724
aVApart from being efficient, this format is designed to be extensible and portable (i
p15725
ag50
aVcompatible with java/php/C++ "protocol buffers" implementations), unlike BinaryFormatter that is both implementation-specific and version-intolerant
p15726
aVAnd it means you don't have to mess around writing any serialization code
p15727
as(dp15728
g18
V23354
p15729
stp15730
a((dp15731
g2
(lp15732
VEssentially, you are just talking about BLOB storage and retrieval (of  or  data)
p15733
aVSee this question: Streaming directly to a database
p15734
as(dp15735
g18
V23354
p15736
stp15737
a((dp15738
g2
(lp15739
VC# events/delegates are multicast, so the delegate is itself a list
p15740
aVFrom within the class, to get individual callers, you can use:
p15741
aVHowever, to assign all at once, just use += or direct assignment:
p15742
as(dp15743
g18
V23354
p15744
stp15745
a((dp15746
g2
(lp15747
VIn C# with
p15748
aVNET 3
p15749
aV5, you can use  for this; you can build a parameterised expression and then compile it to a delegate
p15750
aVThis is exactly what I did for the maths aspect of Finguistics
p15751
aVI still have the parsing code I used if you want it
p15752
aVThe main trick I used was that to keep the delegate type known, I used an array as the input type - treating different args as arr[0], arr[1], arr[2] etc
p15753
aVThis means I could compile to (for example) a  (takes an array of s, returns a )
p15754
aVOnce you have called , this is pertty much as though you had code to do it directly
p15755
aV(edit)
p15756
aVAs a brief example of using  in this way (with a hard-coded function), see below
p15757
aVThe parser I have already written currently works as a predicate checker - i
p15758
ag50
aVto check that "
p15759
aV+ (2 *
p15760
aV-
p15761
aV= 22 +
p15762
aV- but it wouldn't be hard to change it to return the result instead (and introduce more operations, like //etc - presumably by mapping them directly to public methods on a helper object (via ))
p15763
as(dp15764
g18
V23354
p15765
stp15766
a((dp15767
g2
(lp15768
VRe the "what" - BLOB is Binary Large OBject; compare to CLOB: Character Large OBject
p15769
aVDifferent databases call them different things, though - for example, on SQL Server you have / for BLOB, and / for CLOB
p15770
aVIf a system only supports a BLOB, then one option is to encode strings - for example using UTF8
p15771
aVThis might be what is happening
p15772
as(dp15773
g18
V23354
p15774
stp15775
a((dp15776
g2
(lp15777
VHow about:
p15778
as(dp15779
g18
V23354
p15780
stp15781
a((dp15782
g2
(lp15783
VThe array limit is, afaik, fixed as int32 even on 64-bit
p15784
aVThere is a cap on the maximum size of a single object
p15785
aVHowever, you could have a nice big jagged array quite easily
p15786
aVWorse; because references are larger in x64, for ref-type arrays you actually get less elements in a single array
p15787
aVSee here:
p15788
aVI\u2019ve received a number of queries as
p15789
aVto why the 64-bit version of the 2
p15790
ag190
aVNet runtime still has array maximum
p15791
aVsizes limited to 2GB
p15792
aVGiven that it
p15793
aVseems to be a hot topic of late I
p15794
aVfigured a little background and a
p15795
aVdiscussion of the options to get
p15796
aVaround this limitation was in order
p15797
aVFirst some background; in the 2
p15798
ag190
aVversion of the
p15799
aVNet runtime (CLR) we
p15800
aVmade a conscious design decision to
p15801
aVkeep the maximum object size allowed
p15802
aVin the GC Heap at 2GB, even on the
p15803
aV64-bit version of the runtime
p15804
aVThis is
p15805
aVthe same as the current 1
p15806
ag733
aVimplementation of the 32-bit CLR,
p15807
aVhowever you would be hard pressed to
p15808
aVactually manage to allocate a 2GB
p15809
aVobject on the 32-bit CLR because the
p15810
aVvirtual address space is simply too
p15811
aVfragmented to realistically find a 2GB
p15812
aVhole
p15813
aVGenerally people aren\u2019t
p15814
aVparticularly concerned with creating
p15815
aVtypes that would be >2GB when
p15816
aVinstantiated (or anywhere close),
p15817
aVhowever since arrays are just a
p15818
aVspecial kind of managed type which are
p15819
aVcreated within the managed heap they
p15820
aValso suffer from this limitation
p15821
aVIt should be noted that in
p15822
aVNET 4
p15823
aV5 the memory size limit is optionally removed by the gcAllowVeryLargeObjects flag, however, this doesn't change the maximum dimension size
p15824
aVThe key point is that if you have arrays of a custom type, or multi-dimension arrays, then you can now go beyond 2GB in memory size
p15825
as(dp15826
g18
V23354
p15827
stp15828
a((dp15829
g2
(lp15830
VActually, although I blogged (see Luke's answer), I think this (see alternative link) is better than my IDisposable wrapper
p15831
aVTypical code:
p15832
aV(edit per comments)
p15833
aVSince  returns void, the easiest way to handle return values is via a captured variable:
p15834
as(dp15835
g18
V23354
p15836
stp15837
a((dp15838
g2
(lp15839
VThe "=>" can be read "goes to" (source: Eric Lippert), and simply separates the argument(s) from the operation in a lambda expression
p15840
aVIn this case, a lambda is overkill
p15841
aVBetter examples would be:
p15842
aV(find all items where the item's type is Foo)
p15843
aVetc
p15844
aVIn C# 2
p15845
aV0, this can also be written:
p15846
aVAnd is a quick way of expression a function "inline", while also offering "closure" support - i
p15847
ag50
aVit could also be:
p15848
aVTo do this otherwise would require a type-definiton to pass in the item-type:
p15849
aVIn fact, this is pretty-much exactly what the compiler does for us (both for "delegate" and lambda usage)
p15850
aVThe biggest difference is that a lambda can also express an , for example for LINQ
p15851
as(dp15852
g18
V23354
p15853
stp15854
a((dp15855
g2
(lp15856
VI see you've fixed the problem; but in reality, you shouldn't normally be running the service from a project's bin folder anyway - the files should be put somewhere project and profile independent (for example, under program files)
p15857
aVFor debugging purposes (when it will be in the bin folder), you can detect whether it is a service in , and if it is being run interactively just run the service code directly, rather than the usual service-start setup
p15858
aVYou can detect either by adding a command line argument, or you can try checking
p15859
as(dp15860
g18
V23354
p15861
stp15862
a((dp15863
g2
(lp15864
V1: That is a pretty standard approach, that lends itself well to a "repository" implementation for the best unit-testable approach
p15865
aV2: Exceptions (which should be declared as "faults" on the WCF boundary, btw) will get raised automatically
p15866
aVYou don't need to handle that directly
p15867
aVFor data - there are three common approaches:
p15868
aVuse  on the contract (not very pretty)
p15869
aVreturn the (updated) object - i
p15870
ag50
aVreturn just the updated identity information (primary-key / timestamp / etc)
p15871
aVOne thing about all of these is that it doesn't necessitate a different type per operation (contrast your  class, which would need to be duplicated per DTO)
p15872
as(dp15873
g18
V23354
p15874
stp15875
a((dp15876
g2
(lp15877
VI've seen this too, especially when using strong names
p15878
aVTo be honest, I didn't get excited; as long as it compiles and tests correctly, I can live with the odd glitch
p15879
aVFor example, if you get one build problem, I've seen it complain that it can't find the other (internal) methods - but a clean build shows no errors
p15880
aVAgain, I'm not to bothered by this
p15881
aV(maybe I'm too forgiving
p15882
aVIn particular, it is only rarely that I need to use an internal type/member in the tests (most of the time I'll try to test via the public API); so the lack of 100% reliable intellisense isn't usually a big problem
p15883
aVI already know the type/member I am looking for (copy/paste ;-p)
p15884
aVSure, it would be nice if it was fixed, but if I was the budget manager, I could probably live with it and focus on other features first
p15885
as(dp15886
g18
V23354
p15887
stp15888
a((dp15889
g2
(lp15890
VI don't know the reasons why it was moved (into "futures"); at a guess, it is to make it less "obvious", since it has more cost than RenderPartial (simulating much more of the pipeline, etc)
p15891
as(dp15892
g18
V23354
p15893
stp15894
a((dp15895
g2
(lp15896
VThat shouldn't throw
p15897
aVIt works fine for me:
p15898
aV(has now loaded with the feed)
p15899
aV(edit: it was working, but now I'm getting 404
p15900
aVodd)
p15901
aVIf you need to know the final url, you will possibly have to use  manually
p15902
as(dp15903
g18
V23354
p15904
stp15905
a((dp15906
g2
(lp15907
VNote: don't use  - it is subject to triggers; always use
p15908
aVI might just do:
p15909
as(dp15910
g18
V23354
p15911
stp15912
a((dp15913
g2
(lp15914
VAn  provides a layer of isolation within a process
p15915
aVEverything you usually think of as "per program" (static variables etc) is actually per-AppDomain
p15916
aVThis is useful for:
p15917
aVplugins (you can unload an , but not an assembly within an )
p15918
aVsecurity (you can run a set of code with specific trust levels)
p15919
aVisolation (you can run different versions of assemblies etc)
p15920
aVThe pain is you need to use remoting etc
p15921
aVSee MSDN for lots more info
p15922
aVTo be honest, it isn't something you need to mess with very often
p15923
as(dp15924
g18
V23354
p15925
stp15926
a((dp15927
g2
(lp15928
V(updated)
p15929
aVRe the xaml, it look like you're missing a "Path=" in the line:
p15930
aVRe the objects; it is possible that it wants properties; try:
p15931
aVThe line:
p15932
aVcreates a list of lists, each with one element (and two items in the outer list)
p15933
aVJust set  as the source:
p15934
aVIf you want to do an "interesting" projection inside the LINQ query, then it would look something more like:
p15935
aVThis is then a single list, just with different items to the original list
p15936
as(dp15937
g18
V23354
p15938
stp15939
a((dp15940
g2
(lp15941
VA Word  file has a very specific binary format; I'm not sure that  is going to make it easy to write one
p15942
aVRe compression
p15943
aVyou can compress streams of data with things like , but this is usually used for transport purposes; the recipient would also need to understand to decompress it (for example, a TCP client/server might agree to use compression)
p15944
aVWith a file, assuming you want it "as original" at the other end, you'd need a service at the other end to decompress it
p15945
aVPersonally, for local network usage, I'm not sure it is worth it unless you are shifting serious volumes of data - just use  and use a fast network
p15946
aVFor internet usage, most protocols have compression support built in
p15947
aVHttp with gzip/deflate being the most obvious
p15948
aVOf course, if you are talking about archiving, then storing files in something like
p15949
aVzip archives makes a lot of sense
p15950
aVwhen doing this "en masse", I tend to run the archive tool on the server closest to the physical disks, to maximise IO performance
p15951
as(dp15952
g18
V23354
p15953
stp15954
a((dp15955
g2
(lp15956
VI use some build scripts that update my revision based on the SVN revision
p15957
aVThat makes it trivial to track a dll back to the source code that created it
p15958
aVTime is trickier; you have to start looking in the history pane - where-as most source control tools have a "get revision " facility
p15959
as(dp15960
g18
V23354
p15961
stp15962
a((dp15963
g2
(lp15964
VWell, how much do you need to query it
p15965
aVA linked-list has fast insert/delete (at any position), but isn't as quick to search as (for example) a dictionary / sorted-list
p15966
aVAlternatively, a straight list with a bit/value pair in each - i
p15967
ag50
aV"still has value"
p15968
aVJust re-use logically empty cells before appending
p15969
aVDelete just clears the cell
p15970
aVFor reference types, "null" would do here
p15971
aVFor value-types,
p15972
as(dp15973
g18
V23354
p15974
stp15975
a((dp15976
g2
(lp15977
V is one option (but not much fun), but it feels like in this case properties offer most of what is wanted without extra work:
p15978
aVRe the wire format (base64 etc); have you tried just running it through xsd
p15979
aVexe
p15980
aVIt might surprise you and get it right
p15981
aVbut yes; within  you will have your choice of , , etc
p15982
aVBut it is very ugly; something like (for a simple version):
p15983
as(dp15984
g18
V23354
p15985
stp15986
a((dp15987
g2
(lp15988
VWell, personally I find it easier with :
p15989
as(dp15990
g18
V23354
p15991
stp15992
a((dp15993
g2
(lp15994
VWow, that is a truly bizarre way of doing it
p15995
aVNote that LINQ-to-SQL (in this case) uses
p15996
aVvery odd
p15997
aVWhich EF provider (database) are you using
p15998
aVSQL Server
p15999
aVAs you say, a stored procedure will the the job, but you shouldn't have to do that
p16000
aVvery, very odd
p16001
as(dp16002
g18
V23354
p16003
stp16004
a((dp16005
g2
(lp16006
VPersonally, I'd optimise by building a hash-set of the existing data:
p16007
aV(where  is the type of the  property)
p16008
aVThis should make things O(n+m) rather than O(n*m)
p16009
as(dp16010
g18
V23354
p16011
stp16012
a((dp16013
g2
(lp16014
VA static class simply denotes that you don't expect or need an instance
p16015
aVThis is useful for utility logic, where the code is not object-specific
p16016
aVFor example, extension methods can only be written in a static class
p16017
aVPre C# 2
p16018
aV0, you could just have a regular class with a private constructor; but  makes it formal the you can never have an instance (there is no constructor*, and all members must be static)
p16019
aV(*=see comment chain; you can optionally have a type initializer (static constructor aka ), but you cannot have an instance constructor (aka ))
p16020
as(dp16021
g18
V23354
p16022
stp16023
a((dp16024
g2
(lp16025
VThe trick you've already given () is about the best I can think of for this scenario when it executes as a query at the database
p16026
aVA bit annoying, but there are worse things
p16027
aVUnlike LINQ-to-Objects, you can't just add your own extension method, as it needs to be mapped by the underlying provider
p16028
as(dp16029
g18
V23354
p16030
stp16031
a((dp16032
g2
(lp16033
VIf you want it hosted out-of-process by the OS (i
p16034
ag50
aVwith ability to change the runtime identity, etc), then COM+ is the closest fit
p16035
aVOther than that
p16036
aVconnect to a service (such as WCF or POX) on a local IIS instance
p16037
aVMassively overkill etc
p16038
aVbut in some ways, easier to deploy: once the IIS app exists, you can robocopy updates to the folder (which isn't an option with COM+)
p16039
aVI'd probably go COM+ here unless I needed that ability
p16040
as(dp16041
g18
V23354
p16042
stp16043
a((dp16044
g2
(lp16045
VNo, there isn't one built in
p16046
aVFor implementing one; how about a 2-column , implementing  such that duplicated keys result in a red error blob:
p16047
as(dp16048
g18
V23354
p16049
stp16050
a((dp16051
g2
(lp16052
VHmm
p16053
aVlooks like a compiler bug to me
p16054
aVIt fails the following (ECMA 334v4):
p16055
aV24
p16056
ag7733
aV3 The Obsolete attribute The attribute Obsolete is used to mark
p16057
aVtypes and members of types that should
p16058
aVno longer be used
p16059
aVIf a program uses a
p16060
aVtype or member that is decorated with
p16061
aVthe Obsolete attribute, then the
p16062
aVcompiler shall issue a warning or
p16063
aVerror in order to alert the developer,
p16064
aVso the offending code can be fixed
p16065
aVSpecifically, the compiler shall issue
p16066
aVa warning if no error parameter is
p16067
aVprovided, or if the error parameter is
p16068
aVprovided and has the value false
p16069
aVThe
p16070
aVcompiler shall issue a compile-time
p16071
aVerror if the error parameter is
p16072
aVspecified and has the value true
p16073
aVIn particular, when marked true it should issue an error, and it doesn't
p16074
aVGood find
p16075
aVYou could report it on "connect", or if you don't want the pain of setting up a login, let me know and I'll happily log it (referencing your post here; no attempt to "steal" anything)
p16076
aV(update)
p16077
aVReduced code to reproduce:
p16078
aVNote that mono 2
p16079
aV0 gets it right, as does the MS C# 2
p16080
aV0 compiler
p16081
aVIt is only the MS C# 3
p16082
aV0 (
p16083
aVNET 3
p16084
aV5) compiler that is broken
p16085
as(dp16086
g18
V23354
p16087
stp16088
a((dp16089
g2
(lp16090
VHave you tried
p16091
aVThis exists on silverlight, and might make life easier
p16092
aVPresumably you'd want
p16093
aVAlso - I believe you need to use and absolute url; if you don't want to hard code (quite reasonably), you can get your host from:
p16094
aVThen use string / etc methods to make the correct "http://yoursite/whatever/your
p16095
aVpage";
p16096
aVNote that silverlight only allows (IIRC) connections to the host site
p16097
as(dp16098
g18
V23354
p16099
stp16100
a((dp16101
g2
(lp16102
VRegex is not always a good choice for xml/html type data
p16103
aVIn particular, attributes, case-sensitivity, comments, etc all have a big impact
p16104
aVFor xhtml, I'd use / and an xpath query
p16105
aVFor "non-x" html, I'd look at the HTML Agility Pack and the same
p16106
as(dp16107
g18
V23354
p16108
stp16109
a((dp16110
g2
(lp16111
VDictionary doesn't guarantee to preserve insertion order, so no: you can't rely on that (although it is hard to force it to break this)
p16112
aVIf insertion order is important, you would need to create a hybrid class, perhaps encapsulating a  for the inserted order, and a  for the indexing
p16113
as(dp16114
g18
V23354
p16115
stp16116
a((dp16117
g2
(lp16118
VNo, there is no language support for this in C#
p16119
aVThere are two workarounds that I can think of immediately:
p16120
aVuse reflection at runtime; crossed fingers and hope
p16121
aVuse a singleton / default-instance / similar to implement an interface that declares the methods
p16122
aV(update)
p16123
aVActually, as long as you have unit-testing, the first option isn't actually as bad as you might think if (like me) you come from a strict "static typing" background
p16124
aVThe fact is; it works fine in dynamic languages
p16125
aVAnd indeed, this is exactly how my generic operators code works - it hopes you have the static operators
p16126
aVAt runtime, if you don't, it will laugh at you in a suitably mocking tone
p16127
aVbut it can't check at compile-time
p16128
as(dp16129
g18
V23354
p16130
stp16131
a((dp16132
g2
(lp16133
VI can't see how it would work; in a regular hierarchy, there is a single chain to the root, so it can store the path (which is what the binary is) to each node
p16134
aVHowever, with multiple parents, this isn't possible: even if you split matriarchy and partiarchy, you still have 1 mother, 2 grandmothers, 4 great-grand-mothers, etc (not even getting into some of the more "interesting" scanerios possible, especially with livestock)
p16135
aVThere is no single logical path to encode, so no: I don't think that this can work in your case
p16136
aVI'm happy to be corrected, though
p16137
as(dp16138
g18
V23354
p16139
stp16140
a((dp16141
g2
(lp16142
VThe connection-level settings can be critical in some cases, especially , , etc
p16143
aVIn particular, if you have calculated persisted indexed columns (including promoted "xml" columns), then it won't trust the pre-calculated, index value if the settings aren't compatible, and will recalculate for each row (i
p16144
ag50
aVtable scan instead of index seek)
p16145
as(dp16146
g18
V23354
p16147
stp16148
a((dp16149
g2
(lp16150
VWell, you could use an associated xsd to enforce the order
p16151
aVI'll see it I can query it conveniently
p16152
aV(update) I'm not sure you can
p16153
aVthe appropriate axis are all disabled, as is position(name) and node/position()
p16154
as(dp16155
g18
V23354
p16156
stp16157
a((dp16158
g2
(lp16159
VEnums and ints are simply not implicitly castable as per the spec (except for the literal 0, which is allowed for comparison tests / assignments / etc)
p16160
aVThe explicit cast is all that is needed, though
p16161
as(dp16162
g18
V23354
p16163
stp16164
a((dp16165
g2
(lp16166
VDo you have LINQ available
p16167
aVIf so, one option is:
p16168
aVHowever, new/removed rows won't update the original list (edits to existing rows are fine)
p16169
aVIf not LINQ, you can do the same with :
p16170
aVThere is the  /  pair, but none of the standard lists (including ) implement this feature
p16171
as(dp16172
g18
V23354
p16173
stp16174
a((dp16175
g2
(lp16176
VI would assume that it is a simple snippet that records the number of times a method or set of methods is accessed, perhaps with timings
p16177
aVEssentially, profiling calls over a particular boundary
p16178
aVAn API is just the mechanism for 2 bits of code to talk
p16179
aVThat could be a managed interface etc call, an unmanaged (interop) call, a web-request, etc
p16180
aVAnything that allows you to use a particular bit of functionality
p16181
aVVague enough
p16182
aV(edit: the question keeps changing
p16183
aVIn the case of "BulkInsert into SQL from c# application", I assume it highlights usage of  and/or TSQL bulk inserts from
p16184
aVNET callers
p16185
aVFor example,  has events for every batch of rows
p16186
as(dp16187
g18
V23354
p16188
stp16189
a((dp16190
g2
(lp16191
VUnfortunately, GAC tends to play a trump card - but if you have changed the version, then the GAC resolve should fail (as long as you have "Specific Version" set to true in the IDE), allowing it to load the local version
p16192
as(dp16193
g18
V23354
p16194
stp16195
a((dp16196
g2
(lp16197
VThe inner source returns fixed-size buffers
p16198
aVIf that case, that isn't quite what  does - that simply reduces the number of calls to a physical stream
p16199
aVYou'd need a separate mechanism to cache - a MemoryStream that you fill and empty would be a reasonable choice
p16200
aVFor example (completely untested):
p16201
as(dp16202
g18
V23354
p16203
stp16204
a((dp16205
g2
(lp16206
VYou can't
p16207
aVIt sounds like you are vastly over-using the pool
p16208
aVPerhaps consider a throttled queue / custom thread pool (i
p16209
ag50
aVa synchronized producer/consumer queue)
p16210
aV(don't increase the pool size; that is almost always the wrong approach to take)
p16211
as(dp16212
g18
V23354
p16213
stp16214
a((dp16215
g2
(lp16216
VWell, named-pipes does most of what you are discussing, but to be honest it isn't worth it
p16217
aVin most cases, a temp file is a reasonable approach
p16218
as(dp16219
g18
V23354
p16220
stp16221
a((dp16222
g2
(lp16223
VI suspect that you've already done everything you can (since you are already using a projection, that the engine is choosing to express as individual sub-selects)
p16224
aVThe only other things I can think of are (for example) using a table-valued UDF (via the data-context) to get the start/end - see whether it flattens that into the query
p16225
aVHave you profiled the query and compared to your preferred layout
p16226
aVIt might well be that the profile is identical (i
p16227
ag50
aVthe TSQL optimizer has dealt with it)
p16228
aVIn which case, no need to be overly concerned
p16229
as(dp16230
g18
V23354
p16231
stp16232
a((dp16233
g2
(lp16234
VIf you have an , can you not just use  /
p16235
aVAlso, all s are , allowing you to get a navigator
p16236
aVFinally, you can use , and use this to create an  using the overload that accepts an
p16237
as(dp16238
g18
V23354
p16239
stp16240
a((dp16241
g2
(lp16242
V (in common with most direct list-based bindings) can only bind to immediate properties of the row item
p16243
aVYou could perhaps create a facade object for this
p16244
ag412
ag50
aVa class that accepts the instance and returns the name as a direct property:
p16245
aVAlternatively, you could project into a new object
p16246
aVFor example, data-bindings work (read-only, at least) with anonymous types pretty well:
p16247
aVFinally, you can hack around in  to flatten the model at runtime, but it really isn't worth it just for this
p16248
as(dp16249
g18
V23354
p16250
stp16251
a((dp16252
g2
(lp16253
VI'm not aware of a  limitation, but then: I rarely use Vista ;-p
p16254
aVRather than raw sockets
p16255
aVone option is to have the service act as a WCF host, via
p16256
aVYour app would be a WCF client, (proxy generated via  or via the IDE)
p16257
aVThis would make it painless to talk to, The only question would be which channel to use - perhaps named pipes, since that is machine specific
p16258
as(dp16259
g18
V23354
p16260
stp16261
a((dp16262
g2
(lp16263
VThe jquery forms plugin supports file uploads in this way
p16264
as(dp16265
g18
V23354
p16266
stp16267
a((dp16268
g2
(lp16269
VIn 3
p16270
aV0, WCF is probably the most versatile for general usage
p16271
aVWPF is fine, but is windows/UI specific
p16272
aVIn 3
p16273
aV5, LINQ all the way ;-
p16274
as(dp16275
g18
V23354
p16276
stp16277
a((dp16278
g2
(lp16279
VFor info (general Begin/End usage), you might want to see this blog post; this approach is working OK for me, and saving much pain
p16280
as(dp16281
g18
V23354
p16282
stp16283
a((dp16284
g2
(lp16285
VYes, I've been having similar issues
p16286
aVit seems very poorly documented for using named objects/profiles
p16287
aVThere is a google group; posting there might help
p16288
aVWhen I get time to tidy up my own question, I'll probably add a bounty
p16289
as(dp16290
g18
V23354
p16291
stp16292
a((dp16293
g2
(lp16294
VOK, I will investigate
p16295
aVI've logged this here
p16296
aVShould be fun ;-p
p16297
aVOut of interest, are  and  in the same assembly
p16298
aVBy the way; in the next drop, I intend including  etc that accept a  (rather than generics) - this will make the "in progress" RPC stack much simpler, and will help your usage too
p16299
aVUpdate; I've added a unit-test and (in a separate dll, loaded via  test classes)
p16300
aVThe unit-test passed
p16301
aVPlease can you clarify what your code does differently (I need something I can reproduce in order to fix it)
p16302
as(dp16303
g18
V23354
p16304
stp16305
a((dp16306
g2
(lp16307
VIIRC, CodeDom simply doesn't have a way of expressing this
p16308
aVAutomatically implemented properties are just compiler sugar, but since it doesn't map (cleanly) to all languages, it doesn't fit cleanly into CodeDom (besides, CodeDom would have needed an update)
p16309
as(dp16310
g18
V23354
p16311
stp16312
a((dp16313
g2
(lp16314
VThere are 2 things to look at; an implicit conversion operator (in ) to , or the / operators themselves
p16315
aVtrue/false operators (note I prefer the implicit bool conversion myself):
p16316
aVthen you can use
p16317
aVconversion operator:
p16318
aVworks likewise
p16319
aVYou might also add a conversion in the other direction:
p16320
aVThen you can assign  etc
p16321
aVFinally, I wonder if this should be an immutable struct
p16322
aVIt might be confusing if you expect this to behave like a value
p16323
aVFor example, look at the last line here:
p16324
aVThis prints false, because both  fields point to the same instance of
p16325
aVIf that was the intent, then fine
p16326
aVBut if it was me, I'd make it immutable (whether class or struct)
p16327
aVBut since it doesn't really have any state other than a bool, I'd argue that this fits well as a struct
p16328
aVTo be honest, I'm not entirely sure why it is needed at all, when all the functionality could be done via static methods / etc
p16329
as(dp16330
g18
V23354
p16331
stp16332
a((dp16333
g2
(lp16334
VYou probably want  (the rawest of the copies; ideally suitable for )
p16335
aVOf course, the other option is to use a  in place of the outbound array, and just  to it each time, then call  or  on the  (with , you need to watch the length; with  it is trimmed for you automatically):
p16336
as(dp16337
g18
V23354
p16338
stp16339
a((dp16340
g2
(lp16341
VYou just have to let it go out of scope, and wait for GC to find it; which might not be immediately (in fact, it almost certainly won't be)
p16342
aVIf you have a field on a long-lived object (that is going to stay in scope), then you can set to null, which can help
p16343
aVYou can influence the GC to collect sooner (not just your object: everything eligible), but you should rarely if ever do this
p16344
aVI use it only in test rigs; but:
p16345
aVfor more on :
p16346
aVWhat\u2019s so wrong about using GC
p16347
aVCollect()
p16348
aVWhen is it acceptable to call GC
p16349
aVCollect
p16350
as(dp16351
g18
V23354
p16352
stp16353
a((dp16354
g2
(lp16355
VThis is a classic generics use-case; try:
p16356
aVNow inside  you have access to all the  members, but it will work with:
p16357
aVEdit: I've additionally blogged on the differences between 4
p16358
aV0 covariance and generics for this scenario
p16359
as(dp16360
g18
V23354
p16361
stp16362
a((dp16363
g2
(lp16364
s(dp16365
g18
V23354
p16366
stp16367
a((dp16368
g2
(lp16369
VIn a property/method on the object, in C#/VB
p16370
aVNET (your
p16371
aVNET code)
p16372
aVThe time to execute a simple property like this is nothing compared to the time to call out-of-process to a database (to fetch the rows in the first place), or the transport time of a web-page; you'll never notice it if just using it for UI display
p16373
aVPlus it is on your easily-scaled-out hardware (the app server), and doesn't involve a huge update daily, and is only executed for rows that are actually displayed, and only if you actually query this property/method
p16374
as(dp16375
g18
V23354
p16376
stp16377
a((dp16378
g2
(lp16379
VI suspect you want generics:
p16380
aVThe  is the generic-type-argument; the type we want to create
p16381
aVThe  says "it must be  or a sub-type, and it must have a public parameterless constructor" - this lets us use  to create a new instance of it, and access all members of  against such instances (such as )
p16382
aVThis also allows us to call the methods that accept a  as an argument
p16383
as(dp16384
g18
V23354
p16385
stp16386
a((dp16387
g2
(lp16388
VAt the simplest level: when you call , you get to give it the service instances to execute
p16389
aVSimply declare this as a public property on your service, and assign prior to calling :
p16390
aVThen read  in your service:
p16391
aVYou can also use the service args, but that is from the external caller (service registration) - not programatically (per the question)
p16392
as(dp16393
g18
V23354
p16394
stp16395
a((dp16396
g2
(lp16397
VYes (for "seconds" at least; not sure it scales to "minutes") - at the login screen, just spin up a worker thread (perhaps with ) that does something that requires those assemblies
p16398
aVThis will cause them to load
p16399
aVYou are now off the UI thread, loading your assemblies while the user types their password
p16400
as(dp16401
g18
V23354
p16402
stp16403
a((dp16404
g2
(lp16405
VWell, what does the code look like
p16406
aVis the easiest way to query a page:
p16407
aVThe timer code might also be glitchy if it is stalling
p16408
as(dp16409
g18
V23354
p16410
stp16411
a((dp16412
g2
(lp16413
VThe "must not" seems odd
p16414
aVif you use an IDE designer to throw some controls down, but don't use the code, is that sufficient
p16415
aVOr use "blend" - that generates xaml, which is just layout - no code
p16416
as(dp16417
g18
V23354
p16418
stp16419
a((dp16420
g2
(lp16421
VDo you mean you want to query only the name
p16422
aVIn which case:
p16423
aVor in query syntax:
p16424
aVTo insert you'd need to create a number of  objects - set the names but not the other properties, and add them to the context (and submit it)
p16425
aVLINQ is a query tool (hence the Q); insertions are currently object oriented
p16426
as(dp16427
g18
V23354
p16428
stp16429
a((dp16430
g2
(lp16431
VYou can't bind properly to an  (except in ASP
p16432
aVNET where  is fine) - it ideally wants a repeatable list of objects
p16433
aVUsing  is counter-intuitive
p16434
aVAll you need is a  /  etc; i
p16435
ag50
aVNow use  as the binding source
p16436
aVIMO, the data-context would be hidden behind a repository interface, but your mileage may vary
p16437
as(dp16438
g18
V23354
p16439
stp16440
a((dp16441
g2
(lp16442
VYou can, but I wouldn't personally do all the lines at once - I'd use an iterator block:
p16443
aVThis returns each line (the caller can then  etc efficiently, without buffering everything)
p16444
aVIt is also now callable from any source of  rows (including but not limited to a jagged array)
p16445
aVAlso - with a local variable you could use  to make each line slightly cheaper
p16446
aVTo return the entire string at once, I'd optimize it to use a single  for all the string work; a bit more long-winded, but much more efficient (far fewer intermediate strings):
p16447
as(dp16448
g18
V23354
p16449
stp16450
a((dp16451
g2
(lp16452
VWell, there are some things you can do with ambient objects (in particular thread-static fields), but it isn't pretty
p16453
aVI'd argue that if the logic is different, it should be a separate method in the first place
p16454
aVAlso, note that one point of view is that entity objects shoudn't be talking to the database anyway - their job is to represent the state of an object; it is the job of a repository class (or similar) to worry about persistance
p16455
aVThen you repository would have two strategies to cope with things
p16456
aVPerhaps there is an IBulkRepository interface that the repo could (optionally) implement, etc
p16457
as(dp16458
g18
V23354
p16459
stp16460
a((dp16461
g2
(lp16462
VWell, first-off, is there any reason that you can't use a regular return instead of  here
p16463
aVIt would be cleaner (unless there is a good reason)
p16464
aVThen you can use:
p16465
as(dp16466
g18
V23354
p16467
stp16468
a((dp16469
g2
(lp16470
VIt depends on why; see Eric Lippert's blog entry
p16471
aVIf they are "boneheaded exceptions", then no - just fix the calling code
p16472
aVIn the rare case that they are "vexing exceptions" (i
p16473
ag50
aVthe code you are calling has traps that are hard to avoid), then I guess you'd have to
p16474
as(dp16475
g18
V23354
p16476
stp16477
a((dp16478
g2
(lp16479
VPersonally, if the id doesn't exist, I'd either return , or (less preferred) I'd throw an  or
p16480
aVThat avoids the whole question - you just check against
p16481
as(dp16482
g18
V23354
p16483
stp16484
a((dp16485
g2
(lp16486
VI suspect the UI thread is pumping messages during the MessageBox life-cycle
p16487
aVBecause locks are re-entrant (and the UI thread is running the code each time), this causes the above
p16488
aVPerhaps try passing the owner () into the message-box
p16489
aV(I'll try in a sec
p16490
aVYou could block it more forcefully, but that will block painting ("not responding" etc)
p16491
as(dp16492
g18
V23354
p16493
stp16494
a((dp16495
g2
(lp16496
VOh, absolutely you can use vanilla objects with LINQ-to-SQL; you don't even need to subclass  - but you do need to tell it about your model
p16497
aVThis is often done with attributes on members (for columns) and types (for tables), but can also be done with an external mapping file (xml)
p16498
aVI wonder if they are just over-abbreviating for simplicity
p16499
aVfor example, I suspect that the table should be a property:
p16500
aVThe whole "dbml" thing is just there as a designer tool to help you generate the classes; the important code is just decoracted classes (with some conventions on things like navigation properties to make life simper to use)
p16501
aVThat said, for "quickest": use the designer
p16502
as(dp16503
g18
V23354
p16504
stp16505
a((dp16506
g2
(lp16507
VFirst - you don't need a navigator; SelectNodes / SelectSingleNode should suffice
p16508
aVYou may, however, need a namespace-manager - for example:
p16509
as(dp16510
g18
V23354
p16511
stp16512
a((dp16513
g2
(lp16514
VWell, you need to define the args and possibly delegate somewhere
p16515
aVYou don't need a second file, but I'd probably recommend it
p16516
aVbut the classes should probably not be nested, if that was the original problem
p16517
aVThe recommendation is to use the standard "sender, args" pattern; there are two cmmon approaches:
p16518
aV1: declare an event-args class separately, and use  on the interface:
p16519
aV2: declare an event-args class and delegate type separately:
p16520
as(dp16521
g18
V23354
p16522
stp16523
a((dp16524
g2
(lp16525
V can be used by any subclasses from any assembly
p16526
aVis everything that  is, plus also anything in the same assembly can access it
p16527
aVImportantly, it doesn't mean "subclasses in the same assembly" - it is the union of the two, not the intersection
p16528
as(dp16529
g18
V23354
p16530
stp16531
a((dp16532
g2
(lp16533
VHere's my test rig, using  for simplicity; results first:
p16534
aV(update for  results:)
p16535
aV(update re 2048 * 64 * 150)
p16536
aVand with OptimizeForTesting enabled:
p16537
aVSo faster, but not massively so; rig (run at console, in release mode, etc):
p16538
as(dp16539
g18
V23354
p16540
stp16541
a((dp16542
g2
(lp16543
VThe first thing to do is to put on logging, to see what TSQL was generated; for example:
p16544
aVLINQ-to-SQL seems to treat nulls a little inconsistently (depending on literal vs value):
p16545
aVSo all I can suggest is use the top form with nulls
p16546
ag412
ag50
aVUpdate - I got it working "properly" using a custom :
p16547
as(dp16548
g18
V23354
p16549
stp16550
a((dp16551
g2
(lp16552
VDo you just want the flattened ids
p16553
as(dp16554
g18
V23354
p16555
stp16556
a((dp16557
g2
(lp16558
VSimply - it doesn't know if you are reading an element or attribute
p16559
aVQuite possibly, all you need is a cast here:
p16560
aVThe SelectNodes returns an XmlNodeList, but the above treats each as an XmlElement
p16561
as(dp16562
g18
V23354
p16563
stp16564
a((dp16565
g2
(lp16566
VA very common pattern when working with buffers is the:
p16567
aVpattern
p16568
aVHowever, you cannot use this with a  / parameter, since when you assign to a parameter it consumes the entire buffer
p16569
aVYou will need a new array:
p16570
as(dp16571
g18
V23354
p16572
stp16573
a((dp16574
g2
(lp16575
VActually, your assertion ("You can only have one DataReader open per connection") is incorrect; you can enable MARS (Multiple Active Result Sets) via a tweak to the connection string, and job done; except of course that you'll still have lots of round-trips (n+1)
p16576
aVI also don't think that the immediate alternative is datasets
p16577
aVPersonally, I'd use two result grids (either from a single query or 2 queries) and stitch them together back at the caller
p16578
aVAlternatively, use something like LINQ-to-SQL with  ()
p16579
aVEven without , it'll do the same n+1 behaviour automatically simply by loading the collection for each  (navigation properties are loaded lazily by default)
p16580
as(dp16581
g18
V23354
p16582
stp16583
a((dp16584
g2
(lp16585
VThe All() extension method checks a predicate against all the items; for example, at execution:
p16586
aV(checks all lines are closed, and if so, closes the order)
p16587
aVof in a query:
p16588
as(dp16589
g18
V23354
p16590
stp16591
a((dp16592
g2
(lp16593
VNote that many platforms include tools for this purpose; while you can write custom [de]serialization code, it can get tedious very quickly
p16594
aVFor example, google's protocol buffers is a language-agnostic* mechanism for describing a wire format
p16595
aVYou can technically get better (smaller) serialization if you do everything by hand, but it will be a lot more work
p16596
aV*= c++, java, etc in the google repo - plus lots more by the community
p16597
as(dp16598
g18
V23354
p16599
stp16600
a((dp16601
g2
(lp16602
VFileSystemWatcher is a pragmatic way of getting early visibility of a file drop, but there are a lot of edge-cases that can cause missed events
p16603
aVYou would still need a periodic sweep to be sure
p16604
aVTo avoid as many mutex issues; could the clients upload as foo
p16605
aVxml
p16606
aVupload, and then rename to foo
p16607
aVxml one there
p16608
aVThat would avoid a lengthy locked file
p16609
aV(you just ignore the
p16610
aVupload ones)
p16611
aVAlso: beware "not invented here"
p16612
aVthere are many existing utilities that monitor folders; BizTalk for (an overkill) example
p16613
aVI'm not saying "don't do it yourself", but at least consider pre-canned options
p16614
as(dp16615
g18
V23354
p16616
stp16617
a((dp16618
g2
(lp16619
VDo you mean a (method) variable
p16620
aVor a field (on an instance or type)
p16621
aVFor a method-level variable (in C# at least) it is irrelevant, since "definite assignment" means that you must give it a value before you can read it
p16622
aVFields default to the bitwise zero state:
p16623
aVfor reference types (including string) that means null
p16624
aVfor  ( etc) that means null
p16625
aVfor numerics that means 0
p16626
aVfor enums that means 0 even if there is no 0-valued enum defined
p16627
aVfor bools that means false
p16628
aVfor DateTime, that means the same as MinValue
p16629
aVfor other structs, you'll have to check their documentation, but it will be a (hopefully sensible) "zero/empty" value
p16630
as(dp16631
g18
V23354
p16632
stp16633
a((dp16634
g2
(lp16635
VDefine "doesn't work"
p16636
aVit certainly works in C# (I don't know if the C++ editor supports it - just translate the following which works in C# to find out ;-p)
p16637
aVI don't "do" C++ any more, but reflector says:
p16638
as(dp16639
g18
V23354
p16640
stp16641
a((dp16642
g2
(lp16643
VActually, that code is redundant
p16644
aVA "view" maps the actual DataTable to something with virtual properties that can be used for data-binding scenarios
p16645
aVThe default view is just the "all columns, in that order, no initial sort, no initial filter" layout
p16646
aVWith your code, the line:
p16647
aVshould be fine
p16648
aVAs an aside - the  usage and string-indexer can be tidied a bit:
p16649
aVThis is bother easier to read and more efficient (the DataColumn indexer is the optimal one)
p16650
as(dp16651
g18
V23354
p16652
stp16653
a((dp16654
g2
(lp16655
VHmmm
p16656
aVinteresting
p16657
aVfails for me using  and  in
p16658
aVNET - but it looks like it should work
p16659
aVcurious
p16660
aVupdate the problem seesm to be the root match; try
p16661
aVThis then works for me without any other changes
p16662
aVThe difference is that you were matching the root node
p16663
aVWhen you did your "apply templates", it cascaded first to catalog (with the param), then to cd (without the param)
p16664
aVTo get what you want, you need to start at catalog
p16665
aVYou can see this by adding an  to the match, and then try it as "/" and "/catalog"
p16666
as(dp16667
g18
V23354
p16668
stp16669
a((dp16670
g2
(lp16671
VFirst; have you considered TryParse
p16672
aVThe lock will be released for 2 reasons; first,  is essentially:
p16673
aVSecond; you catch and don't re-throw the inner exception, so the  never actually sees an exception
p16674
aVOf course, you are holding the lock for the duration of a MessageBox, which might be a problem
p16675
aVSo it will be released an all but the most fatal catastrophic unrecoverable exceptions
p16676
as(dp16677
g18
V23354
p16678
stp16679
a((dp16680
g2
(lp16681
VRegex is not always the best tool for HTML; I'd use the HTML Agility Pack (since it isn't xhtml), and xpath - it should be pretty trivial then:
p16682
as(dp16683
g18
V23354
p16684
stp16685
a((dp16686
g2
(lp16687
VThey aren't used by the implementing class - but still might be critical
p16688
aVFor example, WCF defines service-contracts and operation-contracts by the attributes on the interface
p16689
aVIf they aren't of use in your case, then delete them
p16690
aVOtherwise, leave them alone ;-p
p16691
as(dp16692
g18
V23354
p16693
stp16694
a((dp16695
g2
(lp16696
VThe problem I can think with SVN is that it will be grow quite steadily with large binary media (very little, if any, "diff" usage), and it is very hard to purge history with SVN
p16697
aVAs long as you know what you are doing, it should be OK
p16698
as(dp16699
g18
V23354
p16700
stp16701
a((dp16702
g2
(lp16703
VIf you are under high memory load, and using a lot of objects, then yes: GC will get busy
p16704
aVif it is hitting gen-2, then it sounds like you've got a lot of mid/long-life objects hanging around
p16705
aVI'm assuming that memory usage is fairly stable
p16706
aVThe above could indicate some kind of pseudo-leak (perhaps holding onto too many objects via static events, etc), or could just mean that you have a high memory usage
p16707
aVHow much memory are you using
p16708
aVCould you consider x64 and a ton of memory
p16709
aVAlternatively, would the 3gb switch (x86) buy you a few more bytes
p16710
as(dp16711
g18
V23354
p16712
stp16713
a((dp16714
g2
(lp16715
VYou can also do this at the point of creating an , by providing the additional details in the constructor
p16716
aVNote that it doesn't re-use such models, so you'd want to configure the  once (at app startup, from configuration), and re-use it repeatedly
p16717
aVnote many more customizations are possible with the  overload
p16718
as(dp16719
g18
V23354
p16720
stp16721
a((dp16722
g2
(lp16723
VIt is 0-based
p16724
aVA return question might be: why do you want to make it 1-based
p16725
aVWith Extension Methods you could (if you wanted) do:
p16726
aVthen use (from almost any collection):
p16727
as(dp16728
g18
V23354
p16729
stp16730
a((dp16731
g2
(lp16732
VThe field approach is concise, which gets a lot of votes, but my preference (for simple properties) would be to use auto-properties, in which case you are forced to use the constructor:
p16733
aVYou might also consider using  etc, which helps designers and serializers, but this does not affect the initial value of an auto implemented property (or a regular property) - it is additional info only
p16734
as(dp16735
g18
V23354
p16736
stp16737
a((dp16738
g2
(lp16739
VYes; see here; you just need to ask the dictionary to finish deserialization:
p16740
as(dp16741
g18
V23354
p16742
stp16743
a((dp16744
g2
(lp16745
VThe best I can think of
p16746
aVBasically, there are a few patterns that  respects; , and  (note you should mark  with  too
p16747
aVNot very elegant, I'll grant; but  only looks at public members, so you can't even hide them (short of )
p16748
as(dp16749
g18
V23354
p16750
stp16751
a((dp16752
g2
(lp16753
VGiven that error; just set the DataTable's name
p16754
aVPersonally, I'd use object-serialization (perhaps  over ), but  should be fine
p16755
aVUpdate; for an example using  / ; note the "THIS LINE MAKES IT ALL WORK" comment; this is necessary a: to be able to write, and b: to read the rows correctly
p16756
as(dp16757
g18
V23354
p16758
stp16759
a((dp16760
g2
(lp16761
VSince it is dev only (and probably doesn't have to be very elegant), how about using TSQL to generate a pile of TSQL that you then copy back into the query window and execute
p16762
aVIt won't be pretty, but it should work
p16763
aVan alternative might be to insert something like the above into a table-variable, then loop over the table-variable using
p16764
aVBut for dev purposes it probably isn't worth it
p16765
as(dp16766
g18
V23354
p16767
stp16768
a((dp16769
g2
(lp16770
VBasically, you can't - with regular web-services, at least
p16771
aVthe proxy class is completely separate
p16772
aVHowever, the above is possible with WCF, where you don't actually need proxy classes at all (however, for SOA purity it is a good idea to use them)
p16773
aVYou could use reflection (etc) to copy the properties between your domain entities and the proxies, but it is quite hard to get this 100% right (although xml serialization should work [in theory] as an intermediate language)
p16774
aVSo; if you want to use assembly sharing; consider using WCF, which supports this ;-p
p16775
aVTo get hold of a service without using a proxy layer, you can do tricks like:
p16776
aV(this will access the default configuration from the app
p16777
aVconfig; for more control you need to add a few constructor overloads matching to the base constructor overloads)
p16778
aVThen:
p16779
as(dp16780
g18
V23354
p16781
stp16782
a((dp16783
g2
(lp16784
VAssuming you have a reference-table of the working days (and their hours), then I would use a 3 stage approach (pseudo-sql)
p16785
aV(first preclude the "all in one day" trivial example, since that simplifies the logic)
p16786
aVObviously it is a bit hard to do properly without more context
p16787
as(dp16788
g18
V23354
p16789
stp16790
a((dp16791
g2
(lp16792
VI suspect you are holding onto references
p16793
aVAs a minor cause, note that dialogs don't dispose themselves when using , so you should be  the dialog (although I would expect GC to still collect an undisposed but non-referenced dialog)
p16794
aVLikewise, you should probably be  the image, but again: not sure I'd expect this to make-or-break; worth a try, though
p16795
aVI'd also be a little cautious of the  etc, to ensure that things are released ASAP
p16796
as(dp16797
g18
V23354
p16798
stp16799
a((dp16800
g2
(lp16801
VSee the answers on this thread
p16802
aVI like this option ;-p
p16803
aVRe returning values / reporting exceptions - just have each fork do that as a callback at the end of the logic
p16804
aV(you can use captured variables to pass state into both the forks, including a shared logger etc)
p16805
as(dp16806
g18
V23354
p16807
stp16808
a((dp16809
g2
(lp16810
VWhen using ConfigurationManager, I'm pretty sure it is loading the process/ configuration file (app
p16811
aVconfig / web
p16812
aVconfig)
p16813
aVIf you want to load a specific config file, you'll have to specifically ask for that file by name
p16814
aVYou could try:
p16815
as(dp16816
g18
V23354
p16817
stp16818
a((dp16819
g2
(lp16820
VIt all depends on what else uses the bool
p16821
aVIn particular, it the bool truly a field (as suggested by the "private"), or is it a variable
p16822
aVThere is a difference, as you can mark a field as  (but not a variable)
p16823
aVHowever, my gut feel is that you should be using synchronization such as , perhaps with pulsing etc - or a gate such as
p16824
aVWithout either synchronization or , it is possible for another thread to not see changes to the variable - but we really can't say more without the other half of the code
p16825
as(dp16826
g18
V23354
p16827
stp16828
a((dp16829
g2
(lp16830
VEnums are not checked:
p16831
aVNow you have a  that isn't defined
p16832
aVHe is just saying "check your input"
p16833
aVNote that  is relatively slow (reflection based)
p16834
aVPersonally, I tend to use a switch with a  that throws an exception:
p16835
as(dp16836
g18
V23354
p16837
stp16838
a((dp16839
g2
(lp16840
Vnote: I'm answering this from the client's perspective - i
p16841
ag50
aVthe  switch on  (also available in the IDE)
p16842
aVPersonally, I tend to keep it simple and use
p16843
aVIf you are going to do lots of data binding,  might be an option, but for object properties it is usually overkill
p16844
aVArrays make life very hard
p16845
aVavoid them ;-p
p16846
aVNote that with
p16847
aVNET 3
p16848
aV5 the features available to each collection type blur, thanks to the extension methods on
p16849
aVNormally,  is useful when you think you might want to subclass the collection to use the  extension points
p16850
aVThis isn't really an option with WCF
p16851
aVAs already stated, using  etc isn't an option unless you are using assembly sharing, since the generated class won't be able to create the collection
p16852
as(dp16853
g18
V23354
p16854
stp16855
a((dp16856
g2
(lp16857
VIf both 1 & 2 are inheriting, then they are functionally identical, no
p16858
aVShould one of them be encapsulating a control
p16859
aVIn which case you have a lot of pass-thru members to add
p16860
aVI wouldn't recommend it
p16861
aVPeronally, I simply wouldn't add extra inheritance without a very good reason
p16862
aVfor example, the "changed event" could perhaps have been handled with some overloads etc
p16863
aVWith C# 3
p16864
aV0 this gets even cleaner thanks to extension methods - i
p16865
ag50
aVyou can have things like:
p16866
aVand just use  (relying on the static type of  to resolve the appropriate extension method)
p16867
aVOf course, you could take a step back and listen to events on your own model, not the UI - let the UI update the model in a basic way, and have logic in your own object model (that has nothing to do with controls)
p16868
as(dp16869
g18
V23354
p16870
stp16871
a((dp16872
g2
(lp16873
VOnly integer and hex directly, I'm afraid (ECMA 334v4):
p16874
aV9
p16875
ag7733
ag7733
aV2 Integer literals Integer literals are used to write values of
p16876
aVtypes int, uint, long, and ulong
p16877
aVInteger literals have two possible
p16878
aVforms: decimal and hexadecimal
p16879
aVTo parse, you can use:
p16880
as(dp16881
g18
V23354
p16882
stp16883
a((dp16884
g2
(lp16885
VCan you edit this in the dbml
p16886
aVPersonally, I tend to treat the auto-generated types (from functions and stored procedures) as DTOs that are local to the DAL, so I immediately re-map them to my own POCO representation - i
p16887
ag50
aVetc
p16888
aVRe the second question "Also, how can you perform a linq query on the result set of the stored procedure
p16889
aV- I would recommend using a UDF instead of a stored procedure if you want to compose it: this allows you to do the composition at the database, for example paging and filtering:
p16890
aVwhich should (in LINQ-to-SQL at least) do everything in TSQL at the server
p16891
aVOtherwise, you can call  and use LINQ-to-Objects at the calling
p16892
aVNET layer:
p16893
aVTo edit the dbml (which is just xml), change the  here:
p16894
as(dp16895
g18
V23354
p16896
stp16897
a((dp16898
g2
(lp16899
VHow about:
p16900
as(dp16901
g18
V23354
p16902
stp16903
a((dp16904
g2
(lp16905
VA WCF client is disposable, so except for a few caveats you can use :
p16906
aVBut there is a big problem with this; the  on the WCF client actually throws if it is faulted (losing the original exception)
p16907
aVThere is a good workaround, here, or I've blogged on this here
p16908
as(dp16909
g18
V23354
p16910
stp16911
a((dp16912
g2
(lp16913
VThe  in  is on a completely different  - the one you created in
p16914
aVSimply get rid of  and it should work:
p16915
as(dp16916
g18
V23354
p16917
stp16918
a((dp16919
g2
(lp16920
VI expect the problem here is that it has already called
p16921
aVI suggest you override  at the data-context, and apply this logic there instead
p16922
as(dp16923
g18
V23354
p16924
stp16925
a((dp16926
g2
(lp16927
VDefine "doesn't work" - seems fine to me
p16928
aVin particular:
p16929
aVRe the second; all  arithmetic results in an int, due to CPU efficiencies etc; try:
p16930
as(dp16931
g18
V23354
p16932
stp16933
a((dp16934
g2
(lp16935
VWell, at some point you're going to have to check all the columns - might as well get joining
p16936
aVThat should do it
p16937
aVthere is also , but this only helps - you'd still need to check the actual values to preclude hash-conflicts
p16938
as(dp16939
g18
V23354
p16940
stp16941
a((dp16942
g2
(lp16943
VJust additional to the other points; if you want access to a dirty amount of memory, consider x64 - but be aware that the maximum single object size is still 2GB
p16944
aVAnd because references are larger in x64, this means that you actually get a smaller maximum array/list size for reference-types
p16945
aVOf course, by the time you hit that limit you are probably doing things wrong anyway
p16946
aVOther options:
p16947
aVuse files
p16948
aVuse a database
p16949
aV(obviously both has a performance difference compared to in-process memory)
p16950
aVUpdate: In versions of
p16951
aVNET prior to 4
p16952
aV5, the maximum object size is 2GB
p16953
aVFrom 4
p16954
aV5 onwards you can allocate larger objects if gcAllowVeryLargeObjects is enabled
p16955
aVNote that the limit for  is not affected, but "arrays" should cover "lists" too, since lists are backed by arrays
p16956
as(dp16957
g18
V23354
p16958
stp16959
a((dp16960
g2
(lp16961
VIt verifies:
p16962
aVthe user has typed their e-mail correctly (since this is the only way you have of contacting them, lets get it right)
p16963
aVthe e-mail address exists
p16964
aVit is owned by the person requesting the page
p16965
aVIndeed - it doesn't prevent bots from accepting e-mails from their own e-mail account, but it stops them accepting e-mails from my account
p16966
aVthis in turn keeps you out of the legal quagmire of being accused of spamming some random Jo
p16967
aVEveryone wins
p16968
as(dp16969
g18
V23354
p16970
stp16971
a((dp16972
g2
(lp16973
VTwo interesting lessons
p16974
aVFirst; with lists; try to think in terms of ; for full details see here, but in short you need to use:
p16975
aVand not:
p16976
aVSecond: watch for the edge cases ;-p
p16977
aVCan you see the trap here
p16978
as(dp16979
g18
V23354
p16980
stp16981
a((dp16982
g2
(lp16983
VI've already +1'd Mitch's reply, but as an aside: Word isn't even supported for use in service applications; it is designed to be user-interactive
p16984
aVSo installing Word, even if it worked, wouldn't leave you in a great place
p16985
as(dp16986
g18
V23354
p16987
stp16988
a((dp16989
g2
(lp16990
VI have some designer friends who are big fans of the Expression suite
p16991
aVAs a code monkey, it isn't part of my own regular tool kit
p16992
aVHowever; note that most web design tools (presumably Expression Web included) tend to be quite hard to pair with regular ASP
p16993
aVNET, simply because you don't have full control of the HTML
p16994
aVIf you are going to look at things like Expression Web for designer input, might I suggest looking at ASP
p16995
aVNET MVC, as this gives you much more direct control over the final HTML - pretty much allowing you to drop the designer's html into your "view", and just start adding the data elements
p16996
aVIt looks like the tool tries to play nicely with (regular) ASP
p16997
aVNET, but how well it behaves once you start adding real ASP
p16998
aVNET code may be different
p16999
as(dp17000
g18
V23354
p17001
stp17002
a((dp17003
g2
(lp17004
VA bit tangential, but I just use VisualSVN Server
p17005
aVIt is free, very easy to setup ("next", "next"
p17006
aV, and comes with an MMC snap-in to do all the admin
p17007
aVThis makes it a doddle to get working on multiple repositories, without having to add extra services each time
p17008
aV(note; they charge for the client, but you can use any SVN client to talk to it; I like TortoiseSVN, but whatever you like
p17009
aVAlso - under the hood, it uses Apache to expose the data, providing both HTTPS for security, and allowing internet usage over firewall-friendly ports
p17010
aVFinally, it even allows the choice of "regular" username/password pairs, or integration with your network (domain etc) credentials
p17011
aVPretty slick
p17012
as(dp17013
g18
V23354
p17014
stp17015
a((dp17016
g2
(lp17017
VYou don't need a data-table to bind - you just need something like a list / enumerable
p17018
aVFor example, if you know the row number:
p17019
aVNote that we have to use  (rather than ) in order to get the runtime-only properties (i
p17020
ag50
aVthe data from columns)
p17021
aVIf you have a , this approach could easily be wrapped in a utility method, for example an extension method:
p17022
aVwith:
p17023
as(dp17024
g18
V23354
p17025
stp17026
a((dp17027
g2
(lp17028
VIndexers share a lot of commonality with properties (under the hood, an indexer is a property with an index), and extension properties don't exist
p17029
aVAgreed, there would be scenarios where they are handy
p17030
aVRe the scenario presented - in some ways, this is quite like
p17031
aVOf course, if you declare an interface that has a string indexer, then your reader-code could use it directly - but it would be a lot of unnecessary work to implement this interface repeatedly
p17032
aVRe the extension method; does this use regular reflection
p17033
aVYou might want to look at tricks like , which might save a lot of CPU time if you are doing lots of this
p17034
aVTypical usage would then be:
p17035
aVYou can optimise this further by looking at the returned columns first (once per grid, not per row), and only accessing matched columns
p17036
aVOr alternatively, look at ORM tools;  can also be used to do data reading (I have a complete example of this somewhere on usenet, for DbLinq)
p17037
as(dp17038
g18
V23354
p17039
stp17040
a((dp17041
g2
(lp17042
VIn C#, the closest to specialization is to use a more-specific overload; however, this is brittle, and doesn't cover every possible usage
p17043
aVFor example:
p17044
aVHere, if the compiler knows the types at compile, it will pick the most specific:
p17045
aVHowever
p17046
aVwill use  even for , as this is burned in at compile-time
p17047
aVOne other approach is to use type-testing within a generic method - however, this is usually a poor idea, and isn't recommended
p17048
aVBasically, C# just doesn't want you to work with specializations, except for polymorphism:
p17049
aVHere  will always resolve to the correct override
p17050
as(dp17051
g18
V23354
p17052
stp17053
a((dp17054
g2
(lp17055
VWith 400k objects, I wonder whether a database (either in-process or out-of-process) wouldn't be a more appropriate answer
p17056
aVThis then abstracts the index creation process
p17057
aVIn particular, any database will support multiple different indexes over different column(s), making the queries cited all very supportable without having to code specifically for each (just let the query optimizer worry about it)
p17058
aVWorking with it in-memory may be valid, but you might (with vanilla
p17059
aVNET) have to do a lot more manual index management
p17060
aVBy the sounds of it, i4o would certainly be worth investigating, but I don't have any existing comparison data
p17061
as(dp17062
g18
V23354
p17063
stp17064
a((dp17065
g2
(lp17066
VA  /  is not a proper database as such
p17067
aVbut can certainly be used for an in momory object model - but without most of the features you would normally associate with an RDBMS
p17068
as(dp17069
g18
V23354
p17070
stp17071
a((dp17072
g2
(lp17073
VAs a thought, try adding (fairly early on - i
p17074
ag50
aVat the start of ):
p17075
aVThat said - it seems to work fine for me with or without
p17076
as(dp17077
g18
V23354
p17078
stp17079
a((dp17080
g2
(lp17081
V(edit - I misread the original question)
p17082
aVYou cannot add actual attributes (they are burned into the IL); however, with  you don't have to - you can supply additional attributes in the constructor to the
p17083
aVYou do, however, need to be a little careful to cache the  instance if you do this, as otherwise it will create an additional assembly per instance, which is a bit leaky
p17084
aV(it doesn't do this if you use the simple constructor that just takes a )
p17085
aVLook at
p17086
aVFor an example:
p17087
aVNote also; if the xml attributes were just illustrative, then there is a second way to add attributes for things related to data-binding, by using  and either  or
p17088
aVMuch more complex than the xml case, I'm afraid - and doesn't work for all code - just code that uses the component-model
p17089
as(dp17090
g18
V23354
p17091
stp17092
a((dp17093
g2
(lp17094
VLINQBridge makes me immediately suspicious
p17095
aVThe entire intent of this is to provide extension attribute/methods etc for 2
p17096
aV0 users
p17097
aVIf you have 3
p17098
aV5 (System
p17099
aVCore
p17100
aVdll), don't use LINQBridge
p17101
aVIf you do need LINQBridge in 3
p17102
aV5 for some obscure reason (and I can't think of one), then you might have to use an extern alias
p17103
aVBut I really doubt you need it
p17104
as(dp17105
g18
V23354
p17106
stp17107
a((dp17108
g2
(lp17109
VWith XmlDocument, you will need to import those nodes into a second document;
p17110
as(dp17111
g18
V23354
p17112
stp17113
a((dp17114
g2
(lp17115
VOnly just found this post
p17116
aVdo you mean like this
p17117
as(dp17118
g18
V23354
p17119
stp17120
a((dp17121
g2
(lp17122
VApologies for arriving late at the party
p17123
aVI am the author of protobuf-net, one of the C# implementations
p17124
aVFor network usage, you should consider the "[De]SerializeWithLengthPrefix" methods - that way, it will automatically handle the lengths for you
p17125
aVThere are examples in the source
p17126
aVI won't go into huge detail on an old post, but if you want to know more, add a comment and I'll get back to you
p17127
as(dp17128
g18
V23354
p17129
stp17130
a((dp17131
g2
(lp17132
VIt sounds like you want a :
p17133
aVThe caller can then wrap this in many ways; for simple functions:
p17134
aVor where arguments are involved, a closure:
p17135
as(dp17136
g18
V23354
p17137
stp17138
a((dp17139
g2
(lp17140
VRight now, your best bet is CSharpCodeProvider; the plans for 4
p17141
aV0 include "compiler as a service", which will make this fully managed
p17142
as(dp17143
g18
V23354
p17144
stp17145
a((dp17146
g2
(lp17147
V(in the System
p17148
aVComponentModel namespace; MSDN)
p17149
as(dp17150
g18
V23354
p17151
stp17152
a((dp17153
g2
(lp17154
VUntested, but how about:
p17155
as(dp17156
g18
V23354
p17157
stp17158
a((dp17159
g2
(lp17160
VYou can have a timeout while aquiring a lock using ; and likewise, within a lock you can do things like / to temporarily yield the lock, but you can't be interrupted as such
p17161
aVThe main time interrupt applies might be in Thread
p17162
aVSleep, which can be interrupted with Thread
p17163
aVInterrupt - but again, this won't yank control out of an executing method block
p17164
aVWhat exactly is it that you are trying to achieve
p17165
aVWith more context we can probably help more
p17166
as(dp17167
g18
V23354
p17168
stp17169
a((dp17170
g2
(lp17171
VThere are a few options for this; the most obvious being serviced components; this allows you to host the managed code in COM+ to run it in a separate process, but you need GAC/COM-callable etc
p17172
as(dp17173
g18
V23354
p17174
stp17175
a((dp17176
g2
(lp17177
VYou can't really make arbitrary types serializable; in some cases (, for example) the runtime exposes options to spoof the attributes
p17178
aVBut  doesn't allow this
p17179
aVFeasible options:
p17180
aVhide the classes behind your own types that are serializable (lots of work)
p17181
aVprovide binary formatter surrogates (yeuch)
p17182
aVwrite your own serialization core (a lot of work to get right)
p17183
aVEssentially, if something isn't designed for serialization, very little of the framework will let you serialize it
p17184
as(dp17185
g18
V23354
p17186
stp17187
a((dp17188
g2
(lp17189
VIf you just want  to work, then you'll need to implement  or  in the class
p17190
aVIf you don't mind creating a new list, you can use the / LINQ extension methods
p17191
aVIf you want to sort the existing list with simpler syntax, you can add a few extension methods, enabling:
p17192
aVFor example:
p17193
as(dp17194
g18
V23354
p17195
stp17196
a((dp17197
g2
(lp17198
VThe Add References dialog isn't the entire GAC ;-p
p17199
aVSee here for a walkthrough (I believe the steps are identical for VB and C#)
p17200
aVEasier is to just "Browse
p17201
aVto the dll you want; personally, I avoid GAC unless I absolutely need it, such as a COM-callable-wrapper hosted in COM+ as a "serviced component"
p17202
aVOther than that, file references work better IMO
p17203
as(dp17204
g18
V23354
p17205
stp17206
a((dp17207
g2
(lp17208
VThis is a "searched case expression" (see MSDN):
p17209
as(dp17210
g18
V23354
p17211
stp17212
a((dp17213
g2
(lp17214
VIf you implement , you are reasponsible for all data (i
p17215
ag50
aVscenario "2" in your question); nothing extra is serialized automatically
p17216
aVWhat is your requirement
p17217
aVThings like  can be property-based, allowing you to decorate both the regular fields and your custom property (that has some logic) and have them serialized properly
p17218
aVIf you need binary (for space etc), then perhaps consider things like protobuf-net, which mixes the two while being space efficient
p17219
aVSo: what are your requirements
p17220
aVData Contract example:
p17221
as(dp17222
g18
V23354
p17223
stp17224
a((dp17225
g2
(lp17226
VYou can change the registered  for something using ; this isn't quite the same as , but it may suffice:
p17227
as(dp17228
g18
V23354
p17229
stp17230
a((dp17231
g2
(lp17232
VIt is largely about being verifiable
p17233
aVBy stating , the gloves are off - the system can no longer guarantee that your code won't run amok
p17234
aVIn most cases it is highly desirable to stay in the safe zone
p17235
aVThis gets more noticeable with partial trust (addins etc), but is still valuable in regular code
p17236
as(dp17237
g18
V23354
p17238
stp17239
a((dp17240
g2
(lp17241
VThe way you are using (cast by example) is messy and very brittle -  I really don't recommend it (if you add a property, or name them in a different order, it'll break; etc)
p17242
aVThe better approach is to use your own named type in the projection
p17243
as(dp17244
g18
V23354
p17245
stp17246
a((dp17247
g2
(lp17248
VHow were you hosting
p17249
aVNote that a non-admin program using http will need permissions to use the port (in http
p17250
aVsys)
p17251
aVThis is via netsh (Vista) or (IIRC) httpcfg (XP)
p17252
aVSee here, for example
p17253
as(dp17254
g18
V23354
p17255
stp17256
a((dp17257
g2
(lp17258
VI think it depends on whether your queries are fixed inside the repository (the better option, IMO), or whether the repository exposes composable queries; for example - if you have a repository method:
p17259
aVThen your UI could request:
p17260
aVThis will pass for an object-based fake repo, but will fail for actual db implementations
p17261
aVOf course, you can nullify this by having the repository handle all queries internally (no external composition); for example:
p17262
aVBecause this can't be composed, you can check the DB and the UI independently
p17263
aVWith composable queries, you are forced to use integration tests throughout if you want it to be useful
p17264
as(dp17265
g18
V23354
p17266
stp17267
a((dp17268
g2
(lp17269
V1: you are re-declaring the method (); if you  it should work
p17270
aVThe  breaks any polymorphic behavior
p17271
aV2: you are re-implementing the interface; this indeed calls the highest implementation
p17272
aVAgain,  would fix this
p17273
as(dp17274
g18
V23354
p17275
stp17276
a((dp17277
g2
(lp17278
VYou can encapsulate the list trivially:
p17279
as(dp17280
g18
V23354
p17281
stp17282
a((dp17283
g2
(lp17284
VEntity Framework itself is provider-based, and is designed to operate over a relational database
p17285
aVIf you really wanted to, you could write your own provider for EF that reads from/writes to an xml file, but it would be a huge amount of work
p17286
aVI expect you should really be looking at one of:
p17287
aVLINQ-to-XML
p17288
aVXML (de)serialization
p17289
aVXPath/XQuery
p17290
aVXSLT
p17291
aVEntity Framework doesn't have a natural fit in this scenario
p17292
as(dp17293
g18
V23354
p17294
stp17295
a((dp17296
g2
(lp17297
VI would take things outside of the "aspx" pipeline
p17298
aVIn particular, I would write a ran handler (ashx, or mapped via config), that does the minimum work, and simply writes to the response in chunks
p17299
aVThe handler would accept input from the query-string/form as normal, locate the object to stream, and stream the data (using a moderately sized local buffer in a loop)
p17300
aVA simple (incomplete) example shown below:
p17301
as(dp17302
g18
V23354
p17303
stp17304
a((dp17305
g2
(lp17306
VStructs should represent values
p17307
aVValues do not change
p17308
aVThe number 12 is eternal
p17309
aVHowever, consider:
p17310
aVNow foo
p17311
aVBar and foo2
p17312
aVBar is different, which is often unexpected
p17313
aVEspecially in the scenarios like properties (fortunately the compiler detect this)
p17314
aVBut also collections etc; how do you ever mutate them sensibly
p17315
aVData loss is far too easy with mutable structs
p17316
as(dp17317
g18
V23354
p17318
stp17319
a((dp17320
g2
(lp17321
VThey are all different
p17322
aVXAML is an example of data stored in xml (same as xhtml, etc), used in WCF/WPF/Silverlight etc
p17323
aVXSLT is a declarative transformation language
p17324
aVXML schemas (XSD) define valid xml
p17325
aVEach have different use-cases, and all are useful for different scenarios
p17326
aVXSD is worth knowing as it allows you to author valid xml documents, for example
p17327
as(dp17328
g18
V23354
p17329
stp17330
a((dp17331
g2
(lp17332
VIf it simply isn't understanding your SP, that could be the SET FMT_ONLY issue
p17333
aVtry generating the data from a simplified version of the SP
p17334
aVNormally, SPs / UDFs that don't map 1:1 with an existing entity would expose themselves in a generated type
p17335
aVYou can rename this in the DBML file (not in the designer), but personally I wouldn't; I tend to mark the SP as private, and write my own method that projects into my own POCO type (defined for the repository):
p17336
aVThe reason for this is partly for repository purity, and partly to guard against the designer's habit of re-writing the DBML in unexpected ways ;-p See here for more
p17337
as(dp17338
g18
V23354
p17339
stp17340
a((dp17341
g2
(lp17342
VTo add methods, you should be using partial classes
p17343
aVTry adding a second class file with (in the right namespace etc):
p17344
aVThe  keyword tells the compiler to allow the class to be split over multiple files - ideal for code-generation scenarios
p17345
aVIt does, however, demand the  keyword in every file; the members are simply combined (except for partial methods in C# 3
p17346
aV0 which have their own subtle behaviour)
p17347
aVI hope that wsdl
p17348
aVexe (or whatever) includes this
p17349
as(dp17350
g18
V23354
p17351
stp17352
a((dp17353
g2
(lp17354
VSome curiosities:
p17355
aVextension methods might be called on  instances; this might be confusing (but sometimes useful)
p17356
aVthe "hiding" issue is a biggie if they have different intent
p17357
aVequally, you might get a different extension method with the same name from 2 different namespaces; if you only have one of the two namespaces, this could lead to inconsistent behaviour (depending on which)
p17358
aVbut if somebody adds a similar (same signature) extension method in a second namespace that your code uses, it will break at compile time (ambiguous)
p17359
aV(edit) And of course, there is the "/" bomb (see here)
p17360
as(dp17361
g18
V23354
p17362
stp17363
a((dp17364
g2
(lp17365
VIn the example given above, I'm a little unclear on the distinction between your factory and the repository
p17366
aVI wonder if you shouldn't simply add CreateProduct as a method to the repository, and using DI to push the repository into code that needs it
p17367
aVIf the factory isn't doing anything, etc
p17368
aVOr if you just want it to act as a globally registered repository, perhaps something like:
p17369
aV(in my mind it seems clearer to separate the "set" in this case, but you don't have to agree)
p17370
aVand have the callers use  etc
p17371
as(dp17372
g18
V23354
p17373
stp17374
a((dp17375
g2
(lp17376
VIt sounds like you are doing premature optimisation
p17377
aVProfile, and you will usually be surprised where the time is going
p17378
aVI doubt it will be here, unless your "clone" is using serialization
p17379
aVThat said;  is worth avoiding simply because it is poorly defined (deep vs shallow) and rarely supported
p17380
aVBehind the scenes, most  implementations either just do a , or they use serialization
p17381
as(dp17382
g18
V23354
p17383
stp17384
a((dp17385
g2
(lp17386
VUnested, but how about re-writing it a bit:
p17387
aVAlternatively, you could perhaps group
p17388
as(dp17389
g18
V23354
p17390
stp17391
a((dp17392
g2
(lp17393
V"and waiting must be async" - I'm not trying to be funny, but isn't that a contradiction in terms
p17394
aVHowever, since you are starting a , the  event may help:
p17395
aVIf you want to actually wait (timeout etc), then:
p17396
aVFor waiting async, perhaps just use a different thread
p17397
as(dp17398
g18
V23354
p17399
stp17400
a((dp17401
g2
(lp17402
VI have a build script for individual projects, and I simply chain those from a second build file when building a suite
p17403
aVfor example, my protobuf-net build file handles versioning (SVN), compilation (MSBuild + NAnt for mono), testing (NUnit), packaging (zip), etc
p17404
aVIt is your build process; do what you need ;-p If could also, for example, do deployment and documentation if I wanted
p17405
aVIt also depends on how you work; if you are using CruiseControl, it may handle much of this for you
p17406
aVFor myself, I like a command-line "build" step
p17407
as(dp17408
g18
V23354
p17409
stp17410
a((dp17411
g2
(lp17412
VI guess it comes down to precision and scale
p17413
aVIIRC,  is 4dp
p17414
aVIf that is fine,  expresses your intent
p17415
aVIf you want more control, use  with a specific precision and scale
p17416
as(dp17417
g18
V23354
p17418
stp17419
a((dp17420
g2
(lp17421
VWell, if you have LINQ (C# 3
p17422
aV0 + either
p17423
aVNET 3
p17424
aV5 or LINQBridge) you can use  - otherwise, just create an array and copy the data
p17425
as(dp17426
g18
V23354
p17427
stp17428
a((dp17429
g2
(lp17430
VIf you are using the standard setup, your controller(s) can do this by overriding one of the methods (proabably , but I don't have it handy to check)
p17431
aVIf you want all your controllers to share this logic, you can use a base-controller
p17432
aVAlternatively, you can do this via filters (for example )
p17433
aVI don't know if there is a single global place for such logic, though
p17434
as(dp17435
g18
V23354
p17436
stp17437
a((dp17438
g2
(lp17439
VIs it not available in CF 3
p17440
ag691
aV(edit: nope, I checked - indeed it is not)
p17441
aVI know that XmlSerialzier is there, but yes, it does have some limitations
p17442
aVDoes it need to be text-based
p17443
aVOn option is protobuf-net, which works on CF2
p17444
aV0, CF3
p17445
aV5, Silverlight, Mono,
p17446
aVNET 2
p17447
aV0, etc; and includes all the things you commonly need (including callbacks etc)
p17448
aVBy the way, the Mono code (from "Olive") is, last time I looked, not very complete
p17449
aV(edit) One other option might be Json
p17450
aVNET; from here, this now works on CF; since this is JSON, it is text-based, and should do most of what you need
p17451
as(dp17452
g18
V23354
p17453
stp17454
a((dp17455
g2
(lp17456
VRemoting works by intercepting calls to certain objects (), and by performing an RPC call instead; essentially the object at the caller is just a lightweight proxy to the real object at the originating AppDomain/machine/etc
p17457
aVThe arguments and results are transferred (again, taking  into account - otherwise by using  to serialize the values)
p17458
aVReflection is built deep into the core runtime, and provides access to the underlying type definitions
p17459
aVThis is possibly in part because the IL underneath
p17460
aVNET languages is quite expressive in terms of the original code
p17461
aVHowever, I am not personally aware of any way to talk via remoting to java
p17462
aVIt may be possible, but the formats used are (AFAIK) proprietary
p17463
aVIn general, such calls are more likely to take the form of SOA calls, such as web-services (on SOAP or POX), or other open standards such as messages serialized with JSON or "protocol buffers" (an open-source wire format with variants for both C# and java)
p17464
as(dp17465
g18
V23354
p17466
stp17467
a((dp17468
g2
(lp17469
VAs far as I see it, you are already testing  in the two ways in which it can be used (with and without a running operation)
p17470
aVAs long as the  is doing its job, it seem to me that you're testing it reasonably
p17471
aVIdeally you should be able to verify the commands sent to the device etc (which most mock frameworks will make simple)
p17472
as(dp17473
g18
V23354
p17474
stp17475
a((dp17476
g2
(lp17477
VDo GETs work
p17478
aVPerhaps it is a proxy config issue ( etc)
p17479
aVAlso - to simplify things (reduce the number of unknowns), consider using  to do the post:
p17480
as(dp17481
g18
V23354
p17482
stp17483
a((dp17484
g2
(lp17485
VI was at a conference last week, and a number of non-MS people were telling their experiences of using Silverlight for line-of-business apps
p17486
aVGenerally, it seemed positive
p17487
aVThe advantage seemed that you could start with the Silverlight version, and then if you (later) needed more client control, mostly just copy the xaml and app code into WPF
p17488
aVmostly is important, as there are currently some glitches
p17489
aVBut it is much harder to start with WPF and port to Silverlight ;-p
p17490
aVSacrifices
p17491
aVNot as much power over the client
p17492
aVLimited framework, etc
p17493
aVPitfalls
p17494
aVNot-quite-compatible xaml
p17495
aVDifferent IO, etc
p17496
aVI can't cite specific projects, as I simply didn't write them down ;-p Besides, they might be company-private
p17497
aVKnowing that they exist doesn't violate NDA ;-p
p17498
as(dp17499
g18
V23354
p17500
stp17501
a((dp17502
g2
(lp17503
VThe usual way is by writing extension methods to  - for example:
p17504
aVNow in the view you can use  etc (since the standard view has an  member called )
p17505
aVYou can also write methods in a base-view, but the extension method approach appears to be the most common
p17506
as(dp17507
g18
V23354
p17508
stp17509
a((dp17510
g2
(lp17511
VFor free selection, I expect (in 1
p17512
aV1)  is your best option
p17513
aVIn 2
p17514
aV0, this is largely replaced with , which is much more versatile
p17515
aVI would also recommend that you consider moving to a more up to data framework version; I realise this isn't always possible, but you will be hamstrung with 1
p17516
ag733
as(dp17517
g18
V23354
p17518
stp17519
a((dp17520
g2
(lp17521
VFirst - you might want to check the "Devices" tab (VS2008), and check the "Deploy the latest version
p17522
aVbox (to push 3
p17523
aV5 onto the device, if this is an option)
p17524
aVIt is entirely possible that you need to re-create the project file to do change the target to 2
p17525
aV0 (i
p17526
ag50
aVcreate a new project, selecting 2
p17527
aV0 on the first screen)
p17528
aVIt usually isn't a big job to copy in the
p17529
aVcs files etc
p17530
aVIf the project is large, you might consider editing the csproj manually, but I'm not sure I'd bother
p17531
aVprobably less work to just re-add the code
p17532
as(dp17533
g18
V23354
p17534
stp17535
a((dp17536
g2
(lp17537
VIf you are using details mode, I wonder if  wouldn't be more versatile
p17538
aVEach row has a Height, or you can use AutoSizeRowsMode to do it automatically
p17539
aVSee MSDN "Resizing Columns and Rows in the Windows Forms DataGridView Control"
p17540
as(dp17541
g18
V23354
p17542
stp17543
a((dp17544
g2
(lp17545
VYou can probably do that quite easily with PostSharp, but in general: no; you'd have to call it explicitly
p17546
as(dp17547
g18
V23354
p17548
stp17549
a((dp17550
g2
(lp17551
VStart with  or  and you're already there
p17552
aVIf you need the multiple items per key, then consider a
p17553
aVThere are ways to simplify addition etc with extension methods - it needn't be scary
p17554
aVNote also that  is case-insensitive, so you might need to use one of the insensitive comparisons - for example:
p17555
aV(edit) here's an example of using an extension method to populate multiple values against a single key in C# 3
p17556
aV0:
p17557
as(dp17558
g18
V23354
p17559
stp17560
a((dp17561
g2
(lp17562
VAs Brian notes, this should work fine
p17563
aVThe only common limitation people see in this area is covariance of lists as method arguments - i
p17564
ag50
aVthey find that they can't pass a  to a method that accepts a
p17565
aVThe answer in that case is generics:
p17566
aVFor more discussion on covariance (including the C# 4
p17567
aV0 changes that doesn't change the above scenario, see here)
p17568
as(dp17569
g18
V23354
p17570
stp17571
a((dp17572
g2
(lp17573
VThe first argument to a  is the  statement to use; your code is adding a new database row every time the data is queried (which sounds very, very wrong), plus I anticipate the query itself won't really work due to the confusion over the  vs
p17574
aVYou should really just be doing a  from , and then perhaps adding a row the the local data-table afterwards:
p17575
aVPersonally, I wouldn't add a fake row unless it was absolutely essential to the binding; I can't advise on that, I'm afraid
p17576
aVbut you'll need to be careful that you don't add empty rows accidentally
p17577
aVPerhaps check on the post-back (assuming ASP
p17578
aVNET), and only save if it has something useful in it
p17579
as(dp17580
g18
V23354
p17581
stp17582
a((dp17583
g2
(lp17584
VEntity Framework uses the EDM to model data; this is a set of 3 complex schema files (storage, conceptual, mapping), most commonly stored as resources in the project (via the designer which uses a single EDMX file to generate all 3 schema files)
p17585
aVIt doesn't support attributed classes for this information
p17586
aVThe only sensible way to write EDM is via the designer (essentially, a modelling tool which you dislike)
p17587
aVRe classes the "use" more than one underlying table; yes, a single Entity Framework entity  at the conceptual layer (i
p17588
ag50
aVclasses) can span multiple storage tables
p17589
aVThis is especially useful for some inheritance examples, but can (IIRC) be used by flat models too
p17590
aVYou do this via the "mappings" between the storage and conceptual layers (most commonly; on the tab in the designer)
p17591
as(dp17592
g18
V23354
p17593
stp17594
a((dp17595
g2
(lp17596
VThe  attribute (among others) does this, I believe - for example:
p17597
aVYou should be able to find this setting in the default  file generated by the IDE; if not, declare it yourself (as above)
p17598
aVYou might also want to look generally at the "Assembly Information
p17599
aVdialog in project properties, which provides access to this and others
p17600
as(dp17601
g18
V23354
p17602
stp17603
a((dp17604
g2
(lp17605
VI believe that the  argument is for generic type parameters - i
p17606
ag50
aVyou were trying to call:
p17607
aVTry passing an empty
p17608
aVEdit re the confusion (comments); my point is: you shouldn't be specifying anything for the  argument
p17609
aVEither an empty array or null would do; for example:
p17610
as(dp17611
g18
V23354
p17612
stp17613
a((dp17614
g2
(lp17615
VThat form of flat list is very hard to work with in xslt, as you need to find the position of the next grouping, etc
p17616
aVCan you use different xml
p17617
aVFor example, with the flat xml:
p17618
aVIt becomes trivial to do (very efficiently):
p17619
aVIs that an option
p17620
aVOf course, if you build the xml as a hierarchy it is even easier ;-p
p17621
as(dp17622
g18
V23354
p17623
stp17624
a((dp17625
g2
(lp17626
VSince we have no way of reproducing it, can you define "breaks the application"
p17627
aVCan you cite the error message please
p17628
aVFor info, I have occasionally seen the expression compiler make dubious decisions about nullability - for more see here
p17629
aVThis might be related, but impossible to say without the error message
p17630
as(dp17631
g18
V23354
p17632
stp17633
a((dp17634
g2
(lp17635
VYou can't change the defaults
p17636
aVThey default to the most restrictive
p17637
aVThe default accessibility (for the type) for a top-level type is
p17638
aVThe default accessibility (for the type) for a nested type is
p17639
aVThe default accessibility for members is private
p17640
aVThe only time it isn't the most restrictive is for the explicit part of an automatically implemented property, where you can make it more restrictive by adding a modifier:
p17641
as(dp17642
g18
V23354
p17643
stp17644
a((dp17645
g2
(lp17646
VWhich line is throwing the exception
p17647
aVThe
p17648
aVor the
p17649
aVAnd what is the
p17650
aVIs it a
p17651
aVI only ask because of the comment "And none of value in it is not greater than 255" - which of course  is automatic for a
p17652
aVAs a more obvious question: does the binary actually contain an image in a sensible format
p17653
aVFor example, the following (although not great code) works fine:
p17654
as(dp17655
g18
V23354
p17656
stp17657
a((dp17658
g2
(lp17659
VThe overall approach is reasonable - although I'm not sure about the  which seems a bit restrictive
p17660
aVIf you are limiting to returning the same thing, I wonder if just accepting the name () as the second arg wouldn't be easier
p17661
aVRe naming - perhaps borrow from LINQ
p17662
aVThis is essentaially a  - how about :
p17663
aV(edit) maybe with the additional  specific:
p17664
as(dp17665
g18
V23354
p17666
stp17667
a((dp17668
g2
(lp17669
VTry removing the generic type arguments; the first is the source, not the key:
p17670
aVHere, we are using generic type inference to supply the details
p17671
as(dp17672
g18
V23354
p17673
stp17674
a((dp17675
g2
(lp17676
VIf you are hosting in IIS, then you need to set the identity of the app-pool that the web app is running in
p17677
aVNote that the user you select needs access to logon as a service, and a few other things
p17678
aVYou are likely to get "500 Server Unavailable" if the user is even slightly malconfigured, so tread carefully
p17679
aVAlso note that you need to fully recycle the app-pool to try again
p17680
aV(edit) - found my notepad ;-p
p17681
aVAdd the account to the "Log on as a service" policy-group (Local Security Policy (Local Security Settings) -> User Rights Assignment)
p17682
aVAdd the account to the "IIS_WPG" user-group (Computer Management -> Local Users and Groups)
p17683
aVGrant the account "Read & Execute", "List Folder Contents" and "Read" permissions to the file structure (Explorer -> Properties)
p17684
aVEither create a new application pool, or update the user account of an existing pool (Internet Information Services -> Application Pools)
p17685
aVSet the application pool for the site / application (Internet Information Services -> Web Sites)
p17686
as(dp17687
g18
V23354
p17688
stp17689
a((dp17690
g2
(lp17691
VYes; the instrumented code is different to uninstrumented code
p17692
aVAnd this means you have to be slightly careful with the results - but most profilers do a reasonable job of drawing your focus to the important bits
p17693
aVI've never had much luck with the sampling option - instrumentation has often been useful, though
p17694
aVPersonally, I like the jetBrains offering
p17695
as(dp17696
g18
V23354
p17697
stp17698
a((dp17699
g2
(lp17700
VI think Eric Lippert gets the defining quotes here:
p17701
aVPreventing third-party derivation part one
p17702
aVPreventing third-party derivation part two
p17703
as(dp17704
g18
V23354
p17705
stp17706
a((dp17707
g2
(lp17708
VThe correct way is for the data-source to implement , return  for , and issue  events
p17709
aVHowever, AFAIK, a  does this
p17710
as(dp17711
g18
V23354
p17712
stp17713
a((dp17714
g2
(lp17715
VYou can do half of it a bit more simply:
p17716
aVbtw; you should make a habit of ending attributes with the word
p17717
aVEven if this causes duplication (see )
p17718
aVHowever - re serialization; that isn't always trivial
p17719
aVA deceptive amount of code goes into serialization frameworks like Json
p17720
aVNET etc
p17721
aVThe normal approach might be to get a type-converter, but in many ways this is easier with a :
p17722
as(dp17723
g18
V23354
p17724
stp17725
a((dp17726
g2
(lp17727
VIn some ways, the switch (perhaps on an enum rather than just an id) is quite reasonable
p17728
aVYou could push the assembly-qualified names into the DB, but what does the DB care about assemblies or classes
p17729
aVAnd what happens when you refactor
p17730
aVMove to java
p17731
aVNeed to support multiple UI engines
p17732
aVNah, I'd probably just switch myself - in a factory method to encapsulate it
p17733
as(dp17734
g18
V23354
p17735
stp17736
a((dp17737
g2
(lp17738
VIt is unusual to listen to your own events; such logic can typically go into the OnAuthenticationFailed method
p17739
aVThat said - I'm very confused about what your code is trying to do, which makes it a little hard to answer
p17740
aVI doubt it applies, but note additionally that there are some subtle synchronisation issues you might need to think about (when talking to your own events) if this code is highly threaded (which most isn't)
p17741
as(dp17742
g18
V23354
p17743
stp17744
a((dp17745
g2
(lp17746
VDo your updates happen on a background thread
p17747
aVI don't know if it will work in your scenario, but you could try this threaded binding list; see the example to see the worker merrily editing the grid
p17748
as(dp17749
g18
V23354
p17750
stp17751
a((dp17752
g2
(lp17753
VI wonder if you shouldn't do that the "long" way
p17754
aVIf you need the format as a string, do that later at the UI
p17755
aVEither by reconstructing a  etc, or using
p17756
as(dp17757
g18
V23354
p17758
stp17759
a((dp17760
g2
(lp17761
VJust for additional info; essentially, it uses  to do the comparisons
p17762
aVThis implements , and can compare 2 objects of type
p17763
aVThe actual implementation is selected the first time you ask for it (per ); there are a number of patterns that the framework uses to pick the implementation - for example, classes, "regular" structs, and  are all handled separately
p17764
aVLikewise, it makes choices based on whether  implements , , or neither (in which case it throws an exception)
p17765
aVThis provides a very easy way to do "duck type" sorting
p17766
aVLikewise, there is also an  that checks for , defaulting to  otherwise
p17767
as(dp17768
g18
V23354
p17769
stp17770
a((dp17771
g2
(lp17772
VI don't know if it works while invisible, but jQuery has some options here - in particular the height function; worth a look
p17773
aVBased on your example, something like:
p17774
as(dp17775
g18
V23354
p17776
stp17777
a((dp17778
g2
(lp17779
VThat looks pretty reasonable to me
p17780
aVThere are some other options, like a , but what you have is simpler and should suffice for most simple cases
p17781
aVAlways prefer simple and readable ;-p
p17782
as(dp17783
g18
V23354
p17784
stp17785
a((dp17786
g2
(lp17787
V"Best" is subjective
p17788
aVFirst, draw up a list of the features you need, your architecture, etc
p17789
aVThen look for options that do what you need, without introducing unnecessary complexity
p17790
aVFor example, several are interface oriented: is your code currently interface oriented
p17791
aVIf not, PostSharp might be a better choice (being weaved into the original classes)
p17792
aVBut of course, PostSharp can't be configured at runtime
p17793
aVhorses for courses
p17794
as(dp17795
g18
V23354
p17796
stp17797
a((dp17798
g2
(lp17799
VAFAIK, there is nothing built in for searching all columns
p17800
aVYou can use  only against the primary key
p17801
aVneeds specified columns
p17802
aVYou can perhaps use LINQ, but ultimately this just does the same looping
p17803
aVPerhaps just unroll it yourself
p17804
aVIt'll be readable, at least
p17805
as(dp17806
g18
V23354
p17807
stp17808
a((dp17809
g2
(lp17810
VIn regular ASP
p17811
aVNET, even if you separate the code-behind and the ascx - they are still tightly coupled
p17812
aVIt isn't a true "controller" (as separate from a view)
p17813
aVIf you want this purity, consider ASP
p17814
aVNET MVC, which (obviously) addresses this in a different way
p17815
as(dp17816
g18
V23354
p17817
stp17818
a((dp17819
g2
(lp17820
VEssentially, you don't
p17821
aVJust create a new one
p17822
aV"reader"s are commonly one-way only
p17823
aVIn some ways, having a settable "Reader" property that consumes the reader is confusing
p17824
aVPerhaps have a  or  method instead
p17825
aVIt would be obvious that it has side effects then
p17826
as(dp17827
g18
V23354
p17828
stp17829
a((dp17830
g2
(lp17831
VThat isn't a lot to go on
p17832
aVare you using the default development web server
p17833
aVOr IIS
p17834
aVHave you tried a new web project (to see if it is a configuration problem)
p17835
aVEdit;
p17836
aVthis could have been IPv6
p17837
aVSee "Strange Problem - Unable to Connect to the ASP
p17838
aVNet WebServer on Localhost"
p17839
aVOf course, based on the timing, you could be Steve, in which case hi ;-p
p17840
as(dp17841
g18
V23354
p17842
stp17843
a((dp17844
g2
(lp17845
VThat is the standard behaviour for multi-selection using [Ctrl]
p17846
aVWhy would you break the user's expected interface
p17847
aVYou could possibly hack around it by detecting selection changes (I'll look
p17848
aV(edit) - yes, seems to work if you hook , something like:
p17849
as(dp17850
g18
V23354
p17851
stp17852
a((dp17853
g2
(lp17854
VIf the code is identical, do you need to care
p17855
aVI wonder if casting to  wouldn't give you everything you need
p17856
aVOne complex handler is not necessarily better than several simple handlers
p17857
aVEither way, if you have to go this route, "as"/"is" is preferable (it isn't dependent on strings etc):
p17858
as(dp17859
g18
V23354
p17860
stp17861
a((dp17862
g2
(lp17863
VI wonder if the trace viewer might shed some light here
p17864
aVNo idea what the problem is, I'm afraid
p17865
as(dp17866
g18
V23354
p17867
stp17868
a((dp17869
g2
(lp17870
VIn LINQ-to-SQL, the data-context has :
p17871
as(dp17872
g18
V23354
p17873
stp17874
a((dp17875
g2
(lp17876
s(dp17877
g18
V23354
p17878
stp17879
a((dp17880
g2
(lp17881
VIMO, the best way to configure the identity of a web-service is via the host - IIS, for example
p17882
aVIn IIS, you can configure this via the app-pool identity (like in this answer)
p17883
aVNo need for plain-text passwords, and no need for hacky code
p17884
as(dp17885
g18
V23354
p17886
stp17887
a((dp17888
g2
(lp17889
VThis is covariance, and will be fixed in C# 4
p17890
aV0 /
p17891
aVNET 4
p17892
ag190
aVFor now, the generic option is  the best answer (for  - not  etc)
p17893
aVBut within the generic method, you have to think in terms of
p17894
aVYou could also use  or  with LINQ to achieve something similar
p17895
as(dp17896
g18
V23354
p17897
stp17898
a((dp17899
g2
(lp17900
VYou would need to add a link to the necessary files from the UI project (MainGUI) and set them to copy to the output folder from there
p17901
aVThe inbuilt packaging tools do (IIRC) cascade these correctly, but for external tools I expect you'll need to do it manually
p17902
aVOn my build server, I use a script that investigates references, and adds in all the descendent references just before it is built (by editing the csproj files as xml)
p17903
aVthe code is not great, but it does the job
p17904
as(dp17905
g18
V23354
p17906
stp17907
a((dp17908
g2
(lp17909
VI'm not familiar with nor associated with signum, but as a LINQ provider, it is extremely likely that this uses the  API for the LINQ side of things (i
p17910
ag50
aVnot just delegates)
p17911
aVAs such, I doubt very much that it will work with anything before
p17912
aVNET 3
p17913
ag691
aVupdate: there is also now a signum support channel here
p17914
as(dp17915
g18
V23354
p17916
stp17917
a((dp17918
g2
(lp17919
VRe the overall question; sorry, I don't know short of using a network tracer
p17920
aVHowever; can I humbly propose that datasets and SOAP are not always the best choice on bandwidth restricted devices
p17921
aVCompression does a good job, but not always ideal
p17922
aVUnless you need the features offered, simpler protocols are available (such as POX, perhaps using inbuilt protocol compression (GZIP/Deflate))
p17923
aVAt the other end of things
p17924
aVif you can phrase things as messages, then serializers like protobuf-net might be useful (combined with raw binary posts); they are very data dense (such that attempts to use compression inevitably increases the size)
p17925
aVHowever, you'd need to do your own data/change tracking at the client, and the RPC stack is as-yet incomplete (I've got working prototype code, but I haven't committed it yet, as I'm still unit testing it)
p17926
aVThe server would also be different (i
p17927
ag50
aVnot an asmx or whatever - perhaps a rigged handler or MVC controller)
p17928
aVAs another alternative - ADO
p17929
aVNET Data Services might be of interest, especially in JSON mode (for bandwidth, again using protocol compression)
p17930
as(dp17931
g18
V23354
p17932
stp17933
a((dp17934
g2
(lp17935
VThere are two ways of looking at this;
p17936
aVhandle the CellParsing event and parse the value
p17937
aVuse a custom  on the property
p17938
aVI usually prefer  the latter, since it takes this logic away from the UI; I'll see if I can do an example
p17939
aVExample (most of this code is the "show it working" code); here I define a , which formats/parses dates as their backwards "dd MMM yyyy" text (for no really good reason), and associate that converter with one of the properties
p17940
aVYou can edit the values in the grid, and changes are pushed back in (change rows to see the "actual" value update)
p17941
aVIt doesn't show immediately because of some nuances around change-notification; it wasn't worth making the example more complex just for this
p17942
as(dp17943
g18
V23354
p17944
stp17945
a((dp17946
g2
(lp17947
VBy default, the two important methods are  and
p17948
aVIt is important that if two things are equal ( returns true), that they have the same hash-code
p17949
aVFor example, you might "return FooID;" as the  if you want that as the match
p17950
aVYou can also implement , but that is optional:
p17951
aVFinally, another alternative is to provide an  to do the same
p17952
as(dp17953
g18
V23354
p17954
stp17955
a((dp17956
g2
(lp17957
VThat sounds a lot like a job for an app running in the user's session
p17958
aVA well-behaved service shouldn't be snooping on the user like that
p17959
aVThere may be ways to do it (I honestly don't know), but it doesn't sound very
p17960
aVproper
p17961
aVNote that with recent versions of windows the console session (session 0) is limited to admin purposes, and the user won't (normally) be there
p17962
aVYou may have zero, one, or many non-console sessions
p17963
as(dp17964
g18
V23354
p17965
stp17966
a((dp17967
g2
(lp17968
VAside: do you have SQL Server 2008
p17969
aVThis might be suited to the  data type
p17970
as(dp17971
g18
V23354
p17972
stp17973
a((dp17974
g2
(lp17975
VThat sounds more like you should be using  or similar (or a certificate reseller), and exporting that as public/private key file(s)
p17976
aVStrong name keys (snk) are a bit different
p17977
as(dp17978
g18
V23354
p17979
stp17980
a((dp17981
g2
(lp17982
VYou should just be able to return the image from the action
p17983
aVSee here for more
p17984
aVAnd yes, you can use ashx alongside MVC (by telling it to ignore the route) - but I'm not sure that is the best approach unless it is to re-use existing code
p17985
aVSorry guys, the link has been removed
p17986
aVIt happens
p17987
as(dp17988
g18
V23354
p17989
stp17990
a((dp17991
g2
(lp17992
VActually, there are more delegates there than you expect
p17993
aVThe LINQ query:
p17994
aVis actually:
p17995
aVwhich (for LINQ-to-Objects) is the same as:
p17996
aVThis uses a delegate to identify the item to sort by - i
p17997
ag50
aV"given a ColorData, I'll give you the colorCode"
p17998
aVNote that many  uses also involve a delegate, but not in this case (the trivial  is removed by the compiler)
p17999
aVIn the code:
p18000
aVwe are using a predicate; "given a ColorData, I'll tell you whether it is a match, by testing the name for equality"
p18001
aVNote that  here is "captured" into the delegate, which involves some fairly complex compiler tricks (I won't describe them)
p18002
aVRe efficiencies; it is hard to be sure, but perhaps:
p18003
aVThis avoids lots of duplication, and uses a dictionary to find values rather than constantly using Contains/Find
p18004
aVIn many cases, a LINQ  might have helped, but not in this case, perhaps
p18005
as(dp18006
g18
V23354
p18007
stp18008
a((dp18009
g2
(lp18010
VWell, the redirect should be fairly standard - just a regular ASP
p18011
aVNET redirect
p18012
aVRe doing a POST; that is fine - but it would be even easier to just use :
p18013
aV(other methods and overloads for different use-cases)
p18014
as(dp18015
g18
V23354
p18016
stp18017
a((dp18018
g2
(lp18019
VSince  is abstract, there is no way you can ever instantiate an
p18020
aVSo just clear the  - it can never be used
p18021
aVOr make the class non-abstract and leave it at 1
p18022
as(dp18023
g18
V23354
p18024
stp18025
a((dp18026
g2
(lp18027
VOften, when consuming a web resource (SOAP, WCF or ADO
p18028
aVNET Data Services), a separate client proxy class is generated
p18029
aVThis will have similar layout, but has no automatic conversion to your local type
p18030
aVSome systems support type re-use (WCF etc), but not all
p18031
aVYou could add a conversion or an interface to the partial class; but in general, you should treat this as a separate type
p18032
as(dp18033
g18
V23354
p18034
stp18035
a((dp18036
g2
(lp18037
V(removed approach bound to attributes)
p18038
aVedit: and here's the meta-model way (so it works with mapping files as well as attributed objects):
p18039
as(dp18040
g18
V23354
p18041
stp18042
a((dp18043
g2
(lp18044
VWell, how are you launching the process
p18045
aVFor example, if you are launching it from C#, the static  method returns a  instance, which has an , and a  method
p18046
aVThe mechanism will differ between architectures/languages
p18047
aVAnd if you aren't doing it through code, it may be off-topic ;-p
p18048
as(dp18049
g18
V23354
p18050
stp18051
a((dp18052
g2
(lp18053
VThe way you've already posted is probably the cleanest
p18054
aVIf you don't like the extra property, you could implement , but then you have to do everything, which largely defeats the point
p18055
aVI'd happily use the approach you've posted; it is (for example) efficient (no complex parsing etc), culture independent, unambiguous, and timestamp-type numbers are easily and commonly understood
p18056
aVAs an aside, I often add:
p18057
aVThis just hides it in the UI and in referencing dlls, to avoid confusion
p18058
as(dp18059
g18
V23354
p18060
stp18061
a((dp18062
g2
(lp18063
VCan you use mono-service to wrap it
p18064
aVSee this question
p18065
as(dp18066
g18
V23354
p18067
stp18068
a((dp18069
g2
(lp18070
VIf you have used  to generate the classes, then  should do the job
p18071
as(dp18072
g18
V23354
p18073
stp18074
a((dp18075
g2
(lp18076
V(edit - added value type bits)
p18077
aVYou need to check all the interfaces it implements (note it could in theory implement  for multiple ):
p18078
as(dp18079
g18
V23354
p18080
stp18081
a((dp18082
g2
(lp18083
VThe data (in pairs) sounds like it might fit better with a , but the theory is the same; just call  and it should work:
p18084
aVor with a :
p18085
aVAlso - I wonder if a  would fit your needs better
p18086
aVThis will handle all the "get value", "show value", "parse value", "store value" logic, and can be plugged with things like  to allow dynamic properties
p18087
as(dp18088
g18
V23354
p18089
stp18090
a((dp18091
g2
(lp18092
VCan you add the  bit to , and make  non-generic
p18093
aVNote: it is already a bad idea to re-use the generic token  (which is different in ):
p18094
as(dp18095
g18
V23354
p18096
stp18097
a((dp18098
g2
(lp18099
VUpgrading; even if mechanical tools exist, this will not really do much for you
p18100
aVIt won't make it magically well-suited to
p18101
aVNET, or make much decent use of the framework
p18102
aVI'd always prefer a re-write in this scenario, but that does have associated risks / costs
p18103
aVFor example, some colleagues of mine are currently re-writing some VB6/ASP/COM+/xslt code to use ASP
p18104
aVNET MVC - most of the "interesting" code is actually business logic, which isn't massively hard to port (the trick is testing it ;-p)
p18105
aVIt helps that the layout of our VB6 code is granular, allowing us to migrate individual slices, without having to push the whole lot at once
p18106
aVThe 3rd party controls will be a nuisance, and it sounds like the other dlls might have to be reverse engineered
p18107
aVNot trivial
p18108
aVThe choice between C# and VB
p18109
aVNET is largely secondary
p18110
aVBoth have some minor advantages, but overall you can do most things with either
p18111
aVIf you need COM interop, then VB
p18112
aVNET might be useful (either for everything, or for just a specific assembly) - but C# 4
p18113
aV0 (in VS2010) will plug this gap via the new  typing and the no-PIA changes
p18114
aVOverall, I vastly prefer C#, but that has to be a local decision
p18115
as(dp18116
g18
V23354
p18117
stp18118
a((dp18119
g2
(lp18120
VNot ideal, but can you use the route name approach
p18121
as(dp18122
g18
V23354
p18123
stp18124
a((dp18125
g2
(lp18126
VFirst, you need a "using" directive to include the namespace that includes your class with extension methods
p18127
aVSecond - re "MyClass
p18128
aVmyMethod" - extension methods work on instances, not as static - so you'd need:
p18129
aVFinally - if you want to use the extension method inside  (or a subclass), you need an explicit  - i
p18130
ag50
aVThis is one of the few cases where  matters
p18131
as(dp18132
g18
V23354
p18133
stp18134
a((dp18135
g2
(lp18136
VHow about something like:
p18137
aVThis should be compatible with , rather than doing a reference comparison on the array
p18138
as(dp18139
g18
V23354
p18140
stp18141
a((dp18142
g2
(lp18143
VI expect the real answer is simply: there wasn't a good use-case
p18144
aVFor instances, the advantage is that it enables a fluent-API over existing types (that don't themselves provide the logic) - i
p18145
ag50
aVwhich enables LINQ:
p18146
aVWith static methods, this simply isn't an issue, so there is no justification; just use the static method on the second type
p18147
aVAs it is, extension methods are not properly object orientated - they are a pragmatic abuse to make life easier at the expense of purity
p18148
aVThere was no reason to dilute static methods in the same way
p18149
as(dp18150
g18
V23354
p18151
stp18152
a((dp18153
g2
(lp18154
Vsvcutil
p18155
aVexe consumes the "mex" API, and only has access to a subset of the metadata
p18156
aVComments aren't included (nor, IIRC, is  to any great extent)
p18157
aVYou might have to rely on external documentation (i
p18158
ag50
aVa help page / dead tree)
p18159
aVOne other option (although it breaks a number of pure SOA rules) is to ship the entities / interfaces in a dll + xml; svcutil (and the IDE) can re-use matching types from existing assemblies
p18160
as(dp18161
g18
V23354
p18162
stp18163
a((dp18164
g2
(lp18165
VWhy do you want to use an array here
p18166
aVSwitch to , or (if you need efficient removals/insertions from the middle) a
p18167
aVI'm not sure if you are meaning "static" in the way I mean it - can you clarify
p18168
aVFor info, you can use , but that isn't the right answer for frequent changes
p18169
as(dp18170
g18
V23354
p18171
stp18172
a((dp18173
g2
(lp18174
VThey don't if they are child elements of a type - you can use , ,  and  and  in various combinations to get different results - unfortunately, the specifics are dependent on the exact layout
p18175
as(dp18176
g18
V23354
p18177
stp18178
a((dp18179
g2
(lp18180
VAt the moment, I'm not a fan of Entity Framework, but 4
p18181
aV0 looks much improved
p18182
aVI'm not sure is it as big a change as Vista vs Windows 7, but definitely better
p18183
aVFor now, I find LINQ-to-SQL covers most things I regularly need
p18184
aVHeck, even if I just use it to connect stored procedures without having to write the parameter code, that is to my advantage
p18185
aVI find the CRUD stuff is great for simple orthogonal data manipulation
p18186
aVFor more complex scenarios, I like UDFs etc - which LINQ-to-SQL supports fine
p18187
aVAs long as you hide it in a repository, you aren't even painting yourself into a corner
p18188
aVRe datediff - have you looked at
p18189
as(dp18190
g18
V23354
p18191
stp18192
a((dp18193
g2
(lp18194
VPersonally, I think not
p18195
aVThe problem with exposing composable queries from your repository  is that you can no longer fully unit test them - their behaviour (and success) is now at the mercy of the caller
p18196
aVFor example, they might do  (with no translation)
p18197
aVI added more on this here
p18198
aVIf you have fixed methods that return (for example)  or  , then you can be sure that if it works in the unit test, it should work for real (barring any configuration errors)
p18199
aVIt also means that you can profile the DAL in isolation and have reasonable confidence what SQL (etc) is going to be executed
p18200
aVYou can't profile/optimise a DAL that changes based on the caller
p18201
aV(based on my LINQ-to-SQL usage; not LINQ-to-NHibernate specifically)
p18202
as(dp18203
g18
V23354
p18204
stp18205
a((dp18206
g2
(lp18207
VIf you mean a jagged array (),  is your friend
p18208
aVIf, however, you mean a rectangular array (), then you can just enumerate the date data via  - or:
p18209
as(dp18210
g18
V23354
p18211
stp18212
a((dp18213
g2
(lp18214
VWell, there are several things here
p18215
aVuploading a file can be done by dropping a file control on the form and reading from the  collection in the page; like so
p18216
aVThen at the server you need to read from the 's
p18217
aVIf the file is expected to be short, this could be just:
p18218
aV(and push that string into something like an // column via regular methods)
p18219
aVIf the file is expected to be long, then you would have to use streaming mechanisms; the most efficient being to treat it as a BLOB () using chunks; here's a slightly older example for  - with  the / is slightly easier
p18220
aVOf course, with SQL2008 the file-stream type might be useful too
p18221
as(dp18222
g18
V23354
p18223
stp18224
a((dp18225
g2
(lp18226
VOne approach I've seen for this scenario is to use an action-filter to populate the data for the partial view - i
p18227
ag50
aVsubclass
p18228
aVIn the , add the data into the ViewData
p18229
aVThen you just have to decorate the different actions that use that partial view with the filter
p18230
as(dp18231
g18
V23354
p18232
stp18233
a((dp18234
g2
(lp18235
VThe first thing I'd try is adding a property for serialization, but hiding it from the UI:
p18236
aVYou can't really mix and match serialization unfortunately; once you implement , you own everything
p18237
aVIf you were using WCF, then  supports non-public properties for serialization, so you could use:
p18238
aVbut this doesn't apply for "asmx" web-services via
p18239
aVDoes the  trick work at all
p18240
aVAssuming the custom grid uses , another option might be to hide it via , but that is a lot of work just to hide a property
p18241
as(dp18242
g18
V23354
p18243
stp18244
a((dp18245
g2
(lp18246
VI can reproduce it
p18247
aVit isn't something I would have expected, but it looks like you'll simply have to set the  back afterwards
p18248
aVLooking in reflector, this is quite intentional:
p18249
aVNot sure of the reasoning behind that, but simply:
p18250
aVNot pretty, but it'll work
p18251
as(dp18252
g18
V23354
p18253
stp18254
a((dp18255
g2
(lp18256
V(some minor edits)
p18257
aVIt sounds like the security problems you are hitting are windows security issues, not
p18258
aVNET policies
p18259
aVAs long as it is for prototype only, you could run it as an admin
p18260
aVChange the app-pool's identity to an administrative account (or yourself)
p18261
aVAnd pray ;-p
p18262
aVFor real work, you would create a non-administrative domain account with just the necessary permissions
p18263
aVI imagine it works in the development web-server because it is running as you
p18264
as(dp18265
g18
V23354
p18266
stp18267
a((dp18268
g2
(lp18269
VWhat you are trying to do and display is inherently complex
p18270
aVI've done this in the past (for diffgram/delta-based processes), and even trying to display nested changes in a simple and friendly way is tricky
p18271
aVIf it fits your user-base, one option might be to simply serialize the two graphs as xml, and use something like xml diff
p18272
as(dp18273
g18
V23354
p18274
stp18275
a((dp18276
g2
(lp18277
VFor mass data, the fastest way is to use something like  to push the data (via a crafted ) into a staging table (same layout, but no indexes/etc) - and then use SqlCommand to execute a stored procedure to push the data from the staging table into the real table
p18278
aVBut note that LINQ-to-SQL isn't involved here (unless you use it to invoke the stored procedure)
p18279
aVYou could try just using regular LINQ-to-SQL  - assess how big a problem the volume of data is before you try to optimise it; it might be "fast enough" even though sub-optimal
p18280
aVYou can create an  fairly easily; I often use the csv on from here
p18281
aVTo create one from a list, you could borrow  from here and override
p18282
as(dp18283
g18
V23354
p18284
stp18285
a((dp18286
g2
(lp18287
VYou can't "add a reference" at runtime - but you can load assemblies -  /  etc
p18288
aVThe problem is that you can't unload them unless you use s
p18289
aVOnce you have an , you can use  to create instances via reflection (which you can then cast to known interfaces etc)
p18290
aVFor a trivial example:
p18291
aVAt which point I can either cast  to a known base-type/interface, or continue to use reflection to manipulate it
p18292
as(dp18293
g18
V23354
p18294
stp18295
a((dp18296
g2
(lp18297
VDo you mean:
p18298
as(dp18299
g18
V23354
p18300
stp18301
a((dp18302
g2
(lp18303
VThe  should do it; are you doing this at the form
p18304
aVor at the control
p18305
aVFor example:
p18306
aV(only allows "ascending" characters)
p18307
aVNote that this won't protect you from copy/paste - you might have to look at TextChanged and/or Validate as well
p18308
as(dp18309
g18
V23354
p18310
stp18311
a((dp18312
g2
(lp18313
VPersonally, I'd rather compartmentalize those things
p18314
aVFor example, why do all your controllers need to know about writing event logs
p18315
aVI'd have a single LogWriter class and ILogWriter interface, and use dependency injection (see MVCContrib for samples) - i
p18316
ag50
aV(and using a DI-based controller-factory)
p18317
aVThis allows you to unit test the log-writing by mocking the log-writer
p18318
aVThen the settings would fit reasonably well as constants (or fetched from config) inside the LogWriter class
p18319
aVRe the specific question; if all the values are constant, use constants (or maybe static properties):
p18320
aVA dictionary would be useful if they are fetched from configuration; if they are truly global, a static dictionary should suffice - instances would only be useful if it changes between impressions
p18321
aVA singleton would serve no purpose here; use static members instead
p18322
as(dp18323
g18
V23354
p18324
stp18325
a((dp18326
g2
(lp18327
VThat is a 24-byte (192-bit) number; what value are you expecting
p18328
aVNote that you can use  to do a lot of the grungy work here - for example (in C#):
p18329
aVHow you get from  to a number depends on what you think the number is
p18330
aVVB translation courtesy of reflector (although the "-1" looks odd):
p18331
as(dp18332
g18
V23354
p18333
stp18334
a((dp18335
g2
(lp18336
VProbably a bit overkill, but:
p18337
aVor if you want the first that is numerically bigger:
p18338
aVor for the next bigger numerically (doing the sort ourselves):
p18339
aVHey, with LINQ as your hammer, the world is full of nails ;-p
p18340
as(dp18341
g18
V23354
p18342
stp18343
a((dp18344
g2
(lp18345
VIs there a difference between  and
p18346
aVIt isn't clear
p18347
aVHowever
p18348
aVIf they are different objects, then first: you can't  on a lock that you don't have
p18349
aVand  will only return false if you specify a timeout
p18350
aVWhat exactly is that code trying to do
p18351
aVWithout more context, it isn't entirely clear what the  and  are designed to do; for example, here they are used to block the queue when it is too full (), or release it when space becomes available (), etc
p18352
aVIt is hard to debug threading code without the full interactions between threads
p18353
aVIt sounds like you might just need:
p18354
aVThere are two immediate problems I can see; first, it isn't obvious that you always release the locks you take (i
p18355
ag50
aVexceptions)
p18356
aVTry to just use  for the  - it'll get it right
p18357
aVSecond; if all the threads call
p18358
aVwho is going to wake them up
p18359
aVWhat are they waiting for
p18360
aVAs presented: yes, they will all sleep indefinitely
p18361
as(dp18362
g18
V23354
p18363
stp18364
a((dp18365
g2
(lp18366
VHow about:
p18367
as(dp18368
g18
V23354
p18369
stp18370
a((dp18371
g2
(lp18372
VAs far as I know, there is nothing specific "web" about user instances; it should work the same from console, web, winform or wpf
p18373
aVThe only difference is that the Express IDE may not have options to set it up for you
p18374
aVbut that doesn't matter
p18375
aVCreate the database, and just hook it up with the connection strings manually
p18376
aVI just tried it (by adding an mdb + ldf to a console app in Express) and it worked fine; it even added the connection strings (in user-instance mode) for me
p18377
aVThat might be because I have additional VS tools installed, but it worked
p18378
aVAt runtime, it doesn't know whether it came from Express, Pro, or Team Suite
p18379
as(dp18380
g18
V23354
p18381
stp18382
a((dp18383
g2
(lp18384
VThe easiest way (in C#) to simulate a form post with values:
p18385
aVJust for completeness, jQuery can do it more efficiently again
p18386
aVIf you want to inspect the html to create your POST, either use  and automation, or use the Html Agility Pack to look at it
p18387
as(dp18388
g18
V23354
p18389
stp18390
a((dp18391
g2
(lp18392
VBasically, no
p18393
aVIf you were writing the classes manually, you could have:
p18394
aVhowever, you can't do this with the xsd-generated classes
p18395
aVUnfortunately, one of the things you can't do with a  is rename it
p18396
aVOf course, you could use  to generate it, change the
p18397
aVcs file and don't generate it again, but that is not ideal for maintenance
p18398
as(dp18399
g18
V23354
p18400
stp18401
a((dp18402
g2
(lp18403
VThat looks about right to me
p18404
aVvery common to what I have used in the past (although I've often used , but either should work)
p18405
aVThe main change I might make is to make the match more explicit (at least in the master xslt) - i
p18406
ag50
aVso it won't accidentally match  elements at other locations (for example, data-paging, like )
p18407
aVOne other common thing I do is to add a "*" match that uses  to throw an error if I don't have a more-specific match for a node
p18408
aVThis makes it more obvious when you have a typo, etc
p18409
as(dp18410
g18
V23354
p18411
stp18412
a((dp18413
g2
(lp18414
VIf a class is a member of a struct, then only the reference is stored in the struct (i
p18415
ag50
aVthe 32/64-bit address to the instance)
p18416
aVThe instance of a class is always on the heap
p18417
as(dp18418
g18
V23354
p18419
stp18420
a((dp18421
g2
(lp18422
VHere's the point; you shouldn't do sync IO in Silverlight
p18423
aVStop fighting it
p18424
aVInstead:
p18425
aVdisable any critical parts of the UI
p18426
aVstart async IO with callback
p18427
ag9246
aVin the callback, process the data and update/re-enable the UI
p18428
aVAs it happens, I'm actively working on ways to make the async pattern more approachable (in particular with Silverlight in mind)
p18429
aVHere's a first stab, but I have something better up my sleeve ;-p
p18430
as(dp18431
g18
V23354
p18432
stp18433
a((dp18434
g2
(lp18435
VThe most pragmatic and versatile way to do string conversions is with :
p18436
aVMore types have type-converters than implement  etc, and you can also add converters to new types - both at compile-time;
p18437
aVand also at runtime if you need (for types you don't own):
p18438
as(dp18439
g18
V23354
p18440
stp18441
a((dp18442
g2
(lp18443
VYou can do this at the database, by using a fake UDF; in a partial class, add a method to the data context:
p18444
aVThen just ; this will do a random ordering at the SQL-Server courtesy of
p18445
ag412
ag50
aVNote that this is only suitable for small-to-mid-size tables; for huge tables, it will have a performance impact at the server, and it will be more efficient to find the number of rows (), then pick one at random ()
p18446
aVfor count approach:
p18447
as(dp18448
g18
V23354
p18449
stp18450
a((dp18451
g2
(lp18452
VExtern method calls are to unmanaged code
p18453
aVAs such, it doesn't make sense to be called on a (managed) object instance - the first (hidden) argument in an instance method is the instance reference, aka
p18454
aVTypically,  methods just involve simple types (primitives, string, etc) - not objects (except perhaps arrays - and even they are often resolved to  first)
p18455
as(dp18456
g18
V23354
p18457
stp18458
a((dp18459
g2
(lp18460
VDon't optimise prematurely; in a release build it is quite likely that the compiler will optimise these away anyway
p18461
aVEither way, you are just talking a tiny amount of stack space for (presumably) a few references
p18462
aVEither approach is fine; go with whichever is more readable
p18463
as(dp18464
g18
V23354
p18465
stp18466
a((dp18467
g2
(lp18468
VLike Julian, I'm not entirely sure what you mean, but it sounds a lot like the "Knapsack Problem" over multiple knapsacks, and is NP-complete
p18469
aVThere are many different ways of approaching it - from the simple heuristics like "use the big stuff first", down to ant-colony (genetic) optimisation
p18470
aVAnd almost everything in between
p18471
aVIn fact, there are almost as many approaches as there are candidate sets
p18472
aVI wonder if the question is NP-complete
p18473
aV;-p
p18474
as(dp18475
g18
V23354
p18476
stp18477
a((dp18478
g2
(lp18479
VNo; to support many readers and one writer (comments to Jared's reply), you might want to look at
p18480
aVThe writer requires exclusive access; the readers can co-operate
p18481
aVThis is what  does
p18482
aVThere is also  pre 3
p18483
ag691
aVYou will need to handle enter/exit etc manually - ideally via try/finally
p18484
as(dp18485
g18
V23354
p18486
stp18487
a((dp18488
g2
(lp18489
VWhat exactly is it you want to do with the table
p18490
aVIt isn't clear
p18491
aVHowever, the standard LINQ (-to-Objects) methods will be available on any typed collection (including ), allowing any range of , , , , etc
p18492
aVSo: what is you are trying to do
p18493
aVIf you had the table, what value(s) do you want
p18494
aVAs a guess (based on the  stuff) - do you just want:
p18495
as(dp18496
g18
V23354
p18497
stp18498
a((dp18499
g2
(lp18500
VThe  approach may do extra work, as (in TSQL)  or  are often much quicker; the db can optimise "is there at least one row"
p18501
aVPersonally, I would use the any/predicate overload:
p18502
aVOf course, you can compare what each one does by watching the TSQL:
p18503
as(dp18504
g18
V23354
p18505
stp18506
a((dp18507
g2
(lp18508
VEssentially, yes (the last0
p18509
aVBut how you do it may depend on the number of rows involved
p18510
aVIf you have a few hundred (maybe a thousand or so), then you could use something like LINQ-to-SQL quite happily: create the objects you need, and use  to add the necessary items to the data-context
p18511
aVFinally, call  (job done; other ORM tools will work similarly)
p18512
aVIf you have tens of thousands of rows (or whatever), then you might just take the whole xml into the database (perhaps a stored procedure with an  parameter)
p18513
aVUse Sql/xml at the database, and do 4  statements from the  parameter
p18514
aVFor hundreds of thousands/millions of rows, you'd want to use  to push the data into a staging table (laid out like your example) - then use a stored procedure to do the 4 s
p18515
aVGetting xml to behave like csv is a job for a bespoke data reader
p18516
as(dp18517
g18
V23354
p18518
stp18519
a((dp18520
g2
(lp18521
VWill the values always be unique
p18522
aVIf so, how about (after checking equal length):
p18523
as(dp18524
g18
V23354
p18525
stp18526
a((dp18527
g2
(lp18528
VLooks fine
p18529
aVthe only things I wonder is whether the casing of the type-name is correct
p18530
aVYou could try:
p18531
aVwhich will do a case-insensitive search
p18532
aVAlso; is  a namespace or an outer-class
p18533
ag412
ag50
aVif it is:
p18534
aVthen this is  in terms of fully-qualified names
p18535
aVNamespaces remain as  - i
p18536
ag50
as(dp18537
g18
V23354
p18538
stp18539
a((dp18540
g2
(lp18541
VIt sounds to me like you want a queue
p18542
aVif there is a request in progress, add to the queue (with a ); when a call completes, check the queue
p18543
as(dp18544
g18
V23354
p18545
stp18546
a((dp18547
g2
(lp18548
VCan you add them in web
p18549
aVconfig
p18550
aVDon't know if this works in MVC, though
p18551
aV(update - seems to work fine ;-p)
p18552
as(dp18553
g18
V23354
p18554
stp18555
a((dp18556
g2
(lp18557
VIn general, for DTO purposes you might simply choose not to serialize any "parent" properties
p18558
aVOften, you see DTO with no navigation properties except for strictly associated data (for example, order-header => order-detail, but you wouldn't have order-header => customer - just the customer's key; you'd fetch the customer separately)
p18559
aVWith this approach, there is a unidirectional path to serialize/deserialize any graph, and it should work fine
p18560
as(dp18561
g18
V23354
p18562
stp18563
a((dp18564
g2
(lp18565
VYou can use  to get the original command
p18566
aVNot sure about the bash stuff, sorry; maybe something involving line-endings (CR vs LF vs CRLF vs LFCR)
p18567
as(dp18568
g18
V23354
p18569
stp18570
a((dp18571
g2
(lp18572
VAt the moment, you'd have to use the provider to create an assembly, then load that assembly and use reflection to invoke a method
p18573
aVIn
p18574
aVNET 4
p18575
aV0, there is the "compiler as a service" concept, allowing pretty-much what you have just described; there are videos from PDC, essentially having an "interactive" console (typical of dynamic languages) for C#, via a REPL and the compiler service
p18576
aVI believe this type of service is already available in mono
p18577
as(dp18578
g18
V23354
p18579
stp18580
a((dp18581
g2
(lp18582
VTo use a string, you'd have to use reflection to get the delegate;
p18583
aVOf course, a  would be a lot faster and safer if you know all the options at compile-time
p18584
as(dp18585
g18
V23354
p18586
stp18587
a((dp18588
g2
(lp18589
VUnless you're testing MVC itself, shouldn't you be mainly testing that the controller's action does the right thing with the arguments passed by the framework
p18590
aVYou can probably mock more indirect form access via:
p18591
aVwhere ctx is a , with the form data etc
p18592
aVHere's an example using rhino to provide the context (MoQ also shown)
p18593
as(dp18594
g18
V23354
p18595
stp18596
a((dp18597
g2
(lp18598
VYou should be doing your painting by overriding  - then you will be able to re-paint as necessary
p18599
aVAt the moment, anything you draw is only valid under the screen is invalidated
p18600
as(dp18601
g18
V23354
p18602
stp18603
a((dp18604
g2
(lp18605
VWhere did you get that sample from
p18606
aVthe normal way of doing this would be:
p18607
aVThat gives you static typing, etc - and is just friendlier
p18608
aV(note: check you have  at the top of the file)
p18609
as(dp18610
g18
V23354
p18611
stp18612
a((dp18613
g2
(lp18614
VNot in C# 3
p18615
aV0; this feature is on the sheet for C# 4
p18616
aV0 - see here
p18617
aVFor now, you'll have to use different overloads:
p18618
aVThe proposed syntax would be:
p18619
aVcalled with any of:
p18620
as(dp18621
g18
V23354
p18622
stp18623
a((dp18624
g2
(lp18625
VIf you are worried about performance, run a profiler
p18626
aVThen change code
p18627
aVChances are that you will never in a million years guess 100% correctly where the time is going
p18628
aVYou could be changing the 0
p18629
aV02% timing, and leaving the method that contributes 62% of the burden
p18630
aVYou could also be making it worse
p18631
aVWithout a profiler and evidence, you are blind
p18632
aVYou can't assume that the JIT will inline a property getter
p18633
aVThere are many reasons it may or may not do so; size of the method body, virtual, value vs reference type, architecture, debugger attached, etc
p18634
aVHoisting" still has a place, and can still achieve savings if the code is called repeatedly in a tight loop; for example:
p18635
aV(forget the  vs  debate fr the above - this is an orthogonal discussion)
p18636
aVIn the above, the "hoist" will help performance
p18637
aVBut just to be really confusing - with arrays, it is the opposite, and it is more efficient to not hoist it:
p18638
aVThe JIT recognises this and removes the bounds check (as arrays are fixed size)
p18639
as(dp18640
g18
V23354
p18641
stp18642
a((dp18643
g2
(lp18644
VWouldn't that be  in xml
p18645
ag412
ag50
aV**edit: ** tested; works fine:
p18646
as(dp18647
g18
V23354
p18648
stp18649
a((dp18650
g2
(lp18651
VCan you perhaps write it in a single query
p18652
aVThere are also ways of merging expressions (), but that isn't trivial
p18653
aVNot sure where the error comes from, though
p18654
aVedit: haven't tested it, but this should be logically equivalent to a UNION:
p18655
as(dp18656
g18
V23354
p18657
stp18658
a((dp18659
g2
(lp18660
VI'm pretty sure that it doesn't distinguish
p18661
aVare you sure you are asking for the right attribute
p18662
aVAs long as both projects reference the same , then  should work
p18663
aVOtherwise you'll need to first find the  of the attribute you want (from ), and use that when calling
p18664
as(dp18665
g18
V23354
p18666
stp18667
a((dp18668
g2
(lp18669
VASP
p18670
aVNET MVC uses pretty-much a completely different philosophy to regular ASP
p18671
aVNET; as such, with a few minor exceptions, almost no ASP
p18672
aVNET controls (etc) will work in ASP
p18673
aVNET MVC
p18674
aVApart from anything else, the point in the page life-cycle where they usually do something simply doesn't exist
p18675
aVThere are ways of doing this, for example in jQuery validation plug-in, or by using , etc
p18676
aVNote that if you do validation at the client you must still do it (separately) at the server
p18677
aVThose pesky browsers can't be trusted ;-p
p18678
as(dp18679
g18
V23354
p18680
stp18681
a((dp18682
g2
(lp18683
VEdit: I've just checked, and it didn't generate a setter
p18684
aVare you using 3
p18685
aV5SP1
p18686
aVIf you are doing it by hand, I think you can; you simply use the Storage attribute-property (on ) to point it at the field when updating (the get satisfies the query requirements)
p18687
as(dp18688
g18
V23354
p18689
stp18690
a((dp18691
g2
(lp18692
VI suspect you could do this by having your code change the culture via a central property that itself does something like raise an event; but be very very careful: static events are a very easy way to keep an insane amount of objects stuck in memory (i
p18693
ag50
aVGC treats them as alive)
p18694
aVIf you go for this approach, you might want to look at things like
p18695
as(dp18696
g18
V23354
p18697
stp18698
a((dp18699
g2
(lp18700
VFor 24-hour hours, you want HH, not hh:
p18701
as(dp18702
g18
V23354
p18703
stp18704
a((dp18705
g2
(lp18706
VIt sounds like you want an interface, like:
p18707
aVand you pass that in (either to the  ctor, or to )
p18708
aVThe calling classes could (for example) implement ITestable and call TestMethod(this, someString)
p18709
aVAlternatively, maybe an extension method
p18710
aVbtw, the  arg could perhaps be an enum
p18711
aVThen the callers simply implement ITestable, and anyone can call  for an instance
p18712
as(dp18713
g18
V23354
p18714
stp18715
a((dp18716
g2
(lp18717
VThe HTML Agility Pack has examples of exactly this type of thing, and uses xpath for familiar queries - for example (from home page), to find all links is simply:
p18718
aVEDIT
p18719
aVAs of 6/19/2012, the code above, as well as the only code sample shown on HTML Agility Pack Examples page won't work
p18720
aVJust needs slight tweaking as shown below
p18721
as(dp18722
g18
V23354
p18723
stp18724
a((dp18725
g2
(lp18726
VFor , this exists already, as
p18727
aVAs such, I'd suggest that you keep the name (allowing familiarity, and precedence)
p18728
aVBasically, you can't remove while iterating
p18729
aVThere are two common options:
p18730
aVuse indexer based iteration () and removal
p18731
aVbuffer the items to remove, and remove after the  (as you've already done)
p18732
aVSo perhaps:
p18733
aVOr more generally for any :
p18734
aVThis approach has the advantage of avoiding lots of extra copies of the list
p18735
as(dp18736
g18
V23354
p18737
stp18738
a((dp18739
g2
(lp18740
VWhat is the database
p18741
aVIf SQL Server, have you considered Service Broker
p18742
aVThis provides robust messaging at (as requested) the database level
p18743
aVThe messages are not tied to the database schema, so that shouldn't be a problem
p18744
as(dp18745
g18
V23354
p18746
stp18747
a((dp18748
g2
(lp18749
VWhile I understand the enforced exceptions thing, I'm not sure how genuinely essential it is
p18750
aVfor example, most interesting exceptions are those that you wouldn't normally include (or even expect)
p18751
aVFor example, I'm currently fighting what looks very much like a CLI bug in CF35, intermittently raising  from code that really does exist (emphasis: intermittently)
p18752
aVIf you want to document your exceptions, use the  markup
p18753
aVFor other thoughts on this theme, perhaps see Vexing Exceptions (I wonder if GhostDoc might help any
p18754
as(dp18755
g18
V23354
p18756
stp18757
a((dp18758
g2
(lp18759
VWith , it isn't the number of strings, but the number of characters
p18760
aVIn general; if you can predict the length, go ahead and tell it - but since it uses doubling, there isn't a huge overhead in reallocating occasionally if you need to juts use  etc
p18761
aVIn most cases, the difference will be trivial and a micro-optimisation
p18762
aVThe biggest problem with not telling it the size is that unless the collection has a "trim" method, you might have nearly double the size you really needed (if you are very unlucky)
p18763
as(dp18764
g18
V23354
p18765
stp18766
a((dp18767
g2
(lp18768
VYou should probably post the exact error message (and if possible, illustrative code)
p18769
aVAlso - note that with LINQ-to-SQL, you don't need the sql profiler to see the trace:
p18770
as(dp18771
g18
V23354
p18772
stp18773
a((dp18774
g2
(lp18775
VHow about something like:
p18776
aV(Using HTML Agility Pack: http://www
p18777
aVcodeplex
p18778
aVcom/htmlagilitypack)
p18779
aVNote that you can make it prettier with LINQ-to-Objects if you want:
p18780
as(dp18781
g18
V23354
p18782
stp18783
a((dp18784
g2
(lp18785
VDo you need to use hex binary
p18786
aVThings will be a bit easier (and shorter, length-wise) if you use base-64:
p18787
as(dp18788
g18
V23354
p18789
stp18790
a((dp18791
g2
(lp18792
VNo, the GAC is not automatically pre-JITted; however, GAC is a pre-requisite to pre-JIT
p18793
aVActually, only a small minority of things are pre-JITted
p18794
aVBesides which - if the BCL was pre-JITted, then those optimisations would have already been done by NGEN, so the " losing all the potential optimizations" is a non-issue
p18795
as(dp18796
g18
V23354
p18797
stp18798
a((dp18799
g2
(lp18800
VHow about like so (which batches it into manageable pieces)
p18801
aVThe other (non-LINQ) options involve CSV and a "split" UDF, and table-valued-parameters (in SQL2008)
p18802
as(dp18803
g18
V23354
p18804
stp18805
a((dp18806
g2
(lp18807
VYou shouldn't; I expect you have something like:
p18808
aVEssentially, the  is:
p18809
aVso this is recursive, and will eventually consume up the stack (assuming no optimisations, etc)
p18810
aVIt is impossible to diagnose more without a code sample
p18811
as(dp18812
g18
V23354
p18813
stp18814
a((dp18815
g2
(lp18816
VHave you tried ASP
p18817
aVNET MVC
p18818
aVIt is actually very different to ASP
p18819
aVNET (vanilla), but retains your knowledge of the
p18820
aVNET framework
p18821
aVMost people wouldn't look back
p18822
aVWith the view based on your html (rather than whatever the controls decide to emit), it is also ideally placed to work alongside jQuery (it is even installed in the default project template) for all your dhtml/ajax needs
p18823
aVResources:
p18824
aVASP
p18825
aVNET MVC in Action
p18826
aVjQuery in Action
p18827
as(dp18828
g18
V23354
p18829
stp18830
a((dp18831
g2
(lp18832
Vby "after the thread gets executed", do you mean it must have started
p18833
aVor it must have finished
p18834
aVIf you mean finished, then you would typically  the thread - but there is no point ing a thread you have stared in the line before (just execute the code directly)
p18835
aVThe other approach is to use a "callback" at the end of the threaded method
p18836
aVIf you mean started, then you can do things like:
p18837
as(dp18838
g18
V23354
p18839
stp18840
a((dp18841
g2
(lp18842
VI wonder if you mean:
p18843
aV(gets the swf of the 6th movie)
p18844
aVor alternatively:
p18845
aV(finds all the movie/swf elements, and selects the 6th)
p18846
aVWhen each movie has exactly one swf, the two are the same; if a movie has zero or multiple swf elements, they the two queries are subtly different
p18847
as(dp18848
g18
V23354
p18849
stp18850
a((dp18851
g2
(lp18852
VThe most appropriate way to do this is for the exe to pass the data-context to the dll, for example as a method argument to whatever the dll is doing, or as a constructor argument to whatever class (in the dll) needs it
p18853
aVIf you have different types of data-contexts, then the type would have to be  or a subclass
p18854
aVExtension methods (on DataContext) are one way of doing this (but not the only way)
p18855
aVAlternatively - in a standard "repository" implementation (where the dll is the repository), it is entirely possible that the caller (the exe) doesn't even know about the data-context - just the  interface (or whatever) that the dll exposes
p18856
aVRe the edit; by this alone, it would have no way of knowing the type of data-context to create
p18857
aVYou possibly need to either pass a data-context in, or tell it (via generics) the type of data-context; excuse my C#, but:
p18858
aVHowever, I strongly suspect that the dependency-injection route is simpler - i
p18859
ag50
aVlet the caller tell us:
p18860
as(dp18861
g18
V23354
p18862
stp18863
a((dp18864
g2
(lp18865
VYou can mark the xml files as resources, and they will be packaged inside the assembly
p18866
aVJust set the "build action" to "embedded resource"
p18867
aVAlternatively, use a resource file (resx), and drag the xml files onto the resx designer, and it'll do everything for you (including providing access methods to get the data back out)
p18868
as(dp18869
g18
V23354
p18870
stp18871
a((dp18872
g2
(lp18873
VAre you doing an equality match, or a containment match
p18874
aVFor an equality match, you should let the db handle this (but add a non-clustered index) and just test via
p18875
aVFor a containment match, you should perhaps look at full text index
p18876
as(dp18877
g18
V23354
p18878
stp18879
a((dp18880
g2
(lp18881
VIf you've killed it through task-manager, it should be dead
p18882
aVIf it refuses to close via task-manager (and you are an admin), you'll struggle to do any better through code
p18883
aVHowever, you can get the  object (perhaps by ) and  it
p18884
aVI wouldn't expect it to do any better than task-man, though
p18885
as(dp18886
g18
V23354
p18887
stp18888
a((dp18889
g2
(lp18890
VYou use , i
p18891
ag50
aVfrom a ; below, I've hard-coded, but you would use some logic, or , to get the actual creation method:
p18892
aVFor non-static methods, there is an overload of  that accepts the target instance
p18893
as(dp18894
g18
V23354
p18895
stp18896
a((dp18897
g2
(lp18898
VYou handle inheritance by adding a  to  - however, the  is still part of the contract, and its existance will be public
p18899
aVBut only members marked  will be published
p18900
aVOne option (to remove the inheritance) is to have a separate DTO for serialization purposes, and have a conversion between the DTO version and the actual version - but that makes extra work
p18901
as(dp18902
g18
V23354
p18903
stp18904
a((dp18905
g2
(lp18906
VWhat you have described would require  (custom serialization) with regular  - however, protobuf-net would allow you to simplify things (so you don't need to handle the details yourself), while usually making the data smaller in the process:
p18907
aVFor simpler setups:
p18908
aVWhat serializer are you using
p18909
aVwith , you mark fields you don't want as
p18910
aVwith , you mark members you don't want as
p18911
aVwith , you simply don't mark them with
p18912
aVAlso - perhaps consider protobuf-net; this has a very efficient binary mechanism; more so than
p18913
as(dp18914
g18
V23354
p18915
stp18916
a((dp18917
g2
(lp18918
VIt depends on whether the "purity" of the service is important
p18919
aVIf the only client is going to be your exe, then I wouldn't get stressed; you can then get an "intelligent" (if you see what I mean) object at the client (for example, implementing  for validation), without any code duplication
p18920
aVBut if you need to support ad-hoc clients, you should stick to basic DTOs (proxy objects)
p18921
aVNote that if you want to go this route (assembly sharing), then you can do this in WCF without any changes;  and the IDE offer options to re-use types from existing assemblies, although actually you don't even need this (you can access a channel directly)
p18922
aVAll you need is the right config data in the app
p18923
aVconfig, so it knows where to find the service
p18924
as(dp18925
g18
V23354
p18926
stp18927
a((dp18928
g2
(lp18929
VWhy do you want to use regex for this
p18930
aVWhat is wrong with:
p18931
aV(you can wrap those up to do a bit of bounds-checking on the length easily enough)
p18932
aVIf you really want, you could wrap it up in a  to put somewhere - not sure I'd bother, though:
p18933
as(dp18934
g18
V23354
p18935
stp18936
a((dp18937
g2
(lp18938
VIn most cases,  is the  (or whatever) that raised the event
p18939
aVThere are some occasions when this isn't the case - such as a (perhaps lazy) pass-thru event:
p18940
aVHere, if we subscribe to foo
p18941
aVSomeEvent, we will actually get back the event originated by the  instance - so  won't be
p18942
aVBut this is arguably because we've implemented  incorrectly
p18943
aVTo be honest, in most cases you don't need to check ; the main time this is useful is when a number of controls share a handler
p18944
aVYou should generally be able to assume the sender is the instance you subscribed to (for the purposes of reference-equality tests)
p18945
aVRe  - the standard pattern (when creating a new event-type) would recommend you to inherit from this
p18946
aVI don't recommend deviating from this
p18947
aVA minor reason is that it allows you to use , but there are other variance reasons too
p18948
aVBesides - sometimes doing what other people expect is reason enough; people expect an  derived value
p18949
aVThat said - I have done non-standard events before (in MiscUtil's Push LINQ) - but this was already in a very unusual setup, so it didn't feel out of place
p18950
as(dp18951
g18
V23354
p18952
stp18953
a((dp18954
g2
(lp18955
VFor this behaviour, set it as online only
p18956
aVProject properties -> Publish -> "The application is available online only" (radio button)
p18957
aVIt will still do the same local caching of files etc; it is mainly the start-menu that changes (I don't have a full list of the differences)
p18958
as(dp18959
g18
V23354
p18960
stp18961
a((dp18962
g2
(lp18963
VI'm fairly sure that is a limitation of xsd
p18964
aVexe; you can get custom results in the other direction (class => xml/xsd), but that doesn't help you much
p18965
aVSorry
p18966
as(dp18967
g18
V23354
p18968
stp18969
a((dp18970
g2
(lp18971
VThe routes will match, by default, left-to-right, so "domain/home/index" will match first to lang=domain, controller=index, action (default to index), id (default to 0/null)
p18972
aVTo fix this, I believe you can specify a regex on the MapRoute (matching, for example, languages with exactly 2 characters) - it has changed at some point, though
p18973
aV(sorry, no IDE at the moment, so I can't check exactly)
p18974
aVFrom memory, it might be:
p18975
aVNote that you probably aren't going to want every action to take a "string lang", so you should handle the "lang" part of the route either in a base-controller, or an action-filter (in either case, presumably add the info to the ViewData)
p18976
as(dp18977
g18
V23354
p18978
stp18979
a((dp18980
g2
(lp18981
VThe simplest way is an anonymous method:
p18982
as(dp18983
g18
V23354
p18984
stp18985
a((dp18986
g2
(lp18987
VOne option is to use an example item to create the collection via generic type inference, for example:
p18988
aVYou can also do this without creating an instance (but using an anonymous method that never gets caller), but I don't think it saves anything really
p18989
aVwe might not create an instance of the object, but we do create an instance of a delegate, so not much of a saving
p18990
aVYou also mention sorting the data; see the reply here for a way to use  with a lambda, and hence with anonymous types - i
p18991
ag50
as(dp18992
g18
V23354
p18993
stp18994
a((dp18995
g2
(lp18996
V(removed original answer following question update)
p18997
aVFor instance, if there was a method
p18998
aVthat would read a string and return it
p18999
aVusing a different encoding, something
p19000
aVlike "render(string, encoding)"
p19001
aVI don't think you can re-use the string data
p19002
aVThe fact is: if the encoding was wrong, this string can be considered corrupt
p19003
aVIt may very easily contain gibberish among the likely looking characters
p19004
aVIn particular, many encodings may forgive the presence/absence of a BOM/preamble, but would you re-encode with it
p19005
aVwithout it
p19006
aVIf you are happy to risk it (I wouldn't be), you could just re-encode your local string with the last encoding:
p19007
aVIn reality, I believe the best you can do is to keep the original  - keep offering different renderings (via different encodings) until they like one
p19008
aVSomething like:
p19009
as(dp19010
g18
V23354
p19011
stp19012
a((dp19013
g2
(lp19014
VXml readers generally expect dates/times in a very specific format; you can use this yourself using :
p19015
aVIf you are using something else, you'll have to read it as a string and use  (or similar) to specify the actual format string:
p19016
aVIf you are using , you could use a shim property to do the conversion - let me know if this is what you are doing
p19017
as(dp19018
g18
V23354
p19019
stp19020
a((dp19021
g2
(lp19022
V2: watch out for  (see here for example why); and don't do a "tight" loop
p19023
aVSignals (such as a Monitor
p19024
aVPulse, or a ManualResetEvent, etc) are often preferred
p19025
aV4: if this is for display purposes, you'll need to marshal these back to the UI thread
p19026
as(dp19027
g18
V23354
p19028
stp19029
a((dp19030
g2
(lp19031
VYou can hook CsvReader to SqlBulkCopy, which does the job very nicely
p19032
aVsomething like (untested):
p19033
aVedit you would typically do the bulk-insert into a staging table, and then use a regular stored procedure to move the data into the real table
p19034
as(dp19035
g18
V23354
p19036
stp19037
a((dp19038
g2
(lp19039
VI don't think you can escape the fact that  and  are different; the usual approach is a base-interface:
p19040
aVThat way, you code against , but the actual instances (that typically implement  for some ) are stll strongly-typed internally
p19041
as(dp19042
g18
V23354
p19043
stp19044
a((dp19045
g2
(lp19046
VWhat you want is:
p19047
aV(or edit the parameter value to include the % in the first place)
p19048
aVOtherwise, you are either (first sample) searching for the literal "@SEARCH" (not the arg-value), or you are embedding some extra quotes into the query (second sample)
p19049
aVIn some ways, it might be easier to have the TSQL just use , and handle it at the caller:
p19050
aVEither approach should work
p19051
as(dp19052
g18
V23354
p19053
stp19054
a((dp19055
g2
(lp19056
VI haven't looked too much at the encoding - but note that if this is to be stored somewhere (or acted upon in some way), then a POST would be more appropriate
p19057
aVIf the text on the right is actually representative of the data with id 351702 (a vanity url, much like ), then you should humanize the text
p19058
aVMuch as the spaces have been removed from the above
p19059
aVIt is also common to have this as a separate level in the route that is simply discarded
p19060
aVGenerally, MVC urls should be comprehensible
p19061
as(dp19062
g18
V23354
p19063
stp19064
a((dp19065
g2
(lp19066
VAt a guess (untested):
p19067
as(dp19068
g18
V23354
p19069
stp19070
a((dp19071
g2
(lp19072
VYou can't really edit the config file of the running process
p19073
aVOne option (with pros and cons) is to use config data in the machine
p19074
aVconfig or the master web
p19075
aVconfig (for "site", you use the "location" nodes) - not an option to rush into, though
p19076
aVA better way to handle this is to swap the config file as part of your build/deploy process, ideally automated
p19077
aVThat way, everything is self-contained, and you can "robocopy" to a vanilla server and have it work
p19078
aVRe your "per developer" point; I found that the easiest way to do this was to standardise the config, and tweak the machines
p19079
aVFor example, we run a local web-server on a VM; rather than code against each machine, we standardise on "localserver" (to mirror "localhost"), and add a local DNS record to each machine that the developer can control
p19080
aVNote that this requires fixed IP addresses (or maybe a DHCP reservation) to prevent it changing over time
p19081
aVDitto databases; local servers can use "
p19082
aV; remote servers can be aliased on the machine, so "devserver" points to whatever the user wants
p19083
aVJust a thought
p19084
as(dp19085
g18
V23354
p19086
stp19087
a((dp19088
g2
(lp19089
VWell, you could generate the  by hand
p19090
aVHowever, one of the advantages of a  is that it isn't guessable - i
p19091
ag50
aVgiven record , there is usually little point  (from an attacker) checking for record  etc
p19092
aVAlso - re fragmentation
p19093
aVAs long as you have a non-clustered index on this data, I'm not sure that this is an issue
p19094
aVYou wouldn't normally put a clustered index on a , so the table will be a heap (unless you have a separate clustered index, such as an  int)
p19095
aVIn which case you will be adding to the end, and inserting the new  into the non-clustered index
p19096
aVNo real pain
p19097
aV(edit)
p19098
aVOne problem of using the time directly is that you introduce a lot more risk of collisions; you would need to worry about tight-loop  creation (i
p19099
ag50
aVavoiding repetition when creating a few in sequence), which means synchronization, etc - and it gets even more troublesome if multiple machines are working intensively in parallel - chances are you'll get duplicates
p19100
as(dp19101
g18
V23354
p19102
stp19103
a((dp19104
g2
(lp19105
VThe advice (in 3
p19106
aV5 and above) is to use the  and  - for the "why
p19107
aV- one advantage is that "" is only meaningful if you know what "predicate" means - otherwise you need to look at object-browser (etc) to find the signatute
p19108
aVConversely  follows a standard pattern; I can immediately tell that this is a function that takes a  and returns a  -  don't need to understand any terminology - just apply my truth test
p19109
aVFor "predicate" this might have been OK, but I appreciate the attempt to standardise
p19110
aVIt also allows a lot of parity with the related methods in that area
p19111
as(dp19112
g18
V23354
p19113
stp19114
a((dp19115
g2
(lp19116
VIt confused me already
p19117
aVnormally, you think of coalesce acting on its values - I imagined that the first non-null of , and  would be returned, which isn't the case (the null test is on the originating instance)
p19118
aVNote it would be clearer without the brackets
p19119
aVWhat you are actually doing is similar to  - so something like  would be a good name, IMO (but maybe not exactly that
p19120
aVOr even simply , as long as the argument name (etc) makes it clear what the second arg is for
p19121
as(dp19122
g18
V23354
p19123
stp19124
a((dp19125
g2
(lp19126
V1: you simply drop it in the same folder as the dll
p19127
aV2: does it need to be persisted
p19128
aVFor "live" use, both the VS IDE and "reflector" allow you to review the documentation (against the types/members/etc)
p19129
aVThere are tools to transform it, but I've never bothered
p19130
aVSandcastle may be worth a look, but it was never nice to me ;-p
p19131
as(dp19132
g18
V23354
p19133
stp19134
a((dp19135
g2
(lp19136
VIt sounds like there is an extra "
p19137
aV(or two) in the mapping - i
p19138
ag50
aVit is trying to find server
p19139
aVdatabase
p19140
aVschema
p19141
aVobject
p19142
aVCheck your mapping for stray dots / dubious entries
p19143
as(dp19144
g18
V23354
p19145
stp19146
a((dp19147
g2
(lp19148
VThe single most important use is that your code has to have one - i
p19149
ag50
aVeverything you write  in C# executes in an
p19150
aVThat is quite important ;-p
p19151
aVIf you mean additional app-domains:
p19152
aVWhen using plugins and other untrusted code, it allows you both isolation, and the ability to unload them (you can't unload assemblies - only entire app-domains)
p19153
aVI'm using it currently to load dynamically generated dlls, so that I can unload them
p19154
aVThey also allow you to set different configuration files, trust levels, etc - but have associated costs of complexity and remoting
p19155
aVMSDN has a section on app-domains, here
p19156
as(dp19157
g18
V23354
p19158
stp19159
a((dp19160
g2
(lp19161
VYou can use a static method to do this
p19162
as(dp19163
g18
V23354
p19164
stp19165
a((dp19166
g2
(lp19167
VYou say "during debugging"; does  contain a (non-null) string when you assign ag
p19168
aVNote that the assignment doesn't mean that changes to  will be reflected in , since  is immutable, and any changes to  are actually creating new strings
p19169
aVIf you want this type of behaviour, you'll need to use a member of some class:
p19170
aVnow  will always be the same as
p19171
aVAlso - do you perhaps have a local variable called
p19172
aVThis would take precedence
p19173
aVCan you post code that demonstrates this problem happening
p19174
aVAs an aside; note that both static fields and arrays have various associated complexities if your app gets complex
p19175
aVyou might want to consider re-factoring them
p19176
aVThe following works fine:
p19177
aVIf you are doing something radically different, you're going to have to give us a clue
p19178
as(dp19179
g18
V23354
p19180
stp19181
a((dp19182
g2
(lp19183
VI simply use the  approach; then all my variables and fields reflect their intent
p19184
aVDon't do the  thing - that is just ugly ;-p
p19185
as(dp19186
g18
V23354
p19187
stp19188
a((dp19189
g2
(lp19190
VTimers and locks (that are intended to synchronize access to the database) are a bad idea on the web; you may have zero, one or many app-pools on different servers
p19191
aVThey may recycle at any time, and won't be spun up until needed
p19192
aVBasically, this won't prevent you hammering the db from multiple sources
p19193
aVPersonally, I'd be tempted to either write a service to do this work (either db-polling, or via WCF etc), or use the db (a SP or similar) - set a flag in a table-row to say "in progress", do the work at the db, and clear the flag (duplicate attempts exit immediately while in progress)
p19194
as(dp19195
g18
V23354
p19196
stp19197
a((dp19198
g2
(lp19199
VUntested, but is it something like:
p19200
as(dp19201
g18
V23354
p19202
stp19203
a((dp19204
g2
(lp19205
Vor (perhaps more efficient, but you'd have to test):
p19206
as(dp19207
g18
V23354
p19208
stp19209
a((dp19210
g2
(lp19211
VDo you want the distinct values
p19212
ag412
ag50
aVwill there ever be {a,a,a,b,b,a,c,c,a}
p19213
aVIf not, you could use LINQ:
p19214
aVRe your update; perhaps use something like :
p19215
as(dp19216
g18
V23354
p19217
stp19218
a((dp19219
g2
(lp19220
VYou'll need a wrapper class; then serialize the instance of  to get the xml as per your example
p19221
as(dp19222
g18
V23354
p19223
stp19224
a((dp19225
g2
(lp19226
VThe biggest problem would be if any of the threads added/removed a key in the dictionary
p19227
aVThis could cause significant re-building internally (quite possibly breaking any competing reads and writes that are in progress), so yes; you do need to synchronize access
p19228
aVYou might be OK if all the threads are reading/writing against existing keys, but I don't think it would be guaranteed
p19229
aVI don't know about java, but in C# there is  which may (if you absolutely need it) allow multiple concurrent readers or one writer (not both) - but it is often simpler (and sometimes even quicker) just to go mutex (via  etc)
p19230
aVedit
p19231
aVAlso - for strongly-typed dictionary types (i
p19232
ag50
aVgenerics etc), with value-types that are over-sized, the update won't be interlocked; another thread could in theory see an in-progress update of such a value
p19233
aVFor example, a guid on x86, etc
p19234
as(dp19235
g18
V23354
p19236
stp19237
a((dp19238
g2
(lp19239
VNot in general (and I don't normally add them), but they are necessary if you want to use
p19240
aVWhich is a pain
p19241
aVIt must also be a concrete type (for example  or  - not )
p19242
aVFortunately,  doesn't suffer the same fate
p19243
as(dp19244
g18
V23354
p19245
stp19246
a((dp19247
g2
(lp19248
VFor what you need,  is probably the most versatile
p19249
aVwas handy in 1
p19250
aV1, when (without generics) you needed specific classes for typed collections
p19251
aVis handy if you want to subclass it to provide validation etc
p19252
aVEither way, in 3
p19253
aV5, LINQ will provide lots of additional methods for them - but without LINQ,  has more features (, , etc)
p19254
as(dp19255
g18
V23354
p19256
stp19257
a((dp19258
g2
(lp19259
VIf  is the standard , then it isn't going to ever return a ; so  will return  every time
p19260
aVConsider using  :
p19261
as(dp19262
g18
V23354
p19263
stp19264
a((dp19265
g2
(lp19266
VNested classes are purely for naming convenience (and some modifier changes (private etc))
p19267
aVThey are actually the same as regular (top-level) classes in terms of behaviour
p19268
aVSo   is shared completely (it is not tied to an Page instance)
p19269
as(dp19270
g18
V23354
p19271
stp19272
a((dp19273
g2
(lp19274
VThat approach is fine (I use that quite a bit) as long as you control the client
p19275
aVIt won't work (obviously) with java clients etc
p19276
aVIf you know you will never need to support non-
p19277
aVNET clients, then it can be powerful, but it breaks some purist SOA rules
p19278
aVIn particular, yes, an intranet scenario is one where I might consider this approach
p19279
aVBoth svcutil
p19280
aVexe and the IDE have options to re-use types from existing assemblies to do exactly this
p19281
aVedit another advantage of this approach is if you want to use the same validation logic at the client, without coding it twice - for example  etc
p19282
as(dp19283
g18
V23354
p19284
stp19285
a((dp19286
g2
(lp19287
VWell, the first thing I'd do is "select" the columns that you want into an anonymous type (or a named type) - this means you are getting rectangular data, and you don't have to worry as much about lazy loading
p19288
aVSecondly, you need a list for the grid
p19289
aVTry something like:
p19290
as(dp19291
g18
V23354
p19292
stp19293
a((dp19294
g2
(lp19295
VI can't think of a sensible way of automating this
p19296
aVsome human input is key in such refactorings, if you want the output to be useful
p19297
aVRe work order number; assuming you want this to continue being an IDENTITY column; can you perhaps fill the data, find the largest, then use ALTER TABLE to make it IDENTITY
p19298
aVI don't have any TSQL tools to hand, so I can't test, unfortunately
p19299
aVAlternatively, just consider it a natural key
p19300
as(dp19301
g18
V23354
p19302
stp19303
a((dp19304
g2
(lp19305
VDefine "crashes"; there are different levels of crash
p19306
aVfor example, if something actively kills your process, you will have very little chance to run any Dispose/finalizers etc - but if your thread unwinds gracefully (even through exception), you should be OK (since you are using )
p19307
aVCan you clarify what the setup is
p19308
as(dp19309
g18
V23354
p19310
stp19311
a((dp19312
g2
(lp19313
VThe conversion operators are not part of the generated mex, so they won't exist at the client
p19314
aVGiven the complexity here - would it be possible to use assembly sharing
p19315
ag412
ag50
aVrather than generated (proxy) types, can you reference the original assembly for the types
p19316
aVThis is supported both in the IDE (on the Advanced dialog, although it seems enabled by default, so might work already if you have a reference to the assembly with the message types) and via svcutil (the /r switch)
p19317
aVThen you have your original types, conversions included, at the client
p19318
aVIf you want to keep the proxy approach, you can add partial classes for each of your messages, and add the extra conversion there - but this has an obvious maintenance cost
p19319
as(dp19320
g18
V23354
p19321
stp19322
a((dp19323
g2
(lp19324
VIt sounds like the  is set against the field (or is defaulting to fields), and is bypassing the lazy behaviour
p19325
aVIf you control the type, you could perhaps add an  method that peeks at this property before serialization kicks in
p19326
aVthat way it should have a value, and you won't need to put code into other places
p19327
aVIf the type is generated, look to see if it is a
p19328
aVIf so, you can add another  of the same name (and same namespace), and put your  method in there
p19329
aVExample (uncomment the last block to make it work):
p19330
as(dp19331
g18
V23354
p19332
stp19333
a((dp19334
g2
(lp19335
Vwell, you could have:
p19336
aVand use , , etc - but personally, I expect it would be easier to use an untyped view and simply cast
p19337
as(dp19338
g18
V23354
p19339
stp19340
a((dp19341
g2
(lp19342
VGenerics would only be helpful if you had a "list of dogs" and wanted to call a method with an argument that was "list of things that are animals" (i
p19343
ag50
aV) - I don't think it helps here
p19344
aVI suspect you are going to need a visitor pattern
p19345
aVsome set of objects that may know how to feed a given type of animal, and keep trying them until you find one that knows how
p19346
as(dp19347
g18
V23354
p19348
stp19349
a((dp19350
g2
(lp19351
VIf the user hits the exit button, the  method is called, and the UI starts getting torn down
p19352
aVHowever, your worker code keeps running and attempts to update the UI, which it can no longer do
p19353
aVIf you centralise all those invoke calls:
p19354
aVyou can call:
p19355
aV(etc - all the  calls should use  instead)
p19356
aVand it should work
p19357
aVAlso, make  volatile
p19358
as(dp19359
g18
V23354
p19360
stp19361
a((dp19362
g2
(lp19363
VWith , you usually sort a  - for example:
p19364
aVthen work with
p19365
as(dp19366
g18
V23354
p19367
stp19368
a((dp19369
g2
(lp19370
Vmscorwks is the main MS CLR implementation
p19371
aVmscordacwks provides a data-access abstraction over the CLR details, so that debuggers (such as SOS) don't need to know too much about the internals of mscorwks
p19372
aVA discussion is given here
p19373
aVBut in general, you simply don't need to work with these - so unless you're writing your own IDE/debugger, you can probably leave them alone
p19374
as(dp19375
g18
V23354
p19376
stp19377
a((dp19378
g2
(lp19379
VIsn't that just:
p19380
as(dp19381
g18
V23354
p19382
stp19383
a((dp19384
g2
(lp19385
VI don't know oracle, but in SQL Server, it is fairly common to obtain a "split" udf (like so - just one of many, many versions available) that turns the CSV into a column of values, and join (etc) to it
p19386
aVDoes pl-sql have anything similar
p19387
as(dp19388
g18
V23354
p19389
stp19390
a((dp19391
g2
(lp19392
VOne possible reason - they have reasonable fallback behaviour one low-grade clients - i
p19393
ag50
aVit becomes a tree
p19394
aVBut in reality  and  really just describe nested list data; with css controlling the layout, their original intent is, largely, just a convenience
p19395
as(dp19396
g18
V23354
p19397
stp19398
a((dp19399
g2
(lp19400
VI believe you need something like:
p19401
as(dp19402
g18
V23354
p19403
stp19404
a((dp19405
g2
(lp19406
VA complete guess, but presumably the cache is isolated by the overall request (query string args, etc)
p19407
aVeven though the "none" turns off the key/value pairs, presumably a "GET" is simply still counted as different to a "POST"
p19408
aVTry using simple links ( etc) rather than ASP
p19409
aVNET buttons
p19410
as(dp19411
g18
V23354
p19412
stp19413
a((dp19414
g2
(lp19415
VWell, there's no need to call , but broadly that is about it, yes
p19416
aVThe only consideration you might need is whether  should return "Foo", "Bar", or an exception - i
p19417
ag50
aVdo you need to iterate at all
p19418
aV(re comment) for more on flexible sorting, see here
p19419
as(dp19420
g18
V23354
p19421
stp19422
a((dp19423
g2
(lp19424
VI don't think it is valid to assume that it is a  instance
p19425
aVI could, perfectly validly, write my own  implementation, and your implementation would choke on it, breaking the whole point of interface-based abstraction
p19426
aVYou also can't (validly) just change the API to accept  (using explicit implementation to support ), since I could be using the interface rather than the class:
p19427
aVIf you want optional support for something from the base-class, then you are going to have to use "as" to detect it
p19428
aVAnything else and you are breaking the abstraction
p19429
as(dp19430
g18
V23354
p19431
stp19432
a((dp19433
g2
(lp19434
VThe view is (by default) still largely compiled on-demand, so you con't reliably use  within the view - however, for me the controller usage works fine:
p19435
aVwith:
p19436
aVshows 1
p19437
ag5115
ag9575
aV4 in the page
p19438
aVedit
p19439
aVThe mistake you made was calling  - that is going to give you  (or a subclass) - so yes, it will be 2
p19440
ag6106
aV/edit
p19441
aVFor the extra step of pre-compiling the views, see "MSBuild Task for Compiling Views" here
p19442
aVArguably, your view shouldn't be fetching this data itself anyway - it should be put into the ViewData (or similar), perhaps by a base-controller or action-filter
p19443
aVRe the question about master pages; first, pick a key ;-p
p19444
aVthen two options leap to mind: override  in the controller (or a common base-controller):
p19445
aVor create an action-filter:
p19446
aVAnd mark your controllers (classes) or actions (methods) with this attribute:
p19447
as(dp19448
g18
V23354
p19449
stp19450
a((dp19451
g2
(lp19452
VIf you mean like the auto-complete options on , I'm not aware of any in-built support for this
p19453
aVThe closest (although not the same) would be to use a
p19454
aVFor things not directly available; it looks like other people have looked at this - you might try the sample here
p19455
as(dp19456
g18
V23354
p19457
stp19458
a((dp19459
g2
(lp19460
VYou could perhaps add some white-space text into the element
p19461
aVOr some other content - maybe a comment
p19462
aVWithout some content, the two forms are pretty-much identical
p19463
aVRe the "tag" question - that depends what you mean
p19464
aVbut  has  and  - just find the node you want it to be adjacent to and use one of those
p19465
as(dp19466
g18
V23354
p19467
stp19468
a((dp19469
g2
(lp19470
VFirst, ensure you have  at the top of the file
p19471
aVIf you have a collection that implements  but not , but you know the objects are all of a given type (such as ), then you can use the  LINQ extension method:
p19472
aVHowever, given your  clause, it might be more prudent, in this case, to use the  method, which only returns those of a given type ( throws an exception if anything is wrong):
p19473
aVThe slight difference between this and your version is that the above will return subclasses of , where-as your  version won't
p19474
aVBasically, most of the LINQ extension methods are defined only for  / , not /
p19475
as(dp19476
g18
V23354
p19477
stp19478
a((dp19479
g2
(lp19480
VThe problem is that if nobody subscribes the the event, it is null
p19481
aVAnd you can't invoke against a null
p19482
aVThree approaches leap to mind:
p19483
aVcheck for null (see below)
p19484
aVadd a "do nothing" handler: public event EventHandler MyEvent = delegate {};
p19485
aVuse an extension method (see below)
p19486
aVWhen checking for null, to be thread-safe, you must in theory capture the delegate reference first (in case it changes between the check and the invoke):
p19487
aVExtension methods have the unusual property that they are callable on null instances
p19488
aVthen you can call:
p19489
aVand it is both null-safe (via the check) and thread-safe (by reading the reference once only)
p19490
as(dp19491
g18
V23354
p19492
stp19493
a((dp19494
g2
(lp19495
VYou can manage server hooks via the VisualSVN Server Manager:
p19496
aVStart the Server Manager,
p19497
aVSelect the repository,
p19498
aVAction | All Tasks | Manage Hooks
p19499
aVIn the dialog it tells you that the revision number is the 2'nd argument
p19500
aVWith the revision number, you can use  and  to do a lot of other tasks
p19501
aVany use
p19502
as(dp19503
g18
V23354
p19504
stp19505
a((dp19506
g2
(lp19507
VWell, when we are talking bout delegate usage, there shouldn't be any difference between lambda and anonymous methods -- they are the same, just with different syntax
p19508
aVAnd named methods (used as delegates) are also identical from the runtime's viewpoint
p19509
aVThe difference, then, is between using delegates, vs
p19510
aVinline code - i
p19511
ag50
aV(where I would expect the latter to be quicker)
p19512
aVAnd equally, if you are talking about anything other than in-memory objects, lambdas are  one of your most powerful tools in terms of maintaining type checking (rather than parsing strings all the time)
p19513
aVCertainly, there are cases when a simple  with code will be faster than the LINQ version, as there will be fewer invokes to do, and invokes cost a small but measurable time
p19514
aVHowever, in many cases, the code is simply not the bottleneck, and the simpler code (especially for grouping, etc) is worth a lot more than a few nanoseconds
p19515
aVNote also that in
p19516
aVNET 4
p19517
aV0 there are additional  nodes for things like loops, commas, etc
p19518
aVThe language doesn't support them, but the runtime does
p19519
aVI mention this only for completeness: I'm certainly not saying you should use manual  construction where  would do
p19520
as(dp19521
g18
V23354
p19522
stp19523
a((dp19524
g2
(lp19525
VFor 6:
p19526
aVEdit for 7:
p19527
aVIf we allow brackets and braces
p19528
aV(edited the "lock", "new object()", "as" and "string" were contributed by others; see comments)
p19529
as(dp19530
g18
V23354
p19531
stp19532
a((dp19533
g2
(lp19534
VAs a lazy answer, you can check  - it should at least indicate where they are clearly different (although it will include the var-name in there, so that would have to be the same)
p19535
aVFor checking equivalence accurately
p19536
aVmuch harder - a lot of work, over a lot of different node types
p19537
as(dp19538
g18
V23354
p19539
stp19540
a((dp19541
g2
(lp19542
VWouldn't that just be the raw dll contents, as though you had saved it to disk
p19543
ag412
ag50
aVthe equivalent of
p19544
aVIt sounds like the dll is generated - can you save it anywhere
p19545
aV(temp area, memory stream, etc)
p19546
aVedit Since it seems you are using code-dom, try using  (on the compiler-results) and  (or a similar streaming mechanism)
p19547
as(dp19548
g18
V23354
p19549
stp19550
a((dp19551
g2
(lp19552
VIt sounds like you have a borked xml file
p19553
aVEasy ways to find out:
p19554
aVtry loading it into an xml viewer
p19555
aVor just make sure it has a
p19556
aVxml extension and load in VS or IE
p19557
aVor run xsd
p19558
aVexe over it
p19559
aVIf they complain, then the xml is certainly corrupt
p19560
aVIf they work fine, and display your data, then you probably have the serialization attributes wrong
p19561
aVTry using xsd
p19562
aVexe with the "/classes" switch to see what it would do with it
p19563
as(dp19564
g18
V23354
p19565
stp19566
a((dp19567
g2
(lp19568
VSee MSDN:
p19569
aVYou should also use the TransactionScope and
p19570
aVDependentTransaction class for
p19571
aVapplications that require the use of
p19572
aVthe same transaction across multiple
p19573
aVfunction calls or multiple thread
p19574
aVcalls
p19575
aVSo maybe look into  - in particular, there is a worker thread example, here
p19576
as(dp19577
g18
V23354
p19578
stp19579
a((dp19580
g2
(lp19581
VTry placing a second web
p19582
aVconfig inside that folder, with something like:
p19583
as(dp19584
g18
V23354
p19585
stp19586
a((dp19587
g2
(lp19588
VFirst, a  has columns, not a data-set
p19589
aVIf you want to get rid of them, then:
p19590
aVotherwise, if you have the index:
p19591
aVshould do the job if you have the column index
p19592
aVNote that if you remove column 0, then the numbers will shuffle (so you might need to do in reverse order)
p19593
aVAlternatively, you may want to remove by name:
p19594
as(dp19595
g18
V23354
p19596
stp19597
a((dp19598
g2
(lp19599
VRe the request/response - a  would work just as well
p19600
aVOne of the advantages of message-contracts is that you can set privacy against members, but in many cases this isn't necessary
p19601
aVIn such cases, I prefer to keep the contract as simple as possible, just as a data-contract
p19602
aVRe which serializer - that is largely a factor of the configuration
p19603
aVBy default over http, for example, it will be
p19604
aVI'm not sure, however, that the list of  is going to work very well
p19605
aVYou could try, but generally it wants concrete types
p19606
aVNote that with base-classes you can use  to specify the allowed sub-types
p19607
aVNote that unlike , it is not a requirement for collection members to have setters - although you might need to add an  callback method to initialize the list if you do that (WCF doesn't call constructors)
p19608
aVAside: you can also use protobuf-net with data-contracts and WCF (as long as they have an explicit Order); this is more densely packed than the regular xml
p19609
aVIt has no support for message-contracts at the moment, though
p19610
as(dp19611
g18
V23354
p19612
stp19613
a((dp19614
g2
(lp19615
VFirst; for network usage, there is  and  which handle length for you (optionally with a tag)
p19616
aVThe  looks OK at first glance; and this actually ties in very closely to the pending commit of the work I've been doing to implement an RPC stack: the pending code  that takes (essentially) a , to resolve a tag to a type to make it easier to deserialize unexpected data on the fly
p19617
aVIf the message type actually relates to the inheritance between  and , then you don't need this; it always goes to the top-most contract type in the hierarchy and works its way down (due to some wire details)
p19618
aVAlso - I haven't had chance to test it, but the following might be upsetting it:
p19619
aVIt is marked for serialization, but has no mechanism for setting the value
p19620
aVMaybe this is the issue
p19621
aVTry removing the  here, since I don't this is useful - it is (as far as serialization is concerned), largely a duplicate of the  marker
p19622
as(dp19623
g18
V23354
p19624
stp19625
a((dp19626
g2
(lp19627
VFirst - I always seed my random values for unit tests, so that hey are repeatable - however, something like (using  instead of , but equivalent):
p19628
as(dp19629
g18
V23354
p19630
stp19631
a((dp19632
g2
(lp19633
VYou can check the  - because that is an enum it should be more human friendly
p19634
aVAlternatively, just
p19635
as(dp19636
g18
V23354
p19637
stp19638
a((dp19639
g2
(lp19640
VIf the value is scoped to the method (i
p19641
ag50
aVnot used externally, but used a few times inside), then it makes good sense
p19642
aVIn particular, if working with xml you might have something like an xml namespace that is used (in only one method) several times, but it certainly not something you want to maintain more than once - const is ideal
p19643
aVIn terms of C#, this also has impact for closures:
p19644
aVis different to:
p19645
aVThe second must generate a capture class, etc - the first is just a static method (without state), and more efficient (no heap object per usage, no de-reference, etc)
p19646
as(dp19647
g18
V23354
p19648
stp19649
a((dp19650
g2
(lp19651
VIt really depends on whether you make use of external references
p19652
aVYou can always write your own , allowing it to work with the files that you do have (I have one that reads known files from resx for example)
p19653
aVBut the simplest option is just to disable it
p19654
aVand of course your unit tests will quickly identify any problem ;-p
p19655
as(dp19656
g18
V23354
p19657
stp19658
a((dp19659
g2
(lp19660
VMost ORMs (including LINQ-to-SQL and EF) will offer you the choice of either automated CRUD or stored procedures
p19661
aVFor example, while I'm happy to let the ORM deal with simple homogeneous CRUD issues (inserting simple records, etc), if I have a critical search method that spans complex data in non-trivial ways, I might choose to use a UDF (or SP) to ensure I can profile it, tune it, etc properly
p19662
aVIn some scenarios, there are security/audit issues that prevent direct CRUD, but in most cases involving an app-server, it is an artificial concern: if a hacker already breached your app-server, you already have major problems - and if they know the schema they can often use the SPs to do just as much damage
p19663
aVIf you are using the same backend from multiple applications on different technologies, then SPs are also useful
p19664
aVMany of the original performance debates around SP vs text commands are now largely moot; a correctly parameterized text query can use the query-cache, and is injection safe, etc
p19665
as(dp19666
g18
V23354
p19667
stp19668
a((dp19669
g2
(lp19670
VHmm
p19671
aVgood question
p19672
aVI can't think of a good use for this
p19673
aVIf you wanted to span multiple databases (different data-contexts) from a single connection (which is not a good idea in the first place), it would still be pretty useless, as it would be fixed for all instances of the data-context
p19674
aVIn every sensible case I can think of, the connection defines the database, or it is a non-issue (standalone db files, etc)
p19675
aVI wonder if it wasn't just put there because it (the knowledge of the database name) existed, and so it would be obtainable (in theory) in the same way
p19676
as(dp19677
g18
V23354
p19678
stp19679
a((dp19680
g2
(lp19681
VYou'll need to use ; something like (untested):
p19682
aV(edit: fixed)
p19683
as(dp19684
g18
V23354
p19685
stp19686
a((dp19687
g2
(lp19688
VIf you want to perform operations outside of the controller, then action-filters (etc) are a good bet; just inherit from , override  (etc) to inject data into the view, and mark your controller with
p19689
aVLike this
p19690
aV(original; I may have misunderstood)
p19691
aVIt would be better to use dependency injection here, by passing the log-writer into the repository as a constructor argument (ideally via something like StructureMap, which works very well with MVC via StructureMapControllerFactory, or similar)
p19692
as(dp19693
g18
V23354
p19694
stp19695
a((dp19696
g2
(lp19697
V is declared as a local (method) variable, so it only normally exists in the stack-frame of  - so yes,  is thread safe
p19698
aV(although I can't comment on )
p19699
aVexcept if:
p19700
aVis an iterator block (i
p19701
ag50
aVuses  or )
p19702
aVis used in an anonymous method (  ) or lambda (
p19703
aVIn the above two scenarios, there are some cases when it can be exposed outside the stack
p19704
aVBut I doubt you are doing either
p19705
aVNote that fields (variables on the class) are not thread-safe, as they are trivially exposed to other threads
p19706
aVThis is even more noticeable with  fields, since all threads automatically share the same field (except for thread-static fields)
p19707
as(dp19708
g18
V23354
p19709
stp19710
a((dp19711
g2
(lp19712
V(removed an answer using a  list)
p19713
aVAs per the comment on the other post, my view is that while the LINQ etc may be "clever", it isn't necessarily efficient
p19714
aVIt will make a lot of intermediate strings that need to be collected, for example
p19715
aVI'd stick to  etc, unless you have good reason to change it
p19716
as(dp19717
g18
V23354
p19718
stp19719
a((dp19720
g2
(lp19721
VWhen you use , you are passing the address of the caller's field/variable
p19722
aVTherefore yes: two threads can compete over the field/variable - but only if they both are talking to that field/variable
p19723
aVIf they have a different field/variable to the same instance, then things are sane (assuming it is immutable)
p19724
aVFor example; in the code below,  does see the changes that  makes to the variable (each object instance is effectively immutable)
p19725
as(dp19726
g18
V23354
p19727
stp19728
a((dp19729
g2
(lp19730
VThat sounds a lot like the knapsack problem
p19731
aVThere are various approaches (order descending by energy density, for example)
p19732
as(dp19733
g18
V23354
p19734
stp19735
a((dp19736
g2
(lp19737
VSee here for a discussion on local variables
p19738
aVbefore your edit neither of the above methods themselves presented a concurrency risk; the local variables are all independent per call; the shared state () is visible to multiple threads, but you don't mutate it, and you only read it once
p19739
aVIf you did something like:
p19740
aVit would (in theory) not be safe, as the value of a could be changed by another thread - you would typically either synchronize access (via  etc), or take a snapshot:
p19741
aVIf you are editing the value, you would almost certainly require synchronization
p19742
as(dp19743
g18
V23354
p19744
stp19745
a((dp19746
g2
(lp19747
VThe compiler does most of this work (see Kent's reply)
p19748
aVRe the question about calling Begin/End in succession; no, not for delegates
p19749
aVYou can verify this, because  pushes the work onto the , where-as if you use  the work happens on the current thread
p19750
aVThis approach, however, is common some other Begin/End pairs (in particular IO-bound operations); but not for delegates
p19751
aVI've been looking at more graceful ways of calling Begin/End (without messing with  etc) - see here for more
p19752
as(dp19753
g18
V23354
p19754
stp19755
a((dp19756
g2
(lp19757
VHowever, note that this only searches the calling assembly and core MS assemblies
p19758
aVIt is better to use either the , of find the  first, and use
p19759
aVEither:
p19760
aVor
p19761
aVUpdate re comments; note that  includes versioning information; this is fine for use in things like configuration files, but if (as is the case here) you are using this for persistance, it is often better to use an implementation independent contract
p19762
aVFor example, xml (via  or ) is not concerned about the specific types, as long as the layout is correct
p19763
aVIf space is an issue, binary formats are often shorter - but  includes type metadata, and isn't platform independent (try consuming it from java, for example)
p19764
aVIn such cases, you might want to look at custom serializers such as protobuf-net, which is contract-based, but using Google's "protocol buffers" cross-platform wire format
p19765
as(dp19766
g18
V23354
p19767
stp19768
a((dp19769
g2
(lp19770
VI'm not aware of any parser / xml tool / etc (in
p19771
aVNET at least) that would distinguish between those two (insignificant whitespace)
p19772
aVIn terms of meaning, they are identical - the same as they are identical to:
p19773
as(dp19774
g18
V23354
p19775
stp19776
a((dp19777
g2
(lp19778
VIf it is bound to a , can you not work on the model (the table) instead
p19779
aVThe  is a view
p19780
aVTry looping over the rows in the table, setting the values
p19781
aVFor example (below) - note that I don't update the  - just the :
p19782
as(dp19783
g18
V23354
p19784
stp19785
a((dp19786
g2
(lp19787
VVery interesting - it looks like it couldn't decide whether it could use the primary key or not
p19788
aVwhat does the object model look like
p19789
aVNo hand-crafted inheritance or anything
p19790
as(dp19791
g18
V23354
p19792
stp19793
a((dp19794
g2
(lp19795
VYes, you can re-use a  - but you can only use it once at any time - not concurrently
p19796
aVIf the operations are different, however, I'd use a separate worker
p19797
aVOtherwise you'll have to unhook the events, hook the correct events, etc
p19798
aVMessy
p19799
as(dp19800
g18
V23354
p19801
stp19802
a((dp19803
g2
(lp19804
VYou are allowed to use the  syntax to invoke another constructor at the same level - however, you cannot use  (the current instance) in this context
p19805
aVThe easiest option here is to duplicate the assignment code ()
p19806
aVAnother option might be null-coalescing:
p19807
as(dp19808
g18
V23354
p19809
stp19810
a((dp19811
g2
(lp19812
VI'd check (using C# for the example):
p19813
aVIMO, this is easier than using  etc, and doesn't involve any extra multiplication (since  defined the  - all the other properties are calculated)
p19814
as(dp19815
g18
V23354
p19816
stp19817
a((dp19818
g2
(lp19819
VFirst - don't have mutable structs (i
p19820
ag50
aVa struct where you can change the values after construction, via setters etc)
p19821
aVThat is the primary cause of confusion here
p19822
aVThe point is; when you call a property (like ) you get a copy of the value (in your local stack area)
p19823
aVFor a class, that is a copy of the reference (no problem)
p19824
aVFor a struct it is a copy of the struct itself
p19825
aVAny changes to that value will be discarded, so the compiler has stopped you from losing data
p19826
aVWhen it is a public field, you are mutating the original value directly, which is why it doesn't mind
p19827
aVBut mutating structs really isn't a good idea
p19828
aVMake  a class; that is the correct solution here
p19829
aVIn
p19830
aVNET, structs aren't "objects without behaviour" - they are "value-types"
p19831
aVThings like "a currency/value pair", "a time range", etc might make valid structs - but not
p19832
as(dp19833
g18
V23354
p19834
stp19835
a((dp19836
g2
(lp19837
VWell, one obvious consideration would be the (very common)  and  pair (when abstracting ), but more generally it is often fundamental to know whether something is an interface vs class
p19838
aVYes it is partly redundant, but IMO is is different from things like  - here, the name itself () should be enough to understand the variable
p19839
aVBut with  - it that a class, or the abstract interface
p19840
aVAlso: expectation; the fact is, right or wrong, that is what people expect
p19841
aVThat is almost reason enough
p19842
as(dp19843
g18
V23354
p19844
stp19845
a((dp19846
g2
(lp19847
VWhat account is the service running as
p19848
aVI wonder if the service is failing to start, probably due to not having permissions to open the port
p19849
aVTry running the service in your own identity (but as a service)
p19850
aVIf it works, it is a permissions issue
p19851
aVThe most likely is the HTTP
p19852
aVSYS permissions
p19853
aVTo assign access, you use netsh on vista/window 7, or httpcfg on xp
p19854
as(dp19855
g18
V23354
p19856
stp19857
a((dp19858
g2
(lp19859
VLINQ expression parsers are pretty much at liberty to support (or not) any set of operations they choose
p19860
aVIn the case of LINQ-to-SQL and EF, they will throw an exception if they get confused by something (and I would expect the above to fall into this) - but it sounds like Db4o is just saying "no matches"
p19861
aVDoes Db40 have the ability to log the queries it executes
p19862
aVMaybe it is doing something funky
p19863
aVbut we can only guess
p19864
as(dp19865
g18
V23354
p19866
stp19867
a((dp19868
g2
(lp19869
VWell, 10 items isn't what I call bulk, but for larger sets,  is your friend
p19870
aVAll you need to do is feed it either a  or an  (my preferred option, 'cos I like streaming APIs)
p19871
aVI did something similar here (you can ignore the xml side - just subclass the SimpleDataReader)
p19872
as(dp19873
g18
V23354
p19874
stp19875
a((dp19876
g2
(lp19877
VI realized my first answer was completely bogus - but you can cheat with properties:
p19878
as(dp19879
g18
V23354
p19880
stp19881
a((dp19882
g2
(lp19883
VI don't claim them to be comprehensive, but I have a number of  posts on my blog
p19884
aVIf you are UK based, I will also be presenting a session on  at DDD South West in May (and last night, but too late ;-p)
p19885
aVI could post the slide deck and some of the links from related articles, if you want
p19886
aVunfortunately, a pptx intended to be spoken rarely makes sensible standalone reading
p19887
aVSome other reading (not from the blog):
p19888
aVJason Bock: genetic programming with
p19889
aV(me again): generic operators with
p19890
aV(and again, on InfoQ)  as a Compiler
p19891
aV(and a whole load of posts here and on microsoft
p19892
aVpublic
p19893
aVdotnet
p19894
aVlanguages
p19895
aVcsharp
p19896
aV- try searching for: +expression -regex -"regular expression"
p19897
as(dp19898
g18
V23354
p19899
stp19900
a((dp19901
g2
(lp19902
V(from the author)
p19903
aVIn the current release, it is fixed to types known to the parent
p19904
aVHowever, this is a known limitation, so there is a plan to abstract the meta-model so that it can be provided separately at runtime - broadly comparable to how you provide such information to  (it will still need a way to provide tags (the "2" above) per type)
p19905
aVI have started on this work, but I expect it to take a few weeks to get it fully working (the refactor will also tie into some other changes to help compact framework)
p19906
aVSo up to you
p19907
aVif you can wait a few weeks, I hope to have something working
p19908
aVNote that you would still need some way of generating (unique, repeatable) tags for all the different sub-types - configuration, etc
p19909
as(dp19910
g18
V23354
p19911
stp19912
a((dp19913
g2
(lp19914
VLINQ is a query language - not an editing language
p19915
aVFor entity manipulation (changes etc), you need to work with the object-orientated parts of the data-context / entities manager, etc
p19916
aVSo basically, you need to either:
p19917
aVuse a stored procedure instead (or)
p19918
aVinclude the full entity () in the output (either by itself, or inside the anon-type); update this object, and call the contexts "save" method (, etc)
p19919
as(dp19920
g18
V23354
p19921
stp19922
a((dp19923
g2
(lp19924
VThe implementation is, AFAIK, "all of these" - it uses:
p19925
aVWhich is "all of"
p19926
aVIf you wanted to write an "any of", perhaps add a helper method:
p19927
aV(add the "this" before  to make it a C# 3
p19928
aV0 extension method in)
p19929
aVOr with LINQ:
p19930
as(dp19931
g18
V23354
p19932
stp19933
a((dp19934
g2
(lp19935
VWhen just using , LINQ isn't really going to help you very much
p19936
aVis it worth the pain
p19937
aVAnd Dynamic LINQ is certainly overkill
p19938
aVWhat is the expected way of using this
p19939
aVI can think of a few ways of adding basic  operations
p19940
aVbut I'm not sure how helpful it would be
p19941
as(dp19942
g18
V23354
p19943
stp19944
a((dp19945
g2
(lp19946
VIf you suspect a bug in the MS code, you could download the debugging symbols from the symbol server, load them and trace it through at debug
p19947
aVLike so
p19948
aVNote that the symbols are subject to one of the various licences
p19949
aVThis may impact you if (for example) you work on "mono" contributions etc
p19950
as(dp19951
g18
V23354
p19952
stp19953
a((dp19954
g2
(lp19955
VI changed the  to , and:
p19956
as(dp19957
g18
V23354
p19958
stp19959
a((dp19960
g2
(lp19961
VThis has permissions implications
p19962
aVA top-level "class y" would be "internal" - however, here "y" is private to "x"
p19963
aVThis approach is helpful for implementation details (for example cache rows etc)
p19964
aVLikewise,  has access to all private state of
p19965
aVThere are also implications with generics;  is generic "of T", inherited from the outer class
p19966
aVYou can see this here, where  has full use of  - and note that any static fields of  are scoped per-
p19967
aVOften people incorrectly think they need to define  as  - this is now (effectively) doubly generic - i
p19968
ag50
aV- where  is the (now unavailable)  from
p19969
aVSo don't do that
p19970
aVOr if you want it to be doubly-generic, pick different names
p19971
aVFortunately, the compiler warns you about this
p19972
as(dp19973
g18
V23354
p19974
stp19975
a((dp19976
g2
(lp19977
VYou could use a ClickOnce project (winform/wpf) - essentially a regular client app, deployed via a web-server
p19978
aVAt the client, it can do whatever it needs
p19979
aVVS2005/VS2008 have this (for winform/wpf) as "Publish" - and results in a "
p19980
aVapplication" file that is recognised by the browser (or at least, some browsers ;-p)
p19981
aVYou might be able to do the same with Silverlight, but that has a stricter sandbox, etc
p19982
aVIt would also need to ask the web-server to do all the db work on its behalf
p19983
as(dp19984
g18
V23354
p19985
stp19986
a((dp19987
g2
(lp19988
VPersonally, I don't always use the identifiers, for exactly the reasons (memory) raised here
p19989
aVAn interesting feature of the C# compiler is that it actually compiles the following to the same thing:
p19990
aVI find the second version far more readable
p19991
aVSo I use that approach
p19992
aVThe only time AFAIK that it does anything different is with decimal with trailing zeros - i
p19993
ag50
as(dp19994
g18
V23354
p19995
stp19996
a((dp19997
g2
(lp19998
VSome people swear by Predicate Builder
p19999
aVPersonally, I've always found it sufficient to mangle the s manually - but maybe I'm just odd like that (and besides, I've been playing with the  API for quite a while)
p20000
aVBut as long as you have suitable unit tests in place, I can't see any issue with this approach
p20001
aVThe biggest current gripe would be EF's limited support for  - rest assured, that'll be one of the first things I check when 4
p20002
aV0 goes "beta"
p20003
as(dp20004
g18
V23354
p20005
stp20006
a((dp20007
g2
(lp20008
VIn my mind, the biggest difference is how they (anonymous classes in java vs anonymous methods in C#) handle captures
p20009
aVIn java, it captures the current value of the variable (the original and captured value are then isolated)
p20010
aVIn C#, you capture the variable itself
p20011
aVThis is double edged, and can lead to problems - but is incredibly powerful when used correctly
p20012
as(dp20013
g18
V23354
p20014
stp20015
a((dp20016
g2
(lp20017
VIt can make constructors simpler, especially for immutable types (which are important for threading) - see here for a full discussion
p20018
aVNot as nice as it should be perhaps, but nicer than having lots of overloads
p20019
aVYou obviously can't use object initializers with immutable objects, so the usual:
p20020
aVisn't available; I'll settle for:
p20021
aVThis can be extended to the general idea of simplifying overloads, but in most cases I'd prefer overloads that advertise the legal combinations
p20022
aVConstructors are a bit different, IMO, since you are just (typically) defining the initial state
p20023
aVThe COM side of things is also important to a lot of people, but I simply don't use much COM interop - so this isn't as important to me
p20024
aVEdit re comments; why didn't they just use the same syntax that attributes use
p20025
aVSimple - it can be ambiguous with other members / variables (which isn't an issue with attributes); take  the example:
p20026
aVwhich uses one regular parameter (to the ctor, "foo"), and one named assignment
p20027
aVSo suppose we use this for regular named arguments:
p20028
aV(which could also be a constructor; I've used a method for simplicity)
p20029
aVNow
p20030
aVwhat if we have a variable or a property called
p20031
aVThis would be ambiguous between using  as a named argument to , and assigning "bar" to , and passing "bar" as a regular argument
p20032
aVTo illustrate, this is legal in C# 3
p20033
aV0:
p20034
aVObviously, SecondArg could be a property, field, varialble, etc
p20035
aVThe alternative syntax doesn't have this ambiguity
p20036
aVEdit - this section by 280Z28: Sorry for adding this here, but it's not really a unique answer and it's too long for the comments and includes code
p20037
aVYou hinted at the ambiguity but your example didn't highlight the deciding case
p20038
aVI think the example you gave points out something that could be confusing, but the required  around object initializers prevents an underlying syntactical ambiguity
p20039
aVMy explanation for the following code is embedded as the multi-line block comment
p20040
as(dp20041
g18
V23354
p20042
stp20043
a((dp20044
g2
(lp20045
VFirst - are they exactly the same
p20046
aVIn particular, the SOAP namespaces must match (in addition to everything else)
p20047
aVIf they don't, then they are different (incompatible) types; you will have to use 2 different references (in different C# namespaces to avoid conflicts), and shift data between the two types
p20048
aVIf the types are the same and it still doesn't work, then you can perhaps use the /r switch with svcutil to consume the types from an existing assembly
p20049
aVTry using it once to get the first types (just from 1 of the urls) - then compile that code into an assembly
p20050
aVUse svcutil against the second endpoint with the /r flag identifying the assembly you generated moments ago
p20051
aVNote; a related topic is to write a  for one-or-more of the types - for example, to provide conversion methods/operators on the types themselves
p20052
aVThis might make things simpler
p20053
aVFor example, you could write an implicit (or explicit) static conversion operator between two similar types in different namespaces
p20054
as(dp20055
g18
V23354
p20056
stp20057
a((dp20058
g2
(lp20059
VAside: in this scenario, I would consider treating the status code (rather than id) as a primary key, and have the  denormalized in the ; this retains the foreign key, but reduces the number of joins and navigations needed
p20060
aVIt also allows you potentially to map the Code to an  in your
p20061
aVNET code
p20062
aVI would probably use a lazy (on demand) cache of the i18n text values; this:
p20063
aVminimises the query complexity
p20064
aVminimises data-throughput/IO
p20065
aVminimises object identity/change tracking overhead
p20066
aVminimises the number of "materializations" that are happening constantly
p20067
aVallows you to program just against an enum in the object model, but display the i18n text
p20068
aVabstracts the i18n implementation (so you could switch to resx or similar if you needed to, or an automated translation service)
p20069
aVallows you to obtain i18n values without being tied to an existing data query - i
p20070
ag50
aVto  populate a drop-down box for a search screen (which has nothing to do with individual employees, so the example query doesn't help)
p20071
aVI'm guessing the i18n data is slow changing, so the cache approach is ideal
p20072
aVI would load all the related strings a language at a time - so the first time a status is needed in Welsh (for example), I'd load all the status strings for Welsh, and cache against the standard code (cy) for the language
p20073
aVTo make the view code simpler, consider using an extension method on the employee (at the UI level):
p20074
aVthen in your view you can use:
p20075
aVetc
p20076
aVUnfortunately there are no extension properties, but with a method you also have the option of passing the language-code into the method (after adding a parameter):
p20077
as(dp20078
g18
V23354
p20079
stp20080
a((dp20081
g2
(lp20082
VWell, if you really don't want them - you could remove the schemas from the xsd path () - and perhaps disable download (Options->TextEditor->Xml->Miscellaneous)
p20083
aVMy machine isn't in a suitable state to try it, but it should work in theory
p20084
as(dp20085
g18
V23354
p20086
stp20087
a((dp20088
g2
(lp20089
VUltimately, LINQ on  is a pipes and filters implementation
p20090
aVis a streaming API - meaning that data is lazily returns as you ask for  it (via iterator blocks), rather than loading everything at once, and returning a big buffer of records
p20091
aVThis means that your query:
p20092
aVis:
p20093
aVas you enumerate over this, it will consume the data lazily
p20094
aVYou can see this graphically with Jon Skeet's Visual LINQ
p20095
aVThe only things that break the pipe are things that force buffering; , , etc
p20096
aVFor high volume work, Jon and myself worked on Push LINQ for doing aggregates without buffering in such scenarios
p20097
aV(exposed by most ORM tools - LINQ-to-SQL, Entity Framework, LINQ-to-NHibernate) is a slightly different beast; because the database engine is going to do most of the heavy lifting, the chances are that most of the steps are already done - all that is left is to consume an  and project this to objects/values - but that is still typically a pipe ( implements ) unless you call ,  etc
p20098
aVWith regard to use in enterprise
p20099
aVmy view is that it is fine to use  to write composable queries inside the repository, but they shouldn't leave the repository - as that would make the internal operation of the repository subject to the caller, so you would be unable to properly unit test / profile / optimize / etc
p20100
aVI've taken to doing clever things in the repository, but return lists/arrays
p20101
aVThis also means my repository stays unaware of the implementation
p20102
aVThis is a shame - as the temptation to "return"  from a repository method is quite large; for example, this would allow the caller to add paging/filters/etc - but remember that they haven't actually consumed the data yet
p20103
aVThis makes resource management a pain
p20104
aVAlso, in MVC etc you'd need to ensure that the controller calls  or similar, so that it isn't the view that is controlling data access (otherwise, again, you can't unit test the controller properly)
p20105
aVA safe (IMO) use of filters in the DAL would be things like:
p20106
aVHere we've added filters on-the-fly, but nothing happens until we call
p20107
aVAt this point, the data is obtained and returned (disposing the data-context in the process)
p20108
aVThis can be fully unit tested
p20109
aVIf we did something similar but just returned , the caller might do something like:
p20110
aVAnd all of a sudden our DAL starts failing (cannot translate  to TSQL, etc)
p20111
aVYou can still do a lot of interesting things in the repository, though
p20112
aVThe only pain point here is that it might push you to have a few overloads to support different calling patterns (with/without paging, etc)
p20113
aVUntil optional/named parameters arrives, I find the best answer here is to use extension methods on the interface; that way, I only need one concrete repository implementation:
p20114
aVNow we have virtual overloads (as extension methods) on  - so our caller can use  without having to specify the paging
p20115
aVFinally - without LINQ, using pipes and filters becomes a lot more painful
p20116
aVYou'll be writing some kind of text based query (TSQL, ESQL, HQL)
p20117
aVYou can obviously append strings, but it isn't very "pipe/filter"-ish
p20118
aVThe "Criteria API" is a bit better - but not as elegant as LINQ
p20119
as(dp20120
g18
V23354
p20121
stp20122
a((dp20123
g2
(lp20124
VNo, you can't change the type of a  (expression trees are immutable); you would have to rebuild the entire tree to do this
p20125
aVAnd yes, you often have to recurse it
p20126
aVSorry
p20127
as(dp20128
g18
V23354
p20129
stp20130
a((dp20131
g2
(lp20132
V(edit: relates mainly to the original question, before it was edited and a bounty added)
p20133
aVI've been looking at this problem recently - see Async without the pain
p20134
aVNote the comment at the end about using the delegate version - this simplifies the calling slightly
p20135
aVAs an update, the final code would look something like below, and as it transpires is very similar to what F# uses under the bonnet:
p20136
as(dp20137
g18
V23354
p20138
stp20139
a((dp20140
g2
(lp20141
VI find the whole Begin/End pattern unnecessarily complex - so I had a look at wrapping it up (very comparable to what F# uses)
p20142
aVResult: no more need to keep the delegate (etc)
p20143
as(dp20144
g18
V23354
p20145
stp20146
a((dp20147
g2
(lp20148
VWell, it is telling the truth
p20149
aVUnlike NUnit / TestDriven
p20150
aVNET, etc - MSTest copied things around into a different folder for each test
p20151
aVWhich is (IMO) a pain - for example, you need to either attribute files to include (), or specify them in the testrunconfig (properties -> Deployment -> Add File
p20152
aVContrast this to TestDriven
p20153
aVNET, where you could use the "Copy to Output Directory" flag
p20154
as(dp20155
g18
V23354
p20156
stp20157
a((dp20158
g2
(lp20159
VFirst, I'd probably use generics:
p20160
aVOr in
p20161
aVNET 3
p20162
aV5:
p20163
aVIf you need to use , then  is your friend, in particular:
p20164
as(dp20165
g18
V23354
p20166
stp20167
a((dp20168
g2
(lp20169
VYou need to specify the actual namespace - not the alias (which the writer will decide):
p20170
aVNote that it is common to use a "" for the namespaces, etc
p20171
aVAlso, public fields not a good idea - with C# 3
p20172
aV0 you could have (xml attributes not shown):
p20173
as(dp20174
g18
V23354
p20175
stp20176
a((dp20177
g2
(lp20178
VI wonder how the tool is doing the checking
p20179
aVI expect you might need to enable ASP
p20180
aVNET compatibility mode
p20181
aVThe other thing to try is making the address explicit (rather than relative) in the WCF config
p20182
aVNo, it doesn't matter about separate dlls, and it shouldn't matter about accounts (although anything is possible
p20183
aVedit:
p20184
aVor in web
p20185
aVconfig, under system
p20186
aVserviceModel:
p20187
as(dp20188
g18
V23354
p20189
stp20190
a((dp20191
g2
(lp20192
VFor C# (or
p20193
aVNET in general), PEX might be that tool
p20194
aVIt works at the IL level, and attempts to force its way into every branch
p20195
aVIt has successfully uncovered a wide range of bugs (in the BCL etc)
p20196
as(dp20197
g18
V23354
p20198
stp20199
a((dp20200
g2
(lp20201
V(after the edit)
p20202
aVThanks for the example code
p20203
aVYes, I'd agree that this is a bug
p20204
aVFor workarounds
p20205
aVwell, you could add a column by default
p20206
aVTo avoid the cross-contamination, you could use :
p20207
aVAt least then it is dt2 that gets omitted, instead of dt3
p20208
as(dp20209
g18
V23354
p20210
stp20211
a((dp20212
g2
(lp20213
VThe two big areas are:
p20214
aVworking with COM assemblies where methods return vague types - so you can essentially use late binding
p20215
aVworking with DLR types
p20216
aVOther uses include things like:
p20217
aVduck-typing where there is no interface
p20218
aVSilverlight talking to the host page's DOM
p20219
aVtalking to an xml file
p20220
aVIn C# itself, this allows a few things, such as a basic approach to generic operators:
p20221
aV(of course, I'd argue that this is a better (more efficient) answer to this)
p20222
as(dp20223
g18
V23354
p20224
stp20225
a((dp20226
g2
(lp20227
VWith LINQ-to-SQL, the entities are largely unaware of the parent data-context - only lazy-loaded members like  know about this detail
p20228
aVYou can identify data-context aware entity-sets by looking at  (assuming it is deferred) - this will be true if a data-context is involved, and false otherwise - but there are further problems:
p20229
aVLINQ-to-SQL attaches the data-context (for deferred execution) after the constructur (and ) has executed
p20230
aVIf you add items manually in /, it breaks when LINQ-to-SQL attempts to attach the data-context
p20231
aVLINQ-to-SQL uses the default constructor, meaning that generics/ etc will also share this code
p20232
aVSo unfortunately; no, I don't think you can do this in  in any sensible way
p20233
aVYou could:
p20234
aVhave a second constructor for this use, that adds the extra items
p20235
aVuse a factory method, i
p20236
ag50
aVa static  method that builds items correctly
p20237
aV(since LINQ-to-SQL won't use either of the above itself)
p20238
as(dp20239
g18
V23354
p20240
stp20241
a((dp20242
g2
(lp20243
VConfirmed
p20244
aVLooks like a bug to me; you should log it on Connect
p20245
aVThe team are fixing LINQ-to-SQL bugs, so it might not be ignored
p20246
aVFor now, use  etc
p20247
aVSample code:
p20248
as(dp20249
g18
V23354
p20250
stp20251
a((dp20252
g2
(lp20253
VIt works fine for me; xml:
p20254
aVxslt:
p20255
aVResult:
p20256
as(dp20257
g18
V23354
p20258
stp20259
a((dp20260
g2
(lp20261
V is a value-type (), where-as string is a reference-type ( etc)
p20262
aVThat is the key difference
p20263
aVA reference can always be null; a value can't (unless it uses  - i
p20264
ag50
aV), although it can be zero'd (), which is often interpreted as the same thing as null (esp
p20265
aVin 1
p20266
aV1)
p20267
as(dp20268
g18
V23354
p20269
stp20270
a((dp20271
g2
(lp20272
VLike leppie, I'm not sure this is a good candidate for LINQ
p20273
aVYou could force it, of course, but that wouldn't be a useful example
p20274
aVA minor tweak would be to compare  against  to avoid some unnecessary strings - and maybe default the sb to  (or a small amount higher):
p20275
aVOther than that - I'd leave it alone;
p20276
as(dp20277
g18
V23354
p20278
stp20279
a((dp20280
g2
(lp20281
VYou can perhaps use generic to do this, for example:
p20282
aVOr if you mean "when you create the type" (in code), then no; you'd just have to remember, perhaps using unit-tests to verify that you've done it
p20283
aVI recommend using the typed  over  - it makes life a lot easier (and avoids some boxing, but that is less of an issue)
p20284
aVFinally, remember that you can use  and  in code if you want to duck-type the comparable bit (like how  works)
p20285
as(dp20286
g18
V23354
p20287
stp20288
a((dp20289
g2
(lp20290
VYou probably need to add a constructor that passes something to the base constructor; add:
p20291
aVwhen you type , intellisense should tell you what you need to give the base-constructor
p20292
aVedit from searching, you need:
p20293
as(dp20294
g18
V23354
p20295
stp20296
a((dp20297
g2
(lp20298
VWouldn't you just do that in the markup (style / css):
p20299
as(dp20300
g18
V23354
p20301
stp20302
a((dp20303
g2
(lp20304
VA property is not the implementation
p20305
aVFor example, you can't define fields
p20306
aVProperties and events are actually just special patterns of methods; with a property it is "get_" and "set_", and with an event "add_" and "remove_"
p20307
aVSo this is just a method
p20308
as(dp20309
g18
V23354
p20310
stp20311
a((dp20312
g2
(lp20313
VThe first thing with GC is that it is non-deterministic; if you want a resource cleaned up promptly, implement  and use ; that doesn't collect the managed memory, but can help a lot with unmanaged resources and onward chains
p20314
aVIn particular, things to watch out for:
p20315
aVlots of pinning (places a lot of restrictions on what the GC can do)
p20316
aVlots of finalizers (you don't usually need them; slows down GC)
p20317
aVstatic events - easy way to keep a lot of large object graphs alive ;-p
p20318
aVevents on an inexpensive long-life object, that can see an expensive object that should have been cleaned up
p20319
aVcaptured variables" accidentally keeping graphs alive
p20320
aVFor investigating memory leaks
p20321
aV"SOS" is one of the easiest routes; you can use SOS to find all instances of a type, and what can see it, etc
p20322
as(dp20323
g18
V23354
p20324
stp20325
a((dp20326
g2
(lp20327
VMy guess would be that it is still passing in an empty string for what you consider the null case
p20328
aVYou could rule this out by doing:
p20329
aVIf it starts working, it was passing in empty strings
p20330
as(dp20331
g18
V23354
p20332
stp20333
a((dp20334
g2
(lp20335
VIf isn't redundant, for the reason that the "" line could fail (throw an exception)
p20336
aVThat would mean that no  block is going to  the stream
p20337
aVIn reality, this is unlikely
p20338
aVbut it could
p20339
aVFor example, the stream might be non-readable (or whatever)
p20340
aVThus, it is always best to guard such initialization; far better to be disposed twice than not at all
p20341
aVPlus it makes it obvious to the reader (and any code analysis tools) that you have definitely cleaned up after yourself
p20342
as(dp20343
g18
V23354
p20344
stp20345
a((dp20346
g2
(lp20347
VEntity Framework is pluggable; there are meant to be a number of 3rd party Oracle providers for Oracle, such as dotConnect (tutorial)
p20348
aVAlternatively; DbLinq is a variant of LINQ-to-SQL/DataContext, and has Oracle support (plus is free)
p20349
as(dp20350
g18
V23354
p20351
stp20352
a((dp20353
g2
(lp20354
VI don't know if it will work (without testing), but you could try jQuery and height(); this (in theory) gives the computed height
p20355
aVWorth a try
p20356
as(dp20357
g18
V23354
p20358
stp20359
a((dp20360
g2
(lp20361
VSimply, you declare a type or method with extra tags to indicate the generic bits:
p20362
aVThe above defines a generic type  "of ", where the  is provided by the caller
p20363
aVBy convention, generic type arguments start with T
p20364
aVIf there is only one,  is fine - otherwise name them all usefully: , ,  etc
p20365
aVUnlike C++ templates,
p20366
aVNET generics are provided by the runtime (not compiler tricks)
p20367
aVFor example:
p20368
aVAll s have been replaced with  in the above
p20369
aVIf necessary, you can restrict generic arguments with constraints:
p20370
aVNow  will refuse to compile - as  is not a struct (value-type)
p20371
aVValid constraints are:
p20372
aVConstraints can also involve other generic type arguments, for example:
p20373
aVYou can have as many generic arguments as you need:
p20374
aVOther things to note:
p20375
aVstatic members etc are defined per generic type combination - so a static field on  is separate to that on
p20376
aVmethods can be generic too - try to avoid using the same names as the class uses, as you won't be able to disambiguate
p20377
aVnested types inherit the generic types from their parents
p20378
aVfor example:
p20379
as(dp20380
g18
V23354
p20381
stp20382
a((dp20383
g2
(lp20384
VIs that part of a query
p20385
aVor on its own
p20386
aVOutside of , you have:
p20387
aVThe branches can do anything, including use CTEs etc
p20388
aVInside a query, you have :
p20389
aVHowever, you can't do a CTE inside
p20390
as(dp20391
g18
V23354
p20392
stp20393
a((dp20394
g2
(lp20395
VSuch differences are usually because of ambiguity over which encoding the file uses
p20396
aVIf you want the file top parse correctly, you'll need to use the right encoding
p20397
aVWhat characters are causing problems
p20398
aVAlso - if the bytes aren't legal in the encoding used, all bets are off ;-p
p20399
aVYou can specify the encoding when creating (for example) a  over the file:
p20400
aVWith the base-64 posted, the problem is the  in the middle of the line
p20401
aVTo read this as a basic string, you could use:
p20402
aVor just:
p20403
aVHowever, you'll always have difficulty displaying this
p20404
aVYou can now  on your chosen line ending (crlf presumably)
p20405
aVis splitting on anything that looks like a line ending
p20406
as(dp20407
g18
V23354
p20408
stp20409
a((dp20410
g2
(lp20411
VThe syntax posted by "headsling" works
p20412
aVOddly, even though you can't use the original syntax with lambda (), you can with :
p20413
aVOf course, the real question is
p20414
aVwhy
p20415
aVWhat is wrong with
p20416
as(dp20417
g18
V23354
p20418
stp20419
a((dp20420
g2
(lp20421
VWell, first I'd leave connections to the repository
p20422
aVSecond, I wouldn't keep a connection hanging around on an object - I'd only use it for a unit of work (i
p20423
ag50
aVa single method)
p20424
aVThe chances are that (due to pooling) you'll get back the same physical connection anyway
p20425
aVThe system already goes a long way to handling such things so that you don't have to
p20426
aVThe trickier case is transactions, where  is a lot easier than passing a  db-transaction object around
p20427
as(dp20428
g18
V23354
p20429
stp20430
a((dp20431
g2
(lp20432
VNot tested, but something like
p20433
as(dp20434
g18
V23354
p20435
stp20436
a((dp20437
g2
(lp20438
VI'm not so sure that duplex is needed here
p20439
aVIMO, a standard async call with a callback should be more than sufficient to get notification of data delivery
p20440
aVWhat is the biggest problem
p20441
aVIf you are talking about async etc, then usually we are talking about the time taken to get the data to the client
p20442
aVIs this due to sheer data volume
p20443
aVor complexity generating the data at the server
p20444
aVIf it is the data volume, then I can think of a number of ways of significantly improving performance - although most of them involve using DTO objects (not /, which seemed to be implied in the question)
p20445
aVFor example, protobuf-net significantly reduces the data volume and processing required to transfer data
p20446
as(dp20447
g18
V23354
p20448
stp20449
a((dp20450
g2
(lp20451
VWell,  (or something wrapping a ) is fairly portable
p20452
aVmost anything else is going to be implementation specific
p20453
aVRe database vs file
p20454
aVfor the purposes of the client apps (Silverlight, WPF, etc) I would probably expose them via a web page rather than a WCF (etc) call - i
p20455
ag50
aVsome ASP
p20456
aVNET handler (or ASP
p20457
aVNET MVC route) that returns the image via an http call
p20458
aVThen all you actually need in the client is the path to the image ( or whatever)
p20459
aVFor storage - either is usually fine
p20460
aVin SQL Server 2008 you can do both at once with the file-stream type
p20461
aVOne of the problems with storing BLOBs in the database is increasing the size, but a few (small) images won't usually hurt (unless you are using SQL Express and have a capped db size)
p20462
aVBut using the database has the advantage that a single backup includes everything
p20463
aVSaying that, though: almost every implementation I've done like this has used files
p20464
as(dp20465
g18
V23354
p20466
stp20467
a((dp20468
g2
(lp20469
VIMO, one of the biggest factors here is that both java and
p20470
aVNET use intermediate languages; that means that the compiled unit (jar/assembly) contains, as a pre-requisite, a lot of expressive metadata about the types, methods, etc; meaning that it is already laid out conveniently for reference checking
p20471
aVThe runtime still checks anyway, in case you are pulling a fast one ;-p
p20472
aVThis isn't very far removed from the MIDL that underpins COM, although there the TLB is often a separate entity
p20473
aVIf I've misunderstood your meaning, please let me know
p20474
as(dp20475
g18
V23354
p20476
stp20477
a((dp20478
g2
(lp20479
VMath
p20480
aVRound - i
p20481
ag50
as(dp20482
g18
V23354
p20483
stp20484
a((dp20485
g2
(lp20486
VYou say it is running as an application - is is using the right ASP
p20487
aVNET version
p20488
aV(2
p20489
aVx)
p20490
aVRe debugging in IIS; you do that on the project properties - on the Web panel I believe; change it to "Use Local IIS Web Server" and enter the url to the application root on localhost
p20491
as(dp20492
g18
V23354
p20493
stp20494
a((dp20495
g2
(lp20496
VIf you want the data to be user-editable, it may not be suitable to use an enum
p20497
aVEnums are compile-time units, so will require a developer (or some hacky code generation)
p20498
aVInstead, consider using a database table for this data, pre-populated with your items (and perhaps with a "System" column to control which ones are user-defined vs required by the system)
p20499
aVThen changes are just inserts (etc) to the table
p20500
aVYou can, of course, use any other storage mechanism - for example, a delimited string in a config file - but I'm guessing you'll want a database somewhere in the system
p20501
as(dp20502
g18
V23354
p20503
stp20504
a((dp20505
g2
(lp20506
VI wonder if it isn't a different "this" at that point
p20507
aVTry using a capture:
p20508
as(dp20509
g18
V23354
p20510
stp20511
a((dp20512
g2
(lp20513
VHaving done this, IMO the easiest thing is to just start afresh
p20514
aVIt doesn't take long to copy over a few
p20515
aVcs files and add a few references etc
p20516
aVIf you really want you could do a comparison on the csproj; the obvious changes are the , , ,  and
p20517
aVand probably many of the references
p20518
aVhmmm - yes, just start afresh; it'll be safer
p20519
aVIf you need to support multiple frameworks, you can cheat (to avoid having to maintain 2+ project files) - I do this in protobuf-net - by including:
p20520
aVWhich says "compile all the
p20521
aVcs files at any level under the
p20522
aV\u005cprotobuf-net path"
p20523
as(dp20524
g18
V23354
p20525
stp20526
a((dp20527
g2
(lp20528
VHow about code generation
p20529
aVI use this in protobuf-net to create the
p20530
aVcs files from a
p20531
aVproto model (exported as xml) - like so
p20532
aVIn
p20533
aVNET 4
p20534
aV0, T4 templates would be a more obvious choice, but the T4 engine isn't standalone (AFAIK) before then
p20535
aVXslt is also used extensively to transform between different xml layouts - for example, in middleware tools like biztalk
p20536
as(dp20537
g18
V23354
p20538
stp20539
a((dp20540
g2
(lp20541
VFor LINQ to SQL, EF, etc, it probably won't matter - it is entirely possible that the TSQL translation will make it identical anyway
p20542
aVOf course, you can profile to be sure ;-p
p20543
aVBut for LINQ-to-Objects (which is very literal) it will
p20544
aVYou can improve this by using :
p20545
as(dp20546
g18
V23354
p20547
stp20548
a((dp20549
g2
(lp20550
VWel, FtpWebRequest supports SSL via EnableSsl (using "") - is that sufficient
p20551
as(dp20552
g18
V23354
p20553
stp20554
a((dp20555
g2
(lp20556
VThe biggest problem I can see is
p20557
aVwhy would it ever exit
p20558
aVYou do a , so obviously expect it to terminate, but is is just
p20559
aVI would have a (volatile) bool field somewhere (on the ) that gets set/cleared and used in the  - for example:
p20560
aVor similar (set it to  before calling  to exit)
p20561
aVI also don't see much point in keeping the reference to  (just initialize and start it in one method), and the exception swallowing is probably a bad idea
p20562
as(dp20563
g18
V23354
p20564
stp20565
a((dp20566
g2
(lp20567
VThe easiest way would be to enable xml comment generation (project properties -> build), and parse the xml file
p20568
as(dp20569
g18
V23354
p20570
stp20571
a((dp20572
g2
(lp20573
VIt sounds like the type of thing you see if the app-root isn't an application, or if the application isn't handling virtual directories correctly
p20574
aVWith virtuals; for example, you should rarely use "/foo/bar" - because if your app isn't installed at the site root you'll get unexpected behaviour - you mean "~/foo/bar", but this often needs extra code, as discussed here
p20575
as(dp20576
g18
V23354
p20577
stp20578
a((dp20579
g2
(lp20580
VThe biggest one would be using existing 3rd party controls on your form
p20581
aVMost of the inbuilt controls are pretty easy to reproduce, but if you have a pet 3rd party control, you might have to host that on a regular (non-MVC) aspx page (luckliy this is supported)
p20582
aVLikewise, "web parts"
p20583
aVAlso - the feature where ASP
p20584
aVNET uses different html for different clients (mobile, etc) becomes
p20585
aVdifferent; you wouldn't want to do this by hand, but in reality most clients now work with standard html, so it is less of an issue in the first place
p20586
aVSome things like i18n via resx files need extra work than is in the vanilla MVC template, but the samples are there on the internet
p20587
aVOne point
p20588
aVMVC is licensed only for MS/ASP
p20589
aVNET; so one thing you can't do (without violating the terms, as I understand it) is to run it in mono/Apache - but IANAL
p20590
aVNow consider the things you can do with MVC, that you can't (or are hard) with vanilla:
p20591
aVroutes instead of pages
p20592
aVautomated input resolution (action arguments)
p20593
aVproper html control
p20594
aVenabling jQuery etc for simple AJAX
p20595
aVseparation of concerns
p20596
aVtestability
p20597
aVIoC/DI
p20598
aVmultiple templating options (not just aspx/ascx)
p20599
aVre input resolution:
p20600
aVwill pick "name", "page" and "pageSize" off (any of) the route, query-string or form - so you don't have to spend lots of time picking out request values
p20601
aVre templates - aspx/ascx aren't the only templating options
p20602
aVFor example, see here; or you can write your own if you like
p20603
aVThe view is not tied to ASP
p20604
aVNET controls at all
p20605
as(dp20606
g18
V23354
p20607
stp20608
a((dp20609
g2
(lp20610
VIt depends a little bit on the context, I believe
p20611
aVIn most cases, I expect you'd have to query "", enumerate over the items, and call "" - but it may work in some tests
p20612
aVRe the edit - you can do:
p20613
aVto find attributes matching your criteria, and:
p20614
aVto display the output
p20615
aVI don't think you can do both at once, though
p20616
aVWhat is the context here
p20617
aVxslt
p20618
aVwhat
p20619
as(dp20620
g18
V23354
p20621
stp20622
a((dp20623
g2
(lp20624
VIt sounds like the server isn't configured correctly
p20625
aVdo you get anything when you visit the asmx page
p20626
aVIt is hard  to diagnose without more
p20627
aVthe most common problems are:
p20628
aVapp root not set as an application (cog icon) in IIS
p20629
aVnot using the correct version of ASP
p20630
aVNET (again configured in IIS)
p20631
aVapp-pool identity not having access either to the code files or the database/whatever (usually causes a "500" error), or not able to run as a service, or not in the IIS_WPG group
p20632
aVThings like load balancers and firewalls can also add complexity, but this isn't usually the biggest problem
p20633
aVFinally - for use with jQuery, you might also consider (for the next project) returning JSON from an ASP
p20634
aVNET MVC route - it will make things a lot simpler than using asmx
p20635
as(dp20636
g18
V23354
p20637
stp20638
a((dp20639
g2
(lp20640
VYou need to push the work back onto the UI; luckily, it is easy:
p20641
aVThis uses the "anonymous method" and "captured variables" features of C# to do all the heavy lifting
p20642
aVIn
p20643
aVNET 3
p20644
aV5, you may prefer to use , but that makes no real difference:
p20645
as(dp20646
g18
V23354
p20647
stp20648
a((dp20649
g2
(lp20650
VYou can do this by editing the csproj file; add a "Condition" attribute to the reference
p20651
aVHowever, I would have concerns about what this means for unit testing
p20652
as(dp20653
g18
V23354
p20654
stp20655
a((dp20656
g2
(lp20657
VIt sounds like the item wasn't found, so  was null; try using:
p20658
aVI believe this handles the null case (altenatively, test for null first)
p20659
aVI'd also be tempted to look in the underlying list:
p20660
aVFor example:
p20661
as(dp20662
g18
V23354
p20663
stp20664
a((dp20665
g2
(lp20666
VThe problem is that you pass the value of  - which (before ) is
p20667
aVUpdates to  within  do not affect the async state
p20668
as(dp20669
g18
V23354
p20670
stp20671
a((dp20672
g2
(lp20673
VThe code-behind is specific for the individual page
p20674
aVMessing with it will break the aspx model (see the "inherits" or similar at the top of the aspx page)
p20675
aVEach aspx page (in regular ASP
p20676
aVNET) should have a separate class
p20677
aVIn ASP
p20678
aVNET MVC, note that a single controller class is commonly associated with multiple related views (and that the aspx/ascx don't tend to have code-behind in MVC)
p20679
as(dp20680
g18
V23354
p20681
stp20682
a((dp20683
g2
(lp20684
VWell, you could use one of the report frameworks (Crystal, MS RDL, etc) and export as html - however, I suspect that for simple data your current approach is less overhead
p20685
aVI might use an  or LINQ-to-XML (rather than , which won't handle escaping)
p20686
aVetc
p20687
aVEscaping is especially important for text values (name, description, etc)
p20688
as(dp20689
g18
V23354
p20690
stp20691
a((dp20692
g2
(lp20693
V is a LINQ extension that produces a new sequence
p20694
aVTo order the existing sequence you need to add an extension method or two
p20695
aVthen you can use:
p20696
as(dp20697
g18
V23354
p20698
stp20699
a((dp20700
g2
(lp20701
VHow about:
p20702
as(dp20703
g18
V23354
p20704
stp20705
a((dp20706
g2
(lp20707
V(edit: I decided to write this up as a blog entry, as I've seen it be useful a number of times)
p20708
aVI've had users before use protobuf-net for this; this uses Google's dense binary "protocol buffers" wire format, which doesn't include any names on the wire - just numbers
p20709
aVThis means that:
p20710
aVthe names are not exposed on the wire
p20711
aVit doesn't matter whether the name in the class at runtime is "DateOfBirth" or "a1v"
p20712
aVThis works by assigning an integer tag to members (properties or fields) - for example:
p20713
aVOnly the "4" is used in the serialization, but (importantly) you don't need to maintain lots of serialization code
p20714
aVCan also be hooked into  very easily if you need to use remoting, and also has a WCF hook if you want
p20715
aVDisclosure: I'm the author, so I'm biased - but the tool is free, so you don't lose anything by having a look ;-p
p20716
as(dp20717
g18
V23354
p20718
stp20719
a((dp20720
g2
(lp20721
VThis is actually an example I use in my "Express Yourself" presentation, for something that is hard to do in regular LINQ; As far as I know, the easiest way to do this is by writing the predicate manually
p20722
aVI use the example below (note it would work equally for  etc):
p20723
as(dp20724
g18
V23354
p20725
stp20726
a((dp20727
g2
(lp20728
VAssuming you don't want to use strings, the most common answer is via an  - essentially emulating the missing ; you would have to use something like:
p20729
aVAssuming they are all properties/fields (edit added method-call support):
p20730
as(dp20731
g18
V23354
p20732
stp20733
a((dp20734
g2
(lp20735
VWith VB, can't you imply a signature, rather than stating a delegate type
p20736
aVI'm not sure it is a good thing, but
p20737
aVAlso - doesn't  handle nulls (non-subscribed events) automatically
p20738
aVTrivial to do, of course
p20739
as(dp20740
g18
V23354
p20741
stp20742
a((dp20743
g2
(lp20744
VIgnoring the build errors (which I'm putting down to typos) - what warning would you expect or want
p20745
aVIt is finding a matching overload and using it
p20746
aVStrictly speaking, I can call different overloads - by passing arrays, but yes, the usage isn't entirely clear
p20747
aVWithout the multiple overloads with , this pattern is used quite heavily in things like  etc (which underpins  for strings under the bonnet)
p20748
as(dp20749
g18
V23354
p20750
stp20751
a((dp20752
g2
(lp20753
VNot quite - since each "left" row in a left-outer-join will match 0-n "right" rows (in the second table), where-as yours matches only 0-1
p20754
aVTo do a left outer join, you need  and , for example:
p20755
aV(or via the extension methods)
p20756
as(dp20757
g18
V23354
p20758
stp20759
a((dp20760
g2
(lp20761
VYou can add your own
p20762
aVtools -> options -> environment -> keyboard
p20763
aVLook in particular for:
p20764
aVFile
p20765
aVGetLatestVersion
p20766
aVFile
p20767
aVGetLatestSolutionFiles
p20768
aVFile
p20769
aVCheckIn
p20770
aVand add a new shortcut at the bottom
p20771
as(dp20772
g18
V23354
p20773
stp20774
a((dp20775
g2
(lp20776
VYou want the OUTPUT clause
p20777
as(dp20778
g18
V23354
p20779
stp20780
a((dp20781
g2
(lp20782
VLike so:
p20783
as(dp20784
g18
V23354
p20785
stp20786
a((dp20787
g2
(lp20788
VThen presumably you'll need to lift them to the non-nullable form, using , and perhaps change a few  values to
p20789
aVChange the assignment to be:
p20790
aVand when adding the columns to be:
p20791
aVAnd it works
p20792
aV( is the null-coalescing operator; it uses the first operand if it is non-null, else the second operand is evaluated and used)
p20793
as(dp20794
g18
V23354
p20795
stp20796
a((dp20797
g2
(lp20798
VThis is a standard interface conversion; as a requirement, arrays () implement  and
p20799
aVSo a  is 100% compatible with
p20800
aVThe implementation is provided by the compiler (arrays were basically generic before
p20801
aVNET generics existed)
p20802
aVFrom the spec (ECMA 334 v4) - this is a consequence of 13
p20803
ag733
aV4:
p20804
aVFrom a one-dimensional array-type  to  and base
p20805
aVinterfaces of this interface
p20806
aVFrom a one-dimensional array-type  to  and base interfaces of this interface, provided there is an implicit reference conversion from  to
p20807
aVAnd recall that
p20808
as(dp20809
g18
V23354
p20810
stp20811
a((dp20812
g2
(lp20813
VThat is a cast; if  returns , , or anything like that - it does the type-check to
p20814
aVIf you have compiling C# code - can you use reflector to do the translation
p20815
aVThis shows you C# and equivalent VB at a flip of a drop-down
p20816
aVI'm not sure what the  is doing; that didn't exist in the C# - why did you add it to the VB
p20817
aVedit I don't "do" VB, but I looked it up in reflector;  becomes
p20818
as(dp20819
g18
V23354
p20820
stp20821
a((dp20822
g2
(lp20823
VIf you mean :
p20824
aVbeing based on fields, is very version intolerant; change private implementation details and it breaks (even just changing it to an automatically implemented property)
p20825
aVisn't cross-compatible with other platforms
p20826
aVisn't very friendly towards new fields
p20827
aVis assembly specific (metadata is burnt in)
p20828
aVis MS/
p20829
aVNET specific (and possibly
p20830
aVNET version specific)
p20831
aVisn't obfuscation-safe
p20832
aVisn't especially fast, or small output
p20833
aVdoesn't work on light frameworks (CF
p20834
aV/Silverlight)
p20835
aVhas a depressing habit of pulling in things you didn't expect (usually via s)
p20836
aVI've spent lots of time in this area, including writing a (free) implementation of Google's "protocol buffers" serialization API for
p20837
aVNET; protobuf-net
p20838
aVThis is:
p20839
aVsmaller output and faster
p20840
aVcross-compatible with other implementations
p20841
aVextensible
p20842
aVcontract-based
p20843
aVobfuscation safe
p20844
aVassembly independent
p20845
aVis an open documented standard
p20846
aVworks on all versions of
p20847
aVNET (caveat: not tested on Micro Framework)
p20848
aVhas hooks to plug into  (for remoting etc) and WCF
p20849
as(dp20850
g18
V23354
p20851
stp20852
a((dp20853
g2
(lp20854
VThoughts (based on pain in the past):
p20855
aVdo you have DNS and line-of-sight to the server
p20856
aVare you using the correct name from the certificate
p20857
aVis the certificate still valid
p20858
aVis a badly configured load balancer messing things up
p20859
aVdoes the new server machine have the clock set correctly (i
p20860
ag50
aVso that the UTC time is correct [ignore local time, it is largely irrelevent]) - this certainly matters for WCF, so may impact regular SOAP
p20861
aVis there a certificate trust chain issue
p20862
aVif you browse from the server to the soap service, can you get SSL
p20863
aVis the server's machine-level proxy set correctly
p20864
aV(which different to the user's proxy); see proxycfg for XP / 2003 (not sure about Vista etc)
p20865
as(dp20866
g18
V23354
p20867
stp20868
a((dp20869
g2
(lp20870
VIf you don't mind the slashes being switched, you could [ab]use :
p20871
aVAs a function/method:
p20872
aVApologies Marc for adding this
p20873
aVI prefer encapsulated examples, and this may save others some typing (your example was excellent so no point adding another answer based on it) - HiTech Magic :)
p20874
as(dp20875
g18
V23354
p20876
stp20877
a((dp20878
g2
(lp20879
VObjects referenced by static fields are not simply finalized unless you clear (set to ) the field - and even then it is non-deterministic and not guaranteed
p20880
aVStatic fields count as root objects
p20881
aVWhen (and why) would you expect this to be collected/finalized
p20882
aVIt is still accessible
p20883
as(dp20884
g18
V23354
p20885
stp20886
a((dp20887
g2
(lp20888
VAs an aside; if you don't want to have to deploy the full framework; with 3
p20889
aV5 SP1 there is the Client Profile - this is quite a bit smaller than the "full" 3
p20890
aV5 SP1, but omits a range of (usually-server-side) things like web and DAL classes
p20891
aVIMO, it is easier to support the full framework, simply because it removes an extra variable
p20892
aVAnother option would be to develop the app as Silverlight; it may be too late for this, but Silverlight provides a very small client footprint (and easy install)
p20893
aVThere are some programs that bootstrap the runtime into your code, but I don't recommend them
p20894
as(dp20895
g18
V23354
p20896
stp20897
a((dp20898
g2
(lp20899
VWell first - not all callers have to use the same repository API; this is especially true of an external company
p20900
aVWCF is interface based
p20901
aVThis means that if you need to re-use some logic code, it is possible to use IoC/DI to inject WCF rather than a DAL (but using the same interface) - by using assembly sharing
p20902
aVIt sounds like this is what you are doing
p20903
aVThis works in many cases, but not all; fundamentally web-service based APIs often need to be designed differently in order to be optimal
p20904
aVIt also isn't 100% pure from an SOA viewpoint, but it gets the job done, and allows more intelligent domain entities, so in an intranet (etc) scenario it is (IMO) perfectly reasonable
p20905
aVAn external caller would typically just use the wsdl/mex-based APIs (rather than assembly sharing), but anything is possible
p20906
as(dp20907
g18
V23354
p20908
stp20909
a((dp20910
g2
(lp20911
V"You" ;-p
p20912
aVCallbacks are still executed on the worker thread; they provide the data back to the calling code - but they don't have an inbuilt way of interrupting the calling thread
p20913
aVIt is your code's responsibility to push that work back to the main thread if necessary
p20914
aVFor example, in a winforms app you might have:
p20915
as(dp20916
g18
V23354
p20917
stp20918
a((dp20919
g2
(lp20920
V may be your best bet:
p20921
aVThis will often work with  values - beyond that
p20922
aVhit'n'miss
p20923
aVThere is also:
p20924
aVwhich works differently; try both ;-p
p20925
as(dp20926
g18
V23354
p20927
stp20928
a((dp20929
g2
(lp20930
VYou are fighting the system
p20931
aV2 thoughts:
p20932
aVif you know you need the other data (nested ), why wouldn't you want to use
p20933
aVThat is pretty-much the text-book use case
p20934
aVsince you (from post) know that object tracking is required for lazy loading, why not just enable object tracking; data-contexts should usually be considered "units of work" (i
p20935
ag50
aVshort-lived), so this isn't likely to hurt much in reality
p20936
aVSee the official replies here for why these two options (object tracking and deferred loading) are linked
p20937
as(dp20938
g18
V23354
p20939
stp20940
a((dp20941
g2
(lp20942
VWell, for the first - attributes ( being the most important for your question); some useful ones here:
p20943
aVNot sure about the second question
p20944
as(dp20945
g18
V23354
p20946
stp20947
a((dp20948
g2
(lp20949
VIt seems like you are worried about making the temporary password stronger than the user's password
p20950
aVwhen in reality, something like a 10-character base-64 (or similar - punctuation etc) is going to be very hard to crack and much stronger than the password the user will generate
p20951
as(dp20952
g18
V23354
p20953
stp20954
a((dp20955
g2
(lp20956
VThe HTML Agility Pack is highly rated
p20957
aVIt will certainly do the parsing / best guess etc
p20958
aVThe model is intentially similar to XmlDocument, including SelectNodes etc for querying
p20959
aVIf you need xhtml output, there is a  flag; I assume that setting this to true and calling  results in xhtml
p20960
as(dp20961
g18
V23354
p20962
stp20963
a((dp20964
g2
(lp20965
VIndeed,  should be avoided
p20966
aVIt would be best to give them some time to exit gracefully - then perhaps after a timeout, maybe consider aborting them - but ultimately, service stop can do that just the same by killing the process instead
p20967
aVI would try to have a signal in my queues that says "flush and exit" - much like the  method here, but with some kind of signal when complete
p20968
aVIf you resort to  - consider the process fatally wounded
p20969
aVKill it ASAP
p20970
as(dp20971
g18
V23354
p20972
stp20973
a((dp20974
g2
(lp20975
VWhat is the configuration like
p20976
aVI wonder if it is trying to do some kind of connect (security, etc) to the server
p20977
aVYou might also try a network trace (wireshark etc) during this period
p20978
as(dp20979
g18
V23354
p20980
stp20981
a((dp20982
g2
(lp20983
VYou ask for three different things:
p20984
aVquickest
p20985
aVeasiest
p20986
aVbest
p20987
aVthey are not the same
p20988
aVThe quickest (at execution) would be compiled code; i
p20989
ag50
aVyou write regular C# to set the properties correctly
p20990
aVEasier than this is using reflection - but that is slow
p20991
aVYou'd also need some mechanism for mapping child properties
p20992
aV(and also mapping regular properties if there isn't a 1:1 correspondance between the reader)
p20993
aVThis is perhaps best solved with custom attributes on members (properties/fields)
p20994
aVAs a compromise on speed (over reflection), you can use Delegate
p20995
aVCreateDelegate to get at the property setters - but that is a lot of work
p20996
aVPerhaps another option is HyperDescriptor; this allows reflection-like access, but is vastly faster
p20997
aVBest
p20998
aVProbably to use existing code - i
p20999
ag50
aVan ORM tool; less to write and debug
p21000
as(dp21001
g18
V23354
p21002
stp21003
a((dp21004
g2
(lp21005
VWhat type of project is it
p21006
aVIn many cases, ClickOnce can do the job for you, at nominal effort
p21007
aVBeyond that - you can usually hook your installer build into your build process; some tools will do this for you
p21008
aVInstaller classes run at the client - so I don't think they relate to your build process
p21009
as(dp21010
g18
V23354
p21011
stp21012
a((dp21013
g2
(lp21014
V is not used by the compiler, and (perhaps confusingly) it doesn't set the initial value
p21015
aVYou need to do this your self in the constructor
p21016
aVPlaces that do use  include:
p21017
aV- provides  (used by  etc)
p21018
aV/  / etc (serialization frameworks) - for deciding whether it needs to be included
p21019
aVInstead, add a constructor:
p21020
aV(if it is a  with a custom constructor, you need to call  first)
p21021
as(dp21022
g18
V23354
p21023
stp21024
a((dp21025
g2
(lp21026
VPEX might be a good start - it will attempt to brute-force its way into every code branch; but ultimately, only you know what it is meant to do
p21027
aVYou should be writing unit tests as you go, perhaps with NUnit and TestDriven
p21028
aVNET
p21029
as(dp21030
g18
V23354
p21031
stp21032
a((dp21033
g2
(lp21034
VLike so (the "select" is just the way of specifying the query; with the abbreviated attribute syntax ("") you just specify the query directly)
p21035
aVOr alternatively:
p21036
as(dp21037
g18
V23354
p21038
stp21039
a((dp21040
g2
(lp21041
VThat is not a kludge
p21042
aVThat is the correct way of doing it; what happens with the BackgroundWorker approach
p21043
aVThe trick is to use the  method to push the change back to the UI (don't update the  from the worker)
p21044
as(dp21045
g18
V23354
p21046
stp21047
a((dp21048
g2
(lp21049
VWell, if (comments) you are just after code samples - the public API for protobuf-net has a reasonable amount of documentation comments:
p21050
aVenum
p21051
aVinterface
p21052
aVclass
p21053
aVdelegate (although with 3
p21054
aV5 you should use /
p21055
aVattribute
p21056
aVIt is unusual to write s, and due to the nature of protobuf-net doesn't use many events - but you get the idea
p21057
aVThese are (of course) shipped in an xml file alongside the dll to provide intellisense
p21058
aVI could run sandcastle against it - I just haven't felt the need
p21059
as(dp21060
g18
V23354
p21061
stp21062
a((dp21063
g2
(lp21064
VFirst - if you want "database like" access over WCF, then ADO
p21065
aVNET Data Services is a far better option
p21066
aVBut no; you can't serialize an SqlParameter over WCF; you would need to encapsulate it in some other representation
p21067
aVNote that IMO it is quite dangerous to expose your database logic so close to the WCF boundary - I'd just have WCF methods that abstract this - i
p21068
ag50
aVThen you have a tightly controlled service interface
p21069
as(dp21070
g18
V23354
p21071
stp21072
a((dp21073
g2
(lp21074
VWell,  - but that has to move everything
p21075
aVIf you need to be able to insert at the start efficiently, consider a  or a
p21076
as(dp21077
g18
V23354
p21078
stp21079
a((dp21080
g2
(lp21081
VThere is only one occasion that a constructor can return null [ on a ] - so the calling code doesn't need to check
p21082
aVThe callee probably should check; throwing an  if it was null
p21083
aVIn
p21084
aVNET 4
p21085
aV0 this will be better served by code contracts
p21086
aVBut not yet ;-p
p21087
as(dp21088
g18
V23354
p21089
stp21090
a((dp21091
g2
(lp21092
VWell, you can do the projection first:
p21093
aVOr in query syntax:
p21094
aVThat do
p21095
as(dp21096
g18
V23354
p21097
stp21098
a((dp21099
g2
(lp21100
V has a property - ; assign this your categories:
p21101
aVAnd (hopefully) it should work
p21102
as(dp21103
g18
V23354
p21104
stp21105
a((dp21106
g2
(lp21107
VIn the sub-query vs simple (non-recursive) CTE versions, they are probably very similar
p21108
aVYou would have to use the profiler and actual execution plan to spot any differences, and that would be specific to your setup (so we can't tell you the answer in full)
p21109
aVIn general; A CTE can be used recursively; a sub-query cannot
p21110
aVThis makes them especially well suited to tree structures
p21111
as(dp21112
g18
V23354
p21113
stp21114
a((dp21115
g2
(lp21116
VThat will indeed not be thread safe
p21117
aVYou could marshal bits of the searching code to the UI thread, but that will slow things down, and perhaps defeat the point of the threading
p21118
aVHow fast does the search need to be
p21119
aVCan you work against a clone
p21120
aVetc
p21121
as(dp21122
g18
V23354
p21123
stp21124
a((dp21125
g2
(lp21126
VIMO, this will make things very complex very quickly, and it'll mean you end up writing a lot of reflection code
p21127
aVCan you wait for C# 4
p21128
ag190
aV;-p
p21129
aVAlternatively, your code could just ignore things it doesn't know how to handle
p21130
as(dp21131
g18
V23354
p21132
stp21133
a((dp21134
g2
(lp21135
VYou can't
p21136
aVThere is nothing to do the logging
p21137
aVThe best you can do is an external monitor program, but that can't really tell much about what happened unless you litter your code with "twitter"-style logging; "I'm not attempting to contact the database", "I contacted the database", "I'm sending a query",
p21138
as(dp21139
g18
V23354
p21140
stp21141
a((dp21142
g2
(lp21143
VI don't know about , but you can do it with :
p21144
as(dp21145
g18
V23354
p21146
stp21147
a((dp21148
g2
(lp21149
V is not particularly slow, especially if there is an index on that column
p21150
aVIn particular, if you have a clustered index on that column, the data is already sorted
p21151
aVYou can also use paging ( or ) etc to help
p21152
as(dp21153
g18
V23354
p21154
stp21155
a((dp21156
g2
(lp21157
VThe tags say
p21158
aVNET 2
p21159
aV0; If you are using C# 3
p21160
aV0 (i
p21161
ag50
aVVS 2008) and targetting
p21162
aVNET 2
p21163
aV0, you can do this by declaring the ExtensionAttribute - or (easier) just reference LINQBridge
p21164
aVWith this in place, extension methods will work in
p21165
aVNET 2
p21166
aV0 with C# 3
p21167
ag190
as(dp21168
g18
V23354
p21169
stp21170
a((dp21171
g2
(lp21172
VThere is no inbuilt way of doing this, AFAIK
p21173
aVYou could code every common case manually, but I don't recommend it
p21174
aV(edit) One pragmatic option might be  - test the format as early as possible when the user enters it
p21175
as(dp21176
g18
V23354
p21177
stp21178
a((dp21179
g2
(lp21180
VThere are so many factors here:
p21181
aVare you actually using the cores
p21182
aVare your extra threads causing locking issues to be more obvious
p21183
aVdo you not have enough memory to support all the extra stacks / data you can process
p21184
aVcan your IO (disk/network/database) stack keep up with the throughput
p21185
aVetc
p21186
as(dp21187
g18
V23354
p21188
stp21189
a((dp21190
g2
(lp21191
VIn management studio; find the database, right-click, tasks, generate scripts;
p21192
aVnext-next-next until you "Choose Object Types"
p21193
aVSelect "Stored procedures" and "User-defined functions", next, Select All; choose an output; go
p21194
as(dp21195
g18
V23354
p21196
stp21197
a((dp21198
g2
(lp21199
VSOS can do this for you
p21200
aVIt isn't integrated into the debugger, but you can attach it to your running process
p21201
aVYou may find it helpful to use SOSAssist, rather than learning the console syntax
p21202
aVIIRC:
p21203
as(dp21204
g18
V23354
p21205
stp21206
a((dp21207
g2
(lp21208
VIn VS2008: Add new item; application manifest file (app
p21209
aVmanifest; the comments in the template file tell you how to demand more access)
p21210
aVYou can now specify the manifest in project properties on the Application tab (but you need to uncheck "Enable the Visual Studio hosting process" to debug it)
p21211
as(dp21212
g18
V23354
p21213
stp21214
a((dp21215
g2
(lp21216
VDuplicating is not the answer
p21217
aVCan Assembly B possibly reference Assembly A and consume the interface (or whatever) from there
p21218
aVIf not, declare the interface (or whatever) in a standalone dll that both Assembly A and Assembly B reference
p21219
aVThen there is only 1 version of the interface, and everything works
p21220
as(dp21221
g18
V23354
p21222
stp21223
a((dp21224
g2
(lp21225
VWhat exactly is it you want to do
p21226
aVFor most purposes, you just add a  and set values against controls
p21227
aVSome controls provide their own tool-tip (and mechanism to set the text)
p21228
aVre the comment; then just something like:
p21229
aV(where  could be the form, "", or any control)
p21230
as(dp21231
g18
V23354
p21232
stp21233
a((dp21234
g2
(lp21235
VYou could perhaps use this in a UDF:
p21236
as(dp21237
g18
V23354
p21238
stp21239
a((dp21240
g2
(lp21241
VYou can't create "full" methods (discoverable via reflection) - however, you can use  to associate new IL blocks with a type (primarily for scope etc)
p21242
aVBut ultimately, what you describe is a job for the DLR in 4
p21243
aV0 (and a language such as Iron Python; C# and VB don't add language support for declaring dynamic methods - only consuming them)
p21244
as(dp21245
g18
V23354
p21246
stp21247
a((dp21248
g2
(lp21249
VJust an idea, but have you tried it with a final "/"
p21250
aVAlso - you might find this approach easier:
p21251
as(dp21252
g18
V23354
p21253
stp21254
a((dp21255
g2
(lp21256
VI was being slow; the problem is (I think) the joins; do you have navigation properties
p21257
aVYou should be able to use something like
p21258
aVetc - or (worst case) use the LINQ  syntax
p21259
aVI think that will work significantly better than the composite ; like so:
p21260
aVoriginal:
p21261
aVThe first thing to do is to get the generated query; you can assign  before running the query, which will push the TSQL to the console (or you can use any other )
p21262
aVI'd be very interested to see what it is generating
p21263
aVYou can then test this TSQL at the database (management studio) to see what it is getting so horribly wrong
p21264
aVAt worst case, you could write a UDF to do the search (with fixed TSQL), and call that from LINQ-to-SQL
p21265
aVCan you post the TSQL please
p21266
as(dp21267
g18
V23354
p21268
stp21269
a((dp21270
g2
(lp21271
VLargely yes, as long as you don't ever reset it or insert rows with bulk copy, or use
p21272
aVAnd of course assuming that you don't overflow the data-type (which could be impressive)
p21273
as(dp21274
g18
V23354
p21275
stp21276
a((dp21277
g2
(lp21278
VIf I understand it correctly, it sounds like your tool is trying to tell you to only update  once:
p21279
as(dp21280
g18
V23354
p21281
stp21282
a((dp21283
g2
(lp21284
VMainly, converting between test frameworks is a "[Ctrl]+H" (replace all) job
p21285
aVHowever
p21286
aVI think the word "upgrade" may be confusing
p21287
aVI've used both, and in many ways NUnit has a lead on MSTest
p21288
aVThe biggest advantage of MSTest is (IMO) with the team-coverage integration in the IDE - but you can get this with your existing NUnit tests via TestDriven
p21289
aVNET (Test With -> Team Coverage)
p21290
aVThings to watch out for with MSTest:
p21291
aVit needs a solution file to hold the testrunconfig etc
p21292
aVyou need to add extra attributes (or entries in the testrunconfig) to deploy files to the test folder (it doesn't just use the output "bin" folder)
p21293
aVinstrumentation needs a special config
p21294
as(dp21295
g18
V23354
p21296
stp21297
a((dp21298
g2
(lp21299
VIt is telling you the CLR version, which is still 2
p21300
aV0x; it jumps to 4
p21301
aV0x in
p21302
aVNET 4
p21303
aV0 - but until then, all of
p21304
aVNET 2
p21305
aV0,
p21306
aVNET 3
p21307
aV0 and
p21308
aVNET 3
p21309
aV5 share a CLR version (give-or-take the small numbers ;-p)
p21310
as(dp21311
g18
V23354
p21312
stp21313
a((dp21314
g2
(lp21315
V is not the same as the node you clicked on, and may be null
p21316
aVChange to use  instead
p21317
aVAnd I'm paranoid; I'd probably still check that  isn't  first
p21318
as(dp21319
g18
V23354
p21320
stp21321
a((dp21322
g2
(lp21323
VEF, at least in the current version, doesn't support this
p21324
aVThere isn't a mechanism to create the database; likewise, when you resync, it updates the model from the database
p21325
aVPerhaps use "data dude" (VS2008 Database Edition) to make your changes at the database
p21326
as(dp21327
g18
V23354
p21328
stp21329
a((dp21330
g2
(lp21331
VWhat is the framework here
p21332
aVwinform
p21333
aVWPF
p21334
aVIn winform (for a click event), you are on the UI thread
p21335
aVSo you can just talk to the UI from the click event
p21336
aVIf something else is happening, then there is something wrong
p21337
aVAre you sure you aren't in a timer-callback
p21338
aVIn the more general sense, you can use / etc to pass control to the UI thread
p21339
as(dp21340
g18
V23354
p21341
stp21342
a((dp21343
g2
(lp21344
V15MB shouldn't give you an OOM
p21345
aVIf the data is tree-like (rather than a full graph), you might consider a serializer like protobuf-net; as well as using Google's very efficient (both speed and memory) binary "protocol buffers" format, it benefits from not having to do reference tracking (required for graphs) - which means it only has to worry about data once (twice if it has to get buffered)
p21346
aVHowever, this requires different markup to your classes (or at least, an "opt in") - and it won't handle full graphs
p21347
aVBut it is there, and free
p21348
as(dp21349
g18
V23354
p21350
stp21351
a((dp21352
g2
(lp21353
VFrom the word "tables", it sounds like you are getting this data from a database
p21354
aVIn which case; no: you can't do this
p21355
aVThe closest you can do would to select the objects and the extra columns, and update the properties afterwards:
p21356
aVIf you were doing LINQ-to-Objects, there are perhaps some hacky ways you could do it with fluent APIs - not pretty, though
p21357
aV(edit - like this other reply)
p21358
as(dp21359
g18
V23354
p21360
stp21361
a((dp21362
g2
(lp21363
VI do a lot of work with , so I'm looking forward to the extra expression types
p21364
aVI also like optional/named arguments - but mainly as a way of making immutability simpler; not sure I'd use it much otherwise
p21365
as(dp21366
g18
V23354
p21367
stp21368
a((dp21369
g2
(lp21370
VDo you need the  here
p21371
aVWhat was the regular  not giving you
p21372
aVIf you switch back to this, it should work fine
p21373
aVBasically, by implementing custom serialization, the data is no longer contract based - so it has to include this extra information to guarantee that it is able to understand it later
p21374
aVSo: is there a reason to implement  in this case
p21375
as(dp21376
g18
V23354
p21377
stp21378
a((dp21379
g2
(lp21380
VI hate to say it, but it sounds like the system is pretty borked
p21381
aVThere has to be a point when it is quicker to reinstall the OS than it is to continue trying to fix the current install
p21382
aVI just hope you take this in the right spirit
p21383
aVsorry
p21384
as(dp21385
g18
V23354
p21386
stp21387
a((dp21388
g2
(lp21389
VActually - there is a big difference if you are using reflection; in particular, Silverlight can get very upset if you try and access internal methods via reflection, even if you would have had access
p21390
aVI've seen occasions when I've had to make a method public to make the code work on Silverlight, even though it works on regular
p21391
aVNET
p21392
aVYou might find the same with partial trust in regular
p21393
aVNET
p21394
as(dp21395
g18
V23354
p21396
stp21397
a((dp21398
g2
(lp21399
VIf you really must use LINQ (as a learning exercise, perhaps), then maybe something like below (as C#; my VB is nowhere near up to translating it, I'm afraid):
p21400
aVThe problem is that the  needs to be expanded while retaining the separate rows (so  isn't an option);  seems the easiest way
p21401
as(dp21402
g18
V23354
p21403
stp21404
a((dp21405
g2
(lp21406
VHow about something like:
p21407
aVThis applies a succession of  clauses, covering all the filters - essentially
p21408
as(dp21409
g18
V23354
p21410
stp21411
a((dp21412
g2
(lp21413
VNeither "Foo" nor "Bar" really have threads
p21414
aVyou would need an external message-pump mechanism to push messages between threads, such as is provided in winforms (Control
p21415
aVInvoke) and WPF (Dispatcher)
p21416
aVAlternatively, something like a (synchronized) producer/consumer queue would suffice if you don't mind one of the threads being devoted to waiting (passively) for messages
p21417
aVUnless you have written your own sync-context, it is impossible for us to say what  will be; in many cases it is
p21418
aVCan you add more context to the problem
p21419
as(dp21420
g18
V23354
p21421
stp21422
a((dp21423
g2
(lp21424
VThe IDE gives you the option to do either - it would be unusual to do both
p21425
aVWith explicit implementation, the members are not on the (primary) public API; this is handy if the interface isn't directly tied to the intent of the object
p21426
aVFor example, the  members aren't all that helpful to regular callers - only to some very specific code, so there is no purpose having them on the public API causing mess
p21427
aVThis is also useful if:
p21428
aVthere is a conflict between an interface's  method and your own type's  method, and they mean different things
p21429
aVthere is a signature conflict between other interfaces
p21430
aVThe typical example of the last point is , which has a  method at two levels in the interface hierarchy - it is common to implement the typed () version using implicit implementation, and the untyped () version using explicit implementation
p21431
as(dp21432
g18
V23354
p21433
stp21434
a((dp21435
g2
(lp21436
VTCP over the local machine should be pretty fast (named pipes might be a bit faster, but may be harder to do at both ends)
p21437
aVThe biggest bottleneck is likely to be serialization and deserialization of the data
p21438
aVWhat format are you currently using to represent the data
p21439
as(dp21440
g18
V23354
p21441
stp21442
a((dp21443
g2
(lp21444
VHere's two approaches, depending on whether you want to pack the bits into bytes, or have as many bytes as original bits:
p21445
as(dp21446
g18
V23354
p21447
stp21448
a((dp21449
g2
(lp21450
VThe  should be quicker, as the comparison is simpler - just a few direct bytes
p21451
aVThe string involves a dereference and lots more work
p21452
aVOf course - you could profile ;-p
p21453
aVEvidence:
p21454
aVbased on:
p21455
as(dp21456
g18
V23354
p21457
stp21458
a((dp21459
g2
(lp21460
VPersonally, I wouldn't hesitate to hand-crank the entities - either by assuming ownership of the generated code, or doing it manually (and getting rid of the arrays ;-p)
p21461
aVRe concurrency - you could perhaps have a thread-static pool
p21462
aVAFAIK,  just uses the one thread, so this should be fine
p21463
aVIt would also allow you to throw the pool away when you're done
p21464
aVSo then you could have something like a static pool, but per thread
p21465
aVThen perhaps tweak the setters:
p21466
aVwhere the static  method talks to a static field (, presumably) decorated with
p21467
as(dp21468
g18
V23354
p21469
stp21470
a((dp21471
g2
(lp21472
VIs there an increasing key, such as an identity key
p21473
aVAnd is it the clustered index
p21474
aVIf so, it should be fairly simple to track the last key you got to, and do things like:
p21475
aVAlso - be sure to read it with something like , so that you aren't buffering too many rows
p21476
aVOf course, beyond a few thousand rows, you might as well just accept the occasional round-trip, and make a number of requests for (say) 10000 rows at a time
p21477
aVI don't think this would be any less efficient in real terms (a few milliseconds here and there)
p21478
as(dp21479
g18
V23354
p21480
stp21481
a((dp21482
g2
(lp21483
VProbably the easiest route is to export individual tables as csv/tsv
p21484
aVThe 'net is full of samples of this
p21485
as(dp21486
g18
V23354
p21487
stp21488
a((dp21489
g2
(lp21490
VHave you got a conflicting type/property/method/control called  at some level
p21491
aVThat would do it
p21492
as(dp21493
g18
V23354
p21494
stp21495
a((dp21496
g2
(lp21497
VThe delegate only points to a single overload - not to the "method group"
p21498
aVBy the time you get a delegate to a method, you have already done overload resolution
p21499
aVUsually, you can do this just in the compiler:
p21500
aVIf the question relates to getting the overloaded method via reflection - then you can specify the pattern in the arguments to  (as a )
p21501
aVThis should give you the method you want
p21502
aVTo get a delegate from a , use
p21503
as(dp21504
g18
V23354
p21505
stp21506
a((dp21507
g2
(lp21508
V"Why do i get that error
p21509
aV- probably, you don't have "" at the top of the file - only "" - however, generics are probably safer - see below:
p21510
as(dp21511
g18
V23354
p21512
stp21513
a((dp21514
g2
(lp21515
VYou can specify types/known types - but not AFAIK member information
p21516
aVis a bit more forgiving here
p21517
aVis there a chance the old types used xml attributes
p21518
aV(rather than data-contract attributes)
p21519
aVThe other option is to provide an  - but that isn't trivial
p21520
aVIs there any chance you can decorate the class with the old attributes and the attributes (etc) for whatever new mechanism you're employing
p21521
aVIf the data is simple (i
p21522
ag50
aVonly one or two types, in a simple relationship), you could use a parallel set of classes to deserialize, then copy the data (property-to-property etc) into the new data structure, and re-serialize
p21523
aVThis gets harder as the complexity of the model increases
p21524
as(dp21525
g18
V23354
p21526
stp21527
a((dp21528
g2
(lp21529
VAs I understand it, it is similar to the techniques they use in games to keep the frame rate up; while something is small, only fetch a low-res version of it
p21530
aVAs they zoom in, fetch increasing levels of detail
p21531
aVRun wireshark and you'll see the traffic happening as you pan/zoom
p21532
aVThe tooling's job is to generate data that lets the client get images at different resolutions without too much pain
p21533
as(dp21534
g18
V23354
p21535
stp21536
a((dp21537
g2
(lp21538
VYes; delegates are compared on the instance and ; if those are the same, then it will work
p21539
aVThe problem comes when trying to unsubscribe an anonymous method; in that case, you must keep a reference to the delegate in order to unsubscribe
p21540
aVSo:
p21541
aVThis is fine:
p21542
aVBut this is much riskier:
p21543
aVThe correct process with anonymous methods is:
p21544
as(dp21545
g18
V23354
p21546
stp21547
a((dp21548
g2
(lp21549
VIf the change was just in the one record, you can use either the  partial methods, or you can override  on the data-context, call , and apply the changes just before they are updated
p21550
aVThe latter (data-context) approach is useful for catching a broad spectrum of changes, where-as the  approach is useful for logic specific to individual properties
p21551
aVHowever, in the case presented (non-homogeneous updates), I expect a database trigger may be more appropriate
p21552
as(dp21553
g18
V23354
p21554
stp21555
a((dp21556
g2
(lp21557
VIt would be just as easy to get rid of the handler if your code can officially see the handler
p21558
aVIf absolutely necessary, it is possible to unsubscribe using reflection to get hold of the delegate, but this is messy
p21559
aVIt would be a lot cleaner and safer to either a: avoid the requirement, or b: change the code to make the handler
p21560
aVReflection approach (use at own risk); uncomment the block in the  to see the change
p21561
as(dp21562
g18
V23354
p21563
stp21564
a((dp21565
g2
(lp21566
VCannot reproduce
p21567
aVI wonder if it is something local to your machine; buffering, perhaps
p21568
as(dp21569
g18
V23354
p21570
stp21571
a((dp21572
g2
(lp21573
VWell, to avoid the path problem you can use  instead (although IIRC this is also deprecated); use  to install a named key
p21574
aVEach machine (that does builds) would need this key adding
p21575
aVOther than that; yes, you'd probably need to edit the project files
p21576
as(dp21577
g18
V23354
p21578
stp21579
a((dp21580
g2
(lp21581
VWouldn't you just navigate
p21582
aVetc
p21583
as(dp21584
g18
V23354
p21585
stp21586
a((dp21587
g2
(lp21588
VThe easy way is:
p21589
aVWhich uses an anonymous method to do the job inline
p21590
aVSince you expect to be on another thread, you may as well just call Invoke - it is safe even from the UI thread
p21591
as(dp21592
g18
V23354
p21593
stp21594
a((dp21595
g2
(lp21596
VGood question; for a test, I get:
p21597
aVTest rig:
p21598
as(dp21599
g18
V23354
p21600
stp21601
a((dp21602
g2
(lp21603
VHow are you trying to delete the file at the client
p21604
aVUnless you're hosting in , or using something like an ActiveX control, you only have javascript at the client - and that doesn't provide random file access
p21605
aVSo: what is the full setup here
p21606
as(dp21607
g18
V23354
p21608
stp21609
a((dp21610
g2
(lp21611
VThe pros; composability:
p21612
aVcallers can add filters
p21613
aVcallers can add paging
p21614
aVcallers can add sorting
p21615
aVetc
p21616
aVThe cons; non-testability:
p21617
aVYour repository is no longer properly unit testable; you can't rely on a: it working, b: what it does;
p21618
aVthe caller could add a non-translatable function (i
p21619
ag50
aVno TSQL mapping; breaks at runtime)
p21620
aVthe caller could add a filter/sort that makes it perform like a dog
p21621
aVSince callers expect  to be composable, it rules out non-composable implementations - or it forces you to write your own query provider for them
p21622
aVit means you can't optimize / profile the DAL
p21623
aVFor stability, I've taken to not exposing  or  on my repositories
p21624
aVThis means I know how the repository behaves, and my upper layers can use mocks without worrying "does the actual repository support this
p21625
aV(forcing integration tests)
p21626
aVI still use  etc inside the repository - but not over the boundary
p21627
aVI posted some more thoughts on this theme here
p21628
aVIt is just as easy to put paging parameters on the repository interface
p21629
aVYou can even use extension methods (on the interface) to add optional paging parameters, so that the concrete classes only have 1 method to implement, but there may be 2 or 3 overloads available to the caller
p21630
as(dp21631
g18
V23354
p21632
stp21633
a((dp21634
g2
(lp21635
VThe null-checking you refer to will be easier in
p21636
aVNET 4
p21637
aV0 / C# 4
p21638
aV0 via code-contracts, which does pretty much what you want
p21639
aVStructs are already non-nullable, but don't go creating your own structs like crazy - you rarely need them (classes are far more common)
p21640
aVThere is no real concept of a "non-nullable class"; people have proposed syntax changes like:
p21641
aVwhich would have the compiler do the non-null check on  - but in reality, code-contracts does this and more
p21642
aVThere are some things you can do in PostSharp, but it probably isn't worth the hastle
p21643
aVOne other thought on a non-nullable class (and one of the reasons they aren't implemented); what would  be for a non-nullable class
p21644
aV;-p The spec demands that  is well defined
p21645
as(dp21646
g18
V23354
p21647
stp21648
a((dp21649
g2
(lp21650
VYou might want to check the paths against the reference; it might be that you've somehow referenced it against the obj folder
p21651
aVThis may be easier to see in the csproj than the IDE ("hint path" or something)
p21652
as(dp21653
g18
V23354
p21654
stp21655
a((dp21656
g2
(lp21657
VIs it critical that it is never calculated twice
p21658
ag412
ag50
aVif two threads happened to ask for it at the same time, and calculate the value independently, is that a show-stopper
p21659
aVIn most cases, it isn't - in which case, just check for  (since it is a string): (example in C#, apologies):
p21660
aVAll subsequent calls should see the new value (I don't think we'll need  if it is hidden inside a property/method)
p21661
aVThis has the advantage of being lock-free and simple
p21662
aVAnother trick is to use a static property of a nested class:
p21663
aVThis is calculated lazily, but the rules of static initializers mean that it is guaranteed to run once only (excluding reflection)
p21664
as(dp21665
g18
V23354
p21666
stp21667
a((dp21668
g2
(lp21669
VCan I clarify
p21670
aVYou just want this logic to apply on left-click, yes
p21671
aVAlso - rather than hard-coding index numbers, you might consider setting the  against the nodes - avoid all the  etc:
p21672
aVThen all you need to do is set the s in the first place:
p21673
aV(note - this is just for cnosideration; if your code works, and you are happy - don't change it)
p21674
as(dp21675
g18
V23354
p21676
stp21677
a((dp21678
g2
(lp21679
VBook: Visual Studio Extensibility (Wrox)
p21680
as(dp21681
g18
V23354
p21682
stp21683
a((dp21684
g2
(lp21685
V"updrading" VB6 to
p21686
aVNET is a misnomer
p21687
aVAll you get is VB6 code in
p21688
aVNET; generally you can get much better results with a refactor/re-architecture - using a different class model, for example
p21689
aVPerhaps designing to be unit-testable, for example
p21690
aVOr using IoC
p21691
aVIf you just want the code to work (and you're confident you can test it), then fine
p21692
aVPersonally, I would seriously consider a more manual port
p21693
aVAnd I have a lot of legacy VB6 code, so I know the pain involved
p21694
aVEvery time we've faced this, we've simply re-written it in C# - as an approach, it has proven itself many times over
p21695
aVActually - I recommend Brownfield Application Deveopment (Manning) - it may give some valuable insights on things to have in place before you start
p21696
as(dp21697
g18
V23354
p21698
stp21699
a((dp21700
g2
(lp21701
VHave you considered DbLinq
p21702
aVI believe this has now moved to a google code project, but it supports MySQL via the DataContext approach of LINQ-to-SQL (SQL Server)
p21703
aVThere haven't been any official releases in a while, but the repo is active
p21704
as(dp21705
g18
V23354
p21706
stp21707
a((dp21708
g2
(lp21709
VNo, I don't think there is
p21710
aVThe pool thread approach is probably the most pragmatic
p21711
aVAlternatively, I guess you could drop down to P/Invoke - but that would be a lot more work
p21712
as(dp21713
g18
V23354
p21714
stp21715
a((dp21716
g2
(lp21717
VWell, one option would be to write your own parser - i
p21718
ag50
aVthat takes "x^2" and builds a
p21719
aVNET 3
p21720
aV5  to do the same
p21721
aVOnce you have an , you can use  to get a delegate (, for example) that you can use to generate the points
p21722
aVThat isn't a huge amount of work (it took me about 2 hours to write a similar (though basic) parser a few months ago)
p21723
aVOf course, you'd still need to worry about the imaging side
p21724
aVmaybe the
p21725
aVNET chart control released a few months ago
p21726
aV(it isn't just ASP
p21727
aVNET)
p21728
as(dp21729
g18
V23354
p21730
stp21731
a((dp21732
g2
(lp21733
VFor a class, the defaults are essentially reference equality, and that is usually fine
p21734
aVIf writing a struct, it is more common to override equality (not least to avoid boxing), but it is very rare you write a struct anyway
p21735
aVWhen overriding equality, you should always have a matching  and  (i
p21736
ag50
aVfor two values, if  returns true they must return the same hash-code, but the converse is not required) - and it is common to also provide /operators, and often to implement  too
p21737
aVFor generating the hash code, it is common to use a factored sum, as this avoids collisions on paired values - for example, for a basic 2 field hash:
p21738
aVThis has the advantage that:
p21739
aVthe hash of {1,2} is not the same as the hash of {2,1}
p21740
aVthe hash of {1,1} is not the same as the hash of {2,2}
p21741
aVetc - which can be common if just using an unweighted sum, or xor (), etc
p21742
as(dp21743
g18
V23354
p21744
stp21745
a((dp21746
g2
(lp21747
V"TicketList" is the variable name for a list of an anonymous type
p21748
aVThere is no "TicketList" type
p21749
aVCasting from anonymous types can be done ("by example"), but is very brittle, and I simply don't recommend you use an anonymous type for this
p21750
aVOne option would be to declare my own type (in the UI's "model(s)" folder) - for example  /  (etc), with a  and
p21751
aVThen use this type:
p21752
aVThen you should be able to use:
p21753
aVIn reality, I'd probably offload this work to a repository, and have a repository method that returns a list of the summary type
p21754
as(dp21755
g18
V23354
p21756
stp21757
a((dp21758
g2
(lp21759
VIt sounds to me like the simplest approach would be to use regular nodes, but in a different xml namespace - i
p21760
ag50
aV(where  is an  alias for the namespace-uri)
p21761
aVIn many cases, readers are only checking for data in their namespace (or the default/blank namespace) - values in custom namespaces are generally skipped
p21762
aVTo get pack the original xml, one simple approach would be to run it through an xslt that only respects the default/original namespace
p21763
aVTo remove such data from an , perhaps:
p21764
as(dp21765
g18
V23354
p21766
stp21767
a((dp21768
g2
(lp21769
VIt depends what you want to do; remoting is falling out of favor for true "remote" scenarios; in general, for communication between systems it would be preferable to use a service interface, such as via WCF
p21770
aVRemoting is still valuable for communicating between AppDomains in a single application
p21771
aVNote that remoting isn't available for all
p21772
aVNET frameworks - for example, Silverlight doesn't support remoting, but WCF and things like http / (raw)sockets are fine
p21773
aVIf you can, look toward WCF
p21774
aVIf WCF isn't an option, look at regular web-services
p21775
aVIn particular, problems with remoting:
p21776
aVit ties client and server to
p21777
aVNET
p21778
aVit ties client and server to the same binary implementation
p21779
aVit tends to lead to poorly considered boundaries (it is very easy to leak the wrong objects over the wire, which can lead to big latency issues)
p21780
aVetc
p21781
aVRe performance; remoting uses binary serialization, which is useful in some ways, bur problematic in others (see above bullets)
p21782
aVWeb-services tend to be xml based (although other formats exist) - and are contract based (rather than implementation based) - meaning client and server can have different types representing the objects, as long as they are similar enough
p21783
aVIt is also possible to use binary on web-services; for example, protobuf-net provides a WCF hook to use Google's "protocol buffers" binary (contract-based) format over a WCF service (caveat: this is then a bespoke protocol, and you'd need the tool at both ends)
p21784
aVThere are also other ways of talking between systems, all of them arguably preferable over remoting (even if they are less versatile - sometimes, minimalist is a virtue):
p21785
aVsockets (custom communications)
p21786
aVhttp (simple POX messages etc)
p21787
aVmiddle-ware (msmq, biztalk, etc)
p21788
as(dp21789
g18
V23354
p21790
stp21791
a((dp21792
g2
(lp21793
VYou can't use  if you are removing data inside the  - it (intentionally) breaks the iterator
p21794
aVIf  works, why change it
p21795
aVIf you are desperate to use , then build a separate list first - for example:
p21796
aVThe first query can often be simplified by LINQ if if is available
p21797
as(dp21798
g18
V23354
p21799
stp21800
a((dp21801
g2
(lp21802
VWith , something like below:
p21803
aVNote that  would also be a possibility here - reducing the amount of code you need to write and maintain
p21804
as(dp21805
g18
V23354
p21806
stp21807
a((dp21808
g2
(lp21809
VWell, that looks OK to me; I'd probably implement  as a means to  the file, but
p21810
aVOf course, you could also use any of the (many) pre-canned logging frameworks
p21811
aVUpdate:
p21812
aVOne thought: you might want to consider what happens if the file already exists; you don't want to stomp on your logs
p21813
as(dp21814
g18
V23354
p21815
stp21816
a((dp21817
g2
(lp21818
VNo
p21819
aVThe source csproj must know it is a Silverlight project
p21820
aVThis may mean keeping two project files with the same source "
p21821
aVcs" files
p21822
aVThere is a handy csproj trick here - (copied from protobuf-net where I do this for multiple frameworks):
p21823
aVThen you only have to maintain one project; the Silverlight project gets everything from the tree
p21824
aVNote that the Silverlight BCL is heavily restricted, and not all functionality will be available
p21825
aVGetting code that compiles on both regular
p21826
aVNET and Silverlight can be
p21827
aVchallenging
p21828
aVAlternatively, use proxy classes in the Silverlight app (i
p21829
ag50
aVvia WCF etc)
p21830
aVNot as rich, but simple to do
p21831
as(dp21832
g18
V23354
p21833
stp21834
a((dp21835
g2
(lp21836
VConcise meaning to type
p21837
aVor to run
p21838
aVThe fastest to run will be hand-cranked with
p21839
aVBut to type, probably (edit handle 0/1 etc):
p21840
aVThe  approach might look something like:
p21841
as(dp21842
g18
V23354
p21843
stp21844
a((dp21845
g2
(lp21846
VSilverlight doesn't have much binary serialization built in; however, protobuf-net works on Silverlight and may help plug this gap
p21847
aVIn the current build you can only really serialize types you control (due to adding attributes) - however, I'm in the middle of a big refactor to (among other things) add support for serializing types without attributes
p21848
aVI expect it to be about 2 more weeks before this is available as a (hopefully) stable build, but you're welcome to take a look at it then
p21849
aVNote that you will still need to give it some help (telling it what you want it to serialize), but it may be useful
p21850
aVIn particular, the data format ("protocol buffers") is designed to be both dense and efficient to process, which should increase the parse speed
p21851
aVSee here for more (numbers are from main
p21852
aVNET, not Silverlight)
p21853
as(dp21854
g18
V23354
p21855
stp21856
a((dp21857
g2
(lp21858
VRe the problem using AddressOf - if you know the prop-name at compile time, you can (in C#, at least) use an anon-method / lambda:
p21859
aVI'm not a VB expert, but reflector claims this is the same as:
p21860
aVDoes that work
p21861
aVOriginal answer:
p21862
aVYou create delegates for properties with ; this can be open for any instance of the type, of fixed for a single instance - and can be for getter or setter; I'll give an example in C#
p21863
as(dp21864
g18
V23354
p21865
stp21866
a((dp21867
g2
(lp21868
VActually, LINQ-to-SQL can bind integers directly to enums (to either  (etc) or  columns data at the database), so a simple answer is to create an enum (in your data/repository layer), and change the dbml (usually via the designer) so that it uses the (fully-qualified) enum type for the status column
p21869
aVIf this isn't an option, then I would rename the status property in the class (again via the dbml) to something  like , and add a partial class that returns the preferred representation (as either an enum or a string) i
p21870
ag50
as(dp21871
g18
V23354
p21872
stp21873
a((dp21874
g2
(lp21875
VI'd argue that the two are fairly interchangeable
p21876
aV- it is simply a set of common re-usable code (in whatever platform you are targetting), usually supplied by the platform
p21877
aVMaybe you could argue that the BCL usually represents the "pure" (vendor-independent) modules, where-as the "framework" may (depending on how you use the term) include the vendor's bespoke modules
p21878
aVBut that it perhaps open to local interpretation
p21879
as(dp21880
g18
V23354
p21881
stp21882
a((dp21883
g2
(lp21884
VWell, the easiest is to use :
p21885
aVOtherwise, you need to allocate an array of suitable size, and set via the indexer
p21886
aVThis second approach is not useful if you can't predict the size of the array, as it is expensive to reallocate the array every time you add an item; a  uses a doubling strategy to minimize the reallocations required
p21887
as(dp21888
g18
V23354
p21889
stp21890
a((dp21891
g2
(lp21892
VWith entity framework, if you have materialized the object then you must explicitly load collection associations before you can see the contents
p21893
aVA pain
p21894
as(dp21895
g18
V23354
p21896
stp21897
a((dp21898
g2
(lp21899
VIt sounds like it can't find the app
p21900
aVconfig/web
p21901
aVconfig file
p21902
aVWith MSTest, it doesn't test in the usual "output" directory
p21903
aVAs a consequence, the "copy to output directory" (etc) flags do nothing
p21904
aVYou need to tell it which files to deploy to the test folder; there are two ways:
p21905
aVedit the testrunconfig file and add the files to the deployment list
p21906
aVadd the  attribute to your test, telling it which files are needed
p21907
aVI don't really like either approach - in fact, I tend to use TestDriven
p21908
aVNET to run the tests, which does it the way you expect it to behave
p21909
aVOf course, TestDriven
p21910
aVNET would also run your NUnit tests in the IDE including code-coverage etc - which would then beg the question: why change your existing tests if they can work in the IDE
p21911
aVAnd the obvious answer is "we've paid for MSTest, and TestDriven
p21912
aVNET isn't free"
p21913
as(dp21914
g18
V23354
p21915
stp21916
a((dp21917
g2
(lp21918
VLike so
p21919
as(dp21920
g18
V23354
p21921
stp21922
a((dp21923
g2
(lp21924
VIIRC, the order of attributes (in xml) is unimportant
p21925
aVso why change it
p21926
aVIs it causing an actual problem
p21927
as(dp21928
g18
V23354
p21929
stp21930
a((dp21931
g2
(lp21932
VThe main time to use  is in
p21933
aVNET 1
p21934
ag733
aVOther than that,  all the way (for your local )
p21935
aVFor those (rare) cases where you don't know the type up-front (and can't use generics), even  is more helpful than  (IMO)
p21936
as(dp21937
g18
V23354
p21938
stp21939
a((dp21940
g2
(lp21941
VLambda expressions, like anonymous methods, are actually very complex beasts
p21942
aVEven if we rule out  (
p21943
aVNET 3
p21944
aV5), that still leaves a lot of complexity, not least being captured variables, which fundamentally re-structure the code that uses them (what you think of as variables become fields on compiler-generated classes), with a bit of smoke and mirrors
p21945
aVAs such, I'm not in the least surprised that you can't use them idly - there is a lot of compiler work (and type generation behind the scenes) that supports this magic
p21946
as(dp21947
g18
V23354
p21948
stp21949
a((dp21950
g2
(lp21951
VNot easily - you'd need to make a COM-callable wrapper, install on the servers, etc
p21952
aVI simply don't think it is a suitable fit for "classic" ASP
p21953
as(dp21954
g18
V23354
p21955
stp21956
a((dp21957
g2
(lp21958
VHave you considered ADO
p21959
aVNET Data Services
p21960
aVThis allows you to perform LINQ queries over a REST API (backed by WCF) - but the tooling does all the heavy lifting
p21961
aVMany (not all) of the standard LINQ filters (etc) are supported, and can be composed
p21962
aVIn particular, for querying data, ADO
p21963
aVNET Data Services should be fine - for updateing data you need to do more work (or use a separate, non-REST API for updates)
p21964
aVI have a series of posts on my blog covering this for LINQ-to-SQL (the work should be similar for other LINQ providers)
p21965
as(dp21966
g18
V23354
p21967
stp21968
a((dp21969
g2
(lp21970
VWhat is the problem you are seeing
p21971
aVThe "capture" problem only affects async/deferred/threaded code - it shouldn't affect this case
p21972
aVI wonder if the most likely problem here is that all your  objects have the same  instance - or even that you have the same  instance lots of times
p21973
aVillustration of the "capture propblem" (see comments): this is a problem seen when using a lambda/anon-method; if the iteration variable ( above) is used in the lambda/anon-method, it is "captured" - but in a slightly counter-intuitive way
p21974
aVFor example; we might expect this to print (in an unpredictable order) the numbers 0-9:
p21975
aVBut it doesn't
p21976
aVwe fix it by adding an extra variable:
p21977
aVThis is because the behaviour of captured variables is determined by their lexical scope
p21978
aVthe scope of the iteration variable is a bit larger that we would like
p21979
as(dp21980
g18
V23354
p21981
stp21982
a((dp21983
g2
(lp21984
VI'm sorry, but that is not a simple question
p21985
aVIt would depend a lot on what exactly was going on
p21986
aVC# is certainly no slouch, and you'd be hard-pressed to say "java is faster" or "C# is faster"
p21987
aVC is a very different beast
p21988
aVit maybe has the potential to be faster - if you get it right; but in most cases it'll be about the same, but much harder to write
p21989
aVIt also depends how you do it - locking strategies, how you do the parallelization, the main code body, etc
p21990
aVRe JIT - you could use NGEN to flatten this, but yes; if you are hitting the same code it sould be JITted very early on
p21991
aVOne very useful feature of C#/Java (over C) is that they have the potential to make better use of the local CPU (optimizations etc), without you having to worry about it
p21992
aVAlso - with
p21993
aVNET, consider things like "Parallel Extensions" (to be bundled in 4
p21994
aV0), which gives you a much stronger threading story (compared to
p21995
aVNET without PFX)
p21996
as(dp21997
g18
V23354
p21998
stp21999
a((dp22000
g2
(lp22001
VYou mention C# 2
p22002
aV0 - do you mean
p22003
aVNET 2
p22004
ag190
aVIf
p22005
aVNET 3
p22006
aV0 is an option, you could perhaps re-host the Workflow (WF) designer
p22007
aVThis has many of the usual branch (etc) constructs built in, but is more of a flow diagram
p22008
as(dp22009
g18
V23354
p22010
stp22011
a((dp22012
g2
(lp22013
Vhow about simply:
p22014
aV(obviously combine with the rest of the file name
p22015
aVadd more precision as necessary - hours, minutes, etc)
p22016
as(dp22017
g18
V23354
p22018
stp22019
a((dp22020
g2
(lp22021
VIf you are looking at a navigation property (i
p22022
ag50
aVsome child collection of ), then this is unrelated to your query; it sounds like you want to use
p22023
aVThis largely replaces the join if you are just trying to filter the child data
p22024
as(dp22025
g18
V23354
p22026
stp22027
a((dp22028
g2
(lp22029
VEncapsulation means your separate class shouldn't be talking directly to the controls
p22030
aVYou should, instead, expose properties and methods on your (outer)  - for example:
p22031
aVFor more complex operations it may be preferable to use a method; properties are fine for simple read/write for discreet values
p22032
aVThis provides various advantages:
p22033
aVyou can, if required, abstract the details to an interface (or similar)
p22034
aVyou can change the implementation (for example, use the Form's Text for the title) without changing the calling code
p22035
aVit is just
p22036
aVnicer ;-p
p22037
as(dp22038
g18
V23354
p22039
stp22040
a((dp22041
g2
(lp22042
VFirst - may be more pragmatic to look at WPF, or hosting some WPF elements inside winforms (which is supported - like so)
p22043
aVOther than that - you can do all your own painting if you want; but it is a lot of work
p22044
as(dp22045
g18
V23354
p22046
stp22047
a((dp22048
g2
(lp22049
VSomething like:
p22050
aVIf you need to check against an xsd, then use
p22051
as(dp22052
g18
V23354
p22053
stp22054
a((dp22055
g2
(lp22056
V uses  to do comparisons; this checks first to see if your object implements ; otherwise is uses
p22057
aVSo; the easiest thing to do is to override  (always update  to match the logic in )
p22058
aVAlternatively, use LINQ instead:
p22059
as(dp22060
g18
V23354
p22061
stp22062
a((dp22063
g2
(lp22064
Vhmm
p22065
aVI may have been wrong before - setmaxstdio (see here) - but it is per-process, not system wide
p22066
aVI may be wrong, but I didn't think there was a limit to set in Windows
p22067
aVbut unless you can say how this relates to programming, I expect this answer will be closed soon
p22068
aVIf you are in the "IT Pro" area (rather than development), then there is a sister-site, serverfault
p22069
aVcom - coming soon for this type of question
p22070
as(dp22071
g18
V23354
p22072
stp22073
a((dp22074
g2
(lp22075
VI'm thinking mainly of  here:
p22076
aVit is limited to tree-like data; it can't handle full object graphs
p22077
aVit is limited to public members, on public classes
p22078
aVit can't really do much with  members
p22079
aVit has some weaknesses around generics
p22080
aVlike many serializers, it won't touch instance properties on a collection (bad practice in the first place)
p22081
aVxml simply isn't always a good choice for large data (not least, for performance)
p22082
aVrequires a public parameterless constructor
p22083
aVsolves some of these, but has its own limitations:
p22084
aVit can't handle values in attributes
p22085
aVrequires
p22086
aVNET 3
p22087
aV0 (so not much use in 2
p22088
aV0)
p22089
as(dp22090
g18
V23354
p22091
stp22092
a((dp22093
g2
(lp22094
VI don't know about postgres, but on SQL Server:
p22095
as(dp22096
g18
V23354
p22097
stp22098
a((dp22099
g2
(lp22100
VIf you have a handle to the main form (or any control), you can use  /
p22101
aVIf you don't want to hand out a  instance, you can give external code an  instance (any control will do it, or write your own class that wraps a  to prevent caller-casting)
p22102
aVThen the caller can use this to perform methods
p22103
aVFinally, consider using events; the running code raises events that your UI handles; the UI can then call  locally to process the data
p22104
as(dp22105
g18
V23354
p22106
stp22107
a((dp22108
g2
(lp22109
V(edit - I think I misunderstood the original question)
p22110
aVSimply make it a method instead of a property:
p22111
as(dp22112
g18
V23354
p22113
stp22114
a((dp22115
g2
(lp22116
VIndeed there isn't; it uses the "methods" setting
p22117
aVResharper may have more control, but has a price tag too
p22118
as(dp22119
g18
V23354
p22120
stp22121
a((dp22122
g2
(lp22123
VYou can cast a variable that is typed as the base-class to the type of a derived class; however, by necessity this will do a runtime check, to see if the actual object involved is of the correct type
p22124
aVOnce created, the type of an object cannot be changed (not least, it might not be the same size)
p22125
aVYou can, however, convert an instance, creating a new instance of the second type - but you need to write the conversion code manually
p22126
as(dp22127
g18
V23354
p22128
stp22129
a((dp22130
g2
(lp22131
VConsider using  or ; both of these do what you want in standard ways
p22132
aVYou cannot do anything interesting by subclassing  - the methods aren't virtual
p22133
aVis designed to be more extensible, but in this case everything you need is already provided (by )
p22134
aVIn particular, this provides:
p22135
aVIBindingList (used by many UI binding components, such as grids)
p22136
aVListChanged - that your code can subscribe to for detailed notification
p22137
as(dp22138
g18
V23354
p22139
stp22140
a((dp22141
g2
(lp22142
V25 tables with 3-4k rows in each is not what I'd call "small" for xml; in particular, it isn't easy to jump to just the right data in xml
p22143
aVHave you considered a database, such as SQL Server Express Edition
p22144
aVFree, and more than up to this job
p22145
aVRe storage; if you are using the inbuilt serialization a , this should just work automatically
p22146
aVOf course, the xml will then be specific to
p22147
aVI honestly don't recommend the /xml approach
p22148
as(dp22149
g18
V23354
p22150
stp22151
a((dp22152
g2
(lp22153
VWell, you could perhaps create a CTE, UDF or view
p22154
aVBut it really isn't clear what you are trying to do
p22155
aVetc
p22156
as(dp22157
g18
V23354
p22158
stp22159
a((dp22160
g2
(lp22161
VThe only sensible way to do this would be to use the  API; but that changes the code yet further
p22162
aVNote: if this is for debugging purposes, be sure to add  to the method, as using a variable in this way changes the nature of the code in subtle ways
p22163
as(dp22164
g18
V23354
p22165
stp22166
a((dp22167
g2
(lp22168
VLINQ is composable, but to do this without using UNION you'd have to roll your own
p22169
aVBasically, we (presumably) want to create TSQL of the form:
p22170
aVwhere the name/amount pairs are determined at runtime
p22171
aVThere is easy way of phrasing that in LINQ; if it was "AND" each time, we could use  repeatedly
p22172
aVis a candidate, but I've seen repeated people have problems with that
p22173
aVWhat we want to do is emulate us writing a LINQ query like:
p22174
aVThis is done by crafting an , using  to combine each - so we will need to iterate over our name/amount pairs, making a richer
p22175
aVWriting  code by hand is a bit of a black art, but I have a very similar example up my sleeve (from a presentation I give); it uses some custom extension methods; usage via:
p22176
aVwhere  is your array of test ingredients
p22177
aVWhat this does is: for each  in  (our local array of test ingredients), it asks us to provide an  (for that ) that is the test to apply at the database
p22178
aVIt then combines these (in turn) with :
p22179
as(dp22180
g18
V23354
p22181
stp22182
a((dp22183
g2
(lp22184
VOne big drawback in a specific scenario - you lose control of the field name
p22185
aVThis might sound insignificant, but it is a big problem if you are using binary serialization (via BinaryFormatter)
p22186
aVOther things:
p22187
aVthey can't be  at the field level
p22188
aVfor s you need to call  in custom constructors
p22189
aVThey do, however, do a fantastic job in 99% of cases - they express the code neatly, while leaving it possible to add extra implementation details later (by switching to explicit fields) without breaking calling code (except for the points above)
p22190
as(dp22191
g18
V23354
p22192
stp22193
a((dp22194
g2
(lp22195
VYes, there is a difference;
p22196
aVresets the stack trace (so your errors would appear to originate from )
p22197
aVdoesn't - the original offender would be preserved
p22198
as(dp22199
g18
V23354
p22200
stp22201
a((dp22202
g2
(lp22203
VWhat you really need is the pdb file that contains the debugging symbols - generated at the same time as the dll
p22204
aVStick this next to the dll and it should start working (or if not, you can load it manually)
p22205
aVA source file isn't all that useful unless you are compiling
p22206
as(dp22207
g18
V23354
p22208
stp22209
a((dp22210
g2
(lp22211
VTypically, you would open a query analyzer window (right-click on the server; new query in Management Studio) and just run the script
p22212
aVIt depends, though, on what the script contains - i
p22213
ag50
aVdoes it create the db - or just the tables
p22214
aVYou may need to create the empty db yourself first
p22215
as(dp22216
g18
V23354
p22217
stp22218
a((dp22219
g2
(lp22220
VYes, it handles the core count itself, and is fine on single core, pseudo-multi-core (HT), right up to stupid numbers of cores - but you do need to code against  yourself; it doesn't simply seize control over your existing code
p22221
aVFor when to use parallelism
p22222
aVthat is a huge topic
p22223
aVActually, if you are doing web programming - I'd forget it and simply let IIS use different parallel threads for different requests (rather than letting one request hog the machine)
p22224
aVIt is mainly useful for big number crunching / data gathering - either on a dedicated app-server, or at the client
p22225
as(dp22226
g18
V23354
p22227
stp22228
a((dp22229
g2
(lp22230
VAdd -> New -> "Local Database Cache"
p22231
aVThis should provide all the sync you need (via ADO
p22232
aVNET Sync Framework), running (IIRC) by SQL CE by default, which is (I believe) free
p22233
as(dp22234
g18
V23354
p22235
stp22236
a((dp22237
g2
(lp22238
VYes; welcome to variance
p22239
aVUltimately, it isn't a list of  - for example, if you had another subclass, a  would (at compile time) let you  it
p22240
aVbut the runtime type wouldn't let you
p22241
aVThe compiler is stopping you making a mistake
p22242
aVIn some scenarios, generics can help here
p22243
aVI discuss this at the end of this blog entry
p22244
aVNote that
p22245
aVNET 4
p22246
aV0 variance doesn't apply to lists
p22247
as(dp22248
g18
V23354
p22249
stp22250
a((dp22251
g2
(lp22252
VSure - just use  - using Northwind as an example:
p22253
as(dp22254
g18
V23354
p22255
stp22256
a((dp22257
g2
(lp22258
VWhether or not you use LINQ-to-SQL, it is often cmomon to use a separate DTO object for things like WCF
p22259
aVI have cited a few thoughts on this subject here: Pragmatic LINQ - but for me, the biggest is: don't expose  /  on the repository interface
p22260
aVIf you do, your repository is no longer a black box, and cannot be tested in isolation, since it is at the whim of the caller
p22261
aVLikewise, you can't profile/optimise the DAL in isolation
p22262
aVA bigger problem is the fact that  leaks (LOLA)
p22263
aVFor example, Entity Framework doesn't like , or  without an explicit  - but L2S is fine with that
p22264
aVL2S should be an implementation detail of the DAL - it shouldn't define the repository
p22265
aVFor similar reasons, I mark the L2S association properties as  - I can use them in the DAL to create interesting queries, but
p22266
as(dp22267
g18
V23354
p22268
stp22269
a((dp22270
g2
(lp22271
VMainly so the compiler knows exactly what we mean - in particular for overload resolution:
p22272
aVshould that call  /  /
p22273
aVActually, I don't like remembering things - an alternative is:
p22274
aVthis is not a runtime cast - it is identical (at the IL level) to
p22275
aVThe only time it is subtly different is with s with extra precision:
p22276
as(dp22277
g18
V23354
p22278
stp22279
a((dp22280
g2
(lp22281
VWell, what sort of data are you sending, and over what binding
p22282
aVIs the problem the size of requests (bandwidth), or the quantity of requests (latency)
p22283
aVIf latency, then simply make fewer, but bigger, requests ;-p
p22284
aVFor bandwidth: if you are sending binary data over http, you can enable MTOM - that'll save you a few bytes
p22285
aVYou can enable compression support at the server, but this isn't guaranteed
p22286
aVIf you are using
p22287
aVNET to
p22288
aVNET, you might want to consider protobuf-net; this has WCF hooks for swapping the formatter () to use google's "protocol buffers" binary format, which is very small and fast
p22289
aVI can advise on how on request
p22290
aVOther than that: send less data ;-p
p22291
as(dp22292
g18
V23354
p22293
stp22294
a((dp22295
g2
(lp22296
Va = source array
p22297
aV1 = start index in source array
p22298
aVb = destination array
p22299
aV0 = start index in destination array
p22300
aV3 = elements to copy
p22301
as(dp22302
g18
V23354
p22303
stp22304
a((dp22305
g2
(lp22306
VWell, the 2 things are very different
p22307
aVLINQ (in the pure sense) isn't actually related to databases at all - it can be used quite happily just with in memory objects, or against web services, etc
p22308
aVIf you are mainly interested in writing better
p22309
aVNET code, then learn LINQ - but learn it properly - perhaps pick up C# in Depth, for example - which covers it very well in the last few chapters
p22310
aVIf you want to know about databases, then sure: learn SQL (such as TSQL) - but understand the differences
p22311
aVDatabases are good if you need to write enterprise software, but not necessarily if you just want to do simple tasks
p22312
aVedit re edit to the question
p22313
aVIf you are just getting simple data in and out of the database, then you probably don't need to know much about SQL
p22314
aVJust use LINQ-to-SQL (or whatever tool), and let the ORM tooling worry about it
p22315
as(dp22316
g18
V23354
p22317
stp22318
a((dp22319
g2
(lp22320
VFrom reading the documentation, it simply doesn't look like parameters / external inputs are supported
p22321
as(dp22322
g18
V23354
p22323
stp22324
a((dp22325
g2
(lp22326
VIs  a  instance
p22327
aVIf so - just check it for null:
p22328
as(dp22329
g18
V23354
p22330
stp22331
a((dp22332
g2
(lp22333
VIt depends on the context
p22334
aVIn a general purpose library, all we should assume is that the list is immutable
p22335
aVChanges to the elements in the list would be reflected to all callers, as a direct consequence of returning the same reference each time
p22336
aVHowever, if this is a specialized immutable tree (or whatever), and is documented as such then you would expect the items in the list to themselves be immutable, and it becomes a moot question
p22337
as(dp22338
g18
V23354
p22339
stp22340
a((dp22341
g2
(lp22342
VIn general, people want to be able to at least deserialize old data, regardless of changes to the class design
p22343
aVUnfortunately, BinaryFormatter (being field based) is very brittle here - even switching to automatically implemented properties can break things
p22344
aVPersonally, I would be designing around data-contracts or similar structures that are not implementation specific, and are extensible
p22345
aVFor binary, protobuf-net has a lot of uses in this area
p22346
aVIf you really want to emulate the 1
p22347
aV1 behaviour - implement  by hand and throw the exception (or not) yourself
p22348
as(dp22349
g18
V23354
p22350
stp22351
a((dp22352
g2
(lp22353
VThe "FindAll" is a bad idea, and will force it to fetch all data
p22354
aVReturning  would be better, but still not ideal, IMO
p22355
aVRe finding by ID - see here for a LINQ-to-SQL answer; this uses LINQ-to-SQL's meta-model to locate the primary key, so that you don't have to
p22356
aVIt also works for both attributed and resource-based models
p22357
aVI wouldn't force a base class
p22358
aVThat wasn't very popular with Entity Framework, and it isn't likely to get any more popular
p22359
as(dp22360
g18
V23354
p22361
stp22362
a((dp22363
g2
(lp22364
VNo, basically
p22365
aVuses static analysis, so will use the object
p22366
aVIt sounds like you need to use  instead (or  if you know that neither is null), which uses polymorphism
p22367
as(dp22368
g18
V23354
p22369
stp22370
a((dp22371
g2
(lp22372
VBasically, you need to specify an  when reading/writing the file
p22373
aVFor example:
p22374
aVNote that once you have read it,  is actually unicode when in memory
p22375
aVYou can choose different code-pages using
p22376
as(dp22377
g18
V23354
p22378
stp22379
a((dp22380
g2
(lp22381
VYou can add items to the toolbox by right-clicking on it, "Choose Items
p22382
aVThen go and get a coffee - it takes ages to load
p22383
aVLocate your dll
p22384
aVNote that adding an item from the toolbox will automatically add the reference to the project
p22385
as(dp22386
g18
V23354
p22387
stp22388
a((dp22389
g2
(lp22390
VJust use ;  doesn't define this - it inherits it from
p22391
as(dp22392
g18
V23354
p22393
stp22394
a((dp22395
g2
(lp22396
VAs an aside: this won't include your  customisations, but it will include any customisations made via
p22397
aV(edit)
p22398
aVAs a second aside - you can also tweak  by providing a  - much simpler than either  or  - for example:
p22399
as(dp22400
g18
V23354
p22401
stp22402
a((dp22403
g2
(lp22404
VWhen you only need one method, think Func
p22405
aVperhaps a
p22406
aVThen call
p22407
as(dp22408
g18
V23354
p22409
stp22410
a((dp22411
g2
(lp22412
VIf a node has multiple parents, then it isn't a tree; it is, presumably, a graph
p22413
aVHowever - worry not;  can handle this for you:
p22414
as(dp22415
g18
V23354
p22416
stp22417
a((dp22418
g2
(lp22419
VAll classes that derive from Node,
p22420
aVincluding Building, have the
p22421
aV[KnownType(typeof(type t))] attribute
p22422
aVapplied to them
p22423
aVis usually applied to the base type - i
p22424
ag50
aV(note - you can also specify the known-types in the  constructor, without requiring attributes)
p22425
aVEDIT RE YOUR REPLY
p22426
aVIf the framwork class doesn't know about all the derived types, then you need to specify the known types when creating the serializer:
p22427
aVThis can be combined with (for example)  etc by replacing the  in the previous example
p22428
aVEND EDIT
p22429
aVHowever, without something reproducible (i
p22430
ag50
aVand ), it is going to be hard to help much
p22431
aVThe other odd thing; trees structures are very well suited to things like  - there is usually no need to flatten them first, since trees can be trivially expressed in xml
p22432
aVDo you really need to flatten it
p22433
aVExample:
p22434
as(dp22435
g18
V23354
p22436
stp22437
a((dp22438
g2
(lp22439
VType forwarding allows you to relocate a type between assemblies
p22440
aVSo originally it is  in
p22441
aVBy applying type-forwarding, you can end with  in
p22442
aVThe subtlety is the code that is already compiled doesn't see the change - they ask for the type in , and the runtime silently gives them the type from
p22443
aVThis is very important if you have existing code
p22444
aVHowever; new code cannot be recompiled referencing  without you referencing
p22445
aVSo:
p22446
aVold clients don't need to be recompiled
p22447
aVhowever, you do need to rebuild both  and  in the above example
p22448
aVnew code (or any recompiled code) must now reference  (the new one)
p22449
as(dp22450
g18
V23354
p22451
stp22452
a((dp22453
g2
(lp22454
VNot sure why you didn't like this answer
p22455
aVI've highlighted the important ; however, as an alternative in
p22456
aVNET 3
p22457
aV5/C# 3
p22458
aV0: LINQ:
p22459
aV(original)
p22460
aVYou can't  within  - it breaks the iterator
p22461
aVA common approach here is to iterate backwards:
p22462
aVThis avoids the "off by one" issues, etc
p22463
as(dp22464
g18
V23354
p22465
stp22466
a((dp22467
g2
(lp22468
VRe your edit - it sounds like you should be using sp_ExecuteSQL against a (parameterized)  that contains TSQL
p22469
aVSearch on sp_ExecuteSQL; a simple example:
p22470
aVNote that table and column names must be concatenated into the query, but values (such as ) can be parameterized
p22471
aVThere is a temporary stored procedure - but it is per connection, not per sp
p22472
aVHowever, you might want to look at Common Table Expressions - they may be what you are after (although you can only read from them once)
p22473
aVMaybe if you can clarify what you are trying to do
p22474
as(dp22475
g18
V23354
p22476
stp22477
a((dp22478
g2
(lp22479
VPerhaps check
p22480
aVHowever, this is a little bit risky, as you need to be sure not to do any other operations before you check  (it updated after most operations)
p22481
aVAlternatively, read another column, like the primary key:
p22482
aVnow check  - if it is , there was no row
p22483
as(dp22484
g18
V23354
p22485
stp22486
a((dp22487
g2
(lp22488
VInside the , the context node is  - so it looks like you just need:
p22489
aVOf course, the purists would argue that it would be better to use a :
p22490
as(dp22491
g18
V23354
p22492
stp22493
a((dp22494
g2
(lp22495
VReflection; for an instance:
p22496
aVfor a type:
p22497
aVfor example:
p22498
aVFollowing feedback
p22499
aVTo get the value of static properties, pass  as the first argument to
p22500
aVTo look at non-public properties, use (for example)  (which returns all public/private instance properties )
p22501
as(dp22502
g18
V23354
p22503
stp22504
a((dp22505
g2
(lp22506
VAs far as I know, LINQ-to-SQL (etc) will never translate a query expression to FTS
p22507
aVYou have two options:
p22508
aVor write an SP to do it, and call the SP via LINQ-to-SQL / Entity Framework / etc
p22509
aVThe SP approach is, I believe, the recommended option
p22510
aVYou might be able to access FTS inside a user-defined function (UDF) - that would offer composability within LINQ, but isn't supported by all providers
p22511
as(dp22512
g18
V23354
p22513
stp22514
a((dp22515
g2
(lp22516
VAs a simple approach, you can just factor the RGB values:
p22517
aV(which should darken it; or, for example, * 1
p22518
aV25 to brighten it)
p22519
as(dp22520
g18
V23354
p22521
stp22522
a((dp22523
g2
(lp22524
VIn short, no; that is the point of partial methods - the declaring code doesn't need to know whether an implementation is provided or not
p22525
aVOf course - you could just not declare the partial method: consume it assuming it exists; if you don't provide it, the compiler will complain of a missing method
p22526
aVThere is a hacky way to check at runtime (with  methods), which is to have the other half update a  variable:
p22527
aV(and verify it changes) - but in general, partial methods are designed to not know if they are called
p22528
aVAnother approach is a base-class with an  method - then it is forced by the compiler to be implemented
p22529
as(dp22530
g18
V23354
p22531
stp22532
a((dp22533
g2
(lp22534
VDo you mean with
p22535
aVIf so, you use , with
p22536
aVHere's an example; in  is ;  overrides it
p22537
as(dp22538
g18
V23354
p22539
stp22540
a((dp22541
g2
(lp22542
VEither  (), or (more correctly) the info-schemas:
p22543
aVIf you meant something different, please clarify
p22544
as(dp22545
g18
V23354
p22546
stp22547
a((dp22548
g2
(lp22549
VI'm pretty sure that  isn't going to serialize very well - and arguably it doesn't belong in a data-contract anyway, since (being implementation specific) it defeats one of the main aims of a data-contract
p22550
aVHowever, I expect the best approach would be to swap that for a , using the 's  or
p22551
as(dp22552
g18
V23354
p22553
stp22554
a((dp22555
g2
(lp22556
VIt should be something like:
p22557
aVNote in particular the use of / instead of
p22558
as(dp22559
g18
V23354
p22560
stp22561
a((dp22562
g2
(lp22563
VAs far as I can tell, the only sensible  in the above would be something like (untested):
p22564
aVHowever, this assignment (returned at this point) won't include the key/value addition
p22565
aVWhat exactly is it you are trying to do
p22566
as(dp22567
g18
V23354
p22568
stp22569
a((dp22570
g2
(lp22571
VOne common approach (if you own both  and ) is to decorate the class with the class that provides validation, via an attribute:
p22572
aVNote that you may find it easier to work outside of generics, perhaps via an interface (note: no methods etc shown here):
p22573
aVThen obtain the correct validator via reflection:
p22574
aVSo calling  should return  or a suitable
p22575
aVYou can use generics in the above - but it usually creates more problems than it solves in example like this
p22576
as(dp22577
g18
V23354
p22578
stp22579
a((dp22580
g2
(lp22581
VYou can't do italics - but you can do bold; the bold behaviour is determined by the 's ; you can wrap s via various  tricks (,  or ) and provide your own
p22582
aVAlternatively, there are similar grids with more options, such as by VisualHint - see "Property customization" on that page
p22583
as(dp22584
g18
V23354
p22585
stp22586
a((dp22587
g2
(lp22588
VIf they are the same namespace but different assemblies, then you may need to look at "extern alias", but that gets very messy very quickly
p22589
aVIf they are different namespaces, then simply use different  directives; you can also use  aliasing
p22590
aVHowever, lambdas will always (AFAIK) use the original namespace
p22591
as(dp22592
g18
V23354
p22593
stp22594
a((dp22595
g2
(lp22596
Vedit
p22597
aVTurns out it is quite easy; edit  to add:
p22598
aVfilters to google, for example
p22599
aV(original answer)
p22600
aVI honestly don't know if this is something that Fiddler has built in (I've never tried), but it is certainly something that Wireshark will do pretty easily - of course, you get different data (in particular for SSL) - so YMMV
p22601
as(dp22602
g18
V23354
p22603
stp22604
a((dp22605
g2
(lp22606
VI expect that for that to work, you'd need to use a , not a ; try getting this from the  rather than the
p22607
aVThe default view is
p22608
aVFor info; the reason it works when you use a  as the binding-source is that  implements , and returns (from ) the default view - so actually, when you bind to a , you actaully end up binding to the default view ()
p22609
as(dp22610
g18
V23354
p22611
stp22612
a((dp22613
g2
(lp22614
VIn VS2008, AFAIK the primary tool is the xml editor, with the assistance of the "XML Schema Explorer" toolbar
p22615
aVOther than that, you have the "Dataset Designer", but this risks adding dataset-specific elements
p22616
aVA post from an MSFT support head is here; there was rumour of an out-of-band release for this, but I haven't seen anything
p22617
as(dp22618
g18
V23354
p22619
stp22620
a((dp22621
g2
(lp22622
VThe most common way of doing this is to include the binary as base-64 in an element
p22623
aVHowever, this is a workaround, and adds a bit of volume to the file
p22624
aVFor example, this is the bytes 00 to 09 (note we needed 16 bytes to encode 10 bytes worth of data):
p22625
aVhow you do this encoding varies per architecture
p22626
aVFor example, with
p22627
aVNET you might use , or
p22628
as(dp22629
g18
V23354
p22630
stp22631
a((dp22632
g2
(lp22633
VYou can create a WCF error-logger by implementing  and associating it with the service; typically (for logging) you would return  from  (allowing other handlers to execute), and log the error either in  (using the ) or in  (using the )
p22634
aVI apply this handler by writing a custom behavior (inheriting from ), which (in ) adds the error-handler to  if it isn't already there
p22635
aVThe behavior can be applied via configuration
p22636
as(dp22637
g18
V23354
p22638
stp22639
a((dp22640
g2
(lp22641
VWhat is the data that you are trying to send
p22642
aVAnd how are you serializing it
p22643
aVIf you are using , then the assembly declaring any custom types must be at both ends
p22644
aVNote that  has a range of issues with serialization across systems (including between different versions of the same system)
p22645
aVYou may want to look at other serializers, such as , or protobuf-net (for efficient, cross-platform binary transfer)
p22646
as(dp22647
g18
V23354
p22648
stp22649
a((dp22650
g2
(lp22651
VWell, you could try things like  (instead of ) - but I expect that the optimizer is already doing the best it can given the information available:
p22652
as(dp22653
g18
V23354
p22654
stp22655
a((dp22656
g2
(lp22657
VFrom non-UI threads we can't touch the UI - very bad things can happen, since controls have thread affinity
p22658
aVSo from a non-UI thread we must (at a minumum) call  or
p22659
aVFor UI-threads, however - we don't want to call  lots of time; the issue is that if you are already on the UI thread, it still has the unnecessary overhead of sending a message to the form's pump and processing it
p22660
aVIn reality, in most threading code you know you expect a specific method to be called on a non-UI thread, so in those cases, there is no additional overhead: just call
p22661
as(dp22662
g18
V23354
p22663
stp22664
a((dp22665
g2
(lp22666
VThe command line compiler is part of the standard
p22667
aVNET framework
p22668
aVExpress 2005 has been retired, AFAIK
p22669
aVThe current C# express download is 2008 Express with Service Pack 1, which includes:
p22670
aVNET Framework 3
p22671
aV5 SP1 (and all previous service packs, such as 2
p22672
aV0 SP2, 3
p22673
aV0 SP1, etc)
p22674
aVVisual C# Express 2008 SP1
p22675
as(dp22676
g18
V23354
p22677
stp22678
a((dp22679
g2
(lp22680
VWell, the closest translation would be:
p22681
aVsince it hasn't been assigned, or:
p22682
aVif it had been previously assigned
p22683
aVHowever, the code itself is very unsafe (you shouldn't assume  reads all the requested data); a much simpler approach here is:
p22684
as(dp22685
g18
V23354
p22686
stp22687
a((dp22688
g2
(lp22689
VViewData is a dictionary; you can store multiple items in there, simply via:
p22690
aVYou can then get these (separately) in the view
p22691
aVThe other approach is to declare a type that encapsulates both properties, and use an instance of that type as the model (and a typed view)
p22692
aVPersonally, I prefer the simple key/cast approach
p22693
as(dp22694
g18
V23354
p22695
stp22696
a((dp22697
g2
(lp22698
VHaving checked what java returns (1970/1/1 etc):
p22699
as(dp22700
g18
V23354
p22701
stp22702
a((dp22703
g2
(lp22704
VWell, you could automate it with reflection and generics, but IMO overloads are the better choice - very much like your existing code
p22705
aVReflection / generics example - although I don't really recommend this route:
p22706
aVYou would then mix that with an  generic method that calls  etc
p22707
as(dp22708
g18
V23354
p22709
stp22710
a((dp22711
g2
(lp22712
VIf you must use xml; then rather than passing around a dictionary, I'd use a class that represents that data, and use  to fetch it as xml:
p22713
aVThis makes it much easier to manage which arguments apply to which queries, in an object-oriented way
p22714
aVIt also means you don't have to do your own xml escaping
p22715
as(dp22716
g18
V23354
p22717
stp22718
a((dp22719
g2
(lp22720
VAre you perhaps using an anonymous type in the projection
p22721
ag412
ag50
aV(or similar) - anonymous types in C# are immutable, so yes: it will seem read only
p22722
aVHowever, regular classes (either the LINQ-generated ones, or your own) should be editable
p22723
aVThe only thing to remember is to call  on any query (rather than giving it the / object)
p22724
as(dp22725
g18
V23354
p22726
stp22727
a((dp22728
g2
(lp22729
VTweaks:
p22730
aVstill replaces metadata (not extends)
p22731
aVcan also be added be
p22732
aVcan be applied per-type as well as per-instance, making it possible to apply to lists without having to implement
p22733
aVfor , this is also the mechanism used to obtain metadata; note that  simply delegates to , but this is not always the case
p22734
aValso responsible for re-creating immutable objects (such as structs) with changes
p22735
aValso responsible for painting the preview box in
p22736
aVAdditional:
p22737
aV- appends properties; this may be what you were getting confused with
p22738
aV- broadly the twin of , but for lists; can be avoided by use of  and a non-object indexer on any , i
p22739
ag50
aV- provides indirection between a data-source and the data; for example, a  implements , returning  when requested
p22740
as(dp22741
g18
V23354
p22742
stp22743
a((dp22744
g2
(lp22745
VThat is a "code access security policy" (caspol) issue - i
p22746
ag50
aVyour WPF app isn't running in full trust, and doesn't have the cited permission
p22747
aVIf you are deploying with ClickOnce, you can allocate which permissions your app should request on the Security tab (project properties)
p22748
aVYou can also request full trust if needed
p22749
as(dp22750
g18
V23354
p22751
stp22752
a((dp22753
g2
(lp22754
VFrom what I can see, you are going to have to loop over the contents (or at least, a portion of it); there is no other way of talking about an arrays contents
p22755
aVWell, as a fast "definitely not the same" you could compute a hash over the array - i
p22756
ag50
aVsomething like:
p22757
aVThis has the risk of some false positives (reporting a dup when it is unique), but is otherwise quite cheap
p22758
aVAny use
p22759
aVYou could store the hash alongside the data in the database to allow fast checks - but if you do that you should pick your own hash algorithm for  (since it isn't guaranteed to stay the same) - perhaps just convert to an int, for example - or to re-use the existing implementation:
p22760
aVAs an aside - for 8x8, you could always just think in terms of a 64 character string, and just check
p22761
aVThis would work equally well at the database and application
p22762
as(dp22763
g18
V23354
p22764
stp22765
a((dp22766
g2
(lp22767
VI expect you'll need to copy the data out - i
p22768
ag50
aVadd a scratch column, fill it; drop the old column; add the new column, copy the data back, remove the scratch column:
p22769
aVFor applying database-wide, you can script it out from info-schema (note you should filter out any system tables etc):
p22770
as(dp22771
g18
V23354
p22772
stp22773
a((dp22774
g2
(lp22775
VThat xml is pretty
p22776
aVhorrible
p22777
aVMy first suggestion would be to run it through an xslt transformation to get it into something more normal, that can be loaded with
p22778
aVCurrently, it is abusing namespaces horribly
p22779
aVAlternatively, forget , and parse it with  or similar
p22780
aVHere's an approach using  (and using LINQ just for the average, to save a few lines of code):
p22781
aVFor example of normal xml:
p22782
aVor something comparable
p22783
aVDon't use the element name to infer identity
p22784
as(dp22785
g18
V23354
p22786
stp22787
a((dp22788
g2
(lp22789
VYou would have to assign such an identifier yourself, manually - either inside the instance, or externally
p22790
aVFor records related to a database, the primary key may be useful (but you can still get duplicates)
p22791
aVAlternatively, either use a , or keep your own counter, allocating using  (and make it large enough that it isn't likely to overflow)
p22792
as(dp22793
g18
V23354
p22794
stp22795
a((dp22796
g2
(lp22797
VIn the generated code, what constructor does it have
p22798
aVIf a (non-abstract, non-static) class doesn't have any explicit constructor, it gets a default constructor (public, parameterless)
p22799
aVSo what code are you seeing (for this object) in the generated code
p22800
as(dp22801
g18
V23354
p22802
stp22803
a((dp22804
g2
(lp22805
VThe user id is commonly inferred from your authentication mechanism (cookie etc), so for the current user you shouldn't need to pass it around
p22806
aVThe main time you would include this in the request is when the page being displayed relates to users - and in particular where you (or an admin) want to browse other users records - then you might use "/users/current/orders" (use the cookie) or "/users/12345/orders" (and you should verify permission to browse 12345)
p22807
aVNote that if you use /current/ or similar, you should ensure it isn't cached between different users - so in many ways it is simpler to just show the user-id and to heck with the url; just go for the simple "/users/12345/orders" case
p22808
aVWhat is the scenario here
p22809
as(dp22810
g18
V23354
p22811
stp22812
a((dp22813
g2
(lp22814
VIndeed that might be useful, but it is what it is
p22815
aVThere is no sign of this in C# 4
p22816
aV0, so you'll just have to use either a constructor or a field (and manual property implementation)
p22817
aVRe your "for any class with a public parameterless constructor" - actually, I'd assume that any implementation would be directly comparable to field initializers, so would work regardless of the constructor composition
p22818
as(dp22819
g18
V23354
p22820
stp22821
a((dp22822
g2
(lp22823
VI would assume that Redmon streams to stdin - in which case you'll have to read from the input stream - either via Console
p22824
aVIn (if it is character-based), or Console
p22825
aVOpenStandardInput (for raw binary stream access)
p22826
aVAs a trivial example of something that reads from stdin (it reads text lines, reversing each):
p22827
aVObviously you need to treat binary data slightly differently, but conceptually it is  similar
p22828
as(dp22829
g18
V23354
p22830
stp22831
a((dp22832
g2
(lp22833
VThe initial speed indeed sounds like Fusion+JIT, which would be helped by ILMerge (for Fusion) and NGEN (for JIT); you could always play a silent track through the system at startup so that this does all the hard work without the user noticing any distortion
p22834
aVNGEN is a good option; is there a reason you can't use it
p22835
aVThe issues you mention after the initial load do not sound like they are related to JIT
p22836
aVPerhaps garbage collection
p22837
aVHave you tried profiling
p22838
aVBoth CPU and memory (collections)
p22839
as(dp22840
g18
V23354
p22841
stp22842
a((dp22843
g2
(lp22844
VWhat specific scenario are you trying to guard against
p22845
aVA DataContext is not the same as a DataSet - it isn't (necessarily) a container of data (identity management / change tracking aside) - it is a source of data
p22846
aVIn general, it won't give you an object (from a query) if an error occurs - it'll throw an exception
p22847
aVSo if you have been given an instance by LINQ-to-SQL, it should have something in it
p22848
aVAre you seeing a specific problem that you want to avoid
p22849
as(dp22850
g18
V23354
p22851
stp22852
a((dp22853
g2
(lp22854
VIn short, when there is an implicit or explicit conversion operator defined:
p22855
as(dp22856
g18
V23354
p22857
stp22858
a((dp22859
g2
(lp22860
VTrivial, but slighty nicer to call
p22861
as(dp22862
g18
V23354
p22863
stp22864
a((dp22865
g2
(lp22866
VIt certainly sounds like the MSDN article could be misleading
p22867
aVhowever, LINQ-to-SQL, while still alive, isn't getting vast amounts of dev time, so I wouldn't hold my breath waiting for an update
p22868
aVYou could post on connect, or perhaps add a remark to the MSDN page (Community Content)
p22869
as(dp22870
g18
V23354
p22871
stp22872
a((dp22873
g2
(lp22874
VIt is fine to mix and match; ultimately, when you use a  constructor, it will eventually get to a ctor that calls  first
p22875
aVIt makes sense to re-use logic where required
p22876
aVYou could arrange it so that all the constructors called a common (maybe private)  constructor that is the only one that calls down to the  - but that depends on whether a: it is useful to do so, and b: whether there is a single  ctor that would let you
p22877
as(dp22878
g18
V23354
p22879
stp22880
a((dp22881
g2
(lp22882
VFor SQL Server, I found this "connect" entry, but no: I don't think TDS is currently compressed
p22883
aVYou could (although I don't like it much) use SQL-CLR to compress it in
p22884
aVNET code, but it could have too much overhead
p22885
aVI know it isn't an option in this case (from the question), but it is usually preferable to store BLOBs the way you want to get them
p22886
aVSo if you want to get them compressed, store them compressed
p22887
aVSQL isn't a good tool for manipulating binary ;-p Such a strategy also means that you aren't using vendor-specific features - just the ability to store an opaque BLOB
p22888
as(dp22889
g18
V23354
p22890
stp22891
a((dp22892
g2
(lp22893
VWell, there is a lot of wisdom with using what you know (Java)
p22894
aVHowever, just to counter the "because of it's huge numbers of useful libraries and free IDE's" -
p22895
aVNET also has a huge library base, and free IDEs (including the Express editions of Visual Studio)
p22896
aVFor
p22897
aVNET, C# would be a "closer" language to Java than VB
p22898
aVI reckon you'll end up with Java, though (through familiarity - not always a bad thing)
p22899
as(dp22900
g18
V23354
p22901
stp22902
a((dp22903
g2
(lp22904
VIt sounds like "dev" and "live" use different versions
p22905
aVNot using the same product on your dev/production servers is a liability
p22906
aVA "conservative" DBA should want them to match
p22907
aVI'm unclear - are you writing the function that "returns a table with first, middle, last, and suffix", or consuming it
p22908
aVIf you are consuming it, you should just be able to  from the UDF, or  to it, etc
p22909
aVIIRC, you just alias the UDF as you would a table:
p22910
as(dp22911
g18
V23354
p22912
stp22913
a((dp22914
g2
(lp22915
VFor this type of cumulative , you need to tell the compiler to use :
p22916
as(dp22917
g18
V23354
p22918
stp22919
a((dp22920
g2
(lp22921
VWith LINQ-to-SQL, you want
p22922
as(dp22923
g18
V23354
p22924
stp22925
a((dp22926
g2
(lp22927
VThe problem is that garbage collection only happens when there is memory pressure
p22928
aVOften, unmanaged handles are more restricted than memory, so you can run out of handles before GC happens, causing errors
p22929
aVBut for one or two  instances, it won't hurt you overly
p22930
aVA bigger problem is that some of the objects are shared and shouldn't (or can't ) be disposed prematurely
p22931
as(dp22932
g18
V23354
p22933
stp22934
a((dp22935
g2
(lp22936
VTo do that you would need to introduce an extra layer into the object model, too
p22937
aVlikes the xml to be (roughly) a direct map to the objects:
p22938
aVThe only other option is to implement , but you really don't want to do that unless you absolutely have no choice
p22939
as(dp22940
g18
V23354
p22941
stp22942
a((dp22943
g2
(lp22944
VFortunately, there is  and  which handles this format:
p22945
aV(pick your appropriate serialization-mode)
p22946
as(dp22947
g18
V23354
p22948
stp22949
a((dp22950
g2
(lp22951
VWell, if  implements , and your  implementation can be sure to get rid of any resources, then it should work
p22952
aVbut there can be other side effects
p22953
aVThe code could change global (static) state, such as culture etc
p22954
aVIt could spawn threads
p22955
aVAll sorts of things
p22956
aVIt isn't a bad approach, but you need to know what the code you are encapsulating does to know whether  is going to do anything useful
p22957
as(dp22958
g18
V23354
p22959
stp22960
a((dp22961
g2
(lp22962
VInteresting
p22963
aVthe best I can suggest is to use  on  - and does ActiveRecord have a similar way of ignoring a member
p22964
aVYou could do something like:
p22965
as(dp22966
g18
V23354
p22967
stp22968
a((dp22969
g2
(lp22970
VYou can use ILMerge to combine them into one
p22971
as(dp22972
g18
V23354
p22973
stp22974
a((dp22975
g2
(lp22976
VIt would be pretty easy to write:
p22977
as(dp22978
g18
V23354
p22979
stp22980
a((dp22981
g2
(lp22982
VIt is "better" in that:
p22983
aVit is cheaper to use  (inheritance) where possible - it removes the need for a few extra objects (delegate instances, etc)
p22984
aVit allows the overriding code to know where it comes in the sequence - i
p22985
ag50
aVif multiple callers are listening, does it fire first
p22986
aVsecond
p22987
aVin the middle
p22988
aVThe first point is arguably more important for efficiency, especially in things like controls that have sparse event handlers (i
p22989
ag50
aVthings like  instead of a field-like-event)
p22990
aVI don't really understand the second question, but at a guess: convention
p22991
as(dp22992
g18
V23354
p22993
stp22994
a((dp22995
g2
(lp22996
VFields are automatically initialized to the logical zero for the type; this is implicit
p22997
aVVariables must obey "definite assignment", so must be assigned before they can be read
p22998
aVECMA 334v4
p22999
aV17
p23000
ag7733
aV4 Field initialization
p23001
aVThe initial value of a field, whether
p23002
aVit be a static field or an instance
p23003
aVfield, is the default value (12
p23004
aV2) of
p23005
aVthe field\u2019s type
p23006
aVIt is not possible
p23007
aVto observe the value of a field before
p23008
aVthis default initialization has
p23009
aVoccurred, and a field is thus never
p23010
aV"uninitialized"
p23011
aVand
p23012
aV12
p23013
aVVariables
p23014
aVA variable shall be definitely assigned (12
p23015
aV3) before its
p23016
aVvalue can be obtained
p23017
as(dp23018
g18
V23354
p23019
stp23020
a((dp23021
g2
(lp23022
VPersonally, I'd be looking at using jQuery to invoke an ASP
p23023
aVNET MVC action; much simpler pipeline, and you know exactly what is going up and down the wire
p23024
as(dp23025
g18
V23354
p23026
stp23027
a((dp23028
g2
(lp23029
VYou could see this existing answer, which has such a queue
p23030
as(dp23031
g18
V23354
p23032
stp23033
a((dp23034
g2
(lp23035
VPartial methods are not usable over inheritance
p23036
aVYou could add regular methods to the abstract base class, but they won't automatically "pair" with the partial method declarations
p23037
aVSo: no
p23038
aVYou can, of course, simply have the partial method implementation call into the base-class
p23039
aVNote also that if the common code relates to things like audit (who/when), you can also do this by overriding the 's  method, and calling :
p23040
aVFinally, note that you can also specify a common base-class for all your entities in the dbml (like so); you don't have to do it by hand in each partial class
p23041
as(dp23042
g18
V23354
p23043
stp23044
a((dp23045
g2
(lp23046
VWell, you could generate a random seed when doing the first query (in your app code), and then keep that seed between requests - and supply this seed to the  function
p23047
aVThat should do it
p23048
aVOf course, the specifics would depend on how exactly your sql code is working at the moment; you might need to loop to comsume the first page (or so) of random numbers to ignore
p23049
as(dp23050
g18
V23354
p23051
stp23052
a((dp23053
g2
(lp23054
VI'm very confused why you're using  with a data-contract
p23055
aVIt would be normal to use  here
p23056
aVthe logic is then similar to using , except you need ], and it serializes the nominated () members, rather than the fields which  works with
p23057
aVActually, for numerous reasons (such as brittleness) I would suggest switching to , especially as that seems to be your intention
p23058
aVOr if you want a more compact binary form, protobuf-net may be useful (plus is portable between platforms, too)
p23059
aVAs an aside - you don't need the  on s - it does no harm, but doesn't do a lot either
p23060
as(dp23061
g18
V23354
p23062
stp23063
a((dp23064
g2
(lp23065
VThere is nothing in your query that would filter the contracts () - only the companies themselves
p23066
aVYou would need to do that separately, perhaps via a  on
p23067
aVIf you are loading the data from LINQ-to-SQL, then  may be uesful
p23068
aVIf you want all contracts in the range regardless of company, then perhaps :
p23069
as(dp23070
g18
V23354
p23071
stp23072
a((dp23073
g2
(lp23074
VRe your conundrum; I'm assuming  is a generic method
p23075
aVYou would need to invoke it with reflection:
p23076
aVwhere  is  for a static method, or  for an instance method on the current instance
p23077
aVFurther - I wouldn't assume that all collections are a: based on , b: generic types
p23078
aVThe important thing is: do they implement  for some
p23079
aVHere's a complete example:
p23080
as(dp23081
g18
V23354
p23082
stp23083
a((dp23084
g2
(lp23085
s(dp23086
g18
V23354
p23087
stp23088
a((dp23089
g2
(lp23090
VYou need to tell it to use  (or a custom converter) for
p23091
aVIn C#, this is:
p23092
aVHowever you apply attributes in VB, do that ;-p
p23093
aVPossibly:
p23094
as(dp23095
g18
V23354
p23096
stp23097
a((dp23098
g2
(lp23099
VIt sounds like you've used a control or component in the web-service interface (i
p23100
ag50
aVas a return value or method argument)
p23101
aVThat won't work - as it needs to serialize (typically) as xml
p23102
aVYou would typically send data in objects - not controls
p23103
aVWhat does the service interface look like
p23104
as(dp23105
g18
V23354
p23106
stp23107
a((dp23108
g2
(lp23109
VWell, the least "moving parts" would be to do the processing in TSQL at the db server, but that may not be a good idea (depending on the scenario)
p23110
aVAssuming you want to do the processing in C#, you should probably host a WCF or asmx (WSE) service in a web-server such as IIS - and add a service reference between your client app and the service
p23111
aVThe service does the call to the database and the processing, and returns the
p23112
aVHowever, this is quite a bit of infrastructure
p23113
aVYou can also host WCF in a windows service (or even a console exe), which might make life easier (no IIS)
p23114
as(dp23115
g18
V23354
p23116
stp23117
a((dp23118
g2
(lp23119
VYou could try  and  - probably less overhead (no objects - just strings etc)
p23120
as(dp23121
g18
V23354
p23122
stp23123
a((dp23124
g2
(lp23125
VTry:
p23126
aVYou are trying to pass in the property () as the target object, instead of
p23127
aVFor info, if you are doing lots of this, maybe consider HyperDescriptor, which can vastly reduce the reflection cost
p23128
as(dp23129
g18
V23354
p23130
stp23131
a((dp23132
g2
(lp23133
VPublic static readonly fields are a little unusual; public static properties (with only a ) would be more common (perhaps backed by a private static readonly field)
p23134
aVConst values are burned directly into the call-site; this is double edged:
p23135
aVit is useless if the value is fetched at runtime, perhaps from config
p23136
aVif you change the value of a const, you need to rebuild all the clients
p23137
aVbut it can be faster, as it avoids a method call
p23138
aVwhich might sometimes have been inlined by the JIT anyway
p23139
aVIf the value will never change, then const is fine -  etc make reasonable consts ;-p Other than that, static properties are more common
p23140
as(dp23141
g18
V23354
p23142
stp23143
a((dp23144
g2
(lp23145
VWith , you can use , but this is still very brittle
p23146
aVHow about protobuf-net
p23147
aVDoes all that, and doesn't have the versioning issues associated with BinaryFormatter
p23148
aVSince it is based on Google's "protocol buffers" format, it is designed to be version tolerant and extensible (disclosure: I'm the author, so I may be biased)
p23149
aVAlternatively,  supports field serialization; just set  against your fields instead of the properties (requires
p23150
aVNET 3
p23151
aV0)
p23152
as(dp23153
g18
V23354
p23154
stp23155
a((dp23156
g2
(lp23157
VUnless you can get some kind of callback into the 3rd-party code (maybe a completion event), you are going to struggle to know when they have stopped using the
p23158
aVSorry
p23159
aVSuch code should typically be on a non-background thread
p23160
aVI realise you don't have control over this - I'm just not sure that there is an easy way out of the hole, either
p23161
as(dp23162
g18
V23354
p23163
stp23164
a((dp23165
g2
(lp23166
VThen just :
p23167
aV(edit) Actually - the names could be inferred in this case, so you could use:
p23168
aVwhich saves a few electrons
p23169
as(dp23170
g18
V23354
p23171
stp23172
a((dp23173
g2
(lp23174
VWell, it probably isn't how I'd write it, but:
p23175
aVRe your comment; I'm not entirely clear on the question; if you mean "why is this useful
p23176
aV- among other things, there are a range of brute-force scenarios where you would want to try different permutations - for example, for small ordering problems like travelling sales person (that aren't big enough to warrant a more sophisticated solution), you might want to check whether it is best to go {base,A,B,C,base}, {base,A,C,B,base},{base,B,A,C,base}, etc
p23177
aVIf you mean "how would I use this method
p23178
aV- untested, but something like:
p23179
aVIf you mean "how does it work
p23180
aV- iterator blocks () are a complex subject in themselves - Jon has a free chapter (6) in his book, though
p23181
aVThe rest of the code is very much like your original question - just using LINQ to provide the moral equivalent of  (for arrays)
p23182
as(dp23183
g18
V23354
p23184
stp23185
a((dp23186
g2
(lp23187
VThe main difference is that this allows you to seize more control if you provide your own  implementation (via ,  or )
p23188
aVThen you can choose your own logic for when it is writeable - for example, based on access rights
p23189
aVBut yes; under the default implementation, it will report read-only for properties without setters, and for properties marked with
p23190
as(dp23191
g18
V23354
p23192
stp23193
a((dp23194
g2
(lp23195
VAs a minimum I include comments for the public API and generate the xml file
p23196
aVThat is enough to make intellisense work, and it also shows up in Reflector
p23197
aVPersonally, I don't bother with sandcastle etc - but I might for ISV projects
p23198
as(dp23199
g18
V23354
p23200
stp23201
a((dp23202
g2
(lp23203
VOn the hosted provider, is the app in the site root
p23204
aVor in a sub-folder
p23205
aVDoes your development environment match the setup at the server in this respect
p23206
aVYou may need to ensure you work relative to the app root, ~/
p23207
aVFundamentally, this is similar to the same problem (with scripts) discussed here
p23208
as(dp23209
g18
V23354
p23210
stp23211
a((dp23212
g2
(lp23213
Visn't that just
p23214
aVNote that it would be better to introduce a second generic, such that the list is typed:
p23215
aVNote I switched from  to just , as it seemed to serve no purpose
p23216
as(dp23217
g18
V23354
p23218
stp23219
a((dp23220
g2
(lp23221
VAnother option: NArrange;
p23222
aVfree
p23223
aVconsole based (so good for commit hooks etc, but can still be used as an "External Tool" in VS)
p23224
aVflexible config file
p23225
as(dp23226
g18
V23354
p23227
stp23228
a((dp23229
g2
(lp23230
VWell, the first thing to note is that actually, lambda expressions can be recursive
p23231
aVNo, honestly
p23232
aVIt isn't easy to do, and certainly isn't easy to read - heck, most LINQ providers (except LINQ-to-Objects, which is much simpler) will have a coughing fit just looking at it
p23233
aVbut it is possible
p23234
aVSee here for the full, gory details (warning - brain-ache is likely)
p23235
aVHowever
p23236
aVThat probably won't help much
p23237
aVfor a practical approach, I'd look at the way  etc does it
p23238
aVnote you can remove some of the recursion using a  or :
p23239
aVAn alternative would be to write something like  (to mimic  for single levels):
p23240
aVAgain, I haven't optimised this to avoid recursion, but it could be done easily enough
p23241
as(dp23242
g18
V23354
p23243
stp23244
a((dp23245
g2
(lp23246
VRe the problem with names getting misspelt - that is what constants are for
p23247
aVFor  to be typed appropriately, you'd need to inherit etc; so by the time you've done that, I wonder if you couldn't just as easily add some common code into the controller that sets a key
p23248
aVUsing a key seems, to me at least, the least complex answer - that also works in the widest number of cases (i
p23249
ag50
aVwhere certain code only knows about a basic )
p23250
aVYou may also be interested in this related question
p23251
as(dp23252
g18
V23354
p23253
stp23254
a((dp23255
g2
(lp23256
VWell, in a garbage collected world where all objects are accessed via references, the subtle difference (in ownership) between strict composition and aggregation blurs a little - so in general (when using classes) it boils down to a field for the other object or collection:
p23257
aVIf I've missed the point, please clarify
p23258
aVThings are more involved when you discuss s - but generally when talking about OO concepts,  usage is limited to value fields
p23259
as(dp23260
g18
V23354
p23261
stp23262
a((dp23263
g2
(lp23264
VFirst - if you are being culture specific, why not just use "C" as the format string, and hence use the culture's currency format
p23265
aVCustom numeric format strings don't have a currency token; I suspect, however, that you could just append the currency symbol to the string you get from formatting with "### ###,00"
p23266
as(dp23267
g18
V23354
p23268
stp23269
a((dp23270
g2
(lp23271
VNo, there aren't such things as virtual extension methods
p23272
aVYou could use overloading, but that doesn't support polymorphism
p23273
aVIt sounds like you might want to look at something like dependency injection (etc) to have different code (dependencies) added in different environments - and use it in regular virtual methods:
p23274
aVThen use a DI framework to provide a server-specific  implementation to  at runtime
p23275
aVYou can do the same thing with a central  registry (IOC, but no DI):
p23276
aV(where you'd need to write  etc; plus on the server, register the  implementation)
p23277
as(dp23278
g18
V23354
p23279
stp23280
a((dp23281
g2
(lp23282
VYou can do this fairly easily in either a controller base-class, or an action-filter that is applied to the controllers/actions
p23283
aVIn either case, you get the chance to touch the request before (or after) the action does - so you can add this functionality there
p23284
aVFor example:
p23285
aV(can also be used at the action (method) level)
p23286
aVor with a common base-class:
p23287
as(dp23288
g18
V23354
p23289
stp23290
a((dp23291
g2
(lp23292
VIf you are using reflection, generics gets very tricky
p23293
aVCan you simply use the non-generic interfaces
p23294
aV/
p23295
aVIt would be a lot easier
p23296
aVsomething like:
p23297
as(dp23298
g18
V23354
p23299
stp23300
a((dp23301
g2
(lp23302
VDoes  etc belong to you
p23303
aVYou could add an implicit conversion operator:
p23304
aVNormally, this would be one of the times that interfaces ( etc) help - but interfaces don't often work very well in web services
p23305
aVDepending on what the code currently does, you might be able to do a "replace all" fix - a bit drastic, though; other than that
p23306
aVyou're going to have to change odd bits of code
p23307
aVa few thoughts:
p23308
aVswitching to  (in C# 3
p23309
aV0) might minimize the change - i
p23310
ag50
aV; in most cases, the different implementations will have "similar enough" APIs
p23311
aVresharper might be able to help with this
p23312
aVusing LINQ (, ) might serve as a shim
p23313
as(dp23314
g18
V23354
p23315
stp23316
a((dp23317
g2
(lp23318
VThe session only really exists during the processing of an action - I wouldn't expect it to be valid in the constructor of a controller
p23319
aVFor example, the controller might (for all I know) be re-used between requests
p23320
aVYou will need to do this either in the action (method), or (perhaps more appropriately) in an action filter, or the  (etc) method(s):
p23321
as(dp23322
g18
V23354
p23323
stp23324
a((dp23325
g2
(lp23326
VYour example isn't clear, and doesn't (IMO) show typical capture usage (the only thing captured is , which is always 3, so not very interesting)
p23327
aVConsider this text-book example (a predicate):
p23328
aVNow try it without a closure; you need to do a lot more work, even if we are lazy:
p23329
aVThe capture approach extends further to lots of variables at different scopes - a lot of complexity that is hidden
p23330
aVOther than the names, the above is an approximation of what the C# compiler does behind the scenes
p23331
aVNote that when additional scopes are involved we start chaining the different capture classes (i
p23332
ag50
aVinner scopes have a reference to the capture class of outer scopes)
p23333
aVQuite complex
p23334
aVJon Skeet has a good article on this here, and more in his book
p23335
as(dp23336
g18
V23354
p23337
stp23338
a((dp23339
g2
(lp23340
VThe LINQ-to-SQL classes can be used with  (for WCF) easily enough (you need to enable the serialization property in the designer, though)
p23341
aVWith this in place, you should be able to share the data assembly with the client
p23342
aVAs long as you don't use the data-context, the objects themselves should be well behaved (just disconnected - so no lazy loading)
p23343
aVThe trick is that you need to re-use these types (from the existing assembly) in your serialization code
p23344
aVIf you are using WCF, you can do this with , or via the IDE
p23345
aVThat said though; it is often cleaner to maintain separate DTO classes for these scenarios
p23346
aVBut I'm guilty of doing it the above way on occasion
p23347
as(dp23348
g18
V23354
p23349
stp23350
a((dp23351
g2
(lp23352
VAt the moment, the  (in the article you cite) is the only way in the MS
p23353
aVNET implementation
p23354
aVThe "compiler as a service" is one of the
p23355
aVNET vFuture features, and provides exactly what you ask for
p23356
aVMono 2
p23357
aVx already has something comparable, IIRC (as discussed here)
p23358
as(dp23359
g18
V23354
p23360
stp23361
a((dp23362
g2
(lp23363
VIn IIS, go to the ASP
p23364
aVNET tab (folder properties), and change it to 1
p23365
ag6106
aVThat should do it
p23366
as(dp23367
g18
V23354
p23368
stp23369
a((dp23370
g2
(lp23371
VIf you want to use remoting then you are limited to
p23372
aVNormally,  you can use a "serialization surrogate" to provide a serializer separate to the formatter, but AFAIK this deoesn't work with
p23373
aVNET remoting
p23374
aVHowever; if you write your own RPC stack (over TCP/IP or HTTP, for example), you'll have a lot more control
p23375
aVEqually, with WCF you can replace the serializer via a behavior
p23376
aVI use both of these tricks in protobuf-net (the WCF hooks are here)
p23377
aVNot sure you can do this with remoting though - you'd probably have to use
p23378
as(dp23379
g18
V23354
p23380
stp23381
a((dp23382
g2
(lp23383
VFor transfer and offline storage, serialization is fine; but for active use, some kind of database is far preferable
p23384
aVTypically (as you say), without a database, you need to deserialize the entire stream to perform any query, which makes it hard to scale
p23385
aVAdd the inherent issues with threading etc, and you're asking for pain
p23386
aVSome of your other pain points about serialization aren't all true - as long as you pick wisely
p23387
aVObviously,  is a bad choice for portability and versioning, but "protocol buffers" (Google's serialization format) has versions for Java, C++, C#, and a lot of others, and is designed to be version tolerant
p23388
as(dp23389
g18
V23354
p23390
stp23391
a((dp23392
g2
(lp23393
VIn
p23394
aVNET winforms, all messages go to , so you can override that:
p23395
aVIf I have misunderstood, please say - but I think you would do well to avoid this low-level approach, and describe what you want to achieve - i
p23396
ag50
aVit might be that / are more appropriate
p23397
as(dp23398
g18
V23354
p23399
stp23400
a((dp23401
g2
(lp23402
VThe Expression API that underpins LINQ etc is founded on reflection (), not the component-model ( etc) - so there is not a huge requirement for
p23403
aVInstead, the contents are inferred from the  in ,  and  etc
p23404
aVThe closest you might get is , but that will still just be a shallow wrapper around a proper typed list
p23405
aVIf performance of runtime binding (to ) is key, you might want to look at HyperDescriptor - which uses  and  to wrap the component-model
p23406
aVRe the "why" etc; note that in almost all cases with LINQ-to-SQL and EF the  (or the "create and set members" part) is going to be compiled to a delegate before it is invoked - so at runtime there is no huge reflection cost
p23407
aVAnd likewise, with LINQ-to-Objects everything is already compiled (by the C# compiler)
p23408
as(dp23409
g18
V23354
p23410
stp23411
a((dp23412
g2
(lp23413
VThe simplest approach here is often to simply use a poll - i
p23414
ag50
aVhave the clients query for data every (your time interval)
p23415
aVThat avoids a whole family of issues (firewalls, security, line-of-sight, resolution, client-tracking, etc)
p23416
aVWith WCF, you can have callbacks on duplex channels (allowing the server to actively send a message to clients), but this is more complex
p23417
aVI value simplicity, so I usually just poll
p23418
aVTricks that help here are designing the system to have an inbuilt mechanism for querying "changes since x" - for example, an audit table, perhaps fed by database triggers
p23419
aVThe exact details vary per project, of course
p23420
aVAnother option that you might want to look at is ADO
p23421
aVNET Sync Services; this does much of what you ask for, for keeping a local copy of the database up to date with the server - but has a few complexities of its own
p23422
aVThis is available (IIRC) in the "Local Database Cache" VS template
p23423
as(dp23424
g18
V23354
p23425
stp23426
a((dp23427
g2
(lp23428
VYou can do this with , and saving the document to an :
p23429
as(dp23430
g18
V23354
p23431
stp23432
a((dp23433
g2
(lp23434
VLooks OK to me; you might want to see whether a "model binder" could be used in the parsing layer, so that you use just {id} in the route, and have , and have the model-binder automatically parse the
p23435
aVAlternatively (and perhaps more simply), I seem to recal that it will also use  here - so perhaps write a  for your color class/struct ( above)
p23436
aVExample converter:
p23437
as(dp23438
g18
V23354
p23439
stp23440
a((dp23441
g2
(lp23442
VWell, I'm not familiar with it, and you don't show what you are doing
p23443
aVbut some thoughts:
p23444
aVsimplify the gcd; you don't need to know the answer - just whether there is any common factor - so factorise the smaller number (from the list of primes) and test each term against the larger number
p23445
as(dp23446
g18
V23354
p23447
stp23448
a((dp23449
g2
(lp23450
VMaybe consider an "" trigger and do the check yourself
p23451
aVWith a non-clustered (non-unique) index on the column to enable the lookup
p23452
as(dp23453
g18
V23354
p23454
stp23455
a((dp23456
g2
(lp23457
VIf you sometimes need an expression and sometimes need a delegate, you have 2 options:
p23458
aVhave different methods (1 for each)
p23459
aValways accept the  version, and just  it if you want a delegate
p23460
aVObviously this has cost
p23461
as(dp23462
g18
V23354
p23463
stp23464
a((dp23465
g2
(lp23466
VYou would have to loop, I suspect:
p23467
as(dp23468
g18
V23354
p23469
stp23470
a((dp23471
g2
(lp23472
VThe endpoints are indeed normally specified in the configuration file
p23473
aVYou must look at the serviceModel data in the config file, and copy it into your calling app
p23474
aVconfig - or you need to use the more verbose way of creating the proxies in your code (i
p23475
ag50
aVspecifying the address, binding, configuration etc through code to the constructors)
p23476
as(dp23477
g18
V23354
p23478
stp23479
a((dp23480
g2
(lp23481
VHow does the ingragistics control operate
p23482
aVDoes it become a gif/png/etc
p23483
aVOr is it ActiveX/flash/etc
p23484
aVFor image-based graphs, there are a range of tools that will do the job of scraping html+images to pdf, including HTMLDOC, ABCpdf, etc
p23485
aVGenerate your PDF, and use the file as an attachment
p23486
aVYou'll still need a web-server to generate the image - but you never have to view the page; it becomes essentially a glorified web-service
p23487
as(dp23488
g18
V23354
p23489
stp23490
a((dp23491
g2
(lp23492
VEvery time you do  it is initialized using the clock
p23493
aVThis means that in a tight loop you get the same value lots of times
p23494
aVYou should keep a single  instance and keep using  on the same instance
p23495
aVEdit (see comments): why do we need a  here
p23496
aVBasically,  is going to change the internal state of the  instance
p23497
aVIf we do that at the same time from multiple threads, you could argue "we've just made the outcome even more random", but what we are actually doing is potentially breaking the internal implementation, and we could also start getting the same numbers from different threads, which might be a problem - and might not
p23498
aVThe guarantee of what happens internally is the bigger issue, though; since  does not make any guarantees of thread-safety
p23499
aVThus there are two valid approaches:
p23500
aVsynchronize so that we don't access it at the same time from different threads
p23501
aVuse different  instances per thread
p23502
aVeither can be fine; but mutating a single instance from multiple callers at the same time is just asking for trouble
p23503
aVThe  achieves the first (and simpler) of these approaches; however, another approach might be:
p23504
aVthis is then per-thread, so you don't need to synchronize
p23505
as(dp23506
g18
V23354
p23507
stp23508
a((dp23509
g2
(lp23510
VThe simplest option is probably to extract the data, sort it in a mechanism that already supports sorting (arrays,  or  via LINQ), and re-build the linked list with the sorted data
p23511
aVIf you want to write your own sort algorithm, then you may find  useful (assuming you are using generics)
p23512
aVThis should allow you to compare any items that are  or
p23513
aVAs an aside - note that
p23514
aVNET already includes  etc; if this is just for learning etc, then fine ;-p
p23515
as(dp23516
g18
V23354
p23517
stp23518
a((dp23519
g2
(lp23520
VA finalizer is a last ditch attempt to ensure that something is cleaned up correctly, and is usually reserved for objects that wrap unmanaged resources, such as unmanaged handles etc that won't get garbage collected
p23521
aVIt is rare indeed to write a finalizer
p23522
aVFortunately (and unlike ), finalizers don't need to be propagated; so if you have a  with a finalizer, and a  which wraps , then  does not need a finalizer - but quite likely both  and  would implement
p23523
aVFor managed code,  is usually sufficient
p23524
aVEven if you don't clean up correctly, eventually the managed objects will get collected (assuming they are released)
p23525
as(dp23526
g18
V23354
p23527
stp23528
a((dp23529
g2
(lp23530
VThe pdb is usually (for me at least) detected if it is next to the dll (like with the intellisense xml files)
p23531
aVAlternatively; you'll need a break point after the module has loaded
p23532
aVAt the break-point, bring up the "Modules" window (Ctrl+D,M - or Debug->Windows->Modules)
p23533
aVRight click on your dll "Load symbols from", "Symbol path", etc
p23534
as(dp23535
g18
V23354
p23536
stp23537
a((dp23538
g2
(lp23539
VFirst - I'm increasingly of the opinion that the xml configuration option is now mainly left for backwards compatibility
p23540
aVThe main StructureMap code now uses the code-based registry approach
p23541
aVRe using custom files; I haven't tried it, but  looks promising
p23542
aVRe generics
p23543
aVindeed, that is one of the complexities of xml ;-p
p23544
aVEdit: based on this post in the user group, it looks like maybe the back-tick notation will work:
p23545
as(dp23546
g18
V23354
p23547
stp23548
a((dp23549
g2
(lp23550
VI would simply use either a DOM (such as  or ), or for huge files, :
p23551
as(dp23552
g18
V23354
p23553
stp23554
a((dp23555
g2
(lp23556
VYou might try :
p23557
aVWorth a try, at least
p23558
aV(edit) Or at the method level:
p23559
aV(less sure about the second)
p23560
as(dp23561
g18
V23354
p23562
stp23563
a((dp23564
g2
(lp23565
VNot as far as I know
p23566
aVYou could probably do some grungy things to marry data from a UDF, perhaps - but other than that, it is going to want to be able to map the columns
p23567
aV(where the UDF just returns the arbitrary text and the comment-id)
p23568
aVAlternatively - A while I wrote a few variants on  that might be useful if you need to use this approach for lots of different things
p23569
aVPersonally, I'd probably try to side-step the issue first, though
p23570
as(dp23571
g18
V23354
p23572
stp23573
a((dp23574
g2
(lp23575
VIn most cases: more than fast enough
p23576
aVFor example, if you are using this to create a DAL wrapper object, the time taken to create the object via reflection will be miniscule compared to the time it needs to connect to a network
p23577
aVSo optimising this would be a waste of time
p23578
aVIf you are using reflection in a tight loop, there are tricks to improve it:
p23579
aVgenerics (using a wrapper  and )
p23580
aV(to a typed delegate; doesn't work for constructors)
p23581
aV- hardcore
p23582
aV(like , but more flexible, and works for constructors)
p23583
aVBut for your purposes,  is perfectly fine
p23584
aVStick with that, and keep things simple
p23585
aVEdit: while the point about relative performance remains, and while the most important thing remains: "measure it", I should clarify some of the above
p23586
aVSometimes
p23587
aVit does matter
p23588
aVMeasure first
p23589
aVHowever, if you find it is too slow, you might want to look at something like FastMember, which does all the  code quietly in the background, to give you a nice easy API; for example:
p23590
aVwhich is simple, but will be very fast
p23591
aVIn the specific example I mention about a DAL wrapper - if you are doing this lots, consider something like dapper, which again does all the  code in the background to give you the fastest possible but easy to use API:
p23592
as(dp23593
g18
V23354
p23594
stp23595
a((dp23596
g2
(lp23597
VA  can do this:
p23598
aVNote that the  variable also has access to the  etc
p23599
aVWith C# 2
p23600
aV0 you'll need to use an anonymous method rather than a lambda (but same effect) - to show both this and the :
p23601
as(dp23602
g18
V23354
p23603
stp23604
a((dp23605
g2
(lp23606
VHow about NArrange
p23607
aVThe only glitch is that it runs as a command line tool at the moment - but you can set up links in the "External Tools" section of VS, along the lines of:
p23608
aVTitle: nArrange File
p23609
aVCommand: [PathToNArrange]\u005cbin\u005cnarrange-console
p23610
aVexe
p23611
aVArguments: $(ItemFileName)$(ItemExt) /b /c:"[PathToNArrange]\u005cyourconfig
p23612
aVxml"
p23613
aVInitial directory: $(ItemDir)
p23614
aVTick \u201cUse Output window\u201d property
p23615
aVTitle: nArrange File Restore
p23616
aVCommand: [PathToNArrange]\u005cbin\u005cnarrange-console
p23617
aVexe
p23618
aVArguments: $(ItemFileName)$(ItemExt) /r
p23619
aVInitial directory: $(ItemDir)
p23620
aVTick \u201cUse Output window\u201d property
p23621
as(dp23622
g18
V23354
p23623
stp23624
a((dp23625
g2
(lp23626
VSockets are raw binary streams between two endpoints
p23627
aVYou would need to wrap your own RPC (etc) layer to process the messages, and deal with a lot of infrastructure code
p23628
aVHowever, since they are so close to the metal this can be very, very efficient
p23629
aVIt is not tied to any specific architecture, as long as both ends talk the same message format
p23630
aVTools like protobuf-net can help you construct binary messages for streams (rather than rolling your own serialization code)
p23631
aVRemoting is a
p23632
aVNET specific tool, and is very brittle re versioning
p23633
aVI wouldn't recommend remoting for client/server - use things like WCF instead
p23634
aVWCF is a more flexible comms stack - a lot of power and complexity, but arguably a bit of bloat too (xml, complex security etc)
p23635
aVIt is data-contract based, so roughly open (client/server can be different), but still a bit
p23636
aVNET focused
p23637
aVedit For info, protobuf-net provides an RPC stack too; at the moment there is only an HTTP implementation provided, but at some point I'll add raw TCP/IP
p23638
as(dp23639
g18
V23354
p23640
stp23641
a((dp23642
g2
(lp23643
VWhat volume of records are there
p23644
aVI expect you might have to use full-text search and an IFilter to do this efficiently
p23645
aVHtml does not lend itself well to regex - it can quickly be very hard to do something very simple
p23646
aVIf the volume isn't huge, can you iterate over the records with an external parsing application, using something like the HTML Agility Pack (for
p23647
aVNET) - or any other DOM of your choice
p23648
aVBut the FTS/IFilter would be my first choice
p23649
as(dp23650
g18
V23354
p23651
stp23652
a((dp23653
g2
(lp23654
VI'm not sure that is a task ideally suited to LINQ-to-SQL - but you can presumably get the text from things like  - however, this could be obfuscated
p23655
aVI would run the tests again my code repository instead of the database, personally
p23656
as(dp23657
g18
V23354
p23658
stp23659
a((dp23660
g2
(lp23661
VWell, can you query this list from the web-service that you will be using for exchange rates
p23662
aVFundamentally, it is a much simpler list than  (which has to handle lots of complexities) - a simple enum or hard-coded/database list should suffice
p23663
aVAnd it does change periodically (see: EUR)
p23664
as(dp23665
g18
V23354
p23666
stp23667
a((dp23668
g2
(lp23669
VWell, at the minimum - calling  after setting your headers looks like a mistake - try moving that to the start
p23670
as(dp23671
g18
V23354
p23672
stp23673
a((dp23674
g2
(lp23675
VHow about
p23676
aVJust add a reference to System
p23677
aVWeb
p23678
aVdll
p23679
as(dp23680
g18
V23354
p23681
stp23682
a((dp23683
g2
(lp23684
VRe clarification (comment) - you can use MSMQ as a WCF channel ;-p using the  and related bindings
p23685
aVSee here, for example - or for an MSDN document, here
p23686
aVWell, you could enable the "Generate asynchronous operations" button in the IDE (or ) - and use the async methods
p23687
aVIn reality, the sync methods usually call the async methods internally and block on the reply
p23688
aVIs there some specific problem you are seeing
p23689
as(dp23690
g18
V23354
p23691
stp23692
a((dp23693
g2
(lp23694
VThe only thing I run as part of my regular build is Nunit, and some simple tweaks to deal with version maintenance
p23695
aVMy view is that the rest of the tools are useful when trying to solve a specific problem, but that you shouldn't spend all your time worrying about arbitrary numbers, "zone of pain", etc
p23696
aVDon't get me wrong - I very much use the other tools (or variants of them, such as dotTrace) - but more "on demand" (with code coverage being the most regular that I use)
p23697
as(dp23698
g18
V23354
p23699
stp23700
a((dp23701
g2
(lp23702
VIf it is for you to see (i
p23703
ag50
aVnot an on-screen counter, but something you can look at separately): Google analytics, perhaps with feedburner if you have an atom/rss feed
p23704
aVAdding google analytics is simply a case of adding a few lines of script (that it generates for you); and it gives so much information (not just how many hits, but a proper usage history, referring sites / search terms that people used to find you, physical location by IP, etc)
p23705
aVAnd it is free
p23706
as(dp23707
g18
V23354
p23708
stp23709
a((dp23710
g2
(lp23711
VAs a deployment point, you should note that ClickOnce supports file extensions (as long as it isn't in "online only" mode)
p23712
aVThis makes it a breeze to configure the system to recognise new file extensions
p23713
aVYou can find this in project properties -> Publish -> Options -> File Associations in VS2008
p23714
aVIf you don't have VS2008 you can also do it manually, but it isn't fun
p23715
as(dp23716
g18
V23354
p23717
stp23718
a((dp23719
g2
(lp23720
VIn
p23721
aVNET, when a  is created, the GC is asked for a handle/opaque token representing the reference
p23722
aVThen, when needed,  uses this handle to ask the GC if that handle is still valid (i
p23723
ag50
aVthe original object still exists) - and if so, it can get the actual object reference
p23724
aVSo this is building a list of tokens/handles against object addresses (and presumably maintaining that list during defragmentation etc)
p23725
aVI'm not sure I 100% understand the three bullets, so I hesitate to guess which (if any) that is closest to
p23726
as(dp23727
g18
V23354
p23728
stp23729
a((dp23730
g2
(lp23731
VYou could try using a serialization surrogate, but without something we can reproduce it will be hard to give a decent answer
p23732
aVThe fundamental problem, however, is that BinaryFormatter is simply very, very brittle when it comes to things like assemblies
p23733
aVHeck, it is brittle enough even within an assembly
p23734
aVIt sounds like  is tree based, so I wonder whether xml would have been a better (i
p23735
ag50
aVmore version tolerant) option
p23736
aVIf efficiency is a concern, there are custom binary formats (like protobuf-net) that offer high performance, version tolerant, portable binary serialization
p23737
aVIf your data is already serialized
p23738
aVI wonder if it might be time to change track
p23739
aVTry using the old assembly to deserialize the data, and switch to a more robust serialization strategy
p23740
as(dp23741
g18
V23354
p23742
stp23743
a((dp23744
g2
(lp23745
VFortunately, Microsoft have some of that info here: C# for C++ Developers
p23746
aVThe struct vs class differences is another biggie for C++ origins
p23747
as(dp23748
g18
V23354
p23749
stp23750
a((dp23751
g2
(lp23752
VReferences are not smart pointers
p23753
aVLetting a reference-variable go out of scope, replacing it with another value, and/or setting it with null all do exactly nothing
p23754
aVThis is simply part of the CLI /GC design
p23755
aVGargage Collection (GC) will run when needed, and should clean up the managed memory used, and (if a finalizer is provided) any unmanaged resources too
p23756
aVBut for deterministic cleanup: that is the entire purpose of
p23757
aVIt is your job to  such objects when you have finished with them - either via , or by handing it to something else which assumes this responsibility (common, for example, with streams/readers etc)
p23758
as(dp23759
g18
V23354
p23760
stp23761
a((dp23762
g2
(lp23763
VIf you are starting from a non-generic type (), then the only way to do this is via reflection ()
p23764
aVIt isn't very pretty or especially fast, but it works
p23765
aVAs an aside - note that there is a bit of risk in assuming that an  is actually a  - you should probably verify that, and maybe also use an interface ()
p23766
aVEdit: if it really must be a , then you can enforce this (including subclass support, such as  as:
p23767
as(dp23768
g18
V23354
p23769
stp23770
a((dp23771
g2
(lp23772
VIt depends what it does; if it is just inspecting the request, then you could write (for example) an extension method on  and write it from the view;
p23773
aVAnother alternatives would be to push this into a master page
p23774
aVIf you need to do a database query etc, you might consider an "action filter" to do half the work (preparing the data), and then (as above) a call on  in the view to display it
p23775
aVAny use
p23776
as(dp23777
g18
V23354
p23778
stp23779
a((dp23780
g2
(lp23781
VYou should be able to hit "play" on the service project, and it will navigate to the screen that shows the available methods etc
p23782
aVThis is the url you need to use in the client
p23783
aVIs this what you are doing already
p23784
aVOr are you using the url from the sample
p23785
aVIn particular, if you are using the  integrated development web server (rather than IIS), the port numbers are likely to be random
p23786
aVA working WCF service project will generate a page something like:
p23787
aV{YourService} Service
p23788
aVYou have created a service
p23789
aVTo test this service, you will need to create a client and use it to call the service
p23790
aVYou > can do this using the svcutil
p23791
aVexe tool from the command line with the following syntax:
p23792
aVIf you can get that working, then try adding the client reference
p23793
as(dp23794
g18
V23354
p23795
stp23796
a((dp23797
g2
(lp23798
VLINQ-to-SQL doesn't use concatenation; that will be a TSQL query of the form:
p23799
aVwith  set to
p23800
aVWith regular LINQ you could use
p23801
aVWith  there are a few options; you could, for example, pass in the CSV "as is", and use a UDF to split this at the database, and join to it:
p23802
aVWhere  is one of the many such "split" udfs available on the internet
p23803
as(dp23804
g18
V23354
p23805
stp23806
a((dp23807
g2
(lp23808
VYou might also want to look at Async without the Pain
p23809
as(dp23810
g18
V23354
p23811
stp23812
a((dp23813
g2
(lp23814
VAnother thing that can be a problem with obfuscators is serialization using BinaryFormatter, since it changes the field names
p23815
aVI have some users who use protobuf-net for serialization on their obfuscated code for this reason
p23816
as(dp23817
g18
V23354
p23818
stp23819
a((dp23820
g2
(lp23821
VRe point 1:
p23822
aVWell, my shop was a VB6 house - with lots of VB6 code to support, and we moved straight to C# with no problems
p23823
aVWe did have to think about the decision, but I am 100% (or more) confident that we made the right choice
p23824
aVRe point 2:
p23825
aVYou'd be amazed at how much I don't need this day to day ;-p
p23826
aVI have nothing against VB
p23827
aVNET - I simply feel that C# allows me to do my job more elegantly
p23828
aVRe the books etc - I wonder if there isn't a contingent of ex-VB6 developers who are still writing VB6 in VS2008
p23829
aVMaking the switch to C# really helped me appreciate the new (at the time)
p23830
aVNET architecture
p23831
aVIf I had moved to VB
p23832
aVNET I don't think I would have made that mental leap - at least for some time
p23833
as(dp23834
g18
V23354
p23835
stp23836
a((dp23837
g2
(lp23838
VYes, there is a trick ;-p Consider this line from my protobuf-net CF project file:
p23839
aVIt says "in this project, include and compile all the
p23840
aVcs files from (back a level, up to the sibling protobuf-net folder) and all sub-folders"
p23841
as(dp23842
g18
V23354
p23843
stp23844
a((dp23845
g2
(lp23846
VNo, I don't think that is possible
p23847
aVYou may have to add a method, such as
p23848
aVThe next problem will be "how to get from  to  - you can't just assign them
p23849
aVOne option might be a conversion delegate:
p23850
as(dp23851
g18
V23354
p23852
stp23853
a((dp23854
g2
(lp23855
VThe problem is that once I add in a column with a duplicate name, regardless of the fact it's got a unique caption it will retrieve the property for the 1st one but still put the correct header in
p23856
aVCan you clarify that line
p23857
aVI've done this before, but I used the navigation path in the imaginary name - i
p23858
ag50
aVI might have the  report  rather than , and use the  to report something more readable
p23859
as(dp23860
g18
V23354
p23861
stp23862
a((dp23863
g2
(lp23864
VThe database submit doesn't happen until you call
p23865
aVThere is no tangible cost associated with multiple calls to  - so why not just do that
p23866
aVThis will still result in two TSQL  commands - it simply isn't possible to insert into two tables in a single regular  command
p23867
as(dp23868
g18
V23354
p23869
stp23870
a((dp23871
g2
(lp23872
VRowland has the answer for simple values
p23873
aVFor more complex scenarios, you can add a method called  (for property ) - it it returns , it won't get serialized
p23874
as(dp23875
g18
V23354
p23876
stp23877
a((dp23878
g2
(lp23879
VThe previous answer (already linked) explains most of it; for a related example (in
p23880
aVNET 3
p23881
aV5 with MiscUtil) -
p23882
as(dp23883
g18
V23354
p23884
stp23885
a((dp23886
g2
(lp23887
VIf there isn't a sensible default, and you don't want to split the data, then nulls are almost certainly your best option
p23888
aVRe the db not being to verify that they are not null when completed
p23889
aVwell, if you don't want to split the table there isn't much you can do (short of using a  constraint, or an  trigger to run validation)
p23890
aVBut the DB isn't the only place responsible for data validation
p23891
aVYour app logic can do that too
p23892
as(dp23893
g18
V23354
p23894
stp23895
a((dp23896
g2
(lp23897
VApart from purist issues around being idempotent, there is a practical side: spiders/bots/crawlers etc will follow hyperlinks
p23898
aVIf you have your "delete" action as a hyperlink that does a GET, then google can merrily delete all your data
p23899
aVSee "The Spider of Doom"
p23900
aVWith posts, this isn't a risk
p23901
as(dp23902
g18
V23354
p23903
stp23904
a((dp23905
g2
(lp23906
VWhat exactly are you trying to do
p23907
aVAssuming the  property is a string, then as far as I know it can't use a formatter, because  doesn't implement
p23908
aVThe  class (which underpins ) has a  event and  event that can be used to control formatting
p23909
aVYou can also use a  on the target bound property, which I like because it moves this logic away from the UI
p23910
aVSo: do you have an example of what you want to do
p23911
as(dp23912
g18
V23354
p23913
stp23914
a((dp23915
g2
(lp23916
VAhh the edit (2 grand-children) helps ;-p
p23917
aVWhile  is useful, at times I miss XPath/XQuery
p23918
aVWith  you could just use
p23919
as(dp23920
g18
V23354
p23921
stp23922
a((dp23923
g2
(lp23924
VTimes to use extension methods:
p23925
aVwhen you don't control the types being extended
p23926
aVwhere you don't want to force the implementor to provide code that can be done using the existing methods
p23927
aVFor an example of the second point; you might have an extension method on  (for example, ) that can be written entirely using the existing  members
p23928
aVso why force anybody else to write anything
p23929
aVThis is the foundation block of LINQ, and allowed Microsoft to provide much more functionality without breaking anything
p23930
aVTimes to not use extension methods:
p23931
aVwhen polymorphism is critical; you cannot guarantee that your code will be the version that gets executed with an extension method, as methods directly on the type take precedence
p23932
aVwhen you need access to private/protected members
p23933
as(dp23934
g18
V23354
p23935
stp23936
a((dp23937
g2
(lp23938
VI don't recommend remoting for most scenarios; it is non-portable, a little painful to manage sometimes, and  is brittle (version intolerant)
p23939
aVWCF is a pretty good fit for most cases; if you are working on a farm you'll probably want to run without sessions etc, but I do that anyway (for performance) - just using the http basic profile
p23940
aVI don't fully understand the scenario you are describing
p23941
aVOf course, you can always roll your own RPC using xml/json/binary - or use any of the other pre-canned comms stacks
p23942
aVor middleware like MSMQ or BizTalk
p23943
aVRe the edit; WCF can be used synchronously (blocking on the response, with (I believe) a configurable timeout)
p23944
aVYou can do more sophisticated things (rollback etc) with distributed transactions etc, but it adds complexity rapidly
p23945
aVYou'd need to weigh the importance of the drop-dead time, etc
p23946
aVIf the timeframe is longer than you'd want to wait for an invoke, you could also consider things like workflow - there are a range of workflow products around, in addition to WF
p23947
as(dp23948
g18
V23354
p23949
stp23950
a((dp23951
g2
(lp23952
VI'm of the opinion that the later chapters of C# in Depth do a good job of explaining LINQ, and what it all means
p23953
aVPlus the rest of the book teaches a lof of other very useful C# knowledge
p23954
as(dp23955
g18
V23354
p23956
stp23957
a((dp23958
g2
(lp23959
VI believe that  is an "empty element", as opposed to
p23960
aVnot ;-p btw,  isn't an html element - it is an xhtml element
p23961
aVIIRC it is supposed to be  in true legacy html
p23962
as(dp23963
g18
V23354
p23964
stp23965
a((dp23966
g2
(lp23967
VThere are a few options here:
p23968
aVmake the second thread STA (you can only do this for your own  - not for  threads) - via
p23969
aVsee if  is non-null; if so, use /
p23970
aVpass the form/control in as an  instance (may not apply to WPF - I'm not 100% sure)
p23971
as(dp23972
g18
V23354
p23973
stp23974
a((dp23975
g2
(lp23976
VThere is an  class, but it looks pretty
p23977
aV"fun" to work with
p23978
aVWould xml querying be enough
p23979
as(dp23980
g18
V23354
p23981
stp23982
a((dp23983
g2
(lp23984
VRe wait or change now
p23985
aVPersonally, I'd wait (see Do you think it\u2019s advantageous to switch to Entity Framework
p23986
aVfor VS2010 (as a minimum) - and until the beta comes out I can't check whether the things I use in L2S that EF lacks are implemented yet
p23987
aVThe resources etc question may be a dup of How to move from Linq 2 SQL to Linq 2 Entities
p23988
as(dp23989
g18
V23354
p23990
stp23991
a((dp23992
g2
(lp23993
VMost servers are either Windows or *nix based
p23994
aVSo at the server, either Java or
p23995
aVNET/C# (via mono on *nix) would be perfectly good
p23996
aVJava has better support for different client devices, but in many ways that requirement is being replaces by the much better HTML support at most clients - at least for online devices
p23997
aVFor a installed client application, then arguably Java has the better portability - but with things like Compact Framework, Micro Framework, Silverlight, etc
p23998
aVNET is catching up
p23999
aVPersonally (due to job role), I care mainly what is at the server;
p24000
aVNET/C# has never let me down - but I'm not a Java developer, so I can't contrast directly
p24001
aVFrom work on open source projects I know there is a good community of people out there using mono on the server
p24002
aVAt the client, tools like WPF offer a first rate GUI experience, with
p24003
aVNET's support for winforms being useful for regular windows apps
p24004
aVBut since a lot of the WPF architectureis common with Silverlight (with Moonlight as the mono twin for *nix etc), this allows the experience to be used on non-Windows clients too
p24005
as(dp24006
g18
V23354
p24007
stp24008
a((dp24009
g2
(lp24010
VFor an arbitrary application
p24011
aVHmmm
p24012
aVtricky
p24013
aVI suspect that Win32 (rather than managed code) would be the way to do this - and it would be a lot of work to do properly
p24014
aVThere are tools that do this, though - such as scripting/testing tools like Cyrano Robot a few years ago (I don't know if the product is still "alive" or not)
p24015
as(dp24016
g18
V23354
p24017
stp24018
a((dp24019
g2
(lp24020
VHow about this approach
p24021
aVPurely cumulative - no back-tracking, and only iterates once
p24022
aVFor raw performance, I'm not sure you'll do better with LINQ etc, regardless of how "pretty" a LINQ answer might be
p24023
as(dp24024
g18
V23354
p24025
stp24026
a((dp24027
g2
(lp24028
VThe short answer is "yes"
p24029
aVThe protocol buffers spec itself doesn't provide an RPC stack, but some have been added outside the spec
p24030
aVFirstly, protobuf-net has hooks for WCF, allowing you to mark operations on your service contract as
p24031
aVThis then swaps the regular  to use protobuf-net serialization
p24032
aVHowever, there are some caveats:
p24033
aVyour data-members must have explicit Order (e
p24034
aVg
p24035
aV), since it uses these numbers as the field identifiers (protocol buffers uses numeric fields)
p24036
aVit works best with assembly/class sharing (of the service contract etc), since this custom behavior is not exposed on "mex"
p24037
aVWhen used with the basic http transport, this is also compatible with MTOM (if enabled) for maximum througput
p24038
aVPerformance of non-trivial messages is largely proportional to their size; you can get an idea of protobuf-net's sizes here
p24039
aVAlternatively, I'm also working on a bespoke RPC stack
p24040
aVThe current build has a working stack over http, but I also plan to enable it on raw TCP/IP when I get chance
p24041
aVI haven't had chance to write it up yet, but I can provide examples on request
p24042
aVNote that to use it most conveniently, you'll want the 3
p24043
aV5 "extensions" dll, too
p24044
aVAny questions, add a comment or e-mail me (see my profile)
p24045
as(dp24046
g18
V23354
p24047
stp24048
a((dp24049
g2
(lp24050
VFor C# (original tags), this the type of thing that the "compiler as a service" will enable in some future version
p24051
aVHowever, you can do some of it already in mono (with source code available) - CsharpRepl
p24052
aVIt should print the value of the last command - not quite the same as the  description you wanted (I expect it'll use )
p24053
as(dp24054
g18
V23354
p24055
stp24056
a((dp24057
g2
(lp24058
VYou don't give many clues how you are doing this, and how you are doing the save (which might be important)
p24059
aVHowever, a common gotcha here is using a local database file that is part of your project
p24060
aVIf the project says "Copy Always", then every time you build it, the database is re-written from the unaltered state
p24061
aVIf that isn't the problem - are you perhaps leaving a transaction open
p24062
aV(edit) Now that we've established that you are using LINQ-to-SQL; are you calling
p24063
aVIt would also help to know whether you are using a single data-context, multiple data-contexts, or what
p24064
aVA data-context will only track changes in objects it created
p24065
as(dp24066
g18
V23354
p24067
stp24068
a((dp24069
g2
(lp24070
VThe HTML Agility Pack can do this - just use a query like //img and access the src - like so:
p24071
as(dp24072
g18
V23354
p24073
stp24074
a((dp24075
g2
(lp24076
VWell, you can usually use things like  to get a few threads into an expected problem state before releasing the gate
p24077
aVbut that only covers a small subset of threading issues
p24078
aVFor the bigger problem of threading bugs, there is CHESS (in progress) - maybe an option in the future
p24079
as(dp24080
g18
V23354
p24081
stp24082
a((dp24083
g2
(lp24084
VIf you are concerned about the TSQL generated, then I would suggest formalising the queries into stored procedures or UDFs, and accessing them via the data-context
p24085
aVThe UDF approach has slightly better metadata and composability (compared to stored procedure) - for example you can add addition // etc to a UDF query and have it run at the database (but last time I checked, only LINQ-to-SQL (not Entity Framework) supported UDF usage)
p24086
aVYou can also use , but there are advantages of letting the database own the fixed queries
p24087
aVRe finding what TSQL executed
p24088
aVwith LINQ-to-SQL you can assign any  (for example, ) to
p24089
as(dp24090
g18
V23354
p24091
stp24092
a((dp24093
g2
(lp24094
VWell, 4 is the pain point
p24095
aVOtherwise you could do things like "usually round down and accumulate leftover; round up when accumulator >= 1"
p24096
aV(edit: actually, that might still be OK as long as you swapped their position
p24097
aVThere might be a way to do it with linear programming
p24098
aV(that's maths "programming", not computer programming - you'd need some maths to find the feasible solution, although you could probably skip the usual "optimisation" part)
p24099
aVAs an example of the linear programming - with the example [1
p24100
aV3, 1
p24101
aV7, 1
p24102
aV9, 2
p24103
aV2, 2
p24104
aV8, 3
p24105
aV1] you could have the rules:
p24106
aVThen apply some linear/matrix algebra ;-p Hint: there are products to do the above based on things like the "Simplex" algorithm
p24107
aVCommon university fodder, too (I wrote one at uni for my final project)
p24108
as(dp24109
g18
V23354
p24110
stp24111
a((dp24112
g2
(lp24113
VIn the mid-term, "code contracts" (in 4
p24114
aV0) will be a better answer to this
p24115
aVThey are available now (with academic or commercial licences), but will be more integrated in VS2010
p24116
aVThis can provide both static analysis and runtime support
p24117
aV(edit) example:
p24118
aVSimple as that
p24119
aVthe code contracts engine works at the IL level, so it can analyse that and throw warnings/errors from calling code during build, or at runtime
p24120
aVFor backwards compatibility, if you have existing validation code, you can just tell it where the sanity checking ends, and it'll do the rest:
p24121
as(dp24122
g18
V23354
p24123
stp24124
a((dp24125
g2
(lp24126
VUsing remoting from a non-
p24127
aVNET Delphi exe would be very painful
p24128
aVIf the
p24129
aVNET app isn't known to be running, then COM interop would be the easiest answer, since there are processes for COM activation etc
p24130
aVThe fact that there are different machines complicates things, but DCOM exists and works (I haven't tested it with
p24131
aVNET and Delphi endpoints, though)
p24132
aVIf the
p24133
aVNET app is known to be running (perhaps as a service), you could consider a range of alternatives:
p24134
aVsockets
p24135
aVhttp (perhaps POX over http, using  at the
p24136
aVNET server)
p24137
aVSOAP (perhaps using WCF via  at the
p24138
aVNET end)
p24139
aVfile based (network share, presumably)
p24140
as(dp24141
g18
V23354
p24142
stp24143
a((dp24144
g2
(lp24145
VIt is a mix
p24146
aVObviously, things like winforms are largely wrappers around Win32 functionality (or a mix of both worlds), but WPF is a lot more managed (in terms of the actual control code; under the hood, as Mash notes, it may use DirectX for the rendering)
p24147
aVLikewise, things like file/network access are (by necessity) wrappers around the OS objects, as are the unmanaged lock objects like  - but many other things are 100% managed
p24148
aVSo it isn't a simple answer
p24149
aV(edit) Also - keep in mind that "
p24150
aVNET" is a very vague term; Compact Framework, Micro Framework, Silverlight etc may have different, non-win32 implementations
p24151
as(dp24152
g18
V23354
p24153
stp24154
a((dp24155
g2
(lp24156
VOK, that is nasty
p24157
aVthe dangers of using a union
p24158
aVThat may work, but isn't a very good idea - I guess I'd compare it to reflection (where you can do most things)
p24159
aVI'd be interested to see if this works in a constrained access environment - if so, it may represent a bigger problem
p24160
aVI've just tested it without the "Full Trust" flag, and the runtime rejects it:
p24161
aVCould not load type 'MemoryAccess'
p24162
aVfrom assembly 'ConsoleApplication4,
p24163
aVVersion=1
p24164
ag190
ag190
aV0, Culture=neutral,
p24165
aVPublicKeyToken=null' because objects
p24166
aVoverlapped at offset 0 and the
p24167
aVassembly must be verifiable
p24168
aVAnd to have this flag, you already need high trust - so you can already do more nasty things
p24169
aVStrings are a slightly different case, because they aren't normal
p24170
aVNET objects - but there are other examples of ways to mutate them - the "union" approach is an interesting one, though
p24171
aVFor another hacky way (with enough trust):
p24172
as(dp24173
g18
V23354
p24174
stp24175
a((dp24176
g2
(lp24177
VIf the node is null or empty, what is
p24178
aVHow about just:
p24179
aVNote also that LINQ-to-XML has more graceful handling of these conversions (via casts)
p24180
as(dp24181
g18
V23354
p24182
stp24183
a((dp24184
g2
(lp24185
VThe main disadvantages of lots of dlls are:
p24186
aVcomplexity (the sheer number of dlls to manage and deploy)
p24187
aVperformance of "fusion" (which can be reduced using ILMerge)
p24188
aVThe advantage is more separation - but actually you can achieve the same (or similar) separation inside a single (or a few) dlls
p24189
aVRe the issue with circular dependencies - you should perhaps look at "dependency injection" and "inversion of control"
p24190
as(dp24191
g18
V23354
p24192
stp24193
a((dp24194
g2
(lp24195
VLINQ is the canonical example (for example, talking to a database), but in truth, any time you care more about expressing what to do, rather  than actually doing it
p24196
aVFor example, I use this approach in the RPC stack of protobuf-net (to avoid code-generation etc) - so you call a method with:
p24197
aVThis deconstructs the expression tree to resolve  (and the value of each argument), performs the RPC call, updates any / args, and returns the result from the remote call
p24198
aVThis is only possible via the expression tree
p24199
aVI cover this more here
p24200
aVAnother example is when you are building the expression trees manually for the purpose of compiling to a lambda, as done by the generic operators code
p24201
as(dp24202
g18
V23354
p24203
stp24204
a((dp24205
g2
(lp24206
VVisual Studio 2010
p24207
aVPlus, on a method-by-method basis - Reflector (Analyzer (Ctrl+R); "Depends On" and "Used By")
p24208
as(dp24209
g18
V23354
p24210
stp24211
a((dp24212
g2
(lp24213
VYou submitted it already with
p24214
aVThe question is: what is your "result-search"
p24215
aVWhat does the page return
p24216
aVHTML
p24217
aVIf so - the HTML Agility Pack is the easiest way to parse html
p24218
as(dp24219
g18
V23354
p24220
stp24221
a((dp24222
g2
(lp24223
VIf you just care about existence, you could use  or  instead
p24224
aVSearching by value is unusual for a ; if you were searching by key, you could use
p24225
aVOne other approach:
p24226
aVThis returns a class - so will be  if not found
p24227
as(dp24228
g18
V23354
p24229
stp24230
a((dp24231
g2
(lp24232
VWell, a very simple alternative is the trick that SO uses; include both the internal identifier and the search-friendly portion - i
p24233
ag50
aVjust only look at the identifier
p24234
aVWith ASP
p24235
aVNET MVC routes this is trivial
p24236
aVIf you go the other route (no db identifier in the route); simply store the mangled name/path in the db - then your query is an equality one = very efficient
p24237
as(dp24238
g18
V23354
p24239
stp24240
a((dp24241
g2
(lp24242
VNo, basically
p24243
aVThe most you can do is add push-pins, lines, shapes etc
p24244
aVThere is a usenet forum (microsoft
p24245
aVpublic
p24246
aVmappoint) that might have more, but I can pretty much guarantee the answer is "no"
p24247
as(dp24248
g18
V23354
p24249
stp24250
a((dp24251
g2
(lp24252
VHow about looking at using "protocol buffers"
p24253
aVDesigned as an efficient, portable, version-tolerant general purpose binary format, it gives you C++, Java and Python in the google library, and C#, Perl, Ruby and others in the community ports
p24254
aVNote that Guid doesn't have a specific data type, but you can shim it as a message with (essentially) a
p24255
aVNormally for
p24256
aVNET work, I'd recommend protobuf-net (but as the author, I'm somewhat biased) - however, if you intend to use other languages later you might do better (long term) using Jon's dotnet-protobufs; that'll give you a familiar API accross the platforms (where-as protobuf-net uses
p24257
aVNET idioms)
p24258
as(dp24259
g18
V23354
p24260
stp24261
a((dp24262
g2
(lp24263
VWell, it can manipulate the  - which is an object
p24264
aVif you are passing an object reference around (even passed by value), changes to that object will be reflected to the caller
p24265
aVIs that the question
p24266
as(dp24267
g18
V23354
p24268
stp24269
a((dp24270
g2
(lp24271
VHow about
p24272
as(dp24273
g18
V23354
p24274
stp24275
a((dp24276
g2
(lp24277
Vin 3
p24278
aV5, Expression is one way to specify member names as code; you could have:
p24279
aVand then parse the expression tree to get the value
p24280
aVA little inefficient, but not too bad
p24281
aVHere's example code:
p24282
aVcalled with:
p24283
as(dp24284
g18
V23354
p24285
stp24286
a((dp24287
g2
(lp24288
VWhile
p24289
aVNET modules can in theory (IIRC) react to module load etc, this isn't available via C#
p24290
aVIn some frameworks (like ASP
p24291
aVNET) there are hooks you can use via configuration, such as hacking it via a handler or via global
p24292
aVasax
p24293
aVcs - however, for a regular C# app (console, winform etc) you would have to trigger it manually
p24294
aVFor example, a static constructor on the class that hosts your  entry point would get invoked
p24295
aVSo: what is the use-case here
p24296
aVWhen wouldn't the lazy loading approach be OK
p24297
as(dp24298
g18
V23354
p24299
stp24300
a((dp24301
g2
(lp24302
V maps (for subsequent terms) to :
p24303
aV(note that no final  is necessary for trivial projections)
p24304
as(dp24305
g18
V23354
p24306
stp24307
a((dp24308
g2
(lp24309
VThe big difference is that with a secondary object that only your code knows about there is no risk of unexpected consequences (deadlocks, pulse/wait gotchas, etc) from other code (not yours) locking against the primary object (which is commonly available to other code)
p24310
aVIMO, perhaps the CLR team would have done better with an explicit  type - or maybe  should have been non-static, etc
p24311
as(dp24312
g18
V23354
p24313
stp24314
a((dp24315
g2
(lp24316
VI expect you need a list (/ etc will give you an / sequence)
p24317
aVTry using , or  etc (where  is your filter)
p24318
as(dp24319
g18
V23354
p24320
stp24321
a((dp24322
g2
(lp24323
VThat  object is limited to the current request; to persist this between requests you need to do something with the uploaded data - either , or by reading from the
p24324
aVIMO, storing it in session is not a great idea for scalability reasons - it would be more natural, for example, to write the files to a shared scratch area on disk, and store the paths in session
p24325
as(dp24326
g18
V23354
p24327
stp24328
a((dp24329
g2
(lp24330
VFirst - could you write the log writer as a trace listener, and use  etc from the methods
p24331
aVDo you actually need an instance here
p24332
aVThat would be useful, for example, if you wanted to abstract it as a  or similar - but if it is going to be a standalone singleton, can the methods not use static methods directly, i
p24333
ag50
aV(rather than passing in a log instance)
p24334
aVRe the general problem - it depends on the types that are doing the logging
p24335
aVFor "manager" (etc) classes, you might consider using dependency injection (Unity, StructureMap, etc) to automate this
p24336
aVI wouldn't normally use injection with DTOs, though
p24337
as(dp24338
g18
V23354
p24339
stp24340
a((dp24341
g2
(lp24342
VI don't think you can do it without simply binding to a different type - at least, not conveniently
p24343
aVNormally, even if you can't control , you can use a  to do custom formatting - but IIRC the  stuff doesn't respect this for enums
p24344
aVYou could bind to a  of the descriptions, or a something essentially like a key/value pair
p24345
aV(desription/value) - something like:
p24346
aVAnd then bind to
p24347
as(dp24348
g18
V23354
p24349
stp24350
a((dp24351
g2
(lp24352
VIf you are serializing as xml, why is there type information in it
p24353
aVOne of the objectives of xml is to remove type metadata from the serialization
p24354
aVIs this an array or something
p24355
aVThere may be better ways to serialize this data
p24356
aVAssembly redirects do not, AFAIK, work with string-based reflection; if the qualified name doesn't match, it doesn't match
p24357
aVThe last example doesn't specify the signing details, which allows it to accept any
p24358
aVPersonally, I'd try to fix the issue of having type information in the xml - it is probably an easier, and more appropriate, battle to fight
p24359
as(dp24360
g18
V23354
p24361
stp24362
a((dp24363
g2
(lp24364
VIt looks like it should work, but CF does have unpredictable limitations
p24365
aVIs xml a requirement
p24366
aVI can't remember trying it with 20k records, but another option might be to try using a different serializer - for example, protobuf-net works on CF2
p24367
aVI can't guarantee it'll work, but it might be worth a shot
p24368
aV(in particular, I'm currently refactoring the code to try to work around some additional "generics" limitations within CF - but unless you have a very complex object model this shouldn't affect you)
p24369
aVExample showing usage; note that this example also works OK for , but protobuf-net uses only 20% of the space (or 10% of the space if you consider that characters are two bytes each in memory):
p24370
aVLet me know if you want more help - I can talk about this subject all day ;-p
p24371
aVNote that it can work just from the standard xml attributes () - I've used the more specific  etc for clarity
p24372
aVThis also allows fine-grained control of serialization (zigzag vs twoscompliment, grouped vs length-prefixed, etc)
p24373
as(dp24374
g18
V23354
p24375
stp24376
a((dp24377
g2
(lp24378
VThat is a big pile of data; the first thing to do is, indeed, to reduce the amount of data - however, since you mention  in the tags, there is "virtual mode" for large data scenarios
p24379
aVSee on MSDN, here (overview) and here (howto)
p24380
aVSome (but not all) other list-based controls also have "virtual mode" support
p24381
as(dp24382
g18
V23354
p24383
stp24384
a((dp24385
g2
(lp24386
VOne option would be to create a transaction (either a connection-bound transaction, or a ) - remove the record and , add the record and , then finally commit the transaction (or roll-back if you blew up)
p24387
aVNote that you can associate a connection-bound transaction through the data-context constructor IIRC
p24388
aVshould also work, and is easier to do - but not quite as efficient
p24389
aVAlternatively, write an SP that does this swap job at the database, and access that SP via the data-context
p24390
as(dp24391
g18
V23354
p24392
stp24393
a((dp24394
g2
(lp24395
V, like so:
p24396
as(dp24397
g18
V23354
p24398
stp24399
a((dp24400
g2
(lp24401
V1: pretty good, actually
p24402
aVNot all the full framework is there, so if you are writing code that should build on both MS
p24403
aVNET and mono, you need to build and test early against both platforms
p24404
aV4: yes - although things like WPF/WCF/WF (3
p24405
aV0) are missing or slimmed down
p24406
aVI don't know much about the development environment, since I use VSTS (on Windows) and just use a NANT script to do the build on mono
p24407
as(dp24408
g18
V23354
p24409
stp24410
a((dp24411
g2
(lp24412
VIf you have a process that operates on most of the data in a database
p24413
aVthen that sounds like a job for a stored procedure
p24414
aVIt won't be object oriented, but it will be a lot faster and less brittle
p24415
as(dp24416
g18
V23354
p24417
stp24418
a((dp24419
g2
(lp24420
VIt really depends what you want to do with the non-integer strings
p24421
aVAt the moment you silently drop them
p24422
aVPersonally, I'd want it to error
p24423
aVThis also lets you use the more terse:
p24424
as(dp24425
g18
V23354
p24426
stp24427
a((dp24428
g2
(lp24429
VWell, there are a few possibilities:
p24430
aVyour query is too complex and takes too long (try writing better TSQL, adding indexes, or increasing the timeout)
p24431
aVyou are being blocked by another SPID (perhaps yourself on another connection)
p24432
aVOften, the second is the problem
p24433
aVLook at the blockages etc (sp_who / sp_who2) to see if there are any blocks
p24434
aVAnd use a trace/profiler to investigate the first option
p24435
as(dp24436
g18
V23354
p24437
stp24438
a((dp24439
g2
(lp24440
VA class can only be  if it is nested - and then access is limited to the outer classes
p24441
aVwould be more common (and is the default for non-nested classes)
p24442
aVDon't use public fields ()
p24443
aVDo consider automatically implemented properties (, for example)
p24444
aVDecide wheter  is a method or a property ;-p
p24445
as(dp24446
g18
V23354
p24447
stp24448
a((dp24449
g2
(lp24450
VTGnat notes how to do  (via )
p24451
aVHowever, there is no inbuilt way of adding granular hints (etc) like  to specific tables
p24452
aVThere are a few ways of getting around this:
p24453
aVwrite a stored procedure and expose it via the data-context
p24454
aVwrite a udf and expose it via the data-context
p24455
aVuse  with (parameterized) TSQL that has a
p24456
aVOf the 3, the UDF would get my vote:
p24457
aVit doesn't leave you with literal queries in the C#
p24458
aVthe metadata is strongly defined
p24459
aVit is composable (with // etc)
p24460
as(dp24461
g18
V23354
p24462
stp24463
a((dp24464
g2
(lp24465
VYou can do this sort of thing by writing your own  implementation, and either implementing  (adds properties to an instance), or by using a  (can add properties to an entire type)
p24466
aVThis is a common way of implementing extensible/dynamic property-bag implementations, and is what things like  use under the hood to expose virtual properties (on  etc)
p24467
aVHowever; it is a lot of work
p24468
aVI've done it a few times, and it isn't fun
p24469
aVI wonder whether you should just use a per-canned solution
p24470
aVWhile I normally avoid , this might be one of the occasions where it is genuinely useful
p24471
aVjust add columns, and job done
p24472
as(dp24473
g18
V23354
p24474
stp24475
a((dp24476
g2
(lp24477
VHmmm
p24478
aVI wasn't aware of the IIS7 change
p24479
aVI wonder if it wouldn't be simpler to defer this operation until you have got a page
p24480
aVFor example, you could try putting something "once only" in  or
p24481
aVOr (completely untested) for a self-unsubscribing hook:
p24482
aVThe trick is doing it once only (if multiple requests arrive at once); perhaps a static ctor
p24483
aVFor example, I think this fires once only, and only when there is a page available in context:
p24484
as(dp24485
g18
V23354
p24486
stp24487
a((dp24488
g2
(lp24489
VASP
p24490
aVNET 2
p24491
aV0 is the framework that shipped with
p24492
aVNET 2
p24493
aV0 (and thus CLR 2
p24494
aV0)
p24495
aVIn most ways, this number currently aligns most closely with the CLR version, in that although
p24496
aVNET 3
p24497
aV0 /
p24498
aVNET 3
p24499
aV5 add extra assemblies that can (and are) used by ASP
p24500
aVNET applications, there is no new ASP
p24501
aVNET version number
p24502
aVRe your last point
p24503
aV"nothing changes"
p24504
aVwell, the code that runs is largely dictated by the class libraries
p24505
aVSo; yes, there are new dlls, and minor tweaks to the older dlls
p24506
aVBut indeed, the core technology itself remains more or less the same
p24507
as(dp24508
g18
V23354
p24509
stp24510
a((dp24511
g2
(lp24512
VSecond edit re comment; I think this does what you want
p24513
as(dp24514
g18
V23354
p24515
stp24516
a((dp24517
g2
(lp24518
VApp pools in IIS get recycled by default - either after a timeout, or after "n" hits
p24519
aVThis should be expected, and is part of the normal processing (although it can be disabled in the app-pool configuration; IIS6 | IIS7)
p24520
aVThe fact that this breaks your app suggests that you are using a lot of things like in-memory sessions
p24521
aVConsider moving these to database backed implementations
p24522
aVApart from withstanding both app-pool restarts and server reboots, this can allow you to scale the site to multiple servers
p24523
as(dp24524
g18
V23354
p24525
stp24526
a((dp24527
g2
(lp24528
VJust
p24529
aVwhy
p24530
aVHaving lots of dlls can have a performance impact on app startup (due to "fusion")
p24531
aVIt will also pretty-much immediately suffer from circular references, which is a bad thing
p24532
aVSince
p24533
aVNET code (by default) gets JITted when first used, there isn't a huge amount of impact in having extra classes in a dll that don't get used in that application
p24534
aVThey just sit there, quietly, being no bother to anyone
p24535
aVThe sheer management cost of having a dll per class will make deployment etc excruciating
p24536
aVAll in all, I can't think of a sensible reason to do this
p24537
as(dp24538
g18
V23354
p24539
stp24540
a((dp24541
g2
(lp24542
VDo you mean you are referencing a single dll from both the web app and the Silverlight app
p24543
aVI would have two versions of the dll (and two project files); one built for regular
p24544
aVNET (for use in the web app), and one for Silverlight; the main difference being the target framework and the references
p24545
aVIf you don't want to deal with having to maintain two project files (when you add classes etc), then you can use this trick to reduce this overhead
p24546
as(dp24547
g18
V23354
p24548
stp24549
a((dp24550
g2
(lp24551
VIs this a single fiexed xsd
p24552
aVOr is the xsd determined at runtime
p24553
aVWith a fixed xsd, you could map it to an object model and use :
p24554
aV(at the command line; generates foo
p24555
aVcs with classes for entities etc)
p24556
aVThen build your object-model, and use  to serialize it
p24557
aVIt might work - but isn't a suitable option for working with xsd on the fly
p24558
as(dp24559
g18
V23354
p24560
stp24561
a((dp24562
g2
(lp24563
VHow about this one Creating a blocking Queue in
p24564
aVNET
p24565
aVIf you need it for
p24566
aVNET 1
p24567
aV1 (I wasn't sure from the question), just drop the generics and replace  with
p24568
as(dp24569
g18
V23354
p24570
stp24571
a((dp24572
g2
(lp24573
VRegex is, IMO, the wrong tool for processing XML
p24574
aVWhy not use  or  etc
p24575
aVIf that is HTML (note no "X"), then the HTML Agility Pack may be useful
p24576
aVWith both  and the HTML Agility Pack you can use xpath/xquery, so you can simply use
p24577
aVhas similar, but a different method:
p24578
as(dp24579
g18
V23354
p24580
stp24581
a((dp24582
g2
(lp24583
VTo satisfy the contract, I wonder if the client shouldn't have input on that - called "requirements"
p24584
aVW3C: Web Accessibility Initiative (WAI) may have some interesting points - in particular all the links from Introduction to Web Accessibility
p24585
aVFor tools to check, see Complete List of Web Accessibility Evaluation Tools
p24586
aVAs long as you follow the intended ehnance approach of jQuery, it should be just as accessible as not
p24587
aVAs an aside; you may find that ASP
p24588
aVNET MVC gives you more control over the html, and hence more ability to meet any requirements
p24589
as(dp24590
g18
V23354
p24591
stp24592
a((dp24593
g2
(lp24594
VSketchPath looks like it might help (and is free)
p24595
as(dp24596
g18
V23354
p24597
stp24598
a((dp24599
g2
(lp24600
VAnother thing that can be important is the  options that are enabled
p24601
aVSome of these options change the query plan sufficiently to change the profile
p24602
aVSome can have a huge impact if you are looking at (for example) a calculated + persisted (and possibly indexed) column: if the  options aren't compatible, it can be forced to re-calculate the values, rather than using the indexed value - which can change an index seek into a table scan + calculation
p24603
aVTry using the profiler to see what  options are "in play", and see if using those options changes things
p24604
aVAnother impact is the connection string; for example, if you enable MARS that can change the behaviour in subtle ways
p24605
aVFinally, transactions (implicit () or explicit) can have a huge impact, depending on the isolation level
p24606
as(dp24607
g18
V23354
p24608
stp24609
a((dp24610
g2
(lp24611
VThe problem here is that it sounds like you want to do an in place sort; in which case, you'd need to know (with a fluent API) when you've finished adding conditions
p24612
aVThis contrasts to the LINQ approach, because that uses deferred execution
p24613
aVFor single condition sorts, you can use something like:
p24614
aVIt would be harder with multiple sorts; you can't use  because each  may be different
p24615
aVYou'd probably need to either use a terminator step and an intermediary "builder" class (essentially writing a DSL), or you'd need to construct the comparer separately first
p24616
as(dp24617
g18
V23354
p24618
stp24619
a((dp24620
g2
(lp24621
VIs this a matter of encoding
p24622
aVOr is the xml just malformed
p24623
aVIf malformed, I can't help
p24624
aVBut for encoding
p24625
aVit is unfortunate that  doesn't let you specify the encoding, but you could treat the data as a BLOB, and process it separately with your own encoding and
p24626
aVIf the data is large, you'd probably want to use  with  and write it to a temporary file () - then process that file as a  with
p24627
as(dp24628
g18
V23354
p24629
stp24630
a((dp24631
g2
(lp24632
VUsing pstools - in particular psservice and "query" - for example:
p24633
as(dp24634
g18
V23354
p24635
stp24636
a((dp24637
g2
(lp24638
VSomething like:
p24639
as(dp24640
g18
V23354
p24641
stp24642
a((dp24643
g2
(lp24644
VContrived or not; that's what there is
p24645
aVI'm not aware of an easier way than you have already described (although I'd probably re-use a tooltip instance, rather than creating new all the time)
p24646
aVIf you have articles that show this, then use them - or use a 3rd party control that supports this natively (none leap to mind)
p24647
as(dp24648
g18
V23354
p24649
stp24650
a((dp24651
g2
(lp24652
VHow about something like:
p24653
as(dp24654
g18
V23354
p24655
stp24656
a((dp24657
g2
(lp24658
VYou could use  (but note you can't use xml attributes - only xml elements):
p24659
aVAlternatively, you can implement  and do everything yourself - but this works with , at least
p24660
as(dp24661
g18
V23354
p24662
stp24663
a((dp24664
g2
(lp24665
VWell actually, no: the convention in C# is for camelCased variable (and field) names, and PascalCase methods:
p24666
as(dp24667
g18
V23354
p24668
stp24669
a((dp24670
g2
(lp24671
VAs an aside - note that the  approach is essentially what the LINQ providers (LINQ-to-SQL, LINQ-to-Entities) do for a living
p24672
aVThe approach has advantages, as Jon says
p24673
aVHowever, there are definite problems too - in particular (for me) in terms of (the combination of) separation | abstraction
p24674
aVWhat I mean here is that:
p24675
aVin a MVC scenario (for example) you want your "get data" step to actually get data, so that you can test it works at the controller, not the view (without having to remember to call  etc)
p24676
aVyou can't guarantee that another DAL implementation will be able to stream data (for example, a POX/WSE/SOAP call can't usually stream records); and you don't necessarily want to make the behaviour confusingly different (i
p24677
ag50
aVconnection still open during iteration with one implementation, and closed for another)
p24678
aVThis ties in a bit with my thoughts here: Pragmatic LINQ
p24679
aVBut I should stress - there are definitely times when the streaming is highly desirable
p24680
aVIt isn't a simple "always vs never" thing
p24681
as(dp24682
g18
V23354
p24683
stp24684
a((dp24685
g2
(lp24686
VAs an aside - you may be interested to know that
p24687
aVNET 4
p24688
aV0 is getting LINQ-enable file operations built in (proper lazy ones, apparently - not juts iterating over an array)
p24689
aVLook for "File System Enumeration Improvements" on this BCL Team Blog entry
p24690
as(dp24691
g18
V23354
p24692
stp24693
a((dp24694
g2
(lp24695
VThere is no generic constraint that matches that set of things cleanly
p24696
aVWhat is it that you actually want to do
p24697
aVFor example, you can hack around it with runtime checks, such as a static ctor (for generic types - not so easy for generic methods)
p24698
aVHowever; most times I see this, it is because people want one of:
p24699
aVto be able to check items for equality: in which case use
p24700
aVto be able to compare/sort items: in which case use
p24701
aVto be able to perform arithmetic: in which case use MiscUtil's support for generic operators
p24702
as(dp24703
g18
V23354
p24704
stp24705
a((dp24706
g2
(lp24707
VWhen you really do want a dirty flag at the class level (or, for that matter, notifications) - you can use tricks like below to minimise the clutter in your properties (here showing both  and , just for fun)
p24708
aVObviously it is a trivial matter to use the enum approach (the only reason I didn't was to keep the example simple):
p24709
aVYou might also choose to push some of that into an abstract base class, but that is a separate discussion
p24710
as(dp24711
g18
V23354
p24712
stp24713
a((dp24714
g2
(lp24715
VWith different  per entry, perhaps standardise at , and cast inside the actual actions
p24716
as(dp24717
g18
V23354
p24718
stp24719
a((dp24720
g2
(lp24721
VI expect you'll need to use , and filter the results to what you want
p24722
aVFor example, using LINQ )(and using C#, as I don't know VB well enough):
p24723
aV(note: the important thing here is the  - which should be identical between VB and C#)
p24724
as(dp24725
g18
V23354
p24726
stp24727
a((dp24728
g2
(lp24729
VAs an extension to Stefan's excellent answer - another exception is if the operands involve  - in which case "lifted" operators apply (14
p24730
ag5115
aV7 in ECMA 334v4):
p24731
aVFor the equality operators
p24732
aV==
p24733
ag5136
aVa lifted form of an operator exists if the operand types are both
p24734
aVnon-nullable value types and if the
p24735
aVresult type is bool
p24736
aVThe lifted form
p24737
aVis constructed by adding a single
p24738
aVmodifier to each operand type
p24739
aVThe
p24740
aVlifted operator considers two null
p24741
aVvalues equal, and a null value unequal
p24742
aVto any non-null value
p24743
aVIf both
p24744
aVoperands are non-null, the lifted
p24745
aVoperator unwraps the operands and
p24746
aVapplies the underlying operator to
p24747
aVproduce the bool result
p24748
aVWhat that means is: because there is an equality operator between (say):
p24749
aVThus there is an implicit operator of the form (although done differently):
p24750
as(dp24751
g18
V23354
p24752
stp24753
a((dp24754
g2
(lp24755
Vx64 still has the same core
p24756
aVNET libraries as x86 (although there may be some internal changes, especially in the CLI itself)
p24757
aVSo no: x64 doesn't get anything extra
p24758
aVThere is  in 4
p24759
aV0, though
p24760
as(dp24761
g18
V23354
p24762
stp24763
a((dp24764
g2
(lp24765
VWell, throwing an exception will effectively cancel the change
p24766
aVa bit harsh though, perhaps
p24767
aVAnother extension point is by overriding the  on the data-context, to get the pending changes (), do any final changes (auditing, perhaps), and then call the
p24768
aVYou could put any post-save operations after this (using the change-set you obtained before the save)
p24769
as(dp24770
g18
V23354
p24771
stp24772
a((dp24773
g2
(lp24774
VMost things will be fine; some things that will break it:
p24775
aVRemoving* types that are used (unless you are using type-forwarding)
p24776
aVRemoving* methods that are used (including constructor)
p24777
aVChanging the signature of methods (that are used)
p24778
aVChanging public fields to properties (that are used)
p24779
aVChanging serialization internals if serialization is used
p24780
aVAdding a method to an interface, where the second dll has a type that implements that interface
p24781
aVAdding an abstract method to a base-class that is inherited in the second dll
p24782
aVAlmost anything internal if hacky reflection is (ab)used
p24783
aVAdding constraints to a generic type/method
p24784
aVMarking a type as  when it was inherited in the second dll
p24785
aVAdding a field to a  if the caller uses memberwise initialization rather than constructor initialization
p24786
aV(removing includes changing the accessibility to something non-public)
p24787
as(dp24788
g18
V23354
p24789
stp24790
a((dp24791
g2
(lp24792
VThe most efficient would be to avoid LINQ ;-p
p24793
aVIf you want to use LINQ: this isn't ideal, but would work at least:
p24794
aVIt finds them by ID (using LINQ), then uses  to get the position, and the indexer to update it
p24795
aVA bit more risky, but only one scan:
p24796
as(dp24797
g18
V23354
p24798
stp24799
a((dp24800
g2
(lp24801
VHow about:
p24802
aVIt is a little hard to be sure without sample xml - but it looks like you intend to loop over all the  elements - which is what the above does
p24803
aVYour original code loops over the (single
p24804
aVelement(s), then fetches the first  from within it
p24805
aVedit after looking at the xml; this would be more efficient:
p24806
as(dp24807
g18
V23354
p24808
stp24809
a((dp24810
g2
(lp24811
VLooks like a (basic) factory to me
p24812
aVin many factories the implementation is more complex (perhaps involving types resolved at runtime), but that is not (AFAIK) a requirement
p24813
aVThe only other critique I'd have added is to combine the cases, and do something more dramatic if you don't recognise the type
p24814
as(dp24815
g18
V23354
p24816
stp24817
a((dp24818
g2
(lp24819
VBy default, WCF uses  in basic-http mode, and  in some of the binary tcp modes
p24820
aVYou can't really inject a converter per type/property, but you can replace the serializer by adding a "behavior" to the contract (at both ends)
p24821
aVWhile possible, this isn't very portable, and you would be well advised to stick with the regular layout so that "mex" understands things correctly
p24822
aVSee here for an example of such a behavior
p24823
aVAFAIK, the most likely alternative (for custom serialization) would be to implement  and do everything yourself - not fun
p24824
as(dp24825
g18
V23354
p24826
stp24827
a((dp24828
g2
(lp24829
VThe problem is the namespaces - for example, something like:
p24830
aVYou might also prefer  - something like:
p24831
aVWith class definitions like:
p24832
aVOr alternatively, just run the xml through  to get C# code to suit:
p24833
as(dp24834
g18
V23354
p24835
stp24836
a((dp24837
g2
(lp24838
s(dp24839
g18
V23354
p24840
stp24841
a((dp24842
g2
(lp24843
VIt is incorrect (in xhtml, at least) to use ; it is a
p24844
aVLikewise, I'd use lower-case in the javascript (for ), as that is their names ;-p
p24845
as(dp24846
g18
V23354
p24847
stp24848
a((dp24849
g2
(lp24850
VA few options:
p24851
aVwhen the app starts closing (
p24852
aV, you could start cleanly exiting the threads (via a flag somewhere)
p24853
aVpresumably to talk to your UI, you are raising events that are handled by the UI (which handles synchronization etc) - keep a flag, and (if it is safe to do do) simply drop events if the flag has been set (again, because you are exiting)
p24854
aVwhen exiting, have the UI unsubscribe from events
p24855
as(dp24856
g18
V23354
p24857
stp24858
a((dp24859
g2
(lp24860
VTry:
p24861
aVYou'd think this would be the same, but see these two connect issues:
p24862
aVLINQ-to-SQL doesn't use cache for lookup
p24863
aVLINQ-to-SQL still roundtrips for ID lookups (3
p24864
aV5SP1)
p24865
aVIf that doesn't work, I know that the  works in 3
p24866
aV5 SP1 (I don't know if I tried )
p24867
aVApparently the  is fixed in 4
p24868
aV0 - again, I haven't tried
p24869
as(dp24870
g18
V23354
p24871
stp24872
a((dp24873
g2
(lp24874
VAre the directories hidden
p24875
aVAre they actual directories, or (since this is a web-server) virtual folders
p24876
aVBtw - unless you specifically want some of the  features, you might as well leave them in the original  arrays
p24877
aVindeed, with 3
p24878
aV5, LINQ blurs the advantages of , since ,  etc apply to arrays
p24879
as(dp24880
g18
V23354
p24881
stp24882
a((dp24883
g2
(lp24884
VFrom what I remember, you might have to set the provider - like so
p24885
aVWith that, it should appear as "Source Control" in a few places
p24886
aVAdditional: However; this would be a good time to suggest something like SVN; easy to setup both client and server
p24887
aVmany other tools exist, at all budgets
p24888
aVAll seemingly preferable to VSS
p24889
as(dp24890
g18
V23354
p24891
stp24892
a((dp24893
g2
(lp24894
VWell, what is
p24895
aVThis typically happens with tree serializers (such as  and JSON implementations, etc) if you have a "parent" relationship
p24896
aVDoes your sub-menu know about its parent
p24897
aVCan you make this an internal property, perhaps
p24898
aVOr mark it to be ignored
p24899
as(dp24900
g18
V23354
p24901
stp24902
a((dp24903
g2
(lp24904
VNo,  will not trigger evaluation
p24905
aVThis will map to a call to:
p24906
aVAnd note that  (for LINQ-to-Objects, at least) is essentially something like:
p24907
aVThe key point here being that it evaluates lazy - not all at once
p24908
aVEither approach should be comparable - the only difference is that without , some code will run immediately - but only the code to build the  chain - it won't actually process the rows until you start iterating the result
p24909
aVFurthermore, depending on the data source, that approach can actually be more efficient - for example, with a LINQ-to-SQL backend, as the TSQL generator can skip the unnecessary columns
p24910
as(dp24911
g18
V23354
p24912
stp24913
a((dp24914
g2
(lp24915
V is used to provide custom binary serialization, usually for  (and perhaps for remoting purposes)
p24916
aVWithout it, it uses the fields, which can be:
p24917
aVinefficient; if there are fields that are only used for efficiency at runtime, but can be removed for serialization (for example, a dictionary may look different when serialized)
p24918
aVinefficient; as even for fields that are needed it needs to include a lot of additional metadata
p24919
aVinvalid; if there are fields that cannot be serialized (such as event delegates, although they can be marked )
p24920
aVbrittle; your serialization is now bound to the field names - but fields are meant to be an implementation detail; see also Obfuscation, serialization and automatically implemented properties
p24921
aVBy implementing  you can provide your own binary serialization mechanism
p24922
aVNote that the xml equivalent of this is , as used by  etc
p24923
aVFor DTO purposes,  should be avoided - things like xml (via  or ) or json are good, as are cross-platform formats like protocol buffers
p24924
aVFor completeness, protobuf-net does include hooks for  (allowing you to use a portable binary format without writing lots of code), but  wouldn't be your first choice here anyway
p24925
as(dp24926
g18
V23354
p24927
stp24928
a((dp24929
g2
(lp24930
VIn most cases, switching between test frameworks is just a case of search/replace
p24931
aVIf the csproj doesn't load, just create a new project file and drag the code files in and fix them afterwards (along with the references)
p24932
aVTestDriven
p24933
aVNET, for example (or NUnit console) are perfectly happy with just a dll/exe as the test project
p24934
aVMaybe a pain, but not necessarily a huge problem
p24935
aVIf you want to use NUnit with MVC, there are brief instructions here and here - I don't know (haven't tested) whether they apply to Standard
p24936
as(dp24937
g18
V23354
p24938
stp24939
a((dp24940
g2
(lp24941
VIf you have a string, then the first thing to do is to use , or (preferably)  to get the  instance
p24942
aVFrom there, you need to use reflection:
p24943
aVwhere  is the instance for instance methods, and  for static methods
p24944
aVFor example:
p24945
as(dp24946
g18
V23354
p24947
stp24948
a((dp24949
g2
(lp24950
VMaybe a
p24951
aVyou'd have to wrap it yourself to treat it as a , though
p24952
aVOf course, you could just use  - but you'd have to absorb the cost of deleting from the middle
p24953
aVSomething like:
p24954
aVwith whatever other methods / synchronization / etc you need
p24955
as(dp24956
g18
V23354
p24957
stp24958
a((dp24959
g2
(lp24960
VYou can use the C# 3
p24961
aV0 compiler features in
p24962
aVNET 2
p24963
aV0 with a few tricks - but you aren't going to be able to use framework dlls / types / methods that don't exist in 2
p24964
ag190
aVI don't recommend trying to simply deploy any 3
p24965
aV5 dlls without having the client have
p24966
aVNET 3
p24967
aV5 installed
p24968
aVMy expectation is that you'll have to install
p24969
aVNET 3
p24970
aV5 on the machine, or make do without the framework feature you want
p24971
as(dp24972
g18
V23354
p24973
stp24974
a((dp24975
g2
(lp24976
VThis is all freely available in MiscUtil
p24977
aVThe  class provides access to generic arithmetic; and there are generic implementations (as extension methods) of , , etc - and works with any type with suitable operators in addition to the primitives
p24978
aVSo for example, you could use Sum with of , etc
p24979
aVNote that it currently uses
p24980
aVNET 3
p24981
aV5; I did have a 2
p24982
aV0 version somewhere, but it isn't as tested
p24983
aVA simplified example of sum is shown in the usage document:
p24984
aVAlthough IIRC the actual implementation has a bit more
p24985
aVAs an aside, note that  (in
p24986
aVNET 4
p24987
aV0 / C# 4
p24988
aV0) supposedly supports operators, but we'll have to wait for the beta to see what it does
p24989
aVFrom my previous looks at  in the CTP, I expect it to be a bit slower than the MiscUtil code, but we shall see
p24990
as(dp24991
g18
V23354
p24992
stp24993
a((dp24994
g2
(lp24995
VSketchPath [Edit: recently renamed XMLQuire] has various features here
p24996
as(dp24997
g18
V23354
p24998
stp24999
a((dp25000
g2
(lp25001
VIt is hard to tell, but it would be interesting to see what connections were active when it bombed
p25002
aVmaybe it is spawning multiple somehow
p25003
aVHowever; for transferring mass data, I would usually recommend either just a stored procedure (if the processing can be done in the database) - or if you need richer code, something like  hooked to an  - this will allow you to stream data from one table to the other with the minimum of buffering / overhead
p25004
aVRepresenting an arbitrary data-source as an  (to feed to ) is a pain, but you can use  for this
p25005
aVYou would also use  on the source  to consume the data from origin
p25006
as(dp25007
g18
V23354
p25008
stp25009
a((dp25010
g2
(lp25011
VThe biggest pain with LINQ is that (with database backends) you can't use it over a repository interface without it being a leaky abstraction
p25012
aVLINQ is fantastic within a layer (especially the DAL etc), but since different providers support different things, you can't rely on  or  features working the same for different implementations
p25013
aVAs examples, between LINQ-to-SQL and Entity Framework:
p25014
aVEF doesn't support
p25015
aVEF will error if you // without an explicit
p25016
aVEF doesn't support UDFs
p25017
aVetc
p25018
aVThe LINQ provider for ADO
p25019
aVNET Data Services supports different combinations
p25020
aVThis makes mocking and other abstractions unsafe
p25021
aVBut: for in-memory (LINQ-to-Objects), or in a single layer/implementation
p25022
aVfantastic
p25023
aVSome more thoughts here: Pragmatic LINQ
p25024
as(dp25025
g18
V23354
p25026
stp25027
a((dp25028
g2
(lp25029
s(dp25030
g18
V23354
p25031
stp25032
a((dp25033
g2
(lp25034
VThe first thing to try is GetNewBindingList(), but this thread: "Linq-SQL canonical editable datagridview sample code" has some thoughts for other scenarios
p25035
as(dp25036
g18
V23354
p25037
stp25038
a((dp25039
g2
(lp25040
V(edited to cover points in comments)
p25041
aVTo emphasise: there are differences and similarities between value-types and reference-types, but those differences have nothing to do with stack vs heap, and everything to do with copy-semantics vs reference-semantics
p25042
aVIn particular, if we do:
p25043
aVThen are "first" and "second" talking about the same copy of
p25044
aVor different copies
p25045
aVIt just so happens that the stack is a convenient and efficient way of handling value-types as variables
p25046
aVBut that is an implementation detail
p25047
aV(end edit)
p25048
aVRe the whole "value types go on the stack" thing
p25049
aV- value types don't always go on the stack;
p25050
aVif they are fields on a class
p25051
aVif they are boxed
p25052
aVif they are "captured variables"
p25053
aVif they are in an iterator block
p25054
aVthen they go on the heap (the last two are actually just exotic examples of the first)
p25055
ag412
ag50
aVAdditionally, Eric Lippert (as already noted) has an excellent blog entry on this subject
p25056
as(dp25057
g18
V23354
p25058
stp25059
a((dp25060
g2
(lp25061
VHow about using jQuery to load some of the areas (divs etc) via ajax
p25062
aVThen you can cache different areas as complete requests, with different granularity
p25063
as(dp25064
g18
V23354
p25065
stp25066
a((dp25067
g2
(lp25068
VWell, to do nothing for most, surely something like:
p25069
aVThen add matches for what you do want:
p25070
aVHowever, it seems like a very unusual requirement
p25071
aVNormally you simply use matches that navigate to the known content through knowledge of the xml
p25072
as(dp25073
g18
V23354
p25074
stp25075
a((dp25076
g2
(lp25077
VThere is one important consideration of using an exe to host types
p25078
aVit isn't very well supported by VS2005
p25079
aVThe compiler (csc), runtime, etc all see no real problems - simply that the IDE isn't very happy about adding references to exe files
p25080
aVThis is fixed in VS2008, but if you need to support VS2005 developers, I would recommend using a dll for the reference
p25081
aVAt the assembly level, there isn't a huge amount of difference
p25082
aVFor distinguishing between the two (exe/dll) - check for an entry-point on the assembly:
p25083
as(dp25084
g18
V23354
p25085
stp25086
a((dp25087
g2
(lp25088
VDynamic will go a long way to solving problems with methods known only by name, where that name is known and fixed at compile time - but of course, such methods could also be expressed as interfaces if you control the types
p25089
aVThere are cases where  would not help at all:
p25090
aVwhere the method name isn't known at compile time (i
p25091
ag50
aVit is loaded from config / user input)
p25092
aVobject creation
p25093
aVmaybe some generics scenarios
p25094
aVThe biggest uses I see for  are:
p25095
aVCOM interop (obviously)
p25096
aVgeneric operator support
p25097
aVduck typing where there is no common interface
p25098
aVDLR interop (see comments)
p25099
aVBut it definitely doesn't solve every reflection woe
p25100
as(dp25101
g18
V23354
p25102
stp25103
a((dp25104
g2
(lp25105
VUltimately, it wouldn't take much to wrap it - you'd just need to buffer the current line and read off inputs in your desired format
p25106
aVBut IMO, a little split/TryParse etc rarely hurts
p25107
aVI'm not 100% sure of the expected formats that  accepts, but I doubt it would be hard to do something similar
p25108
aVI'm not volunteering to write it, though ;-p
p25109
as(dp25110
g18
V23354
p25111
stp25112
a((dp25113
g2
(lp25114
VWhat serialization mechanism are you using
p25115
aVmight be a problem because of the root node and things like namespace declarations, which are a bit tricky to get shot of - plus it isn't great at partial deserializations
p25116
aVis very brittle to begin with - I don't recommend it in most cases
p25117
aVOne option might be protobuf-net; this is a binary serializer (using Google's "protocol buffers" format - efficient, portable, and version-tolerant)
p25118
aVYou can serialize multiple objects to a stream with
p25119
aVTo deserialize the same items,  returns an  of the deserialized items - or you could easily make  public (it is currently private, but the source is available)
p25120
aVJust write each object to file after you have created it - job done
p25121
aVIf you want an example, please say - although the unit tests here give an overview
p25122
aVIt would basically be something like (untested):
p25123
as(dp25124
g18
V23354
p25125
stp25126
a((dp25127
g2
(lp25128
VYou can't extend LINQ-to-SQL entity types in this way via inheritance - you should instead use a  to add extra methods to the existing generated entity
p25129
aVBecause LINQ-to-SQL supports inheritance (for discriminated tables, etc), it expects an exact match to a known entity type - not unexpected subclasses
p25130
ag412
ag50
aVIn the above, this is combined with the partial class in the designer
p25131
aVcs to create you type
p25132
aVThe other way to do this (if partial class isn't an option) is via an extension method
p25133
aVIf there are methods common between types, you can do this by declaring an interface, using extension methods on that interface, and using partial classes to add the interface to the specific types:
p25134
aVor if you need to know the type:
p25135
as(dp25136
g18
V23354
p25137
stp25138
a((dp25139
g2
(lp25140
V and  are the simplest way of describing a user as a "principal"
p25141
aVThis can be used for implementation-unaware security checking in an application - i
p25142
ag50
aVif the user logs in as "Fred" with the "User" and "Admin" permissions:
p25143
aVYou might do this at the point of client login to a winform, or there are specific points to do this in WCF, ASP
p25144
aVNET, etc
p25145
aVThen later code, without having to know how those permissions are handled, can check that permission - either via IsInRole, or declaratively:
p25146
aVSome useful utility code here is null-safe wrappers around principal/identity:
p25147
aVThen you might have some audit code in your DAL:
p25148
aVis useful for the simple cases of a plain username and set of known roles
p25149
aVMore sophisticated principal implementations might, for example, do "on demand" access checking - i
p25150
ag50
aVuntil you ask for the "Foo" role it doesn't know - it then finds out (by talking to a web-service, database, active-directory, etc) and caches the result for future access
p25151
aVThis is useful when the list of potential roles is large, and the number of roles typically queried in reality is small
p25152
aVYou can also use a principal to store extra identity information that is only needed in certain contexts - for example, a security token
p25153
aVCallers might test the principal with  to see if it supports the extra data
p25154
aVUsing "principal" is useful because your logic processing code can talk about identity, without having to know whether this is winforms, ASP
p25155
aVNET, WCF, a windows service, etc - it is abstract
p25156
aVAdditionally, some 3rd party code will also talk to the principal
p25157
aVAs another example - I wrote some example code here that shows how to use the principal to control access to winform controls via the designer (via an  - which puts extra entries into the property grid in VS)
p25158
as(dp25159
g18
V23354
p25160
stp25161
a((dp25162
g2
(lp25163
VNot really; especially if you don't have access to the source
p25164
aVEven if you could, it isn't a good idea to forcibly interrupt code without good reason - it can only lead to problems (leaks, locks being left locked, etc)
p25165
aVDoes it have to be the same UI thread
p25166
aVYou could spawn a second UI thread to own this code
p25167
aVIt gets a little scrappy, but can work
p25168
as(dp25169
g18
V23354
p25170
stp25171
a((dp25172
g2
(lp25173
VFor internet based repositories, you would be better off hosting via a web-server
p25174
aVVisualSVN Server is free, and provides an easy way of hosting SVN on windows using Apache (which it installs and configures)
p25175
aVIt tells you the SVN http path in the management tool - of course, you'll need to ensure you have line-of-sight/DNS between the devices, which might mean some more configuration / firewall rules / port forwarding / etc
p25176
as(dp25177
g18
V23354
p25178
stp25179
a((dp25180
g2
(lp25181
V relies on  for this functionality
p25182
aVThe behaviour depends entirely on the specific list implementation
p25183
aVIs this a /
p25184
aVIf so, this maps to , with syntax listed here
p25185
aVThe  implementation has no regex support, but supports  via  - i
p25186
ag50
aVwhere  is something like
p25187
aVAt least, that is my understanding
p25188
aVI'm still assuming that you are using /
p25189
aVa pragmatic alternative might be to introduce an extra (bool) column for the purpose
p25190
aVSet/clear that marker as the predicate (using a regex or any other complicated logic), and just use the row-filter to say "where set"
p25191
aVNot very clean, maybe, but a lot simpler than implementing a custom data-view / binding-source
p25192
aVIf you are using objects (rather than ), then another option might be the Dynamic LINQ Library
p25193
aVI don't know the full range of what it supports, but it () certainly has some / much of the  capability
p25194
aVAnd since the code is available in the sample project, it is possible you could educate it to apply a regex
p25195
as(dp25196
g18
V23354
p25197
stp25198
a((dp25199
g2
(lp25200
VWell, you could probably do something with
p25201
aVmaybe something with  or  on the end
p25202
aVCan you give more of an example
p25203
as(dp25204
g18
V23354
p25205
stp25206
a((dp25207
g2
(lp25208
VIf  isn't the LINQ entity, then you can do it directly:
p25209
aVHowever; if  is a LINQ entity, you need to use subtrefuge:
p25210
aVThe  breaks the LINQ composition, making it work
p25211
as(dp25212
g18
V23354
p25213
stp25214
a((dp25215
g2
(lp25216
VThe abstract way of talking about identity is the "principal" - see this thread
p25217
aVI would hope that this code allows you to get the identity without having to know about the login implementation:
p25218
as(dp25219
g18
V23354
p25220
stp25221
a((dp25222
g2
(lp25223
V2: LINQ-to-SQL has the benefits of being simple (but still well engineered) - but the downside of being simple ;-p
p25224
aVLINQ-to-SQL only works on SQL Server (Entity Framework is pluggable; 3rd party variants of LINQ-to-SQL like DBLinq cover some other providers)
p25225
aVEntity Framework supports more abstraction between the data (storage) model and the object model - LINQ-to-SQL is literal table/column => class/property[|field]
p25226
aVLINQ-to-SQL is actually more "complete" in the stuff it does do:
p25227
aVEF doesn't support UDFs
p25228
aVEF doesn't support things like sub-expression invoke (for custom expression trees)
p25229
aVEF doesn't support some "obvious" methods like
p25230
aVEF doesn't have some of the TSQL optimisations that LINQ-to-SQL uses
p25231
aVBasically EF at the moment is a bit more of a "v1" (or even "v0
p25232
aV9") product
p25233
aVHowever (and importantly) - EF is likely to have a proper next version in
p25234
aVNET 4
p25235
aV0 etc, where-as LINQ-to-SQL is going to see a lot less change
p25236
aVIt is still being maintained, but famously Microsoft have chosen Entity Framework as the flagship product (rather than co-evolve both products essentially into each-other)
p25237
aVYou should think about the long term plans
p25238
aVAt the moment, I'm very happy to use LINQ-to-SQL, but EF is on the long term
p25239
aVso I'm using repository etc to hide some of the gory implementation details - a bit of a leaky repository, but pragmatic
p25240
aV3: With LINQ-to-SQL, assign a  to ;  works well - or I have one that writes to the trace
p25241
aVasax
p25242
aVWith EF, ToTraceString
p25243
aV4: I suspect it breaks down a lot by complexity
p25244
aVPeople using SQL Server with simple models, or who are happy to have a storage model that shines into the object model tend to be using LINQ-to-SQL at the moment (from what I see)
p25245
aVPeople with more complexity and other databases tend to use NHibernate ;-p And then some EF
p25246
aVI'm wondering how much this will change when EF is next released in
p25247
aVNET 4
p25248
ag190
as(dp25249
g18
V23354
p25250
stp25251
a((dp25252
g2
(lp25253
VThe only way I can think to do this would be to add a shim property in a partial class that does the translation
p25254
as(dp25255
g18
V23354
p25256
stp25257
a((dp25258
g2
(lp25259
VIf you mean that you want the categories sorted in a specific (non-alphabetical) way, then  no - I don't think you can do that
p25260
aVYou might want to try VisualHint - I expect it does have this (since you can seize a lot more control)
p25261
as(dp25262
g18
V23354
p25263
stp25264
a((dp25265
g2
(lp25266
VWeb Developer is a separate product to VS2008, and the install shouldn't change it
p25267
aVAs an aside - with the multi-targetting in VS2008, you might want to save some space by uninstalling VS2005
p25268
aVVS2008 can't target 1
p25269
aV1, though (except maybe via MSBEE) - so maybe keep VS2003 if you still maintain 1
p25270
aV1 code
p25271
aVObviously, if you do this: first make sure that VS2008 supports any legacy requirements you need
p25272
aV(i
p25273
ag50
aVdon't blame me if you can't edit your project
p25274
aVI would probably uninstall Web Developer first, but you might find it handy for small test projects
p25275
aVI keep C# Express installed for the same reason (I find it quicker for small scratch tests)
p25276
as(dp25277
g18
V23354
p25278
stp25279
a((dp25280
g2
(lp25281
VIf you are just checking for existance,  in
p25282
aVNET 3
p25283
aV5 is your best option - dictionary-like performance, but no key/value pair - just the values:
p25284
as(dp25285
g18
V23354
p25286
stp25287
a((dp25288
g2
(lp25289
VHave you unchecked the "Verify that file exists" box on the extension mapping
p25290
as(dp25291
g18
V23354
p25292
stp25293
a((dp25294
g2
(lp25295
VAre you licensed via MSDN
p25296
aVIf so, then a "Visual Studio Professional with MSDN Premium" or "Visual Studio Professional with MSDN Professional" subscription includes licenses for VSS
p25297
aVHowever, I also repeat the suggestions to look at other offerings
p25298
aVMy preference is for VisualSVN Server + TortoiseSVN (client)
p25299
as(dp25300
g18
V23354
p25301
stp25302
a((dp25303
g2
(lp25304
VThe difference is that ComponentModel is an abstraction over raw classes
p25305
aVThis means that you can define properties that don't exist - and indeed, that is exactly how  /  expose columns as properties for data binding
p25306
aVUsing ComponentModel, the, you can get something like "dynamic" even in 1
p25307
ag733
aVYou might think that means that ComponentModel is slower; but actually, you can exploit this abstraction for gain
p25308
aVHyperDescriptor does exactly that - using  to write direct IL to represent properties, giving much faster access than either reflection or vanilla ComponentModel
p25309
aVNote, however, that ComponentModel is, by default, limited to properties (not fields)
p25310
aVYou can do it via on-the-fly  facades, but it isn't a good idea
p25311
aVThere also isn't much place for a "write only" property in ComponentModel
p25312
as(dp25313
g18
V23354
p25314
stp25315
a((dp25316
g2
(lp25317
VWell, what is the larger context
p25318
aVThere are usually specialized tools in specific areas
p25319
aVI mainly know about MS technology, where "data dude" can do database test data generation, and (unrelated) PEX can use analysis to find data that gets into your uncommon code branches
p25320
aVbut for much more specific scenarios, you might need to write your own tool
p25321
as(dp25322
g18
V23354
p25323
stp25324
a((dp25325
g2
(lp25326
VHow about , where  is some base-entity or describes the product
p25327
aVIf it truly is generic, then perhaps just
p25328
as(dp25329
g18
V23354
p25330
stp25331
a((dp25332
g2
(lp25333
VNo, basically
p25334
aVIf you want to use the existing , you'll have to maintain a second version of the DTO class and convert the data between them
p25335
aVOptions if you are writing your own serialization code:
p25336
aVdeclare your own -style attribute(s) and interpret them at runtime in your own serialization code
p25337
aVuse a "buddy class"
p25338
aVuse external metadata (such as a file)
p25339
aVuse code-based configuration (i
p25340
ag50
aVvia a DSL)
p25341
aVIn reality, I expect the first will be the simplest choice
p25342
as(dp25343
g18
V23354
p25344
stp25345
a((dp25346
g2
(lp25347
VI don't think so, no
p25348
aVI believe that this, like the primitives, is handled directly by the runtime
p25349
as(dp25350
g18
V23354
p25351
stp25352
a((dp25353
g2
(lp25354
VI believe you can just override the :
p25355
aVFor other scenarios; in general with a custom , you specify attributes in the constructor
p25356
aVYou'll need to expand the  argument to include the
p25357
aVIf you need to do any processing, you can use a static method - untested:
p25358
aVAlso - note that for a  to be used, the system must find it
p25359
aVthe resolution rules are:
p25360
aVfor , the  provides the properties, defaulting to the properties for an instance (below)
p25361
aVfor an instance:
p25362
aVis checked
p25363
aVotherwise it checks for a registered  for the instance or type
p25364
aVotherwise reflection is used
p25365
aVfor a type:
p25366
aVit checks for a registered  for the type
p25367
aVotherwise reflection is used
p25368
aVfor lists:
p25369
aVis checked and resolved to a list (processing continues)
p25370
aVis checked
p25371
aVotherwise, the list type is checked for a non-object indexer - i
p25372
ag50
aVif such is found, then the properties for the type  are used, as defined above
p25373
aVotherwise, if the list is not empty, the properties of the first instance () are used, as defined above
p25374
aVotherwise, metadata is not available
p25375
as(dp25376
g18
V23354
p25377
stp25378
a((dp25379
g2
(lp25380
VIf correct (I can't easily verify), that is fasinating
p25381
aVThe order shouldn't matter, AFAIK
p25382
aVIf you are sure about it, then perhaps log as a bug on connect (with sample code)
p25383
as(dp25384
g18
V23354
p25385
stp25386
a((dp25387
g2
(lp25388
VA resx file (compiled to a resource dll)
p25389
aVOr simpler - a zip file
p25390
aVPerhaps using #ZipLib
p25391
as(dp25392
g18
V23354
p25393
stp25394
a((dp25395
g2
(lp25396
VMaybe a (named) Semaphore with a count of one
p25397
aVto lock,  to unlock
p25398
as(dp25399
g18
V23354
p25400
stp25401
a((dp25402
g2
(lp25403
VIf I undertand the question
p25404
aVif you have access to LINQ, then it becomes simple:
p25405
aV(replace  with  if you are using LINQ-to-Objects)
p25406
aVIf you are talking to a datawith with regular ADO
p25407
aVNET, you could either use dynamic query composition, or you could invoke an SP (or similar) that does the same internally - for example (of the first):
p25408
as(dp25409
g18
V23354
p25410
stp25411
a((dp25412
g2
(lp25413
V might simplify a limited number of reflection scenarios (where you know the member-name up front, but there is no interface) - in particular, it might help with generic operators (although other answers exist) - but other than the generic operators trick, there is little crossover with generics
p25414
aVGenerics allow you to know (at compile time) about the type you are working with - conversely,  doesn't care about the type
p25415
aVIn particular - generics allow you to specify and prove a number of conditions about a type - i
p25416
ag50
aVit might implement some interface, or have a public parameterless constructor
p25417
aVdoesn't help with either: it doesn't support interfaces, and worse than simply not caring about interfaces, it means that we can't even see explicit interface implementations with
p25418
aVAdditionally,  is really a special case of , so boxing comes into play, but with a vengence
p25419
aVIn reality, you should limit your use of  to a few cases:
p25420
aVCOM interop
p25421
aVDLR interop
p25422
aVmaybe some light duck typing
p25423
aVmaybe some generic operators
p25424
aVFor all other cases, generics and regular C# are the way to go
p25425
as(dp25426
g18
V23354
p25427
stp25428
a((dp25429
g2
(lp25430
VIf you need to do this through code (the
p25431
aVNET tag), then  is your friend -ideally when mixed with  on the source
p25432
aVLike so:
p25433
as(dp25434
g18
V23354
p25435
stp25436
a((dp25437
g2
(lp25438
VThe cast, in this case, does nothing at runtime - it is there purely for the compiler
p25439
aVIf you really hate it, perhaps:
p25440
aVBut I'd leave it myself
p25441
aVAs an aside - since you are going to box it anyway, you could dispense with the overload, and just work with  - then you don't even need the  field:
p25442
as(dp25443
g18
V23354
p25444
stp25445
a((dp25446
g2
(lp25447
VADO
p25448
aVNET is a big topic - but the keywords to search for here are , , , etc
p25449
aVIf you like  (I'm not a fan, but some people love them), then the dataset designer will do a lot for you
p25450
aVAnother option is to use a
p25451
aVNET 2
p25452
aV0 web-service (asmx) for data access via a central app-server - making it a "smart client"
p25453
aVWith later
p25454
aVNET versions, WCF (
p25455
aVNET 3
p25456
aV0), LINQ-to-SQL (
p25457
aVNET 3
p25458
aV5), Entity Framework (
p25459
aVNET 3
p25460
aV5 SP1) and ADO
p25461
aVNET Data Services (
p25462
aVNET 3
p25463
aV5 SP1) become options
p25464
as(dp25465
g18
V23354
p25466
stp25467
a((dp25468
g2
(lp25469
VWell, you could look at PEX - but I believe that invents its own data (it doesn't watch your existing tests, AFAIK)
p25470
as(dp25471
g18
V23354
p25472
stp25473
a((dp25474
g2
(lp25475
VFor object=>control updates: your event will not be raised - automatically implemented properties don't care about  - you'll need to move it out:
p25476
aVBut for the other (control=>object), I expect you don't have the binding setup correctly
p25477
aVYou should be binding to the  property, and you'll need to tell it about your  instance at runtime:
p25478
aVOr if you are using  directly - the following shows it working with the above type:
p25479
as(dp25480
g18
V23354
p25481
stp25482
a((dp25483
g2
(lp25484
VThere isn't one (or at least, not one that just means "numbers")
p25485
aVYou could use:
p25486
aVBut that allows any struct - not just numbers
p25487
aVIf you want to do arithmetic, generic operators may be of use
p25488
aVOther than that; overloads it the most viable option
p25489
as(dp25490
g18
V23354
p25491
stp25492
a((dp25493
g2
(lp25494
VAt the simplest level:
p25495
aVOr with generics (supports ):
p25496
as(dp25497
g18
V23354
p25498
stp25499
a((dp25500
g2
(lp25501
VConsole apps can talk happily to SQLExpress databases
p25502
aVI expect you simply need to configure access to your domain account via management studio
p25503
aVPresumably, the web-developer app is using the ASPNET account, which has different domain credentials
p25504
as(dp25505
g18
V23354
p25506
stp25507
a((dp25508
g2
(lp25509
VWell,
p25510
aVNET languages (that emit to IL - C#, VB
p25511
aVNET, MC++, etc) aren't interpreted (especially if you use NGEN) - and has full garbage collection
p25512
aVLikewise, Java
p25513
as(dp25514
g18
V23354
p25515
stp25516
a((dp25517
g2
(lp25518
VYou will have to copy the data (only reference-type arrays are covariant) - but we can try to do it efficiently;  seems to work:
p25519
aVIf it was a reference-type, you can just cast the reference without duplicating the array:
p25520
as(dp25521
g18
V23354
p25522
stp25523
a((dp25524
g2
(lp25525
VMaybe make your error handling more granular so you are only catching a single attempt when it blows up
p25526
aVYou could do this (without repeating yourself) by refactoring the offending code out to a utility method - i
p25527
ag50
aVWhere  catches the exception and logs the (single) path that was passed as an argument
p25528
as(dp25529
g18
V23354
p25530
stp25531
a((dp25532
g2
(lp25533
VWhat exactly is the error message
p25534
aVNote that you have to serialize something concrete like a list or array of objects (not a query)
p25535
aVIf you want queryable over the wire, look at ADO
p25536
aVNET Data Services, which does this
p25537
aVAlso - have you set the serialization mode to "unidirectional" in the dbml designer
p25538
aVAs long as there are no loops, it should work fine
p25539
as(dp25540
g18
V23354
p25541
stp25542
a((dp25543
g2
(lp25544
VHere's a helpful extension method to avoid these cases where the two indexers overlap - it also helps if the key is :
p25545
aVthen call  and it will work fine
p25546
aVInside the generic method it can only resolve  to the  indexer
p25547
as(dp25548
g18
V23354
p25549
stp25550
a((dp25551
g2
(lp25552
VIf it is a , and if that stream supports seeking, then:
p25553
aVHowever, this is not possible on arbitrary 's
p25554
aVYou could perhaps read all of it as a string, then you can use  repeatedly
p25555
as(dp25556
g18
V23354
p25557
stp25558
a((dp25559
g2
(lp25560
VYou would need to write a  to do the work, and associate it with the property via
p25561
aVedit now with example - a fairly long one, I'm afraid - but most of the code can be shared between types, fortunately
p25562
aVYou can't use a single composite enum value because of the zero - so here I'm using a  to hold the selected enums - fairly easy to re-work to  if you have
p25563
aVNET 2
p25564
aV0/3
p25565
aV0, though
p25566
as(dp25567
g18
V23354
p25568
stp25569
a((dp25570
g2
(lp25571
VPersonally, I'd look at Json
p25572
aVNET - this has the advantage of (for older versions at least) being
p25573
aVNET 2
p25574
aV0 compatible
p25575
as(dp25576
g18
V23354
p25577
stp25578
a((dp25579
g2
(lp25580
VThe usual culprit here is things like events (in ), or other back-references to external objects
p25581
aVYou can mark fields as not for serialization:
p25582
aVor with field-like events:
p25583
aVAs an aside - from the description, I assume that you are using ; personally, I have reservations about this - it is very brittle
p25584
aVI'd suggest something non-implementation-specific; , protobuf-net, Json
p25585
aVNET, etc
p25586
as(dp25587
g18
V23354
p25588
stp25589
a((dp25590
g2
(lp25591
VYou should be able to use:
p25592
aVOf course, it would be more efficient to do:
p25593
as(dp25594
g18
V23354
p25595
stp25596
a((dp25597
g2
(lp25598
VWell, using a delegate such as  can make it more re-usable without requiring polymorphism / inheritance - but there is nothing more "inbuilt" in C#:
p25599
as(dp25600
g18
V23354
p25601
stp25602
a((dp25603
g2
(lp25604
VWell, the obvious difference with explicit local copying is that you can use it even when the share is unavailable
p25605
aVIf the app can run from a share, it would be equally trivial to make it work from (say) a ClickOnce deployment marked for offline use
p25606
aVThen you get the advantages of offline use and caching on the client (so it doesn't have to copy anything the 2nd/3rd/etc time) - but it is still really easy to update automatically
p25607
aVNote that ClickOnce deployments can also be network share deployed, so to me it makes sense to go this route
p25608
aVYou also get to sign the overall deployment (not just individual files), specify trust, etc
p25609
aVPlus it'll work without
p25610
aVNET 3
p25611
aV5SP1, and it won't matter whether it is a mapped share ("f:\u005c") or a UNC ("\u005c\u005cfooserver\u005cbar") - I believe the 3
p25612
aV5 SP1 tweaks only apply to mapped shares
p25613
aVFinally, you also get things like the ability to use file associations
p25614
aVSo many wins, and so few problems
p25615
aVI'd use ClickOnce ;-p
p25616
as(dp25617
g18
V23354
p25618
stp25619
a((dp25620
g2
(lp25621
VWhat are you using to process the data
p25622
aVSince that is obviously custom serialization, it seems like you should be able to tweak "BooleanField" processing to handle both
p25623
aVIMO, though, your not using xml the way it is intended
p25624
aVit would be easier to specify this as elements/attributes, like how  would (indeed - why not just use
p25625
ag6864
aVor
p25626
aVNote that the xml standard for true/false is lower case
p25627
aVAdditionally; if you are using  - you can just change the converter:
p25628
as(dp25629
g18
V23354
p25630
stp25631
a((dp25632
g2
(lp25633
VCan you clarify what the contents of the file are (i
p25634
ag50
aVan example)
p25635
aVEither as binary (perhaps hex) or characters
p25636
aVIf the data is a VB6 string, then you'll have to use float
p25637
aVParse() to read it
p25638
aVNET strings are also 2-bytes per character, but when loading from a file you can control this using the
p25639
as(dp25640
g18
V23354
p25641
stp25642
a((dp25643
g2
(lp25644
VNormally, collections are initialized by the parent object:
p25645
aVNow it should work as expected
p25646
aVNote that if you are using  you'll need to keep the public set too
p25647
aVIn some ways, the long-hand property code is easier here:
p25648
aV(no messing with constructors, etc)
p25649
as(dp25650
g18
V23354
p25651
stp25652
a((dp25653
g2
(lp25654
VIf I read it correctly
p25655
aVthen the problem is that just because , that does not mean that
p25656
aVIn some cases, variance in C# 4
p25657
aV0 may be an option
p25658
aVAlternatively, there are sometimes things you can do with generic methods (not sure it will help here, though)
p25659
aVThe closest you can do in C# 3
p25660
aV0 (and below) is probably a non-generic base interface:
p25661
aVcommonly, the base-interface would have, for example, a  to indicate the real type under consideration
p25662
aVThen usage:
p25663
aVFrom the spec, this relates to 25
p25664
ag691
aV6 (ECMA 334 v4):
p25665
aV25
p25666
ag691
aV6 Conversions
p25667
aVConstructed types follow the same conversion rules (13)
p25668
aVas do non-generic types
p25669
aVWhen applying
p25670
aVthese rules, the base classes and
p25671
aVinterfaces of constructed types shall
p25672
aVbe determined as described in 25
p25673
ag691
ag9575
aVNo special conversions exist between
p25674
aVconstructed reference types other than
p25675
aVthose described in 13
p25676
aVIn particular,
p25677
aVunlike array types, constructed
p25678
aVreference types do not permit
p25679
aVco-variant conversions (19
p25680
aV5)
p25681
aVThis
p25682
aVmeans that a type  has no
p25683
aVconversion (either implicit or
p25684
aVexplicit) to  even if  is
p25685
aVderived from
p25686
aVLikewise, no
p25687
aVconversion exists from  to
p25688
aV[Note: The rationale for
p25689
aVthis is simple: if a conversion to
p25690
aVis permitted, then apparently,
p25691
aVone can store values of type  into
p25692
aVthe list
p25693
aVHowever, this would break
p25694
aVthe invariant that every object in a
p25695
aVlist of type  is always a value
p25696
aVof type , or else unexpected failures
p25697
aVcan occur when assigning into
p25698
aVcollection classes
p25699
aVend note]
p25700
aVThe same applies to interfaces
p25701
aVThis changes a bit in C# 4
p25702
aV0, but only in some cases
p25703
as(dp25704
g18
V23354
p25705
stp25706
a((dp25707
g2
(lp25708
VIf this is a generic collection, then the caller should already (via LINQ) be able to use:
p25709
aVthat do
p25710
as(dp25711
g18
V23354
p25712
stp25713
a((dp25714
g2
(lp25715
VMy understanding is that you would typically create a struct in the
p25716
aVNET code that mirrors the expected data layout, using some of the  options (sequential or explicit) - and pass that struct over the PInvoke boundary (i
p25717
ag50
aVon the imported API)
p25718
as(dp25719
g18
V23354
p25720
stp25721
a((dp25722
g2
(lp25723
VCould you use a second form that only contains the listbox
p25724
aVYou'd need a little code to move it relative to the main form, but it should work
p25725
as(dp25726
g18
V23354
p25727
stp25728
a((dp25729
g2
(lp25730
VI wonder if it wouldn't be better to include json in the route-data and look it up in the action
p25731
ag412
ag50
aVwhen mapping your route, use something like (for the defaults):
p25732
aVor map the route as:
p25733
aVthen access this in the controller:
p25734
aV(or pass it in as an argument)
p25735
aVOther than that, you could potentially write your own route-handler, but that is a lot of work
p25736
as(dp25737
g18
V23354
p25738
stp25739
a((dp25740
g2
(lp25741
VIt sounds like you might want to look at "virtual mode"
p25742
aVThe data binding works differently, but it is well suited to lazy data fetching
p25743
as(dp25744
g18
V23354
p25745
stp25746
a((dp25747
g2
(lp25748
VThe
p25749
aVNET Micro Framework is an IL interpreter, and is very small
p25750
aVIt is not, however, fully featured - you don't get generics, and some things like properties work differently (there is no PropertyInfo)
p25751
aVOthers:
p25752
aVCompact Framework
p25753
aVSilverlight
p25754
as(dp25755
g18
V23354
p25756
stp25757
a((dp25758
g2
(lp25759
VIt doesn't stop the client removing the event handler - it just means that if they do you don't end up invoking a null delegate
p25760
aVconsider:
p25761
aVthread A: checks that  isn't null
p25762
aVthread B: unsubscribes, causing  to become null
p25763
aVthread A: invokes  (which is now null) = boom
p25764
aVOf course, with the above fix you now have a phantom invoke instead - i
p25765
ag50
aVthe subscriber can have the event invoked after they unsubscribed
p25766
aVgotta love threading
p25767
aVAs always, Eric Lippert has a blog on the subject: Events and Races
p25768
as(dp25769
g18
V23354
p25770
stp25771
a((dp25772
g2
(lp25773
VIf it "violates the Equals contract", then I'm not sure you should be using it as a key
p25774
aVIt something is using that as a key, you really need to get the hashing right
p25775
aVit is very unclear what the  logic is, but two values that are considered equal must have the same hash-code
p25776
aVIt is not required that two values with the same hash-code are equal
p25777
aVUsing a constant string won't really help much - you'll get the values split evenly over the types, but that is about it
p25778
as(dp25779
g18
V23354
p25780
stp25781
a((dp25782
g2
(lp25783
VLINQ is an ORM (albeit a fairly simple one), with the "O" being (importantly) "object"
p25784
aVIf you can't predict the layout of the object returned in each grid, then it isn't a good fit for ORM
p25785
aVPersonally I wouldn't jump from LINQ to  (but maybe I'm just biased against  ;-p) - I would use  and do my own object (etc) mapping
p25786
aVBut maybe it might save time to just use a
p25787
aVYMMV etc
p25788
as(dp25789
g18
V23354
p25790
stp25791
a((dp25792
g2
(lp25793
VTo expand on Joel's answer - the CLR has supported limited variance for a long time, but the C# compiler doesn't use them until 4
p25794
aV0 with the new "in" and "out" modifiers on generic interfaces and delegates
p25795
aVThe reasons are complicated, and I would get into a mess trying to explain, but it isn't as simple as it seems
p25796
aVRe making a "protected internal" method into a "public" method; you can do this with method hiding:
p25797
aV(as long as the arguments etc are all also public) - any use
p25798
as(dp25799
g18
V23354
p25800
stp25801
a((dp25802
g2
(lp25803
VWell, you could compensate if it was critical:
p25804
aVObviously this would be better if you can talk to the field (since assigning a field won't error)
p25805
aVYou could also wrap this up in bolierplate:
p25806
aVand call:
p25807
aVor something similar
p25808
as(dp25809
g18
V23354
p25810
stp25811
a((dp25812
g2
(lp25813
VIn protobuf-net, I use a graduated scale approach (and indeed, it handles all this for you if you simply use ) - the equivalent
p25814
aVproto is something like this:
p25815
ag412
ag50
aVif the  can be expressed in whole days, I just send the number of days since 1970, etc - plus a small marker to the scale
p25816
aVThis means that dates can be sent a bit more efficiently, but it doesn't really cost much more for other scales
p25817
aVPersonally, I wouldn't use  - I would explicitly use an offset of a known scale from a known epoch (such as the unix epoch)
p25818
aVThis makes it more portable between platforms
p25819
aVBut if you are sending (for example) just the millisecond offset, then a fixed scale would usually be more efficient than a variant-length scale
p25820
aVWhether you need signed or unsigned depends on whether you need dates before your epoch ;-p
p25821
as(dp25822
g18
V23354
p25823
stp25824
a((dp25825
g2
(lp25826
VI don't know about "built in", but you could try writing a page that uses SharpSVN and #ZipLib to do the job
p25827
aVIf that is too slow, you could presumably use either a commit hook or a scheduled job (every few minutes or something) to keep a pre-prepared zip handy somewhere that you can just return - using the "create as a different name then rename when ready" trick to minimize the amount of time it is locked / unavailable
p25828
aVOr name it with the revision number
p25829
as(dp25830
g18
V23354
p25831
stp25832
a((dp25833
g2
(lp25834
V is an  - but you need  to bind data
p25835
aVIdeally, you really want a typed list
p25836
aVWhy use  at all here
p25837
aVI doubt you have enough rows to need it
p25838
aVInstead, use a typed list ( or )
p25839
aVNote that you can only bind to a single type in a grid
p25840
aVIt isn't at all clear to me what you want to display in the grid, since at the moment you are only adding the description, but at the simplest level:
p25841
aVor (better):
p25842
aVThis won't help you put both  and  into a single grid
p25843
aVbut then, nothing will if they aren't the same type
p25844
aVOne thing that might work is an anonymous type of the common properties:
p25845
aVNote, however, that anonymous types are immutable (non-editable) - hence no point in using
p25846
aVThe other option is to declare your own class for the purpose, which means it can be editable too
p25847
as(dp25848
g18
V23354
p25849
stp25850
a((dp25851
g2
(lp25852
VI'm assuming that the xml is actually something like  /
p25853
ag412
ag50
aVempty elements
p25854
aVWhen non-standard formats are involved, one trick that works is to introduce your own shim property:
p25855
aVHere, the  property (the actual ) isn't used during serialization; instead, the  property is serialized under the  element - but with special rules
p25856
aVYou can replace  with any other value that you want to treat as the blank/default
p25857
aVNote that if you don't want to send the  element at all, you can write a , which  will check - if you return , it won't get written
p25858
as(dp25859
g18
V23354
p25860
stp25861
a((dp25862
g2
(lp25863
VWould  (for ) work
p25864
aVOtherwise, you'll probably have to use #if definitions in your source
p25865
aV- i
p25866
ag50
aVand define the  symbol in your 32-bit builds (there isn't anything built in)
p25867
as(dp25868
g18
V23354
p25869
stp25870
a((dp25871
g2
(lp25872
VWell, you can use Random
p25873
aVnextInt(int) specifying the range, and then just add the minimum value
p25874
ag412
ag50
aVrand
p25875
aVnextInt(12) + 5
p25876
as(dp25877
g18
V23354
p25878
stp25879
a((dp25880
g2
(lp25881
VYou can't remove items from an array
p25882
aVYou can, however, create a new array without the item
p25883
aVProbably the most convenient (but not necessarily efficient) way would be via a list:
p25884
as(dp25885
g18
V23354
p25886
stp25887
a((dp25888
g2
(lp25889
VMost UI bindings already handle this via property notifications, in particular (for WPF)
p25890
aV- i
p25891
ag50
aVif you are updating the UserId on a single instance:
p25892
aVThis should then update the binding automatically
p25893
aVIf you are, instead, changing the actual user instance, then consider the same trick, but against whatever hosts the user:
p25894
aVAnd if you are binding to something's "User
p25895
aVUserId", then it should work
p25896
as(dp25897
g18
V23354
p25898
stp25899
a((dp25900
g2
(lp25901
VThere is direct support for this in the TPL in
p25902
aVNET 4
p25903
aV0; until then just do the check yourself
p25904
aVit isn't many lines, from what I recall
p25905
aVsomething like:
p25906
aVThen use, for example:
p25907
as(dp25908
g18
V23354
p25909
stp25910
a((dp25911
g2
(lp25912
VThe problem is (from what I can see) that you've unioned the references of the arrays - so whichever array gets set last will win
p25913
aVOnce there is an array, it is using the indexer (not byte offset) - so the size doesn't matter
p25914
aVThe way to do this "properly" (or improperly, as the case may be) would probably be with unsafe code - taking the pointer to the array - something like:
p25915
aVOf course, I'm not sure I recommend it - but that seems to achieve what you want
p25916
aVI also wonder whether you can drop the  completely and just use unsafe access to a  directly:
p25917
as(dp25918
g18
V23354
p25919
stp25920
a((dp25921
g2
(lp25922
VThe xpath is then:
p25923
aVfor example, in :
p25924
aVEdit re comments: if you just want the sections, then use:
p25925
aVbut then you'll need to iterate the data manually (since you can theoretically have multiple sections named "blah", each of which can have multiple items)
p25926
as(dp25927
g18
V23354
p25928
stp25929
a((dp25930
g2
(lp25931
VWhat is wrong with null
p25932
aVRe the missing  vs , try :
p25933
as(dp25934
g18
V23354
p25935
stp25936
a((dp25937
g2
(lp25938
VThe file not being there is something that we can reasonably anticipate - and since we are at the UI level (I assume, since ), it makes reasonable sense to sanity check the request, and just tell the user directly and cancel
p25939
aVIf we were deep in the bowels of the code (a few levels removed from the UI), then an exception would be the right thing - but I'd still probably check for file existance first and give a sensible error
p25940
aVOf course, any file existance check is immediately a thread race condition ;-p
p25941
as(dp25942
g18
V23354
p25943
stp25944
a((dp25945
g2
(lp25946
VBinding generally doesn't work to fields
p25947
aVMost binding is based, in part, on the ComponentModel  model, which (by default) works on properties
p25948
aVThis enables notifications, validation, etc (none of which works with fields)
p25949
aVFor more reasons than I can go into, public fields are a bad idea
p25950
aVThey should be properties, fact
p25951
aVLikewise, mutable structs are a very bad idea
p25952
aVNot least, it protects against unexpected data loss (commonly associated with mutable structs)
p25953
aVThis should be a class:
p25954
aVIt will now behave as you think it should
p25955
aVIf you want it to be an immutable struct, that would be OK (but data-binding would be one-way only, of course):
p25956
aVHowever, I would first question why this is a struct in the first place
p25957
aVIt is very rare to write a struct in
p25958
aVNET languages
p25959
aVKeep in mind that the WCF "mex" proxy layer will create it as a class at the consumer anyway (unless you use assembly sharing)
p25960
aVIn answer to the "why use structs" reply ("unknown (google)"):
p25961
aVIf that is a reply to my question, it is wrong in many ways
p25962
aVFirst, value types as variables are commonly allocated (first) on the stack
p25963
aVIf they are pushed onto the heap (for example in an array/list) there isn't much difference in overhead from a class - a small bit of object header plus a reference
p25964
aVStructs should always be small
p25965
aVSomething with multiple fields will be over-sized, and will either murder your stack or just cause slowness due to the blitting
p25966
aVAdditionally, structs should be immutable - unlesss you really know what you are doing
p25967
aVPretty much anything that represents an object should be immuatable
p25968
aVIf you are hitting a database, the speed of struct vs class is a non-issue compared to going out-of-process and probably over the network
p25969
aVEven if it is a bit slower, that means nothing compared to the point of getting it right - i
p25970
ag50
aVtreating objects as objects
p25971
aVAs some metrics over 1M objects:
p25972
aVbased on the following (the speed difference is in object allocation, not field vs property)
p25973
aVSo about 5x slower, but still very, very quick
p25974
aVSince this is not going to be your bottleneck, don't prematurely optimise this
p25975
as(dp25976
g18
V23354
p25977
stp25978
a((dp25979
g2
(lp25980
VIn short, yes you can
p25981
aVHowever, if you need to change the contact you may want to set the DataSource to the contact (or the list of contacts) and use the DataMember to "Addresses"
p25982
aVHere's a simplified example showing such binding
p25983
aVIf I have missed your point, please clarify:
p25984
as(dp25985
g18
V23354
p25986
stp25987
a((dp25988
g2
(lp25989
VSince you are using underscores, there is no conflict between the names; so the "" is redundant and can be omitted
p25990
aVThe IL will be unaffected
p25991
aVAs long as there is no ambiguity between a field and variable/parareter, there is only one scenario in which the  keyword (in the context of meaning the current instance - not ctor-chaining) is strictly necessary - invoking an extension method that is defined separately:
p25992
as(dp25993
g18
V23354
p25994
stp25995
a((dp25996
g2
(lp25997
VSQL Server Books Online
p25998
aVBrowse by Job Role
p25999
aVTutorials
p26000
aVHow-to Topics
p26001
as(dp26002
g18
V23354
p26003
stp26004
a((dp26005
g2
(lp26006
VTo be honest, wikipedia does a reasonable job here
p26007
aVNET 3
p26008
aV0 introduces:
p26009
aVWCF - communication framework to hopefully replaces asmx and remoting
p26010
aVWF - workflow framework for sequential and state flows
p26011
aVWPF - replacement for windows forms
p26012
aVNET 3
p26013
aV5 introduces:
p26014
aVLINQ
p26015
aVLINQ-to-SQL
p26016
aVLINQ-to-Objects
p26017
aV, , , ,
p26018
aVC# 3
p26019
ag190
aVsome other minor tweaks ;-p
p26020
aVNET 3
p26021
aV5 SP 1 introduces:
p26022
aVLINQ
p26023
aVEntity Framework
p26024
aVADO
p26025
aVNET Data Services
p26026
aVEDIT: (jonskeet) The C# page has a similar layout, showing which versions introduced which features
p26027
as(dp26028
g18
V23354
p26029
stp26030
a((dp26031
g2
(lp26032
VInteresting question
p26033
aVAt one level, perhaps it was originally seen as a capability device, similar to the user-agent on the request (browscap etc)
p26034
aVIn reality, neither is really useful in this respect, and most code now uses other means to test for options
p26035
aVAnd in many ways the server is (indirectly) in control of the requests from well-behaved clients (if has an influencing factor, at least)
p26036
aVThese days, it is sometimes seen as a security issue, and I know many places that block this header on html traffic
p26037
aVBut for non-html (but still http) traffic (such as web-services) it may still serve a useful versioning purpose (although you often see a product-specific versioning header in such cases)
p26038
as(dp26039
g18
V23354
p26040
stp26041
a((dp26042
g2
(lp26043
VI wouldn't use a regex - I'd use the Html Agility Pack, and a query like:
p26044
as(dp26045
g18
V23354
p26046
stp26047
a((dp26048
g2
(lp26049
VAs "Guffa" already said, you shouldn't be using  unless you are in
p26050
aVNET 1
p26051
aV1; here's a simpler  example, though:
p26052
aVYour dates are now sorted in descending order
p26053
as(dp26054
g18
V23354
p26055
stp26056
a((dp26057
g2
(lp26058
V etc use the WinHTTP settings (not the IE settings), so the easiest thing to do is to configure WinHTTP
p26059
aVOn XP etc you can use:
p26060
aVto import the current IE settings into the WinHTTP store
p26061
aVAfter that,  etc should be able to use the same settings without issue
p26062
aVOn Vista and Windows 7 this is now found under:
p26063
aVYou need to run this as administrator
p26064
as(dp26065
g18
V23354
p26066
stp26067
a((dp26068
g2
(lp26069
VI suspect the place to start looking will be at any places where you manipulate the list - i
p26070
ag50
aVinsert/remove/re-assign items
p26071
aVMy suspicion is that there will be a callback/even-handler somewhere that is getting fired asynchronously (perhaps as part of the XNA paint etc loops), and which is editing the list - essentially causing this problem as a race condition
p26072
aVTo check if this is the case, put some debug/trace output around the places that manipulate the list, and see if it ever (and in particular, just before the exception) runs the manipulation code at the same time as your console output:
p26073
aVUnfortunately, such things are often a pain to debug, as changing the code to investigate it often changes the problem (a Heisenbug)
p26074
aVOne answer would be to synchronize access; i
p26075
ag50
aVin all the places that edit the list, use a  around the complete operation:
p26076
aVand in your callback (or whatever)
p26077
aVIn particular, a "complete operation" might include:
p26078
aVcheck the count and /
p26079
aVcheck for existance and insert/remove
p26080
aVetc
p26081
aV(i
p26082
ag50
aVnot the individual/discrete operations - but units of work)
p26083
as(dp26084
g18
V23354
p26085
stp26086
a((dp26087
g2
(lp26088
VNormally, you do this with generics, for example:
p26089
aVThe compiler should then infer the  when you call
p26090
aVNot quite sure what you want to do inside the method, so I can't tell whether this is useful
p26091
aVthe problem is that inside  you still can't name the  - you can either:
p26092
aVcall other generic methods with
p26093
aVuse reflection on  to do things
p26094
aVbut other than that, it is quite hard to manipulate anonymous types - not least because they are immutable ;-p
p26095
aVAnother trick (when extracting data) is to also pass a selector - i
p26096
ag50
aVsomething like:
p26097
as(dp26098
g18
V23354
p26099
stp26100
a((dp26101
g2
(lp26102
VTo avoid boxing, the best way to compare generics for equality is with
p26103
aVThis respects  (without boxing) as well as , and handles all the  "lifted" nuances
p26104
aVHence:
p26105
aVThis will match:
p26106
aVnull for classes
p26107
aVnull (empty) for
p26108
aVzero/false/etc for other structs
p26109
as(dp26110
g18
V23354
p26111
stp26112
a((dp26113
g2
(lp26114
VTo remove the risk of a bug in your code, try using :
p26115
as(dp26116
g18
V23354
p26117
stp26118
a((dp26119
g2
(lp26120
VI automatically get worried as soon as people start mentioning "transaction" and "session" in the same sentence
p26121
aVIn my opinion and experience, it simply doesn't scale to consider multiple WCF calls for a single transactional unit of work:
p26122
aVit means you have blocking dependent on an external client
p26123
aVlots of potential for unresolvable deadlocks - i
p26124
ag50
aVthat can only timeout, rather than db-centric deadlocks which can be detected
p26125
aVyou are forced to use sticky load-balancing
p26126
aVPersonally, I would try to work on a single unit-of-work
p26127
aVThat might mean that the client packages up a complete request and submits it as an atomic operation, or it might mean that you do that separately via the session - i
p26128
ag50
aVyou buffer the "what" over multiple calls, but only start doing something when you have everything you need
p26129
aVEither way, the net result is that you end up with your unit-of-work operating over a single implementation, which should make either db-transactions or ambient () transactions work fine
p26130
aVThe advantage of the ambient transaction (in your scenario) is that it'll work across multiple data-contexts, but I expect it should be possible to fix the  call (as per the related question) without too much headache
p26131
aVOr wait until
p26132
aVNET 4
p26133
aV0, when I am assured that the offending bug is resolved
p26134
aVOK, that last probably isn't useful in the short term
p26135
as(dp26136
g18
V23354
p26137
stp26138
a((dp26139
g2
(lp26140
Vint tends to be the norm unless you need massive volume of data, and has the advantage of working with  etc;  has some advantages if you want the numbers to be un-guessable or exportable, but if you use a  (unless you generate it yourself as "combed") you should ensure it is non-clustered (the index, that is; not the farm), as it won't be incremental
p26141
as(dp26142
g18
V23354
p26143
stp26144
a((dp26145
g2
(lp26146
VIt doesn't sound familiar, and I can't reproduce (see below, which follows your approach)
p26147
aVCan you post anything related to your "update the groups" code
p26148
as(dp26149
g18
V23354
p26150
stp26151
a((dp26152
g2
(lp26153
VCollections are simplified when they go over the wire
p26154
aVYou can specify the collection-type via the IDE and command-line (), but it will apply to all collections on the API
p26155
aVI think you should just accept it, and handle the mismatch through code
p26156
aVUltimately, on the wire, collections are just xml (over the standard bindings, at least) - something like:
p26157
aV- hence why it can't tell (from the schema) between an array (), a , a , and a
p26158
aVNote that if you use assembly sharing (i
p26159
ag50
aVthe same service contract assembly is at the client and server) then this won't happen - but that defeats the intent of SOA/mex
p26160
aVBut is is an approach used quite a lot - hence the IDE supports it directly, and command-line via a switch ()
p26161
aVFor the IDE supporting it
p26162
aVif you write the service contract and data contract in a class library (dll), and then add an assembly reference (i
p26163
ag50
aVa dll reference or a project reference) to this library from the two projects (the server project and the client project)
p26164
aVNow add a service reference from the client project to the server endpoint (the
p26165
aVsvc)
p26166
aVIf you are using VS2008, it will automatically check local references for types and use those in place of proxy generation - meaning: your client code uses the  from the class library, which already knows whether to use  etc
p26167
as(dp26168
g18
V23354
p26169
stp26170
a((dp26171
g2
(lp26172
s(dp26173
g18
V23354
p26174
stp26175
a((dp26176
g2
(lp26177
VOriginal
p26178
aVLike so:
p26179
aVUpdated
p26180
aVre :
p26181
as(dp26182
g18
V23354
p26183
stp26184
a((dp26185
g2
(lp26186
VIt really isn't clear to me what you are trying to do, but I'd be using a property:
p26187
aVNow you can watch for changes to  in 3 different ways:
p26188
aVin the  setter
p26189
aVvia the  event
p26190
aVby subclassing and overriding
p26191
as(dp26192
g18
V23354
p26193
stp26194
a((dp26195
g2
(lp26196
VAssuming the rows all have the same structure, the easiest option is to clone the old table, omitting the data:
p26197
aVAlternatively, something like:
p26198
as(dp26199
g18
V23354
p26200
stp26201
a((dp26202
g2
(lp26203
VThe limits are hard-coded:
p26204
aVParameters per stored procedure 2,100
p26205
aVParameters per user-defined function 2,100
p26206
aVI wrote some code before that split the  query into batches and combined the results
p26207
aVsee here for more
p26208
as(dp26209
g18
V23354
p26210
stp26211
a((dp26212
g2
(lp26213
VWhat version of the framework are you using
p26214
aVIt looks like a lot of these changes were made in the (from MSDN) "
p26215
aVNET Framework 3
p26216
ag691
ag9575
aV0 SP1, and 2
p26217
aV0 SP1" timeframe
p26218
as(dp26219
g18
V23354
p26220
stp26221
a((dp26222
g2
(lp26223
VDoes it have to be in the C# code
p26224
aVIt may be easier to do this at the client through script - for example, with jQuery some combination of width(), innerWidth() and outerWidth() should return the margin
p26225
as(dp26226
g18
V23354
p26227
stp26228
a((dp26229
g2
(lp26230
VThe main thing would be to ensure that every step of the pipeline supports international characters; i
p26231
ag50
aV- at what point do you first see "
p26232
aVIn the aspx code
p26233
aVOr only once it gets into the database table
p26234
aVThe web page should already be using an encoding such as UTF8, so that should be OK - but what data type are you using at the database
p26235
aVIt would need to be // (or  on older versions of SQL Server)
p26236
as(dp26237
g18
V23354
p26238
stp26239
a((dp26240
g2
(lp26241
VThat will work fine (no exception)
p26242
aVExtension methods don't use virtual calls (i
p26243
ag50
aVit uses the "call" il instruction, not "callvirt") so there is no null check unless you write it yourself in the extension method
p26244
aVThis is actually useful in a few cases:
p26245
aVetc
p26246
aVFundamentally, calls to static calls are very literal - i
p26247
ag50
aVbecomes:
p26248
aVwhere there is obviously no null check
p26249
as(dp26250
g18
V23354
p26251
stp26252
a((dp26253
g2
(lp26254
VIs it as simple as: you always call Set on index 0
p26255
as(dp26256
g18
V23354
p26257
stp26258
a((dp26259
g2
(lp26260
VAs a thought - if you don't want to have to do the "set" via an indexer, you could move the counter out onto a class
p26261
aVThen have a
p26262
aVYou can now update  outside of the dictionary, and only call  when  is zero
p26263
aVThis will have an extra de-reference, but you won't have to assign via the indexer
p26264
aVAs for which is faster: you'd need to profile
p26265
aVSomething like:
p26266
as(dp26267
g18
V23354
p26268
stp26269
a((dp26270
g2
(lp26271
VYou could maybe look at the Web Workflow examples
p26272
as(dp26273
g18
V23354
p26274
stp26275
a((dp26276
g2
(lp26277
VIf you mean "to find which dll I need (per-type)": MSDN
p26278
aVFor example,
p26279
aVNamespace:  Microsoft
p26280
aVAspnet
p26281
aVSnapin
p26282
aVAssembly:  AspNetMMCExt (in AspNetMMCExt
p26283
aVdll)
p26284
as(dp26285
g18
V23354
p26286
stp26287
a((dp26288
g2
(lp26289
VWell, you could put a UNIQUE constraint spanning the interesting columns (presumably ,  and ) in the database
p26290
aVthat will prevent duplicates pretty well (by raising an exception that you can catch and message box appropriately)
p26291
aVThe other approach is to check for existing values first - but unless you use something like serializable isolation-level you still have a race condition
p26292
as(dp26293
g18
V23354
p26294
stp26295
a((dp26296
g2
(lp26297
VIf it is performance critical, then perhaps just don't use  for the open end-date - use the maximum supported datetime instead (probably lots of 9s)
p26298
aVI'd also do the conversion separately:
p26299
aVThere is still something a bit different in the above and your original; if you can explain the intent of the  check I might be able to tidy (read:fix) it a bit
p26300
as(dp26301
g18
V23354
p26302
stp26303
a((dp26304
g2
(lp26305
VThe full path should be:
p26306
aVOnce you have a  (simply ), something like:
p26307
as(dp26308
g18
V23354
p26309
stp26310
a((dp26311
g2
(lp26312
VThis isn't pretty, but it seems to work:
p26313
as(dp26314
g18
V23354
p26315
stp26316
a((dp26317
g2
(lp26318
VWell, with  and LINQ-to-XML:
p26319
aVThere are lots of similar routes, though
p26320
as(dp26321
g18
V23354
p26322
stp26323
a((dp26324
g2
(lp26325
VThe most likely thing is that you need to set the working path:
p26326
ag412
ag50
aVI'm thinking it can't find file
p26327
aVin in the current app folder
p26328
as(dp26329
g18
V23354
p26330
stp26331
a((dp26332
g2
(lp26333
VYou can usually associate editors etc at runtime via
p26334
aVFor example (the  property should show with a "
p26335
aVthat displays "Editing
p26336
ag6864
as(dp26337
g18
V23354
p26338
stp26339
a((dp26340
g2
(lp26341
VThe LINQ-to-SQL designer is maintaining the mapping
p26342
aVUnmapped properties need to go in a separate partial class
p26343
as(dp26344
g18
V23354
p26345
stp26346
a((dp26347
g2
(lp26348
VThe advantages of  are:
p26349
aVyou don't have to pass a transaction around (ADO
p26350
aVNET should enlist automatically)
p26351
aVwhich means that you can even use a  to add transactions to existing, closed-source code (i
p26352
ag50
aVno changes are required)
p26353
aVa  can (via DTC) span multiple resources (i
p26354
ag50
aVmultiple databases, or a database and an MSMQ server, etc)
p26355
aVBut you pay for this a little bit with speed
p26356
aVA connection-based transaction is slightly quicker (not much), but can only span a single resource and needs to be attached manually to all your DAL code
p26357
aVHowever, if you only talk to a single SQL2005/SQL2008 instance, then it can use the "LTM" - meaning it doesn't have to involve DTC (which is where most of the performance cost comes from) unless it absolutely needs to
p26358
aVMany  operations can therefore complete talking only to the database
p26359
aVIf you want to span 20 operations, then  should be ideal - it'll save you having to pass the transactions around, and allow each operation to manage their connection locally - making for highly re-usable code
p26360
aVIndeed,  can be nested in the ways you expect, so you can have:
p26361
aVTo do this using database transactions you'd need to pass the connection and transaction objects to each method, which quickly gets ungainly - especially if you need to code to work with/without an existing open transaction (lots of "" etc)
p26362
aVFor more information, see Transactions in
p26363
aVnet
p26364
as(dp26365
g18
V23354
p26366
stp26367
a((dp26368
g2
(lp26369
VYou seem to be binding to , and  doesn't implement
p26370
aVTry implementing  on , and see if that fixes it
p26371
aVThis will require moving to manual properties (rather than automatically implemented properties) in order to raise the event
p26372
as(dp26373
g18
V23354
p26374
stp26375
a((dp26376
g2
(lp26377
VIf the data is in ascending user/date/time order, how about simply:
p26378
as(dp26379
g18
V23354
p26380
stp26381
a((dp26382
g2
(lp26383
VBasically, yes; you'd need to do a lot of this yourself using
p26384
aVEven  isn't in Compact Framework, which is a shame (otherwise it would be easy)
p26385
aVThere may be pre-canned solutions available, however
p26386
aVFor interest, I have an open-source framework that is nearly there - it has all the serialization / dispatch / etc code, but I haven't yet added raw  support, which is a shame
p26387
aVBut maybe soon
p26388
as(dp26389
g18
V23354
p26390
stp26391
a((dp26392
g2
(lp26393
VMSDN Lists these:
p26394
aV(edit: wrong link; here's the generic version)
p26395
aVetc
p26396
aVFor example:
p26397
aVThe SortedList(TKey, TValue) generic
p26398
aVclass is a binary search tree with
p26399
aVO(log n) retrieval, where n is the
p26400
aVnumber of elements in the dictionary
p26401
aVIn this, it is similar to the
p26402
aVSortedDictionary(TKey, TValue) generic
p26403
aVclass
p26404
aVThe two classes have similar
p26405
aVobject models, and both have O(log n)
p26406
aVretrieval
p26407
aVWhere the two classes
p26408
aVdiffer is in memory use and speed of
p26409
aVinsertion and removal:
p26410
aVSortedList(TKey, TValue) uses less
p26411
aVmemory than SortedDictionary(TKey,
p26412
aVTValue)
p26413
aVSortedDictionary(TKey, TValue) has
p26414
aVfaster insertion and removal
p26415
aVoperations for unsorted data, O(log n)
p26416
aVas opposed to O(n) for
p26417
aVSortedList(TKey, TValue)
p26418
aVIf the list is populated all at once
p26419
aVfrom sorted data, SortedList(TKey,
p26420
aVTValue) is faster than
p26421
aVSortedDictionary(TKey, TValue)
p26422
as(dp26423
g18
V23354
p26424
stp26425
a((dp26426
g2
(lp26427
VIf you are talking about an object tree/graph:
p26428
aVWriting specific IL to serialize an object is tricky
p26429
aVIMO, your best bet is to look at a full serialization, like how  would work - but not necessarily with that engine
p26430
aVFor example, protobuf-net has a  method that might help
p26431
aVIt should be faster than , at least
p26432
aVAt the current time, you need to add some clues for the serializer (even if just ) - however, the current (incomplete) work-in-progress offers POCO support without attributes
p26433
aVIf you are talking about individual objects:
p26434
aVThere are fairly simple things you can do here with  in
p26435
aVNET 3
p26436
aV5; build a dynamic  based on reflection, and call
p26437
aVMiscUtil has this already:
p26438
aVWith
p26439
aVNET 2
p26440
aV0/3
p26441
aV0 (without ) you might consider HyperDescriptor for similar purposes
p26442
as(dp26443
g18
V23354
p26444
stp26445
a((dp26446
g2
(lp26447
VMaybe via JavaScriptSerializer
p26448
aVSerialize
p26449
as(dp26450
g18
V23354
p26451
stp26452
a((dp26453
g2
(lp26454
VIt would be better to figure out the  / , and switch into regular code via  - like so:
p26455
aV(edit - you could pass in the  as an argument too, if they are of the same type)
p26456
as(dp26457
g18
V23354
p26458
stp26459
a((dp26460
g2
(lp26461
VYou would need to return the value; extension methods aren't  on the  argument:
p26462
aVThen you'd need:
p26463
aVPersonally, I expect it would be simpler to do it directly
p26464
aVwith either:
p26465
aVor
p26466
as(dp26467
g18
V23354
p26468
stp26469
a((dp26470
g2
(lp26471
VSomething like:
p26472
as(dp26473
g18
V23354
p26474
stp26475
a((dp26476
g2
(lp26477
VThat should increment, proof:
p26478
aVThe lambda acts (as already stated) to "capture" count, essentially making the code like:
p26479
aVThe above is a rough approximation of how the compiler interprets a delegate lambda
p26480
aVAs you can see, the  is a field on a class, and is incremented
p26481
as(dp26482
g18
V23354
p26483
stp26484
a((dp26485
g2
(lp26486
VI don't know about zeroc, but another option is "protocol buffers" - this is Google's open source binary serialization format, designed for portability (between platforms and implementations), performance (binary, cheap to read/write) and extensibility
p26487
aVThere is not, however, a standard RPC stack defined by protocol buffers; a handful of RPC stacks are springing up in the community, though
p26488
aVJava, C++ and php are in the Google release, and there are various community versions available, including C#
p26489
as(dp26490
g18
V23354
p26491
stp26492
a((dp26493
g2
(lp26494
VYou could compare to the winforms  and  structures
p26495
aVthey decided that even if they are similar, to keep them separate
p26496
aVIt makes sense at the algebraic sense:
p26497
aVetc
p26498
as(dp26499
g18
V23354
p26500
stp26501
a((dp26502
g2
(lp26503
VAs Jon notes, there is no inbuilt support for this - but as an aside you can create a typed delegate to the constructor (faster than reflection) using
p26504
aVThe code to do this can be found in MiscUtil (in )
p26505
as(dp26506
g18
V23354
p26507
stp26508
a((dp26509
g2
(lp26510
VIf you want to do an "and" combination, the preferred option is to use multiple "where" clauses:
p26511
aVYou can do more complex things with expression building (AndAlso, Invoke, etc), but this is not necessary for an "and" combination
p26512
aVIf you really need to combine expressions, then the approach depends on the implementation
p26513
aVLINQ-to-SQL and LINQ-to-Objects support Expression
p26514
aVInvoke, allowing:
p26515
aVHowever, for Entity Framework you will usually need to rip the Expression apart and rebuild it, which is not easy
p26516
aVHence why it is often preferable to use  (for "and") and  (for "or")
p26517
as(dp26518
g18
V23354
p26519
stp26520
a((dp26521
g2
(lp26522
VThere are a couple of issues with ; the first is (as you've found) it doesn't implement the necessary /
p26523
aVThe second is that there is no guaranteed order to the items (and indeed, no indexer), making random access by index (rather than by key) impossible
p26524
aVHowever
p26525
aVit is probably doable with some some smoke and mirrors; something like below:
p26526
aVNote that the use of a custom extension method is entirely optional, and can be removed in C# 2
p26527
aV0, etc
p26528
aVby just using  instead
p26529
as(dp26530
g18
V23354
p26531
stp26532
a((dp26533
g2
(lp26534
VI expect they would remain between methods
p26535
aVOf course, if in doubt, reset the thread-static variables at the start of your worker method
p26536
aVOr use / to clear the values after each unit-of-work
p26537
aV(edit)
p26538
aVIt is pretty easy to prove that they do indeed remain; the above quickly starts printing numbers higher than 0 (where 0 each time is what we would expect if the different workers were isolated):
p26539
as(dp26540
g18
V23354
p26541
stp26542
a((dp26543
g2
(lp26544
VThe only thing that leaps to mind is having 4 separate project files
p26545
aVbut before you panic about having to maintain 4 files when ever you add a class, you can use another csproj trick here:
p26546
aVwhich (IIRC) says "include all cs files at any level in the folder structure"
p26547
as(dp26548
g18
V23354
p26549
stp26550
a((dp26551
g2
(lp26552
VIf it helps, one option here is to use the  in the global web
p26553
aVconfig (i
p26554
ag50
aVthe one in the framework folder) to specify different configuration options for different sites, such as different app-settings, connection-strings, etc
p26555
as(dp26556
g18
V23354
p26557
stp26558
a((dp26559
g2
(lp26560
VMiscUtil has some code to do this using  - for example:
p26561
as(dp26562
g18
V23354
p26563
stp26564
a((dp26565
g2
(lp26566
Vbase-64 rarely returns a string of the same length as the input
p26567
aVEssentially, it is only using 6 of the available 8 bits, so large messages (in particular) will require an extra 1/3 volume
p26568
aVThere are a few packing bytes (usually "=") at the end to make the message unambiguous
p26569
as(dp26570
g18
V23354
p26571
stp26572
a((dp26573
g2
(lp26574
VThere isn't a direct way to do this, unfortunately; however, you can do it in
p26575
aVNET 3
p26576
aV5 via
p26577
aVSee here for more
p26578
aVTo copy the example:
p26579
aV(it is pretty simple to change that to return the name instead of the )
p26580
aVLikewise, it would be pretty simple to write a variant:
p26581
aVusing:
p26582
as(dp26583
g18
V23354
p26584
stp26585
a((dp26586
g2
(lp26587
VOne big thing that changes as soon as you get a transaction - the isolation level
p26588
aVIs your database under heavy contention
p26589
aVIf so: by default a  is at the highest "serializable" isolation level, which involves read locks, key-range locks, etc
p26590
aVIf it can't acquire those locks immediately it will slow down while it it blocked
p26591
aVYou could investigate by reducing the isolation level of the transaction (via the constructor)
p26592
aVFor example (but pick your own isolation-level):
p26593
aVHowever, picking an isolation level is
p26594
aVtricky; serializable is the safest (hence the default)
p26595
aVYou can also use granular hints (but not via LINQ-to-SQL) such as  and  to help control locking of specific tables
p26596
aVYou could also investigate whether the slowdown is due to trying to talk to DTC
p26597
aVEnable DTC and see if it speeds up
p26598
aVThe LTM is good, but I've seen composite operations to a single database escalate to DTC before
p26599
as(dp26600
g18
V23354
p26601
stp26602
a((dp26603
g2
(lp26604
VWell, to upload to the web-server you just need an
p26605
aVAt ASP
p26606
aVNET, this should be available in the  collection
p26607
aVIn SQL Server, you'll want a  (or  in older versions)
p26608
aVThe big question before pushing them into SQL Server is: how big are they
p26609
aVIf they aren't massive, you can just treat them as a ; just buffer from the  and send
p26610
aVHere's a fairly generic way of buffering a  to a single :
p26611
aVFor massive files (which perhaps don't belong in the db unless you are using the SQL 2008 filestream extensions), you'll want to chunk it
p26612
aVHere's an old reply I used for chunking (before SQL 2005) - but it shows the overall idea
p26613
as(dp26614
g18
V23354
p26615
stp26616
a((dp26617
g2
(lp26618
VFrom your description, the least messy I can come up with is:
p26619
aVSince you are using AddFirst, you might also need a  in there somewhere - or use  afterwards
p26620
as(dp26621
g18
V23354
p26622
stp26623
a((dp26624
g2
(lp26625
VDoes this have to be update-panels
p26626
aVIf it was me, I would use jQuery and (ideally) MVC; then it is pretty simple as something like:
p26627
ag412
ag50
aVwe use the callback from each to start the next div loading, but treat each div as an unrelated request
p26628
as(dp26629
g18
V23354
p26630
stp26631
a((dp26632
g2
(lp26633
VBasically reference-chains don't propagate, and it is up to the topmost assembly (the exe, web-site, etc) to ensure that it has everything it needs, either locally or in (for example with managed dlls) the GAC
p26634
aVYou will need to add the files to the exe/web-site as "copy to output"
p26635
as(dp26636
g18
V23354
p26637
stp26638
a((dp26639
g2
(lp26640
VFrom MSDN:
p26641
aVIf the operation completes
p26642
aVsuccessfully and its result is
p26643
aVassigned in the DoWork event handler,
p26644
aVyou can access the result through the
p26645
aVRunWorkerCompletedEventArgs
p26646
aVResult
p26647
aVproperty
p26648
aVand:
p26649
aVYour RunWorkerCompleted event handler
p26650
aVshould always check the Error and
p26651
aVCancelled properties before accessing
p26652
aVthe Result property
p26653
aVIf an exception
p26654
aVwas raised or if the operation was
p26655
aVcanceled, accessing the Result
p26656
aVproperty raises an exception
p26657
aVSo if it doesn't complete successfully (i
p26658
ag50
aVyou cancel it) it looks like it won't work
p26659
aVPerhaps consider returning your cancellation-details as the result (as success) for your abort case, an detecting the difference in the completion handler
p26660
as(dp26661
g18
V23354
p26662
stp26663
a((dp26664
g2
(lp26665
VWhen it comes to connection-based transactions (), the overall performance should be pretty similar - but by handling it in the
p26666
aVNET code you make it possible to conveniently span multiple database operations on the same connection
p26667
aVIf you are doing transaction management inside TSQL you should really limit it to the single TSQL query
p26668
aVThere may well be an extra round-trip for the begin/end, but that isn't likely to hurt you
p26669
aVIt is pretty rare (these days) that I'd manually write TSQL-based transactions - maybe if I was writing something called directly by the server via an agent (rather than from my own application code)
p26670
aVThe bigger difference is between  and  see Transactions in
p26671
aVnet for more, but the short version is that  is slightly slower (depending on the scenario), but can span multiple connections / databases (or other resources)
p26672
as(dp26673
g18
V23354
p26674
stp26675
a((dp26676
g2
(lp26677
VOK, this is hacky - but it works
p26678
aVIt inserts a small delay into the drag, allowing the check/uncheck to work normally:
p26679
aV(edited to include  to help avoid some UI glitches with clicks)
p26680
as(dp26681
g18
V23354
p26682
stp26683
a((dp26684
g2
(lp26685
VOverloading is providing multiple methods with the same name and different signatures:
p26686
aVOverriding is used in inheritance to change the implementation per subclass:
p26687
aVWith the above, even if I do:
p26688
aVit will call the  implementation
p26689
aVThe method called depends on the instance type, not the variable
p26690
aVMethod hiding is the opposite; it replaces the method signature, but only applies if you call the method from the derived type:
p26691
aVNow:
p26692
ag412
ag50
aVthe method calls depends on the variable, not the instance
p26693
as(dp26694
g18
V23354
p26695
stp26696
a((dp26697
g2
(lp26698
VPersonally I wouldn't use clientside xslt very often; there are issues with browser support, and the fact that you may have data in the xml that you need to strip out (i
p26699
ag50
aVthat the client doesn't need to know, or shouldn't know)
p26700
aVBut serverside
p26701
aVback a few years, I used to routinely use this approach as an MVC implementation from VB6 - i
p26702
ag50
aVthe VB6 code (the controller) gathers data as xml (the model), and uses xslt to shape the html (the view)
p26703
aVIt worked well in terms of separation of concerns
p26704
aVThese days I would use ASP
p26705
aVNET MVC to do the same, but with ascx/aspx view templates
p26706
as(dp26707
g18
V23354
p26708
stp26709
a((dp26710
g2
(lp26711
VThey don't have to be verbose:
p26712
aVWhat is the bit that is being troublesome
p26713
as(dp26714
g18
V23354
p26715
stp26716
a((dp26717
g2
(lp26718
VWhich serializer is that
p26719
aVIf you only know the  at runtime (not compile time), and it doesn't have a non-generic API, then you might have to use :
p26720
as(dp26721
g18
V23354
p26722
stp26723
a((dp26724
g2
(lp26725
VWhat do ,  etc do internally
p26726
aVThere may be other options involving  or , and a single cast, using an "object" indexer:
p26727
aVfor example, if the objects are already correctly typed:
p26728
aVor if they are stored as strings and need conversion, something involving:
p26729
as(dp26730
g18
V23354
p26731
stp26732
a((dp26733
g2
(lp26734
VWith a dictionary:
p26735
aVbut simpler, I believe  is case-insensitive too:
p26736
as(dp26737
g18
V23354
p26738
stp26739
a((dp26740
g2
(lp26741
VIt shouldn't be a huge surprise that the C# compiler doesn't like the C++ code; you might as well feed it vb / java / whatever - it isn't going to be legal
p26742
aVTo compile C++, you'll need the C++ compiler, perhaps from C++ Express Edition
p26743
aVNote that for this to compile into mixed/IL it'll been to be managed C++
p26744
as(dp26745
g18
V23354
p26746
stp26747
a((dp26748
g2
(lp26749
VOne issue is that even if it doesn't break during serialization/deserialization, you could be throwing away data - meaning that you can't successfully round-trip data back to the caller
p26750
ag412
ag50
aVgiven the simple method:
p26751
aVIf the caller is passing you the old object with the extra property, they might want that value back
p26752
aVYou can enable this (separately) with the extension data API, but frankly people rarely bother with this
p26753
as(dp26754
g18
V23354
p26755
stp26756
a((dp26757
g2
(lp26758
VI'd look at the generated assemblies using reflection; iterate through the static types looking for methods with
p26759
as(dp26760
g18
V23354
p26761
stp26762
a((dp26763
g2
(lp26764
VWith an  and an alias in the xpath:
p26765
as(dp26766
g18
V23354
p26767
stp26768
a((dp26769
g2
(lp26770
VThe inbuilt code (WebClient, WCF, HttpWebRequest, etc) all make use of the WinHTTP configuration to obtain proxy configuration
p26771
aVSo all you need to do is configure WinHTTP to know about the proxy
p26772
aVIn XP, this is:
p26773
aVwhich imports the settings from the user's IE proxy settings (WinInet)
p26774
aVOn Vista / etc, you use
p26775
aV(and some subcommand like "import")
p26776
aVuntested, but try:
p26777
aVAfter that, your
p26778
aVNET code should all work via the proxy that the uses has presumably already configured in order to use IE etc
p26779
as(dp26780
g18
V23354
p26781
stp26782
a((dp26783
g2
(lp26784
VWith an implicit operator (which you have) you should just be able to use:
p26785
as(dp26786
g18
V23354
p26787
stp26788
a((dp26789
g2
(lp26790
VMonkeying with the iterator's fields is begging for trouble
p26791
aVWouldn't it be simpler to use a member of a class that you specify in the iterator signature
p26792
aVEither by passing it in or out
p26793
aVBasically involving some kind of simple wrapper class along the way
p26794
aVallowing you to talk to  quite safely, simply via a  object reference
p26795
aVI didn't understand all of the question, so that is the best I can say
p26796
as(dp26797
g18
V23354
p26798
stp26799
a((dp26800
g2
(lp26801
VThe short version is you must synchronize access to a queue if you expect it to function
p26802
aVThere are obvious thread races in the Count/Dequeue, but more importantly no operation is guaranteed - the internal state could legitimately do anything, and is likely to be corrupted
p26803
aVYou would also want a way of exiting the thread eventually
p26804
aVTo write a blocking queue, see here: Creating a blocking  in
p26805
aVNET
p26806
as(dp26807
g18
V23354
p26808
stp26809
a((dp26810
g2
(lp26811
VNo, don't keep a static  unless you have to
p26812
aVThreading would be one concern, but more importantly - usually you simply don't need to
p26813
aVWith your code as presented, the internal connection pooling means that most of the time you will get the same underlying connection on successive calls anyway (as long as you use the same connection string)
p26814
aVLet the pooler do its job; leave the code alone
p26815
aVThis also avoids the issues of what happens when you start having two threads
p26816
aVnow each can do work on their own connection; with static (assuming you don't use ) you'd have to synchronize, introducing delays
p26817
aVNot to mention re-entrancy (i
p26818
ag50
aVa single thread trying to use the same connection twice at the same time)
p26819
aVYup; leave the code alone
p26820
aVIt is fine now, and almost any change you make would make it not fine
p26821
as(dp26822
g18
V23354
p26823
stp26824
a((dp26825
g2
(lp26826
VHave you tried looking at the fusion logs
p26827
aVSuzanne Cook has an article on this here
p26828
aVAnother thing to do (to minimise silent errors): minimise your  method; the reason for this is that JIT works per-method, and if it can't JIT  it can't use your exception handling:
p26829
as(dp26830
g18
V23354
p26831
stp26832
a((dp26833
g2
(lp26834
V etc should indeed only be increased on per-specific-scenario basis
p26835
aVThis can avoid unexpectedly long blocking etc scenarios (or worse: the undetected deadlock scenario)
p26836
aVAs for how high
p26837
aVhow long does the query take
p26838
aVAdd some headroom and you have your answer
p26839
aVThe other thing to do, of course, is to reduce the time the query takes
p26840
aVThis might mean hand-optimising some TSQL in a sproc, usually in combination with checking the indexing strategy, and perhaps bigger changes such as denormalization, or other schema changes
p26841
aVThis might also involve a data-warehousing strategy so you can shift load to a separate database (away from the transactional data), with a schema optimised for reporting
p26842
aVMaybe a star-schema
p26843
aVI wouldn't set it to infinity
p26844
aVI don't expect it to take forever to run a report
p26845
aVPick a number that makes sense for the report
p26846
aVYes, SQL Server can freeze so that a command never finishes
p26847
aVAn open blocking transaction would be the simplest
p26848
aVget two and you can deadlock
p26849
aVUsually the system will detect a local deadlock - but not always, especially if DTC is involved (i
p26850
ag50
aVnon-local locks)
p26851
as(dp26852
g18
V23354
p26853
stp26854
a((dp26855
g2
(lp26856
VPersonally I'd probably add the columns that I do want manually (), rather than try to take away the ones I don't want
p26857
aVIf this was a class model (rather than ) you can do things like setting  on properties you never want to see
p26858
aVWith  I wonder if you can't do something with a non-default
p26859
aVOther than that, you simply just Add the columns you want
p26860
as(dp26861
g18
V23354
p26862
stp26863
a((dp26864
g2
(lp26865
VThe string is easily available to anybody with debugger access to the machine, using tools such as hawkeye
p26866
aVIndeed, the community notes on MSDN make this clear
p26867
as(dp26868
g18
V23354
p26869
stp26870
a((dp26871
g2
(lp26872
VI can't reproduce your TSQL; have you omitted part of the LINQ query (i
p26873
ag50
aVthe "where") from the question
p26874
aVNo matter how I try, I get pretty normal TSQL that perfoms ok
p26875
aVSince the primary key is unique, why not just:
p26876
aVOtherwise; have you tried selecting the primary key
p26877
as(dp26878
g18
V23354
p26879
stp26880
a((dp26881
g2
(lp26882
VActually, the Windows SDK is now the "Windows SDK for Windows [n] and
p26883
aVNET Framework [m]" - so ultimately Microsoft are saying that this is an SDK tool
p26884
aVthe choice of whether to go into the SDK or tools
p26885
aVwell, it could go either way really
p26886
as(dp26887
g18
V23354
p26888
stp26889
a((dp26890
g2
(lp26891
VIf the values are already of the correct type, then no: you don't have to do anything
p26892
aVIf they might not be right (int vs float, etc), the a simple approach might be:
p26893
aV(edit adjusted for nulls)
p26894
as(dp26895
g18
V23354
p26896
stp26897
a((dp26898
g2
(lp26899
VYou can't, basically
p26900
aVThat is a special case to prevent chaos
p26901
aVThe best you could do is write an FxCop rule to detect it
p26902
as(dp26903
g18
V23354
p26904
stp26905
a((dp26906
g2
(lp26907
VIt really depends on the scenario
p26908
aVThe property approach has a lot of convenience, in that you don't have to duplicate the assignments in the constructor
p26909
aVFurthermore, most data-binding scenarios like to be able to create new objects, for which they usually use the parameterless constructor, so that is a big advantage
p26910
aVHowever, for immutable types, the constructor approach is the only sensible option
p26911
aVInterestingly (perhaps) the named/optional parameters in C# 4
p26912
aV0 allow something similar to object initalizers for immutable types - see here
p26913
aVThe constructor approach is also very popular for Inversion of Control frameworks, as it clearly advertises what that class needs in order to function
p26914
aVYou may need to mix and match, but usually more property-style than constructor-style
p26915
as(dp26916
g18
V23354
p26917
stp26918
a((dp26919
g2
(lp26920
VIf you want it to work either way, use  instead
p26921
aVAs for the why
p26922
as(dp26923
g18
V23354
p26924
stp26925
a((dp26926
g2
(lp26927
VJSON is a member serializer, and uses the names
p26928
aVIf you don't want names, don't use JSON
p26929
aVPerhaps just , then
p26930
as(dp26931
g18
V23354
p26932
stp26933
a((dp26934
g2
(lp26935
VI probably wouldn't bother with an object model and  - it sounds like you might just as well talk in terms of an  /  - i
p26936
ag50
aVpass the data around as a block of xml
p26937
aVSince you have no schema it would be pointless to shred it out; you might as well do it via an xml DOM
p26938
aVWhen you say treeview - is this winforms, asp
p26939
aVnet, wpf
p26940
aVI believe the asp
p26941
aVnet treeview can take an xml source, but for winforms you'd have to iterate the nodes yourself
p26942
as(dp26943
g18
V23354
p26944
stp26945
a((dp26946
g2
(lp26947
VLINQ
p26948
aV= LINQ-to-SQL
p26949
aVLINQ is the concept, including some language support
p26950
aVThere are many implementations - LINQ-to-SQL is one, as is ADO
p26951
aVNET Data Services, Entity Framework's LINQ-to-Entities, LINQ-to-Objects, LINQ-to-SQL, LINQ-to-Amazon, DbLinq, etc
p26952
aVYou still use LINQ with Entity Framework; indeed, LINQ-to-Entities is the preferred choice, giving compile time static checking
p26953
aVEntity SQL is simply another mechanism (in addition to LINQ-to-Entities) for querying the EDM (Entity Data Model)
p26954
aVThere are 3 main reasons that ESQL is useful:
p26955
aVit was the only option in early previews when LINQ-to-Entities was still under construction
p26956
aVit can be used in some scenarios where there is no object model, for example reporting services
p26957
aVthere is a small number of cases where ESQL is more expressive
p26958
aVFor everything else, LINQ should be your tool for working with Entity Framework
p26959
as(dp26960
g18
V23354
p26961
stp26962
a((dp26963
g2
(lp26964
VYou probably don't need a dynamic class
p26965
aVYou can implement runtime binding properties via  / , creating your own  implementation that returns the named switch
p26966
aVIt isn't clear what knows first about the change, but you could either use , or the older property-specific change event, again tied to each property (so each  attaches to, for example, the event in the named switch
p26967
aVNot trivial, but not impossible either
p26968
as(dp26969
g18
V23354
p26970
stp26971
a((dp26972
g2
(lp26973
VA dictionary of a list
p26974
aVin
p26975
aVNET 3
p26976
aV5 that would be an
p26977
aVThe default implementation () is immutable, but I wrote an  for MiscUtil
p26978
aVThis will be a lot simpler to use - i
p26979
ag50
aVOther than that, an extension method:
p26980
as(dp26981
g18
V23354
p26982
stp26983
a((dp26984
g2
(lp26985
VThis shows binding an event on a control (by name) to a method on the current instance (by name):
p26986
as(dp26987
g18
V23354
p26988
stp26989
a((dp26990
g2
(lp26991
VHere's a way to shallow clone LINQ objects (omitting the primary key): Copy Linq Objects
p26992
aVIt could be tweaked to use the meta-model if you aren't using attributes
p26993
aVThen all you'd need is 2 data-contexts (one source, one destination)
p26994
aVAlternatively, you could look at  - see Copy from one database table to another C#
p26995
as(dp26996
g18
V23354
p26997
stp26998
a((dp26999
g2
(lp27000
VI would be surprised if it actively caused a problem, as long as those threads don't try to talk back to the request/response (which may now be gone)
p27001
aVWhat symptoms are you seeing
p27002
aVCan you define "wacky"
p27003
aVI use threads routinely for logging etc, without issue
p27004
aVTo minimise the impact, you could use a producer/consume pattern, so you only have one (or a few) worker threads, servicing however-many ASP
p27005
aVNET MVC request/response threads
p27006
as(dp27007
g18
V23354
p27008
stp27009
a((dp27010
g2
(lp27011
VThe point is that otherwise you could replace assembly B/C/D with a different (hacked) one, and A would never notice; it would load them and execute the code
p27012
aVWith strong naming, you can't do this without either re-signing the hacked B/C/D with the same key, or by hacking A
p27013
as(dp27014
g18
V23354
p27015
stp27016
a((dp27017
g2
(lp27018
VIt is quite likely that since it is binding to the collection, it will need something like
p27019
aVWhat happens if you switch from  to
p27020
as(dp27021
g18
V23354
p27022
stp27023
a((dp27024
g2
(lp27025
VFor writing large xml,  (directly) is your friend - but it is harder to use
p27026
aVThe other option would be to use DOM/object-model approaches and combine them, which is probably doable if you seize control of the and disable the xml marker, and get rid of the namespace declarations
p27027
as(dp27028
g18
V23354
p27029
stp27030
a((dp27031
g2
(lp27032
VFor Entity Framework (aka ADO
p27033
aVNET Entity Model) to be there, you'll need to install VS2008 SP1 (which also includes the required
p27034
aVNET 3
p27035
aV5 SP1)
p27036
aVYou also need to ensure that framework 3
p27037
aV5 is selected for the project, but for MVC I guess this should already be the case
p27038
aVIt is also possible that your templates are simply not working properly
p27039
as(dp27040
g18
V23354
p27041
stp27042
a((dp27043
g2
(lp27044
VI don't know why id
p27045
aV= id takes so long in this case (although "obvious" is subjective - it isn't necessarily an optimisation I'd think of
p27046
aVit seems an unusual query; a cartesian join is painful, though)
p27047
aVBut in general, try "where 1 = 0" - or if you just want the schema, perhaps the slightly risky SET FMTONLY ON
p27048
aVEdit: just saw " We don't control the application that runs this query hundres of times a minute"
p27049
aVhmmm
p27050
aVthat makes it tricky
p27051
as(dp27052
g18
V23354
p27053
stp27054
a((dp27055
g2
(lp27056
VI don't know about the bug, but this might be a case for LockBits
p27057
aVI'll see if I can whip up an example
p27058
aVHere's a simplified example writing an array of data to an ARGB bitmap:
p27059
aVThis approach should be a lot faster than
p27060
as(dp27061
g18
V23354
p27062
stp27063
a((dp27064
g2
(lp27065
VWell, you don't need to buffer both values - only one:
p27066
as(dp27067
g18
V23354
p27068
stp27069
a((dp27070
g2
(lp27071
VNo, there is no null-safe magic, with one exception; extension methods - for example:
p27072
aVnow this is valid:
p27073
aVIn the case of events, this has the advantage of also removing the race-condition, i
p27074
ag50
aVyou don't need a temporary variable
p27075
aVSo normally you'd need:
p27076
aVbut with:
p27077
aVwe can use simply:
p27078
as(dp27079
g18
V23354
p27080
stp27081
a((dp27082
g2
(lp27083
VPersonally, I'd use  and the familiar :
p27084
aVFor LINQ-to-XML, I'd guess (untested) something like:
p27085
aVEdit: if you want the category selection to be more flexible:
p27086
aVThis should now work for any number of levels, selecting all recipes at the chosen level or below
p27087
aVEdit for discussion (comments) on why  has a local  variable:
p27088
aVThis might get a bit complex, but I'm trying to do the question justice ;-p
p27089
aVBasically, the  (with the iterator lvalue "captured") looks like:
p27090
aVIt might not be obvious, but since  isn't evaluated immediately, the value of  (via the predicate ) isn't checked until much later
p27091
aVThis is an unfortunate consequence of the precise details of the C# spec
p27092
aVIntroducing  (scoped inside the foreach) means that the capture happens per iteration:
p27093
aVAnd hence it doesn't matter whether we evaluate now or later
p27094
aVComplex and messy
p27095
aVYou can see why I favor a change to the specification
p27096
as(dp27097
g18
V23354
p27098
stp27099
a((dp27100
g2
(lp27101
VThis is really a comment, in response to Mehrdad's point about the runtime not performing access checks; here, you can see the JIT (it transpires) performing the access check - not reflection, and not the C# compiler
p27102
aVTo fix the code, make  public
p27103
aVInterestingly, it also verifies that  is accessible - so make  internal to see more fireworks:
p27104
as(dp27105
g18
V23354
p27106
stp27107
a((dp27108
g2
(lp27109
VThe problem is the whitespace:
p27110
aVshould be:
p27111
aVI'll try to compensate
p27112
aVexample on the way
p27113
aVTo avoid a lot of problems (and improve performance), I'll also use an xsl index
p27114
aVFixed (caveat - it won't work with course codes with multiple spaces in the middle of them, but that seems unlikely):
p27115
aVwith (at the top) the xsl index:
p27116
as(dp27117
g18
V23354
p27118
stp27119
a((dp27120
g2
(lp27121
VTo cover the range of possibilities (server doesn't exist, database doesn't exist, no login, no permissions, server down, etc) - the simplest idea is simply to try to connect as normal, and perform something trivial -  for example
p27122
aVIf you get an exception, there is a problem
p27123
aVThere are times (especially when dealing with out-of-process systems) when  is the most pragmatic option
p27124
as(dp27125
g18
V23354
p27126
stp27127
a((dp27128
g2
(lp27129
VIf you mean "run without the
p27130
aVNET framework"
p27131
aVit isn't a good idea, and isn't really supported
p27132
aVBut you can try the options that Jon lists here: Does the framework have to be installed to run my
p27133
aVNET application
p27134
as(dp27135
g18
V23354
p27136
stp27137
a((dp27138
g2
(lp27139
VYou can change your template files
p27140
aVeither by editing the files in the install location,  or by writing a class how you want it, and choosing Export Template
p27141
aVThere is also a template add-in somewhere
p27142
as(dp27143
g18
V23354
p27144
stp27145
a((dp27146
g2
(lp27147
VA bespoke iterator might make it quicker (edited to return as known type):
p27148
aV(you would use the ArrayIterator directly as Foo's GetEnumerator - essentially copying the code from ArrayEnumerator
p27149
aVGetEnumerator; my point is to show that a typed iterator is faster than the interface)
p27150
aVWith code:
p27151
as(dp27152
g18
V23354
p27153
stp27154
a((dp27155
g2
(lp27156
VFor myself; I'm content to re-use the object model that LINQ/dbml generates, since in reality the attributes don't hurt me, and any other implementation could provide a similar-enough model - but I don't use my data-context outside the DAL
p27157
aVSo I have something like:
p27158
aV- defines the methods available using both the generated dbml objects and some POCO model classes
p27159
aV- the implementation that knows about the data-context
p27160
aVMy repository methods don't expose LINQ concepts like  and , since they are leaky abstractions; other implementations will work differently (EF supports different aspects of both, for example)
p27161
aVFurther - I've taken to marking most association properties as internal, and only using them during DAL queries (not so much during the OO work)
p27162
aVI could map to pure POCOs, but I don't see the benefit
p27163
aVI have some more thoughts on this here: Pragmatic LINQ
p27164
as(dp27165
g18
V23354
p27166
stp27167
a((dp27168
g2
(lp27169
VA few things leap to mind:
p27170
aVdouble/treble-check your connection string; are you really talking to the file that you think you are
p27171
aVare you using transactions anywhere and not committing them
p27172
aVdo you have the mdf file set to "Copy Always" (or whatever it is)
p27173
ag412
ag50
aVare you constantly overwriting the mdf whenever you hit build/play
p27174
aVAlso - I don't think it'll matter in this case, but to verify data you should use a different entities/data-context:
p27175
aVLike I said - I doubt it'll matter here, but worth checking
p27176
as(dp27177
g18
V23354
p27178
stp27179
a((dp27180
g2
(lp27181
VOne option is to use the application-base:
p27182
as(dp27183
g18
V23354
p27184
stp27185
a((dp27186
g2
(lp27187
VWhy wouldn't you use the format specifier
p27188
aVI'm not aware of any pre-rolled cultures that use this specifier
p27189
aVYou could perhaps roll your own culture
p27190
as(dp27191
g18
V23354
p27192
stp27193
a((dp27194
g2
(lp27195
VIt sounds like you want to run NUnit from your exe
p27196
aVUnless you go to a lot of trouble, it sounds to me like the best option would be to include the NUnit console exe (and dlls) in your package, and execute via , capturing stdout (or writing to a file, which may be simpler)
p27197
aVThen parse the output file
p27198
aVIt might not be as pretty as the GUI version, but it will probably be easier to deploy
p27199
as(dp27200
g18
V23354
p27201
stp27202
a((dp27203
g2
(lp27204
VNo; the codebase is a bit more fragmented
p27205
aVObviously there is the core framework classes (in all the different version levels), but other than that there is little concensus
p27206
aVcodeplex has a number of useful libraries, as does code
p27207
aVgoogle
p27208
aVcom etc - but you'll generally be picking specific tools from specific community projects
p27209
as(dp27210
g18
V23354
p27211
stp27212
a((dp27213
g2
(lp27214
VI expect you should be reading the filename after the user has used the dialog:
p27215
aVAlso -  is , so you should be "" it
p27216
as(dp27217
g18
V23354
p27218
stp27219
a((dp27220
g2
(lp27221
VWell, if you've ruled out , you are left with domain values - i
p27222
ag50
aVa magic number that you treat as null
p27223
aVWhile this isn't ideal, it isn't uncommon either - for example, a lot of the main framework code treats  the same as null
p27224
aVThis at least moves the damage far away from common values
p27225
aVedit to highlight only where no NaN
p27226
aVSo where there is no , maybe use  - but just remember what evils happen if you accidentally use that same value meaning the same number
p27227
aVObviously for unsigned data you'll need  (avoid zero
p27228
aVPersonally, I'd try to use  as expressing my intent more safely
p27229
aVthere may be ways to optimise your  code, perhaps
p27230
aVAnd also - by the time you've checked for the magic number in all the places you need to, perhaps it won't be much faster than
p27231
as(dp27232
g18
V23354
p27233
stp27234
a((dp27235
g2
(lp27236
VSimply,  is a generic type, allowing:
p27237
aVstatic typing (and compile-time verification)
p27238
aVuse without boxing
p27239
aVIf you are
p27240
aVNET 2
p27241
aV0 or above, you should prefer  (and the other generic collections)
p27242
aVA subtle but important difference is that  supports multiple reader threads with a single writer thread, while  offers no thread safety
p27243
aVIf you need thread safety with a generic dictionary, you must implement your own synchronization or (in
p27244
aVNET 4
p27245
aV0) use
p27246
as(dp27247
g18
V23354
p27248
stp27249
a((dp27250
g2
(lp27251
VLINQ-to-SQL will usually handle direct integer maps and exact string (name) maps (note: case sensitive)
p27252
aVMeaning: write your enum somewhere, and in the designer set the property type as the fully-qualified enum name:
p27253
aVIt should usually work
p27254
aVFor non-trivial mappings (for example where the column is a varchar with mixed-case values, or things like "In Progress" [note the space]), you will have to leave the storage property as / (etc) and map it manually
p27255
aVI usually do this by marking it as private and naming it , and adding a mapping property in a partial class:
p27256
aVThe only problem is that LINQ queries will only work against the storage property (not the bespoke property)
p27257
as(dp27258
g18
V23354
p27259
stp27260
a((dp27261
g2
(lp27262
VAh; your list is using  extension methods (rather than ) - try:
p27263
as(dp27264
g18
V23354
p27265
stp27266
a((dp27267
g2
(lp27268
VThe better question would be:
p27269
aVWhy should it include it
p27270
aVGiven that C# holds together pretty well without freestanding functions, what is the requirement to add them
p27271
aVIn particular, static utility classes work fine for hosting such (either as regular or extension methods), and allow simple disambiguation when conflicts arise
p27272
aVIt also (as OregonGhost notes in the comments) helps modularize the code, preventing death-by-IntelliSense etc
p27273
aVSo: why add them
p27274
aVWhat is the problem (in C#) that isn't already solved
p27275
as(dp27276
g18
V23354
p27277
stp27278
a((dp27279
g2
(lp27280
VAn object graph is not a single object, but rather a set of related objects
p27281
aVFor a simple example, consider:
p27282
aVwhere each child knows about the parent (and the parent knows about the child)
p27283
aVThe problem is that xml is a tree based on object properties
p27284
aVand it wants to just walk them - i
p27285
ag50
aVwith the simple parent/child:
p27286
aVA (knows that B is its child)
p27287
aVB (knows that A is its parent)
p27288
aVthat would serialize as:
p27289
aVYou can see that we got back to A, so we're now in an endless loop
p27290
aVcan serialize trees of data, but not full graphs
p27291
aVYou can mark properties to be ignored, for example:
p27292
aVAnd now it'll work, but we'll have to fix the  afterwards
p27293
aVBy contrast, some other serializers can handle graphs ( can on-demand)
p27294
aVIt does this by tracking objects against a unique key - but then the output isn't what you expect from regular xml
p27295
as(dp27296
g18
V23354
p27297
stp27298
a((dp27299
g2
(lp27300
VThat works fine for me
p27301
aVPurely a guess, but maybe a virus checker is scanning the file
p27302
aVTo investigate, try disabling your virus checker and see if it works (and then re-enable your virus checker)
p27303
aVAs an aside, there is one way it can leave the file open: if the  constructor throws an exception; but then you won't reach the  stuff anyway
p27304
aVbut consider:
p27305
aVNow  is disposed in the edge-case where  throws
p27306
aVHowever, I do not believe that this is the problem here
p27307
as(dp27308
g18
V23354
p27309
stp27310
a((dp27311
g2
(lp27312
VPerhaps a  with the two-halves set evenly and  set to  (to stop the user moving it):
p27313
as(dp27314
g18
V23354
p27315
stp27316
a((dp27317
g2
(lp27318
VFor truly n-dimensional stuff, you're probably going to have to drop to simpler concepts - maybe a multi-dimensional array ()
p27319
aVThings like jagged arrays () or wrappers using  etc are feasible if the number of dimensions is known and constant (but > 1)
p27320
aVAn example using an  of unknown dimension:
p27321
aVBut obviously it is easier if the dimensions are known:
p27322
aVThe problem with multi-dimension arrays is that they can quickly get too big for the CLR to touch
p27323
aVwhich is where jagged arrays or other wrappers come in handy (by splitting it into multiple smaller objects) - but making construction much harder:
p27324
aVAny of these can usually be wrapped inside a class, which is probably the sensible approach
p27325
as(dp27326
g18
V23354
p27327
stp27328
a((dp27329
g2
(lp27330
VOne option, if you want an out-of-process COM component, is to host a dll in COM+ via serviced components
p27331
aVThis only supports dll though, but you could write a shell exe (for standalone use) that simply defers to the dll
p27332
aVNot quite as simple as VB, but it works
p27333
aVI do remember somebody showing me a more direct way (no COM+), but I can't for the life of me remember what it was
p27334
as(dp27335
g18
V23354
p27336
stp27337
a((dp27338
g2
(lp27339
VI suspect you'll still have to tell it about (checkout) each individual trunk - but you can at least also checkout the workspace (to get all the projects, and so you can update etc globally) using sparse directories
p27340
as(dp27341
g18
V23354
p27342
stp27343
a((dp27344
g2
(lp27345
VIf the value is truly part of the system, then perhaps have it as a property:
p27346
aVThen you can have two  instances (same type) simply with different properties
p27347
aVIt really depends on the context
p27348
aVEric Lippert has a good blog on when to (and not to) use attributes: Properties vs
p27349
aVAttributes
p27350
as(dp27351
g18
V23354
p27352
stp27353
a((dp27354
g2
(lp27355
VI know interfaces must be only a
p27356
aVhandful of members large
p27357
aVThey need to contain exactly as many members as are necessary to express the concept - no more, no less
p27358
aVThere are some quite scary interfaces in the BCL (although maybe you could argue some are oversized)
p27359
aVI'd say this definitely looks like an acceptable use of interface inheritance
p27360
aVAs an aside
p27361
aVif there is implementation logic that only depends on the interface members, consider using extension methods so that the implementing classes don't need to repeat it
p27362
aVfor example:
p27363
aVthen all callers get the  method without all the implementations having to repeat it
p27364
as(dp27365
g18
V23354
p27366
stp27367
a((dp27368
g2
(lp27369
VThe most basic (but a little dangerous re endianness) is:
p27370
aVOther than than, bit-shifting is fine (as per your own reply) - or you can use Jon's EndianBitConverter in MiscUtil, which handles the translations
p27371
aV(edit)
p27372
aVThe little-endian bit-shifting version I use in protobuf-net is pretty-much identical to your version - I just read them in ascending order and use bitwise (not numeric) addition:
p27373
as(dp27374
g18
V23354
p27375
stp27376
a((dp27377
g2
(lp27378
VYou can create an  with an  that knows about the namespaces; the following works for  and :
p27379
as(dp27380
g18
V23354
p27381
stp27382
a((dp27383
g2
(lp27384
VYou could try making the classes  -  is fussy about that
p27385
aVHowever, I seem to recall that the settings code is much more interested in type-converters; you could try writing a  for it
p27386
as(dp27387
g18
V23354
p27388
stp27389
a((dp27390
g2
(lp27391
VYou are essentially trying to access SomeProp[foo, bar
p27392
aVso; what are sensible index values
p27393
aVFor integers, maybe 0,0,0
p27394
aVis safe - maybe not
p27395
aVIt depends on the context
p27396
aVPersonally, I'm not sure that this is the best way to go; I might look at  on the main object, but other than that - just look at regular properties
p27397
as(dp27398
g18
V23354
p27399
stp27400
a((dp27401
g2
(lp27402
VNo, I don't think so
p27403
aVEither loop over the rows of your , or update the database and reload
p27404
as(dp27405
g18
V23354
p27406
stp27407
a((dp27408
g2
(lp27409
VAll you have updated is a local variable; for that to work you would have to copy the member values from  to  - not quite so simple
p27410
aVSomething like below; the only reason I used  was that I tested on Northwind
p27411
aVCustomer, which has a string key ;-p
p27412
aVThe advantage of using the meta-model is that it works even if you are using POCO classes (and the xml-based mapping), and it doesn't try to update anything unrelated to the model
p27413
aVFor the purposes of the example, I have passed in the data-context, and you need to add a  at some point, but the rest should be directly comparable
p27414
aVBTW - if you are happy to take the ID from the passed in object, that would be easy too - and then you could support composite identity tables
p27415
as(dp27416
g18
V23354
p27417
stp27418
a((dp27419
g2
(lp27420
VIf you don't get any joy, you could try SmartPropertyGrid; I have no idea whether it'll work, but it perhaps worth a look
p27421
aVYou might even have more joy as a "feature request" from a 3rd-party, since the MS version is pretty-much sealed now that WPF has taken over
p27422
as(dp27423
g18
V23354
p27424
stp27425
a((dp27426
g2
(lp27427
VYou could try looking at MSDN or books, but you might find the VS2005 information hidden behind the VS2008 stuff
p27428
as(dp27429
g18
V23354
p27430
stp27431
a((dp27432
g2
(lp27433
VSomething like:
p27434
as(dp27435
g18
V23354
p27436
stp27437
a((dp27438
g2
(lp27439
VNo, you can't add constructors (even with extension methods)
p27440
aVAssuming you have some magic way to get from a  to an  (I'd be interested in reading that blog post if you can cite it) - then the closest you can do is probably something like:
p27441
aVHowever; I'm dubious as to what you can do with a lambda for equality
p27442
aVyou have two concepts to express: hashing, and true equality
p27443
aVWhat would your lambda look like
p27444
aVIf you are trying to defer to child properties, then perhaps a  to select the property, and use  internally
p27445
aVsomething like:
p27446
as(dp27447
g18
V23354
p27448
stp27449
a((dp27450
g2
(lp27451
VAbsolutely, using  with database (i
p27452
ag50
aVlong-term) storage is a bad idea;  has two three big faults (by default):
p27453
aVit includes type metadata (shucks if you move/rename your types
p27454
aVthis can mean strong name/versioning too)
p27455
aVit includes field names (fields are private details
p27456
aVit is
p27457
aVNET specific (which is a pain if you ever want to use anything else)
p27458
aVMy blog post here raises two specific issues with this - obfuscation and automatically implemented properties
p27459
aVI won't repeat the text here, but you may find it interesting
p27460
aVI recommend the use of a contract based serialization
p27461
aVor  would suffice normally
p27462
aVIf you want small efficient binary, then protobuf-net might be of interest
p27463
aVUnlike , the binary from this is portable between implementations, extensible (for new fields), etc
p27464
aVAnd it is quicker and smaller, too
p27465
as(dp27466
g18
V23354
p27467
stp27468
a((dp27469
g2
(lp27470
VDo you really mean "Dictionary"
p27471
aVWinform binding is OK with lists (/), but not with dictionary
p27472
aVAdditionally,  isn't quite as easy to bind to as some other controls
p27473
aVOther than that, it should work purely using the mapping names - I'll try to do a simple example
p27474
aVEdit with basic example from Northwind; note that the data-context should ideally not be long lived; you may also want to look at things like repository implementations rather than direct binding:
p27475
aVAs an aside - note that the syntax:
p27476
aVIs equivalent to:
p27477
aV(I only add this as it is a common question)
p27478
as(dp27479
g18
V23354
p27480
stp27481
a((dp27482
g2
(lp27483
VNo, generic type constraints can only specify a single base-class
p27484
aVYou can specify multiple interfaces, but this is "all of", not "any of"
p27485
aVWhat you ask is possible with overloading, but not with generics
p27486
as(dp27487
g18
V23354
p27488
stp27489
a((dp27490
g2
(lp27491
VWelcome to the wonderful world of System
p27492
aVComponentModel
p27493
aVThis dark corner of
p27494
aVNET is very powerful, but very complex
p27495
aVA word of caution; unless you have a lot of time for this - you may do well to simply serialize it in whatever mechanism you are happy with, but rehydrate it back into a  at each end
p27496
aVwhat follows is not for the faint-hearted ;-p
p27497
aVFirstly - data binding (for tables) works against lists (/) - so  should be fine (edited: I misread something)
p27498
aVBut it isn't going to understand that your dictionary is actually columns
p27499
aVTo get a type to pretend to have columns you need to use custom  implementations
p27500
aVThere are several ways to do this, depending on whether the column definitions are always the same (but determined at runtime, i
p27501
ag50
aVperhaps from config), or whether it changes per usage (like how each  instance can have different columns)
p27502
aVFor "per instance" customisation, you need to look at  - this beast (implemented in addition to ) has the fun task of presenting properties for tabular data
p27503
aVbut it isn't alone:
p27504
aVFor "per type" customisation, you can look at  - this can suggest dynamic properties for a class
p27505
aVor you can implement  - but this is only used (for lists) in very occasional circumstances (an object indexer (") and at least one row in the list at the point of binding)
p27506
aV(this interface is much more useful when binding discreet objects - i
p27507
ag50
aVnot lists)
p27508
aVImplementing , and providing a  model is hard work
p27509
aVhence it is only done very occasionally
p27510
aVI'm fairly familiar with it, but I wouldn't do it just for laughs
p27511
aVHere's a very, very simplified implementation (all columns are strings; no notifications (via descriptor), no validation (), no conversions (), no additional list support (/), no abstraction (), no other other metadata/attributes, etc):
p27512
as(dp27513
g18
V23354
p27514
stp27515
a((dp27516
g2
(lp27517
VHow about embedding Cassinni and using ASP
p27518
aVNET
p27519
as(dp27520
g18
V23354
p27521
stp27522
a((dp27523
g2
(lp27524
VWhat does the connection string look like
p27525
aVis good for parsing and inspecting connection-string values by key:
p27526
aVotherwise you can get various details from the http server variables
p27527
as(dp27528
g18
V23354
p27529
stp27530
a((dp27531
g2
(lp27532
VWell, first of all I'd think about how to find prime numbers, and write that in a console app that reads a line, does the math, and writes the results (purely because that is the simplest thing you can do, and covers the same parsing etc logic you'll need later)
p27533
aVWhen you are happy with the prime number generation, then look at how to do winforms - how to put a listbox, textbox and button on a form; how to handle the click event (of the button), and how to read from the textbox and write values into the listbox
p27534
aVYour prime code should be fairly OK to take "as is"
p27535
aVIf you don't already have an IDE, then note that C# Express is free and will cover all of the above
p27536
as(dp27537
g18
V23354
p27538
stp27539
a((dp27540
g2
(lp27541
VThe tablets I've seen are running standard Windows with the "full"
p27542
aVNET, but I expect you can get some light-weight devices, too
p27543
aVOne interesting possibility might be "client profile" (a subset of the regular "full"
p27544
aVNET dlls) - but I haven't seen much use of that myself
p27545
aVCF and regular
p27546
aVNET share a lot of things, but ultimately there are differences; neither is a strict subset of the other
p27547
aVI've found that in general the only way to write code for 2 frameworks is to keep both active
p27548
aVfor protobuf-net (which has this problem) I keep a project file for each framework so that I can quickly test that the build works everywhere (i
p27549
ag50
aVthere are no missing methods etc)
p27550
aVYou may find you need to use  blocks to run slightly different code on the two frameworks, especially if you want to use "full"
p27551
aVNET features for performance reasons (that don't exist in the CF version)
p27552
aVOne way of making this easier it to hack the proj files to use recursive file inclusion:
p27553
aVNow you don't have to keep adding new files to both projects  - it'll get picked up automatically (caveat: in the IDE you may need to unload/reload the project)
p27554
as(dp27555
g18
V23354
p27556
stp27557
a((dp27558
g2
(lp27559
VA method group is the name for a set of methods (that might be just one) - i
p27560
ag50
aVin theory the  method may have multiple overloads (plus any extension methods): , , etc - hence  by itself is a "method group"
p27561
aVIt can usually convert a method group to a (typed) delegate by using overload resolution - but not to a string etc; it doesn't make sense
p27562
aVOnce you add paranthesis, again; overload resolution kicks in and you have unambiguously identified a method call
p27563
as(dp27564
g18
V23354
p27565
stp27566
a((dp27567
g2
(lp27568
VYou can't change the access, but you can re-declare the member with greater access:
p27569
aVThe problem is that this is a different , and inheritance / virtual might not work as expected
p27570
aVIn the above case (where we just call , and the new method isn't virtual) that is probably fine
p27571
aVIf you need real polymorphism above this, then you can't do it (AFAIK) without introducing an intermediate class (since you can't  and  the same member in the same type):
p27572
aVThe important point in the above is that there is still a single virtual member to override:
p27573
as(dp27574
g18
V23354
p27575
stp27576
a((dp27577
g2
(lp27578
VA minor aside - but in this scenario, consider developing the utility in Silverlight - it has a much smaller footprint and is supported on a number of operating systems
p27579
aVThis might allow you to get the coverage including people who don't already have
p27580
aVNET
p27581
aVIf you need "normal"
p27582
aVNET, then "Client Profile" is perhaps an option
p27583
as(dp27584
g18
V23354
p27585
stp27586
a((dp27587
g2
(lp27588
VTo get the description data, you unfortunately have to use sysobjects/syscolumns to get the ids:
p27589
aVYou can do it with info-schema, but you'd have to concatenate etc to call OBJECT_ID() - so what would be the point
p27590
as(dp27591
g18
V23354
p27592
stp27593
a((dp27594
g2
(lp27595
VAhh
p27596
aVyou edited
p27597
aVI suspect the closest you'll get is generics:
p27598
aV(and look at )
p27599
aVBut that assumes all the  are the same
p27600
aVOther than that; no
p27601
aVEvery null is the same as every other ( aside), and you cannot tell the variable type
p27602
aVOriginal reply:
p27603
aVDo you mean overload resolution
p27604
aV(where  is  for static methods, and  is the  that has the  method)
p27605
as(dp27606
g18
V23354
p27607
stp27608
a((dp27609
g2
(lp27610
VYou have two console exes, one which runs a  - is that correct
p27611
aVRun the server console without debugging; then in the IDE add the WCF reference to the url
p27612
aVIt should work, but it needs the server (your second console exe) to be running when you query the mex
p27613
as(dp27614
g18
V23354
p27615
stp27616
a((dp27617
g2
(lp27618
VWithout changing anything
p27619
aVUse the  constructor that accepts  - so in C# (my VB isn't great):
p27620
aVIf you can change things; perhaps consider things like the WCF usage where you can specify the collection type (of all methods) - the  switch
p27621
aVChanging to a WCF stack is non-trivial, though
p27622
as(dp27623
g18
V23354
p27624
stp27625
a((dp27626
g2
(lp27627
VFrom a server admin perspective
p27628
aVNot a lot, to be honest
p27629
aVThe
p27630
aVNET framework is mainly a developer stack (LINQ, ASP
p27631
aVNET MVC, etc)
p27632
aVThe decision of which version of the OS/IIS would be more interesting from the admin angle
p27633
aVI think you're going to have to justify 3
p27634
aV5 on a development basis (offsetting the resource cost of deployment/validation etc), not a sysadmin one
p27635
as(dp27636
g18
V23354
p27637
stp27638
a((dp27639
g2
(lp27640
VI'd be more interested in the thread-safefy
p27641
aVMSDN doesn't (unless I missed it) say that  is thread-safe, so IMO the best option is to have one per call
p27642
aVIt doesn't matter how quickly you can get the wrong answer ;-p
p27643
aVWhat you probably don't want to do (to fix the thread-safety issue) is have a static instance and  around it
p27644
aVthat'll serialize all your crypto code, when it could run in parallel on different requests
p27645
as(dp27646
g18
V23354
p27647
stp27648
a((dp27649
g2
(lp27650
VMiscUtil has an answer to this () that uses  (
p27651
aVNET 3
p27652
aV5) and a static field to cache the compiled delegate (so there is negligible cost per invoke):
p27653
aVIf you are using 2
p27654
aV0, then probably reflection would be your friend
p27655
aVYou can use  to improve the performance if you need
p27656
as(dp27657
g18
V23354
p27658
stp27659
a((dp27660
g2
(lp27661
VDon't forget that the runtime already has an abstracted security/user system built in - the principal (see this existing answer - note that  is just one option; it is pretty trivial to write your own)
p27662
aVYour UI can handle creating and assigning the principal based on the specific implementation (indeed, IIRC ASP
p27663
aVNET and WCF do this automatically, or for winforms/wpf you can use the windows identity, or (via a web-service) the same ASP
p27664
aVNET login)
p27665
aVYour business logic then just checks ; from this you can get the name, the authentication method, and check for roles (without needing to know how roles are implemented)
p27666
aVThe runtime also provides inbuilt checks:
p27667
aV(where  is a string constant of your role name) This will check access automatically, throwing a  if not in the role
p27668
aVYou can also check via code (useful if the role isn't fixed at compile time)
p27669
aVObviously your UI should check roles (to disable/hide functionality), but it is good to have the business code enforce the roles without needing to know about the UI
p27670
aV(added)
p27671
aVI should mention that  is handy for unit tests
p27672
aVOf course, you could role your own security API, and nobody will stop you
p27673
as(dp27674
g18
V23354
p27675
stp27676
a((dp27677
g2
(lp27678
VFirst - don't keep currency in a  - use a  instead
p27679
aVEvery time
p27680
aVThen use "C0" as the format specifier:
p27681
as(dp27682
g18
V23354
p27683
stp27684
a((dp27685
g2
(lp27686
V(edit: when answering, it wan't clear to me that the question was about IoC/DI; I'll leave this here for reference, but look first at the accepted answer)
p27687
aVIf by "injected" you mean that  assumes ownership of , then yes; example of this would be things like
p27688
aVIf it just uses  for a while (but  continues to live beyond ) then no
p27689
aVSome APIs allow you to specify (on the constructor) whether ownership should be assumed (i
p27690
ag50
aVwhether to clean up the injected object)
p27691
aVAn example of this would be
p27692
as(dp27693
g18
V23354
p27694
stp27695
a((dp27696
g2
(lp27697
VCannot reproduce; I get (after fixing the more immediate bugs):
p27698
aVChanges:
p27699
aVinstead of  (which prevented it compiling)
p27700
aVinit the lists in the default constructors (which prevented  from working):
p27701
as(dp27702
g18
V23354
p27703
stp27704
a((dp27705
g2
(lp27706
VTry something like (ensuring that the reader is in sequential mode):
p27707
aVThe biggest problm I can see in the original code is not looking too much at the number of bytes returned per call to  (i
p27708
ag50
aVassuming you got a whole chunk)
p27709
as(dp27710
g18
V23354
p27711
stp27712
a((dp27713
g2
(lp27714
VIf the table exists, you can use  (which will accept a ) to get the data into the table in the fastest possible way (much faster than via an adapter)
p27715
aVI don't think it will create the table though
p27716
aVYou might have to write the DDL yourself, or find some existing code to loop over the  to do it
p27717
as(dp27718
g18
V23354
p27719
stp27720
a((dp27721
g2
(lp27722
VHave you moved/renamed the files/classes at any point, and/or changed the project's default namespace
p27723
aVI've seen all of these have similar effects to the above
p27724
aVRe the (generated) line:
p27725
aVIt is probably worth avoiding having fields () named the same as types () - that can only lead to potential for bugs
p27726
aVIt isn't clear (without being able to reproduce it) whether that is a factor here, but it can't help any
p27727
aVWhat is the field  meant to represent
p27728
aVCan you rename it
p27729
as(dp27730
g18
V23354
p27731
stp27732
a((dp27733
g2
(lp27734
VDoes it have to be async via
p27735
aVI have a generic blocking queue here (i
p27736
ag50
aVreaders block until there is data or it is closed; writers block until there is space); it isn't optimised specifically for , but as long as the size isn't vast it should cope - but as a blocking queue it requires (at least one) dedicated consumer thread, doing:
p27737
as(dp27738
g18
V23354
p27739
stp27740
a((dp27741
g2
(lp27742
VI would probably use the  in this case, and ; example on the way
p27743
as(dp27744
g18
V23354
p27745
stp27746
a((dp27747
g2
(lp27748
VI take it you want to suppress the code in your event-handler
p27749
aVIf so, a common way of doing this is with a boolean flag (or sometimes an int counter):
p27750
as(dp27751
g18
V23354
p27752
stp27753
a((dp27754
g2
(lp27755
VFor web apps, modal dialogs would be done at the client, usually via javascript and dhtml - not at the server (where ASP
p27756
aVNET code executes)
p27757
aVSo I fear that this product is indeed winforms only
p27758
as(dp27759
g18
V23354
p27760
stp27761
a((dp27762
g2
(lp27763
VWhat version of
p27764
aVNET, and what range of values
p27765
aVOne option, for example, would be to parse it as a decimal and convert it from there
p27766
aV(the above just shows the central conversion - it doesn't attempt to fit it into your existing code)
p27767
aVThis won't work for huge/very small values, but probably won't suffer the same rounding issues as
p27768
as(dp27769
g18
V23354
p27770
stp27771
a((dp27772
g2
(lp27773
VI suspect you might run into some performance issues if using that approach routinely
p27774
aVSince your xml is relatively simple, I strongly suspect that you would do better just using  directly
p27775
aVbut doing so isn't easy; IMO, it is better to try to avoid the need to implement  (juts using regular collection properties etc) - it is a common cause of bugs and frustration
p27776
as(dp27777
g18
V23354
p27778
stp27779
a((dp27780
g2
(lp27781
VThere are two approaches you might consider:
p27782
aVdeclare your own delegate type / event-args type with the extra data
p27783
aVhave a public property on the raising class which exposes this data
p27784
aVif  is your type, then you're already doing the first - so just expose this value in the event-args type; you can consume it in an anonymous method:
p27785
aVThere is a problem, though - note the  above; this is the notorious / issue
p27786
as(dp27787
g18
V23354
p27788
stp27789
a((dp27790
g2
(lp27791
VI suspect you've simply overlooked the difference between the variable typed as  (the interface), and the value (reference) initialized as a  (note no ; the concrete type)
p27792
as(dp27793
g18
V23354
p27794
stp27795
a((dp27796
g2
(lp27797
VInterestingly, if you enumerate over the dictionary (length N) first and check the list (length M) for inclusion, then you get O(NM) performance
p27798
aVYou could build a  of the ids, but that seems redundant since we already have a (pre-hashed) dictionary available
p27799
aVI would instead iterate over the ids first; since dictionary lookup (by key) is O(1), this gives O(M) performance - this might, however, mean that you don't use LINQ (since  won't love LINQ (and introducing a tuple is too much like hard work)
p27800
aVIt doesn't overly concern me that this is more lines than the LINQ version; it removes an O(N) of complexity
p27801
aVEdit; the following might work (I haven't tested it), but I think it is an abuse of LINQ, and certainly won't scale to PLINQ etc
p27802
aVuse with extreme caution
p27803
aVI also believe the  approach simply has fewer overheads, so will be quicker
p27804
aVanyway:
p27805
as(dp27806
g18
V23354
p27807
stp27808
a((dp27809
g2
(lp27810
VOn a purist level, I'd argue that a  and a  are not the same, by algebra:
p27811
aV+  =>  (translation)
p27812
aV+  =>  (addition)
p27813
aV+  (not defined)
p27814
aVI would have 2 immutable structs with implicit (where they are logically equivalent) or explicit (otherwise) conversion operators
p27815
aVI probably wouldn't have a  struct, though
p27816
aVI might have a  property on a  that scales it to unit, but that is about it
p27817
aVI've stubbed out a primitive  and  to show the interactions; I haven't filled in all of  (since it is simpler):
p27818
as(dp27819
g18
V23354
p27820
stp27821
a((dp27822
g2
(lp27823
VIn
p27824
aVNET 3
p27825
aV5, perhaps consider  - it won't tell you at what index it differs, though
p27826
as(dp27827
g18
V23354
p27828
stp27829
a((dp27830
g2
(lp27831
VC# 4
p27832
aV0 is included in the VS2010 beta (you can try it right now; 'dynamic`, variance etc work), and will be shipped in VS2010 RTM and almost certainly (I assume) in the standalone
p27833
aVNET 4
p27834
aV0 RTM - but when that is is entirely up to Microsoft; in particular, Soma highlights the need to get quality and performance right, and I would encourage them not to rush on either point (I want it fast and stable ;-p)
p27835
as(dp27836
g18
V23354
p27837
stp27838
a((dp27839
g2
(lp27840
VIf you are considering
p27841
aVNET - look at Silverlight; it looks like this would be a good fit, and is a tiny download that supports multiple operating systems (especially with "moonlight" for mono/linux)
p27842
as(dp27843
g18
V23354
p27844
stp27845
a((dp27846
g2
(lp27847
VWould it not make sense just to pass the value by reference
p27848
aVOf course, using public variables (fields) is a bad idea too
p27849
aVit would work like so:
p27850
aVBut it won't work if you make  a property - so don't do this
p27851
aVConsider passing the beacon (or similar) itself, or some other object-based (or maybe event-based) mechanism
p27852
aVsomething like:
p27853
aVwith:
p27854
aVHere we have a reference to the Beacon object, which doesn't have the  issues of pointers
p27855
aVIf you don't want to expose the  directly, consider using an interface
p27856
as(dp27857
g18
V23354
p27858
stp27859
a((dp27860
g2
(lp27861
VUsing reflection and attributes are slower than regular C# compiled as IL, but the question is: how much are you doing it
p27862
aVIf you aren't doing lots of this, you won't notice it
p27863
aVThere are ways of boosting the performance of reflection, but they are quite advanced
p27864
aVThat seems a reasonable way of specifying a mapping (and is comparable to most serialization and persistence frameworks - although often a separate API without attributes is offered too)
p27865
aVFor (in)appropriate uses, see Eric Lippert's blog
p27866
as(dp27867
g18
V23354
p27868
stp27869
a((dp27870
g2
(lp27871
VNo - don't use  here; that doesn't give you polymorphism
p27872
aVisn't intended for inheritance in this way; use  and  the   method
p27873
as(dp27874
g18
V23354
p27875
stp27876
a((dp27877
g2
(lp27878
VI haven't had time to look at it yet, but Entity Framework in 4
p27879
aV0 (VS2010, now available in public beta) supports T4 templates for code generation from edmx
p27880
aVso you can customize it pretty much as you like
p27881
aVSearch for "Entity Framework T4 Template" and you'll find a lot, especially from the last few days
p27882
as(dp27883
g18
V23354
p27884
stp27885
a((dp27886
g2
(lp27887
VNo; an extension method never takes priority over an instance method with a suitable signature, and never participates in polymorphism ( is a  method)
p27888
as(dp27889
g18
V23354
p27890
stp27891
a((dp27892
g2
(lp27893
VNot programming, but perhaps: wireshark
p27894
aVAlternatively, look into message inspectors
p27895
aVI don't have a specific example for size logging, though
p27896
as(dp27897
g18
V23354
p27898
stp27899
a((dp27900
g2
(lp27901
VIt is actually pretty simple;
p27902
aVtranslates (literally) to:
p27903
aVand:
p27904
aVtranslates directly to (with "entry" as our context):
p27905
aV(except for when it would be , which the compiler omits for non-trivial cases)
p27906
aVso just inject those and you're done:
p27907
as(dp27908
g18
V23354
p27909
stp27910
a((dp27911
g2
(lp27912
VIt isn't 100%
p27913
aVmost importantly, 3
p27914
aV5 and 3
p27915
aV5SP1 both include service packs to 2
p27916
aV0 and (later) 3
p27917
aV0; these changes aren't all trivial
p27918
aVAs a key one; if you start using types in SP1 even in what you think is 2
p27919
aV0, it will fail on a "proper" 2
p27920
aV0 client
p27921
aVThere is an FX cop tool to help avoid this, IIRC
p27922
aVSecond, there are (in the service pack) changes to things deep in the core - the number of pool threads, for example (or is it the stack size of pool threads
p27923
aVsomething in that area) that can bite you if you are unlucky
p27924
aVAlso, there are bug-fixes in the 2
p27925
aV0 code; if you happen (by chance) to be relying on a behaviour that changes in the service pack (SP1/SP2)
p27926
aVBut also don't forget that you have this problem now; if your clients have installed
p27927
aVNET 3
p27928
aV5, then they have taken the 2
p27929
aV0 service pack(s) ;-p
p27930
aVSo don't completely dismiss it - but if you take suitable precautions (with testing) and it should be achievable
p27931
as(dp27932
g18
V23354
p27933
stp27934
a((dp27935
g2
(lp27936
VA lot of this may be a dup from here; in short, keep connections short lived and local under most circumstances
p27937
aVRe the data reader; perhaps enable MARS
p27938
as(dp27939
g18
V23354
p27940
stp27941
a((dp27942
g2
(lp27943
VWhen you use  etc, you are compressing a stream; not a file
p27944
aVhas no file header information, so there is no sensible way of packing multiple files
p27945
aVFor that you need something like
p27946
aVzip; #ziplib will do the job, but you still (IIRC) need to feed it each file manually
p27947
as(dp27948
g18
V23354
p27949
stp27950
a((dp27951
g2
(lp27952
VIf you never want that property displayed:
p27953
aVOtherwise, as already stated - set  to false and add them manually
p27954
as(dp27955
g18
V23354
p27956
stp27957
a((dp27958
g2
(lp27959
VPersonally I don't get too excited about IDE integration; I use TortoiseSVN in explorer, which IMO works just as well, without adding more weight to VS
p27960
aVAnkhSVN, Visual SVN and SlickEdit Versioning Toolbox are among the integrated tools
p27961
aVBut from what I understand (from dialogue only), Git
p27962
aV= SVN
p27963
as(dp27964
g18
V23354
p27965
stp27966
a((dp27967
g2
(lp27968
VOK; got to the bottom of it; in the line:
p27969
aVIf you weren't trying to pass in a , this would work for those expressions that don't involve  in the argument; for those that do, you need to tell the lambda to include the parameter (the same one from the original lambda) - simply by:
p27970
aVHere's some working code that evaluates the inner parameter (given an instance of the argument type); note that I use the parameter even if it doesn't involve an  - otherwise, what would it do with the instance
p27971
as(dp27972
g18
V23354
p27973
stp27974
a((dp27975
g2
(lp27976
VAssuming you are using a jagged array (), then you can use LINQ by combining  and :
p27977
aVYou could also (alternatively) build a comparison to pass to
p27978
as(dp27979
g18
V23354
p27980
stp27981
a((dp27982
g2
(lp27983
VTry using:
p27984
aVHowever; if the other thread is not a background thread, you will need it to exit in order to end the process (the exit code is meaningless until the process exits)
p27985
as(dp27986
g18
V23354
p27987
stp27988
a((dp27989
g2
(lp27990
VIn many cases like this, the simplest approach is to use a "captured variable" to pass state between the threads; this means you can keep the logic localised:
p27991
aVThe above is particularly useful if we expect it to be called on the worker thread (so little point checking ) - note that this is safe from either the UI or worker thread, and allows us to pass as much or as little state between the threads
p27992
as(dp27993
g18
V23354
p27994
stp27995
a((dp27996
g2
(lp27997
VThat requires a "shell extension", in particular an "icon overlay handler"; I haven't done it myself, but perhaps search on those terms, or look at this discussion
p27998
as(dp27999
g18
V23354
p28000
stp28001
a((dp28002
g2
(lp28003
V1: up to you; you can't really do anything about them, so I'd probably let them surface unless I needed to hide it from the caller (replacing it with a similar, less specific exception)
p28004
aV2: You should keep connections as "local" and short-lived as possible; often one per method call
p28005
aVMost providers have connection pooling, meaning you will get back the same underlying connection (as long as you use the same connection string), without having to stress about synchronization, re-entrancy, etc (it will allocate more connections as needed)
p28006
aV3: look at patterns like the repository pattern; look also at ORM frameworks like LINQ-to-SQL, Entity Framework, NHibernate, etc
p28007
ag412
ag50
as(dp28008
g18
V23354
p28009
stp28010
a((dp28011
g2
(lp28012
VIn
p28013
aVNET 3
p28014
aV5SP1, then the answer is a big fat "no" I'm afraid
p28015
aVIn
p28016
aVNET 4
p28017
aV0 the story looks more promising, with POCO support being introduced (which should hopefully let you use your own objects, although I haven't tried it on the public beta yet)
p28018
aVNote that you can do POCO (with your own objects) with LINQ-to-SQL, by using an external mapping file (and supplying a  object) - but the tools don't exactly help you to do this (it wants to use code generation by default)
p28019
aVFor now, maybe NHibernate (and similar) is your best choice
p28020
as(dp28021
g18
V23354
p28022
stp28023
a((dp28024
g2
(lp28025
VRe returning it
p28026
aVwhy return it
p28027
aVYou've already updated it
p28028
aVthe caller will see the change
p28029
aVAnd if you aren't using generics in the method (you aren't) just use  and no generics
p28030
aVIf the code itself doesn't work, I think the biggest problem is using the string "propertyitem
p28031
aVName", rather than evaluating the property value: :
p28032
aVYou may want to look at this post too
p28033
as(dp28034
g18
V23354
p28035
stp28036
a((dp28037
g2
(lp28038
VThere's a reason that  was replaced with
p28039
aVI expect you'll need to find a 3rd-party grid control for 1
p28040
aV1 to do this (but that gets harder the older 1
p28041
aV1 gets)
p28042
aVSorry if this isn't very helpful
p28043
as(dp28044
g18
V23354
p28045
stp28046
a((dp28047
g2
(lp28048
VIf you know the  (via generics), then just  should work
p28049
aVOtherwise (for , or the non-generic ), check the interfaces implemented:
p28050
as(dp28051
g18
V23354
p28052
stp28053
a((dp28054
g2
(lp28055
VTo be robust, you're probably going to have to add a timer, and just check it regularly; from here, the control doesn't post suitable win32 messages (EN_SELCHANGE) to do this as an event
p28056
as(dp28057
g18
V23354
p28058
stp28059
a((dp28060
g2
(lp28061
VPersonally I'd use a binary search to find the next assembly
p28062
aVstart n=1
p28063
aVdoes TestAssembly1
p28064
aVdll exist
p28065
aV(yes)
p28066
aVdoes TestAssembly2
p28067
aVdll exist
p28068
aV(yes)
p28069
aVdoes TestAssembly4
p28070
aVdll exist
p28071
aV(yes)
p28072
aVdoes TestAssembly8
p28073
aVdll exist
p28074
aV(yes)
p28075
aVdoes TestAssembly16
p28076
aVdll exist
p28077
aV(yes)
p28078
aVdoes TestAssembly32
p28079
aVdll exist
p28080
aV(no)
p28081
aVand no use binary search between 16 and 32:
p28082
aVdoes TestAssembly24
p28083
aVdll exist
p28084
aV(yes)
p28085
aVdoes TestAssembly28
p28086
aVdll exist
p28087
aV(yes)
p28088
aVdoes TestAssembly30
p28089
aVdll exist
p28090
aV(no)
p28091
aVdoes TestAssembly29
p28092
aVdll exist
p28093
aV(yes)
p28094
aVso use TestAssembly30
p28095
aVdll
p28096
aVThis avoids the need to keep the count separately, so it'll work even if you delete all the files - and the binary search means you don't have too bad performance
p28097
aVUntested, but something like below; also note that anything based on file existence is immediately a race condition (although usually a very slim one):
p28098
as(dp28099
g18
V23354
p28100
stp28101
a((dp28102
g2
(lp28103
V is the ; you need to pass it the value from the property - i
p28104
ag50
aVIf this child object is created by the parent, you shouldn't need to "set" it; just update the underyling object:
p28105
aVIt may be you need to create the child object (usually ), in which case you will need to call :
p28106
aVI wonder, though - is there really any difference between  and
p28107
aVIt feels like they could be the same thing
p28108
as(dp28109
g18
V23354
p28110
stp28111
a((dp28112
g2
(lp28113
VAre you sure it writes to stdout
p28114
aVHave you tried checking stderr
p28115
aV(///)
p28116
aVIf it writes directly to the display buffer (instead of stderr/stdout) then it might not be possible without a lot of work
p28117
as(dp28118
g18
V23354
p28119
stp28120
a((dp28121
g2
(lp28122
VThe direct cast doesn't have to do any checking except a runtime type check - I would expect that the cast is quicker
p28123
aVYou might also want to consider ; since (for ) this is just , it should be quick - certainly quicker than the
p28124
aVThen the race is between a runtime type-check and a virtual call; in reality, both are very, very quick
p28125
as(dp28126
g18
V23354
p28127
stp28128
a((dp28129
g2
(lp28130
VLINQ is a query tool (Q = Query) - so there is no magic LINQ way to update just the single row, except through the (object-oriented) data-context (in the case of LINQ-to-SQL)
p28131
aVTo update data, you need to fetch it out, update the record, and submit the changes:
p28132
aVOr write an SP that does the same in TSQL, and expose the SP through the data-context:
p28133
as(dp28134
g18
V23354
p28135
stp28136
a((dp28137
g2
(lp28138
VAnd then somebody goes and uses " instead of '
p28139
aVParameters are, IMO, the only safe way to go
p28140
aVIt also avoids a lot of i18n issues with dates/numbers; what date is 01/02/03
p28141
aVHow much is 123,456
p28142
aVDo your servers (app-server and db-server) agree with each-other
p28143
aVIf the risk factor isn't convincing to them, how about performance
p28144
aVThe RDBMS can re-use the query plan if you use parameters, helping performance
p28145
aVIt can't do this with just the string
p28146
as(dp28147
g18
V23354
p28148
stp28149
a((dp28150
g2
(lp28151
VYou are allowed to use multiple include attributes - although they are more commonly set against the type itself:
p28152
as(dp28153
g18
V23354
p28154
stp28155
a((dp28156
g2
(lp28157
VSome inventive generic usage ;-p
p28158
as(dp28159
g18
V23354
p28160
stp28161
a((dp28162
g2
(lp28163
VPersonally I'd put all the controls (and sub-controls) I want to impact into a  - then just change the state of the single
p28164
aVThis means you don't have to start storing the old values (to put them back - you might not want to assume they all started enabled, for example)
p28165
as(dp28166
g18
V23354
p28167
stp28168
a((dp28169
g2
(lp28170
VHow much RAM have you got
p28171
aVYou could always run XP (or your choice) in a virtual machine - VMware Player if free (you can create machine via EasyVMX)
p28172
aVThen you can take your development machine with you wherever you go (even on a (large) memory stick, if you want)
p28173
aVThis approach also lets you develop an the whole range of platforms - need to develop something on Win2003 Server
p28174
aVno problem
p28175
aVBut an MSDN subscription (for the OS licenses) would help ;-p
p28176
as(dp28177
g18
V23354
p28178
stp28179
a((dp28180
g2
(lp28181
VThere is a lot of things in the  methods that you just don't use; for example, you don't actually use the object you spend lots of time creating
p28182
aVHow about adding a  property to  (to hold the mapped  column), and something like:
p28183
aVThen there is no need to switch on the different property types; you can use :
p28184
aVAlternatively; pass the id in as an argument:
p28185
aVAnd do something like:
p28186
as(dp28187
g18
V23354
p28188
stp28189
a((dp28190
g2
(lp28191
VNot for existing library functions
p28192
aVFor your own code, you could apply code-access-security on methods, but code running as "full trust" will breeze past this; so to check for abuse via reflection you would probably have to check the caller manually () - which is painful and still not 100% robust
p28193
aVThere is specific file/IO permissions, but again full trust will ignore it
p28194
aVI think "no" is a safer answer
p28195
as(dp28196
g18
V23354
p28197
stp28198
a((dp28199
g2
(lp28200
VBecause you are increasing the line index () by 2 each time; just use :
p28201
aVOf course, from a loop this will result in just the last line being shown
p28202
aVWhat line is it you actually want to show
p28203
aVEdit re comment; in which case, simply:
p28204
as(dp28205
g18
V23354
p28206
stp28207
a((dp28208
g2
(lp28209
VHow about hooking into
p28210
aVAs a basic example, this seems to work (with a  on a ):
p28211
as(dp28212
g18
V23354
p28213
stp28214
a((dp28215
g2
(lp28216
VWhat do you want to output
p28217
aVhtml or xhtml
p28218
aVYou always write the xslt as valid xml:
p28219
aVor
p28220
aVBut you use the  to control it; if you want html (i
p28221
ag50
aV) then you would use:
p28222
aV(note no "x" in the above) - or:
p28223
aVAFAIK, "xhtml" is not a valid option for , since it is already covered by "xml"
p28224
aVYou should also note the subtle default behaviour if you don't specify an  depends on the top element (i
p28225
ag50
aVwhether it starts  or not)
p28226
as(dp28227
g18
V23354
p28228
stp28229
a((dp28230
g2
(lp28231
VThe  statement will look at the final type of the expression - i
p28232
ag50
aVwhatever is returned from ; if this returns something that is , then you're OK
p28233
aVThe compiler will tell you if you get it wrong ;-p (it won't let you use  on something that isn't )
p28234
aVYou should probably watch out for where you are creating two connections:
p28235
aVand possibly:
p28236
as(dp28237
g18
V23354
p28238
stp28239
a((dp28240
g2
(lp28241
VI wonder if it wouldn't be better to use an "INSTEAD OF" trigger (delete) on the table
p28242
aVor just don't lie to LINQ: if you want to do an UPDATE (not a DELETE), then update the object (don't delete it)
p28243
aVFor example, write a method on the data-context that simulates delete, rather than using
p28244
aVYou may also be able to do something with overriding SubmitChanges and investigating the deltas, but I'm not sure it is a good idea
p28245
as(dp28246
g18
V23354
p28247
stp28248
a((dp28249
g2
(lp28250
VYou have a few options; for example, you could use  or  to fetch the data eagerly - however, the optimal approach depends on how you are using it
p28251
aVFor example, you could write a "users with active membership" query (either in LINQ using , or with a SPROC/UDF)
p28252
aVThat would then be 1 round trip, but is arguably less object-centric (and more query centric)
p28253
aVWhich might be fine
p28254
as(dp28255
g18
V23354
p28256
stp28257
a((dp28258
g2
(lp28259
VHow about a Regex and MatchEvaluator
p28260
aVLike so:
p28261
as(dp28262
g18
V23354
p28263
stp28264
a((dp28265
g2
(lp28266
VWhat exactly is it you want to refactor
p28267
aVReSharper is probably the best known tool for large scale refactorings
p28268
aVbut whether it is appropriate depends on what you want to do
p28269
aVYou could always download the trial and give it a whirl
p28270
as(dp28271
g18
V23354
p28272
stp28273
a((dp28274
g2
(lp28275
VYou should try to avoid enumerating it more times than necessary (even if short-circuited, like  and ) - how about:
p28276
aVThis works well with classes (since you can just compare the reference to null)
p28277
as(dp28278
g18
V23354
p28279
stp28280
a((dp28281
g2
(lp28282
VPresumably, by iterating them
p28283
as(dp28284
g18
V23354
p28285
stp28286
a((dp28287
g2
(lp28288
VDoes the container need to know about the type of the contents
p28289
aVIf not, generics can avoid this - i
p28290
ag50
aV, where you happen to use
p28291
aVOther than that; pushing the necessary details into an interface (or base-class) in an assembly that both can reference is a common approach
p28292
aVPersonally, I'd try to simply avoid the need for the child to know about the parent
p28293
aVAlso; note that if you do go down the abstraction (interface etc) route; this can have a big implication if you are using (for example) xml serialization
p28294
aV(edit re comments)
p28295
aVOK; first: what problem is the circular reference (within an assembly) causing; if none, leave it alone
p28296
aVIf there is a problem, then you'll need an extra type; presumably some interfaces to represent the concrete types - i
p28297
ag50
aVwhere , and  only knows about  (or vv with , or both),
p28298
as(dp28299
g18
V23354
p28300
stp28301
a((dp28302
g2
(lp28303
VI would deploy it as a ClickOnce app ("Publish" in VS2008 etc)
p28304
aVClickOnce can be located on a network share - you just run the
p28305
aVapplication instead of the
p28306
aVexe; this then works with none of the security issues with running it directly, and it'll work all the way back to
p28307
aVNET 2
p28308
ag190
as(dp28309
g18
V23354
p28310
stp28311
a((dp28312
g2
(lp28313
VWithout access to the type (and no "InternalsVisibleTo" etc) you would have to use reflection
p28314
aVBut a better question would be: should you be accessing this data
p28315
aVIt isn't part of the public type contract
p28316
aVit sounds to me like it is intended to be treated as an opaque object (for their purposes, not yours)
p28317
aVYou've described it as a public instance field; to get this via reflection:
p28318
aVIf it is actually a property (not a field):
p28319
aVIf it is non-public, you'll need to use the  overload of /
p28320
aVImportant aside: be careful with reflection like this; the implementation could change in the next version (breaking your code), or it could be obfuscated (breaking your code), or you might not have enough "trust" (breaking your code)
p28321
aVAre you spotting the pattern
p28322
as(dp28323
g18
V23354
p28324
stp28325
a((dp28326
g2
(lp28327
VIt'll be more that 16 bytes, since it needs to store the keys too
p28328
aVYou could serialize the ticks yourself (directly)
p28329
aVAlternatively; I haven't tested it in this scenario, but you might give protobuf-net a whirl (it is a high performance binary serialization engine)
p28330
as(dp28331
g18
V23354
p28332
stp28333
a((dp28334
g2
(lp28335
V(disclosure: I'm the author of protobuf-net)
p28336
aVis a metadata-based serializer; i
p28337
ag50
aVit sends
p28338
aVNET type information about every object serialized
p28339
aVprotobuf-net is a contract-based serializer (the binary equivalent of  / , which will also reject this)
p28340
aVThere is no current mechanism for transporting arbitrary objects, since the other end will have no way of knowing what you are sending; however, if you have a known set of different object types you want to send, there may be options
p28341
aVThere is also work in the pipeline to allow runtime-extensible schemas (rather than just attributes, which are fixed at build) - but this is far from complete
p28342
aVThis isn't ideal, but it works
p28343
aVit should be easier when I've completed the work to support runtime schemas:
p28344
as(dp28345
g18
V23354
p28346
stp28347
a((dp28348
g2
(lp28349
VIf the OR Mapper is actually doing OR, then it probably doesn't need a reference to the BL -  it just needs to know the (s) that is (are) involved
p28350
aVBut that is a side issue
p28351
aVThe main answer to this type of issue is "Inversion of Control" / "Dependency Injection", presumably snipping everything under the BL - so the BL depends only on an interface (defined in a base assembly), but doesn't know about the concrete OR/DA/RDBMS (they are supplied by the IoC/DI)
p28352
aVThis is a big topic, so I'm being intentionally vague
p28353
aVPersonally I like StructureMap, but there are lots of IoC/DI tools available
p28354
aVNote that technically it is possible to create circular assembly references; it is a really bad idea, though - and the tools will (intentionally) fight you at every step
p28355
as(dp28356
g18
V23354
p28357
stp28358
a((dp28359
g2
(lp28360
VThe overall page cycle is complex - but for serving images, you may want to look primarily at the  interface - or (more simply) create a "generic handler" (
p28361
aVashx file)
p28362
aVThe  is the simplest "request/response" setup, without the burden of
p28363
aVaspx pages; you simply read from the context
p28364
aVRequest, and write to the context
p28365
aVResponse
p28366
as(dp28367
g18
V23354
p28368
stp28369
a((dp28370
g2
(lp28371
VActually, events can have return values; simply, it isn't a good idea as it requires more complex processing when there may be multiple listeners
p28372
aVmore commonly, there might be a settable property an an  subclass
p28373
aVBut here's an example of using return values with events; this is not usually a good idea; for information only:
p28374
as(dp28375
g18
V23354
p28376
stp28377
a((dp28378
g2
(lp28379
VUnder the bonnet, there is no difference in a winform vs console exe except for a flag in the PE-header that says "I need a console"
p28380
aVThe PE header is not controlled from your C# (since it is a compile thing, not a runtime thing), so this is defined in the project file instead ()
p28381
aVOr at the command-line ( vs )
p28382
aVArguably, they could have used an assembly-level attribute that the compiler intercepted - but would that really have helped
p28383
aVProbably not
p28384
as(dp28385
g18
V23354
p28386
stp28387
a((dp28388
g2
(lp28389
VThe use of 3 bytes to define the long seems unusual; if it is just the 3 bytes
p28390
aVwhy a long
p28391
aVwhy not an int
p28392
aVFor example (note I've had to make assumptions about your byte-trimming based on your example - you won't have the full / range
p28393
ag6864
as(dp28394
g18
V23354
p28395
stp28396
a((dp28397
g2
(lp28398
VYou want:
p28399
as(dp28400
g18
V23354
p28401
stp28402
a((dp28403
g2
(lp28404
VTo use routes in IIS 6 you probably need a wildcard mapping in IIS; along the same lines as this (for ASP
p28405
aVNET MVC, but the same concept) - although to be honest, I'd expect a 4xx for a file not found
p28406
aV500 typically indicates a more serious problem - for example, the app-pool identity isn't configured correctly and can't execute as a service
p28407
aVCheck the event log on the server for messages
p28408
aVAs an aside; always try to develop on something as close to the actual hosting platform as you can
p28409
aVFor example, I run a Win2003 server in a VM for hosting IIS6
p28410
aVThis saves a lot of unexpected surprises when you come to deploy
p28411
as(dp28412
g18
V23354
p28413
stp28414
a((dp28415
g2
(lp28416
VRecursive works for both files and folders (oddly, I thought it didn't work for files; my bad
p28417
ag6864
as(dp28418
g18
V23354
p28419
stp28420
a((dp28421
g2
(lp28422
VIn most cases, you aren't likely to see a huge benefit from this, especially if you keep the app open for a while
p28423
aVPre-generating a serialization assembly mainly helps the first time (in an exe lifetime) that you serialize a specific type as xml
p28424
as(dp28425
g18
V23354
p28426
stp28427
a((dp28428
g2
(lp28429
VIf you only ever add/remove from the start or end you might be able to cheat - but in general; yes: the implication is that you need to create a new collection for every change
p28430
aVSo: do you need to (effectively) mutate collections
p28431
aVIf so, and given their size: I'd be tempted to look at synchronizing access (rather than making them properly immutable)
p28432
aVLook at  (aka )
p28433
as(dp28434
g18
V23354
p28435
stp28436
a((dp28437
g2
(lp28438
VMy expectation is that F# will be used for pieces of some specialized systems - the bits that involve complex threading / maths / financial / modelling / etc, where F# does well
p28439
aVFor most other areas (UI, DAL, etc), a general purpose language like C# seems (IMO) preferable
p28440
aVOne of the advantages of the F# is that (in theory) you can prove code is working, rather than just test it
p28441
aVThe threading support (thanks to immutability and the async
p28442
aVusage) is also good (although PLINQ may compete on threading)
p28443
aVHooking into
p28444
aVNET to allow proper integration between F#, C#, VB, IronPython, IronRuby, etc - really shows the strengths of each
p28445
aVToday if I was doing lots of COM interop, I'd consider VB (that'll change in 4
p28446
aV0 with ); for most code - C#
p28447
aVFor math etc, F#
p28448
aVTidy
p28449
as(dp28450
g18
V23354
p28451
stp28452
a((dp28453
g2
(lp28454
VIs
p28455
aVNET 3
p28456
aV5 an option
p28457
aVor with :
p28458
as(dp28459
g18
V23354
p28460
stp28461
a((dp28462
g2
(lp28463
VFor non-distinct,
p28464
as(dp28465
g18
V23354
p28466
stp28467
a((dp28468
g2
(lp28469
VA common issue with high isolation is lock escalation deadlocks due the the following scenario; i
p28470
ag50
aV(where X is any resource, such as a row)
p28471
aVSPID a reads X - gets a read lock
p28472
aVSPID b reads X - gets a read lock
p28473
aVSPID a attempts to update X - blocked by b's read lock, so has to wait
p28474
aVSPID b attempts to update X - blocked by a's read lock, so has to wait
p28475
aVDeadlock
p28476
aVThis scenario can be avoided by taking more locks:
p28477
aVSPID a reads X with  specified - gets an exclusive lock
p28478
aVSPID b attempts to reads X - blocked by a's exclusive lock, so has to wait
p28479
aVSPID a attempts to update X - fine
p28480
aV(SPID a commits/rolls-back, and releases the lock at some point)
p28481
aV(SPID b does whatever it wanted to do)
p28482
as(dp28483
g18
V23354
p28484
stp28485
a((dp28486
g2
(lp28487
VNote that in
p28488
aVNET 4
p28489
aV0 there are (supposedly) iterator-based (rather than array-based) file functions built in:
p28490
aVAt the moment I'd use something like below; the inbuilt recursive method breaks too easily if you don't have access to a single sub-dir
p28491
aV; the  usage avoids too much call-stack recursion, and the iterator block avoids us having a huge array
p28492
as(dp28493
g18
V23354
p28494
stp28495
a((dp28496
g2
(lp28497
VI assume you mean ; it depends ;-p
p28498
aVThe purpose of serialization is to express a complex in-memory object as a simple sequence of bytes (or depending on the serializer - characters, etc) that can be re-hydrated at the other end to re-create the object
p28499
aVSome types (primitives, strings, etc) have inbuilt direct support by the serializer - it writes these directly
p28500
aVIn the case of classes, the type metadata (incuding assembly name etc) is written, then all of the fields on the type are enumerated (essentially, , including private etc)
p28501
aVFor every field (not marked ), the field name is written, and the value is serialized (through the same process)
p28502
aVEventually, everything boils down to the inbuilt primitives, some type definitions, and some name/value field pairs
p28503
aVAn exception here is if the type implements  - in which case the type is asked to serialize itself to the output
p28504
aVThis is common in things like dictionary types, where the in-memory layout of the type can be expressed differently to a stream
p28505
aVDuring deserialization the process is reversed; the type-metadata is used to create an empty object (unless it has a special serialization constructor/); then the fields are set as they are found in the stream
p28506
aVIn both serialization and deserialization there are "callback" points where you can execute additional code to fix-up objects for (de)serialization
p28507
aVThis process is brittle; for lots of reasons, see here - but it is also version intolerant and implementation specific (you can't consume it from java etc)
p28508
aVprotobuf-net solves a lot of these problems, by being a binary serializer that is contract-based, rather than field-based
p28509
as(dp28510
g18
V23354
p28511
stp28512
a((dp28513
g2
(lp28514
V is, at the best of times, very brittle if you change things
p28515
aVNot least, there are huge problems with automatically implemented properties, obfuscaction, renaming, strong naming, etc
p28516
aVAs I recall, some of the rules about  changed just before it was released; the version tolerant thing didn't really work out as easily as had been planned, I expect
p28517
aVMy advice: if you want version tolerant serialization (i
p28518
ag50
aVyou can serialize it today and deserialize it with the next version of your app), then don't use ; this is (IMO) only suitable for passing data between the same version (remoting, s, etc)
p28519
aVFor work between versions, I recommend contract-based serialization; things like  and  (
p28520
aVNET 3
p28521
aV0), or for binary - protobuf-net or similar tools
p28522
aVAll of these are much better at version tolerance (indeed, you don't even need to deserialize it into the same ); plus they can be used between platforms - so you can serialize in
p28523
aVNET and deserialize in java/C++/etc
p28524
as(dp28525
g18
V23354
p28526
stp28527
a((dp28528
g2
(lp28529
VI wonder why you don't just use SQL Server Express Edition instead - a far more scaleable engine, but still free
p28530
aV(edit)
p28531
aVAs an added bonus; when your site "takes off" and you need more grunt (bigger, more CPUs, more memory, more failover, clustering, etc), you just buy a bigger box and a SQL Server license and you're set to go; you don't have that luxury with mdb
p28532
as(dp28533
g18
V23354
p28534
stp28535
a((dp28536
g2
(lp28537
VOne thing to watch with MSTest (from the IDE at least); it doesn't run the tests in the regular output (bin) folder, and it doesn't respect the project's file inclusions ("Copy to Output Directory")
p28538
aVYou often need to explicitly tell it (MSTest) which files to put into the test area
p28539
aVYou will need to include the "app
p28540
aVconfig" in this list; either via the testrunconfig ("Deployment"), or by adding an attribute () to the affected test fixtures
p28541
as(dp28542
g18
V23354
p28543
stp28544
a((dp28545
g2
(lp28546
VI probably wouldn't use AOP here
p28547
aVmy question is: when are you doing this appending
p28548
aVI would simply hook into a utility method at that point - i
p28549
ag50
aVwhere  has the burden of checking this flag - i
p28550
ag50
aVit isn't in a lot of places
p28551
aVYou might also find that C# 3
p28552
aV0 extension methods have a role to play; for example, if you are writing to a :
p28553
aVthen your code just (always) calls  - job done
p28554
aVI would probably also ensure I minimise impact by storing this value once at init - static constructors are quite handy for that:
p28555
aVPerhaps with more context on what and where you are currently doing this it might become clearer
p28556
as(dp28557
g18
V23354
p28558
stp28559
a((dp28560
g2
(lp28561
VI'm assuming the different parts of the query are only known at runtime, i
p28562
ag50
aVyou can't just use  in a
p28563
aVOne lazy option is  - but this tends to lead to poor TSQL etc; however, I tend to be inclined to write custom s instead
p28564
aVThe approach to take depends on what the provider is, as LINQ-to-SQL supports different options to EF (for example) - which has a genuine impact here (since you can't use sub-expressions with EF)
p28565
aVCan you tell us which
p28566
aVHere's some code that should work with LINQ-to-SQL; if you build an array (or list, and call ) of expressions, it should work fine; example is LINQ-to-Objects, but should still work:
p28567
as(dp28568
g18
V23354
p28569
stp28570
a((dp28571
g2
(lp28572
VThat is just the way it works
p28573
aVyou can only add columns to the end, unless you  it and  it (normally copying the data out and back in, which the IDE might help with)
p28574
aVBut why do you want to change the order
p28575
aVEven if it isn't ideal, your  etc can handle this
p28576
ag412
ag50
aV(it is rarely a good idea to just use )
p28577
aVRe the ; again, this is fundamental to the column - although in this case you could copy the data out,  the column, and re- the column as  (on the right hand side), and copy it back in - but then you have extra complications with  and the  value (so you don't try to get duplicates of existing identity values)
p28578
as(dp28579
g18
V23354
p28580
stp28581
a((dp28582
g2
(lp28583
VShort term, I'd use things like jQuery to hide the browser incompatibilities
p28584
aVLong term, technologies like Silverlight or Adobe AIR may make this a very different minefield (but still a minefield) in the future
p28585
as(dp28586
g18
V23354
p28587
stp28588
a((dp28589
g2
(lp28590
VDoes it have to be a SOAP interface
p28591
aVThat sounds like it might be more suitable to a route/REST/etc based API
p28592
aVYou could do something in ASP
p28593
aVNET MVC (with a custom  method that resolves the action to the method) pretty easily (in fact, I'm working on something very similar for some of my own code at the moment)
p28594
aVFor example, you might have routes:
p28595
aVthat accepts (either in the body or args) the payload (parameters), and returns the result in the response
p28596
aVIn non-MVC you should be able to do something similar with a wildcard-mapped generic handler
p28597
as(dp28598
g18
V23354
p28599
stp28600
a((dp28601
g2
(lp28602
VThat sounds realistic; you are introducing more complexity (more lookups etc, more virtual methods, more range checks), so it can only get slower (array access is very direct and very quick)
p28603
aVIt looks like you can get it a bit quicker (but not as quick as the array) by implementing an  instead of the delegate approach; (edit) and faster again using :
p28604
aVWith code:
p28605
as(dp28606
g18
V23354
p28607
stp28608
a((dp28609
g2
(lp28610
VIt is a pain, although in some ways you might anticipate it
p28611
aVif you go into an open dialog multiple times (in an app) you often find it where you last left it
p28612
aVIf it impacts your code, you could take a snapshot of  before going into the dialog, and restore it afterwards (so your code doesn't see the change)
p28613
aVYou might want to store the user's working directory separately (and swap them) so that the user also gets their expected behaviour
p28614
as(dp28615
g18
V23354
p28616
stp28617
a((dp28618
g2
(lp28619
VThere are two ways of looking at this; the first is via an  with separate trust, which jrista has given a good answer about
p28620
aVThe second is: don't compile arbitrary/user code ;-p Depending on the scenario, you may be able to construct a DSL with access to only the functionality you are happy to expose, and compile that
p28621
aVI've used this approach successfully a number of times
p28622
aVThis creates a very controlled sandbox - the only thing to watch is things like infinite loops, but even that is fixable if you really need
p28623
aVSo I guess the real question is: does the input have to be C#
p28624
aVOr is that just a convenience
p28625
as(dp28626
g18
V23354
p28627
stp28628
a((dp28629
g2
(lp28630
VYes,  can display things other than just the compile-time properties, by using any of ,  or  to provide runtime pseudo-properties
p28631
aVCan you give an example of what your parameters look like
p28632
aVI should be able to provide an example
p28633
aVhere's a basic example (everything is , etc) based on an earlier reply (related but different):
p28634
as(dp28635
g18
V23354
p28636
stp28637
a((dp28638
g2
(lp28639
V(I don't fully understand how the first two examples relate to the third
p28640
aVthey don't seem to share anything in common)
p28641
aVSo what currently breaks
p28642
aVThe biggest issue I can see is that (IIRC) to be reliably usable with  (with different back end implementations) the item must be serializable (var ), but that may be as simple as marking  with
p28643
aVFor info  is a confusing name for something that is a row entity, not the actual collection - and if you have C# 3
p28644
aV0 you could simplify things a bit with automattically implemented properties:
p28645
aVHowever; it isn't clear (from your code) whether this will change anything
p28646
aVPlease can you clarify what is currently happening
p28647
as(dp28648
g18
V23354
p28649
stp28650
a((dp28651
g2
(lp28652
VI can't comment on C++, but from other platforms - yes, this can make a big difference; particularly in the amount of switches the code needs to do, and the number of times it needs to worry about the async nature of streams etc
p28653
aVBut the real test is, of course, to profile it
p28654
aVWhy not write a basic app that churns through an arbitrary file using both approaches, and test it for some typical files
p28655
aVthe effect is usually startling, if the code is IO bound
p28656
aVIf the files are small and most of your app runtime is spent processing the data once it is in memory, you aren't likely to notice any difference
p28657
as(dp28658
g18
V23354
p28659
stp28660
a((dp28661
g2
(lp28662
VYou can't jump directly to a line in a text file unless every line is fixed width and you are using a fixed-width encoding (i
p28663
ag50
aVnot UTF-8 - which is one of the most common now)
p28664
aVThe only way to do it is to read lines and discard the ones you don't want
p28665
aVAlternatively, you might put an index at the top of the file (or in an external file) that tells it (for example) that line 1000 starts at byte offset [x], line 2000 starts at byte offset [y] etc
p28666
aVThen use  or  on the  to move to the nearest indexed point, and walk forwards
p28667
aVAssuming the simplest approach (no index), the code in Jon's example should work fine
p28668
aVIf you don't want LINQ, you can knock up something similar in
p28669
aVNET 2
p28670
aV0 + C# 2
p28671
aV0:
p28672
aVIf you need to test values of the line (rather than just line index), then that is easy enough to do too; just tweak the iterator block
p28673
as(dp28674
g18
V23354
p28675
stp28676
a((dp28677
g2
(lp28678
VOne other difference; id-selectors are more specific than class-selectors, so I believe they will "trump" any other selector that exists
p28679
aVYou can use "important" to do the same thing, but and id selector may be easier
p28680
aVBut id-selectors should be used sparingly
p28681
as(dp28682
g18
V23354
p28683
stp28684
a((dp28685
g2
(lp28686
VWhat is the life-cycle of the data-context
p28687
aVIs it the same data-context, or a new one each time
p28688
aV(it should probably be the latter)
p28689
aVIf you re-use a data-context, it is obliged to always give you back the same object when ever it seems the same identity
p28690
aVSo if it has previously given you the version with 9, it'll keep giving you back that reference even when the underlying data changes
p28691
aVAt the moment, this still does a round-trip; to avoid the round-trip, you need to use:
p28692
ag412
ag50
aVif it already has the object with  in the local identity cache, it won't perform a databae query at all
p28693
aVany other construct will do a round trip
p28694
aVThere is a fix in 4
p28695
aV0 so that  will avoid the round-trip, which should have with query syntax, i
p28696
ag50
as(dp28697
g18
V23354
p28698
stp28699
a((dp28700
g2
(lp28701
VSee also: What C# 4
p28702
aV0 covariance doesn't do
p28703
as(dp28704
g18
V23354
p28705
stp28706
a((dp28707
g2
(lp28708
VThe main difference between calling it directly (which is short-hand for ) and using  is performance; a factor of more than *700 by my measure (below)
p28709
aVWith the direct/ approach, the arguments are already pre-validated via the method signature, and the code already exists to pass those into the method directly (I would say "as IL", but I seem to recall that the runtime provides this directly, without any IL)
p28710
aVWith  it needs to check them from the array via reflection (i
p28711
ag50
aVare they all appropriate for this call; do they need unboxing, etc); this is slow (if you are using it in a tight loop), and should be avoided where possible
p28712
aVExample; results first (I increased the  count from the previous edit, to give a sensible comparison):
p28713
aVWith code:
p28714
as(dp28715
g18
V23354
p28716
stp28717
a((dp28718
g2
(lp28719
VWhat type of service is it
p28720
aVThese days, I'd write it as WCF, and use any of the the regular identity models to authenticate (I generally use TransportWithMessageCredential - i
p28721
ag50
aVSSL with a username/password in the body)
p28722
aVThen you can just check the identity via the  ()
p28723
aVFor SOAP services, you can use SOAP headers for authentication, or you can include identity information as method arguments - either a username/password pair, or a separate identity token that you can parse to get the identity
p28724
aVIn any case, you should only pass identity information "as is" over a secure transport like SSL
p28725
aVThere are other techniques that don't require passing the password, but they are more complex (especially if multiple domains etc are involved); kerberos or federated security are options
p28726
aVPersonally, I keep it simple, as not all clients can use federation etc - but most clients can pass a username/password pair over SSL
p28727
as(dp28728
g18
V23354
p28729
stp28730
a((dp28731
g2
(lp28732
VA common variant of base-64 (for use on query-string) is to use '-' and '_' in place of '+' and '/'
p28733
aVPerhaps a bit of  at each end would do the job
p28734
as(dp28735
g18
V23354
p28736
stp28737
a((dp28738
g2
(lp28739
VFor the first - just use  and
p28740
aVOn the 2nd - what do you mean by "lowest subclass type"; or: what answer do you expect
p28741
aV(which might help us understand what you mean
p28742
as(dp28743
g18
V23354
p28744
stp28745
a((dp28746
g2
(lp28747
VAn interface offers the most abstraction; you aren't tied to any specific implementation (useful if the implementation must, for other reasons, have a different base class)
p28748
aVFor true polymorphism,  is a must; polymorphism is most commonly associated with type subclassing
p28749
aVYou can of course mix the two:
p28750
aVis a separate matter; the choice of  is really: can it be sensibly defined by the base-class
p28751
aVIf there is there no default implementation, it must be
p28752
aVA common base-class can be useful when there is a lot of implementation details that are common, and it would be pointless to duplicate purely by interface; but interestingly - if the implementation will never vary per implementation, extension methods provide a useful way of exposing this on an  (so that each implementation doesn't have to do it):
p28753
as(dp28754
g18
V23354
p28755
stp28756
a((dp28757
g2
(lp28758
VI'm not sure there is enough there for a complete analysis
p28759
aVI'm assuming we are talking about / here (not )
p28760
aVIf the generated TSQL is similar, then the results should be comparable
p28761
aVThere are a few caveats to this - for example, is the query column a calculated+persisted value
p28762
aVIf so, the  options must be exact matches for it to be usable "as is" (otherwise it has to re-calculate per row)
p28763
aVSo: what is the TSQL from the SP and LINQ
p28764
aVAre they directly comparable
p28765
aVYou mention a  - I'm guessing this could make a big difference if (for example) it filters out data (either via a  or an )
p28766
aVAlso -  clauses starting  are rarely a good idea - not least, it can't make effective use of any index
p28767
aVYou might have better performance using "full text search"; but this isn't directly available via LINQ, so you'll have to wrap it in an SP and expose the SP via the LINQ data-context (just drag the SP into the designer)
p28768
aVMy money is on the  (and the other code in the SP) being the main difference here
p28769
as(dp28770
g18
V23354
p28771
stp28772
a((dp28773
g2
(lp28774
VWhat handle are you trying to close
p28775
aVI can't see anything that allocates a handle
p28776
aVAlso - in many cases you can use  to make this simpler - I can't tell whether this applies in your case, since I can't see what is going on
p28777
as(dp28778
g18
V23354
p28779
stp28780
a((dp28781
g2
(lp28782
VTo minimise the duration of the transaction, I always do this by bulk-copying to a staging table (same schema, but different name - no indexes etc), and then once all the data is at the server, do something like:
p28783
aV(the transaction could be either in the TSQL or on the connection via managed code, or via ; the TSQL could be either as command-text, or as a SPROC)
p28784
as(dp28785
g18
V23354
p28786
stp28787
a((dp28788
g2
(lp28789
VIt looks to me simply that you've set the data-type of the columns in the  incorrectly
p28790
aVTry making it explicit as an  (it looks like  at the moment)
p28791
aVAlso - the job of the  is to hold data; not to disply it
p28792
aVYou could store it pre-formatted as s, I guess (as long as you tell it that the columns are strings) - but if you are storing it as , then forget the display; as soon as you have run  your job is over
p28793
aVHow it appears is the job of the  (or whatever); tell that about "N0"
p28794
as(dp28795
g18
V23354
p28796
stp28797
a((dp28798
g2
(lp28799
VEither:
p28800
aVtake the column "as is" from the server and do the concat in C#
p28801
aVwrite an SP that does it, and call the SP via LINQ
p28802
aVThe SP (accepting @UserID) can do this like so:
p28803
as(dp28804
g18
V23354
p28805
stp28806
a((dp28807
g2
(lp28808
VActually, not an "action" method, but a custom controller that implements a route-base RPC implementation
p28809
aVIt identifies the contract and method from the route-data and passes the call onto the server-side service implementation
p28810
aVPretty efficient (and yes, there are valid reasons that I'm not just using WCF or SOAP)
p28811
as(dp28812
g18
V23354
p28813
stp28814
a((dp28815
g2
(lp28816
VProbably a silly question, but have you configured the proxy (if you need one)
p28817
aVIt doesn't use the IE settings, but is on the TortoiseSVN -> Settings -> Network page
p28818
aV(sorry if you've thought of this, but the question didn't state)
p28819
as(dp28820
g18
V23354
p28821
stp28822
a((dp28823
g2
(lp28824
VHave you enabled "Log on as a service" for the account
p28825
aVStart -> Control Panel -> Administrative Tools -> Local Security Policy -> Local Policies -> User Rights Assignment -> Log on as a service
p28826
aV(make sure your account is in this list directly or indirectly; it has also been suggested that you should set: Access this computer from the network; Deny logon locally; Log on as a batch job)
p28827
aVAlso - ensure that the account has "Read & Execute", "List Folder Contents" and "Read" access to the file system that underpins the web site/application
p28828
as(dp28829
g18
V23354
p28830
stp28831
a((dp28832
g2
(lp28833
VI wonder if you can't swap the serializer by adding a behaviour attribute at each end
p28834
aVgiven an /, the approach of:
p28835
aVand
p28836
aVseems to work (i
p28837
ag50
aVextended properties are respected), so you should be able to write a behaviour that detects  and swaps to a custom serializer - like this (attribute | behaviour | serializer) - but probably simpler
p28838
aVI can take a look later if that isn't enough to get started
p28839
as(dp28840
g18
V23354
p28841
stp28842
a((dp28843
g2
(lp28844
V1: in theory it should work if the user has regular
p28845
aVNET 3
p28846
aV5SP1 installed (since client-profile is 3
p28847
aV5SP1 specific IIRC)
p28848
aV2: I would expect that you get some very funky "can't run that" message (error) boxes
p28849
aVI would spin up an x64 VM and test it, but I'm on my laptop at the moment and it won't do that (no VT)
p28850
as(dp28851
g18
V23354
p28852
stp28853
a((dp28854
g2
(lp28855
VData-binding to lists follows the following strategy:
p28856
aVdoes the data-source implement
p28857
aVif so, goto 2 with the result of
p28858
aVdoes the data-source implement
p28859
aVif not, throw an error; list expected
p28860
aVdoes the data-source implement
p28861
aVif so use this for metadata (exit)
p28862
aVdoes the data-source have a non-object indexer,  (for some )
p28863
aVif so, use  for metadata
p28864
aVis there anything in the list
p28865
aVif so, use the first item () for metadata
p28866
aVno metadata available
p28867
aVfalls into "4" above, since it has a typed indexer of type  - and so it will get the metadata via
p28868
aVSo now, you have three options:
p28869
aVwrite a  that returns the properties for  - I'm not sure this is feasible since you can't possibly know what the concrete type is given just
p28870
aVuse the correctly typed list ( etc) - simply as a simple way of getting an  with a non-object indexer
p28871
aVwrite an  wrapper (lots of work)
p28872
aVuse something like  (i
p28873
ag50
aVno public non-object indexer) - very hacky
p28874
aVMy preference is for using the correct type of
p28875
aVhere's an  method that does this for you without having to know the types (with sample usage);
p28876
aVNote that this only works for homogeneous data (i
p28877
ag50
aVall the objects are the same), and it requires at least one object in the list to infer the type
p28878
as(dp28879
g18
V23354
p28880
stp28881
a((dp28882
g2
(lp28883
VLets take that piece by piece:
p28884
aVThere is no inbuilt  function; note that with the  class, the end value is exclusive, so for a number in a range, you'll need something like:
p28885
aVHowever, you then throw away this value completely:
p28886
aVThe use of  means that the previous value of  is ignored completely
p28887
aVI'm not sure what your intent is, but it seems like you just want to check the value:
p28888
aVI've tried to look at the last example, but it really isn't clear what you are trying to do - can you clarify
p28889
aV(edited after question edit and comments)
p28890
aVYou would need a counter, which you increment for failed tries - something like:
p28891
as(dp28892
g18
V23354
p28893
stp28894
a((dp28895
g2
(lp28896
VHmmm
p28897
aVI'm honestly not aware of obfuscation issues with enums; I will have to prepare a test case to investigate
p28898
aVIt would help if you could tell me what obfuscation tool you are using
p28899
aVIt would also help to see how you are specifying the default value (i
p28900
ag50
aVthe property definition)
p28901
aVNote that it only really considers  in the case of enums (the  can be used to give it a name, but this isn't used unless you are generating
p28902
aVproto files, which is very unlikely) - but I don't expect it to impact anything in this case (this is used to change the value "on the wire" to different values than are in
p28903
aVNET)
p28904
aVAs for examples; I confess I'm behind on the documentation - but the enum test cases here show typical usage
p28905
aVI've logged this as Issue 59; if you could let me know the details above (either here, or e-mail me - see my profile), I'll try to investigate
p28906
aV(if you didn't know, I'm the author of protobuf-net)
p28907
aVI tried the following (using
p28908
aVNET Reactor) and it worked fine
p28909
aVthe implicit default of zero on enum values is the most likely suspect
p28910
aVCan you supply a test-case that shows it failing
p28911
as(dp28912
g18
V23354
p28913
stp28914
a((dp28915
g2
(lp28916
VWith LINQ:
p28917
aV(and yes,  is )
p28918
aVedit to show the pain in VS2005:
p28919
aVwhere you have (in ):
p28920
as(dp28921
g18
V23354
p28922
stp28923
a((dp28924
g2
(lp28925
VIf you are using the VS tools, then the config files are all part of the signed portion of the deployment
p28926
aVAs such, the best way to do this is via your build tools - i
p28927
ag50
aVbuild a different version with dev/live/etc config files
p28928
aVWith 3
p28929
aV5SP1 you can opt out of the signing; I don't know if you can do this via the IDE - presumably you can do it if you do it manually (via mage), but this is a lot more work
p28930
as(dp28931
g18
V23354
p28932
stp28933
a((dp28934
g2
(lp28935
VI haven't seen a way to do this with regular , but if you don't mind paying, Visualhint have a much more developed offering here - perhaps trial it
p28936
aVThis does the job using reflection; use with caution
p28937
as(dp28938
g18
V23354
p28939
stp28940
a((dp28941
g2
(lp28942
VIf there isn't anything obvious available, perhaps just loop:
p28943
aVIf this is a class property, it would be trivial to create a  that does this (for display purposes), and mark the property with :
p28944
as(dp28945
g18
V23354
p28946
stp28947
a((dp28948
g2
(lp28949
VFirst/Take/etc; in EF, it requires (IIRC) an order; LINQ-to-SQL will accept these for an unordered query
p28950
aVSub-expression evaluation; if you have rolled a custom  (for example, predicate) using , it won't work; EF doesn't support sub-expression use (LINQ-to-SQL does)
p28951
aVSerialization; very, very different
p28952
aVAssociation loading; requires explicit Load in EF
p28953
aVUDF support (composable at the database)
p28954
as(dp28955
g18
V23354
p28956
stp28957
a((dp28958
g2
(lp28959
VI got it working with something like:
p28960
aVHaving added suitable constructors:
p28961
aVany use
p28962
as(dp28963
g18
V23354
p28964
stp28965
a((dp28966
g2
(lp28967
VSomething like:
p28968
as(dp28969
g18
V23354
p28970
stp28971
a((dp28972
g2
(lp28973
VYou can't do it per-query; but you can per-data-context
p28974
aVJust pass in a different connection or connection-string to the constructor:
p28975
as(dp28976
g18
V23354
p28977
stp28978
a((dp28979
g2
(lp28980
VThe first problem is that  doesn't exist - you'd need to code to , , ,  separately
p28981
aVNow; I understand the code, but I'm not sure what the scenario is that you are trying to solve
p28982
aVcan you clarify
p28983
aVThere are probably better options
p28984
aVIf it is as complex as it sounds, a custom  is probably the most appropriate option (far simpler than )
p28985
aVThis works, for example
p28986
as(dp28987
g18
V23354
p28988
stp28989
a((dp28990
g2
(lp28991
VThere aren't usually any technical reasons; perhaps if you are using something "new"
p28992
aVhave you checked that the dll is targetting the correct version of the framework
p28993
aVThere are, however, good architectural reasons not to do so
p28994
aVit is generally a lot cleaner to abstract such things, so that code never calls "up" the stack
p28995
aVonly down
p28996
aVPerhaps pass in an interface that exposes this (which the UI project implements)
p28997
as(dp28998
g18
V23354
p28999
stp29000
a((dp29001
g2
(lp29002
VAlmost certainly not
p29003
aVA stack overflow (rather than an out of memory) means that you've consumed the allocated stack space - but the stack is (relatively speaking) small
p29004
aVThe heap is where it is all happening
p29005
aVOptions:
p29006
aVfix your infinite recursion bug
p29007
aVmove the data into an array/list/some heap-based store (where is it at the moment
p29008
aVavoid deep recursion
p29009
aVavoid oversized structs
p29010
aVhave you got some big fat structs that should really be classes
p29011
aV(structs copy themselves if you so much as blink at them)
p29012
aVincrease the stack space if you are confident that you are only just tipping it over, and it isn't worth a big refactor (I hate this answer) - to do this you would need to spawn your own thread with a bigger stack
p29013
as(dp29014
g18
V23354
p29015
stp29016
a((dp29017
g2
(lp29018
VWhere is the type defined
p29019
aV(which assembly)
p29020
aVUnless you give it an assembly qualified name, it will only look in the calling assembly, and a few other key assemblies
p29021
aVOptions:
p29022
aVuse an assembly qualified name ("somen
p29023
aVamespace
p29024
aVsometype, someassembly,
p29025
aVget the  instance (from a known type in that assembly), and use  on the  instance
p29026
as(dp29027
g18
V23354
p29028
stp29029
a((dp29030
g2
(lp29031
VWhat you are seeing is the effect of a long-running message blocking the windows message queue/pump - which you more commonly associate with the white application screen and "not responding"
p29032
aVBasically, if your thread is sleeping, it isn't responding to messages like "paint yourself"
p29033
aVYou need to make your change and yield control to the pump
p29034
aVThere are various ways of doing this (ripper234 does a good job of listing them)
p29035
aVThe bad way you'll often see is:
p29036
aVI mention this only to highlight what not to do; this causes a lot of problems with "re-entrancy" and general code management
p29037
aVA better way is simply to use a , or for more complex code, a
p29038
aVSomething like:
p29039
as(dp29040
g18
V23354
p29041
stp29042
a((dp29043
g2
(lp29044
VThe easiest option is the  overload that accepts a  and a
p29045
aVFor the , you can sometimes use , but this doesn't check all assemblies (just the current assembly and some system assemblies)
p29046
aVIf the name is assembly-qualified you'll probably be OK - but if it is just namespace-qualified (i
p29047
ag50
aVFullName) then you'll probably want to use  - i
p29048
ag50
as(dp29049
g18
V23354
p29050
stp29051
a((dp29052
g2
(lp29053
VYes, this is the problem with field-based serializers
p29054
aVYou can use either a custom , or a "serialization surrogate" to avoid implementing , but that is only a case-by-case fix
p29055
aVI've discussed this topic (in the context of obfuscators, and auto-props) here
p29056
aVMy advice is: don't use  for persistance of data between versions
p29057
aVfor that, look at contract-based serializers:
p29058
aVor for binary, things like protobuf-net
p29059
aVNone of this helps you today, but it might help you design around it in the future
p29060
as(dp29061
g18
V23354
p29062
stp29063
a((dp29064
g2
(lp29065
VHow constant is the value
p29066
aVis fine for things that are , but you can quickly get into a mess if it isn't  - especially if you have multiple threads
p29067
aVThe scaling factor doesn't sound like a hard constant to me - i
p29068
ag50
aVit isn't:
p29069
aVI wouldn't hesitate to use a static variable for something I load once and leave alone
p29070
aVOther than that, I'd probably encapsulate (in your case) some kind of  with this value and any other utility methods - and pass the  between methods; this can also help you abstract away from the underlying implementation if you need to unit test, etc
p29071
aVAs you find you need more properties (and you inevitably will), you just extend the  class - nothing else changes
p29072
aV(edit)
p29073
aVAlso - consider the future: will you ever be doing more than one render at once
p29074
aVSince we all have lots of cores now, etc
p29075
aVstatic is good if all the threads share a value
p29076
aVThere is , but that is a bit messy by comparison
p29077
as(dp29078
g18
V23354
p29079
stp29080
a((dp29081
g2
(lp29082
VI can't think of many occasions where defaults are truly spanning
p29083
aVgiven all the different use-cases that an object may go through (not least, things like deserialization - which could end up setting the defaults even though that isn't what was intended)
p29084
aVOne option here is IoC; IoC containers like StructureMap have the ability to set properties after initialization, and that is then abstracted from the calling code
p29085
aVAnother option might be some kind of template instance (static), that instances can copy values from
p29086
aVBut I think this is risky in a few scenarios
p29087
aVYou also get problems if different threads (perhaps requests on a web-server) need different defaults
p29088
aVisn't a good option (although it is an option)
p29089
aVAnother option (that provides the greatest flexibility) would be to provide a user-settable factory
p29090
aVperhaps via a delegate or event mechanism - but I struggle to see why you might want this scenario
p29091
aVIt isn't one I've seen very often
p29092
aVre update: if it is only used by the external class; could it perhaps use something like an extension method (rather than the  class having to know anything about this):
p29093
aVSince it sounds like the original  class doesn't care about , this divorces the logic from  neatly
p29094
as(dp29095
g18
V23354
p29096
stp29097
a((dp29098
g2
(lp29099
VEdited to handle filtering; much tricker: in addition to getting the , we need to provide a custom component that pretends (via pass-thru s) to be the  (which is itself pretending to be the ) - and filter out the properties that we don't want
p29100
aVVery interesting problem ;-p Easier to solve in classic classes, but the below works for  ;-p
p29101
aVNote that you could do other things in this area to make some of the properties non-editable (), or have a different caption (), or category () - by overriding other members in
p29102
as(dp29103
g18
V23354
p29104
stp29105
a((dp29106
g2
(lp29107
VYou could add it as an extension method:
p29108
aVUpdate re cloning (which wasn't obvious in the original question)
p29109
aVIf you really want a deep clone; something like:
p29110
aVThis does require the objects to be serializable ( or ), though
p29111
aVYou could easily substitute for any other serializer as appropriate - , , protobuf-net, etc
p29112
aVNote that deep clone is tricky without serialization; in particular,  is hard to trust in most cases
p29113
as(dp29114
g18
V23354
p29115
stp29116
a((dp29117
g2
(lp29118
VWell, the  could go anyway - it'll get closed by the  (if you think about it, it is odd that we only  it after an exception)
p29119
aVDo either of your stored procedures do any transaction code inside themselves (that isn't being rolled back/committed)
p29120
aVIt sounds like that is where the problem is
p29121
aVIf anything, the error message suggests to me that one of the stored procedures is doing a  even though it didn't start a transaction - perhaps due to the (incorrect) approach:
p29122
aV(if you do conditional transactions in TSQL, you should track (via a bool flag) whether you created the transaction - and only  if you did)
p29123
aVThe other option is to use  - easier to use (you don't need to set it against each command etc), but slightly less efficient:
p29124
aV(note there is no rollback etc; the  (via ) will do the rollback if it needs to
p29125
as(dp29126
g18
V23354
p29127
stp29128
a((dp29129
g2
(lp29130
VThere are lots of delegate types that are effictively the same - for example:
p29131
aVall have the same  signature
p29132
aVHistorically, the names were chosen by the specific use; but with LINQ and looking forwards, it seems clearer to focus on the signature - hence in
p29133
aVNET 3
p29134
aV5 they introduced things like  and  (families of delegates)
p29135
aVUnfortunately, they aren't really compatible at the variance level, so if you are using both you'll often have to shim between them
p29136
aVWhich is a pain
p29137
as(dp29138
g18
V23354
p29139
stp29140
a((dp29141
g2
(lp29142
VCan I ask why you are introducing an extra interface
p29143
aVseems pretty similar (albeit / oriented)
p29144
aVI'm also not sure why  would return something; shouldn't we be deserializing into the current object
p29145
aV(else it is an , if you see what I mean)
p29146
aVRe the tags
p29147
aVthe question is unclear; you don't show any tag names in either code or string constants
p29148
aVBut it is a lot easier to just use  and let it worry about everything
p29149
as(dp29150
g18
V23354
p29151
stp29152
a((dp29153
g2
(lp29154
VIf you are having difficulty getting DTC to play nicely (especially when either a firewall or a SQL cluster are involved) then DTCPing is a great tool (by Microsoft) to identify it
p29155
aVNote that (IIRC) you need to be able to DTCPing in both directions
p29156
as(dp29157
g18
V23354
p29158
stp29159
a((dp29160
g2
(lp29161
VThat looks like a DEBUG build, which leaves in extra IL to help the debugger
p29162
aVTry it again in RELEASE and it should look cleaner, with optimization etc
p29163
as(dp29164
g18
V23354
p29165
stp29166
a((dp29167
g2
(lp29168
VEither:
p29169
aVor
p29170
aVor more simply; use single quotes
p29171
as(dp29172
g18
V23354
p29173
stp29174
a((dp29175
g2
(lp29176
VThat is no more or less thread-safe; you could still have two threads do the null check at the same time, thus create separate objects and not see the other
p29177
as(dp29178
g18
V23354
p29179
stp29180
a((dp29181
g2
(lp29182
VYou could try the following, which uses a single / as the message mechanism:
p29183
aVThe original thread holds the lock until it calls ; this lets the second thread (already started) in to create the form, pulse the original thread back into life, and release; the original thread then exits only after  exists
p29184
as(dp29185
g18
V23354
p29186
stp29187
a((dp29188
g2
(lp29189
VWhat you are asking can be automated, but it is quite a lot of work, and requires a knowledge of the  API
p29190
aVWhich is quite an advanced topic
p29191
aVI would probably keep the code "as is"
p29192
aVdry is fine, but "don't break working code" is another adage worth knowing
p29193
aVAlternatively, you might want to look at the Dynamic LINQ Library - this might help you automate things
p29194
aVBut to be honest, the existing code isn't that ugly
p29195
as(dp29196
g18
V23354
p29197
stp29198
a((dp29199
g2
(lp29200
VIf you need this for data-binding purposes, you can do this with a custom descriptor model
p29201
aVby implementing ,  and/or , you can create your own  instances at runtime
p29202
aVThis is what controls like ,  etc use to display properties
p29203
aVTo bind to lists, you'd need  and ; for basic sorting: ; for filtering and advanced sorting: ; for full "new row" support ():  (phew
p29204
aVIt is a lot of work though
p29205
aV(although I hate it) is cheap way of doing the same thing
p29206
aVIf you don't need data-binding, just use a hashtable ;-p
p29207
aVHere's a simple example - but you can do a lot more
p29208
as(dp29209
g18
V23354
p29210
stp29211
a((dp29212
g2
(lp29213
VSorry, I didn't mean to miss this one - alas, I don't see everything
p29214
aVGiven the specifics in the question, I'm going to assume that you are at least passingly familiar with
p29215
aVproto; correct me if I am wrong
p29216
aVworks a lot like  for  - or  for  - it allows it to recognise subclasses of a type during (de)serialization
p29217
aVThe only additional thing is that it needs a tag (number) to identify each sub-type (that must be unique, and not clash with any of the fields from the parent type)
p29218
aVRe protogen: nope; the underlying spec (by google) makes no provision for inheritance at all, so protogen (via
p29219
aVproto) has no mechanism to express this
p29220
aVprotobuf-net provides inheritance support as an extension, but does it in a way that still leaves the messages wire-compatible with the other implementations
p29221
aVAt a push, maybe I could add protogen support via the new extension properties in the google spec, but I haven't done this yet
p29222
aVSo; to look at the example; that expresses an inheritance relationship between  and ; regardless of whether you do:
p29223
aVeither way, it will start at the base () and work upwards; which isn't exactly true - it writes the data starting with  (so that it knows we have a  as early as possible during deserialization)
p29224
aVThe important thing is that the fields from any parent contract types is included, and the serializer looks at the actual object passed in - not just the type you say it is
p29225
aVLikewise, during deserilaization, regardless of whether you use:
p29226
aVyou will get the type you actually serialized (presumably a )
p29227
aVUnder the bonnet, for compatibility purposes (with the wide protocol buffers specification), this is similar to writing something like (forgive any errors, my
p29228
aVproto is rusty):
p29229
aV(the override probably shouldn't specify , btw
p29230
aVNormally, it would write fields in ascending tag order, but to make for efficient deserialization the engine cheekily chooses to write the subclass data first (which is explicitly allowed by the spec) - i
p29231
ag50
aVit writes something like (you'll have to imagine the binary
p29232
ag6864
aV(in this case, the body of the sub-message is empty)
p29233
aVDoes that cover it
p29234
as(dp29235
g18
V23354
p29236
stp29237
a((dp29238
g2
(lp29239
VI assume the ClickOnce comment relates to people without the full
p29240
aVNET framework (or different operating systems)
p29241
aVDepending on the timescales, you could look at Silverlight 3
p29242
aVthis has an offline/out-of-browser capability very similar to ClickOnce; this might give you more coverage and a great UI too
p29243
as(dp29244
g18
V23354
p29245
stp29246
a((dp29247
g2
(lp29248
VIf you want the text to be , then encoding is the right thing - otherwise it isn't (just) a text node
p29249
aVYou could CDATA it, but I don't think that is what you mean either
p29250
aVDo you want the xml contents to be the above
p29251
ag412
ag50
aVso that it gets a  elelment inside it
p29252
aVedit: here's code that adds the content via various methods:
p29253
as(dp29254
g18
V23354
p29255
stp29256
a((dp29257
g2
(lp29258
V is just short-hand for type inference
p29259
aVthe real question here is: what is the underlying type
p29260
aVIf it involves an anonymous type (i
p29261
ag50
aVnew {
p29262
aV}, or a  there-of), then there is no elegant way (although it can be done in a hacky way)
p29263
aVIn short; don't use anonymous types in this scenario
p29264
aVNote that a query expression such as  is not data - it is a query - to store the data (for a cache) you'd need to use  /  etc
p29265
aVImportant: you shouldn't store a query expression in session; at best (in-memory session provider) that will keep the data-context alive; at worst (database etc session provider) it won't work, as a data-context isn't serializable
p29266
aVStoring results from a query is fine; but otherwise, rebuild the query expression per-request
p29267
aVIn which case, you might be able to use (for example):
p29268
as(dp29269
g18
V23354
p29270
stp29271
a((dp29272
g2
(lp29273
VI'm a big fan of SVN - usually via TortoiseSVN (IDE integration is over-rated, IMO)
p29274
aVA quick search shows a tool here that will move VSS into SVN with history
p29275
aVFor hosting; IMO, the (free) VisualSVN Server is unbeatable; a breeze to install (next/next/next
p29276
aV- and it can use your domain accounts for access (rather than a separate user database)
p29277
as(dp29278
g18
V23354
p29279
stp29280
a((dp29281
g2
(lp29282
VAssuming you have association properties
p29283
aVOr simply:
p29284
as(dp29285
g18
V23354
p29286
stp29287
a((dp29288
g2
(lp29289
VDoes it have to be
p29290
aVI would (either manually, or via xsd
p29291
aVexe) just create classes that map to the element/attribute names - and use  - in particular via :
p29292
aV(edit)
p29293
aVWith entity classes:
p29294
as(dp29295
g18
V23354
p29296
stp29297
a((dp29298
g2
(lp29299
VI was tempted to say "belongs on serverfault", but from a development/design/architecture point of view there are some things to know here
p29300
aVyes, http compression can make a big difference to performance if bandwidth (size) is the issue, especially if you are talking to non-local clients - and is worth including in most web applications
p29301
aVif your pages are slow because of how the processing at the server works, it won't make any difference at all
p29302
aVit only improves the server -> client measure
p29303
aVto enable it, see google - or MSDN
p29304
aVit requires a client (browser) that accepts compression (although this is negotiated in the http headers, so it should "fail safe" for old clients)
p29305
aVbut you need to watch out; if you still support IE 5
p29306
aV6
p29307
aV, there are a number of major bugs here (especially with ajax etc) - test on the clients you expect to see
p29308
aVuse Fiddler to check that it is working (as a developer, Fiddler should be one of your closest friends
p29309
as(dp29310
g18
V23354
p29311
stp29312
a((dp29313
g2
(lp29314
VReally poor answer (demonstrates no "understanding") - but as a crazy stab you could hit google (through code) for (for example) "+Fishing +Sport", "+Fishing +Cooking" etc (i
p29315
ag50
aVcross join each word and category) - and let the google fight win
p29316
ag412
ag50
aVthe combination with the most "hits" gets chosen
p29317
aVFor example (results first):
p29318
aVWith code (TODO: add threading ;-p):
p29319
as(dp29320
g18
V23354
p29321
stp29322
a((dp29323
g2
(lp29324
V(2nd edit)
p29325
aVOoh - found an easier way ;-p
p29326
aVThis works thanks to the flexible static conversion operators on  etc
p29327
aV(original)
p29328
aV(1st edit)
p29329
aVOr add an extension method:
p29330
aVand use:
p29331
as(dp29332
g18
V23354
p29333
stp29334
a((dp29335
g2
(lp29336
VIs is a data tree, or a full graph - i
p29337
ag50
aVare there any circular references
p29338
aVIf not, protobuf-net is a high-performance binary tree serializer
p29339
aVIt supports streaming of enumerable items (so you can skip records, etc - rather than buffer everything), but to efficiently seek to a random element I expect you'd need some kind of index
p29340
aVRead/write is VERY hard for a single file; in particular, writing may require moving lots more of the disk than you expect
p29341
aVreading is also tricky and might require synchronization
p29342
aVIt would be easier to use separate files
p29343
aVExample of skipping early items; I could probably add a helper method, but the  method will work
p29344
aVthe key point being to watch that between serialization and deserialization we only create one extra object
p29345
as(dp29346
g18
V23354
p29347
stp29348
a((dp29349
g2
(lp29350
VNote that you should only use this approach if you cannot know the property names at compile time; but the following seems to work:
p29351
as(dp29352
g18
V23354
p29353
stp29354
a((dp29355
g2
(lp29356
VCaching in LINQ-to-SQL is associated with the , and is mainly limited to identity caching - in most cases it will re-run a query even if you've done it before
p29357
aVThere are a few examples, like  (which has special handling)
p29358
aVSince you are clearly getting a new data-context each time, I don't think that is the culprit
p29359
aVHowever, I'm also slightly surprised that the code works
p29360
aVare you sure that is representative
p29361
aVLINQ's  method is deferred - meaning it isn't executed until you iterate the data (for example with )
p29362
aVBut by that time you have already disposed the data-context
p29363
aVHave you snipped something from the example
p29364
aVAlso - by giving it a  (that you don't then ), you may be impacting the cleanup - it may be preferable to just give it (the data-context) the connection string
p29365
as(dp29366
g18
V23354
p29367
stp29368
a((dp29369
g2
(lp29370
VReflector (which used to be free) will show you this; load the dll and find the interface (F3) - expand the "Derived Types" node
p29371
as(dp29372
g18
V23354
p29373
stp29374
a((dp29375
g2
(lp29376
VIf you are outputting text, you can use,IIRC, some variant of  - I don't have anything "to hand", though
p29377
aVperhaps try  in the middle
p29378
as(dp29379
g18
V23354
p29380
stp29381
a((dp29382
g2
(lp29383
V, via boxing, is the effective (root) base-class of all
p29384
aVNET types
p29385
aVThat should work fine - you just need to use  or  to check the types
p29386
as(dp29387
g18
V23354
p29388
stp29389
a((dp29390
g2
(lp29391
VWith the web-service proxies, you can choose the namespace when you add the web-reference, or via
p29392
aVHowever, these will be separate types and you can't treat the two as the same
p29393
aVThis often causes a lot of confusion
p29394
aVIf you want to share the types, consider using WCF instead of 2
p29395
aV0-style web-services, which allows this - both via the IDE, and via
p29396
as(dp29397
g18
V23354
p29398
stp29399
a((dp29400
g2
(lp29401
VRather than deal with dates, you could just set a bit field to indicate that you've acknowledged the change - the trigger sets it to one, and the e-mail notifier resets it to 0
p29402
aVAdd an index to the bit field; job done
p29403
aV(an index on a bit field is effective as long as the data is heavily skewed, i
p29404
ag50
aVrelatively few set bits)
p29405
aVYou would probably do this in combination of setting an audit date, and/or a separate audit table
p29406
aVYou may also choose to look at service-broker for async processing at the server
p29407
as(dp29408
g18
V23354
p29409
stp29410
a((dp29411
g2
(lp29412
VBy using  you're using a new table for sourceData - try getting the table that actually got loaded
p29413
aVIn C#,  (don't ask me VB
p29414
aVpossibly )
p29415
as(dp29416
g18
V23354
p29417
stp29418
a((dp29419
g2
(lp29420
s(dp29421
g18
V23354
p29422
stp29423
a((dp29424
g2
(lp29425
VLINQ is a query dialect - it isn't directly a mutation language
p29426
aVTo change the values of an existing dictionary,  is probably your friend:
p29427
as(dp29428
g18
V23354
p29429
stp29430
a((dp29431
g2
(lp29432
Vmorelinq and MiscUtil
p29433
as(dp29434
g18
V23354
p29435
stp29436
a((dp29437
g2
(lp29438
VThere are a couple of problems here
p29439
aVC# and  name nested types differently
p29440
aVC# and  name generic types differently
p29441
aVAs a minor aside,  isn't a closed type, but that shouldn't be an issue
p29442
aV(edit)
p29443
aVThis gets pretty close - it still retains the outer generics from the type, though:
p29444
as(dp29445
g18
V23354
p29446
stp29447
a((dp29448
g2
(lp29449
VIt sounds like maybe the COM component is only registered for the user - so when the admin tries it, the clsid is unknown
p29450
aVTry running your isntallation/registration process for the admin
p29451
aV(does vista put clsids in HKCU
p29452
aVor just HKLM
p29453
aVA quick search seems to indicate that it relates to whether UAC is enabled or disabled
p29454
aVwith it enabled it looks in HKCU
p29455
aVdisabled and it looks in HKLM
p29456
aVSo if you are installing into HKCU, it won't be there for an admin with UAC disabled
p29457
as(dp29458
g18
V23354
p29459
stp29460
a((dp29461
g2
(lp29462
VThe obvious statement is "then it isn't CSV"
p29463
aVI'd be tempted to use a quick regex to munge the date into the same escaping as everything else
p29464
aVon a line-by-line basis, something like:
p29465
aVThen you should be able to use a standard parser using space as a delimiter (respecting quotes)
p29466
as(dp29467
g18
V23354
p29468
stp29469
a((dp29470
g2
(lp29471
VThere are very few things you can usefully do with an interface without a concrete implementation
p29472
aVYou certainly can't create anything
p29473
aVThe only useful way I've found is (with ) expressing intent, for example with RPC:
p29474
aV(aside)
p29475
aVThis says if we had an  instance "svc" (which we don't), then we'd call  passing in 3; we can then pull the  apart to find this out
p29476
aVIn all other scenarios - if you don't have a concrete implementation either at compile-time or runtime (dynamic type generation), then it isn't any use whatsoever
p29477
as(dp29478
g18
V23354
p29479
stp29480
a((dp29481
g2
(lp29482
VInline (with or without the literal  syntax) is fine for short queries
p29483
aVbut for anything longer, consider having the tsql as a file in the project; either as embedded resources / resx, or as flat files
p29484
aVOf course, by that stage, you should probably make it a stored procedure anyway ;-p
p29485
aVBut having it as a separate file forces the same separation that will make it a breeze to turn into a stored procedure later (probably just adding  etc)
p29486
aVOne issue with inline - it makes it so tempting for somebody to concatenate user input
p29487
aVwhich is obviously bad (you've correctly used parameters in the example)
p29488
as(dp29489
g18
V23354
p29490
stp29491
a((dp29492
g2
(lp29493
VAlso - watch out;  only checks the executing assembly and a few system assemblies; it doesn't scan everything
p29494
aVIf you use an assembly-qualified-name you should be fine - otherwise you may need to get the  first, and use
p29495
as(dp29496
g18
V23354
p29497
stp29498
a((dp29499
g2
(lp29500
VYou could simply not use the
p29501
aVsvc extension
p29502
aVjust use anything else that works, and tell the client the address
p29503
aVThere may be additional goo associated with that particular exntension (dynamic compilation, etc)
p29504
as(dp29505
g18
V23354
p29506
stp29507
a((dp29508
g2
(lp29509
V(if the indexes are "unused", why are they there at all
p29510
aVOne option I've used in the past is to do the work in batches
p29511
aVThe crude way would be to use  (or whatever) and loop (perhaps with a ) until you get rid of it all (@@ROWCOUNT = 0)
p29512
aVThis might help reduce the impact upon other systems
p29513
as(dp29514
g18
V23354
p29515
stp29516
a((dp29517
g2
(lp29518
Vso:  is the publisher and  is the subscriber
p29519
aVfirst bullet: if  is the instance with  - then it is still in use, so no, it won't get collected unless the  instance is unreachable
p29520
aVsecond bullet: huh
p29521
aV(will read again
p29522
aVIf the  and  instances are both unreachable, they will be garbage collected; the event doesn't matter
p29523
aVIf  is reachable, then  will stay alive
p29524
aVHowever, the event subscription never keeps  alive; it is one way
p29525
aVcan keep  alive, but  doesn't keep  alive
p29526
aVDoes that cover it
p29527
aVthird bullet: in most cases, the two things have similar life expentency, so it isn't an issue
p29528
aVIt only becomes an issue if the thing publishing the event lives a lot longer than the things with the handlers
p29529
aVIn which case, you simply need to religiously clean up after yourself - for example:
p29530
aVIn particular,  events are evil for this reason
p29531
as(dp29532
g18
V23354
p29533
stp29534
a((dp29535
g2
(lp29536
VThere is no predefined symbol for this; you could create your own symbols and define them in your build script
p29537
aVNote that you can fix the language version at the project level:
p29538
aVProject properties -> Build -> Advanced -> Language Version:
p29539
aVISO-1 is C# 1
p29540
ag5115
aVISO-2 is C# 2
p29541
ag190
aV(maps to the  parameter)
p29542
aVBut note that this doesn't cover everything - there are a few things that this will let through - particularly in the area of generic type inference
p29543
aVThis is only an issue if you need to support old compilers; in which case
p29544
aVtest with an old compiler
p29545
aVFor example:
p29546
aVThis works in
p29547
aVNET 3
p29548
aV5/ISO-2 (pseudo C# 2
p29549
aV0), but doesn't work in
p29550
aVNET 2
p29551
aV0 (proper C# 2
p29552
aV0)
p29553
as(dp29554
g18
V23354
p29555
stp29556
a((dp29557
g2
(lp29558
VHow large is
p29559
aVYou may do better to re-use a fixed sized (moderately large, but not obscene) buffer, and forget
p29560
aVjust use  and
p29561
aV(edit) something like:
p29562
as(dp29563
g18
V23354
p29564
stp29565
a((dp29566
g2
(lp29567
VYou could also look at
p29568
as(dp29569
g18
V23354
p29570
stp29571
a((dp29572
g2
(lp29573
VSomething like:
p29574
aVIn terms of a :
p29575
as(dp29576
g18
V23354
p29577
stp29578
a((dp29579
g2
(lp29580
VCan I check
p29581
aVAre you passing a delegate to a web service
p29582
aVThat won't work
p29583
aVit* cannot be serialized
p29584
aVAt best, ADO
p29585
aVNET Data Services (
p29586
aVNET 3
p29587
aV5SP1) can do something similar by translating an  into a query-string
p29588
aVbut that is as close as you'll get
p29589
aVOther than that, you'll have to build a request object that encapsulates your intent with regular properties
p29590
aVThis applies to any of web-service, wcf service, tcp, etc
p29591
aV*=a delegate is essentially a type-safe method handle (with an optional target (instance) reference); it can be expressed, for example, as xml
p29592
aV(edit)
p29593
aVFrom the comments - it might simply be that you haven't attributed your data-contracts; this means it has to infer the contract (and it often gets it wrong)
p29594
aVFor example:
p29595
aVWhen using , only members marked  are serialized - so the event should be ignored
p29596
aVThis used to be the only way of doing WCF data-contracts, but MS tweaked it to infer contracts from fields
p29597
aVa mistake IMO, as it causes the problem you've just had
p29598
as(dp29599
g18
V23354
p29600
stp29601
a((dp29602
g2
(lp29603
VWhy use regex
p29604
aVFor xhtml, load it into XDocument / XmlDocument; for (non-x)html the Html Agility Pack would seem a more sensible choice
p29605
aVEither way, that will parse the html into a DOM so you can iterate over the nodes and inspect them
p29606
as(dp29607
g18
V23354
p29608
stp29609
a((dp29610
g2
(lp29611
VOne possibility is the connection state is different - in particular, the  options etc - not just the obvious ones (stats, profiling, etc) - but even things like ANSI_NULLS can have a big impact on some queries (especially with xml columns, or peristed calculated columns)
p29612
aVAlso - what are you doing with the data when you read it
p29613
aVAre you displaying it
p29614
aVStoring it
p29615
aVJust dropping it
p29616
aVSSMS has to buffer it in a table-like mechanism to display in a grid
p29617
aVif you are parsing it into standard, typed classes (that already match the table layout) - or just dropping the row unprocessed, then you have less work to do
p29618
aVFrom what I recall, it also updates the screen in batches - suggesting there is some threading going on
p29619
aVlots of variables here
p29620
as(dp29621
g18
V23354
p29622
stp29623
a((dp29624
g2
(lp29625
VWhat sort of display are you after
p29626
aVSome searching shows a viable jQuery-based gantt here (jquery
p29627
aVgantt)
p29628
aVILOG do a range of outlook-style calendar and gantt (task-based) / schedule (resource-based) controls for both winform and web, but they aren't free, and the web bits are currently non-MVC
p29629
aVSo; what sort of display are you after
p29630
as(dp29631
g18
V23354
p29632
stp29633
a((dp29634
g2
(lp29635
VWell, the first thing I can see is that you probably need to group by , and use comma (not period) to separate items in the  clause (you have :
p29636
aVI wonder if the query shouldn't involve  at some point too, though (hard to tell without your schema
p29637
as(dp29638
g18
V23354
p29639
stp29640
a((dp29641
g2
(lp29642
VI'll assume we mean objects (classes), since it is a moot point for structs
p29643
aVThere are a few dubious reasons for cloning an immutable object:
p29644
aVif the object is remoted, and you want a local copy (although in this case you presumably couldn't use an instance method on the object itself, as that would also return a remoted instance - you'd have to have the clone method local (non-remoted))
p29645
aVif you are hugely worried about reflection (even  fields can be changed by reflection) - perhaps for some super-security conscious code
p29646
aVif some external API (that you can't control) uses reference equality, and you want to use the same "value" as two separate keys - OK, I'm stretching things now
p29647
aVIf we extend the discussion to consider deep cloning, then it becomes more reasonable, since a regular immutable object doesn't imply that any associated objects are also immutable
p29648
aVA deep clone would fix this, but is a separate consideration
p29649
aVI think maybe the remoting scenario is the best I can do
p29650
as(dp29651
g18
V23354
p29652
stp29653
a((dp29654
g2
(lp29655
VThis (Mike Taulty on Channel 9, with a screencast showing it working) answers out-of-browser/install in OS X; I'm given to understand that the local install works slightly differently (to cater for OS differences), but works
p29656
aVSo: would your friends prefer Silverlight
p29657
aVOr would they happily run VMware Fusion
p29658
aV(not sure how well that would cope with an intensive WPF app, though)
p29659
aVIf your xaml isn't hugely complex, I'd consider SL3 - but going from WPF to Silverlight is trickier than the other way around - there are, understandably, big gaps
p29660
as(dp29661
g18
V23354
p29662
stp29663
a((dp29664
g2
(lp29665
VI'm assuming you do have a  statement that points to the namespace
p29666
aVSomething I see from time to time
p29667
aVon the server, have you (in IIS) marked the new folder as an "application"
p29668
aVIt should have a cog in IIS
p29669
aVIf you haven't, then it'll be looking in the wrong location for App_Code (the "application" tells it where the local app root is)
p29670
aVRight-click, properties, "create application" (or something like that - I don't have a server to hand
p29671
as(dp29672
g18
V23354
p29673
stp29674
a((dp29675
g2
(lp29676
VCLS compliance isn't to do with older anything - it is simply the core set of functionality that you should reasonably expect an arbitrary language to handle (when consuming your code)
p29677
aVFor example, it isn't reasonable to assume that a language is case-sensitive, so members "Foo" and "foo", while legal in C#, are not CLS compliant
p29678
aVThe compiler will warn you if you ask it to; add  to a type / assembly / etc and it will verify your claim
p29679
aVIf you are an ISV, you might want to think about CLS compliance
p29680
aVIf you are writing code just for yourself and team, you probably don't need the overhead
p29681
as(dp29682
g18
V23354
p29683
stp29684
a((dp29685
g2
(lp29686
VLooking in reflector, it looks like  just calls  (when the new parent is non-null)
p29687
aVThe  deals with taking it away from the old parent
p29688
aVSo actually, the following are functionally equivalent (when  is not null):
p29689
aVand:
p29690
aVCounter-intuitive, but a quick test shows that it works
p29691
as(dp29692
g18
V23354
p29693
stp29694
a((dp29695
g2
(lp29696
VThe other replies have covered why (scoping and definite assignment) - but you are making life hard
p29697
as(dp29698
g18
V23354
p29699
stp29700
a((dp29701
g2
(lp29702
V is static typed - the compiler and runtime know the type - they just save you some typing
p29703
aVthe following are 100% identical:
p29704
aVand
p29705
aVAll that happened was that the compiler figured out that  must be a string (from the initializer)
p29706
aVIn both cases, it knows (in the IL) that  means the (instance)  property
p29707
aVis a very different beast; it is most similar to , but with dynamic dispatch:
p29708
aVHere,  is typed as dynamic
p29709
aVIt doesn't know about , because it doesn't know anything about  at compile time
p29710
aVFor example, the following would compile (but not run) too:
p29711
aVAt runtime (only), it would check for the  property - fail to find it, and explode in a shower of sparks
p29712
aVWith , properties / methods / operators / etc are resolved at runtime, based on the actual object
p29713
aVVery handy for talking to COM (which can have runtime-only properties), the DLR, or other dynamic systems, like
p29714
as(dp29715
g18
V23354
p29716
stp29717
a((dp29718
g2
(lp29719
VPresumably you could specify the xml (for the node-set) as the input argument
p29720
aVI'm not "up" on exslt, but using msxsl (just for the  function, which is also in exslt):
p29721
as(dp29722
g18
V23354
p29723
stp29724
a((dp29725
g2
(lp29726
VI'm not saying it is a great way to pivot - but it is a pivot
p29727
as(dp29728
g18
V23354
p29729
stp29730
a((dp29731
g2
(lp29732
VHave you added a partial class to add functionality (etc) to the generated classes
p29733
aVIf so - odd though it sounds, the position of any  statements in your partial class file can actually be a problem that breaks code generation
p29734
aVTry moving them inside the namespace
p29735
aVNo, I am not kidding
p29736
aVThe error message in this case is "The custom tool 'MSLinqToSQLGenerator' failed
p29737
aVUnspecified error"
p29738
aVChanging from:
p29739
aVto:
p29740
aVfixes it
p29741
aVFreaky bug
p29742
as(dp29743
g18
V23354
p29744
stp29745
a((dp29746
g2
(lp29747
VSorting is, in part, a feature of the data-source
p29748
aVWhat is the data source in this case
p29749
aV, perhaps
p29750
aVOne option is simply to use a data-source that doesn't support sorting, which is almost all of them
p29751
aV,  etc - don't provide sorting
p29752
aVIf you must use , you could (I guess) wrap the view with a custom view that re-implements  (returning  for ), but simply changing the values per column is a lot easier (to the point where it would be crazy to do anything else
p29753
as(dp29754
g18
V23354
p29755
stp29756
a((dp29757
g2
(lp29758
VWhat sort of objects are you putting in the cache
p29759
aVAre they typed objects
p29760
aVOr things like
p29761
aVFor , then perhaps store as xml compressed through
p29762
aVFor typed (entity) objects, you'll probably need to serialize them
p29763
aVYou could use  and , or you could just use something like protobuf-net serialization (free) which is already very compact (adding  typically makes the data larger - which is typical of dense binary)
p29764
aVIn particular, the advantage of things like protobuf-net is that you get the reduced size without having to pay the CPU cost of unzipping it during deserialization
p29765
aVIn some tests before adding , it was 4 times faster than
p29766
aVAdd the extra time onto  for GZip and it should win by a considerable margin
p29767
as(dp29768
g18
V23354
p29769
stp29770
a((dp29771
g2
(lp29772
VA simple hash
p29773
aVhow about something like:
p29774
aVOr for more obvious entropy:
p29775
aV(numbers from C#'s anonymous type code)
p29776
as(dp29777
g18
V23354
p29778
stp29779
a((dp29780
g2
(lp29781
VWhen you say "shared" - is that VB-speak for
p29782
aVIf so, note that you could be in a bit of threading jeopardy if you aren't careful
p29783
aVand given the description, it sounds like this data may be mutable
p29784
aVCould be
p29785
aV"interesting" if you ever have multiple instances/threads
p29786
aVMaybe I'm being overly paranoid - hard to tell without illustrative code
p29787
aVInstance fields (rather than shared/static fields) would be my default assumption - but again, without context I can't be 100% sure
p29788
as(dp29789
g18
V23354
p29790
stp29791
a((dp29792
g2
(lp29793
VThe closest you'll get on W2K is WSE3 - this gives you MTOM (etc) over SOAP - but not the full WCF goodness
p29794
aVYou could design the service to be WCF at the server, but WSEx at the client
p29795
aVNot "free", but I'm assured by several WCF experts that it is very "doable" - WCF was designed to support standards, after all
p29796
aVYou'll have to limit yourself to http-basic, but IMO that should be the default anyway
p29797
aVJimmy has an article on this here: Interoperability between WCF and WSE 3
p29798
aV0 (scroll down to "WSE 3
p29799
aV0 to WCF")
p29800
as(dp29801
g18
V23354
p29802
stp29803
a((dp29804
g2
(lp29805
VGoing forward,  is the norm, and has much better support in WPF
p29806
aVI seem to recall that  only respects  (see  and  in reflector)
p29807
aVThis is also more efficient, as the UI only needs one event hook, rather than one per event - and your class can be more efficient as it only needs a field for one handler (rather than either one per property, or the niggle of having to go via  and a set of static keys)
p29808
aVThe old style is mainly a hangover
p29809
as(dp29810
g18
V23354
p29811
stp29812
a((dp29813
g2
(lp29814
VIn VB you can implement an interface with a method of any name - i
p29815
ag50
aVa method "Class
p29816
aVA" can implement interface method "Interface
p29817
aVB"
p29818
aVIn C#, you would have to introduce an extra level of indirection to achieve this - an explicit interface implementation that calls "Class
p29819
aVA"
p29820
aVThis is mainly noticeable when you want "Class
p29821
aVA" to be  and/or  (explicit interface implementations are neither); if it was just "private" you'd probably just leave it as the explicit interface implementation
p29822
aVC#:
p29823
aVVB:
p29824
aVIn the IL, VB does this mapping directly (which is fine; it is not necessary for an implementing method to share a name)
p29825
as(dp29826
g18
V23354
p29827
stp29828
a((dp29829
g2
(lp29830
VFrom the question:
p29831
aVTo deserialize I need an XmlReader, so I would need to go from an XmlElement to an XmlReader which I'm not sure how to do
p29832
as(dp29833
g18
V23354
p29834
stp29835
a((dp29836
g2
(lp29837
VA  is not based a key/value pair, and provides no "by key" access - it is just a set of unique values, using the hash to check containment very quickly
p29838
aVTo use a key/value pair (to fetch out by  later) the simplest option would be a
p29839
aVThe existing hash-code on  should be fine (although if you needed (you don't here) you can provide an  to use for hashing
p29840
as(dp29841
g18
V23354
p29842
stp29843
a((dp29844
g2
(lp29845
VSubclassing  is rarely useful - except to give it a name;  at least gives you the option to override some things
p29846
aVIn your example, I'm assuming that  is the LINQ extension method - in which case, it really is returning a , not a
p29847
aVYou could add an implicit conversion operator, but I don't think that is a good idea (turns out that not only is it not a good idea: it isn't possible ;-p credit: Aistina - comments)
p29848
aVIf it isn't the LINQ extension method - then simply type it to return the right thing
p29849
as(dp29850
g18
V23354
p29851
stp29852
a((dp29853
g2
(lp29854
VI guess it comes down to what the memory model can guarantee
p29855
aVI don't know a vast amount about the CLI memory model (that C# has to use), but I know it'll guarantee 32 bits
p29856
aVbut not 64 (although it'll guarantee a 64-bit reference on x64 - the full rules are in 17
p29857
ag7733
aV3 of ECMA 334v4)
p29858
aVSo it can't be
p29859
aVYou still have the  methods, though (such as  and  etc)
p29860
as(dp29861
g18
V23354
p29862
stp29863
a((dp29864
g2
(lp29865
VSequential numbers are not necessary, and in some scenarios are a bad idea (in security-conscious systems where guessing is a problem)
p29866
aVBut it is relatively common to let the RDBMS handle this - most support an  auto-incrementing type (although it gets more complex with multiple distributed master servers)
p29867
aVAnother option is  of course - little chance of duplicates
p29868
aVThe prefix approach is quite handy for quickly identifying numbers - but you can choose to just prepend the "OR-" at the layers above the db
p29869
as(dp29870
g18
V23354
p29871
stp29872
a((dp29873
g2
(lp29874
VThe reference is passed by value
p29875
aVArrays in
p29876
aVNET are object on the heap, so you have a reference
p29877
aVThat reference is passed by value, meaning that changes to the contents of the array will be seen by the caller, but reassigning the array won't:
p29878
aVIf you add the  modifier, the reference is passed by reference - and the caller would see either change above
p29879
as(dp29880
g18
V23354
p29881
stp29882
a((dp29883
g2
(lp29884
VRe pure WCF: if you control both ends of the wire (on "full"
p29885
aVNET), then applying a custom serializer is relatively simple - you add a behaviour inherited from , and override  - see here (with attribute here)
p29886
aVHowever
p29887
aVMy understanding (untested) is that a JSON-enabled WCF service won't use this route, but will apply its own serializer directly
p29888
as(dp29889
g18
V23354
p29890
stp29891
a((dp29892
g2
(lp29893
VYou can use SvcConfigEditor to enable tracing, which may be enough - see also (on MSDN) Configuring Message Logging
p29894
aVAlternatively - for non-local testing, you can perhaps use something like Fiddler (for http) or Wireshark (for everything else) to watch the traffic
p29895
as(dp29896
g18
V23354
p29897
stp29898
a((dp29899
g2
(lp29900
VDo you want to read (query) the data in a specific order, or do you actually want to re-order the data in the xml
p29901
aVTo read in a specific order, just use the LINQ  method:
p29902
aV(edited) Changing the xml is trickier
p29903
aVmaybe something like:
p29904
as(dp29905
g18
V23354
p29906
stp29907
a((dp29908
g2
(lp29909
VYou need to tell the compiler what type of delegate to create, since  (etc) just take  (rather than something more specific)
p29910
aVTo apply to the largest audience,  is a handy delegate type
p29911
aVHowever
p29912
aVfires on the UI thread automatically - so you don't even need this
p29913
as(dp29914
g18
V23354
p29915
stp29916
a((dp29917
g2
(lp29918
VHowever, unless you cast to a non-generic interface (, maybe), you lose the ability to use it as a generic type
p29919
aVThe most common answer here is a non-generic base class/interface:
p29920
aVYou can then invoke via the non-generic  without having to jump through any extra hoops
p29921
aVExample using  below - but a non-generic base interface would more efficient:
p29922
as(dp29923
g18
V23354
p29924
stp29925
a((dp29926
g2
(lp29927
Vedit re comment; it isn't clear how you want to calculate , but for a simple formula, just inline it:
p29928
aVFor something more complex, anything from:
p29929
aVtable variables (@table)
p29930
aVtemporary tables (#table)
p29931
aVsub-queries
p29932
aVetc
p29933
as(dp29934
g18
V23354
p29935
stp29936
a((dp29937
g2
(lp29938
VWhen you say "doesn't work"
p29939
aVwhat happens
p29940
aVOverriding  (without overriding ) is a bad idea, and introduces a lot of complexity
p29941
aVdoesn't allow you to pass in a custom , so IMO you should check it manually ( etc)
p29942
aVOr in
p29943
aVNET 3
p29944
aV5, LINQ; I'll give a C# example (VB isn't my strong point):
p29945
aVIf you are doing lots of this, or the lists are long - you may benefit from building a hash-set of the known ids first (again, a C# example - sorry):
p29946
aVThis has the initial cost of hashing all the data, but may be significantly faster overall
p29947
as(dp29948
g18
V23354
p29949
stp29950
a((dp29951
g2
(lp29952
VIf you have to use just , then you can build the expression manually
p29953
aVIn this case I'm using a selector expression, but reflection on a property-name (i
p29954
ag50
aV"Name") would do just as well:
p29955
aVThe string-based approach would be:
p29956
as(dp29957
g18
V23354
p29958
stp29959
a((dp29960
g2
(lp29961
VWith :
p29962
aVor with :
p29963
as(dp29964
g18
V23354
p29965
stp29966
a((dp29967
g2
(lp29968
VTechnically you can write recursive lambda expressions, but you need to be insane or insanely bright to try (I haven't figured out which)
p29969
aVBut you can cheat:
p29970
as(dp29971
g18
V23354
p29972
stp29973
a((dp29974
g2
(lp29975
V may not be wonderful with associations
p29976
aVIf you enable serialization on the data-context surface, it adds (WCF) data-contract attributes
p29977
aVPerhaps just use:
p29978
as(dp29979
g18
V23354
p29980
stp29981
a((dp29982
g2
(lp29983
VIt may be tempting to say  - but that involves the creating of an array and lots of individual strings
p29984
aVIMO, the optimal way here is to find the first underscore, and take a substring:
p29985
aV(edit)
p29986
aVIf you are doing this lots, you could add some extension methods:
p29987
aVthen:
p29988
as(dp29989
g18
V23354
p29990
stp29991
a((dp29992
g2
(lp29993
VIt is capturing ; try:
p29994
aVJon has a list of related posts here
p29995
aVAs for why
p29996
aVis defined (in ECMA 334v4 15
p29997
ag5168
aV4) as:
p29998
aVNote the  is outside the  - this means it is captured once only for the
p29999
aVI gather that the C# team have, at times, doubted the wisdom of this change (it was inside the  in the C# 1
p30000
aV2 spec, which would have avoided the problem completely)
p30001
aVMaybe it'll change back eventually, but for now it is being true to the specification
p30002
as(dp30003
g18
V23354
p30004
stp30005
a((dp30006
g2
(lp30007
VIf it needs 10 values, then it isn't unheard of to pass 10 values into the constructor - but what you describe sounds more like an entity object
p30008
aVFor convenience, it is common to just use the property setters
p30009
aVWith C# 3
p30010
aV0 you can use initializer syntax to do this conveniently and clearly:
p30011
aVYou can use a  object (as some kind of builder) - but in that case, why not make construction a method on the builder
p30012
aVThen the builder does the validation before creating a  (presumably via an  constructor) - and throws an exception if there is a problem
p30013
aVI'm assuming the use of  is (for example) to allow an immutable  - but there is no need for the builder to be immutable:
p30014
aVPersonally, I'd use just the  approach (topmost above) in most cases - this approach plays well with common
p30015
aVNET serialization engines and binding frameworks (both of which like parameterless constructors and / properties), for example
p30016
aVIf you want validation, then perhaps just add a  method (or  property) to
p30017
aVOr implement
p30018
as(dp30019
g18
V23354
p30020
stp30021
a((dp30022
g2
(lp30023
VNote that for a single column you could get rid of the anon-type completely, and just , but I'll leave that in as it scales to 2/3/etc columns
p30024
aVHow about:
p30025
aVThe main thing is to break the composition;  does that for us
p30026
aVI also wrote some code for DbLinq that allows this type of construct natively - it may work on LINQ-to-SQL; it is on usenet somewhere
p30027
aVYou could also use something like  (MiscUtil) to avoid having to map it yourself:
p30028
as(dp30029
g18
V23354
p30030
stp30031
a((dp30032
g2
(lp30033
VI'm not an Oracle buff, so I can't verify - but it sounds like they are being passed by position (rather than passed by name)
p30034
aVThe moral equivelent to:
p30035
aVinstead of:
p30036
aVThis isn't hugely uncommon - for years (in the COM days) a lot of my code had to work with a pass-by-position ADODB driver
p30037
aVIn this case, the name that you give serves only as a local key to lookup the value from the collection collection
p30038
aVYou can verify easily by inventing a name:
p30039
aVIf the above runs without error, it is passing by position
p30040
aVAnd it they are passed by position
p30041
aVthen simply add them in the right order ;-p And never add new parameters except at the end
p30042
as(dp30043
g18
V23354
p30044
stp30045
a((dp30046
g2
(lp30047
VAll of WSE (asmx) WSE3 and WCF (svc) web-services work fine over SSL, largely without any changes
p30048
aVIndeed, originally WCF's  security-mode would only work over SSL
p30049
aVFor convenience, it is easiest to host the web-service in IIS and let IIS deal with the SSL (saves having to mess with certificates in code or config files)
p30050
aVI've also seen a glitch in IIS (serving multiple sites) where a WCF endpoint on the non-default site wasn't reachable over http (something to do with the site), but worked fine over https
p30051
aVIt needed a custom service factory to get it working reliably (by completely disabling http, leaving just https)
p30052
as(dp30053
g18
V23354
p30054
stp30055
a((dp30056
g2
(lp30057
VMy understanding is that this is beyond what you can do with xsd
p30058
aVBesides, it makes querying a nightmare
p30059
aVThe preferred approach (if it is possible) is to use:
p30060
aVWhere  and  presumably have a common root  in the xsd, but their own specific properties (on top of the inherited ones)
p30061
as(dp30062
g18
V23354
p30063
stp30064
a((dp30065
g2
(lp30066
VYou could write   method
p30067
aVAlternatively, MiscUtil has generic-enabled  methods, so  should work on a  just fine (since there is a  operator defined)
p30068
aVJust please don't tell me the number
p30069
aVit would scare me
p30070
as(dp30071
g18
V23354
p30072
stp30073
a((dp30074
g2
(lp30075
VObject Browser lists the base-type, interfaces and derived types (or it does for me - it could be one of many add-ons
p30076
as(dp30077
g18
V23354
p30078
stp30079
a((dp30080
g2
(lp30081
VIt is the same thing if  is typed as
p30082
aVIf the variable's type defines a static equality operator or null operator, then it will be different; and if  is defined as  then the compiler will step in and check  instead
p30083
as(dp30084
g18
V23354
p30085
stp30086
a((dp30087
g2
(lp30088
VJon wrote one for Refcardz - Core
p30089
aVNET
p30090
as(dp30091
g18
V23354
p30092
stp30093
a((dp30094
g2
(lp30095
VJust missing the generic type arguments:
p30096
aV(the names , ,  and  could probably be clearer, but I'll assume that is anonymisation)
p30097
as(dp30098
g18
V23354
p30099
stp30100
a((dp30101
g2
(lp30102
VFirst, you aren't actually publishing an event - so at the moment, your code is "at risk" of people messing it up completely
p30103
aVIt should be:
p30104
aVThe name "CurrentTemperatureChanged" is important for data-binding (there is a convention that the runtime uses - given a property Foo, it will look for FooChanged)
p30105
aVHowever, IMO this should just be regular
p30106
aVData-binding will look for , but more importantly: you aren't actually giving any information in the event that the subscriber can't already get just by looking at
p30107
aVI'll give the rest of the answer in terms of , but I would encourage you (again) to switch to :
p30108
aVThe approach:
p30109
aVis reasonable, but (as per other replies) there is a slim risk of callers that think they disconnected getting the event
p30110
aVUnlikely in reality
p30111
aVAnother approach is an extension method:
p30112
aVThen in your class you can just use:
p30113
as(dp30114
g18
V23354
p30115
stp30116
a((dp30117
g2
(lp30118
VIn
p30119
aVNET terms, I think what you are describing is the  - and it exists in all of
p30120
aVNET, not just C#
p30121
aVI'm not sure that a "closure" would a "type" in the same was as a comparer/predicate/transformer, since in C# terms a closure is simply an implementation detail but can be any of those three
p30122
aVIn
p30123
aVNET, delegates are used in two main ways:
p30124
aVas the eventing mechanism
p30125
aVto provide functional-style programming
p30126
aVThe first is important, but it sounds like you are more interested in the second
p30127
aVIn reality, they operate much like single-method interfaces
p30128
aVconsider:
p30129
aVA closure is more where we bring additional scope from outside the delegate into the delegate:
p30130
aVhere the  is captured into the delegate as a closure
p30131
aVRe "Are classes within the framework prepaired for this
p30132
aV- many are, and LINQ goes a long way to allowing this even wider
p30133
aVLINQ provides extension methods over (for example) all of  - meaning that collections without delegate-based access aquire them for free:
p30134
aVHere the  and  methods are LINQ extension methods that take delegates
p30135
as(dp30136
g18
V23354
p30137
stp30138
a((dp30139
g2
(lp30140
VThe difference between an instance call and a static call is so miniscule that I would happily wager that it has nothing to do with your performance issue
p30141
aVAt all
p30142
aVYes, static call is technically faster (by a tiny, tiny amount), but that is nothing compared to all the file IO you are doing
p30143
aVAs has already been stated - profile your code, and stop worrying about things like this (premature optimisation)
p30144
aVMost likely, the bottleneck is poor collection performance, perhaps fixable with dictionary etc
p30145
aVTimings:
p30146
aVSo 2ms difference over 50M calls
p30147
aVForget about it
p30148
aVBased on:
p30149
aVedit:
p30150
aVIf we assume (for example) that we create a new method every 20 calls (), then the metrics change to:
p30151
aVAgain - nowhere near enough to indicate a bottleneck, when that is over 50M calls, and we're still under a second
p30152
as(dp30153
g18
V23354
p30154
stp30155
a((dp30156
g2
(lp30157
VAs an aside - to save yourself having to create countless delegate types:
p30158
aVAdditionally, this now does regular static checks on the inner call to , so you can't get it wrong
p30159
as(dp30160
g18
V23354
p30161
stp30162
a((dp30163
g2
(lp30164
VThe first question I'd ask is: why are you using reflection here
p30165
aVJust set the value through the public API
p30166
aVIf you are messing underneath the public API, then yes: it is entirely possible that some events won't get fired
p30167
aVPerhaps if you could show us exactly how you are doing this
p30168
as(dp30169
g18
V23354
p30170
stp30171
a((dp30172
g2
(lp30173
VThe MS Charting Control
p30174
as(dp30175
g18
V23354
p30176
stp30177
a((dp30178
g2
(lp30179
VDo you mean just adding:
p30180
aV(which solves the "definite assignment" glitch; it is definitely assigned
p30181
aVa null ;-p We then update the value before it is used)
p30182
aVIMO, though, you'd do better with nested  statements
p30183
aVand it isn't clear (from the code) where the actual connection is going to come from
p30184
as(dp30185
g18
V23354
p30186
stp30187
a((dp30188
g2
(lp30189
VWhat version of the framework are you using
p30190
aVYou can use "caspol
p30191
aVexe" to provide extra trust for shares that you specify, but with
p30192
aVNET 3
p30193
aV5 SP1 installed, network shares get the same trust anyway: see here:
p30194
aVManaged applications that are opened
p30195
aVfrom network shares have the same
p30196
aVbehavior as native applications by
p30197
aVrunning with full trust
p30198
aVI can't remember whether that applies equally to mapped shares (F:) and UNC shares (\u005c\u005cmyserver\u005csomeshare), but it would be easy to test
p30199
aVYou could also consider ClickOnce, which is IMO the easiest way to deploy full
p30200
aVNET applications to network / web locations
p30201
as(dp30202
g18
V23354
p30203
stp30204
a((dp30205
g2
(lp30206
VThe enhanced debugging (for a dll not in the current solution) depends largely on whether you have the debugging symbols file (
p30207
aVpdb) in an obvious location - in particular, next to the dll itself
p30208
aVYou can also load symbols manually from the modules window (when debugging, Debug -> Windows -> Module, right-click, Load Symbols From
p30209
as(dp30210
g18
V23354
p30211
stp30212
a((dp30213
g2
(lp30214
VIf you are writing a large volume of homogeneous data,  may be a more appropriate tool, for example perhaps with  to read lines (since  can accept an , which means you don't have to buffer all 30k lines into memory)
p30215
aVIf the data is CSV, this can be as simple as:
p30216
aVIf the data is more complex (not-CSV), then  might be useful - you just subclass it and add the code to represent your data per row
p30217
as(dp30218
g18
V23354
p30219
stp30220
a((dp30221
g2
(lp30222
VIf all the fields are required, then they are required
p30223
aVUsing a dictionary can only add overhead and incur extra memory costs
p30224
aVA dictionary approach may be useful in a few specific scenarios, such as property bag implementations, and sparse event handlers (since events are the most obvious sparse data)
p30225
aVIf the fields are used sparsely (i
p30226
ag50
aVoften not more than a few are in use), then perhaps push the related fields into a number of inner classes (per group of related fields) - i
p30227
ag50
aVinstead of:
p30228
aVsomething like:
p30229
aVThen when you have to store the user data, create a new ; if you don't need the user data, leave  null
p30230
as(dp30231
g18
V23354
p30232
stp30233
a((dp30234
g2
(lp30235
VAFAIK,  is not supported by  (although it would be nice - I've simply never checked)
p30236
aVAnd as you say, you can't add member attributes in a partial class
p30237
aVOne option may be to make the generated properties non-public (,  or ) - and name it something like  (etc) - then re-expose them (in the partial class) on the public API:
p30238
aV(since  only looks at the public API)
p30239
aVThe biggest problem here is that LINQ-to-SQL queries ( etc) will only work against the generated columns ( etc)
p30240
aVI've used this approach before with the member as , allowing my DAL class to use the  property
p30241
aVbut it is a bit of a fudge
p30242
as(dp30243
g18
V23354
p30244
stp30245
a((dp30246
g2
(lp30247
VWhat framework version are you targetting
p30248
aVIf you are targetting CF 2
p30249
aV0 from VS2008, you may need to declare ExtensionAttribute
p30250
as(dp30251
g18
V23354
p30252
stp30253
a((dp30254
g2
(lp30255
VIs it a web site or a a web project
p30256
aVWith a web project the linked file should work fine
p30257
aValthough personally I'd rather keep them separate and update them through my build script
p30258
as(dp30259
g18
V23354
p30260
stp30261
a((dp30262
g2
(lp30263
VI expect you mean:
p30264
aVand:
p30265
aVTo use as a method, I would make it :
p30266
aVand call as:
p30267
as(dp30268
g18
V23354
p30269
stp30270
a((dp30271
g2
(lp30272
VIt sounds like you're doing everything on the UI thread and thus not releasing the message pump
p30273
aVHave you tried using smoething like  and the  event
p30274
aVSee MSDN for an example
p30275
aVis ideal for loading external data - but note that you shouldn't do any data-binding etc until you get back to the UI thread (or just use / to push work to the UI thread)
p30276
as(dp30277
g18
V23354
p30278
stp30279
a((dp30280
g2
(lp30281
VIs the relationship always there in both directions
p30282
ag412
ag50
aVif John and Jill are related, then is there always a {John,Jill} and {Jill,John}
p30283
aVIf so, just limit to those where Person_1 < Person_2 and take the distinct set
p30284
as(dp30285
g18
V23354
p30286
stp30287
a((dp30288
g2
(lp30289
VThere are a few approaches - you could associate each processor a token, and have a SPROC that sets that token against the next [n] available items; perhaps something like:
p30290
aV(note - needs suitable isolation-level; perhaps serializable: )
p30291
aV(edited to fix TSQL)
p30292
aVYou'd also want a timeout () on this, so that when a processor goes down you don't lose work
p30293
aVYou'd also need a task to clear the owner on things that are past their
p30294
as(dp30295
g18
V23354
p30296
stp30297
a((dp30298
g2
(lp30299
VI believe the thinking is that if you have the project in the solution, you probably are "close enough" to the code to want to see even hidden methods - where-as if you are consuming just a dll, you probably aren't
p30300
aVThere is a community comment with the same symptom in MSDN (bottom of the page)
p30301
as(dp30302
g18
V23354
p30303
stp30304
a((dp30305
g2
(lp30306
VThe fact that it logs "ten" would make me look first at:
p30307
aVis  ever assigned
p30308
aVis this perhaps becoming null somehow
p30309
aVis the bug inside  itself
p30310
aVHard to tell without enough context for either - but that is how I'd investigate it
p30311
aVYou could also add a simple  test somewhere; as a cheeky approach, you could rename the  method to something else, and add an extension method:
p30312
aVYour existing code should call the new  extension method, and the exception will make it clear exactly where it barfed
p30313
aVMaybe change it back once fixed
p30314
aVor maybe leave it
p30315
as(dp30316
g18
V23354
p30317
stp30318
a((dp30319
g2
(lp30320
VRandom thought: I wonder if you could write a second assembly as a small console exe that does this communication
p30321
aVlaunch it with  and capture results either via the file system or by intercepting stdout
p30322
aVThen if it hangs you can kill the process
p30323
aVA bit harsh, maybe - and obviously it has overheads of spawning a process - but it should at least be possible to kill it
p30324
as(dp30325
g18
V23354
p30326
stp30327
a((dp30328
g2
(lp30329
VWhat is the provider here
p30330
aVLINQ-to-SQL
p30331
aVObjects
p30332
aVEntity Framework
p30333
aV(from the name, it looks like LINQ-to-SQL
p30334
aVIndeed, database providers won't be able to process your method; you have a few options:
p30335
aVinline it:
p30336
aVmap it to a UDF (LINQ-to-SQL only) that accepts a
p30337
aVThe first is probably easier
p30338
aVif you get problems with it not recognising System
p30339
aVDateTime
p30340
aVNow
p30341
aVMonth, then do that first into a variable
p30342
as(dp30343
g18
V23354
p30344
stp30345
a((dp30346
g2
(lp30347
VPurely, convenience
p30348
aVyou don't know how much state you are going to need when defining, for example, a  - consider:
p30349
aVhere we've passed two additional bits of state into  ( and ) - but we can't define  to know about that, as that is a caller detail
p30350
aVThe alternative is to write the classes ourselves, but that is hard, even if we are lazy:
p30351
aVI don't know about you, but I prefer the version with the closure
p30352
aVespecially when you consider how complex it gets when you have multiple contextual levels
p30353
aVI want the compiler to worry about it
p30354
aVConsider also how often you use such constructs, especially for things like LINQ: you wouldn't want to have to do it any other way
p30355
as(dp30356
g18
V23354
p30357
stp30358
a((dp30359
g2
(lp30360
VHTML as a full page request is not in the least bit granular:
p30361
aVyour browser sends a request (of all the form variables, cookies, etc etc) to the server
p30362
aVthe server does a bit of processing and sends a response (typically html)
p30363
aVyour browser processes the response and renders the display
p30364
aVAll your updates are happening in the middle bullet, so no: there is no way to make the browser update: your code is executing on the server, with no dialog with the client
p30365
aVIf you need this type of behaviour, you would have to look at AJAX tools - at each step doing "just enough" work to get to the next milestone and update the caption
p30366
aVwith regular ASP
p30367
aVNET UpdatePanel may be of interest; for MVC or other (non-ASP
p30368
aVNET) setups, jQuery would be your friend
p30369
aVUnfortunately, this isn't a trivial topic
p30370
as(dp30371
g18
V23354
p30372
stp30373
a((dp30374
g2
(lp30375
VYou need the counts to be the same
p30376
aVYou need to count the words, then
p30377
as(dp30378
g18
V23354
p30379
stp30380
a((dp30381
g2
(lp30382
VWhat is the serializer
p30383
aVWith , that would be very, very tricky
p30384
aVWith xml, you could perhaps pre-process the xml, but that it very tricky
p30385
aVOther serializers exist, though - for example, with protobuf-net there is little difference between an array/list of items, and a sequence of individual items - so it would be pretty easy to pick of a finite sequence of items without processing the entire array
p30386
aVComplete protobuf-net example:
p30387
aVNote that  is a lazy/streaming API, so it only consumes data from the stream as you iterate over it - hence the LINQ  avoids us reading the whole stream
p30388
as(dp30389
g18
V23354
p30390
stp30391
a((dp30392
g2
(lp30393
Vetc (with  at the top of the code file)
p30394
as(dp30395
g18
V23354
p30396
stp30397
a((dp30398
g2
(lp30399
V should be reliable; I've just checked, at this works fine with suppressed transactions, too:
p30400
as(dp30401
g18
V23354
p30402
stp30403
a((dp30404
g2
(lp30405
VWell, one obvious case when it will return false is when the object isn't a proxy, but is a regular
p30406
aVNET object in the local domain (no remoting involved)
p30407
aVI don't understand the MSDN note fully, either ;-p
p30408
as(dp30409
g18
V23354
p30410
stp30411
a((dp30412
g2
(lp30413
VCreating a repository instance per request by itself shouldn't cause any performance issue; the repository is often pretty shallow, and when it needs to access data things like connection pooling minimise the cost of establishing actual connections
p30414
aVObject creation is astonishingly cheap, especially for short-lived things like web requests where the object gets collected while still in "generation zero"
p30415
aVAs to whether to have a single repository or a repository per instance - that depends on the repository ;-p
p30416
aVThe biggest question is: is your repository thread safe
p30417
aVIf not: one per request
p30418
aVEven if it is though; if your repository itself keeps something like a LINQ-to-SQL  (that you synchronize somehow), then you have big problems if you keep this long-term, in particular with the identity manager
p30419
aVYou'll quickly use a lot of memory and get stale results
p30420
aVFar form ideal
p30421
aVWith a single repository instance, you will probably also end up with a lot of blocking trying to get thread safety
p30422
aVThis can reduce throughput
p30423
aVConversely, the database itself has good ways of achieving granular locks - which is particularly useful when you consider that often, concurrent requests will be looking at separate tables etc - so no blocking at the database layer
p30424
aVThis would be very hard to do just at the repository layer - so you'd probably have to synchronize the entire "fetch" - very bad
p30425
aVIMO, one per request is fine in most cases
p30426
aVIf you want to cache data, do it separately - i
p30427
ag50
aVnot directly on the repository instance
p30428
as(dp30429
g18
V23354
p30430
stp30431
a((dp30432
g2
(lp30433
VIf you are writing xml, I wonder whether xml serializer wouldn't be a better choice (it has more granular control over the names, etc)
p30434
aVThe problem, though, is that  isn't always the biggest fan of generics
p30435
aVAdditionally - having tried a few options involving  / ] etc
p30436
aVit looks very hard to get it to the format you want
p30437
aVplus it isn't easy to guess what you mean by the  /  - but the following may come close:
p30438
aVThis has both  and  attributes, but I had to lose the generics in the type we use for the response (hence the "closed"  type)
p30439
as(dp30440
g18
V23354
p30441
stp30442
a((dp30443
g2
(lp30444
VIf you mean an  that is a (boxed)  /  -  etc
p30445
aVIf you mean a  that might be either
p30446
ag23295
as(dp30447
g18
V23354
p30448
stp30449
a((dp30450
g2
(lp30451
VThe  method checks for , using  - so in the case of arrays and lists, it is not much more inefficient (just an extra level of indirection)
p30452
as(dp30453
g18
V23354
p30454
stp30455
a((dp30456
g2
(lp30457
VThis is exactly what the DLR code on codeplex had to do; in the end, they re-created the entire codebase in a different namespace (IIRC), until 4
p30458
aV0 gets shipped
p30459
aVThis doesn't necessarily play nicely with the C# compiler; I honestly haven't tried
p30460
as(dp30461
g18
V23354
p30462
stp30463
a((dp30464
g2
(lp30465
V is a standard win32 control, that doesn't (AFAIK) have any support for this
p30466
aVYour best option would be to look for a different control that does support this type of use - of perhaps switch to WPF, where things are a lot more customizable
p30467
as(dp30468
g18
V23354
p30469
stp30470
a((dp30471
g2
(lp30472
VI can't see any obvious way of getting it to output those results without changing the classes radically
p30473
aVthis might not be what you want, but by mirroring the desired output (not uncommon in DTOs) it gets the right result
p30474
aVOtherwise, you might be looking at , which is a huge pain:
p30475
as(dp30476
g18
V23354
p30477
stp30478
a((dp30479
g2
(lp30480
VTrade
p30481
aVTradeStatus is an instance of the class TradeOrderStatus
p30482
aVYou mention it is a class; is it the same instance as one of those in the data-bound list
p30483
aVIt needs to find an equality match
p30484
aVAlternatively, you can override  (and  - always keep the two in sync) to achieve the same thing
p30485
aV(edit)
p30486
aVThe simplest way to fix it is to bind to ; with the "full" example (below), something like:
p30487
aV(edit)
p30488
aVHere's a C# example (sorry, my VB-fu is weak) of providing custom equality of the different statuses - note the "uncomment to fix":
p30489
as(dp30490
g18
V23354
p30491
stp30492
a((dp30493
g2
(lp30494
VYou can get a lot (but not all) of this via :
p30495
as(dp30496
g18
V23354
p30497
stp30498
a((dp30499
g2
(lp30500
VEither should be fine, in reality (as long as the  is immutable)
p30501
aVA  and a reference shouldn't be enough to make it oversized
p30502
aVI assume you are using it as the value (not the key) in the dictionary
p30503
aVIf used as the key you would need to override  and , regardless of  vs
p30504
as(dp30505
g18
V23354
p30506
stp30507
a((dp30508
g2
(lp30509
VYou should be able to interpolate
p30510
aVThis example is winforms, but the maths is identical - simply that with ASP
p30511
aVNET you'd have to write the color in the hex form
p30512
aVYou may also (with ASP
p30513
aVNET) need to find the RGB values separately - but for info, Khaki (in winforms) is {240,230,140} (red is obviously {255,0,0})
p30514
as(dp30515
g18
V23354
p30516
stp30517
a((dp30518
g2
(lp30519
VHow about some reflection, perhaps using  for performance
p30520
aV(note the static ctor here ensures we only compile it once per ):
p30521
aVEdit: updated to handle fields too:
p30522
as(dp30523
g18
V23354
p30524
stp30525
a((dp30526
g2
(lp30527
VMiscUtil has generic aggregate functions (, , etc) built in, using
p30528
aVNET 3
p30529
aV5 to provide generic operator support at runtime
p30530
aVAdditionally, C# 4
p30531
aV0 makes this possible via  (which supports operators), but the above approach is usually faster (less indirection)
p30532
as(dp30533
g18
V23354
p30534
stp30535
a((dp30536
g2
(lp30537
VThe only time you need to add ] etc to the enum is if:
p30538
aVyou don't want them all exposed (see Pwninstein's answer)
p30539
aVyou want to change the text on the wire for compatibility reasons (set )
p30540
aVMSDN has an example of the latter
p30541
as(dp30542
g18
V23354
p30543
stp30544
a((dp30545
g2
(lp30546
VIf  isn't working, perhaps it is barfing at the syntax
p30547
aVperhaps:
p30548
aVmight work
p30549
aV(edit)
p30550
aVIt also seems likely that the validator is going to read the value once, not continually
p30551
aVperhaps make sure this executes before you initialize the validation library
p30552
as(dp30553
g18
V23354
p30554
stp30555
a((dp30556
g2
(lp30557
VAny reason that you can't have:
p30558
aVand use  to make it more specific
p30559
aVThen your method can just use
p30560
aVYou'd need something like (int ):
p30561
aV(edit)
p30562
aVAnother option would be a method on the non-generic :
p30563
aV(maybe a bit more specific about what it copies to/from)
p30564
aVYour concrete implementation () would have to assume that the  is actually an  and cast:
p30565
as(dp30566
g18
V23354
p30567
stp30568
a((dp30569
g2
(lp30570
VMinimalist answer:
p30571
aVLess to get wrong
p30572
as(dp30573
g18
V23354
p30574
stp30575
a((dp30576
g2
(lp30577
VThat depends entirely on what you mean by "stalled"
p30578
aVIf you have managed to deadlock the worker thread, then you'll need to find the problem and unpick the mess
p30579
aVIf it is throwing an exception, then the  event should fire, with a non-null  in the event-args
p30580
as(dp30581
g18
V23354
p30582
stp30583
a((dp30584
g2
(lp30585
VOne common reason is that stored procedures have notoriously weak metadata, particularly for complex code with branches etc
p30586
aVIt is very hard for the external code to really understand what is being selected/returned
p30587
aVA common trick is to replace the sproc with something mind-numbingly simple (i
p30588
ag50
aVthat simply returns any sample data of the desired schema) for the process of inspection, and then swap back to the real code
p30589
aVAlternatively, if possible consider swapping to a UDF - as UDFs have much stronger schema metadata
p30590
aVOf course, you could also hand-edit the DBML based on something similar that works correctly
p30591
aVAs an aside - you may have a number of issues with that existing code, including (but not limited to) DML/DDL transitions (forces recompile), multiple updates to the same table (forces selective recompile) - not to mention the cursor usage (which may of may not be necessary)
p30592
aVTable variables (@table rather than #table) may be useful too
p30593
aVI'm not offering to re-write it; just note some things you might want to look at
p30594
as(dp30595
g18
V23354
p30596
stp30597
a((dp30598
g2
(lp30599
VI'd accept Mehrdad's answer - I just wanted to give more context on when you might use these attributes:
p30600
aVThings like  are more generally used to control things like logging/tracing, or interactions with an executing debugger; where it makes sense for the calls to be in the middle of your regular code, but which you might not want in certain builds (and #if
p30601
aVetc is just so ugly and easy to forget)
p30602
as(dp30603
g18
V23354
p30604
stp30605
a((dp30606
g2
(lp30607
VExceptions aren't really all that expensive - but they also aren't necessarily the best way to manage expected/normal flow
p30608
aVTo me, it sounds like you aren't actually implementing a  - you are encapsulating a stream into a "reader"
p30609
aVI might be inclined to write a protocol-specific reader class with suitable methods to detect the end of a record, or  methods to get data or return false
p30610
as(dp30611
g18
V23354
p30612
stp30613
a((dp30614
g2
(lp30615
VWith MVC the  approach isn't uncommon; as such, here's some example code that shows how to pass an  into such a function, and get the value and metadata (attributes); the  (or similar) replaces the  argument:
p30616
aV(sorry, example is C# - my VB isn't strong enough to try)
p30617
aVSo you would have to write an overload of  that takes the  instead of the , does the evaluation (as above) and writes the html appropriately
p30618
as(dp30619
g18
V23354
p30620
stp30621
a((dp30622
g2
(lp30623
VIt isn't clear from the question, but it sounds like you have the data from the database, and now need to expose it on a web-service
p30624
aVIn terms of SOAP etc, this can be as simple as either returning a , or exposing a  on a DTO
p30625
aVIf the field is large, you may want to consider MTOM (WSE3) and/or web compression
p30626
aVSo: how does Oracle expose the BLOB to you
p30627
aVIf it isn't a , is it perhaps something like LINQ's  class, which provides encapsulated access to the data ( in this case)
p30628
aVIf it is exposing a , I would guess that it is base-64 encoded; you could try running
p30629
as(dp30630
g18
V23354
p30631
stp30632
a((dp30633
g2
(lp30634
VIf you mean LINQ-to-SQL, you need to drag the stored procedures onto the designer surface first
p30635
aVThen they become editable, allowing you to select the sproc and do the mapping to parameters
p30636
as(dp30637
g18
V23354
p30638
stp30639
a((dp30640
g2
(lp30641
VAs far as I know, no they are not
p30642
aVIf you don't want to delete it
p30643
aVdon't call delete
p30644
aVHowever, some other options:
p30645
aVyou could map the delete to a stored procedure that just sets the flag at the database
p30646
aVyou may be able to override  and fix-up any changes (via ) before calling  - however, I'm dubious as to whether this is a good idea; it may need re-inserting the item, for example
p30647
aVCode:
p30648
aVObviously if it needs to be more flexible you may want to use  (rather than a rigid  property)
p30649
aVUpdates re your comment; I honestly don't think you can do it at that point; re the "10 places" thing
p30650
aVIMO you should be hiding the data-context behind a repository interface anyway, so all 10 places would be calling a method like  which deals with the data-context and necessary logic (perhaps with a separate business logic class to handle some of the rules)
p30651
aVAnd further, uniqueness should usually be handled at the database level anyway (via a constraint) due to concurrency concerns
p30652
aVBut to do what you want before trying to save them:
p30653
as(dp30654
g18
V23354
p30655
stp30656
a((dp30657
g2
(lp30658
VMethods are never serialized
p30659
aVRe "fields" - it all depends on the serializer;  will do fields; you mention "remoting", which suggests , but remoting is largely a hangover now - from MSDN (on remoting):
p30660
aVThis topic is specific to a legacy
p30661
aVtechnology that is retained for
p30662
aVbackward compatibility with existing
p30663
aVapplications and is not recommended
p30664
aVfor new development
p30665
aVDistributed
p30666
aVapplications should now be developed
p30667
aVusing the Windows Communication
p30668
aVFoundation (WCF)
p30669
aVIf you use web-services or WCF:  does public fields+properties;  will do marked fields, etc
p30670
aVRegular classes are often reusable as DTOs, but if you need lots of control over the wire (or have versioning issues), a separate DTO can be helpful
p30671
aV(edit/additional) note also that there are other reasons not to like  - it can be very brittle with versioning, and very painful to fix (although achievable)
p30672
aVOther (more tolerant) serializers exist if this is likely to be an issue
p30673
aVif so, let me know and I'll update
p30674
as(dp30675
g18
V23354
p30676
stp30677
a((dp30678
g2
(lp30679
VI think you just need two methods:
p30680
aVThen you can use:
p30681
aVand likewise use the other version for methods with a return value
p30682
aVIf you need to, you can also make the delegates take the service itself as an argument - which might be handy for  reasons:
p30683
as(dp30684
g18
V23354
p30685
stp30686
a((dp30687
g2
(lp30688
VJust as an edge case
p30689
aVyou can create objects without using the ctor at all:
p30690
as(dp30691
g18
V23354
p30692
stp30693
a((dp30694
g2
(lp30695
V here is going to be a set () of data
p30696
aVYou may need to use , for example:
p30697
as(dp30698
g18
V23354
p30699
stp30700
a((dp30701
g2
(lp30702
VOn the data-context are a number of partial methods for insert/update/delete of each entity type; if you implement the other half of this, you can provide your own SP logic:
p30703
aVNote that if you use a separate connection you won't have the same transaction etc (unless it uses )
p30704
as(dp30705
g18
V23354
p30706
stp30707
a((dp30708
g2
(lp30709
VSince the collection doesn't provide any  mechanism, this is probably the most practical option
p30710
aVYou could implement a sort manually using  etc, but it will probably be slower than doing in this way
p30711
aVAdditionally, you might consider unbinding any UI elements while sorting (via either approach) you only pay to re-bind once:
p30712
aVInterestingly, if this was , you could use  to minimise the number of notifications:
p30713
as(dp30714
g18
V23354
p30715
stp30716
a((dp30717
g2
(lp30718
VThe HTML Agility Pack will parse html, rather than xhtml, and is quite forgiving
p30719
aVThe object model will be familiar if you've used
p30720
as(dp30721
g18
V23354
p30722
stp30723
a((dp30724
g2
(lp30725
VApart from always returning true, and possibly using  (if the service is ), I can't see anything obviously wrong
p30726
aVHave you tried tracing it with fiddler or wireshark to see what is happening at the transport level
p30727
aVYou could try adding , but while this may tidy things up I'm not sure it will fix this issue:
p30728
as(dp30729
g18
V23354
p30730
stp30731
a((dp30732
g2
(lp30733
Vthe class  and  are completely separate; the language allows generic type overloading
p30734
aVPerhaps declare this method on a non-generic twin class:
p30735
aVOtherwise
p30736
aVwhat  would it use
p30737
aVAnd what if the static method talked to static fields
p30738
aVLet alone which  to use, each  gets different static fields (i
p30739
ag50
aVhas separate fields to )
p30740
as(dp30741
g18
V23354
p30742
stp30743
a((dp30744
g2
(lp30745
VIt isn't entirely clear to me, but I'm going to assume that the arguments are actually:
p30746
aVthe spacing etc is important due to how the  system splits arguments
p30747
aVIn a  method, that will be an array length 2
p30748
aVYou can process this, for example into a dictionary:
p30749
as(dp30750
g18
V23354
p30751
stp30752
a((dp30753
g2
(lp30754
V/ is the core polymorphism pair; sounds like you've already cracked these
p30755
aVis like , but there is no sensible base implementation; use-cases: perhaps a , where it is necessary for the actual implementation to do something with the bytes
p30756
aVThis forces the class to be
p30757
aVshould usually be avoided; it breaks polymorphism
p30758
aVthe most common case is to re-expose with a more specific signature / return-type (perhaps in a sealed class, since it doesn't get prettier up the chain
p30759
aV- see  (vs ), or (perhaps more notably)  (vs )
p30760
as(dp30761
g18
V23354
p30762
stp30763
a((dp30764
g2
(lp30765
VIt sounds like there is some recursion going on when processing the xml, that is essentially causing a stack overflow (by any name)
p30766
aVThoughts:
p30767
aVwork with less data
p30768
aVif you are processing the data manually, try to use less recursion
p30769
aVperhaps manual tail-call or queue/stack based
p30770
aVconsider json - then you can offload to the script host to rehydrate the object without any extra processing
p30771
as(dp30772
g18
V23354
p30773
stp30774
a((dp30775
g2
(lp30776
VCan you give any indication what you are doing at this point
p30777
aVOne option would be i18n issues - i
p30778
ag50
aVdoes the 2008 server have different regional settings to your machine
p30779
aVthis might mean that you are building some TSQL that is different (for example, formatting a date differently), and it no longer fits in the specified field (, for example, will take some date formats but not others)
p30780
aVOf course, the real fix here is to use a  - but this is just an example
p30781
aVI think your best bet comes from doing a sql trace using the sql development tools; this will make it obvious what is actually being sent
p30782
as(dp30783
g18
V23354
p30784
stp30785
a((dp30786
g2
(lp30787
VYou should be able to use query string like normal
p30788
aVThe trick is how your app looks for those arguments (plus it must have url arguments enabled in the publish properties) - you should check  - if set, look at either  (the first item in the array) or (simpler) the  of the current deployment
p30789
as(dp30790
g18
V23354
p30791
stp30792
a((dp30793
g2
(lp30794
VThere are several important interfaces for data-binding; in particular, , which has the  event that  can listen for
p30795
aVIs it possible to change the concrete list to a
p30796
aVThat should give you most of this for free
p30797
aVYou don't need to change the return type, as , and  only knows about the actual object (it doesn't care that you call it )
p30798
aVThe other pragmatic option is simply to reset the data-binding on the  - perhaps set the  to  and then back:
p30799
as(dp30800
g18
V23354
p30801
stp30802
a((dp30803
g2
(lp30804
VYou might have a look at the  from this post - based on , but with hooks into the data-context
p30805
as(dp30806
g18
V23354
p30807
stp30808
a((dp30809
g2
(lp30810
V just gives you back a reflection-based  for the type in question (it isn't , for example)
p30811
aVWhat is the scenario here
p30812
aVIf you just need to display extra data in , the simplest option is simply to add an extra unbound column to the grid
p30813
aVYou can extend types at runtime, but for lists you have two main options:
p30814
aV(if each instance of the list can have different columns) - see this answer
p30815
aV- allows you to add custom properties per-type (ultimately boils down to writing a , just like the first example - but different hooks)
p30816
aVThe full rules of how list-based metadata is fetched are in this answer
p30817
as(dp30818
g18
V23354
p30819
stp30820
a((dp30821
g2
(lp30822
VIf  is an , then this isn't a regular C# delegate, but is an expression tree
p30823
aVSome code (the LINQ provider) has to pull this tree apart and understand it - so if you have oddities in the expressions, then expect odd output
p30824
as(dp30825
g18
V23354
p30826
stp30827
a((dp30828
g2
(lp30829
VActually, you can use  and  - just not directly with the calling method's parameters; you can, however, just copy the values before and after invoking:
p30830
as(dp30831
g18
V23354
p30832
stp30833
a((dp30834
g2
(lp30835
VIf the code was previously using just the in-memory state provider, then this could be
p30836
aVtricky
p30837
aVIt is a pain point that the serialization process (via , which the database state provider uses) requires the  attribute when the default provider doesn't
p30838
aVHow much of the code can you edit
p30839
aVAny of it
p30840
aVFor example, can you change the code that puts things into/out-of state
p30841
aVYou could perhaps use a separate (serializable) DTO with the necessary properties and translate between them with your own code
p30842
aVOther options:
p30843
aVgo back to the in-memory provider (and wave goodbye to a cluster)
p30844
aVwrite a provider that doesn't use
p30845
aVI have some thoughts on the latter, but I doubt it would be trivial
p30846
as(dp30847
g18
V23354
p30848
stp30849
a((dp30850
g2
(lp30851
VIt looks to me like you have a borked primary key
p30852
aVThe "identity management" aspect of LINQ-to-SQL and EF means that it is obliged to give you back the same instance whenever it sees the same primary key value(s) for the same object type
p30853
aVFor example, given the data:
p30854
aVThen if it thinks  is a primary key when iterating over the objects from LINQ, it is forced to give you "Fred", "Barney", "Fred", "Fred"
p30855
aVEssentially, when it sees  1 again, it doesn't even look at the other columns - it simply fetches the instance with  1 from the identity cache - and gives you the same Fred instance it gave you previously
p30856
aVIf it doesn't think  is a primary key, it will treat each row as a separate object (and so what if it has the same value in one of the fields as another record - that isn't exactly unusual)
p30857
aVI would advise checking that any fields you have marked as a primary key (in your DBML/EDM model) really are unique per row
p30858
aVIn the case above, the  column clearly doesn't represent a unique identifier, so is not suitable as a primary key
p30859
aVJust unmark it as such in the LINQ-to-SQL / EF designer
p30860
aVupdate: in particular, look at the "Entity Key" property for the various properties in the designer - especially if you are querying a view
p30861
aVCheck that "Entity Key" is only set to true for suitable columns (i
p30862
ag50
aVthose that make the row unique)
p30863
aVIf it is set incorrectly, set it to false
p30864
aVThis is also visible as the yellow key icon - this should only appear on things that genuinely are unique identifiers for a record
p30865
as(dp30866
g18
V23354
p30867
stp30868
a((dp30869
g2
(lp30870
VThe name of the server and database should be in the connection string (in the config file); what does it currently look like
p30871
aVAnd what is the exact error message
p30872
aVThe exact connection string depends on your setup (for example, is the server a "named instance"
p30873
aVThe other thing I can think of
p30874
aVare the objects in the right schema
p30875
ag412
ag50
aVare they "daniel
p30876
aVsometable" on your machine, but "dbo
p30877
aVsometable" on the server
p30878
aVThis matters, since the dbml includes the schema
p30879
aVFortunately, you can edit the dbml (it is just xml) and use "replace all" (i
p30880
ag50
aVctrl+h) to fix this
p30881
as(dp30882
g18
V23354
p30883
stp30884
a((dp30885
g2
(lp30886
V is returning a struct, which means that you are editing a copy
p30887
aVYou will need something like:
p30888
as(dp30889
g18
V23354
p30890
stp30891
a((dp30892
g2
(lp30893
VJust to add - with immutable structs, you are likely to have to do parameter matching to the constructor
p30894
aVUnfortunately this is tricky when there can be multiple constructs, and especially since some types have a separate static "Create" method instead of a public constructor
p30895
aVBut assuming you've done the matching, you can still use :
p30896
aVHowever - the code to pick a constructor (the above has 3
p30897
aVisn't easy
p30898
aVYou could say "pick the most complex" and then attempt to match parameter names to property names (case insensitive)
p30899
aVA nave example:
p30900
as(dp30901
g18
V23354
p30902
stp30903
a((dp30904
g2
(lp30905
Vnumber of seconds since 1970
p30906
as(dp30907
g18
V23354
p30908
stp30909
a((dp30910
g2
(lp30911
VNote that it is very rare you need to mess with ; fields are rarely public, and you should generally be using the s ()
p30912
aVHowever,  will work
p30913
aVFor public fields, just ; for private fields too you need :
p30914
as(dp30915
g18
V23354
p30916
stp30917
a((dp30918
g2
(lp30919
VI think you just need:
p30920
aVedit - btw -  is your friend here:
p30921
as(dp30922
g18
V23354
p30923
stp30924
a((dp30925
g2
(lp30926
VHere's one way of doing it; it uses a recursive CTE to find the ancestry of a node, and uses "CROSS APPLY" over the input values to get the common ancestry; you just change the values in  (table variable):
p30927
aVUpdate if the nodes aren't strictly ascending:
p30928
aVand
p30929
as(dp30930
g18
V23354
p30931
stp30932
a((dp30933
g2
(lp30934
VIt looks like you are using a database as the back end
p30935
aVYou can't provide a custom comparer for this, as it can't be mapped to TSQL
p30936
aVHave you tried
p30937
ag412
ag50
as(dp30938
g18
V23354
p30939
stp30940
a((dp30941
g2
(lp30942
VI'm assuming that the namespace and (data-context) type name are correct
p30943
aVdouble check that first
p30944
aVIt sounds to me like the codegen has failed, and so you only have your half of the data-context (not the half that the IDE is meant to provide)
p30945
aVThere is a known bug in LINQ-to-SQL where this can fail if (as in your case) the  declarations are above the namespace
p30946
aVNo, I am not joking
p30947
aVTry changing the code:
p30948
aVNow go into the designer, tweak something (for example, change the name of a property and change it back again) and hit save (this forces the codegen)
p30949
aVNow see if it works
p30950
as(dp30951
g18
V23354
p30952
stp30953
a((dp30954
g2
(lp30955
VEdited for 2
p30956
aV0; it can become:
p30957
aVHow about (in
p30958
aVNET 3
p30959
aV5):
p30960
aVTo show this in context:
p30961
as(dp30962
g18
V23354
p30963
stp30964
a((dp30965
g2
(lp30966
VIf you are going to look at lots of different cells:
p30967
aVIf you only want [0][2], you can limit it a bit
p30968
as(dp30969
g18
V23354
p30970
stp30971
a((dp30972
g2
(lp30973
VMost importantly
p30974
aVThat will suck performance wise - it has to create lots of strings (one per character)
p30975
aVThe simplest way is something like:
p30976
as(dp30977
g18
V23354
p30978
stp30979
a((dp30980
g2
(lp30981
VJon Skeet has a few introductory pages on threading basics, here (note there are 17 separate pages of topics here)
p30982
aVDoes each event get handled by a different thread
p30983
aVThat depends on the specific timer, but that would be a safe (i
p30984
ag50
aVworst-case) assumption
p30985
aVAre properties shared across threads
p30986
aVYes; there is no protection from multiple threads accessing your data unless you write it yourself, either with  (to make a method synchronized), or with a construct such as
p30987
aVThe only exception to this is static fields marked with the special attribute , which then has one static field per thread
p30988
aVWhat is the thread limit
p30989
aVdo they run out
p30990
aVand if so, what happens when the Timer Event fires, and all the threads are taken up
p30991
aVLimited in part by the OS resources, and in part by whether they are "regular" threads or pool threads
p30992
aVBut if you are using enough for this to be an issue, you have too many threads
p30993
aVIf there aren't enough resources to start a thread, either it'll start failing (regular threads), or the work will simply pile up, waiting for more availability (pool threads)
p30994
aVIt is entirely possible to saturate the thread pool and deadlock everything
p30995
aVAvoid too many threads, basically
p30996
as(dp30997
g18
V23354
p30998
stp30999
a((dp31000
g2
(lp31001
V(obsolete now that you've edited the question to state systray; left for reference only)
p31002
aVIf you want an exe without any UI (not even a console), but without it being a service etc - then write a windows forms app, but just don't show any forms
p31003
aVThe fact that it is a winform app simply means you don't get a console window - but no UI is shown except that which you write
p31004
aVLook at the  method (usually in  in the VS templates) to see what I mean
p31005
as(dp31006
g18
V23354
p31007
stp31008
a((dp31009
g2
(lp31010
VWith LINQ-to-SQL this would be trivial; you just use  to tell it to use an existing sub-expression (with parameter substitution) at the given point
p31011
aVHowever, EF doesn't (or didn't last time I checked) support this
p31012
aVUnfortunately, the process for combining two expressions without this is
p31013
aVcomplex; you essentially need to completely re-build the inner tree, doing manual substitution for things like parameters
p31014
aVI did have some code that did this, but it is far from simple (and it isn't "to hand")
p31015
aVBut I wonder: is it really worth the complexity
p31016
as(dp31017
g18
V23354
p31018
stp31019
a((dp31020
g2
(lp31021
VNormally, the problem when we see this (regularly) is something like a worker thread or a timer updating the UI - but a button click should be raised through the UI thread, so I don't think it is the "usual problem"
p31022
aVSo: what is
p31023
aVAnd what is
p31024
aVNeither is explained, and we can't guess without introducing extra variables
p31025
aVDepending on what they are, maybe this'll work
p31026
aVBut without knowing what  is, I'm clutching at straws
p31027
as(dp31028
g18
V23354
p31029
stp31030
a((dp31031
g2
(lp31032
VNote that most dictionary constructs don't preserve the insert order - this often makes them poor choices if you want repeatable file contents, but (depending on the size) we may be able to improve on the time
p31033
aVthis (below) takes about 3
p31034
aV5s (for the export) to write just under 30MB:
p31035
aVObviously the performance will depend on the size of the actual data getting written
p31036
as(dp31037
g18
V23354
p31038
stp31039
a((dp31040
g2
(lp31041
VA single value isn't really a "model" - you could just use the dictionary and cast
p31042
as(dp31043
g18
V23354
p31044
stp31045
a((dp31046
g2
(lp31047
VHow about the dynamic LINQ library
p31048
aVYou could either use "as is", or look at how it builds an  predicate (which is the tree)
p31049
as(dp31050
g18
V23354
p31051
stp31052
a((dp31053
g2
(lp31054
VThere won't be anything built in along those lines, but if you need this frequently you could roll something bespoke but fairly generic:
p31055
aVUsage:
p31056
aVYou might want to think about what to do with triplets etc - currently everything except the first will be yielded (which matches your description), but that might not be quite right
p31057
as(dp31058
g18
V23354
p31059
stp31060
a((dp31061
g2
(lp31062
VIt sounds like you need an extra class:
p31063
aVWhere an instance (in the example) would have  and ;  would be a
p31064
aVBy the way - public fields are rarely a good idea
p31065
as(dp31066
g18
V23354
p31067
stp31068
a((dp31069
g2
(lp31070
VIf you use  it is unclear what you intended to do
p31071
aVIf you mean to change the behaviour of  via polymorphism, then
p31072
aVYou could add a , but that would be silly
p31073
aVDon't do that
p31074
aVThe difference is what happens when you do:
p31075
aVIf you , both will output your new version
p31076
aVIf you , only the first will use your new version; the second will use the original implementation
p31077
aVI don't think I've ever seen anybody use method hiding (aka ) on
p31078
as(dp31079
g18
V23354
p31080
stp31081
a((dp31082
g2
(lp31083
VIt looks like you have a  of data to post; in which case I expect you'll find it easier to use:
p31084
aVAnd if the response is text, something like:
p31085
aV(or your choice of  - perhaps )
p31086
as(dp31087
g18
V23354
p31088
stp31089
a((dp31090
g2
(lp31091
VIt looks like you want:
p31092
aVOr have I missed the point completely
p31093
as(dp31094
g18
V23354
p31095
stp31096
a((dp31097
g2
(lp31098
VYou need to implement a modal , using the  service to display it:
p31099
aVNote: if you need to access something about the context of the property (the parent object etc), that is what the  (in ) provides; it tells you the  and  (the ) that is involved
p31100
as(dp31101
g18
V23354
p31102
stp31103
a((dp31104
g2
(lp31105
VThe big difference is when you need to tell  about sub classes - for example:
p31106
aVHere, without the extra info if wouldn't have known (just from ) about either  or  - so if you give it a object that is actually a , it would fail:
p31107
aVYou can also do this by setting  against the  type definition:
p31108
aVThis is easier, but is only possible if the  type is in an assembly that knows about
p31109
aVBut you often do know this, so  is the preferred option
p31110
aVAdditionally: there are some efficiency benefits of ; behind the scenes the system uses dynamic type generation to make  efficient
p31111
aVFor this reason, you should generally keep hold of (and re-use) the  instance you create; for example, by storing it in a static field
p31112
aVHowever, the system does this automatically for the default usage () - i
p31113
ag50
aVno matter how many times you use this constructor, it only generates the dynamic code once
p31114
aVIf you use the more complex constructor () it will do the type generation each time
p31115
as(dp31116
g18
V23354
p31117
stp31118
a((dp31119
g2
(lp31120
VSQL Server can work happily without an explicit transaction
p31121
aVBut yes, I believe it is essentially read-committed (unless, of course, you add extra hints to your query objects,such as  / )
p31122
aVYou can investigate this with:
p31123
aVwhich shows (among others):
p31124
as(dp31125
g18
V23354
p31126
stp31127
a((dp31128
g2
(lp31129
VSpecify the culture in the call to :
p31130
as(dp31131
g18
V23354
p31132
stp31133
a((dp31134
g2
(lp31135
VIf you are sending POX over HTTP, then you will probably want a "handler" approach, that reads from the , and writes to  - simply using anything like  /
p31136
as(dp31137
g18
V23354
p31138
stp31139
a((dp31140
g2
(lp31141
VThat code works perfectly for me (I simply added the missing  class
p31142
aVIs that code actually representative of your real code
p31143
aVIn particular, buffer handling (maybe file IO) would be my first suspicion
p31144
aVBut the bug isn't in the code you posted
p31145
aVit works fine
p31146
aVAs an aside
p31147
aVcan be brittle, especially around different versions - you may want to consider alternative serializers
p31148
aVAsk for more info if you are interested
p31149
aVHere it is runnable:
p31150
as(dp31151
g18
V23354
p31152
stp31153
a((dp31154
g2
(lp31155
VToList() is fine, but to be honest, you don't need LINQ for that:
p31156
as(dp31157
g18
V23354
p31158
stp31159
a((dp31160
g2
(lp31161
VI looked to see if this was the compiler doing the math, but it behaves this way even if you force it out:
p31162
aVIt looks like the difference is whether it stays in the registers (wider than normal r4) or is forced to a  variable:
p31163
aVvs
p31164
aVThe only difference is the  /
p31165
aVThis is supported by the fact that if you do an optimised build (which will remove the local variable) I get the same answer (19594) for both
p31166
as(dp31167
g18
V23354
p31168
stp31169
a((dp31170
g2
(lp31171
V(edit: pre-dates the update clarifying data-type is ; but works fine as )
p31172
aVWorks fine here (SQL2005):
p31173
aVoutputs:
p31174
as(dp31175
g18
V23354
p31176
stp31177
a((dp31178
g2
(lp31179
VHow about:
p31180
aV(note I used reflector to translate that from the C# below)
p31181
aVYou could add try/catch around the , but to be honest I'd rather have the code throw an exception if I give it something stoopid - leave nulls for the blank case
p31182
aVThe advantage of this is that it works with your own structs, as long as you associate a type-converter with them, which you can do easily (with an attribute or at runtime)
p31183
as(dp31184
g18
V23354
p31185
stp31186
a((dp31187
g2
(lp31188
VIt sounds like you're really talking about the C# "compiler as a service" (at the end of this video), which will hopefully be in the 5
p31189
aV0 timescale for
p31190
aVNET (although Mono has it now)
p31191
aVFor now, CSharpCodeProvider is the best we have (which works largely like "csc")
p31192
as(dp31193
g18
V23354
p31194
stp31195
a((dp31196
g2
(lp31197
VHave you perhaps misconfigured a primary key, such that EF thinks something is a primary key, when in fact each row has the same value
p31198
aVImportantly, EF is obliged to give you the same instance every time it sees an object with the same type+primary key that it has seen before
p31199
aVSo if all your records look like:
p31200
aVand if EF thinks that  is a primary key, it will give you back the same object each time - so you'll see , ,
p31201
as(dp31202
g18
V23354
p31203
stp31204
a((dp31205
g2
(lp31206
VMSDN: Choosing Between Windows Forms and Web Forms
p31207
aVwhich also links to ClickOnce Deployment Overview, although you should also consider Silveright (rich apps in the browser) and ASP
p31208
aVNET MVC (alternative model to webforms at the web server)
p31209
as(dp31210
g18
V23354
p31211
stp31212
a((dp31213
g2
(lp31214
VThe  does nothing (except change from  to  - but nothing useful)
p31215
aVAnd I assume you intended to pass  to the
p31216
aVIndeed, this doesn't pull everything out and filter it - the appropriate  (TSQL) clause is generated
p31217
aVThis is possible because of "deferred execution" and "composability" - meaning: it doesn't actually execute anything until you start iterating the data (in the ) - until then you are simply shaping the query
p31218
aVYou can see this by doing somthing like:
p31219
aVand look at the TSQL
p31220
aVOr run a TSQL trace
p31221
aVTo make it prettier, simplify it to:
p31222
as(dp31223
g18
V23354
p31224
stp31225
a((dp31226
g2
(lp31227
VMy guess would be either internationalisation ( vs  vs  coming from the client's machine and/or the server configured differently - hint, a fairly common layout would be '2009/06/19'), or simply that you have perhaps been using the date incorrectly, and it is now past the 12th - i
p31228
ag50
aVpreviously it thought it was the 6th Oct, 6th Nov, 6th Dec, boom
p31229
aVOf course, if you use parameters (instead of strings) you don't have this problem
p31230
aVDitto with decimals - is  the same as 123456
p31231
aVor 123 and nearly a half
p31232
as(dp31233
g18
V23354
p31234
stp31235
a((dp31236
g2
(lp31237
V(complete rewrite) You don't even need the xml; if you use ToDataTable, the following works fine:
p31238
as(dp31239
g18
V23354
p31240
stp31241
a((dp31242
g2
(lp31243
V(edit - misread question)
p31244
aVIf you want to get the original  version; you can't - at least, not unless  makes it available via something like:
p31245
aV(and have  call )
p31246
aVThe reason it overflows is that  is (obviously) virtual - it doesn't matter if you cast it to ; it still starts at the most-derived implementation in the actual object, i
p31247
ag50
aV(hence the explosion)
p31248
as(dp31249
g18
V23354
p31250
stp31251
a((dp31252
g2
(lp31253
VThe problem is: a  instance isn't a
p31254
aVIt works in the first case because the instance is created as a  (on the first line)
p31255
aVWith casts, the type of the actual object (not just the variable) is important
p31256
as(dp31257
g18
V23354
p31258
stp31259
a((dp31260
g2
(lp31261
VDoes it have to be a single regex
p31262
aVI'd keep things simple by keeping them separate:
p31263
as(dp31264
g18
V23354
p31265
stp31266
a((dp31267
g2
(lp31268
VWe don't have covariance of generic types yet, I'm afraid
p31269
aVYou can do , but not
p31270
aVYou could introduce a conversion, but it'll probably break composability, rendering it useless
p31271
aVYou could try it though:
p31272
aVIn C# 4
p31273
aV0, this would probably work without the extra cast (although I haven't tried it)
p31274
as(dp31275
g18
V23354
p31276
stp31277
a((dp31278
g2
(lp31279
VDarn, I hate it when I prove myself wrong
p31280
aVit works if you define the attribute as a protected nested type of the base-class:
p31281
aV(original answer)
p31282
aVYou cannot do this - at least, not at compile time
p31283
aVAttributes can be restricted (for exmaple) to "class", "struct", "method", "field", etc - but nothing more granular
p31284
aVOf course, since attributes do nothing by themselves (ignoring PostSharp), they will be inert on other types (and inert on your types unless you add some code to look at the attributes at runtime)
p31285
aVYou could write an FxCop rule, but that seems overkill
p31286
aVI wonder, however, whether an attribute is the best choice:
p31287
aVNow all the classes that must apply my custom attribute are derived from a single base class
p31288
aVIf they must apply your custom attribute, maybe an  (or maybe just ) property / method would be a better choice
p31289
as(dp31290
g18
V23354
p31291
stp31292
a((dp31293
g2
(lp31294
VWhen looking at , there is nothing to identify the existence of a  (at any point)
p31295
aVPerhaps you could add an attribute to identify the  field, and reflect on that (via )
p31296
as(dp31297
g18
V23354
p31298
stp31299
a((dp31300
g2
(lp31301
VIf you are using a standard csproj, note that files and references can be conditional - i
p31302
ag50
aVonly there in some configurations
p31303
aVYou have to go out of your way to do this (the VS IDE doesn't let you do it - only via direct file edit), so it seems unlikely, but it is a possibility
p31304
aVIt is, unfortunately, quite hard to investigate without some concrete examples
p31305
as(dp31306
g18
V23354
p31307
stp31308
a((dp31309
g2
(lp31310
VFirst, find the date you actually care about - for example it might be
p31311
aV(do this once at the top, rather than per row) - then just compare against those, for example:
p31312
aVYou can also do this inside the database with  and  or
p31313
as(dp31314
g18
V23354
p31315
stp31316
a((dp31317
g2
(lp31318
VIf your are sure of the syntax, maybe a regex
p31319
aValthough regex is often overused, it seems to fit this time:
p31320
as(dp31321
g18
V23354
p31322
stp31323
a((dp31324
g2
(lp31325
VYou can use  in TSQL (2005 onwards) to do this:
p31326
aVOr with LINQ-to-SQL etc:
p31327
as(dp31328
g18
V23354
p31329
stp31330
a((dp31331
g2
(lp31332
VIt depends; do you want to specify the item type, or the collection type
p31333
aVIf you just want to specify the item, then the  relates just to the item:
p31334
aVThen you can use  etc
p31335
aVIf you need to specify the collection type, you may need more generic types
p31336
aVHowever, calling it is trickier
p31337
aVIt can't do type inference unless the list is an argument, meaning you have to specify both  and  when calling it
p31338
aVnot pretty
p31339
as(dp31340
g18
V23354
p31341
stp31342
a((dp31343
g2
(lp31344
V represents the original  type
p31345
aVHave you tried just using the
p31346
aVNET type in the
p31347
aVI would hope that it can convert this to either the TSQL  or  types
p31348
aVDitto  instead of
p31349
as(dp31350
g18
V23354
p31351
stp31352
a((dp31353
g2
(lp31354
VIn the future (around the 5
p31355
aV0 timeframe), the "compiler as a service" may be able to do this
p31356
aVActually, you may be able to do a lot of this now with "mono" (see CsharpRepl and Mono
p31357
aVCSharp - however, I expect it'll need to know a lot more about the context to be able to use local variables etc in ) - but there isn't any support for this in the current MS
p31358
aVNET offering
p31359
aVFor now, you would have to do something like what a lot of the data-binding code does
p31360
aVsplit it apart by tokens such as "
p31361
aVand use reflection
p31362
aVStrictly speaking, the binding code actually uses / rather than direct reflection, but the effect is the same
p31363
as(dp31364
g18
V23354
p31365
stp31366
a((dp31367
g2
(lp31368
VIterator blocks use deferred execution - meaning: until you actually start iterating over the data, nothing is executed
p31369
aVSo: has the data been iterated
p31370
aVIs anything looping over the values
p31371
aVIf you need to add validation logic that runs as early as possible, you currently need two methods:
p31372
as(dp31373
g18
V23354
p31374
stp31375
a((dp31376
g2
(lp31377
VSomething like:
p31378
aVor:
p31379
as(dp31380
g18
V23354
p31381
stp31382
a((dp31383
g2
(lp31384
VThe add reference dialog actually looks at the registry, in particular:
p31385
aV[HKEY_LOCAL_MACHINE]\u005cSOFTWARE\u005cMicrosoft\u005c
p31386
aVNETFramework\u005cAssemblyFolders
p31387
aV[HKEY_CURRENT_USER]\u005cSOFTWARE\u005cMicrosoft\u005c
p31388
aVNETFramework\u005cAssemblyFolders
p31389
aVTo add your assembly, you must edit these registry keys
p31390
aVOr simply using the "Browse
p31391
aVbutton (instead) may be more tempting
p31392
as(dp31393
g18
V23354
p31394
stp31395
a((dp31396
g2
(lp31397
VWhat IDE are you using
p31398
aVMonoDevelop
p31399
aVSharpDevelop
p31400
aV(links are to tutorials) If you are using core functionality, you could even use Visual C# Express and just use a separate mono build step
p31401
as(dp31402
g18
V23354
p31403
stp31404
a((dp31405
g2
(lp31406
VYou would probably need a second thread
p31407
aVAn easy option would be to use the , but in a more sophisticated setup a producer/consumer queue would work well
p31408
aVAt the simplest level:
p31409
as(dp31410
g18
V23354
p31411
stp31412
a((dp31413
g2
(lp31414
VAre you sure the problem isn't that  is
p31415
aVIn particular, with strings or  values
p31416
aVWith strings, it would be better to use:
p31417
aV(edit)
p31418
aVFor a null-safe wrapper, you can use  - for example, to sort a list by a property:
p31419
as(dp31420
g18
V23354
p31421
stp31422
a((dp31423
g2
(lp31424
VThat could be a :
p31425
aVHowever, I would advise you create a type with the expected properties, and have a  of that type - much easier to understand:
p31426
as(dp31427
g18
V23354
p31428
stp31429
a((dp31430
g2
(lp31431
VFrom a , you can use  - but that gives you a  representing the time into the day (10 hours)
p31432
as(dp31433
g18
V23354
p31434
stp31435
a((dp31436
g2
(lp31437
VI wonder whether wordconv is suffering the same fate as the rest of Office - i
p31438
ag50
aVnot supported in a service application
p31439
aVAs such, freaky things may happen
p31440
as(dp31441
g18
V23354
p31442
stp31443
a((dp31444
g2
(lp31445
VThe "per session" is the "instance context mode" - this just guarantees to give you the same service-side object (implementing the service) for the duration of the session
p31446
aVI believe you should look at the "concurrency mode"
p31447
aVIf this is "single" then the calls are synchronized (serial) - but that isn't the only setting; "multiple" and "re-entrant" would allow multiple threads into the service at once
p31448
as(dp31449
g18
V23354
p31450
stp31451
a((dp31452
g2
(lp31453
VWhat size are the numbers
p31454
aVIn addition to the other answers, you could consider base-128 variant-length encoding, which lets you store smaller numbers in single bytes while still allowing larger numbers
p31455
aVThe MSB means "there is another byte" - this is described here
p31456
aVCombine this with the other techniques so you are storing "skip size", "take size", "skip size", "take size" - but noting that neither "skip" nor "take" will ever be zero, so we'll subtract one from each (which lets you save an extra byte for a handful of values)
p31457
aVSo:
p31458
aVis "skip 1" (assume start at zero as it makes things easier), "take 100", "skip 9", "take 51"; subtract 1 from each, giving (as decimals)
p31459
aVwhich encodes as (hex):
p31460
aVIf we wanted to skip/take a larger number - 300, for example; we subtract 1 giving 299 - but that goes over 7 bits; starting with the little end, we encode blocks of 7 bits and an MSB to indicate continuation:
p31461
aVso starting with the little end:
p31462
aVgiving:
p31463
aVSo we can encode large numbers easily, but small numbers (which sound typical for skip/take) take less space
p31464
aVYou could try running this through "deflate", but it might not help much more
p31465
aVIf you don't want to deal with all that messy encoding cruff yourself
p31466
aVif you can create the integer-array of the values (0,99,8,60) - you could use protocol buffers with a packed repeated uint32/uint64 - and it'll do all the work for you ;-p
p31467
aVI don't "do" Java, but here's a full C# implementation (borrowing some of the encoding bits from my protobuf-net project):
p31468
as(dp31469
g18
V23354
p31470
stp31471
a((dp31472
g2
(lp31473
VAnother important difference between them arises when using LINQ-to-SQL and the generated datacontext classes
p31474
aVFor example, the Northwind sample database; initially, you get:
p31475
aVIf you now want to extend the partial classes by adding your own , you get
p31476
aVAmusingly, there is a bug in the code-generator () - which means that if the  directives are outside the namespace (like they are by default), it breaks - with the message:
p31477
aVAnd the  file gets deleted
p31478
aVNo more data-context
p31479
aVHowever, if you move the  directives inside the namespace (and re-run the custom tool - right click in solution explorer), it works correctly
p31480
aVSo: this isn't a language detail - it is simply a bug in the code generator; but there is a pretty big difference between "works correctly" and the generated code getting deleted
p31481
aVNote you can also fix this simply by calling your file something different - such as
p31482
aVFreaky
p31483
as(dp31484
g18
V23354
p31485
stp31486
a((dp31487
g2
(lp31488
VThe DBML designer is code-gen, plain and simple - although the dml may help as the mapping file
p31489
aVThere are various options here:
p31490
aVuse SqlMetal to generate the mapping file
p31491
aVdecorate your existing objects with the standard attributes
p31492
aVuse an external xml file to describe the relationships
p31493
aVResources:
p31494
aVExternal Mapping Reference (LINQ to SQL)
p31495
aVLINQ In Action describes both options
p31496
aVUsing LINQ to SQL XML Mapping Files \u2013 Step by Step
p31497
aVNote also that EF in 4
p31498
aV0 also supports POCO
p31499
aVIf you just want to manually project from the LINQ type to your type; if they have similar properties, something like  in MiscUtil may help - see this answer
p31500
as(dp31501
g18
V23354
p31502
stp31503
a((dp31504
g2
(lp31505
VThe  working doesn't surprise me, as this doesn't really execute anything (it is deferred until the data is iterated)
p31506
aVThat is an interesting problem - not least because the  actually has different processing internally - it recognises this as a primary-key lookup and checks the identity manager first
p31507
aVEDIT As an off-the-wall thing, try  - as per the bug (previous link), this doesn't use the identity lookup trick until 4
p31508
aV0 ships
p31509
aVI would be start by wondering:
p31510
aVis there anything odd in the ID getter/setter (have you added code
p31511
aVhave you done anything in a partial class for this type
p31512
aVis it part of an inheritance chain
p31513
aVand if so, have you monkeyed with a partial class for the parent type
p31514
aVdo you get anything in the call-stack window when it explodes
p31515
as(dp31516
g18
V23354
p31517
stp31518
a((dp31519
g2
(lp31520
VIn
p31521
aVNET 4
p31522
aV0 (beta), you can do this with the updated expression trees, using  and  - then compile that to a typed delegate; job done
p31523
aVIn
p31524
aVNET 2
p31525
aV0 and above (as Jon mentioned) HyperDescriptor is a reasonable option - it works as a custom  implementation, so you just do code like:
p31526
aVThis still has a little boxing, but that isn't actually a bottleneck
p31527
as(dp31528
g18
V23354
p31529
stp31530
a((dp31531
g2
(lp31532
VPerhaps
p31533
as(dp31534
g18
V23354
p31535
stp31536
a((dp31537
g2
(lp31538
VAt the crudest level:
p31539
aVYou should probably be a bit more granular though, looking at the certificate/chain a bit
p31540
as(dp31541
g18
V23354
p31542
stp31543
a((dp31544
g2
(lp31545
VAny test you can do is going to immediately be a race condition; if the app exits quickly, the only safe thing I can think of is to use /
p31546
aVUnless it reads from stdio
p31547
aVIn which case you could redirect it and deliberately not close the input stream until you've changed the priority
p31548
as(dp31549
g18
V23354
p31550
stp31551
a((dp31552
g2
(lp31553
VIf your checksum gets it down to 0
p31554
aV33% of the data, then I'd argue that it is working fine
p31555
aVespecially if you use this column in combination with other (indexed) columns
p31556
aVOf course, to be effective as an index you probably want to compute and store this value when inserting/updating data, with a non-clustered index
p31557
aVOf course, a regular spanning index over the columns in question may do just as well or better
p31558
as(dp31559
g18
V23354
p31560
stp31561
a((dp31562
g2
(lp31563
VDoes  have a public parameterless constructor
p31564
aVIf it doesn't, you'll need to use an  implementation to provide the new row - for example :
p31565
as(dp31566
g18
V23354
p31567
stp31568
a((dp31569
g2
(lp31570
VThat really depends on the 3rd-party library
p31571
aVif it makes sense to have multiple separate instances of the lib with separate state, then an instance approach is suitable
p31572
aVIf it is stateless methods, then a static/shared API would be appropriate
p31573
aVUnless you need it to implement an interface, in which case it has to be instance-based
p31574
as(dp31575
g18
V23354
p31576
stp31577
a((dp31578
g2
(lp31579
VBy the , I assume you are on a UI thread here
p31580
aVIt is never a good idea to keep the UI thread active (even with )
p31581
aVWhy not just start the timers and release control back to the message pump
p31582
aVWhen the events tick it'll pick up the events
p31583
aVWhy do you want to loop
p31584
aVRe the update; which  are you using
p31585
aVIf you use  (with the  event) then it isn't bound to the message-loop (it fires on a separate thread): you can just hang the main thread, perhaps waiting on some exit condition:
p31586
as(dp31587
g18
V23354
p31588
stp31589
a((dp31590
g2
(lp31591
VThat is quite bad performance wise - it actually enumerates a query n times (for n items in )
p31592
aVIt would be better if you built (for example) a  of the items to manipulate
p31593
aVTo give a simple example just with  values:
p31594
as(dp31595
g18
V23354
p31596
stp31597
a((dp31598
g2
(lp31599
V applies to a single type - not 2 types (A and B)
p31600
aVYou would need something more like below, ideally keeping the field private:
p31601
as(dp31602
g18
V23354
p31603
stp31604
a((dp31605
g2
(lp31606
VMaybe check that the header has the same line-ending as the actual data rows (as specified in )
p31607
aVUpdate: from MSDN:
p31608
aVThe FIRSTROW attribute is not intended
p31609
aVto skip column headers
p31610
aVSkipping
p31611
aVheaders is not supported by the BULK
p31612
aVINSERT statement
p31613
aVWhen skipping rows,
p31614
aVthe SQL Server Database Engine looks
p31615
aVonly at the field terminators, and
p31616
aVdoes not validate the data in the
p31617
aVfields of skipped rows
p31618
as(dp31619
g18
V23354
p31620
stp31621
a((dp31622
g2
(lp31623
VThe only way you could do that would be to make the  generic () and have  return  - then have
p31624
aVThe problem is
p31625
aVhow would  know how to create the
p31626
aVYou could have the  clause
p31627
aVA useful aside here is that you can move the interface implementation into :
p31628
as(dp31629
g18
V23354
p31630
stp31631
a((dp31632
g2
(lp31633
VFile -> Export Template -> Project Template
p31634
aVThis will then appear under "My Templates" in VS
p31635
as(dp31636
g18
V23354
p31637
stp31638
a((dp31639
g2
(lp31640
VHow about:
p31641
as(dp31642
g18
V23354
p31643
stp31644
a((dp31645
g2
(lp31646
VReturning an entire PDF is simply a case of returning the binary on the http response, as per Chris's reply
p31647
aVFor the page-at-a-time handling, I would suggest using something like Fiddler2 or Wireshark to look at the http traffic
p31648
aVThere may be some custom http headers on the requests, a bit like the "resume download" support via the byte range headers
p31649
aVYou would need to observe a working page-by-page example, and look at what both client and server send
p31650
as(dp31651
g18
V23354
p31652
stp31653
a((dp31654
g2
(lp31655
VMy assumption would be that you haven't marked the target folder as an "application" is IIS, meaning it will be looking in the wrong place for the "bin" folder
p31656
aVYou can do this in the IIS manager on the server; the folder should have a "cog" icon, indicating that it knows it is an application
p31657
aVIf not: right-click on the folder and go into the properties; there should be a "Create Application" button (or similar)
p31658
aVAlso verify that ASP
p31659
aVNET is set to 2
p31660
ag190
aV* (on the ASP
p31661
aVNET tab)
p31662
aV(disclosure: there was a "moderator" flag suggesting this belongs on serverfault, but I disagree: knowing how to get an ASP
p31663
aVNET app working (even on a server) is a development issue)
p31664
as(dp31665
g18
V23354
p31666
stp31667
a((dp31668
g2
(lp31669
VMethods in C# are sealed by default
p31670
aVThere is, however, nothing you can do to prevent method hiding (exposing a method with the same name in the derived class, commonly with )
p31671
aVOr, for that matter, interface-reimplementation:
p31672
as(dp31673
g18
V23354
p31674
stp31675
a((dp31676
g2
(lp31677
VFirstly, I'm not sure whether it is sensible to use  with an enum
p31678
aV, sure - but comparison
p31679
aVAs a safer alternative; rather than mandate the  with the generic constraint, perhaps use  inside the class
p31680
aVThis has the advantage of supporting  and  - and it means you have less constraints to propagate
p31681
aVFor example:
p31682
aVThis works fine with the enum:
p31683
as(dp31684
g18
V23354
p31685
stp31686
a((dp31687
g2
(lp31688
VIs the external API a GUI API
p31689
aVOr just functions etc
p31690
aVIf the latter, then you could spawn a second thread (perhaps using a producer/consumer queue) that is MTA:
p31691
as(dp31692
g18
V23354
p31693
stp31694
a((dp31695
g2
(lp31696
V is used to perform things like /, at least on SQL Server 2005/2008
p31697
aVIf you are targetting an earlier version of SQL Server it could get confused
p31698
aVLINQ-to-SQL makes a reasonable attempt to support SQL 2000 (although not everything is supported) - I honestly don't know whether EF does, though
p31699
as(dp31700
g18
V23354
p31701
stp31702
a((dp31703
g2
(lp31704
VGoogle's openid is indeed per domain (hey, it bit the SO team, so you're in good company)
p31705
aVIt really comes down to the implementation details of each openid provider - google have gone a slightly different (but technically valid) route to most
p31706
aVFor testing, you might try the blogger provider (still your google account) - it is a bit more static
p31707
as(dp31708
g18
V23354
p31709
stp31710
a((dp31711
g2
(lp31712
Vlol - it looks like a bug in the IDE:
p31713
aVdoesn't show, but
p31714
aVdoes
p31715
as(dp31716
g18
V23354
p31717
stp31718
a((dp31719
g2
(lp31720
VIt means you've tried to access a member of something that isn't there:
p31721
aVJust fix the thing that is null
p31722
aVEither make it non-null, or perform a null-test first
p31723
aVThere is also a corner-case here related to , generics and the  generic constraint - a bit unlikely though (but heck, I hit this issue
p31724
as(dp31725
g18
V23354
p31726
stp31727
a((dp31728
g2
(lp31729
VIMO, it would be better to put the rest of your function in the callback parameter to :
p31730
aVThe caveat here is that the callback is fired (separately) for each element that is in the selector
p31731
aVFine if you are only showing one item, though
p31732
as(dp31733
g18
V23354
p31734
stp31735
a((dp31736
g2
(lp31737
VThe  to me sticks out like a sore thumb
p31738
aVIt doesn't exactly advertise the real return type to the caller
p31739
aVIf you want true repository abstraction, you could have a separate  type that is nothing to do with your ORM tool, and return an array/list of those
p31740
aVSome frameworks (NHibernate, LINQ-to-SQL if you work hard enough, EF in 4
p31741
aV0) support POCO usage, allowing you to use your simple (non-ORM) objects via the ORM tool
p31742
aVSo my preference would be:
p31743
aVinterface-based repository, returning arrays/lists/etc of
p31744
aVconcrete POCO types
p31745
aVThe extra abstraction of an interface data type plays havoc with some data-binding setups (it can't create new records, for example)
p31746
as(dp31747
g18
V23354
p31748
stp31749
a((dp31750
g2
(lp31751
VArrays have
p31752
aVLength, not
p31753
aVCount
p31754
aVBut this is available (as an explicit interface implementation) on ICollection etc
p31755
aVEssentially, the same as:
p31756
aVdoesn't have public a  property - but it is available if you cast to :
p31757
as(dp31758
g18
V23354
p31759
stp31760
a((dp31761
g2
(lp31762
VThere is no such thing as an abstract enum (that can have different implementations in subclasses) - but generics may be an option:
p31763
aVThe only problem is that this doesn't enforce that only enums are usable - you can do this at runtime, though - for example in a type initializer:
p31764
as(dp31765
g18
V23354
p31766
stp31767
a((dp31768
g2
(lp31769
V always refers to the class instance (the form)
p31770
aVYou need to cast the sender instead:
p31771
aVThe sender is (generally) the instance raising the event - useful when using the same handler from multiple controls
p31772
as(dp31773
g18
V23354
p31774
stp31775
a((dp31776
g2
(lp31777
VIs the type known at compile time
p31778
aVC# does not (until C# 4
p31779
aV0) support operators on anything except known, fixed types
p31780
aVYou can use operators with generics via a few tricks - like so
p31781
aVLet me know if generics are a factor here (I can talk at length on this
p31782
aVIn 4
p31783
aV0, you can use:
p31784
aVThe use of  causes a lot of magic to happen ;-p
p31785
aVOther than those two scenarios, you need to know their type at compile-time, or do a lot of work
p31786
as(dp31787
g18
V23354
p31788
stp31789
a((dp31790
g2
(lp31791
VIn most scenarios, local variables are specific to a thread, so the issues associated with  are completely unnecessary
p31792
aVThis changes when, like in your example, it is a "captured" variable - when it is silently implemented as a field on a compiler-generated class
p31793
aVSo in theory it could be volatile, but in most cases it wouldn't be worth the extra complexity
p31794
aVIn particular, something like a  (aka ) with  etc could do this just as well, as could any number of other threading constructs
p31795
aVThreading is tricky, and an active loop is rarely the best way to manage it
p31796
aVRe the edit
p31797
aVwould be the obvious thing - but if you really want to use a separate token, see below
p31798
aVThe advantage of this (over things like ) is that it doesn't require anything from the OS - it is handled purely inside the CLI
p31799
as(dp31800
g18
V23354
p31801
stp31802
a((dp31803
g2
(lp31804
VWould:
p31805
aVdo
p31806
aVor (simpler)
p31807
as(dp31808
g18
V23354
p31809
stp31810
a((dp31811
g2
(lp31812
VEven without LINQ, you shouldn't write xml via concatenation
p31813
aVwould be a good fit:
p31814
aVYou can use  to control things like line spacing
p31815
aVAlternatively, with LINQ-to-XML:
p31816
as(dp31817
g18
V23354
p31818
stp31819
a((dp31820
g2
(lp31821
VDon't write your own encryption
p31822
aVWhat is wrong with a bit of SSL
p31823
aVWith "regular" WSDL/SOAP clients (asmx), it isn't uncommon yo use a SOAP header for this (over SSL)
p31824
aVWith WCF, this is formalised into TransportWithMessageCredential (just search)
p31825
aVOf course, you could use certificates, federation, kerberos, etc
p31826
aVIn addition to transport security (SSL), WCF also supports message-based security - with the added feature that you can encrypt just the security headers
p31827
aVPersonally, I like to keep it simple, with TransportWithMessageCredential (i
p31828
ag50
aVSSL)
p31829
as(dp31830
g18
V23354
p31831
stp31832
a((dp31833
g2
(lp31834
VDeep cloning is painful
p31835
aVIf the classes support serialization, that is the best (=most reliable) option
p31836
aVAnything else is lots of work
p31837
aVActually, since the types support xml serialization, the natural choice here would be
p31838
aVIs there a problem you want to solve
p31839
aVPerformance
p31840
as(dp31841
g18
V23354
p31842
stp31843
a((dp31844
g2
(lp31845
VIt sounds like maybe you are referencing multiple versions of the directx assembly
p31846
aVPerhaps double-check your references
p31847
aVIf you need multiple versions, then  may help - but it isn't pretty
p31848
aVIn Visual Studio, look for the "solution explorer" (commonly on the right hand side) - this is the tree of everything in your project
p31849
aVOne of the items in this tree is the "References"
p31850
aVThis is a visual representation of the external dlls that your code is configured to make use of
p31851
aV(there are many, many
p31852
aVNET dlls - you need to tell each project what dlls it might need)
p31853
aVExpand this node, and look for 2 entries that look like directx
p31854
aVIf there are two, get rid of one of them (ideally the one with the lower version)
p31855
aVThen try and rebuild
p31856
as(dp31857
g18
V23354
p31858
stp31859
a((dp31860
g2
(lp31861
VThe first is better
p31862
aVIt ensures it is disposed even if an exception is thrown, and it correctly handles the case where  returns null (i
p31863
ag50
aVit doesn't attempt to call  on a null instance)
p31864
as(dp31865
g18
V23354
p31866
stp31867
a((dp31868
g2
(lp31869
VWhere  is the date in question, how about:
p31870
as(dp31871
g18
V23354
p31872
stp31873
a((dp31874
g2
(lp31875
VWith xml serializer, you are limited - it isn't as versatile as (say) some of the binaryformatter/ options
p31876
aVOne frequent trick is to have a second property for serialization:
p31877
aVThe two browsable attributes hide it from view (but it needs to be on the public API for  to use it)
p31878
aVThe  tells it not to try the ; and the  (or ) tells it to rename  when (de)serializing it
p31879
aV(note that  only applies to code outside the assembly declaring the type)
p31880
as(dp31881
g18
V23354
p31882
stp31883
a((dp31884
g2
(lp31885
VYou could try (untested) changing the file association (on the advanced pane) to include %2 %3 etc in the arguments (normally it just includes %1) - however, this involves changes at the client, and (more importantly) the entire idea of passing arguments to a document presumes that you have the same viewer (i
p31886
ag50
aVthat the arguments are sensible)
p31887
aVIMO, a better option is to explicitly launch the exe, passing the doc (and the other others) as arguments
p31888
aVExample:
p31889
aVreceiver exe (just shows the command arguments received):
p31890
aVThen: created a "foo
p31891
aVflibble" file, right-click/open and associate with my receiver; went into file associations, "flibble", advanced, "open", edit, and added %2 %3 %4
p31892
aVThen in a separate exe:
p31893
aVWhich shows:
p31894
aVSo this has now passed the extra arguments to the exe via the document
p31895
aVBut a lot of client configuration
p31896
as(dp31897
g18
V23354
p31898
stp31899
a((dp31900
g2
(lp31901
VIt should be stated that
p31902
aVNET reflection isn't revolutionary - the concepts have been around in other framework
p31903
aVReflection in
p31904
aVNET has 2 facets:
p31905
aVInvestigating type information
p31906
aVWithout some kind of reflection / introspection API, it becomes very hard to perform things like serialization
p31907
aVRather than having this provided at runtime (by inspecting the properties/fields/etc), you often need code-generation instead, i
p31908
ag50
aVcode that explicitly knows how to serialize each of your types
p31909
aVTedious, and painful if you want to serialize something that doesn't have a twin
p31910
aVLikewise, there is nowhere to store additional metadata about properties etc, so you end up having lots of additional code, or external configuration files
p31911
aVSomething as simple as being able to associate a friendly name with a property (via an attribute) is a huge win for UI code
p31912
aVMetaprogramming
p31913
aVNET reflection also provides a mechanism to create types (etc) at runtime, which is hugely powerful for some specific scenarios; the alternatives are:
p31914
aVessentially running a parser/logic tree at runtime (rather than compiling the logic at runtime into executable code) - much slower
p31915
aVyet more code generation - yay
p31916
as(dp31917
g18
V23354
p31918
stp31919
a((dp31920
g2
(lp31921
VFor info, if you are binding to a class, you can do this in your type via :
p31922
aVNow the header-text on auto-generated columns will be "Access key"
p31923
as(dp31924
g18
V23354
p31925
stp31926
a((dp31927
g2
(lp31928
VYes, it can
p31929
aVThe aspx model is just one of the view template mechanisms
p31930
aVThere are others - you can even write your own
p31931
aVThe key here is , with  being the aspx/ascx provider
p31932
aVASP
p31933
aVNET MVC In Action covers some of this in chapter 6 "Customizing & Extending the ASP
p31934
aVNET MVC Framework"
p31935
as(dp31936
g18
V23354
p31937
stp31938
a((dp31939
g2
(lp31940
VIf the LOH wants to keep memory, that is up to the LOH - however, don't forget that  is per-process, since really the hard disk is the limiting factor for virtual memory
p31941
aVEric Lippert blogged about this recently
p31942
aVOf course, that doesn't prevent it getting poor performance from all the paging
p31943
as(dp31944
g18
V23354
p31945
stp31946
a((dp31947
g2
(lp31948
VThe cleanest option would be to write that functionality in a separate assembly (dll) that you use from both the service and the second
p31949
aVNET application
p31950
aVYou can reference the service assembly (even if it is an exe, in VS2008 at least) - but it seems a little overkill
p31951
aVIf you want to execute the method in the context of the running service, then you'll need some IPC (perhaps WCF or sockets)
p31952
as(dp31953
g18
V23354
p31954
stp31955
a((dp31956
g2
(lp31957
VI suspect your test project was configured as a windows exe, not a console exe
p31958
aVWith a windows exe  will return immediately
p31959
aVTo have a console exe that works both as a service and at the command line, start it as a service project (in Visual Studio) - and add a check on  - i
p31960
ag50
aVYou can of course also use a command line switch
p31961
aVI have example on microsoft
p31962
aVpublic
p31963
aVdotnet
p31964
aVlanguages
p31965
aVcsharp that acts as:
p31966
aVan installer / uninstaller
p31967
aVa service
p31968
aVa console-mode app
p31969
aVdepending on the switches
p31970
as(dp31971
g18
V23354
p31972
stp31973
a((dp31974
g2
(lp31975
VThere is no need for the private  member to be an  - it could just be a field:  - inside the class it always goes straight to the field, so the  stuff is lost anyway
p31976
aVThe approach you've shown with an explicit lock object isn't much more thread-safe than just having a field-like event (i
p31977
ag50
aV- the only difference is that you aren't locking "this" (which is a good thing - you should ideally avoid locking on )
p31978
aVThe "handler variable" approach is the right one, but there are still side-effects you should be aware of
p31979
as(dp31980
g18
V23354
p31981
stp31982
a((dp31983
g2
(lp31984
VCould you perhaps use the overload  constructor that lets you pass in the attributes to apply at runtime
p31985
aVThen you don't have to worry about it
p31986
aVcaveat: you want to cache the serializer instance and re-use it; otherwise (with the complex constructors) it does dynamic type generation each time
p31987
aVExample:
p31988
aVOutput:
p31989
as(dp31990
g18
V23354
p31991
stp31992
a((dp31993
g2
(lp31994
VShort version: use
p31995
aVLong version:
p31996
aVA  is typically either:
p31997
aVan individual object (for simple binding)
p31998
aVa list source ()
p31999
aVa list ()
p32000
aVSince you are using it for a drop-down, it sounds like you want one of the second two, typically  ( is relatively rare, except for )
p32001
aVFor changes once you have bound, you need notifications
p32002
aVFor simple bindings (individual objects), either  or  events are the way to go - but for lists you need to implement  and raise the  event to tell the control what happened
p32003
aVTo be honest, this is a lot of non-interesting work that it is very easy to make a mess of
p32004
aVThe pragmatic approach is to work with  (possibly inheriting from it)
p32005
aVThis gives you all the list notifications, including support for items in the list changing if you implement  on the items (it doesn't support  events, though)
p32006
aVCaveat: not all controls care about notifications
p32007
aVand if they don't there isn't a lot you can do about it
p32008
aVSo if you don't see additions/swaps/etc even when using  - or you don't see item updates when implement , then
p32009
aVer, tough
p32010
as(dp32011
g18
V23354
p32012
stp32013
a((dp32014
g2
(lp32015
VYou should be able to repair the list by looking at the old csproj in your source control system - in particular, look at  entries, such as (for a trivial test):
p32016
aVNote that it may only have these records for explicit entries - if the files are being implicitly published they won't appear in the csproj
p32017
aVJust edit the csproj file as xml and repair / replace any broken entries using your old (working) csproj as the template
p32018
as(dp32019
g18
V23354
p32020
stp32021
a((dp32022
g2
(lp32023
VHTML Agility Pack:
p32024
as(dp32025
g18
V23354
p32026
stp32027
a((dp32028
g2
(lp32029
VTo work with EF you need an , applied (as a predicate) with :
p32030
aVYou'd then call that as:
p32031
aVThe lambda is then translated into an
p32032
aVIf your setup is more complex, please clarify
p32033
as(dp32034
g18
V23354
p32035
stp32036
a((dp32037
g2
(lp32038
VThe short answer is "no"; but this is a very common request, and I know a lot of people are hopeful that the next version (whenever that is) will have better support for this
p32039
aVIn particular, web application projects seem to be increasingly the default (especially for things like MVC, but obviously that changes the tooling a lot anyway)
p32040
as(dp32041
g18
V23354
p32042
stp32043
a((dp32044
g2
(lp32045
VI can't see any benefit in implement  - that suggests more functionality than is actually available - however, you could implement it as an  easily enough, with the caveat that it is once-only
p32046
aVAn iterator block would be a reasonable choice:
p32047
aVThe "a bit dangerous" is because the caller could cast it back and abuse it
p32048
as(dp32049
g18
V23354
p32050
stp32051
a((dp32052
g2
(lp32053
VHave you any backups of the database itself
p32054
aVThe stored procedure is part of the database
p32055
aVRestore it onto a spare machine and extract it from there
p32056
aVIf you don't have a backup of the database
p32057
aVhuh
p32058
as(dp32059
g18
V23354
p32060
stp32061
a((dp32062
g2
(lp32063
VWith 3
p32064
aV5, something like:
p32065
as(dp32066
g18
V23354
p32067
stp32068
a((dp32069
g2
(lp32070
VIs there a route from the  to the
p32071
aVIf so, simply walk the relation
p32072
aVActually, the simplest approach is to re-expose this date on the  - i
p32073
ag50
aVand order by  - but you can also use a string like "Invite
p32074
aVDate" and split it by dots - for example, here's something similar for  - although it doesn't handle  at the moment
p32075
as(dp32076
g18
V23354
p32077
stp32078
a((dp32079
g2
(lp32080
VIt doesn't always do it automatically (although it spots things like
p32081
aVDesigner
p32082
aV, but you can edit the csproj by hand to do this (it is just xml)
p32083
aVThere are also a few add-ins that provide this, but the one I use has been removed
p32084
aVYou want DependentUpon
p32085
aV(note they must be in the same folder; you don't specify the folder in DependentUpon)
p32086
as(dp32087
g18
V23354
p32088
stp32089
a((dp32090
g2
(lp32091
VThat sounds about right
p32092
aVNote that you can use  on a per-row basis, or you can do set-based operations if you use the INSERT/OUTPUT syntax, and then join the the set of output from the first insert - for example, here we only have 1 INSERT (each) into the "real" tables:
p32093
as(dp32094
g18
V23354
p32095
stp32096
a((dp32097
g2
(lp32098
VMore generally, to support any , you need to check the interfaces:
p32099
as(dp32100
g18
V23354
p32101
stp32102
a((dp32103
g2
(lp32104
VHow about something like:
p32105
aVThis still only reads the two columns you need (I had to make some assumptions on names, though)
p32106
as(dp32107
g18
V23354
p32108
stp32109
a((dp32110
g2
(lp32111
VThat looks like DevExpress to me
p32112
aVSpecifically, the "Structural highlighting" feature:
p32113
as(dp32114
g18
V23354
p32115
stp32116
a((dp32117
g2
(lp32118
VThat is very complex work
p32119
aVBasically, you'd be looking at re-writing reflector in your code
p32120
aVand don't forget that not all IL can be reversed
p32121
aVThe short answer is "no, nothing built in"
p32122
aVEven expression trees (from lambdas) can't be fully reversed back to appropriate strings easily
p32123
as(dp32124
g18
V23354
p32125
stp32126
a((dp32127
g2
(lp32128
VIt is more complex on that
p32129
aVUltimately, much of LINQ-to-Objects is (behind the scenes) a  loop, but with the added overhead of a little abstraction / iterator blocks / etc
p32130
aVHowever, unless you do very different things in your two versions (foreach vs LINQ), they should both be O(N)
p32131
aVThe real question is: is there a better way of writing your specific algorithm that means that  would be inefficient
p32132
aVAnd can LINQ do it for you
p32133
aVFor example, LINQ makes it easy to hash / group / sort data
p32134
as(dp32135
g18
V23354
p32136
stp32137
a((dp32138
g2
(lp32139
VHow about a  and  that uses just  ;-p
p32140
aVFull code shown on this earlier answer
p32141
aVOr for a producer/consumer queue of capped size (thread-safe etc), here
p32142
as(dp32143
g18
V23354
p32144
stp32145
a((dp32146
g2
(lp32147
VIt depends
p32148
aVif there is that much commonality, you could pass in the thing to do as a parameter - either as an interface or a delegate:
p32149
aVAnd call as:
p32150
as(dp32151
g18
V23354
p32152
stp32153
a((dp32154
g2
(lp32155
VI use a contract-first approach, generally (but not always) using the same type representation at each end
p32156
aVActually, to use WCF you don't need any special proxies etc; you can use your regular
p32157
aVNET types at both ends and not use  at all
p32158
aVGetting a working service is as simple as adding the "ABC" into the configuration file, and using something like:
p32159
aVNow you can use:
p32160
aVand all you have at the client (and server) is your  interface
p32161
aVFor other tools; protobuf-net is an implementation of Google's "protocol buffers" API, which has a DSL for describing data and services in a "contract first" (and portable/interoperable) way - for example (a
p32162
aVproto file):
p32163
aVThe protobuf-net tool (which I maintain) includes a "protogen" utility to transform this DSL into C#/VB; and one of the options (for C#, at least - I'd need to check VB) is to emit a full WCF proxy implementation (with your choice of sync or async methods); very similar to svcutil - but (due to the protobuf-net relationship) it includes the custom  attribute on the operation-contracts so that it uses the protobuf-net serializer instead of  (faster and more efficient, but different)
p32164
aVFor VS integration; I'm working on exactly that (proof)
p32165
as(dp32166
g18
V23354
p32167
stp32168
a((dp32169
g2
(lp32170
VIf you must use , you could introduce an extra column for the sort
p32171
aVIn this case, you could set the value in the column simply to the length of each desired cell, and then sort by the new column:
p32172
aVPersonally, I'd use a typed list - of either a class, or a string in this case (since you only list one value):
p32173
as(dp32174
g18
V23354
p32175
stp32176
a((dp32177
g2
(lp32178
VYou need to join the data; something like:
p32179
aV(note swapped 2 columns
p32180
as(dp32181
g18
V23354
p32182
stp32183
a((dp32184
g2
(lp32185
s(dp32186
g18
V23354
p32187
stp32188
a((dp32189
g2
(lp32190
V does not use ;  uses
p32191
aVIf it relates to list-controls like , then the other answer is wrong
p32192
aVTo provide custom properties on a list, you need one of:
p32193
aVon the data-source
p32194
aVon the type
p32195
aVBoth are non-trivial
p32196
as(dp32197
g18
V23354
p32198
stp32199
a((dp32200
g2
(lp32201
VIn my view, the data-context hides squarely behind a repository interface - allowing us to swap the implementation if we like (LINQ-to-SQL / EF / NHibernate / LLBLGen / etc)
p32202
aVAs such, the specifics of the data-context(s) are largely an implementation detail
p32203
aVAs long as it passes the unit tests ;-p
p32204
aVHuge is rarely a good idea; tiny is rarely useful
p32205
aVI tend to break the sytem down into related chunks (normally related to different repository interfaces), and think of it at that level
p32206
aVI have some other thoughts here: Pragmatic LINQ - although I'd happily defer to any wisdom from Frans etc
p32207
as(dp32208
g18
V23354
p32209
stp32210
a((dp32211
g2
(lp32212
VRe inherited fields
p32213
aVif you switch to , then fields are "opt in" rather than "opt out" - but you lose the ability to specify attributes (everything is an element)
p32214
aVA trivial example:
p32215
aVHowever - adding unexpected subclasses is a pain for both  and
p32216
aVBoth can do it, but it isn't pretty
p32217
as(dp32218
g18
V23354
p32219
stp32220
a((dp32221
g2
(lp32222
VDoes the element name really change per level
p32223
aVIf not, you can use a very simple class model and
p32224
aVImplementing  is
p32225
aVtricky; and error-prone
p32226
aVAvoid it unless you absolutely have to use it
p32227
aVIf the names are different but rigid, I'd just run it through xsd:
p32228
aVFor an  without  example (same names at each level):
p32229
as(dp32230
g18
V23354
p32231
stp32232
a((dp32233
g2
(lp32234
VIf you really want to pad with , then - well, frankly - I'm not sure it is a great idea, but something like (excuse the C#):
p32235
aVThe following is a bad way to do it in one line with LINQ; included only for interest:
p32236
as(dp32237
g18
V23354
p32238
stp32239
a((dp32240
g2
(lp32241
V has no notification support
p32242
aVYou could look at , which has events - or , which can be inherited with override methods
p32243
aVIf you want to expose the event at the  level, perhaps something like below - but it may be easier to leave it on the list:
p32244
as(dp32245
g18
V23354
p32246
stp32247
a((dp32248
g2
(lp32249
VIn short, it buffers everything and then walks through it backwards
p32250
aVNot efficient, but then, neither is OrderBy from that perspective
p32251
aVIn LINQ-to-Objects, there are buffering operations (Reverse, OrderBy, GroupBy, etc) and non-buffering operations (Where, Take, Skip, etc)
p32252
aVAs an example of a non-buffering  implementation using , consider:
p32253
aVNote that this is still a little susceptible to bugs if you mutate the list while iterating it
p32254
aVso don't do that ;-p
p32255
as(dp32256
g18
V23354
p32257
stp32258
a((dp32259
g2
(lp32260
VI maintain a project for
p32261
aVNET 2
p32262
aV0,
p32263
aVNET 3
p32264
aV0,
p32265
aVNET 3
p32266
aV5 CF 2
p32267
aV0, CF 3
p32268
aV5, Mono 2
p32269
aVx and Silverlight 2
p32270
aV0  - I do most of this using a combination of project (build) files and #if directives, to minimise/localise the amount of duplicated code
p32271
aVMostly I output the same dlls - although I have created some 3
p32272
aV5-specific dlls to cover things like extension methods
p32273
aVAn important job is to make sure you set this up so that you can build/test them all quickly - for example, I have a single "build
p32274
aVbat" that will check that it compiles in all of them (it is really easy to introduce illegal syntax)
p32275
aVFor 1
p32276
aV1, I imagine you could use MSBee, but you might need a "csc" - but there are some pretty fundamental changes (such as no generics), so it might be an order of magnitude harder
p32277
as(dp32278
g18
V23354
p32279
stp32280
a((dp32281
g2
(lp32282
VFor info, I don't recommend using  for anything that you are storing long-term; it is very brittle between versions
p32283
aVIt is fine for short-lived messages where you know the same version will be used for serialization and deserialization
p32284
aVI would recommend any of: ,  (3
p32285
aV0), or for fast binary, protobuf-net; all of these are contract-based, so much more version tolerant
p32286
aVRe the question; you could use things like  for value-types, and  for strings etc - and ask for input for those that are null
p32287
aVThere are other routes involving things like the  pattern, but this might upset the serialization APIs
p32288
as(dp32289
g18
V23354
p32290
stp32291
a((dp32292
g2
(lp32293
VFrustratingly, all  implementations are, essentially, leaky abstractions - and it is not safe to assume that something that works in LINQ-to-Objects will still work under any other provider
p32294
aVApart from the obvious function mappings, things like:
p32295
aVLINQ-to-SQL can't possibly support all functions / overloads - listed here Data Types and Functions (LINQ to SQL)
p32296
aVplus it depends on the actual database server; Skip/Take etc work differently on SQL Server 2000 than 2005+, and not every such translation works on SQL Server 2000
p32297
aVEF doesn't support Single or Expression
p32298
aVInvoke (sub-expression invocation), or UDF usage
p32299
aVAstoria supports different use of Single/First; as I recall it supports  - but not  (which is the preferred usage for LINQ-to-SQL)
p32300
aVSo you can't really use  for your unit tests simulating a database, even via  - it simply isn't robust
p32301
aVPersonally, I keep  and  away from the repository interface for this reason - see Pragmatic LINQ
p32302
as(dp32303
g18
V23354
p32304
stp32305
a((dp32306
g2
(lp32307
VHow about :
p32308
as(dp32309
g18
V23354
p32310
stp32311
a((dp32312
g2
(lp32313
VWhy use regex when  will do it too
p32314
as(dp32315
g18
V23354
p32316
stp32317
a((dp32318
g2
(lp32319
VIf you use an external comparer to do a , you would have to be very careful not to change the date without re-keying the value in the dictionary
p32320
aVYou have this problem either way, but it is exacerbated by mutability (at least with  it will still be able to track its own keys and values)
p32321
aVWith a mutable value as part of the key you risk never seeing the value again
p32322
aVWhen I've worked on schedule systems in the past I've actually used  for this - similar, but useful if you generally want the data in sequence, and allows binary search if the data is fairly uniform
p32323
as(dp32324
g18
V23354
p32325
stp32326
a((dp32327
g2
(lp32328
VIf you mean as per your other xml questions (mainly this), then the answer is "no", you can't do this (per-level attribute names, etc) with
p32329
aVThe format is fixed per-type at the time you create the  instance
p32330
as(dp32331
g18
V23354
p32332
stp32333
a((dp32334
g2
(lp32335
VLINQ is a query technology, but I think we know what you mean; you might want to be a bit more specific whether this is LINQ-to-SQL or Entity Framework
p32336
aVYou might also want to clarify what "bulk" means in your case
p32337
aVfor 10-100 records you might use a different answer to 10,000 records (where  into a staging table and a stored procedure to import at the db would be the best idea)
p32338
aVFor a relatively low number - just use your ORM tool to find the records - for example with LINQ-to-SQL (perhaps with a spanning serializable transaction) - and using C# for illustration (updated to show loop and cache):
p32339
aVActually, for performance reasons I wonder whether this might be one of those occasions where a natural-key makes sense - i
p32340
ag50
aVuse  (the ) as the primary key, and duplicate it (as a foreign key) in  - then you don't need to join to the  table all the time
p32341
aVIf the numbers are larger, it is pretty easy to use ; just put the data into a  and push it over, then do the work in TSQL
p32342
as(dp32343
g18
V23354
p32344
stp32345
a((dp32346
g2
(lp32347
VIn general, don't pause (or abort) a  - you can't normally tell what it was doing, and this could lead to all sorts of locking issues, such as an a lock that isn't released, or a type initializer (static constructor) that is left hanging
p32348
aVYou might, however, pause code through more elegant methods - for example, using a  in your loop that external code (on another thread) can open and close:
p32349
aVThen another thread with access (probably indirect) can pause () and resume () the worker, but in the knowledge that it only pauses in a safe state
p32350
aVRe your comment (on another reply) - it sounds like you have a reader and writer; ideal for a producer/consumer scenario
p32351
aVI have a an example on this question of how to write a producer/consumer with a capped size (so it won't swamp if the consumer runs slow) - the consumer blocks if there is no data, and the producer blocks if there is too much
p32352
as(dp32353
g18
V23354
p32354
stp32355
a((dp32356
g2
(lp32357
VAs long as both threads are not marked as background threads, the app will keep running until both threads exit
p32358
aVSo really, all you need to do is to get each thread separately to exit cleanly
p32359
aVIn the case of the thread that writes to the database, this may mean exhausting a producer/consumer queue and checking a flag to exit
p32360
aVI showed a suitable producer/consumer queue here - the worker would just be:
p32361
aVHere's a full example based on  - note that the process doesn't exit until the reader and writer have exited cleanly
p32362
aVIf you don't want to have to drain the queue (i
p32363
ag50
aVyou want to exit sooner, and forget any pending work), then fine - add an extra (volatile) flag somewhere
p32364
as(dp32365
g18
V23354
p32366
stp32367
a((dp32368
g2
(lp32369
VYou can use an anonymous type to group by multiple values:
p32370
as(dp32371
g18
V23354
p32372
stp32373
a((dp32374
g2
(lp32375
VIf you try to evaluate
p32376
aVValue (etc) - then yes, it will break - however, you might try casting (apols, but my example is C# - you'll have to imagine the VB):
p32377
aVThe explicit static conversion operator accepts null nodes and returns nulls appropriately
p32378
aVFor more complex scenarios, just test it:
p32379
aVHard to be more specific without example xml/code
p32380
aVEdit re your update; the problem is that you are still reading ; change it to:
p32381
aVThere is a conversion operator from  to ; you don't need to look at
p32382
as(dp32383
g18
V23354
p32384
stp32385
a((dp32386
g2
(lp32387
VFirst off; reflection to this level is usually a code smell; take care
p32388
aVTake it one step at a time; first, we need to get the :
p32389
aVThen we need the :
p32390
aVyou can now use the indexer on , with the new value:
p32391
aVThe next problem is how to create an ; I assume you don't have access to this type (as internal)
p32392
aVAny of that help
p32393
as(dp32394
g18
V23354
p32395
stp32396
a((dp32397
g2
(lp32398
VThis could be tricky without risking keeping everything buffered in memory (if the streams are at BOF and EOF respectively)
p32399
aVI wonder whether it isn't easier to write the stream to disk, copy it, and have two streams reading from disk, with self-deletion built into the  (i
p32400
ag50
aVwrite your own  wrapper around )
p32401
as(dp32402
g18
V23354
p32403
stp32404
a((dp32405
g2
(lp32406
VThe 1000 limit is discussed here - essentially, it is fixed at the server, so you're going to need to speak to the owner
p32407
as(dp32408
g18
V23354
p32409
stp32410
a((dp32411
g2
(lp32412
V has pooling built in; you would see almost no difference if you used:
p32413
aVeach time
p32414
aVAnd that can react automatically to dead (underlying) connections
p32415
aVCurrently you have a bug, btw; if the command fails, the reader will still be null
p32416
aVeither check for  before calling :
p32417
aVor just use :
p32418
as(dp32419
g18
V23354
p32420
stp32421
a((dp32422
g2
(lp32423
VThe "Debug" folder (and the "Release" folder) are the actual output from your project's build
p32424
aVIf you haven't included  in the project and marked it as "Copy to Output Directory", then it doesn't count as part of the build output, and your app shouldn't try to load it
p32425
aVBasically, just set "Copy to Output Directory" to "Copy always" or "Copy if newer", and continue to use the path
p32426
as(dp32427
g18
V23354
p32428
stp32429
a((dp32430
g2
(lp32431
VIt seems the unusual case for a DTO to actually have resources to deallocate, so I can understand if it doesn't provide  support on failure (my own serializer doesn't, either - so I certainly can't criticize)
p32432
aVPerhaps change your class so that if it does have resources to dispose, it takes those resources lazily (i
p32433
ag50
aVnot just when the type is deserialized)
p32434
aVdoesn't support callbacks, otherwise the final callback would be a possible option to eagerly load resources (a bit hacky, though)
p32435
as(dp32436
g18
V23354
p32437
stp32438
a((dp32439
g2
(lp32440
VIn terms of a single command that only checks the relationships once (rather than twice in your example - once for the , once for the ), then I expect the answer is a big fat no, sorry
p32441
aV(off the wall idea):
p32442
aVIf this is a major problem, you could try some kind of reference-counting implementation, using triggers to update the counter - but in reality I expect this will be a lot more overhead to maintain than simply checking the keys like you are already
p32443
aVYou could also investigate  during the delete (since you are checking it yourself); but you can only do this at the table level (so probably OK for admin scripts, but not for production code) - i
p32444
ag50
ag6864
aVA quick test shows that with it enabled it does an extra Clustered Index Scan on the foreign key; with it disabled, this is omitted
p32445
aVHere's a full example; you can look at the query plan of the two  operations
p32446
aV(ideally in isolation from the rest of the code):
p32447
aVAgain - I stress this should only be run from things like admin scripts
p32448
as(dp32449
g18
V23354
p32450
stp32451
a((dp32452
g2
(lp32453
V really just asks the message loop very gently
p32454
aVIf you want your app to exit, the best way is to gracefully make it out of , and cleanly close any additional non-background threads
p32455
aVIf you want to be brutal
p32456
aVor
p32457
aVnote this is harsh - about the same as killing your own
p32458
as(dp32459
g18
V23354
p32460
stp32461
a((dp32462
g2
(lp32463
VHow about something like:
p32464
aVgiving summarised results:
p32465
as(dp32466
g18
V23354
p32467
stp32468
a((dp32469
g2
(lp32470
VCollections do not offer covariance
p32471
aVa  simply isn't a  (or v
p32472
ag10042
aVAs such, you need to identify the , for example like so (using the ) - and create the right type of list in the first place
p32473
aVFor convenience, once created it may be simpler to use the non-generic  interface:
p32474
aVHowever; I must stress - writing a full (and robust) serializer is a lot of work
p32475
aVDo you have a specific reason
p32476
aVMany of the inbuilt serializers are pretty good - for example DataContractSerializer - or 3rd party, such as Json
p32477
aVNet, and (if I do say so myself) protobuf-net
p32478
as(dp32479
g18
V23354
p32480
stp32481
a((dp32482
g2
(lp32483
VOne difference is how they get published; "None" items don't get included in a publish, "Content" items do; for example, on the "Application Files" dialog on the Publish tab
p32484
as(dp32485
g18
V23354
p32486
stp32487
a((dp32488
g2
(lp32489
VOn the case of strings, you probably don't intend to use reference equality
p32490
aVTo access equality and inequality in generic methods, your best bet it:
p32491
ag412
ag50
aVThis still uses the overloaded , but handles nulls etc too
p32492
aVFor inequality, this handles nulls, and both  and
p32493
aVFor other operators, see MiscUtil
p32494
aVRe the question; in the case of:
p32495
aVYou get ,  because the compiler and runtime is designed to be efficient with strings; any literals that you use are "interned" and the same instance is used every time in your AppDomain
p32496
aVThe compiler (rather than runtime) also does the concat if possible - i
p32497
ag50
aVis exactly the same code as the previous example
p32498
aVThere is no difference at all
p32499
aVHowever, if you force it to concatenate strings at runtime, it assumes they are likely to be short-lived, so they are not interned/re-used
p32500
aVSo in the case:
p32501
aVyou have 4 strings; "Jon" (interned), "My name is " (interned), and two different instances of "My name is Jon"
p32502
aVHence  returns true and reference equality returns false
p32503
aVBut value-equality () would still return true
p32504
as(dp32505
g18
V23354
p32506
stp32507
a((dp32508
g2
(lp32509
VIf you have  publishing an event, and  subscribing to an event (the handler), then it is only a problem not to unsubscribe if  is going to live a lot longer than
p32510
aVBasically, the event subscription means that  can still see , so would prevent it from being garbage collected, and would still fire events on it even if you've forgotten about it (and perhaps  it)
p32511
aVFor example, this is a problem if  is a static event, and your app runs for a while after  dies
p32512
as(dp32513
g18
V23354
p32514
stp32515
a((dp32516
g2
(lp32517
VA simple option
p32518
aVdisable the VS integration with your code repo
p32519
aVI find working with TortoiseSVN (for exampel) outside of the IDE works perfectly well, and causes no IDE issues
p32520
aVThere are obviously other (but similar) tools for different repositories
p32521
aVSince you mention VSS, the Visual SourceSafe Explorer might be an option
p32522
as(dp32523
g18
V23354
p32524
stp32525
a((dp32526
g2
(lp32527
VBy "used a dll by name", do you mean you are loading the assembly yourself
p32528
aVIf so, are you using , , or
p32529
aVThey have different rules for resolving references
p32530
aVHowever - in general you should consider yourself limited to your own project-tree; otherwise you'll have to start handling
p32531
aVOr have I misunderstood the question
p32532
as(dp32533
g18
V23354
p32534
stp32535
a((dp32536
g2
(lp32537
VThoughts:
p32538
aVis there a row with [id] 1
p32539
aVdo you have a trigger that is firing
p32540
aVmy guess would be the second
p32541
aVthe number is after triggers have been taken into account, and is the number of rows from the last operation
p32542
as(dp32543
g18
V23354
p32544
stp32545
a((dp32546
g2
(lp32547
VWhat type of data-binding are you doing
p32548
aVWith simple binding ( to a single object, for example), yes, you can use "Foo
p32549
aVBar
p32550
aVSomeProp" as the member
p32551
aVFor , you can mark the objects with  and it will work
p32552
aVThe tricky one is list binding ( etc); here, no: it doesn't flatten easily
p32553
aVYou can do it if you go to great lengths ( etc), but it really isn't worth it - just add shim properties to the parent:
p32554
as(dp32555
g18
V23354
p32556
stp32557
a((dp32558
g2
(lp32559
VEmulating a property just to do the sort is probably overkill
p32560
aVThe first thing to look at is
p32561
aVIt might, however, turn out that the easiest thing to do is to:
p32562
aVextract the data into  or similar
p32563
aVsort the extracted data
p32564
aVdisable notifications
p32565
aVreload the data
p32566
aVre-enable notifications
p32567
aVsend a "reset" message
p32568
aVbtw, you should be disabling notifications during your existing sort, too
p32569
as(dp32570
g18
V23354
p32571
stp32572
a((dp32573
g2
(lp32574
VA data-context should generally be a short-lived unit of work; otherwise you have a number of data-growth issues with the identity manager and change tracking (cache)
p32575
aVAdditionally, you will start getting stale objects, especially if you have multiple machines looking at the database (a web farm for example)
p32576
aVPersonally, I limit it to inside the repository layer, so the data-context only exists for the duration of the actual data operation
p32577
aVThe connection/transaction is another consideration re scalability, but that will be less immediate than seeing old data and getting vast numbers of concurrency errors
p32578
aVRegarding the connection;  uses connection pooling anyway; so there is very little difference in having a single connection vs several sequential connections (with the same connection string)
p32579
aVThere is a good chance that they'll use the same database connection (SPID)
p32580
as(dp32581
g18
V23354
p32582
stp32583
a((dp32584
g2
(lp32585
VIMO, your original code is (more or less) correct
p32586
aVIn particular, it allows you to provide the correct  (which should be the  instance for people who think they are subscribing to an event on )
p32587
aVThere are some tricks to reduce the overheads at runtime if the event isn't subscribed, but this adds more code:
p32588
as(dp32589
g18
V23354
p32590
stp32591
a((dp32592
g2
(lp32593
VI assume you mean at the client
p32594
aVIn which case, using regular methods you are limited to the  and whatever that does in your user's browser
p32595
aVBeyond that, you need additional tools; for example, flash or Silverlight - which would allow access, but even that may be sand-boxed for security
p32596
aVYou certainly can't list the user's files from the server
p32597
as(dp32598
g18
V23354
p32599
stp32600
a((dp32601
g2
(lp32602
V only cares about public read/write members
p32603
aVOne option is to implement , but that is a lot of work
p32604
aVA more practical option (if available and suitable) may be to use :
p32605
aVThis works on both public and private members, but the xml produced is not quite the same, and you can't specify xml attributes
p32606
as(dp32607
g18
V23354
p32608
stp32609
a((dp32610
g2
(lp32611
VIt is rarely a good idea to ignore/swallow errors
p32612
aVTo allow re-use, the only option you have is something like a method that takes an :
p32613
aVBut you haven't exactly saved much by the time you've done:
p32614
aVI'd just leave the / in place
p32615
aVRe the question in the comment:
p32616
aVbut I would still find it clearer to have the / locally
p32617
as(dp32618
g18
V23354
p32619
stp32620
a((dp32621
g2
(lp32622
VDo you mean:
p32623
aVWith calling:
p32624
aVNote that this may work better on C# 3
p32625
aV0, which has stronger generic type inference than C# 2
p32626
ag190
as(dp32627
g18
V23354
p32628
stp32629
a((dp32630
g2
(lp32631
VIf you don't get anything better
p32632
aVperhaps use  to fire up
p32633
as(dp32634
g18
V23354
p32635
stp32636
a((dp32637
g2
(lp32638
VAt the command line, from here - e
p32639
ag24035
aVIn MageUI, from here - set the icon's File Type to Icon File on the Files list
p32640
as(dp32641
g18
V23354
p32642
stp32643
a((dp32644
g2
(lp32645
VThere is no  access in C#
p32646
aVYou have // (including ), but nothing more granular (i
p32647
ag50
aVat the inter-type level)
p32648
aVSo, no
p32649
as(dp32650
g18
V23354
p32651
stp32652
a((dp32653
g2
(lp32654
VOne option here is to pick a delimiter, for example ; join the strings, encode them (perhaps UTF8), and pack the bytes as base-64
p32655
aV(you may need to handle the few non-alphanumeric characters that base-64 uses)
p32656
aVAnd to reverse it:
p32657
aVIf you want to send key/value pairs
p32658
aVwell, the obvious choice would be query-string parameters themselves, since they are designed for this
p32659
aVBut if you need it as a byte-stream:
p32660
as(dp32661
g18
V23354
p32662
stp32663
a((dp32664
g2
(lp32665
VI don't think I've ever seen it swap the order, but personally I don't use "" in production code, either:
p32666
aVOr at worst:
p32667
as(dp32668
g18
V23354
p32669
stp32670
a((dp32671
g2
(lp32672
VIf you have the SDK:
p32673
aVPersonally, though, I'd use
p32674
aVNET Reflector instead
p32675
aVI tend to associate this with bin/exe via the "Open With
p32676
aVdialog in the Solution Explorer; add it to that, job done
p32677
as(dp32678
g18
V23354
p32679
stp32680
a((dp32681
g2
(lp32682
VThat will indeed pause the executing thread/method for 10 seconds
p32683
aVAre you seeing a specific problem
p32684
aVNote that you shouldn't  the UI thread - it would be better to do a callback instead
p32685
aVNote also that there are other ways of blocking a thread that allow simpler access to get it going again (if you find it is OK after 2s); such as  (allowing another thread to  if needed to wake it up):
p32686
aVYou can do this with  too, but IMO that is messier
p32687
as(dp32688
g18
V23354
p32689
stp32690
a((dp32691
g2
(lp32692
V"Remote Desktop" (terminal services / MSTSC) does have separate desktops per user - contrast to "Remote Assistance" which shares
p32693
aVHowever, I have to say that is not necessarily the best way to provide access to the database - you're making the server provide [n] user sessions in addition to the multiple people accessing the database
p32694
aVFor a database app, options to consider:
p32695
aVhosting the database file (in the case of access) on a central file server; each client uses the app on their machine
p32696
aVhaving a proper database server; not snobbery, but simply that Access doesn't scale very well; SQL Server Express Edition is free
p32697
aVthe app might run as a standard exe on each user's (local) desktop
p32698
aVhave the app as a web application hosted by the/another server; then you just have a thin web-server application serving content (rather than a full session per user) to each user's browser
p32699
as(dp32700
g18
V23354
p32701
stp32702
a((dp32703
g2
(lp32704
VSo you want to look for "pat" in a string in your source code
p32705
aVThere are some issues with that
p32706
aVin particular:
p32707
aV1: handling the quotes is awkward (to separate the literal part of the string as opposed to variables etc) - especially with 2 types of escaping; @"""" and "\u005c""
p32708
aV2: in a verbatim string literal, pat could be on the next line but still in the string:
p32709
aVHowever, for a rough search, something like:
p32710
aVmay help
p32711
as(dp32712
g18
V23354
p32713
stp32714
a((dp32715
g2
(lp32716
VAt the database, if you must store it as text, you should standardize the format
p32717
aVEven better, though, store it as , and there is nothing to parse - just read it out from the database as a date
p32718
aVIf you have a string, use the known culture (perhaps the invariant culture) when parsing:
p32719
as(dp32720
g18
V23354
p32721
stp32722
a((dp32723
g2
(lp32724
VFor 2 - it is a little bit open to interpretation
p32725
aVGenerally you would expect the  to be the thing you subscribed to; any other information should be conveyed via the  - but there are exceptions, where (for example) the individual item comes through as the
p32726
aVThe important thing is to document it clearly
p32727
as(dp32728
g18
V23354
p32729
stp32730
a((dp32731
g2
(lp32732
VEven if you can use
p32733
aVNET remoting between networks (and I suspect it can), there a few things to consider:
p32734
aVthe firewalls may not make it especially convenient
p32735
aVNET remoting is deprecated
p32736
aVNET Remoting provides no security or intergrity
p32737
aVSee MSDN:
p32738
aVThis topic is specific to a legacy
p32739
aVtechnology that is retained for
p32740
aVbackward compatibility with existing
p32741
aVapplications and is not recommended
p32742
aVfor new development
p32743
aVDistributed
p32744
aVapplications should now be developed
p32745
aVusing the Windows Communication
p32746
aVFoundation (WCF)
p32747
aVPersonally, I would look (as suggested) at WCF for your cross-network IPC needs
p32748
as(dp32749
g18
V23354
p32750
stp32751
a((dp32752
g2
(lp32753
VIt sounds like you are blocking the UI thread - i
p32754
ag50
aVyou haven't released the system to do any painting
p32755
aVA hacky answer is to inject  into your code - but this is risky, and has problems with re-entrancy etc; and it is just a bit hacky
p32756
aVA better option may be to do the processing on a , periodically switching to the UI thread to update things (Control
p32757
aVInvoke) - but this may be tricky if you are adding lots of items to a
p32758
aVFull example (although you might want to batch the UI updates - not a row at a time):
p32759
as(dp32760
g18
V23354
p32761
stp32762
a((dp32763
g2
(lp32764
VI don't think you can
p32765
aVYour best option might be to encapsulate the thing you want to pass "by ref" onto another class instance, and pass the (outer) class's reference (by value)
p32766
aVIf you see what I mean
p32767
ag412
ag50
aVyour method changes the internal state of the object it is passed, which is then visible to the caller
p32768
as(dp32769
g18
V23354
p32770
stp32771
a((dp32772
g2
(lp32773
VThat simply isn't valid
p32774
aVPre-processing is your best-bet, perhaps with regex - something like:
p32775
aVEdit: a bit more complex to replace the "-" inside the brackets:
p32776
as(dp32777
g18
V23354
p32778
stp32779
a((dp32780
g2
(lp32781
VIt looks like it doesn't do this unless you mark a member as a primary key
p32782
aVThen it does this
p32783
aVPresumably change tracking is useless without a primary key
p32784
as(dp32785
g18
V23354
p32786
stp32787
a((dp32788
g2
(lp32789
V works for exactly 4 cases:
p32790
aVThis is because it has to build a state machine internally; a dictionary (etc) wouldn't be possible with this
p32791
aVYou can of course just  a suitable type instead
p32792
as(dp32793
g18
V23354
p32794
stp32795
a((dp32796
g2
(lp32797
VNot that I know of
p32798
aVIn particular, you can define your own error numbers with , and the errors change (grow) per SQL-Server version, so it would quickly be a problem if (for example) you were using
p32799
aVNET 2
p32800
aV0 with SQL Server 2008, as your numbers would exist
p32801
as(dp32802
g18
V23354
p32803
stp32804
a((dp32805
g2
(lp32806
VYou can use a linked
p32807
aVA full example is below, but the only interesting bit is:
p32808
aVhere's the code:
p32809
as(dp32810
g18
V23354
p32811
stp32812
a((dp32813
g2
(lp32814
VThe  is linked to the concurrency checking
p32815
aVYou can disable this per-column, or (better) use a timestamp/rowversion instead (yay
p32816
aVLook at the "Update Check" and "Time Stamp" properties in the dbml designer
p32817
aVAdding a  to the table and re-importing the tables into the dbml would be my preferred option
p32818
aVWhat sort of volume are we talking here
p32819
aVhundreds
p32820
aVthousands
p32821
aVmore
p32822
aVLINQ-to-SQL (and EF) make changes on an OO-basis, hence row-by-row
p32823
aVThere is a limit beyond which set-based updates are the way to go, and you need to write a stored procedure that does all the work in one hit
p32824
aVIf you aren't making massive changes but it still takes a long time, I would expect the problem to be lack of appropriate indexing on the primary key(s)
p32825
as(dp32826
g18
V23354
p32827
stp32828
a((dp32829
g2
(lp32830
VYou can't change the  code, and subclassing it doesn't provide many options
p32831
aVI would suggest that you simply add a small delay (200ms or similar) to your code - i
p32832
ag50
aVyou only do the calculation a little while after the last update
p32833
aVSomething like:
p32834
as(dp32835
g18
V23354
p32836
stp32837
a((dp32838
g2
(lp32839
VThere is no "abuse" in simply not writing the field manually; and it is good to encourage all access via the property (not directly to the field) anyway
p32840
aVThe biggest problem I know of is with binary serialization, where it gets a bit tricky to change back to a regular field without making it version-incompatible - but then
p32841
aVuse a different serializer ;-p
p32842
aVIt would be nice if there was a "proper" readonly variant, and if you didn't need to use  ctor-chaining on structs, but
p32843
aVmeh
p32844
as(dp32845
g18
V23354
p32846
stp32847
a((dp32848
g2
(lp32849
VI think that to meet the contract as defined, you would have to return
p32850
aVYou could (additionally) implement  - this has ,  and
p32851
aVYou would return  from , and  from the other two
p32852
aVWhether your caller checks for this is up to the caller, though
p32853
aVA lot of UI binding code will, though
p32854
aVadded:
p32855
aVAlso; you should probably implement  if you are implementing ; in particular,  is important for a number of reflection and binding scenarios, where the types aren't known ahead of time
p32856
as(dp32857
g18
V23354
p32858
stp32859
a((dp32860
g2
(lp32861
VHow about:
p32862
aVis the null-coalescing operator, and takes the first non-null result (short-circuiting when it has one), or null if there are no non-null results
p32863
aVWith C# 3
p32864
aV0 You could also add an extension method:
p32865
as(dp32866
g18
V23354
p32867
stp32868
a((dp32869
g2
(lp32870
VWell, for starters your array is only 10 long and you're filling it with ~100 items (out-of-range-exception) - but there are better ways to do this
p32871
aVfor example, using this post:
p32872
as(dp32873
g18
V23354
p32874
stp32875
a((dp32876
g2
(lp32877
VRight-click on the folder; show history
p32878
aVPick a point in time and "Get"
p32879
as(dp32880
g18
V23354
p32881
stp32882
a((dp32883
g2
(lp32884
VYou can just use:
p32885
aVthere is a conversion operator that works this magic using standard xml datetime formatting, and which returns null if the element doesn't exist (note I don't read )
p32886
as(dp32887
g18
V23354
p32888
stp32889
a((dp32890
g2
(lp32891
V (like ) doesn't use any constructor
p32892
aVIt creates the object as empty memory
p32893
aVFor example:
p32894
aVThe assumption is that the deserialization process (or callbacks if necessary) will fully initialize it
p32895
as(dp32896
g18
V23354
p32897
stp32898
a((dp32899
g2
(lp32900
VSomething like  or  in "virtual mode" should work well; this avoids the need to process all the data up-front
p32901
aVhowever - I doubt that  should be a  - sounds like a  to me
p32902
aVIt is very rare you write a  in
p32903
aVNET
p32904
as(dp32905
g18
V23354
p32906
stp32907
a((dp32908
g2
(lp32909
VThere is no such construct for updating a loop; an iterator is read-only
p32910
aVFor example, the following provides a perfectly valid iterator:
p32911
aVHow would it update
p32912
aVWhat would it update
p32913
aVIf the data is an array/list/etc, then something like:
p32914
aVOr other options depending on the specific container
p32915
aVUpdate; at a push, an extension method:
p32916
as(dp32917
g18
V23354
p32918
stp32919
a((dp32920
g2
(lp32921
VHow to: Create and Run a CLR SQL Server Trigger
p32922
as(dp32923
g18
V23354
p32924
stp32925
a((dp32926
g2
(lp32927
VMost of the simple portable serializers (xml, json, protocol buffers) are tree serializers (not graph serializers), so you'll see this problem a bit
p32928
aVYou could perhaps try using a DTO tree that doesn't need the references
p32929
ag412
ag50
aVinstead of:
p32930
aVyou have (at the DTO level):
p32931
aVThis should be usable with any tree serializer; but it does require extra (manual) processing
p32932
aVThere are graph-based serializers like
p32933
aVNET's  (with graph-mode enabled; it is disabled by default); but this is non-portable
p32934
as(dp32935
g18
V23354
p32936
stp32937
a((dp32938
g2
(lp32939
VNo, C# 3
p32940
aV0 has no support for operators without knowing the type
p32941
aVIn C# 4
p32942
aV0 you can do it with , but it is slower
p32943
aVIn your case, you know what the types should be - so just cast (like you are)
p32944
aVIn the more general case:
p32945
aVWith unknown types, look at  and
p32946
aVWith generics; look at  - that should do everything you need for ,, and  (including nulls etc)
p32947
aVLikewise  handles  and  (including nulls etc)
p32948
aVFor more operators (,, etc) - look at MiscUtil
p32949
as(dp32950
g18
V23354
p32951
stp32952
a((dp32953
g2
(lp32954
VDo you mean the definition of the class is also an object
p32955
aVIn
p32956
aVNET, every class/struct/etc has an associated (read-only)  object that provides metadata for the type, such as listing the fields/properties/methods etc
p32957
aVIs that what you meant
p32958
aVYou can obtain the  in several ways; for example:
p32959
aVor from an instance:
p32960
aVAll instances of a class are (by definition) objects
p32961
as(dp32962
g18
V23354
p32963
stp32964
a((dp32965
g2
(lp32966
VSerialization with  - you have big problems if you need to change your property to a "regular" property later, for example to add some validation / eventing /etc - sinc  uses the field names
p32967
aVAnd you can't duplicate this, since the field name the compiler generates cannot be written as legal C#
p32968
aVWhich is a good reason to look at a contract-based serializer instead
p32969
aVSee this blog entry for more info
p32970
as(dp32971
g18
V23354
p32972
stp32973
a((dp32974
g2
(lp32975
Vhacky, but:
p32976
aVI wouldn't write this myself, though ;-p
p32977
aV(I'm off to wash my hands
p32978
as(dp32979
g18
V23354
p32980
stp32981
a((dp32982
g2
(lp32983
VI'm not 100% clear on what the as3 code is doing - but it sounds like you want to define a common interface (in a separate dll) that your external assembly can implement - and simply cast it when you create the object:
p32984
aVnow you can use methods defined on  easily
p32985
aVAlternatively, in C# 4
p32986
aV0 the  keyword provides duck-typing
p32987
as(dp32988
g18
V23354
p32989
stp32990
a((dp32991
g2
(lp32992
VTo clarify the LINQ-to-SQL story; it isn't "dead" - it is very much a fully supported part of the
p32993
aVNET framework, and under active development (there is a LINQ-to-SQL team at Redmond)
p32994
aVThe point is that the new feature development is mainly going into EF, including (hopefully) bridging the gap between LINQ-to-SQL (which is generally very popular) and EF (which has been criticised in a lot of ways)
p32995
aVFor example, EF in 4
p32996
aV0 supports POCO objects, like LINQ-to-SQL
p32997
aVPersonally, I'm still a fan of LINQ-to-SQL, and would happily use it for new builds - but I would hide all of this behind a repository interface so that I can swap it at will, to any tool:
p32998
aVraw ADO
p32999
aVNET
p33000
aVLINQ-to-SQL
p33001
aVNHibernate
p33002
aVLLBLGenPro
p33003
aVEntity Framework
p33004
aVThe one thing I wouldn't touch is  ;-p
p33005
as(dp33006
g18
V23354
p33007
stp33008
a((dp33009
g2
(lp33010
VAs long as you use  or , you should be able to use either of:
p33011
aV(which assumes there are button elements under the context node)
p33012
aVor  using the name
p33013
as(dp33014
g18
V23354
p33015
stp33016
a((dp33017
g2
(lp33018
VDo those URLs actually resolve to the same site/server
p33019
aVIMO, the easiest way to do this is to do it as part of your build process
p33020
aVWhen you publish the app for "client A", you use the web
p33021
aVconfig (etc) for that client - and ditto "client B"
p33022
aVMay SCM systems allow this type of per-client configuration, or it is pretty easy to do it with a few build scripts
p33023
aVThe alternative (if they absolutely must be the same physical code files on the same server) is to move this into the machine's web
p33024
aVconfig - much more complicated, but you can use the "location" node in web
p33025
aVconfig to specify connection-strings per IIS site, even if they resolve to the same files
p33026
aVI stress that this is risky, hard to verify, and easy to get wrong - the build process is my preferred option
p33027
as(dp33028
g18
V23354
p33029
stp33030
a((dp33031
g2
(lp33032
VThe size figure comes largely from the amount of time it takes to copy the struct on the stack, for example to pass to a method
p33033
aVAnything much larger than this and you are consuming a lot of stack space and CPU cycles just copying data - when a reference to an immutable class (even with dereferencing) could be a lot more efficient
p33034
as(dp33035
g18
V23354
p33036
stp33037
a((dp33038
g2
(lp33039
VVarious reasons:
p33040
aVHistory:  didn't exist until
p33041
aVNET 2
p33042
aV0, and it can't break existing code - especially with the different boxing rules for
p33043
aVMeaning: if I want an , I might not want it to be nullable
p33044
aVI want it to be an , and I don't want to have to check-for/handle nulls
p33045
aVSpace: it adds extra cost to each struct
p33046
aVin particular, imagine a , and now consider if  was nullable - lots of extra overhead; plus it would stop you doing blits* etc*
p33047
aVPerformance:  adds lots of extra penalties; in particular lots of hidden calls to  and  / ; this is shown in particular in the "lifted operators" - i
p33048
ag50
aVbecomes something like below, which adds up for tight loops etc:
p33049
aVLikewise,  has to check:
p33050
aVif both null => true
p33051
aVif one null => false
p33052
aVotherwise use  on  of each
p33053
aVlots of overhead
p33054
as(dp33055
g18
V23354
p33056
stp33057
a((dp33058
g2
(lp33059
VIf you want to prevent tampering, you want signing/hashing, not encryption
p33060
aVSimilar theory - but it means you can validate the file with the public key in the app, without requiring the private key that you keep on your server (and use to issue licenses)
p33061
aVSearch for cryptographic hashing / signing
p33062
as(dp33063
g18
V23354
p33064
stp33065
a((dp33066
g2
(lp33067
Vthe / is unrelated; that is a conversion, not a cast - there is no relationship between  and
p33068
aVRe the question; a type's object is fixed at creation
p33069
aVAn object that is a  is not (and can never be) an
p33070
aVHowever, you can treat an  as a , since inheritance represents "is a"
p33071
aVFor example:
p33072
aVHere we still only have one object - simply that the  variable thinks of it as a , so won't expose methods specific to  (even though the object is an )
p33073
aVIf we then add:
p33074
aVThis is a type check; again, we haven't changed the object, but to put  into an  variable requires us to prove to the compiler/runtime that it really is an
p33075
aVWe didn't need this in the first example as it can already prove that any  is also a
p33076
aVLikewise, with the  - all the cast does is change how the compiler thinks of the object; you haven't changes the object itself
p33077
aVIt is still a
p33078
aVYou need to separate variables from objects
p33079
aVThe cast is talking about the variables; they don't change the object
p33080
as(dp33081
g18
V23354
p33082
stp33083
a((dp33084
g2
(lp33085
VThat is essentially: "which is better: a bucket or a hose
p33086
aVA  is the bucket here; it allows you to carry around a disconnected set of data and work with it - but you will incur the cost of carrying the bucket (so best to keep it to a size you are comfortable with)
p33087
aVA data-reader is the hose: it provides one-way/once-only access to data as it flies past you;  you don't have to carry all of the available water at once, but it needs to be connected to the tap/database
p33088
aVAnd in the same way that you can fill a bucket with a hose, you can fill the  with the data-reader
p33089
aVThe point I'm trying to make is that they do different things
p33090
aVI don't personally use  very often - but some people love them
p33091
aVI do, however, make use of data-readers for BLOB access etc
p33092
as(dp33093
g18
V23354
p33094
stp33095
a((dp33096
g2
(lp33097
VTo simply invoke the click - you should be able to use
p33098
aVI was a little lost by the other things you mentioned - can you clarify
p33099
as(dp33100
g18
V23354
p33101
stp33102
a((dp33103
g2
(lp33104
VWe know that the data from  is going to be filtered by the (inner) join to  (the data in  is also filtered)
p33105
aVSo if we (inner) join from  to , thus the set  is also filtered by the relationship to
p33106
aVAnd note also that any duplicates from the join will be included
p33107
aVHowever; what order this happens in is up to the optimizer; it could decide to do the / join first then introduce , or any other sequence (probably based on the estimated number of rows from each join and the appropriate indexes)
p33108
aVHOWEVER; in your later example you use a  join; so  is not filtered at all, and may well my duplicated if any of the other tables have multiple matches
p33109
aVAre there duplicates (per account) in
p33110
as(dp33111
g18
V23354
p33112
stp33113
a((dp33114
g2
(lp33115
VCovered here; in short, you need to handle the windows message manually (at it isn't handled directly in
p33116
aVNET - code is from the linked article):
p33117
as(dp33118
g18
V23354
p33119
stp33120
a((dp33121
g2
(lp33122
VYou say you are creating the assembly via reflection
p33123
aVbut WCF internally also does type generation; I wonder if there isn't some duplication here
p33124
aVYou can get the WCF-generated service type via something like:
p33125
aVHowever - re the question; if you are using , I wonder if you haven't used  to associate the actual method with the interface
p33126
aVThis might be implicit for C#, but it needs to be explicit in the IL
p33127
as(dp33128
g18
V23354
p33129
stp33130
a((dp33131
g2
(lp33132
VWriting your own serialization code is error prone and time consuming
p33133
aVAs a thought - have you considered existing open-source portable formats, for example "protocol buffers"
p33134
aVThis is a high density binary serialization format that underpins much of Google's data transfer etc
p33135
aVVersions are available in a wide range of languages - including Java/C++ etc (in the core Google distribution), and a vast range of others
p33136
aVIn particular, for
p33137
aVNET-idiomatic usage, protobuf-net looks a lot like  or  (indeed, it can even work purely with xml/wcf attributes if it includes an order on each element) - or can use the specific protobuf-net attributes:
p33138
aVIf you want to guarantee portability to other implementations, the recommendation is to start "contract first", with a "
p33139
aVproto" file - in this case, something like:
p33140
aVThis
p33141
aVproto file can then be used to generate any language-specific variant; so with protobuf-net you'd run it through "protogen" (included in protobuf-net; and a VS2008 add-on is in progress); or for Java/C++ etc you'd run it through "protoc" (included in Google's protobuf)
p33142
aV"protogen" in protobuf-net can currently emit C# and VB, but it is pretty easy to add another language if you want to use F# etc - it just involves writing (or migrating) an xslt
p33143
aVThere is also another
p33144
aVNET version that is a more direct port of the Java version; as such it is less
p33145
aVNET idiomatic
p33146
aVThis is dotnet-protobufs
p33147
as(dp33148
g18
V23354
p33149
stp33150
a((dp33151
g2
(lp33152
VIn the case of , that isn't a direct option (although some stream wrappers do allow you to control this, for example  etc)
p33153
aVJon has a NonClosingStreamWrapper in MiscUtil which should work: you wrap your stream in the non-closing wrapper, and give the wrapper to
p33154
aVThis essentially passes through everything except  and
p33155
as(dp33156
g18
V23354
p33157
stp33158
a((dp33159
g2
(lp33160
V - something like:
p33161
as(dp33162
g18
V23354
p33163
stp33164
a((dp33165
g2
(lp33166
VYes it is possible for that to generate the same numbers
p33167
aVThe seed adds nothing (it is time based by default anyway)
p33168
aVAlso - if it is static, you should synchronize it ( is not thread-safe):
p33169
aVThis can still generate the same number by coincidence of course
p33170
aVPerhaps consider a cryptographic random number generator if entropy is important
p33171
as(dp33172
g18
V23354
p33173
stp33174
a((dp33175
g2
(lp33176
VIf you want performance, something like:
p33177
as(dp33178
g18
V23354
p33179
stp33180
a((dp33181
g2
(lp33182
VWell, both tpi and x are variables (of different sorts) that get captured in one of the examples
p33183
aVthe main point here is that you want to restrict the scope of the captured variable (ideally ) to inside the loop
p33184
aVSo, perhaps; "capture the value of the iteration variable; not the iteration variable itself"
p33185
as(dp33186
g18
V23354
p33187
stp33188
a((dp33189
g2
(lp33190
VYou can do this in
p33191
aVNET 3
p33192
aV5 and above using expression trees; I'll knock up a C# example, and try to run it through reflector for VB
p33193
aVC#:
p33194
aVThe VB is below, but note that the VB compiler seems to use different names (like , not ):
p33195
as(dp33196
g18
V23354
p33197
stp33198
a((dp33199
g2
(lp33200
VCan you show the  class
p33201
aVIn particular, for use with  it must have a public parameterless constructor, and all* the properties must be public with both getters and setters; so the following would behave like you've described:
p33202
aVbut this would work:
p33203
aV*=with some minor caveats
p33204
as(dp33205
g18
V23354
p33206
stp33207
a((dp33208
g2
(lp33209
VHave you recently used multi-monitor
p33210
aVIs it possible that it is opening off-screen
p33211
aVI get this problem a lot when disconnecting my laptop from an external monitor
p33212
aV(edit) There is a Window -> Reset Window Layout menu option in SSMS 2008, that should fix it
p33213
as(dp33214
g18
V23354
p33215
stp33216
a((dp33217
g2
(lp33218
VPerhaps a table variable
p33219
as(dp33220
g18
V23354
p33221
stp33222
a((dp33223
g2
(lp33224
VYou can do this with a cheaky variable that captures itself ;-p
p33225
aVThe first line with  is required to satisfy definite assignment; but you are allowed to capture this variable inside the anon-method
p33226
as(dp33227
g18
V23354
p33228
stp33229
a((dp33230
g2
(lp33231
VA dataset is (by definition) disconnected
p33232
aVIf you want to commit new data / updates / deletes (etc), you are going to have to ask the adapter to save the changes
p33233
aVIf you already have a generated adapter, this should be about 1 line of extra code
p33234
aV( on the adapter, usually via a save button's  handler)
p33235
as(dp33236
g18
V23354
p33237
stp33238
a((dp33239
g2
(lp33240
VInteresting
p33241
aVthoughts:
p33242
aVwhat version of CF is this; 2
p33243
ag190
ag9575
ag691
aVIn particular, CF 3
p33244
aV5 has  that allows protobuf-net to access properties much faster than in can in CF 2
p33245
ag190
aVare you annotating fields or properties
p33246
aVAgain, in CF the reflection optimisations are limited; you can get beter performance in CF 3
p33247
aV5 with properties, as with a field the only option I have available is
p33248
aVThere are a number of other things that simply don't exist in CF, so it has to make compromises in a few places
p33249
aVFor overly complex models there is also a known issue with the generics limitations of CF
p33250
aVA fix is underway, but it is a big change, and is taking "a while"
p33251
aVFor info, some metrics on regular (full)
p33252
aVNET comparing various formats (including  and protobuf-net) are here
p33253
as(dp33254
g18
V23354
p33255
stp33256
a((dp33257
g2
(lp33258
VIf the base-class has something to say, but you want it overridden "every time", then I would have a pair of methods:
p33259
as(dp33260
g18
V23354
p33261
stp33262
a((dp33263
g2
(lp33264
VLet doesn't have its own operation; it piggy-backs off of
p33265
aVYou can see this if you use "reflector" to pull apart an existing dll
p33266
aVit will be something like:
p33267
as(dp33268
g18
V23354
p33269
stp33270
a((dp33271
g2
(lp33272
VIn part, it depends on what your scenario is
p33273
aVThe "simple" answer is to just compile the expression and invoke it, but that has a potential performance impact if you are doing it in a tight loop (passing a delegate would be a lot quicker)
p33274
aVI'm not sure whether if would apply in this particular case (because of the ), but to avoid doing too much expression compilation, you can look for simple scenarios and read the value directly from the expression tree; a little bit of / is going to be quicker than compiling it
p33275
aVFor more, look at  here, and how it is used with  as a backup strategy (although you have the advantage of a known delegate type)
p33276
as(dp33277
g18
V23354
p33278
stp33279
a((dp33280
g2
(lp33281
VUnlike EF, LINQ-to-SQL is very much a direct layer on top of your tables
p33282
aVYou should have an EmployeeTeams entry on the data-context, so you can just add objects to that:
p33283
aVAlternatively, you may be able to use the navigation properties:
p33284
aVIn EF, you can hide these bridging tables (i
p33285
ag50
aV); but with LINQ-to-SQL you have to deal with them normally
p33286
as(dp33287
g18
V23354
p33288
stp33289
a((dp33290
g2
(lp33291
VHow about "don't use OleDbConnection"
p33292
aVwriting delimited files with  is pretty simple (escaping aside)
p33293
aVFor reading, CsvReader
p33294
as(dp33295
g18
V23354
p33296
stp33297
a((dp33298
g2
(lp33299
VA class to a varchar
p33300
aVI'm not aware of any functionality that supports this in LINQ-to-SQL
p33301
aVYour best bet may be a simple property (it can be private if you need):
p33302
aV(i
p33303
ag50
aVread from or update your actual  property)
p33304
aVI also expect that you'd have to leave this off the designer, and add it yourself (and the  property) in a partial class
p33305
as(dp33306
g18
V23354
p33307
stp33308
a((dp33309
g2
(lp33310
VAs you note; there aren't any good options for this
p33311
aVYou might consider different names (rather than overloads) -  etc
p33312
aVHowever, I wonder whether it would be simpler to drop the constraint
p33313
aVA single type-check with "as" isn't exactly "heavy" type-casting, and it might save a lot of pain
p33314
as(dp33315
g18
V23354
p33316
stp33317
a((dp33318
g2
(lp33319
VAs a cheap option
p33320
aVperhaps a flag you can set on your object(s) that disables validation and always returns  from the 2  methods
p33321
aVIf it is a major problem you could introduce a pass-thru object that mimics the actual type but doesn't implement
p33322
aVEither by manually coding a facade, or with some inventive use of  (presumably an  or ; note it wouldn't be worth it just for a single type - writing a class manually would be easier)
p33323
as(dp33324
g18
V23354
p33325
stp33326
a((dp33327
g2
(lp33328
VI've posted an option here (including example) on this old usenet post - look for  (don't panic - most of the code is setting up the example; the list class is very small); it might help a bit, but IMO you might do better to simply do the UI updates a bit later
p33329
aV(don't miss the updates lower in the thread)
p33330
as(dp33331
g18
V23354
p33332
stp33333
a((dp33334
g2
(lp33335
VIf you change the field names and need to read old data serialized before your changes, then it could get messy
p33336
aVis largely a field(name)-based serializer, and it won't be happy
p33337
aVChanging properties and methods should be fine as long as no external code is referencing it (and be sure to run your unit tests)
p33338
aVViable options at that point: manual serialization () and serialization surrogates
p33339
aVLots of pain
p33340
aVIf you are using  /  then you can name the serialization name separately to the member name, so really easy to fix
p33341
aVAnd some other serializers don't use names at all ;-p
p33342
aVexample:
p33343
as(dp33344
g18
V23354
p33345
stp33346
a((dp33347
g2
(lp33348
VIt is convention to use  for generic types (comparable with "templates" in C++ etc)
p33349
aVIf there is a single type () then just  is fine (there is nothing more to explain); but if there are multiple generic types, the  prefixes the purpose
p33350
aVHence  is the generic type of the "key", and  of the value
p33351
aVIf helps in this case if you know that a dictionary maps keys to values
p33352
aVThe intellisense will usually tell you what each type-argument means; for example with :
p33353
aV: The type of the first parameter of the method that this delegate encapsulates
p33354
aV: The type of the second parameter of the method that this delegate encapsulates
p33355
aV: The type of the return value of the method that this delegate encapsulates
p33356
aV(taken from the type's comment data)
p33357
as(dp33358
g18
V23354
p33359
stp33360
a((dp33361
g2
(lp33362
VI'd probably look at something like below; the  can be done outside (as can the selector to be honest):
p33363
aVIf you expect to start at 1:
p33364
aVTo start with the first item in the list:
p33365
aVIt isn't clear how you wanted to handle nulls, so I didn't
p33366
aVNote that this only iterates once, and doesn't buffer everything
p33367
as(dp33368
g18
V23354
p33369
stp33370
a((dp33371
g2
(lp33372
VI don't get this option either - just Create -> Project
p33373
aVAre you sure this ever existed
p33374
aVOf course; it isn't that often you create a new project/web-site
p33375
aVPerhaps just use File -> New -> Web Site
p33376
aVinstead
p33377
aV- or:
p33378
aVShift + Alt + n
p33379
as(dp33380
g18
V23354
p33381
stp33382
a((dp33383
g2
(lp33384
VThat is a namespace issue; you need to get the name-table, pick an alias, and use that in your query
p33385
aVOr perhaps (in this case) try
p33386
aVOr:
p33387
as(dp33388
g18
V23354
p33389
stp33390
a((dp33391
g2
(lp33392
VSet  and all the edit features (including new rows) will be hidden
p33393
aVFor more granularity, look at the  properties
p33394
as(dp33395
g18
V23354
p33396
stp33397
a((dp33398
g2
(lp33399
VIf the dll is not available at execution time; yes it will fail
p33400
aVHowever:
p33401
aVmany Microsoft dlls are pre-installed with
p33402
aVNET (caveat: "client profile")
p33403
aVmany of the Microsoft dlls are redistributable; so you can include them with your package
p33404
aVThere isn't a linker provided in the core framework, although ILMerge may be useful
p33405
as(dp33406
g18
V23354
p33407
stp33408
a((dp33409
g2
(lp33410
V with a  seems a good option:
p33411
as(dp33412
g18
V23354
p33413
stp33414
a((dp33415
g2
(lp33416
VI would argue that it is essential to unit test serialization if it is vitally important that you can read data between versions
p33417
aVAnd you must test with "known good" data (i
p33418
ag50
aVit isn't sufficient to simply write data in the current version and then read it again)
p33419
aVYou mention that you don't have a schema
p33420
aVwhy not generate one
p33421
aVEither by hand (it isn't very hard), or with
p33422
aVThen you have something to use as a template, and you can verify this just using
p33423
aVI'm doing  a lot of work with xml serialization at the moment, and it is a lot easier to update the schema than it is to worry about whether I'm getting the data right
p33424
aVEven  can get complex; particularly if you involve subclasses (), custom serialization (), or non-default  construction (passing additional metadata at runtime to the ctor)
p33425
aVAnother possibility is creative use of ,  or ; for example you might support unexpected data for round-trip (only) in version X, but store it in a known property in version Y
p33426
aVWith serialization in general:
p33427
aVThe reason is simple: you can break the data
p33428
aVHow badly you do this depends on the serializer; for example, with  (and I know the question is ), simply changing from:
p33429
aVto
p33430
aVcould be enough to break serialization, as the field name has changed (and  loves fields)
p33431
aVThere are other occasions when you might accidentally rename the data (even in contract-based serializers such as  / )
p33432
aVIn such cases you can usually override the wire identifiers (for example  etc), but it is important to check this
p33433
aVUltimately, it comes down to: is it important that you can read old data
p33434
aVIt usually is; so don't just ship it
p33435
aVprove that you can
p33436
as(dp33437
g18
V23354
p33438
stp33439
a((dp33440
g2
(lp33441
VIs the other user you
p33442
aVI'm assuming the failed disk still has the files available
p33443
aVon a separate bit of disk - i
p33444
ag50
aVdon't overwrite the "good" files yet:
p33445
aVIn VSS explorer, locate the files and undo checkout
p33446
aVIt'll ask you to confirm; agree
p33447
aVNow check the files back out
p33448
aVCopy the good files over these, and check in
p33449
as(dp33450
g18
V23354
p33451
stp33452
a((dp33453
g2
(lp33454
VCsvReader is a pretty good one
p33455
aVit isn't Microsoft, but it works very well, and is a lot faster than some of the alternatives (legacy OleDb etc)
p33456
as(dp33457
g18
V23354
p33458
stp33459
a((dp33460
g2
(lp33461
VNote that generics and nested types have funky names, any you might want to use  to include the namespace
p33462
as(dp33463
g18
V23354
p33464
stp33465
a((dp33466
g2
(lp33467
VYou really need a list of objects that have a string property
p33468
aVWith
p33469
aVNET 3
p33470
aV5 you could cheat:
p33471
aVOtherwise create a dummy class and copy the data in manually
p33472
as(dp33473
g18
V23354
p33474
stp33475
a((dp33476
g2
(lp33477
VThese values in an xml file are identifiers, not locators
p33478
aVUnless you are expecting to download a schema, it is not needed at all, and can be "flibble" if needed
p33479
aVI expect the best thing would be to just load it into  /  and try to access the data
p33480
aVFor example:
p33481
aVor to loop over the  elements:
p33482
aVNote that the aliases used in the document are largely unrelated to the aliases used in the , hence you need to re-declare it
p33483
aVI could have used  as my alias in the C# just as easily
p33484
aVOf course, if you prefer to work with an object model; run it through  (where  is your example file):
p33485
aVNow you can load it with
p33486
as(dp33487
g18
V23354
p33488
stp33489
a((dp33490
g2
(lp33491
VSince it is marked as inherited, there isn't much you can do in this case (since you don't control the code that is checking for the attribute via reflection)
p33492
aVImplementing your own attribute seems the most practical option
p33493
aVWith MVC you can also often achieve the same functionality with overrides (the  methods), which might be worth looking into
p33494
as(dp33495
g18
V23354
p33496
stp33497
a((dp33498
g2
(lp33499
VHaving enormous blocks of memory is never a good idea, even in 64bit
p33500
aVYou get big problems with contiguous memory and fragmentation
p33501
aVThe problem here is finding a contiguous block
p33502
aVYou could try enabling 3gb mode (which might help it find a few more bytes) but I really advise against it
p33503
aVThe answers here are:
p33504
aVuse less memory
p33505
aVuse a database/file system
p33506
aVuse x64
p33507
aVYou might also want to read Eric Lippert's blog (he seems to have a blog entry for every common
p33508
aVNET question
p33509
as(dp33510
g18
V23354
p33511
stp33512
a((dp33513
g2
(lp33514
VIt sounds to me like you might want to look at something like "protocol buffers", which (unlike ) is a high-performance, low-bandwidth, portable/cross-platform, version-tolerant binary serialization format (wow, that's a mouthful)
p33515
aVFortunately, there are versions in
p33516
aVNET, such as protobuf-net
p33517
aV(disclosure: I'm the author, but it is free; I'm not trying to sell you anything - just save you a lot of time and pain)
p33518
aVis very
p33519
aVbrittle; it is
p33520
aVNET specific and has relatively poor version tolerance
p33521
aVThe only time I use it is behind the scenes for communicating between s on the same machine
p33522
aVOtherwise, I'd look at contract-based serializers, such as , , or protobuf-net
p33523
as(dp33524
g18
V23354
p33525
stp33526
a((dp33527
g2
(lp33528
VIn 3
p33529
aV0, this is quite hard; but was improved in 3
p33530
aV5 (read Detect Client IP in WCF 3
p33531
aV5)
p33532
aVI'm not aware of an event, though
p33533
as(dp33534
g18
V23354
p33535
stp33536
a((dp33537
g2
(lp33538
V1 million a day is not a lot; I'd just use  (a quick test using  shows that on my lowly laptop it can create 1M objects from a in ~2s)
p33539
aVThoughts on creating objects quickly:
p33540
aVuse generics and the  constraint (zero effort)
p33541
aVuse  and write the IL (not hard)
p33542
aVAn implementation of the  approach (without needing the  constraint externally) is shown here:
p33543
aVFor an IL example, see dapper-dot-net and
p33544
as(dp33545
g18
V23354
p33546
stp33547
a((dp33548
g2
(lp33549
VWell, you could use a  inside the variable; but in this case I think I'd try :
p33550
aVthe  approach:
p33551
as(dp33552
g18
V23354
p33553
stp33554
a((dp33555
g2
(lp33556
VWe've had problems with this before
p33557
aVSome thoughts:
p33558
aVrun the setup as admin; on one occasion (isolated
p33559
aVit only worked as the local "administrator" account; it failed even for a domain admin
p33560
aVshut down IIS, COM+, etc first
p33561
aVOther than that; you'll want to look at the msi log file
p33562
as(dp33563
g18
V23354
p33564
stp33565
a((dp33566
g2
(lp33567
VIMO, the easiest option would be to do a new checkout to a separate location, of the folder at the version you want (i
p33568
ag50
aVbefore you deleted them) - then copy the files over
p33569
as(dp33570
g18
V23354
p33571
stp33572
a((dp33573
g2
(lp33574
VFrom the description I assume you are using
p33575
aVThe fact is that  lacks the granularity for this
p33576
aVIt doesn't support callbacks (which would allow you to detect serialization), etc
p33577
aVOptions:
p33578
aVimplement  - lots of work (with /), and easy to get wrong
p33579
aVdon't do it unless you have to
p33580
aVuse a different serializer (such as , which also supports private getters/setters or fields, but doesn't support full xml control) - for example see here
p33581
aVuse a separate DTO; i
p33582
ag50
aVuse your class with private setter in the app, and a separate (simpler) class (public get/set) for serialization, perhaps with an implicit conversion operator between them
p33583
aVmake the get/set public and don't worry about it
p33584
aVI think I'd go for the DTO option; it retains the simple but complete formatting control over the xml, and isn't much work
p33585
as(dp33586
g18
V23354
p33587
stp33588
a((dp33589
g2
(lp33590
VAren't they interchangeable
p33591
aVIn one it is using  to set the namespace at the element, and in the other a  alias - but the meaning is the same, and IMO the second version is cleaner
p33592
aVThere is the  class that can fix this ; full example:
p33593
aVOutput ( is because of ):
p33594
as(dp33595
g18
V23354
p33596
stp33597
a((dp33598
g2
(lp33599
VIf you were serializing, then  () would be worth trying - but this won't help reading
p33600
aVA bit grungy, but perhaps do this directly in the setter:
p33601
as(dp33602
g18
V23354
p33603
stp33604
a((dp33605
g2
(lp33606
VThe closest you can do (except for your base-interface approach) is "", meaning reference-type
p33607
aVThere is no syntax to mean "any interface"
p33608
aVThis ("") is used, for example, in WCF to limit clients to service contracts (interfaces)
p33609
as(dp33610
g18
V23354
p33611
stp33612
a((dp33613
g2
(lp33614
VAt a guess; write to a  (not a )
p33615
aVIf you write to a  (inc
p33616
aV/, you are implicitly using
p33617
aVNET's UTF-16 string
p33618
aVIf you just want to tweak the reported encoding (but use a ), then look at Jon's answer here
p33619
as(dp33620
g18
V23354
p33621
stp33622
a((dp33623
g2
(lp33624
V(this is supplemental to the existing answers - a few extra considerations)
p33625
aVThere is another scenario for using  with C#, more commonly seen in things like XNA
p33626
aVNormally, when you pass a value-type () around, it gets cloned
p33627
aVThis uses stack-space and a few CPU cycles, and has the side-effect that any modifications to the  in the invoked method are lost
p33628
aV(aside: normally s should be immutable, but mutable structs isn't uncommon in XNA)
p33629
aVTo get around this, it is quite common to see  in such programs
p33630
aVBut in most programs (i
p33631
ag50
aVwhere you are using es as the default), you can normally just pass the reference "by value" (i
p33632
ag50
aVno /)
p33633
aVAnother very common use-case of  is the  pattern, for example:
p33634
aVOr similarly,  on a dictionary
p33635
aVThis could use a tuple instead, but it is such a common pattern that it is reasonably understood, even by people who struggle with too much /
p33636
as(dp33637
g18
V23354
p33638
stp33639
a((dp33640
g2
(lp33641
VEntity SQL is slightly higher level (in places) than Transact SQL
p33642
aVOther than that, HQL, etc
p33643
aVFor object-model approaches, LINQ () is much higher level, allowing simple navigation:
p33644
aVetc
p33645
as(dp33646
g18
V23354
p33647
stp33648
a((dp33649
g2
(lp33650
VTo use O(n) memory and O(n) performance, create a stack; push everything on as you iterate  in the forwards direction, then pop everything off, yielding the results
p33651
aVTo use O(n^2) performance (but O(1) extra memory), read it forwards each time, up the the node before the last one you got to
p33652
aVExample:
p33653
as(dp33654
g18
V23354
p33655
stp33656
a((dp33657
g2
(lp33658
VPerhaps use  instead of ; there are overloads for
p33659
aVDo you need the extra bit of range
p33660
aVIf so, cast / convert as late as possible
p33661
as(dp33662
g18
V23354
p33663
stp33664
a((dp33665
g2
(lp33666
VIMO, Windows 7 is a better OS than Vista - a much better user experience; but from a coding perspective I'm not sure it will make a big difference
p33667
aVA better question would probably be related to (for example) the impact of
p33668
aVNET 4
p33669
aV0, Visual Studio 2010 or Silverlight 3
p33670
ag190
aVAnd in answer;
p33671
aVNET 4
p33672
aV0 introduces much better (read: easier) support for multi-core programming
p33673
aVThis is a big help, given the CPU changes
p33674
as(dp33675
g18
V23354
p33676
stp33677
a((dp33678
g2
(lp33679
VASP
p33680
aVNET MVC comes with all the common DI frameworks available on code-project, and it is pretty easy to do it yourself, too - I rewrote the StructureMap one to support some specific scenarios (picking the SM configuration out of the route data)
p33681
aVSo that deals with the main differentiator you mentioned in the question ;-p
p33682
aVI'd use ASP
p33683
aVNET MVC, personally
p33684
aVbut it could come close either way
p33685
aVI simply expect ASP
p33686
aVNET MVC to be more mainstream, what with the "official" card leading to more books/community/etc
p33687
aVJust look at the tags count here on SO; asp
p33688
aVnet-mvc (and similar) 4k+; monorail
p33689
aVhard to find
p33690
as(dp33691
g18
V23354
p33692
stp33693
a((dp33694
g2
(lp33695
VBecause an interface is generally the least functionality required to make it usable, to reduce the burden on the implementors
p33696
aVWith C# 3
p33697
aV0 you can add this as an extension method:
p33698
aVet voila;  now has :
p33699
as(dp33700
g18
V23354
p33701
stp33702
a((dp33703
g2
(lp33704
VHow much is too much
p33705
aVThe \u20ac1M question
p33706
aVProfile
p33707
aVThen profile
p33708
aVIf your app is spending most of its time doing data access, you have a problem (and should look at a sql trace)
p33709
aVIf it is spending most of its time drawing the UI, then (assuming your view isn't doing data access) you should probably look elsewhere first
p33710
as(dp33711
g18
V23354
p33712
stp33713
a((dp33714
g2
(lp33715
VIt really depends what you are trying to do
p33716
aVI'm not sure, for example, why you are url-encoding data in the body
p33717
aVAn easier way to post key/value pairs is with ;
p33718
as(dp33719
g18
V23354
p33720
stp33721
a((dp33722
g2
(lp33723
V is actually more related to caching (in registers etc); with  you know that that value is actually written-to/read-from memory immediately (which isn't actually always the case otherwise)
p33724
aVThis allows different threads to immediately see updates from each other
p33725
aVThere are other subtle issues with instruction re-ordering, but that gets complex
p33726
aVThere are two meanings of "atomic" to consider here:
p33727
aVis a single read atomic by itself / write atomic by itself (i
p33728
ag50
aVcould another thread get two different halves of two s, yielding a number that never actually existed)
p33729
aVis a read/write pair atomic/isolated together
p33730
aVThe "by itself" depends on the size of the value; can it be updated in a single operation
p33731
aVThe read/write pair is more to do with isolation - i
p33732
ag50
aVpreventing lost updates
p33733
aVIn your example, it is possible for two threads to read the same , both do the calculations, and then (separately) update
p33734
aVOne of those updates is going to get lost
p33735
aVIn reality, I expect you want a  over the duration of the read/write process
p33736
as(dp33737
g18
V23354
p33738
stp33739
a((dp33740
g2
(lp33741
VThere is a big difference between  and ; your example only shows
p33742
aVBut in answer; not really
p33743
aVwhat value whould you give it
p33744
aVYou could test and use the default, or use  (aka ):
p33745
aVWith  (not )
p33746
aVor to take  into account:
p33747
as(dp33748
g18
V23354
p33749
stp33750
a((dp33751
g2
(lp33752
VIf you make changes behind the back of the ORM, and don't use concurrency checking - then you are going to have problems
p33753
aVYou don't show what you did in step "3", but IMO you should update the object model to reflect these changes, perhaps using  TSQL paramaters
p33754
aVOr; stick to object-oriented
p33755
aVOf course, doing anything without concurrency checking is a good way to lose data - so my preferred option is simply "add a "
p33756
aVOtherwise, you could perhaps read the updated object out and merge things
p33757
aVsomehow guessing what the right data is
p33758
as(dp33759
g18
V23354
p33760
stp33761
a((dp33762
g2
(lp33763
VReflection is powerful, but has drawbacks
p33764
aVIn general, try to code without it - but it is hugely useful for "framework" libraries, where you have little/limited knowledge what the actual objects will be; for example:
p33765
aVORM / DAL tools (loading/saving arbitrary data)
p33766
aVdata-binding
p33767
aVserialization
p33768
aVThere are performance penalties with ad-hoc reflection, but if you are going to do it lots (within your library, and in a tight loop) you can mitigate against this:
p33769
aVby using  (as a typed delegate; don't use )
p33770
aVby writing dynamic IL
p33771
aVby using  in
p33772
aVNET 3
p33773
ag691
aVAnd of course, any such code should be cached and re-used (you don't want to compile+execute for every call; just the first - the rest should just execute)
p33774
aVOr there are libraries that abstract this; for example, HyperPropertyDescriptor wraps custom IL (for member access) in the familiar  API - making it very fast but painless
p33775
aVYour question mentions data-tables and entities; which sounds a lot like this previous question, where I did some metrics using HyperDescriptor, with summary (in milliseconds):
p33776
aVSo my "take":
p33777
aVin the application; very little - as a last resort, generally
p33778
aVin your common library/libraries; where appropriate (noting that interfaces etc are preferable where possible)
p33779
as(dp33780
g18
V23354
p33781
stp33782
a((dp33783
g2
(lp33784
VI have actually no idea of what this is called in c#"
p33785
aVA fluent API;  is the most common
p33786
aVNET example:
p33787
as(dp33788
g18
V23354
p33789
stp33790
a((dp33791
g2
(lp33792
VI like xslt, and use it quite a bit
p33793
aVAs long as you think in terms of functional programming (i
p33794
ag50
aVset-once variables, similar to F# etc), then it is hugely versatile
p33795
aVI use it regularly for data transformation, presentation (in particular [x]html), and versatile code generation
p33796
aVDefinitely highly programming related; nobody except a programmer would grok it - but a very powerful tool
p33797
aVI have a few xslt (split over a few / files) that is substantially more than the 800 you mention in the post
p33798
aVit really can (when used correctly) be a fully featured environment
p33799
aVNotes:
p33800
aVbest used at the server; client-side support is hit'n'miss
p33801
aVa few key things missed in 1
p33802
aV0; regex; case-insensitivity; etc
p33803
aVcan be tricky if whitespace is important
p33804
aVOne particularly useful feature of xslt (as a separate file) is that it makes it possible to change the transform without rebuilding any code
p33805
aVThe code-gen example is from an open source project I run; I know of several users who have dipped in and tweaked the code-gen for their local standards
p33806
aVOne use even went as far as writing the transform for an entire second language - and all without touching the binaries
p33807
as(dp33808
g18
V23354
p33809
stp33810
a((dp33811
g2
(lp33812
VIf you throw an exception in the setter, then  is redundant since it can't (in theory) get into an illegal state
p33813
aVallows you to accept all input, but tell the user that there is a problem
p33814
aVThe nice thing about this is that it allows less interruption to the UI (as the user can continue to enter data even though one field is in error and marked as such), and it is easy to report multiple errors at once - visually, rather than by message-boxes etc
p33815
aVHowever, if you go this route you need to be sure to validate that the object is OK before saving it to a database, etc
p33816
aVYou could do this by checking  from your business logic (and check that it is /empty), assuming that you write  to report all errors
p33817
aVOr a similar  method
p33818
as(dp33819
g18
V23354
p33820
stp33821
a((dp33822
g2
(lp33823
VNote that raw text manipulation is usually a poor way to treat xml - for example, you aren't handling attributes, namespaces, trailing tag whitespace ) etc at the moment
p33824
aVNormally, I'd say load it into a DOM (/ for xhtml; HTML Agaility Pack for html) - but actually I wonder whether an xslt would be good in this case
p33825
aVFor example:
p33826
aVWith strip
p33827
aVxslt:
p33828
as(dp33829
g18
V23354
p33830
stp33831
a((dp33832
g2
(lp33833
VIntegers ( etc) in
p33834
aVNET are not directly nullable; however, there is  that allows you to make any value-type nullable-ish
p33835
aVNote that you may have to check the database against  rather than /
p33836
aVSo yes, you can do something very similar
p33837
as(dp33838
g18
V23354
p33839
stp33840
a((dp33841
g2
(lp33842
VFrom your line:
p33843
aVI have a code that is working on many small byte arrays (8-10 bytes long)
p33844
aVPersonally, I'd be more interested in allocating a spare buffer somewhere that different parts of your code can re-use (while processing the same block)
p33845
aVThen you don't have any creation/GC to worry about
p33846
aVIn most cases (where the buffer is used for very discreet operations) with a scratch-buffer, you can even always assume that it is "all yours" - i
p33847
ag50
aVevery method that needs it can assume that they can start writing at zero
p33848
aVI use this single-buffer approach in some binary serialization code (while encoding data); it is a big boost to performance
p33849
aVIn my case, I pass a "context" object between the layers of serialization (that encapsulates the scratch-buffer, the output-stream (with some additional local buffering), and a few other oddities)
p33850
as(dp33851
g18
V23354
p33852
stp33853
a((dp33854
g2
(lp33855
VI do not want to use typeof(typename) due to inheritance issues
p33856
aVstatic properties aren't inherited in the normal sense
p33857
aVSure, they are in-scope, but that isn't the same
p33858
aVThe only way to get what you want would be to look at the stack-frame, but that is ugly and hacky (and risky if optimisations are enabled)
p33859
aVI'd refactor for a solution that uses the instace
p33860
aVinstance have a
p33861
as(dp33862
g18
V23354
p33863
stp33864
a((dp33865
g2
(lp33866
VAFAIK, the regular licence for VS is for the user, not the install
p33867
aVSo if this is available (and I've not heard of it myself), it would be under a different license
p33868
aVHow large is the work
p33869
aVCould you get it done during a trial license
p33870
aVHopefully that will be enough to convince you to buy a copy (or even an MSDN subscription) for long-term use
p33871
as(dp33872
g18
V23354
p33873
stp33874
a((dp33875
g2
(lp33876
VTo be honest, if you don't know the type at compile time, there isn't a huge amount of benefit in creating a
p33877
aVYou don't want to use ; it will be about as slow as reflection
p33878
aVThe main exception to this is when there is a delegate-type lurking in the shadows, for example when subscribing to an event - in which case  makes this available
p33879
aVFor info, in
p33880
aVNET 3
p33881
aV5 on , there is:
p33882
aVThat might help to an extent:
p33883
as(dp33884
g18
V23354
p33885
stp33886
a((dp33887
g2
(lp33888
VLike so:
p33889
aVor perhaps with an anonymous type too:
p33890
as(dp33891
g18
V23354
p33892
stp33893
a((dp33894
g2
(lp33895
VOn a control/form,  pushes work to the UI thread, via the message pump (with a small overhead incurred for the privilege)
p33896
aVSo you've gone from the UI thread to the UI thread
p33897
aVI suspect you want a  /  or similar in here somewhere
p33898
aV(perhaps  would be easiest from the current position)
p33899
aVAlso; you probably don't want to do the update work synchronously, and you don't want lots of switches between the threads; I'd pass the entire array over (or mid-size chunks); not individual records
p33900
as(dp33901
g18
V23354
p33902
stp33903
a((dp33904
g2
(lp33905
V is a very loose type, and doesn't implement  etc
p33906
aVYou could try just switching the  lines to  (let the compiler pick the type)
p33907
aVIf it still uses , then perhaps use  to specify the type (or , etc)
p33908
aVFrom  (without more information) all it knows is
p33909
aVBasically,  is defined (as an extension method) on  and  - not  (without the )
p33910
as(dp33911
g18
V23354
p33912
stp33913
a((dp33914
g2
(lp33915
VIf you mean that the service starts a different app, then; options:
p33916
aVconfigure the service with a config file; put the path in there
p33917
aVput something in the registry during installation
p33918
aVuse something akin to COM/COM+ registrations
p33919
aVconsider the GAC if the other app is
p33920
aVNET (although I'm not a fan
p33921
aVenvironment variable
p33922
aVPersonally, I like the config file option; it is simple and easy to maintain, and allows multiple separate (side-by-side) service and app installs
p33923
as(dp33924
g18
V23354
p33925
stp33926
a((dp33927
g2
(lp33928
VThere is no  /  etc; this is much discussed, but it is what it is
p33929
aVThere is a way to do it using lambda expressions in
p33930
aVNET 3
p33931
aV5 (and parsing the expression tree), but in reality it isn't worth the overhead
p33932
aVFor now, I'd just stick with strings (and unit tests if you are determined not to break it)
p33933
as(dp33934
g18
V23354
p33935
stp33936
a((dp33937
g2
(lp33938
VHow about:
p33939
aVand:
p33940
aVThis then has no need for the extra  /  step
p33941
as(dp33942
g18
V23354
p33943
stp33944
a((dp33945
g2
(lp33946
VIf  throws an exception, it is probably going to take down your whole process
p33947
aVAny thread that raises a top-level exception indicates a big problem
p33948
aVYou should wrap this, for example by putting / around  and doing something suitable
p33949
aVAnd yes, if an exception gets to the top of a thread, the thread is dead:
p33950
aV(or your choice of error handling)
p33951
as(dp33952
g18
V23354
p33953
stp33954
a((dp33955
g2
(lp33956
VI would guess that ADO
p33957
aVNET Data Services wants objects - not just integers
p33958
aVTry, for example:
p33959
aVIt may also need data-contract (or other serialization) attributes; I can't remember
p33960
as(dp33961
g18
V23354
p33962
stp33963
a((dp33964
g2
(lp33965
VTry putting a breakpoint in the  method
p33966
aVIn particular, I expect that an exception is being thrown and lost:
p33967
aVdoes nothing
p33968
aVEither show the message to the user, or log it somewherre (perhaps )
p33969
aVAlso - don't set  to null - there is no purpose
p33970
as(dp33971
g18
V23354
p33972
stp33973
a((dp33974
g2
(lp33975
VIf you have a project reference, it should work immediately
p33976
aVIf it is a file (dll) reference, you need the debugging symbols (the "pdb" file) to be in the same folder as the dll
p33977
aVCheck that your projects are generating debug symbols (project properties => Build => Advanced => Output / Debug Info = full); and if you have copied the dll, put the pdb with it
p33978
aVYou can also load symbols directly in the IDE if you don't want to copy any files, but it is more work
p33979
aVThe easiest option is to use project references
p33980
as(dp33981
g18
V23354
p33982
stp33983
a((dp33984
g2
(lp33985
VThere are three different concepts there:
p33986
aVto check if it is a number (i
p33987
ag50
aVa (typically boxed) numeric value itself), check the type with  - for example
p33988
aVto check if a string could be parsed as a number; use
p33989
aVbut if the object isn't a number or a string, but you suspect  might give something that looks like a number, then call  and treat it as a string
p33990
aVIn both the first two cases, you'll probably have to handle separately each numeric type you want to support (//) - each have different ranges and accuracy, for example
p33991
aVYou could also look at regex for a quick rough check
p33992
as(dp33993
g18
V23354
p33994
stp33995
a((dp33996
g2
(lp33997
VResharper will offer suggestions for when you might have accessed a member on an object that could be null
p33998
aVIn 4
p33999
aV0, "code-contracts" support this at compile time - for example, it will stop you passing a possible-null into a method that states it doesn't want one
p34000
as(dp34001
g18
V23354
p34002
stp34003
a((dp34004
g2
(lp34005
VTo send the raw file only:
p34006
aVIf you want to emulate a browser form with an , then that is harder
p34007
aVSee this answer for a multipart/form-data answer
p34008
as(dp34009
g18
V23354
p34010
stp34011
a((dp34012
g2
(lp34013
VIf the client is javascript, I think you'll struggle
p34014
aVThere is (as you've stated) limited javascript coverage, but I'm not sure it will gain you a lot
p34015
aVTo quote from Kenton Varda (who really knows protobuf):
p34016
aVOne problem with javascript and
p34017
aVprotobuf is that you need a lot of
p34018
aVsupport  code to parse the messages
p34019
aVUnless you end up sending quite a lot
p34020
aVof stuff  back and forth, making the
p34021
aVuser download a JS protobuf codec
p34022
aVlibrary may be  a net loss
p34023
aVIt may be
p34024
aVbetter to use JSON or XML because
p34025
aVbrowsers already  have built-in
p34026
aVsupport for those
p34027
aVThat said, I think
p34028
aVvarious people inside google have been
p34029
aVplaying with  javascript + protocol
p34030
aVbuffers for awhile and if we end up
p34031
aVwith anything that  works well enough,
p34032
aVwe'll release it
p34033
aVSo maybe there is hope down the road
p34034
aVFor now I would stick with json + deflate, or if your scenario allows it you could perhaps use a Silverlight applet embedded in the client
p34035
aVprotobuf-net will work inside Silverlight
p34036
as(dp34037
g18
V23354
p34038
stp34039
a((dp34040
g2
(lp34041
VIt looks like you're mainly testing whether  works
p34042
aVafter all - it isn't  that defines your actual deployment
p34043
aVPersonally, this is something I despise about MSTest;
p34044
aVNET projects already have a way to define deployment data - the project
p34045
aVBy introducing a second method, it introduces both duplication and risk
p34046
aVOne of the reasons I use NUnit instead of MSTest, even though I have a VSTS license
p34047
aVRe the question; you could use reflection to look at the  markers, but I'm really not sure what this is testing, other than the test framework itself
p34048
as(dp34049
g18
V23354
p34050
stp34051
a((dp34052
g2
(lp34053
VWhat is the object, and how big is it
p34054
aVI've seen other people with a similar problems, and in some cases switching to a different serializer fixed it
p34055
aVI can suggest several that may be a good fit, depending on the scenario; in particular - is the data a tree or a graph
p34056
aV(i
p34057
ag50
aVdo child objects ever refer to siblings or their parents
p34058
aVOr just their own children)
p34059
as(dp34060
g18
V23354
p34061
stp34062
a((dp34063
g2
(lp34064
VHow about:
p34065
aVThis:
p34066
aVdoesn't bother parsing the xml (just string manipulation)
p34067
aVonly includes the unique values (no need to return a  with the duplicates we don't want)
p34068
aVHowever, it may build a larger string, so maybe just :
p34069
as(dp34070
g18
V23354
p34071
stp34072
a((dp34073
g2
(lp34074
VIn C# 3
p34075
aV0/
p34076
aVNET 3
p34077
aV5,  is not covariant
p34078
aVHowever, this would probably work OK in C# 4
p34079
aV0/
p34080
aVNET 4
p34081
ag190
aVFor now, you could (in
p34082
aVNET 3
p34083
aV5) use:
p34084
aV(note that you'll need "" at the top of the file)
p34085
aVBefore that
p34086
aVprobably easiest just to loop:
p34087
as(dp34088
g18
V23354
p34089
stp34090
a((dp34091
g2
(lp34092
VYou could do it with  easily enough - it would look something like:
p34093
aVHere's an example; I've been a bit lazy using  to read the arg-values - for real code I'd try to read it more directly:
p34094
as(dp34095
g18
V23354
p34096
stp34097
a((dp34098
g2
(lp34099
VYou need to look at the  of your columns; perhaps something like:
p34100
as(dp34101
g18
V23354
p34102
stp34103
a((dp34104
g2
(lp34105
VYour class isn't sealed; if the intention is that somebody could subclass it and need to serialize it, then perhaps add
p34106
aVHowever; I wouldn't add  "just because"; serialization (like threading or inheritance) is something that should be planned, designed and tested
p34107
aVIf you don't currently serialize the type or foresee a need to serialize it, then the chances are that you haven't designed/tested it adequately for those scenarios (which is 100% correct; you don't waste time writing unnecessary code)
p34108
aVIf somebody else uses your class and wants to be serializable, they can do that by marking their local field as  and handling it manually (perhaps in the callbacks)
p34109
aVNote also that in many ways  (which is the main consumer of ) itself has design issues and is fairly brittle
p34110
aVThere are contract-based serializers that offer far more stability
p34111
as(dp34112
g18
V23354
p34113
stp34114
a((dp34115
g2
(lp34116
VIf you use  you can do a recursive seach (using ), but this is a bit flaky anyway (especially if you don't have access to one of the sub-directories) - and might involve a huge single array coming back (warning klaxon
p34117
aVI'd be happy with the recursion approach unless I could show (via profiling) a bottleneck; and then I'd probably switch to (single-level) , using a  to emulate recursion
p34118
aVNote that
p34119
aVNET 4
p34120
aV0 introduces some enumerator-based file/directory listing methods which save on the big arrays
p34121
as(dp34122
g18
V23354
p34123
stp34124
a((dp34125
g2
(lp34126
V(re the syntax proposed - no, not that I know of)
p34127
aVEven if they aren't enums - are they bitwise flags
p34128
aVYou could have an  property and use , and have the property setter take the bits apart into the component flags
p34129
aVBut it would be a lot easier with a  enum
p34130
aVI'd be interested in what those reasons are
p34131
aVif you were using an object/string, then fine - but with an
p34132
aVI wonder if there is a trick that might let you use it the "easy" way
p34133
as(dp34134
g18
V23354
p34135
stp34136
a((dp34137
g2
(lp34138
VAt a guess, the html contains javascript or another source of braces ( and ) which would all need doubling (to  and ) to be usable with
p34139
aVI expect a different (more obvious) token may be in order, i
p34140
ag50
aVThen use either regex or
p34141
aVIf you have a single tag,  is fine; if you have lots, there are tricks with regex and  that may be helpful - like so but with a different regex pattern
p34142
aVUpdate after the example html added: I would definitely use a different token; at the most basic level:
p34143
aVand
p34144
as(dp34145
g18
V23354
p34146
stp34147
a((dp34148
g2
(lp34149
VIt sounds to me like you have the same class in different assemblies (or web applications)
p34150
aVBinaryFormatter includes the type metadata in the serialization, which means that only the exact same assembly will do
p34151
aV2 solutions:
p34152
aVput this type in a dll, and reference that single dll in both places
p34153
aVuse a contract-based serializer
p34154
aVPersonally I would choose the second for a huge number of reasons not just limited to this one
p34155
aVLikely choices:
p34156
aVXmlSerializer (xml; serializes public fields and properties; "tree" only)
p34157
aVDataContractSerializer (xml; serializes marked fields and properties (public or private); "tree" or "graph")
p34158
aVprotobut-net (binary; serializes marked fields and properties (public or private); "tree" only)
p34159
aVWhich is best depends on the scenario
p34160
as(dp34161
g18
V23354
p34162
stp34163
a((dp34164
g2
(lp34165
VAvoid  for anything that you store long-term (for example in a database); because it contains type/assembly metadata you can easily find that you can't deserialize the data later
p34166
aVPlus it is
p34167
aVNET-specific
p34168
aVSo you're a bit scuppered if you want to read it from any other platform
p34169
aVJSON (via Json
p34170
aVNET) would make a simple, pretty readable format that doesn't take much space
p34171
aVXml via  or  would be fine but isn't as readable
p34172
aVIf space is your biggest concern, perhaps something like "protocol buffers" (protobuf-net and others) - virtually impossible to read without the supporting utility dll, but very fast and efficient
p34173
aVI'd be tempted to use JSON, personally
p34174
aVIt means I can read the audit in SSMS
p34175
as(dp34176
g18
V23354
p34177
stp34178
a((dp34179
g2
(lp34180
VDetecting an anonymous type is a little hard; not-least it depends on the language
p34181
aVVB anon-types don't look the same as C# anon-types
p34182
aVI'd be dubious about logic that acts vary differently on anon-types
p34183
aVYou might check for , but note that it doesn't just mean "anonymous type" - there are others that do this
p34184
aVPersonally, I wouldn't distinguish in this scenario
p34185
as(dp34186
g18
V23354
p34187
stp34188
a((dp34189
g2
(lp34190
VI've used tools that try to do formulae via designers; they are usually terrible
p34191
aVPerhaps a better idea is to use a user-friendly syntax for the formula
p34192
aVI've seen this done with Python in the past (IronPython would be a good embedded language in
p34193
aVNET)
p34194
aVOr just parse a string in an expected syntax yourself
p34195
aV(not hugely complicated)
p34196
as(dp34197
g18
V23354
p34198
stp34199
a((dp34200
g2
(lp34201
VIt is "out", not "ref"
p34202
aVInside the method it has to assign it (without reading it first) to satisfy the meaning of "out"
p34203
aVActually, "out" is a language concern (not a framework one) - so a managed C++ implementation could probably ignore this
p34204
aVbut it is more consistent to follow it
p34205
aVIn reality; if the method returns false you simply shouldn't look at the value; treat it as garbage until it is next assigned
p34206
aVIt is stated to return 0, but that is rarely useful
p34207
aVAlso - if it didn't do this (i
p34208
ag50
aVif it preserved the value); what would this print:
p34209
aVThat is perfectly valid C#
p34210
aVso what does it print
p34211
as(dp34212
g18
V23354
p34213
stp34214
a((dp34215
g2
(lp34216
VI would personally try to avoid the need for the assembly-resolve; that has a certain smell about it
p34217
aVIf you must use , then I'd simply put the DTOs into a separate library (dll) that can be used in both applications
p34218
aVIf you don't want to share the dll, then IMO you shouldn't be using  - you should be using a contract-based serializer, such as  or , or one of the "protocol buffers" implementations (and to repeat Jon's disclaimer: I wrote one of the others)
p34219
aV200MB does seem pretty big, but I wouldn't have expected it to fail
p34220
aVOne possible cause here is the object tracking it does for the references; but even then, this surprises me
p34221
aVI'd love to see a simplified object model to see if it is a "fit" for any of the above
p34222
aVHere's an example that attempts to mirror your setup from the description using protobuf-net
p34223
aVOddly enough there seems to be a glitch working with the linked-list, which I'll investigate; but the rest seems to work:
p34224
as(dp34225
g18
V23354
p34226
stp34227
a((dp34228
g2
(lp34229
VTo limit it to just a specific flavor of generic interface you need to get the generic type definition and compare to the "open" interface ( - note no "T" specified):
p34230
aVOr as LINQ query-syntax:
p34231
as(dp34232
g18
V23354
p34233
stp34234
a((dp34235
g2
(lp34236
VIt isn't a match because the escaped characters (# and
p34237
aVare not word characters, so there isn't a word-boundary (\u005cb) between this and the whitespace/etc
p34238
aVPerhaps look for whitespace/bol/eol/etc specifically
p34239
as(dp34240
g18
V23354
p34241
stp34242
a((dp34243
g2
(lp34244
VYou have some huge thread safety issues there
p34245
aVIf you really want this static, there is a cheeky fix:
p34246
aVThis now acts as static, but is per-thread
p34247
aVCrisis averted; but this is a bit
p34248
aVwell, I would try to avoid the need, myself - but it will work fine
p34249
aVimportant: the initializers are per thread, not per request; since it is likely that your threads will get re-used, you should be sure to initialize the state before trying to use it, or you could have old garbage
p34250
as(dp34251
g18
V23354
p34252
stp34253
a((dp34254
g2
(lp34255
VYou can't, basically
p34256
aVYou could perhaps use AOP (such as PostSharp) to do some of it for you via attributes, or code-contracts in 4
p34257
aV0 (allowing compile-time checks); but there is no "non-nullable reference-type" (to compare to the "nullable value-type" etc)
p34258
aVNot least: what would fields initialize to
p34259
aVand what would default(
p34260
aVbe
p34261
aVThere have been requests to include something in the langauge to help (essentially doing the null check for you), but it hasn't happened
p34262
aVSomething like:
p34263
as(dp34264
g18
V23354
p34265
stp34266
a((dp34267
g2
(lp34268
VWe do rolling deployment to the live servers, so we don't use installer projects; we have something more like CI:
p34269
aVlive" build-server builds from the approved source (not the "HEAD" of the repo)
p34270
aV(after it has taken a backup ;-p)
p34271
aVrobocopy publishes to a staging server ("live", but not in the F5 cluster)
p34272
aVfinal validation done on the staging server, often with "hosts" hacks to emulate the entire thing as closely as possible
p34273
aVrobocopy /L is used automatically to distribute a list of the changes in the next "push", to alert of any goofs
p34274
aVas part of a scheduled process, the cluster is cycled, deploying to the nodes in the cluster via robocopy (while they are out of the cluster)
p34275
aVrobocopy automatically ensures that only changes are deployed
p34276
aVRe the App Pool etc; I would love this to be automated (see this question), but at the moment it is manual
p34277
aVI really want to change that, though
p34278
aV(it probably helps that we have our own data-centre and server-farm "on-site", so we don't have to cross many hurdles)
p34279
as(dp34280
g18
V23354
p34281
stp34282
a((dp34283
g2
(lp34284
s(dp34285
g18
V23354
p34286
stp34287
a((dp34288
g2
(lp34289
VThere are problems there
p34290
aVA binary search can't be executed on an , as it ideally needs indexer access into a list/array
p34291
aVSo it would have to call something like / first
p34292
aVworks on the  items, but  works on some facet of each  - it isn't quite the same, unless you happen to know that it is ordered by ; which is rarely the case (and hard to prove)
p34293
as(dp34294
g18
V23354
p34295
stp34296
a((dp34297
g2
(lp34298
VThe problem there is that VB does not support iterator blocks
p34299
aVCan you not just use the existing  method from VB
p34300
aVThe other lazy way of doing it in VB would be to consume and filter the entire sequence first - and just return the resulting array/list, but that wouldn't have the deferred execution that C# iterator blocks offer
p34301
aVWhich is a pain; I often use iterator blocks with long (i
p34302
ag50
aVessentially infinite) sequences
p34303
as(dp34304
g18
V23354
p34305
stp34306
a((dp34307
g2
(lp34308
Vit is a good idea to cache the XmlSerializer class instances since they create a dynamic assembly in memory under the hood
p34309
aVWith , it actually depends on whether you use the simple constructor (), or the more complex constructors that allow you to specify all the attributes etc at runtime
p34310
aVIf you only use the simple constructor it re-uses the background assembly, so there is no repeat penalty
p34311
aVI would expect (but haven't tested)  to work similarly; but there is certainly no harm in simply caching it, perhaps in a static readonly field
p34312
aVNote that  restricts the xml layout you have available to you
p34313
aVas long as you're OK with that ;-p
p34314
as(dp34315
g18
V23354
p34316
stp34317
a((dp34318
g2
(lp34319
VGenerally, I let the top-level project define this, via either web
p34320
aVconfig or app
p34321
aVconfig; either by specifying that the application should include a connection-string named "FOO", or (much better) allowing the calling application to pass (one of) the connection key, the connection string, or the connection to the dll
p34322
aVThen you mainly just edit web
p34323
aVconfig like normal
p34324
as(dp34325
g18
V23354
p34326
stp34327
a((dp34328
g2
(lp34329
VYou can use F# on mono; perhaps worth a look
p34330
aVI know that mono isn't 100% perfect (nothing ever is), but it is very far from "terrible"; most of the gaps are in things like WCF/WPF, which I doubt you'd want to use from FP
p34331
aVThis would seem to offer much of what you want (except obviously it runs in a VM - but you gain a huge set of available libraries in the bargain (i
p34332
ag50
aVmost of
p34333
aVNET) - much more easily than OCaml which it is based on)
p34334
as(dp34335
g18
V23354
p34336
stp34337
a((dp34338
g2
(lp34339
VDon't change generated code
p34340
aVIf you do, then any time you look at the dbml file your changes are likely to be lost
p34341
aVYou might (I haven't tried) be able to fix this by editing the dbml by hand (it is just xml); but IMO, the simplest way of handling this is inside your repository, to do a projection from the dbml-generated type to your type:
p34342
as(dp34343
g18
V23354
p34344
stp34345
a((dp34346
g2
(lp34347
VI don't know if there is something similar for php etc, but an interesting resource here is "Brownfield Application Development in
p34348
aVNET"
p34349
aVIn many ways, this only uses
p34350
aVNET for the examples; most of the book is really about tackling policies exactly like you mention:
p34351
aVhow to introduce source control
p34352
aVhow to introduce unit testing
p34353
aVhow to introduce continuous integration
p34354
aVetc
p34355
aVand all the concerns/consideration that go with them
p34356
aVPartly relating to the code; but also relating to the "human" factor; colleagues, managers, etc
p34357
aVI highly recommend it; but you might decide the
p34358
aVNET background is inappropriate for you (it is a good fit for me ;-p)
p34359
as(dp34360
g18
V23354
p34361
stp34362
a((dp34363
g2
(lp34364
VIf you just want data points
p34365
aVExtrapolation of data outside of known points can be estimated, but you need to accept the potential differences are much larger than with interpolation of data between known points
p34366
aVStrictly, both can be arbitrarily inaccurate, as the function could do anything crazy between the known points, even if it is a well-behaved continuous function
p34367
aVAnd if it isn't well-behaved, all bets are already off ;-p
p34368
aVThere are a number of mathematical approaches to this (that have direct application to computer science) - anything from simple linear algebra to things like cubic splines; and everything in between
p34369
aVIf you want the function
p34370
aVGetting esoteric; another interesting model here is genetic programming; by evolving an expression over the known data points it is possible to find a suitably-close approximation
p34371
aVSometimes it works; sometimes it doesn't
p34372
aVNot the language you were looking for, but Jason Bock shows some C# code that does this in
p34373
aVNET 3
p34374
aV5, here: Evolving LINQ Expressions
p34375
aVI happen to have his code "to hand" (I've used it in some presentations); with something like  it will find it almost instantly, but it should (in theory) be able to find virtually any method - but without any defined maximum run length ;-p It is also possible to get into a dead end (evolutionary speaking) where you simply never recover
p34376
as(dp34377
g18
V23354
p34378
stp34379
a((dp34380
g2
(lp34381
Vsvcutil and VS2008 ultimately call into the same bit of WCF code
p34382
aVWhether it uses the actual exe or calls into a dll is a minor detail
p34383
aVIf anything, I prefer the command line tool, as it allows more flexibility (or maybe I just like command line ;-p)
p34384
aVNote that WCF can re-use existing types, both via the IDE and from the command-line (/r
p34385
aVBut this type of namespace issue is just one of many things I prefer about using the command-line version
p34386
as(dp34387
g18
V23354
p34388
stp34389
a((dp34390
g2
(lp34391
VI'm doing that at the moment for a performance-critical application
p34392
aVThe way I do it is by serializing the data in a flat file (as part of my release process), then (at launch) deserializing it into a class model, allowing LINQ-to-Objects querying
p34393
aVIn most scenarios xml would be reasonable, but by preference I'm using my own binary serializer - mainly for speed
p34394
aVSince the constant data doesn't change, it is usually fine to cache it away in an instance you keep handy and re-use many times (rather than deserialize it per use)
p34395
aVTo clarify: the data to use is stored in a standard database (they are good at that type of thing, and lots of tools exist for import / edit / query / etc)
p34396
aVAs part of my release process, I load the data into the object model (using the same classes) from the database, and serialize it:
p34397
aVthen I ship data
p34398
aVbin with the app (well, actually it is stored separately, but that is an aside
p34399
aV; and at runtime:
p34400
aVNote that in this case, the data is "popsicle immutable" - i
p34401
ag50
aVto preserve the "constant" nature (but while letting it edit the data during load), I have a cascading  method that sets a flag on the items; once this flag is set, all edits (to items or to lists) throw an exception
p34402
aVThis has zero performance impact or the running code: since you expect to treat it as constant data, it only does reads
p34403
as(dp34404
g18
V23354
p34405
stp34406
a((dp34407
g2
(lp34408
VThe good news is that you can write such methods fairly easily; and thanks to C# 3
p34409
aV0 extension methods, you can make this work on the interface:
p34410
aVNow all that remains is the TODO code itself (and probaby re-write  ;-p); but after that:
p34411
aVImportantly,  has a read/write indexer, so it is certainly possible to do both the sort and binary-search without the hack above
p34412
as(dp34413
g18
V23354
p34414
stp34415
a((dp34416
g2
(lp34417
VI know there is an example in the ILOG Gantt SDK that will load MS project files; I can't remember if it saves too, but it might help as a starter
p34418
as(dp34419
g18
V23354
p34420
stp34421
a((dp34422
g2
(lp34423
VMoving columns involves a lot of DDL, and doesn't actually do anything
p34424
aVIf the table is currently empty, fine
p34425
aVbut if it has lots of data, this can be very painful
p34426
aVAnd if the table is currently replicated: even worse
p34427
aVIMO, you should just handle this in the  statement:
p34428
as(dp34429
g18
V23354
p34430
stp34431
a((dp34432
g2
(lp34433
VThat is indeed a fun problem
p34434
aVYou can't serialize the COM objects, so you are forced to either keep them per-session on the service, or you have to suffer the cost of creating them
p34435
aVNormally, I would advocate a pure stateless server (as it allows the best scalability), but if the COM object is particularly expensive this may not be realistic
p34436
aVTo manage this with multiple servers, sticky load-balancing becomes the only option
p34437
aVThis isn't ideal (it gets messy when you take servers down), but does at least allow you to scale out
p34438
aVBut you might need a decent NLB to achieve this (perhaps an expensive F5)
p34439
aVI wonder if in this specific case perhaps the best option is to scale up
p34440
aVFill the server with cores and RAM (on x64), and go for broke
p34441
aVof course, if the COM control only works on x86 this may not help
p34442
as(dp34443
g18
V23354
p34444
stp34445
a((dp34446
g2
(lp34447
VAs best practice, you might want to use 'ABC' rather than "ABC", which sometimes has a different meaning
p34448
aVThat will simply return a grid without any rows
p34449
aVhow that is interpreted depends on how you are doing your data access
p34450
aVIt could manifest as a  without any rows, or as an empty  sequence, or as a  that returns  from
p34451
aVThe first query returns all the columns, the second query just the cited column; but either way, if there is no matching data, there will be no rows
p34452
as(dp34453
g18
V23354
p34454
stp34455
a((dp34456
g2
(lp34457
VNote that even with a transaction, you;;ll need to get the isolation level right
p34458
aVThe most paranoid (and hence the most accurate) is "serializable", which takes out locks (even range locks) when you read data, so that other spids can't play with it
p34459
as(dp34460
g18
V23354
p34461
stp34462
a((dp34463
g2
(lp34464
VIf you are adding the columns yourself
p34465
aVdon't add the columns you don't want
p34466
aVIf you have  enabled, then:
p34467
aVif it is a class-based model, add  to properties you don't want
p34468
aVor set the column's  to false
p34469
aVor simply remove the columns you don't want afterwards
p34470
as(dp34471
g18
V23354
p34472
stp34473
a((dp34474
g2
(lp34475
VI suspect you'll have to repeat yourself
p34476
aVIf the expression (to get the object) is expensive, then perhaps drop it into a variable first, and either use that variable in the , or drop the  completely:
p34477
as(dp34478
g18
V23354
p34479
stp34480
a((dp34481
g2
(lp34482
VIt depends how much code you want to write
p34483
aVOne simple approach would be to write your own object and use :
p34484
aVand just map a regular exception into this
p34485
aVBut since it is simple anyway, maybe  is good enough
p34486
as(dp34487
g18
V23354
p34488
stp34489
a((dp34490
g2
(lp34491
VRe your "when the list is small" concern; if you don't mind using non-generic collections,  does something like this; it encapsulates a  when small, or a  when it gets bigger ()
p34492
aVWorth a look
p34493
aVOtherwise; you could perhaps use  with a custom comparer
p34494
aVThen you can choose how expensive  is
p34495
as(dp34496
g18
V23354
p34497
stp34498
a((dp34499
g2
(lp34500
VJust to weigh in
p34501
aVThe obvious difference between the two is "binary vs xml", but it does go a lot deeper than that:
p34502
aVfields (=bf) vs public members (typically properties) (=xs)
p34503
aVtype-metadata based (bf) vs contract-based (xs)
p34504
aVversion-brittle (bf) vs version-tolerant (xs)
p34505
aVgraph" (bf) vs "tree" (xs)
p34506
aVNET specific (bf) vs portable (xs)
p34507
aVopaque (bf) vs human-readable (xs)
p34508
aVAs a discussion of why  can be brittle, see here
p34509
aVIt is impossible to discuss which is bigger; all the type metadata in  can make it bigger
p34510
aVAnd  can work very with compression like gzip
p34511
aVHowever, it is possible to take the strengths of each; for example, Google have open-sourced their own data serialization format, "protocol buffers"
p34512
aVThis is:
p34513
aVcontract-based
p34514
aVportable (see list of implementations)
p34515
aVversion-tolerant
p34516
aVtree-based
p34517
aVopaque (although there are tools to show data when combined with a
p34518
aVproto)
p34519
aVtypically "contract first", but some implementations allow implicit contracts based on reflection
p34520
aVBut importantly, it is very dense data (no type metadata, pure binary representation, short tags, tricks like variant-length base-7 encoding), and very efficient to process (no complex xml structure, no strings to match to members, etc)
p34521
aVI might be a little biased; I maintain one of the implementations (including several suitable for C#/
p34522
aVNET), but you'll note I haven't
p34523
aVlinked to any specific implementation; the format stands under its own merits ;-p
p34524
as(dp34525
g18
V23354
p34526
stp34527
a((dp34528
g2
(lp34529
VThis might not be a directly useful answer, so feel free to ignore it
p34530
aVhowever; I'm currently working no a similar system myself; and frankly other than for trivial examples I'm not sure it is useful to try to calculate the number of valid combinations
p34531
aVAs an example, the models I'm working on at the moment have (for example) 18000 candidate items spread over 80+ selections, some single-select / some multi-select
p34532
aVBeyond the smallest models, there is no benefit in knowing the number, as you would simply never write it as a full truth table; you are pretty-much forced to run the rules (i
p34533
ag50
aVremove anything that is no longer valid, auto-select anything as appropriate, and check that no rules are broken) on-demand
p34534
aVWhich isn't necessarily a problem; my current code processes this model (as a web-service) in ~450ms, and most of that is actually the time spent processing xml for input/output
p34535
aVIf the input/output wasn't xml, I think it would be ~150ms, which is cool
p34536
aVI'd love to convince my employer to open-source the engine; that is a battle for another day, though
p34537
as(dp34538
g18
V23354
p34539
stp34540
a((dp34541
g2
(lp34542
VNote that if you want to serialize non-public data as xml,  might be useful
p34543
aVIt isn't as flexible as  (and you can't specify attributes), but it can serialize non-public data:
p34544
aVNote also that it doesn't use your constructor
p34545
aVor indeed any constructor - it cheats, allowing it to create an object and fill the data in afterwards
p34546
as(dp34547
g18
V23354
p34548
stp34549
a((dp34550
g2
(lp34551
VKilling a thread is always a bad idea, and should be reserved for scenarios where you are already dealing with a sickly process you are about to kill anyway
p34552
aVDo you own the code in the thread
p34553
aVPerhaps put in some state checks and exit cleanly if the flag is set
p34554
aVIf not, and you need the code to work after the abort, a separate process may be safer than a thread-start
p34555
aVAt least you won't cripple your own code (with, for example, an unreleased lock, or a hung static constructor / type initializer)
p34556
as(dp34557
g18
V23354
p34558
stp34559
a((dp34560
g2
(lp34561
VIf the dictionary is global (static/shared), you should be synchronizing access to it (this is important; otherwise you can corrupt it)
p34562
aVEven if your thread is only reading data, it needs to respect the locks of other threads that might be editing it
p34563
aVHowever; if you are sure that the item is there, the indexer should be fine:
p34564
aVOtherwise, a useful pattern is to check and add in the same lock:
p34565
aVHere we only add the item if it wasn't there
p34566
aVbut inside the same lock
p34567
as(dp34568
g18
V23354
p34569
stp34570
a((dp34571
g2
(lp34572
VHow about:
p34573
aV3: Store it in the database but marked as in an incomplete state
p34574
aVThis could be a separate table, or the same table with a status column
p34575
as(dp34576
g18
V23354
p34577
stp34578
a((dp34579
g2
(lp34580
VYour best bet is probably to re-query into a separate data-context
p34581
aVYou can negate an insert (from the change-set) by using  (and the reverse), but I'd rather not, myself
p34582
as(dp34583
g18
V23354
p34584
stp34585
a((dp34586
g2
(lp34587
VIf you are sending subclasses as xml, you will need :
p34588
aVYou can add multiple  markers for any other subclasses in the model
p34589
as(dp34590
g18
V23354
p34591
stp34592
a((dp34593
g2
(lp34594
VI'm guessing partly from the documentation
p34595
aVOr from reflector; find IPropertyValueUIService, press Ctrl+r and expand "Used By", and you can see how it is used by
p34596
as(dp34597
g18
V23354
p34598
stp34599
a((dp34600
g2
(lp34601
VIn C# 4
p34602
aV0,  would be ideal for this type of duck-typing
p34603
aVUntil then, I wonder if VB
p34604
aVNet would be better, with  to allow late binding against
p34605
aVWorst case: write it in VB
p34606
aVNet, then use reflector to write the C# for you ;-p
p34607
aVHere's an example, that requires a reference to Microsoft
p34608
aVVisualBasic
p34609
aVdll, but is fine in C#:
p34610
as(dp34611
g18
V23354
p34612
stp34613
a((dp34614
g2
(lp34615
VWell, having a static comparer means you can't have different comparisons on different queues; this can be a problem
p34616
aVoccasionally people do need a custom comparison; for example, if they don't control the type
p34617
aVMy default approach would be:
p34618
aVRe stateful comparers; yes, I've written several - particularly for writing LINQ-style projection comparers
p34619
aVfor example, something like:
p34620
aVwhich allows:
p34621
aVinstance "sort by name" comparison
p34622
as(dp34623
g18
V23354
p34624
stp34625
a((dp34626
g2
(lp34627
VIs it in the same project
p34628
aVOr a dll you are referencing
p34629
aVYou only get proper icons when referncing a fixed dll
p34630
aVTry building a control dll and referencing it
p34631
as(dp34632
g18
V23354
p34633
stp34634
a((dp34635
g2
(lp34636
VTwo thoughts; with ,  is more appropriate than
p34637
aVSecond; you can do the ordering separately in LINQ-to-Objects if necessary:
p34638
aVThis will then do the order-by in memory
p34639
as(dp34640
g18
V23354
p34641
stp34642
a((dp34643
g2
(lp34644
Vxslt can certainly do it
p34645
aVbut it really depends on what you need to do
p34646
aVSomething like (untested)
p34647
as(dp34648
g18
V23354
p34649
stp34650
a((dp34651
g2
(lp34652
VA  is managed, and more lightweight - but is restricted to your
p34653
aVA  can be named, and can span processes (allowing some simple IPC scenarios between applications), and can be used in code that wants a wait-handle)
p34654
aVFor most simple scenarios,  (via ) is fine
p34655
as(dp34656
g18
V23354
p34657
stp34658
a((dp34659
g2
(lp34660
VIt sounds like you are re-using the data-context beyond what is wise
p34661
aVTry disposing and re-creating the data-context after deleting the database
p34662
aVI suspect the problem is that the identity manager is still tracking objects (destroying and recreating the database is such an edge-case that I think we can forgive it for not resetting itself here)
p34663
as(dp34664
g18
V23354
p34665
stp34666
a((dp34667
g2
(lp34668
VWhat sort of types are we talking about
p34669
aVclasses
p34670
aVAnd what type of service is it
p34671
aVIf it is WCF, one option is to use type-sharing to use the same type at each end, but this abuses SOA a little bit
p34672
aVYou can't cast a class to a very different type, but you can project into a different class
p34673
aVVarious approaches for this are discussed here:
p34674
aVHow to copy value from class X to class Y with the same property name in c#
p34675
as(dp34676
g18
V23354
p34677
stp34678
a((dp34679
g2
(lp34680
VEnum fields are initialized as zero; an if you don't specify values in an enum, they start at zero (, , etc)
p34681
aVThus by default any field you do initialize yourself will be
p34682
aVIt is relatively common to add  for such cases, or alternatively use ; i
p34683
ag50
aVYou should also be sure to never treat your last expected value as a default; i
p34684
ag50
aVthis should be:
p34685
as(dp34686
g18
V23354
p34687
stp34688
a((dp34689
g2
(lp34690
V(note it only works lower-to-upper, hence starting lower-case)
p34691
as(dp34692
g18
V23354
p34693
stp34694
a((dp34695
g2
(lp34696
VGiven that you've resolved the / confusion, I expect the issue is namespaces; do you have example xml
p34697
aVHandling xml with namespaces gets
p34698
aV"fun" ;-p
p34699
aVFor example:
p34700
aVNote that even if your xml declares xml aliases, you may still need to re-declare them for your namespace-manager
p34701
as(dp34702
g18
V23354
p34703
stp34704
a((dp34705
g2
(lp34706
V(aside: is it possible to influence the design
p34707
aVThis sounds in part like what database schema names are designed for
p34708
aVIt is sometimes possible (for example in SQL Server by using  notation, or even ), but I don't recommend it as the same approach won't fit all use-cases, and it breaks a lot of best-practice guidelines
p34709
aVI would strongly recommend simply generating the connection string per database, perhaps using , or more specific variants like
p34710
aVYou could disable pooling on the dynamic connections if you are worried about having too many open (pooled) connections (but you would then need to handle connection management yourself; personally I'd be tempted to leave pooling enabled until I can prove there is a problem)
p34711
as(dp34712
g18
V23354
p34713
stp34714
a((dp34715
g2
(lp34716
VNote that this iterates over the dictionary (rather than using the index), but it works:
p34717
as(dp34718
g18
V23354
p34719
stp34720
a((dp34721
g2
(lp34722
VTypically, any updates to UI components should be done on the UI thread, via  (or the WPF equivalent)
p34723
aVIt is possible that your changes are causing exceptions that are being swallowed somewhere
p34724
aVDoes your code work frmo the UI thread
p34725
aVYou can still use a  - you just need to do the updates (ideally in batches) via
p34726
as(dp34727
g18
V23354
p34728
stp34729
a((dp34730
g2
(lp34731
VMaybe try $ (EOL/EOF) instead of (\u005cr\u005cn|\u005cn)
p34732
as(dp34733
g18
V23354
p34734
stp34735
a((dp34736
g2
(lp34737
VHave you tried try/catch
p34738
aVIn particular there are a number of gotchas relating to the working path / current directory with VS extensions (but I would expect notepad to work, at least)
p34739
aVI'm also not sure what you expect that code to do (in terms of redirecting stdout of notepad
p34740
aVexe); can you clarify
p34741
aVNot an issue at the moment, but note that when working with paths as arguments, you'll want to add quotes from the start - i
p34742
ag50
aV(in case the path has spaces in it)
p34743
as(dp34744
g18
V23354
p34745
stp34746
a((dp34747
g2
(lp34748
VNo, in short
p34749
aVAnd for this very reason, auto-properties are pain when used with field-based serializers like  (I'm sure I might have mentioned that here before ;-p)
p34750
aVSee: Obfuscation, serialization and automatically implemented properties for some thoughts on this (and a solution)
p34751
as(dp34752
g18
V23354
p34753
stp34754
a((dp34755
g2
(lp34756
VNo; there is no such thing as a constant array in CLI; arrays are always mutable
p34757
aVPerhaps a  would be suitable
p34758
aVIn C# (so presumably similar in VB) you can do something like:
p34759
aVWhich gives you a static (=shared) non-editable, re-usable collection
p34760
aVThis works especially well if the method accepts , , etc (rather than an array, )
p34761
as(dp34762
g18
V23354
p34763
stp34764
a((dp34765
g2
(lp34766
VTo work with , you need to implement the non-generic , not the generic  (or simpler and better: inherit from , which provides things like change notifications via )
p34767
aVFor working with LINQ-to-SQL I have some info on usenet that might be useful (assuming it still holds water - it has been a while)
p34768
aVre "rest of the problem"
p34769
aVcan you be more specific
p34770
aVRe filtering LINQ-to-SQL efficiently, you don't want to use ; you want to use ; this allows you to pass this down to the database via , i
p34771
ag50
aV(where you have an  source) something like:
p34772
aVWriting a true filtered list is very tricky
p34773
aVI've done it for in-memory objects (I can't post the code, though) - but it takes a lot of object tracking etc
p34774
aVUnless you absolutely need this, it may be easier to keep things simple and just display simple snapsnots, tracking just additions/removals
p34775
aVFor simple snapshots, just  may suffice
p34776
as(dp34777
g18
V23354
p34778
stp34779
a((dp34780
g2
(lp34781
VIf you are using , is there any chance you could switch to
p34782
aVIt will be far more flexible
p34783
aVI'm not entirely sure from the question, but:
p34784
aVIf the properties are fixed, but you don't want to display all the columns
p34785
aVThen simply set  before you add the data, and add the desired columns yourself; or alternatively, leave it enabled and simply set  on the columns you don't want to see
p34786
aVIf the properties are dynamic at runtime
p34787
aVThen it gets tricky; you're getting into the darker corners of ; you can do this with  via  (which allows different definitions per list instance) or  (which allows different definitions per type or per list instance) - but of those, only  will work with
p34788
aVTo be honest, I don't think this is what you mean; and if it is, it would be simpler to stick with  (both are very hard to implement correctly)
p34789
aVI hope that helps; and I hope it is as simple as hiding some columns
p34790
aVIf I've missed the point, let me know
p34791
as(dp34792
g18
V23354
p34793
stp34794
a((dp34795
g2
(lp34796
VWe'd have to see some kind of code
p34797
aVyou mention a transaction; what isolation level is it at
p34798
aVOne thing to try is adding the  hint to any query that you use to find the row (or check existence); so you'll take out a write lock (rather than a read lock) from the start
p34799
aVWhen contested, this should then cause (very brief) blocking rather than a deadlock
p34800
as(dp34801
g18
V23354
p34802
stp34803
a((dp34804
g2
(lp34805
VFor info, another approach fairly common in the BCL is  on the same interface, i
p34806
ag50
aV(examples of this, for example, in )
p34807
aVI'm not pretending that it is "pure" or anything, but it works - but it means you now have two methods to implement per feature, not one
p34808
aVSeparate interfaces (, for example) may be preferable
p34809
aVFor info, if the implementation is common between all implementations, then you can use extension methods; for a trivial example:
p34810
aV(or the equivalent for your interface)
p34811
aVIf you provide a more specialized version against the concrete type, then it will take precedence (but only if the caller knows about the variable as the concrete type, not the interface)
p34812
aVSo with the above, anyone knowingly using a  still uses 's version of ; but if the have a  but only know about it as , it'll use the extension method
p34813
as(dp34814
g18
V23354
p34815
stp34816
a((dp34817
g2
(lp34818
VCoverage
p34819
aVif you know lat/long, don't you already know the location
p34820
aVno, I don't think you can define custom maps; but you should be able to add custom data
p34821
as(dp34822
g18
V23354
p34823
stp34824
a((dp34825
g2
(lp34826
VAre you sure it takes 33% of the time
p34827
aVHow have you measured that
p34828
aVIt sounds more than a little suspicious to me
p34829
aVThis makes things a little bit quicker:
p34830
aVOr if we cut out the IO ():
p34831
as(dp34832
g18
V23354
p34833
stp34834
a((dp34835
g2
(lp34836
VThe  means it is a C# 3
p34837
aV0 "extension method" on , which is how it becomes available on the  instance in your view (etc)
p34838
aVAn extension method is a static method that pretends (at compile time) to be an instance method available on the type nominated by  (in this case )
p34839
aVIn reality, the compiler calls the static method () as though you had typed:
p34840
aVIt is not necessary to use the  that is passed in if you don't need it (inded, I don't use it here); it's main job (in this case) is to make the code convenient to consume (as an extension method); but it can be useful in some cases
p34841
as(dp34842
g18
V23354
p34843
stp34844
a((dp34845
g2
(lp34846
VComparisons are
p34847
aVfun
p34848
aVFirstly, you've got a choice of  or  - which would you choose
p34849
aVCurrently (via ) it supports both, but there is no "this or that" generic constraint
p34850
aVThen you get the issue of ; this has "lifted" comparisons, so whether it is comparable or not depends on the ; but again,  deals with this for us ( implements neither  nor )
p34851
aVPlus; it saves on generic constraint propagation; as soon as you have a constraint like this in library code, it quickly infects all the upstream calling code, making it a hard slog
p34852
as(dp34853
g18
V23354
p34854
stp34855
a((dp34856
g2
(lp34857
VIt sounds like you actually want to "zip" the data together (not join) - i
p34858
ag50
aVmatch pairwise; is that correct
p34859
aVIf so, simply:
p34860
aVusing the  operation from here:
p34861
as(dp34862
g18
V23354
p34863
stp34864
a((dp34865
g2
(lp34866
VAll your CRUD operations on the same transaction should be rolled back
p34867
aVPeriod
p34868
aVHave you double-checked that you are using the transaction
p34869
aVIt is impossible to diagnose just from your description; but believe me: somebody would have noticed before now
p34870
aVSuch things become a lot easier with , where enlisting is automatic
p34871
as(dp34872
g18
V23354
p34873
stp34874
a((dp34875
g2
(lp34876
VWhat platform
p34877
aVThe post makes me think
p34878
aVNET
p34879
aVWhat is the underlying objects
p34880
aVFor example,  as a source allows you to disable notifications by setting  to false while doing the update
p34881
aVOther than that (or similar); yes, disconnect the binding during big updates
p34882
as(dp34883
g18
V23354
p34884
stp34885
a((dp34886
g2
(lp34887
VIt all depend on how you are doing your data access
p34888
aVby hand
p34889
aVIf so; there are two common ways of passing a null  around; the original was to use  to mean ; the second is to use  (aka ) to pass the date around
p34890
aVThen in your DAL you detect this and switch to :
p34891
aVWith LINQ-to-SQL, the  approach should "just work"
p34892
as(dp34893
g18
V23354
p34894
stp34895
a((dp34896
g2
(lp34897
VI'm guessing mainly because the uri doesn't contain any  elements
p34898
aVTry:
p34899
as(dp34900
g18
V23354
p34901
stp34902
a((dp34903
g2
(lp34904
VPrecision and range (so, everything important ;-p)
p34905
aVFrom MSDN:
p34906
aVNET System
p34907
aVDateTime
p34908
aVThe DateTime value type represents dates and times with values ranging from 12:00:00 midnight, January 1, 0001 Anno Domini (Common Era) through 11:59:59 P
p34909
aVM
p34910
aV, December 31, 9999 A
p34911
aVD
p34912
aV(C
p34913
aVE
p34914
aVTime values are measured in 100-nanosecond units called ticks, and a particular date is the number of ticks since 12:00 midnight, January 1, 0001 A
p34915
ag34912
aV(C
p34916
ag34914
aVin the GregorianCalendar calenda
p34917
aVTransact SQL datetime
p34918
aVDate Range: January 1, 1753, through December 31, 9999
p34919
aVAccuracy: Rounded to increments of
p34920
aV000,
p34921
aV003, or
p34922
aV007 seconds
p34923
as(dp34924
g18
V23354
p34925
stp34926
a((dp34927
g2
(lp34928
VIt isn't entirely clear whether you're talking about the windows message pump, or
p34929
aVNET events
p34930
aVEither way, there are a few common approaches:
p34931
aVchange the publisher so that it only raises a single event when everything is done; for example, with data-binding to  you can set  to false while doing a big update, then true afterwards and call the reset method
p34932
aVtell the target to disable things like drawing for a duration; for example using a /  pair of methods
p34933
aVif neither is possible: handle the events, but don't do anything immediately; only do something once you believe nothing else is coming; for example by adding a short delay before you do your funky stuff
p34934
aVAn example of the last is here: Prevent events from firing multiple times from single action
p34935
as(dp34936
g18
V23354
p34937
stp34938
a((dp34939
g2
(lp34940
VWhat do you get
p34941
aVIIRC, Firefox sends the filename without path (IE sends full path); but that should still be enough to get a name
p34942
aVIf you use  you should have the same answer from either
p34943
as(dp34944
g18
V23354
p34945
stp34946
a((dp34947
g2
(lp34948
VSQL Server Express is sufficient for production for many small apps (especially for replacing Access etc)
p34949
aVThe real thing is: your developers should use the same (or similar) as you intend to use in production, to avoid any last minute "not supported" / "works differently" surprises
p34950
aVIf you intend deploying to express, then develop against express
p34951
aVIf you intend deploying to enterprise, then develop against, well, developer edition, which is the same thing really
p34952
aVSize is a factor, too though; even though I deploy against enterprise, I use express on my laptop (when working on the train etc) for space reasons
p34953
aVBut I always go back to my main desktop (with more disk/memory, and a VM configured like my production platform) to perform validation etc
p34954
as(dp34955
g18
V23354
p34956
stp34957
a((dp34958
g2
(lp34959
VIt may depend on the event; for example, if you are consuming an event from a dll written in C# via a "field-like event", i
p34960
ag50
aV(yes I know you asked about VB; I explain this below
p34961
aVthen this is (per the C# language spec) automatically synchronized, so there are no multi-threading issues (and it helps here that delegates are immutable)
p34962
aVHowever, even in the same library, a non-field-like event might not be synchronized - i
p34963
ag50
aVI know you asked about VB
p34964
aVbut you are asking about VB as the comsumer
p34965
aVMy point is that it depends on the publisher
p34966
aVSo if you can't control the publisher, then manually synchronizing sounds adviseable if you think that there is a threading risk for this scenario (in most cases, there is no need to synchronize; but if you know this is a threaded area, then synchronizing is sensible)
p34967
aVAlso note that a common pattern when raising an event is to take a snapshot:
p34968
aVMy point here is that it is in theory possible for a subscriber to receive an event even after they think they have unsubscribed, so if extreme cases you might want to handle this manually, perhaps by keeping a flag somewhere (or just exception handling)
p34969
aVAs requested, last code fragment in VB (via reflector) for comparison:
p34970
as(dp34971
g18
V23354
p34972
stp34973
a((dp34974
g2
(lp34975
VIt demands 2
p34976
aV0, but
p34977
aVNET 3
p34978
aV0 and 3
p34979
aV5 still share the CLI version, so if 2
p34980
aV0 works, 3
p34981
aV0 and 3
p34982
aV5 should be fine if the machine has them installed; there are lots of examples of, for example, WCF (3
p34983
aV0) with powershell
p34984
aVHarder to tell on 4
p34985
aV0 since it isn't RTM
p34986
as(dp34987
g18
V23354
p34988
stp34989
a((dp34990
g2
(lp34991
VYou could simply iterate over the controls
p34992
aVFor example (in your 's / 's ctor, after initiaize):
p34993
aVusing the utility method:
p34994
as(dp34995
g18
V23354
p34996
stp34997
a((dp34998
g2
(lp34999
VHmm
p35000
aVI'd probably write a custom  so that I can use:
p35001
aVand write the comparer via LINQ
p35002
aVPossibly a bit overkill, but reusable, at least:
p35003
aVUsage first:
p35004
aVWith utility methods:
p35005
as(dp35006
g18
V23354
p35007
stp35008
a((dp35009
g2
(lp35010
VThere are a number of commercial map APIs
p35011
aVMapPoint has a range of geo charting, routing, drawing, etc facilities; I've used this very successfully in the past
p35012
aVIt is COM-based, but works perfectly via interop (i
p35013
ag50
aVI used if from C#)
p35014
aVIn addition to the desktop version there is also a web service API (a separate product with different licensing and features) (ooh, news to me; "mappoint web service" seems to have been replaced by Bing Maps for Enterprise
p35015
aVThere are of course other vendors of such tools
p35016
aVFor a broader search, one of the main keywords here is "GIS"
p35017
as(dp35018
g18
V23354
p35019
stp35020
a((dp35021
g2
(lp35022
VIt depends on what you need; IsAssignableFrom, perhaps:
p35023
aVor :
p35024
as(dp35025
g18
V23354
p35026
stp35027
a((dp35028
g2
(lp35029
VI haven't used filehelpers, so I can't do a direct comparison; however, if you have an object-model that represents your objects, you could try protobuf-net; it is a binary serialization engine for
p35030
aVNET using Google's compact "protocol buffers" wire format
p35031
aVMuch more efficient than  things like xml, but without the need to write all your own serialization code
p35032
aVNote that "protocol buffers" does include some very terse markers between fields (typically one byte); this adds a little padding, but greatly improves version tolerance
p35033
aVFor "packed" data (i
p35034
ag50
aVblocks of ints, say, from an array) this can be omitted if desired
p35035
aVSo: if you just want a compact output, it might be good
p35036
aVIf you need a specific output, probably less so
p35037
aVDisclosure: I'm the author, so I'm biased; but it is free
p35038
as(dp35039
g18
V23354
p35040
stp35041
a((dp35042
g2
(lp35043
V is perfectly supportable, but has some glitches;
p35044
aVrelatively slow; but usually this is still fast enough
p35045
aVonly supports public members; can be a pain
p35046
aVrequires write accessors lists - just ugly
p35047
aVHowever, I expect it to continue to be there for a considerable time; IMO, it is  that has the real problems (when used for persistence)
p35048
aVI'm very biased (since I'm the author), but I'd choose protobuf-net; a binary serializer using Google's "protocol buffers" wire format; fast, portable between languages/platforms, very small output, version tolerant, etc (and free, of course)
p35049
aVClearly not xml, though - so not human readable
p35050
as(dp35051
g18
V23354
p35052
stp35053
a((dp35054
g2
(lp35055
VThat would depend hugely on the OS; pre-vista, GINA; post-vista, LogonUI can be extended by a custom credential provider (as discussed here)
p35056
aVHowever, it won't be easy - and probably risky too
p35057
as(dp35058
g18
V23354
p35059
stp35060
a((dp35061
g2
(lp35062
VA foreign key can only reference a single primary key, so no
p35063
aVHowever, you could use a bridge table:
p35064
aVSo Order doesn't even have a foreign key; whether this is desirable, though
p35065
as(dp35066
g18
V23354
p35067
stp35068
a((dp35069
g2
(lp35070
VIf your C# is running at the client, but it is the server that is breaking
p35071
aVthen unless you are accidentally triggering things like DOS detection (or simply overloading the server) I'm not sure what you can do
p35072
aVI'm also not quite sure how your "browser" comment ties in with  (since they are orthogonal)
p35073
aVThe first thing to try, I guess, is to read the feed once only and cache it; don't keep hitting the server
p35074
as(dp35075
g18
V23354
p35076
stp35077
a((dp35078
g2
(lp35079
VUntested, but:
p35080
aVFor info, though; I usually assume that a range is  and , so I'd use
p35081
aVMaking that more reusable (and noting that I'm using  here):
p35082
aV(need to specify the  on the constants in this case, since  will otherwise cause big problems)
p35083
as(dp35084
g18
V23354
p35085
stp35086
a((dp35087
g2
(lp35088
VIt looks to me like you're getting the math backwards
p35089
aVshouldn't it be:
p35090
aVOr if you want the actual rolls:
p35091
as(dp35092
g18
V23354
p35093
stp35094
a((dp35095
g2
(lp35096
VIn almost all cases, the correct way to solve this is simply to never treat the date as a string
p35097
aVIf you pass in a parameter, or use the (typed) column value, then the server's text conversion simply isn't a factor
p35098
aVIn addition to avoiding the i18n issue, this also reduces your injection attack surface
p35099
aVAnd it saves a few CPU cycles, too ;-p
p35100
aVIf you are using  for dynamic SQL, then this should likewise be parameterised via
p35101
as(dp35102
g18
V23354
p35103
stp35104
a((dp35105
g2
(lp35106
VIn the C# 4
p35107
aV0 demos, I'm seeing lots of code that uses the dynamic type
p35108
aVSince  is one of the biggest changes in C# 4
p35109
aV0, I'd be hugely surprised if this wasn't the case
p35110
aVThat doesn't mean you should immediately start writing all your code with  - simply that you should recognise when it might be useful
p35111
aVThe variance and optional/named argument changes are appreciated too, of course - but make a much shorter demo
p35112
aVHistorically, Office (in particular) has been such a pig to program against that this is a "big thing* for people who automate Office
p35113
aVpeople who consume COM (and Office especially)
p35114
aVpeople who consume DLR types (IronPython etc)
p35115
aVpeople who talk to dynamic systems such as javascript (Silverlight etc)
p35116
aVPersonally, I don't expect  to revolutionise the way I program in C#, but it is big for some people:
p35117
as(dp35118
g18
V23354
p35119
stp35120
a((dp35121
g2
(lp35122
VThe app name can be part of the connection string, but can be spoofed
p35123
aVIf you need to enforce this, then I would abstract data access to an app-server, and do data access from the client via this (presumably using web services)
p35124
aVThen you app-server can use a known account to talk to the server (as a "trusted subsystem"), and the individual clients don't actually need access to the database (win:win, especially when firewalls get involved)
p35125
aVPersonally, I tend to make this my default model anyway
p35126
aVit adds a lot of future scalability from the start, and is hard to add after-the-fact
p35127
as(dp35128
g18
V23354
p35129
stp35130
a((dp35131
g2
(lp35132
VThe REPL demo was part of "what might happen next", i
p35133
ag50
aVafter 4
p35134
aV0; in
p35135
aVNET 5
p35136
aV0 or something similar
p35137
aVThis is not 4
p35138
aV0 functionality, and never has been
p35139
as(dp35140
g18
V23354
p35141
stp35142
a((dp35143
g2
(lp35144
VIf the data volume is high, then it can happen that the overhead of building a huge list can be a bottleneck; in which case, it can be more efficient to use a streaming object model; i
p35145
ag50
aVThe consuming code (via  etc) then only has a single object to deal with (at a time)
p35146
aVIf they want to get a list, they can (with new , or in
p35147
aVNET 3
p35148
aV5: )
p35149
aVThis involves a few more method calls  (an additional / per sequence item, hidden behind the ), but you will never notice this when you have out-of-process data such as from a database
p35150
as(dp35151
g18
V23354
p35152
stp35153
a((dp35154
g2
(lp35155
VEdit: I misread the question; short version: ProtoClient
p35156
aV= WCF
p35157
aVThey are not compatible
p35158
aVCompact Framework suffers that the WCF stack lacks all of the necessary extension points for this; in short, you can't use this approach with WCF + CF
p35159
aVI am aware of various working approaches for protobuf-net with CF, though;
p35160
aVhave your service return a  or (better)  and handle it manually; no, it isn't pretty, but it works
p35161
aVyou could try the alternative RPC stack included with protobuf-net; I think this works on CF (I'd need to check, though; my memory fails)
p35162
aVThe alternative stack is ; I honestly can't recall whether it works on CF, and I'm not in a position to check at the moment
p35163
aVit should work on CF, as I remember having to re-implement  to get it to compile
p35164
aVsome example usage (for both 2
p35165
aV0-style and 3
p35166
aV5-style) are here
p35167
as(dp35168
g18
V23354
p35169
stp35170
a((dp35171
g2
(lp35172
VYou can't, basically
p35173
aVYou'll either have to specify the columns, or use a separate table:
p35174
aV(where  is a second table that looks like , but without the primary key/identity/etc - commonly multiple rows per logical source row; not I assumed you actually wanted to copy the old values, not the new ones)
p35175
as(dp35176
g18
V23354
p35177
stp35178
a((dp35179
g2
(lp35180
VThe only time I ever return  /  over WCF is where I have something where it is just impossible to know the schema in advance, or they simply isn't any benefit
p35181
aV99
p35182
aV99% of the time I'll work with regular DTO classes, since that gives a good blend of performance, simplicity (to debug) and interoperability
p35183
aVI've been working with WCF since the 3
p35184
aV0 CTP
p35185
aVI've used  via WCF only a couple of times
p35186
aVI felt slightly dirty about it, but for the cases in question there was simply no return-on-investment on doing it the hard way
p35187
aVJust note that it will be very hard for a non-
p35188
aVNET client to consume them
p35189
as(dp35190
g18
V23354
p35191
stp35192
a((dp35193
g2
(lp35194
VOne option might be to just use the ; this still raises a warning, but it'll build, at least:
p35195
as(dp35196
g18
V23354
p35197
stp35198
a((dp35199
g2
(lp35200
VI very much doubt you'd ever notice any tangible difference; not least, there is  and  IL operators
p35201
aVIf you have performance issues, use a profiler, and look at real problems; this won't be it
p35202
aVit is premature optimisation
p35203
as(dp35204
g18
V23354
p35205
stp35206
a((dp35207
g2
(lp35208
VI would like to be able to specify that my custom attribute can only be placed on subclasses of a particular class (or interface)
p35209
aVIs this possible
p35210
aVActually, there is a way to do this for subclasses (but not interfaces) using  - see Restricting Attribute Usage
p35211
aVTo reproduce the code (but not the discussion):
p35212
as(dp35213
g18
V23354
p35214
stp35215
a((dp35216
g2
(lp35217
VYou could use a modified "zip" operation easily enough, but nothing built in
p35218
aVSomething like:
p35219
as(dp35220
g18
V23354
p35221
stp35222
a((dp35223
g2
(lp35224
V(starting at  looks like a bad move, btw - should be
p35225
aVWhat happens when you try to save it ()
p35226
aVAlso; if this is a large image, you may want to look at ; a related post is here (although it uses a rectangular array, not a 1-dimensional array)
p35227
as(dp35228
g18
V23354
p35229
stp35230
a((dp35231
g2
(lp35232
VContrary to a few other answers, I would be perfectly happy to mix  with a counter (as per the code in the question)
p35233
aVThis retains your ability to use  rather than requiring an indexer
p35234
aVBut if you want, in LINQ:
p35235
aV(the counter approach in the question is a lot simpler and more effecient, but the above should map better to a few scenarios like Parallel
p35236
aVForEach)
p35237
as(dp35238
g18
V23354
p35239
stp35240
a((dp35241
g2
(lp35242
VSingleOrDefault returns the default value for the returned type
p35243
aVWhich is
p35244
aVnull for classes/interfaces/delegates
p35245
aV0/false for value types
p35246
aVexcept for , where it is null
p35247
aVFor classes, you get null - this is mainly a way to check "did it exist
p35248
aVJust create the actual default yourself
p35249
aVperhaps:
p35250
aVThis "null coalescing" approach only executes the right-hand-side () if the left-hand-side is null
p35251
aVOr more simply:
p35252
as(dp35253
g18
V23354
p35254
stp35255
a((dp35256
g2
(lp35257
VInstant Client supports xcopy deployment, so the same approach (including them in your ClickOnce deployment) should make it OK to deploy
p35258
aVHowever
p35259
aVIn many cases it may be more appropriate (with ClickOnce) to use a "smart client" approach, i
p35260
ag50
aVdo the data access via an app-server via web-services
p35261
aVThen you don't need any DAL components in the client
p35262
as(dp35263
g18
V23354
p35264
stp35265
a((dp35266
g2
(lp35267
VI'm really confused as to what purpse  serves
p35268
aVAnd no; you don't need a destructor/finalizer unless you are handling unmanaged objects
p35269
aVFor example, it would be a lot simpler to just subclass  (or perhaps ) to extend it:
p35270
aVNote that in C# 3
p35271
aV0 you can also do this via extension methods, and it will be available on any common collection/sequence of s
p35272
as(dp35273
g18
V23354
p35274
stp35275
a((dp35276
g2
(lp35277
VPerhaps not ideal, but maybe:
p35278
aVOr in query syntax:
p35279
as(dp35280
g18
V23354
p35281
stp35282
a((dp35283
g2
(lp35284
VTypes in
p35285
aVNET are scoped by their assembly
p35286
aVUnless the interface is in the same assembly, it is not the same type and won't be treated as such (cast will fail, etc)
p35287
aVSo you will need a reference between projects here; most commonly, to a third dll that just has the common types and interfaces in it
p35288
aVThe exception to this is if you are doing contract-based SOA between the two layers (for example via WCF)
p35289
aVBut I don't think that this is what you intended
p35290
as(dp35291
g18
V23354
p35292
stp35293
a((dp35294
g2
(lp35295
VHave you considered ClickOnce deployment
p35296
aVThis topic is then covered in depth
p35297
aVIMO, ClickOnce is much easier both for the developer and the user
p35298
as(dp35299
g18
V23354
p35300
stp35301
a((dp35302
g2
(lp35303
VIt is fairly common practice in "setters" to ignore trivial changes, for example:
p35304
aVIf  is behaving like this, and you are relying on all updates causing an event, then it may not work as you want
p35305
aVI would probably try to find another way to do what you want; perhaps using an intermediate object that passes the values through
p35306
as(dp35307
g18
V23354
p35308
stp35309
a((dp35310
g2
(lp35311
VDo you want a log of the actions
p35312
aVOr do you just want to observe
p35313
aVPerhaps simply  on a timer
p35314
aV(although this is a bit hit'n'miss; WPF has better tools here
p35315
aVSometimes this isn't evil
p35316
aVwe (actually, Steve) did something similar on the finguistics prototype to mimic a teacher's console (for tracking activity etc)
p35317
as(dp35318
g18
V23354
p35319
stp35320
a((dp35321
g2
(lp35322
VThere are a number of connection-specific things that can vastly change performance - for example the  options that are active
p35323
aVIn particular, some of these can play havoc if you have a computed+persisted (and possibly indexed) column
p35324
aVIf the settings are a match for how the column was created, it can use the stored value; otherwise, it has to recalculate it per row
p35325
aVThis is especially expensive if the column is a promoted column from xml
p35326
aVDoes any of that apply
p35327
as(dp35328
g18
V23354
p35329
stp35330
a((dp35331
g2
(lp35332
VBasically, you can't
p35333
aVNot now, and not in
p35334
aVNET 4
p35335
ag190
aVWhat is the context here
p35336
aVWhat do you need
p35337
aVLINQ has  which can get you the data as a  sequence, or there are some tricks with generic methods (i
p35338
ag50
aVetc)
p35339
aVOr you can just use the non-generic
p35340
as(dp35341
g18
V23354
p35342
stp35343
a((dp35344
g2
(lp35345
s(dp35346
g18
V23354
p35347
stp35348
a((dp35349
g2
(lp35350
VAre you sure that it compiled correctly
p35351
aVIt sounds to me like you're debugging against a previous version, which can happen if the build fails (perhaps a code bug, perhaps the files are readonly)
p35352
as(dp35353
g18
V23354
p35354
stp35355
a((dp35356
g2
(lp35357
VAt the command line (csc),
p35358
aVIn the IDE, project properties -> build -> "optimize code"
p35359
aVFor some JIT optimizations, you can use
p35360
as(dp35361
g18
V23354
p35362
stp35363
a((dp35364
g2
(lp35365
VHmm
p35366
aVI originally (and incorrectly) mentioned
p35367
aVHowever, on inspection I expect the answer is simply: don't add it until you need it
p35368
aVThis is easier if your UI model is an abstraction above your actual data model, so you can store items in the data model regardless of their visibility, and simply update the UI (add/remove/update nodes) as necessary
p35369
as(dp35370
g18
V23354
p35371
stp35372
a((dp35373
g2
(lp35374
VEncryption (which is provided by the
p35375
aVNET framework / BCL, not C# the language) typically works on bytes
p35376
aVBut that is fine; numbers are easy to represent as bytes, and the output bytes can be written as a string via
p35377
aVSo "all of them, indirectly"
p35378
aVSee  on MSDN
p35379
aV(re decrypting: an encryption can be decrypted; a hash cannot (hopefully); so as long as you don't look at hashing functions, you should be fine)
p35380
as(dp35381
g18
V23354
p35382
stp35383
a((dp35384
g2
(lp35385
VIf you are using async, then the other code normally isn't actively (or even passively) waiting for completion
p35386
aVThe callback happens on a separate thread, so no; you can't really raise an error and have it interrupt your main thread(s)
p35387
aVYou would need to set a flag that something bad happened (perhaps including the exception instance) - and let the other code query it when it chooses (although you might touch a gate/mutex/monitor to help notify the other thread)
p35388
aVThis approach is done in part by the  approach, where the originating thread (when notified) can pick up the exception
p35389
as(dp35390
g18
V23354
p35391
stp35392
a((dp35393
g2
(lp35394
VAssuming that no other threads are mutating your variables, and assuming that  and  are on the current instance (i
p35395
ag50
aVno chance of a null reference there), then perhaps the most likely thing is that  is throwing
p35396
aVThis is possible - typically when in an error-state (indeed, it plagues WCF); try wrapping the dispose
p35397
aVOh; I'm also assuming here that  has simple event handlers; it is also entirely possible for an event unsubscribe to fail; for example, if it is using an  and has already thrown it away
p35398
aVSo putting those together, something like:
p35399
aVNormally this type of paranoia isn't necessary; but sometimes it is
p35400
as(dp35401
g18
V23354
p35402
stp35403
a((dp35404
g2
(lp35405
VOn C# Express the answer is simple: none
p35406
aVC# Express does not support extensions
p35407
aVPeople have tried before and it has got ugly
p35408
aVLawyers, mess, everything
p35409
aVThe famous example is TestDriven
p35410
aVNET
p35411
aVIf you don't mind building at the command line, you could use an msbuild custom task, or a pre-build / post-build command
p35412
aVIn VS2005/VS2008 ("proper"), a "custom tool" is the one of the ways to go; this involves writing a ; I've done this recently, and the code is open for inspection
p35413
aVT4 is another option going forward
p35414
aVIt didn't fit my needs, but it might do yours
p35415
aVAs a quick check of build events, I've added (in an express project) pre-build and post-build events (Project Properties -> Build Events) of:
p35416
aVand
p35417
aVrespectively; hit build, and the output is now:
p35418
aVSo it seems to work fine (i
p35419
ag50
aVboth events have been executed)
p35420
aVNot elegant, but workable
p35421
aVThe macros should allow you (with some pokery) to access project items, for example
p35422
as(dp35423
g18
V23354
p35424
stp35425
a((dp35426
g2
(lp35427
Vsimply, WebClient
p35428
aVUploadValues:
p35429
as(dp35430
g18
V23354
p35431
stp35432
a((dp35433
g2
(lp35434
VThe first line () is declaring and initialising a field or variable
p35435
aVIn the second example, the field () is declared against the type, and intialised in the constructor ()
p35436
aVIf (in the constructor) we placed a type before it, we would be declaring a local variable with the same name
p35437
aVThis would be confusing (you'd then have to use  and  to refer to the field and variable respectively)
p35438
as(dp35439
g18
V23354
p35440
stp35441
a((dp35442
g2
(lp35443
VYes;
p35444
aVNET 3
p35445
aV0 and 3
p35446
aV5 are actually extensions to 2
p35447
aV0; 2
p35448
aV0 code will with a few edge cases work unchanged
p35449
aVNote that you can use LINQ-to-Objects on
p35450
aVNET 2
p35451
aV0 (via C# 3
p35452
aV0) with LINQBridge
p35453
as(dp35454
g18
V23354
p35455
stp35456
a((dp35457
g2
(lp35458
VThe cost of reflection does not need to be as big as you think
p35459
aVIn addition to delegates (that Jon discusses) you can also use things like HyperDescriptor to minimise the cost of reflection without changing the code much - it simply becomes  instead:
p35460
aVthen
p35461
aVor if you use it lots, consider storing the  somewhere, too
p35462
aVHowever
p35463
aVlike Jon, I'm really not 100% sure what you're trying to do
p35464
as(dp35465
g18
V23354
p35466
stp35467
a((dp35468
g2
(lp35469
VUsing a delegate on an attribute is
p35470
aVunusual, and probably not supportable
p35471
aVAn instance method will require an object, so you will either need to include the object when creating the delegate (the  parameter to  via reflection), or you'll need to use a second delegate type (with no target on the delegate, but additionally taking the target as the param0 - it'll resolve this to the target when used)
p35472
aVHowever, I'm guessing a bit at what you are trying to do (it isn't 100% clear)
p35473
as(dp35474
g18
V23354
p35475
stp35476
a((dp35477
g2
(lp35478
VIt can't be both strongly typed and dynamic; there are largely opposites
p35479
aVOne option here might be generics:
p35480
ag412
ag50
aVhave a  and a  (with  and  respectively)
p35481
aVOther options:
p35482
aVuse an interface/base-class that describes the common functionality between the values
p35483
aVuse object and do the casting/reflection etc yourself
p35484
aVuse C# 4
p35485
aV0 and  (not yet released
p35486
as(dp35487
g18
V23354
p35488
stp35489
a((dp35490
g2
(lp35491
VBasically, it is a cheat ;-p
p35492
aVAny  (i
p35493
ag50
aVanything inherited from ) is treated with value-type semantics
p35494
aVBut there is a boxing conversion to  as necessary; meaning that if you cast a  to an , it will create a special object (on the managed heap) containing the data (as a clone) from your value*
p35495
aVThe boxed version is a reference-type
p35496
aVYou can unbox this (by casting) back to the  version, which reverses this (copies the clones data from the object on the heap into your local value)
p35497
aV*=unless it is an empty , which boxes to ; likewise,  unboxes to an empty
p35498
as(dp35499
g18
V23354
p35500
stp35501
a((dp35502
g2
(lp35503
V(I'm justifying an answer here by adding extra context/info)
p35504
aVYes, at the moment  is the only way to solve this
p35505
aVIn
p35506
aVNET 4
p35507
aV0, the  class has been extended to support both loops and statement blocks, so for single method usage, a compiled  would be a good idea
p35508
aVBut even this won't support multi-method interfaces (just single-method delegates)
p35509
aVFortunately, I've done this previously; see How can I write a generic container class that implements a given interface in C#
p35510
as(dp35511
g18
V23354
p35512
stp35513
a((dp35514
g2
(lp35515
VTo get the sum over a number of files, loop and sum; then the question becomes how to get the size of a single file without downloading it
p35516
aVHere, the "HEAD" verb may help
p35517
aVYou mention ; here is an example of subclassing  to get just the headers
p35518
aVOf course, it isn't guaranteed that you'll get a content-length header
p35519
as(dp35520
g18
V23354
p35521
stp35522
a((dp35523
g2
(lp35524
VTo group by a composite key, you typically use an anonymous type:
p35525
as(dp35526
g18
V23354
p35527
stp35528
a((dp35529
g2
(lp35530
VI haven't seen any evidence of this in the 4
p35531
aV0 spec
p35532
aVso I believe the answer is "no"
p35533
as(dp35534
g18
V23354
p35535
stp35536
a((dp35537
g2
(lp35538
VYou can't cast this, but you can translate the data
p35539
aVThe answer is probably different for 1 table than it is for 20; on an individual bases, you should just be able to  out the data (or alternatively, just iterate) - this will be the fastest option, but is lots of maintenance if you have lots of tables
p35540
aVIn the latter case, some kind of reflection, perhaps like so
p35541
as(dp35542
g18
V23354
p35543
stp35544
a((dp35545
g2
(lp35546
VAn important part of this question is "how big is the data"
p35547
aVHow many rows
p35548
aVFor small amounts of data, list is fine - it will take negligible time to allocate a big enough list, and it won't resize many times (none, if you can tell it how big to be in advance)
p35549
aVHowever, this doesn't scale to huge data volumes; it seems unlikely that your provider supports thousands of interfaces, so I wouldn't say it is necessary to go to this model - but it won't hurt hugely
p35550
aVOf course, you can use LINQ, too:
p35551
aVThis is also the deferred  approach under the covers
p35552
as(dp35553
g18
V23354
p35554
stp35555
a((dp35556
g2
(lp35557
VSo you are looking for a value (from the query-string) in a space-delimited column in the database
p35558
aVAnd you're using  to query the individual values inside the database
p35559
aV(just checking my assumptions
p35560
aVis not supported in this way (at the database on column data) - see here for the supported string operations
p35561
aV(note that  is explicitly not supported)
p35562
aVI'm lazy; when I delimit data in the database (relatively rare), I always add the same delimiter to the start and end of the data; then I can just search for:
p35563
aVHowever; in this case, I expect the most practical option might be to write a UDF function that searches a delimited  (correctly handling the first/last item), and expose the UDF on the data-context - then use:
p35564
aVOr - normalise the data
p35565
as(dp35566
g18
V23354
p35567
stp35568
a((dp35569
g2
(lp35570
VThe folder opens where-ever you last left it
p35571
aVAs for using this feature; by default (Add) it does IMO the least useful thing; copy the file
p35572
aVBut if you notice, the add button is actually a drop-down; hit the down arrow and you can add a link to the file - i
p35573
ag50
aVleave it where it is and reference it by location (Add As Link)
p35574
as(dp35575
g18
V23354
p35576
stp35577
a((dp35578
g2
(lp35579
VThe best way to store data in a database is in columns (per property), so that it is queryable and indexable
p35580
aVORM tools will help with this
p35581
aVHowever, it is also possible to serialize a class as a CLOB/BLOB (/ etc)
p35582
aVIt this is what you want, avoid anything implementation-specific or version-intolerant; so in particular, don't use
p35583
aVAnything contract-based should work; , , etc
p35584
aVOr for fast binary, protobuf-net might be worth a look
p35585
aVBut I stress; columns would be better
p35586
as(dp35587
g18
V23354
p35588
stp35589
a((dp35590
g2
(lp35591
VYou want  /
p35592
aVWell, the single-pipe ( / ) is generally used for bitwise arithmetic, and (among other problems) may make the code base harder to understand; it'll work in LINQ-to-Objects (since bitwise is still defined for ), but without the usual short-circuiting
p35593
aVBut if your data source is a database (i
p35594
ag50
aVthere is an expression parser in the mix), you may find it explodes on you
p35595
aVOK; bitwise may have been misleading; but || and && remains the most logical and expected way of expressing your intent
p35596
aVMy apologies for any confusion
p35597
as(dp35598
g18
V23354
p35599
stp35600
a((dp35601
g2
(lp35602
VIt is entirely sugar for standard types
p35603
aVFor anonymous types, you may find that it uses a constructor behind the scenes, but since the initializer syntax is the only way of assigning them, it is a moot point
p35604
aVThis involves a few more calls than, say, a specific constructor - but I'd be amazed if you ever saw a difference as a result
p35605
aVJust use initializer syntax - it is friendlier ;-o
p35606
as(dp35607
g18
V23354
p35608
stp35609
a((dp35610
g2
(lp35611
VJust to add some thoughts re the accepted answer, in particular for large data volumes:
p35612
aVetc can be unnecessarily slow; there are ways to avoid this, for example using HyperDescriptor or other dynamic code
p35613
aVrather than building lots of intermediate strings, it may be more efficient to write output directly to a
p35614
aVAs a tweaked version that adopts these approaches, see below; note that I haven't enabled HyperDescriptor in this example, but that is just:
p35615
aVAnyway
p35616
as(dp35617
g18
V23354
p35618
stp35619
a((dp35620
g2
(lp35621
VSince  implements  (non-generic), just iterate that:
p35622
as(dp35623
g18
V23354
p35624
stp35625
a((dp35626
g2
(lp35627
VThe most common way of doing this (with winforms) is via ; this allow you to use things  the same as classes; the "full" pattern is quite complex (and involves checking for , , etc; however, the short version is; to get the available properties:
p35628
aVTo get a named property:
p35629
aVTo get a value for an instance ():
p35630
aVTo render a value as a string (using the designated converter):
p35631
as(dp35632
g18
V23354
p35633
stp35634
a((dp35635
g2
(lp35636
VThe trick here is to use a ; create a new
p35637
aVcs file, and in the same namespace add a new class named for your type:
p35638
aVThis combines with the original (generated) class file
p35639
aVThis is a common approach for adding additional functionality into generated entities (including the data-context)
p35640
aVYou might also want to look at "partial methods", since a number of partial methods are defined and used by LINQ-to-SQL
p35641
aVOne caveat: if your dbml is called , then avoid creating a  file (presumably for your partial classes); there is a bug in the code-generator that can cause this to fail
p35642
aVJust name it something else
p35643
as(dp35644
g18
V23354
p35645
stp35646
a((dp35647
g2
(lp35648
VRather than block the UI, do this work on a background thread (perhaps , perhaps )
p35649
aVSince it sounds like you want to emulate synchronous, simply disable the UI controls - don't hang the form
p35650
aVThen update the UI when you do get a response from the server
p35651
as(dp35652
g18
V23354
p35653
stp35654
a((dp35655
g2
(lp35656
VThat is a
p35657
aVNET framework class, not a language feature - so it should work for any
p35658
aVNET language*
p35659
aVYou just need to add a reference to System
p35660
aVWeb
p35661
aVdll first
p35662
aV*=or at least, clients with access to the full framework; so not Silverlight, Compact Framework, Micro Framework or Client Profile
p35663
as(dp35664
g18
V23354
p35665
stp35666
a((dp35667
g2
(lp35668
VYou can add an image to the code editor with SlickEdit Gadgets (free); see my post here for an example - or just:
p35669
as(dp35670
g18
V23354
p35671
stp35672
a((dp35673
g2
(lp35674
VFirstly, threading is tricky ;-p
p35675
aVYes, despite all the rumours to the contrary, it is required to either use  or  (but not both) when accessing a  from multiple threads
p35676
aVFor simple types and access such as an exit flag (), then  is sufficient - this ensures that threads don't cache the value in their registers (meaning: one of the threads never sees updates)
p35677
aVFor larger values (where atomicity is an issue), or where you want to synchronize a sequence of operations (a typical example being "if not exists and add" dictionary access), a  is more versatile
p35678
aVThis acts as a memory-barrier, so still gives you the thread safety, but provides other features such as pulse/wait
p35679
aVNote that you shouldn't use a  on a value-type or a ; nor  or ; the best option is to have your own locking object as a field () and lock on this
p35680
aVFor an example of how badly it breaks (i
p35681
ag50
aVlooping forever) if you don't synchronize - see here
p35682
aVTo span multiple programs, an OS primitive like a  or  may also be useful, but this is overkill for a single exe
p35683
as(dp35684
g18
V23354
p35685
stp35686
a((dp35687
g2
(lp35688
VAs I understand it, many DOM implementations as a document have a level above the root element, allowing for consistent "Add" etc
p35689
aVYou have a reference to this level, no the root element
p35690
aVWhen parsing just an element, this isn't necessary or useful, so is omitted
p35691
aVYou should be able to use  to get the root element
p35692
as(dp35693
g18
V23354
p35694
stp35695
a((dp35696
g2
(lp35697
VIt almost certainly shouldn't be static
p35698
aVBut; assuming it is instance data, have you tried adding an  callback that calls
p35699
aVUntil you do that, it may be incomplete
p35700
aVFor an example, see here
p35701
as(dp35702
g18
V23354
p35703
stp35704
a((dp35705
g2
(lp35706
VWhat exactly are you after
p35707
aVThere is no  for the items in the array
p35708
aVyou can iterate the values by getting the array (as ) and iterating it
p35709
aVjust use:
p35710
as(dp35711
g18
V23354
p35712
stp35713
a((dp35714
g2
(lp35715
VFor coarse-grained security, you might find the inbuilt principal code useful; the user object (and their roles) are controlled in
p35716
aVNET by the "principal", but usefully the runtime itself can enforce this
p35717
aVThe implementation of a principal can be implementation-defined, and you can usually inject your own; for example in WCF
p35718
aVTo see the runtime enforcing coarse access (i
p35719
ag50
aVwhich functionality can be accessed, but not limited to which specific data):
p35720
aVHowever, this doesn't help with the fine-grained access (i
p35721
ag50
aV"Fred can access customer A but not customer B")
p35722
aVAdditional; Of course, for fine-grained, you can simply check the required roles at runtime, by checking  on the principal:
p35723
aVYou can also write your own principal / identity objects that do lazy tests / caching of the roles, rather than having to know them all up-front:
p35724
as(dp35725
g18
V23354
p35726
stp35727
a((dp35728
g2
(lp35729
VThe designer hates:
p35730
aVgenerics
p35731
aVthings with  base-classes
p35732
aVEven if it works at runtime, you're probably not going to get it to work in the IDE
p35733
aVSorry
p35734
aVPerhaps consider a non-generic class with a  property; that's about the best you'll do
p35735
aVbtw,  and  are completely different classes
p35736
aVYou have 2 classes, not one
p35737
as(dp35738
g18
V23354
p35739
stp35740
a((dp35741
g2
(lp35742
VAn  defines a set of methods including "add" and "remove" (in the same way that a property defines "get" and "set")
p35743
aVto this is effectively:
p35744
aVInternally, the event could do anything; there are 2 common cases:
p35745
aVevents with a delegate field (including "field-like" events)
p35746
aVimplementations
p35747
aVWith a delegate, it effectively uses :
p35748
aVWith an  there is a key object:
p35749
as(dp35750
g18
V23354
p35751
stp35752
a((dp35753
g2
(lp35754
VAll the data is in the "http://www
p35755
aVw3
p35756
aVorg/2005/Atom" namespace; you need to use this throughout:
p35757
aVetc (untested)
p35758
as(dp35759
g18
V23354
p35760
stp35761
a((dp35762
g2
(lp35763
VThe short answer here is that
p35764
aVNET generally expects something to be a collection xor to have properties
p35765
aVThis manifests in a couple of places:
p35766
aVxml serialization; properties of collections aren't serialized
p35767
aVdata-binding; you can't data-bind to properties on collections, as it implicitly takes you to the first item instead
p35768
aVIn the case of xml serialization, it makes sense if you consider that it might just be a  at the client
p35769
aVwhere would the extra data go
p35770
aVThe common solution is to encapsulate a collection - i
p35771
ag50
aVrather than
p35772
aVNormally I wouldn't have a  on a collection property, but  demands it
p35773
as(dp35774
g18
V23354
p35775
stp35776
a((dp35777
g2
(lp35778
VThe simplest way to do this is to simply ensure that the dll is in your probing path (search) and (as Tuzo noets), use
p35779
aVIf you want to load a dll from outside your path (and not in the GAC) then it gets tricky
p35780
aVThere is  / , but then you need to worry about the load-context; you can quickly find that you get problems with the dlls that your dynamic code uses
p35781
aVAnother way of simplifying things is to use a separate ; this new  can have a different base/bin - allowing you to bring in the right dlls (and unload it when you want)
p35782
aVYou can either use  (which establishes a remoting hook between two s, using a  proxy), or (for one-shot use) you can simply execute the new  with
p35783
aVI covered a range of these points in GAC, Assembly Resolution , and all that Jazz
p35784
as(dp35785
g18
V23354
p35786
stp35787
a((dp35788
g2
(lp35789
VSee also: C# 3 (
p35790
aVNET 3
p35791
aV5) version of csc fails to report CS0162 for unrechable code (struct/null)
p35792
aVStarting with the C# 3 compiler that means it sometimes doesn't even warn you about this ;-p
p35793
aVBecause  /  etc provide , they fall into this trap where it doesn't warn you
p35794
as(dp35795
g18
V23354
p35796
stp35797
a((dp35798
g2
(lp35799
Vcheck that
p35800
aVisn't null ( or similar)
p35801
aV(the reason I use this rather than  is that most times I want to validate some properties of the attribute too
p35802
as(dp35803
g18
V23354
p35804
stp35805
a((dp35806
g2
(lp35807
VThreading is often so intricate and so implementation specific that I think the only valid way to assess this would be to set them a mock task (in the desired architecture) and "have at it"
p35808
aVSomething that involves competing readers/writers/workers - and UI if needed
p35809
aVOf course
p35810
aVyou also need to have somebody qualified to assess their efforts
p35811
aVYou could also talk about overall principles, but I'm not sure that covers it
p35812
aVAs an example, just yesterday in the C# area there was a lot of confusion about some subtle issues that involved the memory-model, the language spec and the clr spec
p35813
aVYou can't assess that type of detail in vague terms; it has to be very specific to the problem
p35814
aVEqually, the tools / approaches change per framework
p35815
aVOCAML / F# etc has very different threading code to Java/C# - and even that changes per version (see Parallel Extensions/TPL vs things like ReaderWriterLockSlim in 3
p35816
aV5 vs ReaderWriterLock in 2
p35817
aV0)
p35818
as(dp35819
g18
V23354
p35820
stp35821
a((dp35822
g2
(lp35823
VI want to find an easy way which does not change the structure of MyClass and MyObject
p35824
aVFrankly, that isn't going to happen
p35825
aV(when used simply) follows the structure of the classes / members
p35826
aVSo you can't add extra layers without changing the structure
p35827
aVWhen used in a bespoke way (), the one thing you can say for sure is that it isn't simple
p35828
aVthis is not a fun interface to implement
p35829
aVMy advice: introduce a DTO that mimics your desired format, and shim to that before you serialize
p35830
as(dp35831
g18
V23354
p35832
stp35833
a((dp35834
g2
(lp35835
VOver the wire (WCF) there is no difference; the same data will be sent
p35836
aVAt the client, there is very little noticeable performance between  and  in most scenarios
p35837
aVUse  - it is much easier to get it right (adding etc)
p35838
aVIf you are doing lots of data-binding,  might be useful, but you might want to restrict that to a view-model, not a business object
p35839
aVThat does have extra cost (with the events etc)
p35840
aVEdit: the biggest "performance cost" will be the time you spend fighting it to add items to arrays (with resize, and the cost there-of); so jump to  and smile ;-p
p35841
as(dp35842
g18
V23354
p35843
stp35844
a((dp35845
g2
(lp35846
VThe classic way of accessing this type of data would be with a silverlight-enabled WCF service on the ASP
p35847
aVNET site that accesses the data
p35848
aVYou then add a service-reference from the silverlight client and ask the server for data (asynchronously)
p35849
aVNote that by default this will be a separate object model (proxies from "mex")
p35850
aVIf you need the same type you'll have to repeat the code in the client (you can't really use assembly sharing between client and server here)
p35851
aVI don't know whether the silverlight version of svcutil will allow type re-use (the regular version does), but if not another option is to just return xml or binary from the service and deserialize locally
p35852
aVOne option here would be something like protobuf-net
p35853
as(dp35854
g18
V23354
p35855
stp35856
a((dp35857
g2
(lp35858
VIf the data is tokenized (i
p35859
ag50
aV"Dear $name$, as of $date$ your balance is $amount$"), then a  can be useful:
p35860
aVHowever, without something like this, I expect that your  loop is probably about as much as you can do, without going to extreme lengths
p35861
aVIf it isn't tokenized, perhaps profile it; is the  actually a problem
p35862
as(dp35863
g18
V23354
p35864
stp35865
a((dp35866
g2
(lp35867
VIn v1;  is the only way to support inheritance
p35868
aVIn v2, you can use 's  method to achieve the same thing, without requiring your base-type to know about the derived type(s)
p35869
as(dp35870
g18
V23354
p35871
stp35872
a((dp35873
g2
(lp35874
VIt the underlying type doesn't have an obvious  member, this I can't see how this would work
p35875
aVIf the problem is simpy that you only know the column to order by at runtime; then to order by a dynamic property you need to build an  on the fly
p35876
aVHere's some old code I have that does this, and should support "Name" and things like "Customer
p35877
aVName" (child properties); I haven't tested it recently, though:
p35878
as(dp35879
g18
V23354
p35880
stp35881
a((dp35882
g2
(lp35883
VIt is hard to investigate this without being able to look at how your object model ties to the xml (i
p35884
ag50
aVsamples of each); however, you should be able to do something like:
p35885
aVAs a limited atom example (which works fine with some sample atom I have "to hand"):
p35886
as(dp35887
g18
V23354
p35888
stp35889
a((dp35890
g2
(lp35891
VEntity Framework with an Oracle provider
p35892
aVNHibernate
p35893
aVLLBLGen Pro
p35894
aVDbLinq (like LINQ-to-SQL)
p35895
as(dp35896
g18
V23354
p35897
stp35898
a((dp35899
g2
(lp35900
VFor using , I expect you want something like:
p35901
aVhowever, if the data is large, you might have to drop down to  instead
p35902
aVI'll try to do an example
p35903
aV(update; 512kb probably isn't worth it
p35904
aVThe problem with your code is that you are using  here:
p35905
aVJust remove that:
p35906
aVFor info - you are also using query syntax unnecessarily:
p35907
aVis 100% identical to:
p35908
aV(since the compiler ignores an obvious , without mapping it to the  LINQ method)
p35909
as(dp35910
g18
V23354
p35911
stp35912
a((dp35913
g2
(lp35914
VIs this true for ALL languages, like JAVA, C#, etc
p35915
aVIn C# this is only true for the short-circuiting operators '' and ''; if you just use '' or '' it will evaluate both sides every time
p35916
as(dp35917
g18
V23354
p35918
stp35919
a((dp35920
g2
(lp35921
VThis could probably be optimized
p35922
as(dp35923
g18
V23354
p35924
stp35925
a((dp35926
g2
(lp35927
VThe values into attributes are limited to simple types; for example, basic constants (including strings) and
p35928
aVyou can't use  or other more complex code
p35929
aVIn short; you can't do this
p35930
aVYou can give it the type though:
p35931
ag412
ag50
aVthe  ctor takes a , and use  inside the code to create the object
p35932
aVNote that you should ideally just store the string internally ()
p35933
aVFrom ECMA 334v4:
p35934
aV24
p35935
ag733
aV3 Attribute parameter types
p35936
aVThe types of positional and named
p35937
aVparameters for an attribute class are
p35938
aVlimited to the attribute parameter
p35939
aVtypes, which are:
p35940
aVOne of the following types: , , ,
p35941
aV, , , , ,
p35942
aVThe type
p35943
aVThe type
p35944
aVAn enum type, provided it has public accessibility and the
p35945
aVtypes in which it is nested (if any)
p35946
aValso have public accessibility
p35947
aVSingle-dimensional arrays of the above
p35948
aVtypes
p35949
aVand
p35950
aV24
p35951
aV2 Attribute specification
p35952
aVAn expression  is an
p35953
aVattribute-argument-expression if all
p35954
aVof the following statements are true:
p35955
aVThe type of  is an attribute
p35956
aVparameter type (24
p35957
ag733
aV3)
p35958
aVAt compile-time, the value of E can be
p35959
aVresolved to one of the following:
p35960
aVA constant value
p35961
aVA typeof-expression (14
p35962
ag691
aV11) specifying a non-generic
p35963
aVtype, a closed constructed type
p35964
aV(25
p35965
ag691
aV2), or an unbound generic type
p35966
aV(25
p35967
aV5)
p35968
aVA one-dimensional array of
p35969
aVattribute-argument-expressions
p35970
as(dp35971
g18
V23354
p35972
stp35973
a((dp35974
g2
(lp35975
VI've used a hacky approach before - of having a test exe that modifies my "hosts" file, injecting an entry for the farm name to the specific server's address (and issuing an )
p35976
aVAfter that, requests should get routed to the right server as though it were the only one there
p35977
aVObviously this requires admin access
p35978
aVI use it as part of an automated smoke-test to hit the farm as though it were individual machines
p35979
aVThe other thing you might try is something on the NLB, perhaps in TCL (in the case of F5) - maybe add a custom header that the NLB understands
p35980
aV(assuming it is doing SSL re-signing)
p35981
as(dp35982
g18
V23354
p35983
stp35984
a((dp35985
g2
(lp35986
VFor info, stripping html with a regex is
p35987
aVfull of subtle problems
p35988
aVThe HTML Agility Pack may be more robust, but still suffers from the words bleeding together:
p35989
as(dp35990
g18
V23354
p35991
stp35992
a((dp35993
g2
(lp35994
VOne caveat; you might want to double-check your CPU's endianness
p35995
aVassuming little-endian is not quite safe (think: itanium etc)
p35996
aVYou might also want to see if  makes any difference (I'm not sure it will)
p35997
as(dp35998
g18
V23354
p35999
stp36000
a((dp36001
g2
(lp36002
Vdouble precision numbers are essentially approximations, and frequently have tails that you cannot get rid of - i
p36003
ag50
aVthere is no way of expressing the number more accurately
p36004
aVYou might get results more like you expect if you use  - which is still an approximation, but it uses base-10, so tends to behave more like people expect
p36005
aVBut because it doesn't map to a CPU type, it is slower
p36006
as(dp36007
g18
V23354
p36008
stp36009
a((dp36010
g2
(lp36011
VIf you want to enforce logic in the child class, then something like:
p36012
aVThen no need to call the parent methods; already done in "pre-logic" and "post-logic"
p36013
as(dp36014
g18
V23354
p36015
stp36016
a((dp36017
g2
(lp36018
VNo, IMO
p36019
aVIn particular, I'm quite a purest, so I don't think my UI should have anything to do with the data access
p36020
aVThat is the job of a repository class
p36021
aVAn a repository class should likewise have nothing to do with the http-request
p36022
aVSo by separation-of-concerns, the only logical answer here is "no"
p36023
aVRe being expensive (comments); it actually gains cost the longer you use it:
p36024
aVthe object/identity tracker will slowly accumulate each unique record you fetch
p36025
aVthe change tracker has more work to monitor
p36026
aVyou get a lot more chance of stale (out-of-date) records (getting wrong data is a definite cost)
p36027
aVAnd by allowing it to live beyond the DAL, you also have to worry about threading (this is especially true for web-requests, where you can get all sorts of interesting combinations of requests for the same session)
p36028
aVLINQ-to-SQL doesn't offer much cache; it has limited support to short-circuit identity lookups to the identity manager (so if you ask for , and it has seen record , it won't hit the database)
p36029
aVHowever, most of the time it'll hit the database
p36030
aVAnd re the database, one of the bigger costs there is the cost of new connections; which is mitigated very effectively (for web apps) by the connection pooling on
p36031
as(dp36032
g18
V23354
p36033
stp36034
a((dp36035
g2
(lp36036
V(I'm the author of protobuf-net)
p36037
aVI'm about to leave, so I can't verify "right now", but at a first guess, I'd say that the  looks a likely culprit
p36038
aVTry  or some other number ("protocol buffers" identifiers must be positive)
p36039
aVNote that you'll need to tweak this both on  and on
p36040
aVI've taken a copy of the above, and I'll check on the train
p36041
aVNote also that the WCF hooks work best if you are using assembly sharing - i
p36042
ag50
aVyou have the same class at the client and server
p36043
aVIf you are using  (or "Add Service Reference"), it sometimes remaps the numbers; there is a trick to fix this - let me know if this is an issue (basically, double check the  on the properties generated by the tooling)
p36044
as(dp36045
g18
V23354
p36046
stp36047
a((dp36048
g2
(lp36049
VIf you want it to happen just before it is saved; you can override , and call  to get the pending changes
p36050
aVLook for the things you are interested in (for example, , and make your required changes
p36051
aVThen call
p36052
aVHere's a related example, handling deletes
p36053
as(dp36054
g18
V23354
p36055
stp36056
a((dp36057
g2
(lp36058
VIn
p36059
aVNET 3
p36060
aV5, there is  and  that serves this purpose; however, the default implementation is immutable
p36061
aVI wrote a mutable variant for MiscUtil;  - which does exactly what you want
p36062
as(dp36063
g18
V23354
p36064
stp36065
a((dp36066
g2
(lp36067
VAll your array contains initially is a lot of nulls
p36068
aVYou need to actually create the lists
p36069
aVPersonally, though, I expect this will be a costly way to do things
p36070
aVIt depends in part on whether the data is "sparse" - i
p36071
ag50
aVare most of the cells usually taken
p36072
aVA simple (but possibly more efficient) approach, for example, would be to use something like multi-map; i
p36073
ag50
aVwhere  could be something like  (using  from "MiscUtil")
p36074
aVThat way, you can still query it by co-ordinate, and have multiple creatures on a coordinate, but you don't have to allocate space for every cell
p36075
aVAnd because it functions as a dictionary it is still fast
p36076
aVNot as fast as a flat array, but it will scale to bigger (sparse) grids
p36077
aVof course, if the grid has creatures on every cell it could be more expensive
p36078
aVHence the need to understand your data
p36079
as(dp36080
g18
V23354
p36081
stp36082
a((dp36083
g2
(lp36084
VThe primary thing is that it start off on the right foot - i
p36085
ag50
aVa separate controller and view
p36086
aVIf you choose to do something crazy, nobody will stop you
p36087
aVExcept hopefully peer reviews
p36088
aVAnd common sense
p36089
aVBut contrast to webforms, where you have to try very hard not to mix the concerns
p36090
as(dp36091
g18
V23354
p36092
stp36093
a((dp36094
g2
(lp36095
VIn short, yes
p36096
aVMSDN covers it here
p36097
aVThe problem is that it isn't done via  - you need to handle the value as BGR sets - i
p36098
ag50
aVeach integer is composed of the colors as 00BBGGRR, so you left-shift blue by 16, green by 8, and use red "as is"
p36099
aVMy VB sucks, but in C#, to add purple:
p36100
aVreflector assures me that this is similar to:
p36101
as(dp36102
g18
V23354
p36103
stp36104
a((dp36105
g2
(lp36106
VsomeExpressionInvolving(s
p36107
aV"");
p36108
aVThere is no point getting excited about  vs  - there is negligible difference:
p36109
as(dp36110
g18
V23354
p36111
stp36112
a((dp36113
g2
(lp36114
V supports xpath
p36115
aVDid I miss something
p36116
as(dp36117
g18
V23354
p36118
stp36119
a((dp36120
g2
(lp36121
VThe problem, as far as I can see, is simply that  isn't a class
p36122
aVyou're passing in  as  (whether it is implicit or explicit)
p36123
aVIt is probably also slightly confusing that in the first example you have two type parameters called  - one on the type, and one on the method
p36124
aVThey are actually completely separate
p36125
aVto be the same, rewrite the first example as:
p36126
aVThis is now the same
p36127
as(dp36128
g18
V23354
p36129
stp36130
a((dp36131
g2
(lp36132
VCurrently it will support  as a property, as long as it doesn't have to create it - i
p36133
ag50
aVallowing things like (attributes not shown for brevity):
p36134
aVI would have to check, but for similar reasons, I expect it would work with , but not  (which is what the WCF hooks use)
p36135
aVHowever, I can't think of a reason it couldn't default to
p36136
aVit just doesn't at the moment
p36137
aVThe simplest option is probably to stick with  /  - but I can have a look if you want
p36138
aVbut I'm in a "crunch" on a (work) project at the moment, so I can't lift the bonnet today
p36139
aVRe "this and other answers"
p36140
aVthere is a google group, but that is not just protobuf-net (protobuf-net is simply one of many "protocol buffers" implementations)
p36141
aVYou are also free to log an issue on the project site
p36142
aVI do mean to collate the FAQs and add them to the wiki on the site - but time is not always my friend
p36143
aVBut hey
p36144
aVI'm here
p36145
aV;-p
p36146
as(dp36147
g18
V23354
p36148
stp36149
a((dp36150
g2
(lp36151
VData-contexts should ideally be a unit of work
p36152
aVIt isn't 100% clear to me where your test breaks down, but I don't see why you can't have multiple data-contexts on the same transaction
p36153
aVIf you are using connection-based transactions, then just make sure you give the  to all the contexts
p36154
aVBut even easier is just to use ; all data-contexts will enlist in the ambient transaction
p36155
aVThis makes it a breeze to integration-test code in your DAL without changing the data
p36156
aVFor example:
p36157
aVHere, anything using  should (unless it deliberately uses the null-transaction) be in your transaction, which is rolled back because we don't call
p36158
as(dp36159
g18
V23354
p36160
stp36161
a((dp36162
g2
(lp36163
VIt looks like you'd have to download the source; see http://code
p36164
aVgoogle
p36165
aVcom/p/ngourd/source/checkout
p36166
aVIt will help if you have a SVN client; if you are on Windows then my preference is TortoiseSVN, but any would do
p36167
as(dp36168
g18
V23354
p36169
stp36170
a((dp36171
g2
(lp36172
VWhen you say "behave differently"; I wonder whether checking  (after adding a reference to ) would be a better idea
p36173
aVOtherwise, you're into stack-frame parsing territory; not a good idea
p36174
aVOf course, I'd want the code to do the same job either way, using something like dependency injection to handle the differences
p36175
as(dp36176
g18
V23354
p36177
stp36178
a((dp36179
g2
(lp36180
VIf you know the IP address of the server's SSL endpoint (which isn't necessarily the same as the server's default IP address), then you could just aim you web-service at that
p36181
aVObviously the SSL check will fail, but you can disable that through code
p36182
as(dp36183
g18
V23354
p36184
stp36185
a((dp36186
g2
(lp36187
VIt sounds to me like namespaces are the issues; you generally need to enlist the help of an  for this, and use an alias in your queries, i
p36188
ag50
aV(where  is defined in  as an alias to the given namespace)
p36189
as(dp36190
g18
V23354
p36191
stp36192
a((dp36193
g2
(lp36194
VWhat exactly is missing
p36195
aVWhat are you seeing (or not)
p36196
aVIn particular, LINQ-to-SQL's strategy for the database (i
p36197
ag50
aVhow to do paging etc on SQL2000 vs SQL2005 etc) is chosen at runtime based on the connection and the specific server (so it updates automatically when you install SQL Server 2008)
p36198
aVThe code generation is based purely on the dbml, which doesn't really care about the server version (it is just xml - take a look)
p36199
aVIf you are missing some  methods, I wonder if you haven't accidentally detached your es from the dbml-generated ones, perhaps by changing the namespace or their names
p36200
as(dp36201
g18
V23354
p36202
stp36203
a((dp36204
g2
(lp36205
VNo; you need either the framework installed, or the tools like you have mentioned
p36206
aVYou could potentially look at mono's new static linker, but that is about it
p36207
as(dp36208
g18
V23354
p36209
stp36210
a((dp36211
g2
(lp36212
VOthers have observed that the member is a field
p36213
aVIMO, though, the best fix is to make it a property
p36214
aVUnless you're doing some very specific things, touching fields (from outside the class) is usually a bad idea:
p36215
as(dp36216
g18
V23354
p36217
stp36218
a((dp36219
g2
(lp36220
V(I can't see anything database related in the question, btw)
p36221
aVPerhaps the best way of laying out this code is
p36222
aVnot to
p36223
aVDon't write code for things that the standard data-binding frameworks can handle
p36224
aVFor example (sorry it is C#, but it should translate - all of the "good" bits here are provided by the
p36225
aVNET framework, not the language); some UI code - note no code to copy values:
p36226
aVWith supporting data entity:
p36227
as(dp36228
g18
V23354
p36229
stp36230
a((dp36231
g2
(lp36232
VSomething like below (which supports other types than just , but defaults to )
p36233
aVImportantly, don't fall into the trap of looking at  data via reflection; LINQ-to-SQL supports objects without attributes too:
p36234
as(dp36235
g18
V23354
p36236
stp36237
a((dp36238
g2
(lp36239
VNothing inbuilt makes static any more-or-less different (re thread-safety) than instance, except:
p36240
aVstatic methods are often stateless "pure functional" methods, making them automatically thread-safe
p36241
aVthere is a clear expectation on static members to be thread-safe (since you can't really control what each thread is doing at once) - so it is expected that any static method that could risk thread-safety be made thread-safe
p36242
aVThis is not true for instance methods:
p36243
aVinstance methods commonly access state on that instance
p36244
aVthere is no expectation of thread safety unless it is made explicit in the documentation
p36245
aVSo in general it is expected that the caller manage thread-safety over instances
p36246
aVThere are exceptions where instances are thread-safe (usually for things that are deeply tied to threading, such as a producer-consumer queue) - but IMO any static member that isn't thread safe is a bug
p36247
as(dp36248
g18
V23354
p36249
stp36250
a((dp36251
g2
(lp36252
VIs the data html or xhtml
p36253
aVFor xhtml, load it into  (or  etc) and access  on the root element (or the element of choice)
p36254
aVFor (non-x)html, the HTML Agility Pack serves a similar purpose, allowing xpath queries etc (, for example)
p36255
as(dp36256
g18
V23354
p36257
stp36258
a((dp36259
g2
(lp36260
VThe problem in your code is that you never actually pass the object over the boundary; thus you have two  instances, one in each app-domain (the static field initializer runs on both app-domains)
p36261
aVYou will need to pass the instance over the boundary for the  magic to kick in
p36262
aVFor example:
p36263
as(dp36264
g18
V23354
p36265
stp36266
a((dp36267
g2
(lp36268
Vespecially the ones which use a single table and in
p36269
aVNET
p36270
aVLINQ-to-SQL can use the single-table / discriminator approach
p36271
aVAn example is given here
p36272
as(dp36273
g18
V23354
p36274
stp36275
a((dp36276
g2
(lp36277
Vbut the configuration object is not available in the shared project, only in the primary one
p36278
aVSo those methods should only be visible in the primary project, but I still want to re-use the rest as part of my shared library
p36279
aVIt sounds like you simply want some of the methods to be
p36280
aVIf I've misunderstood, then other options include:
p36281
aVusing an interface to describe the configuration options (so no concrete type in the secondary projects)
p36282
aVusing
p36283
as(dp36284
g18
V23354
p36285
stp36286
a((dp36287
g2
(lp36288
VThe generic type constraints follow all the base-class / interfaces:
p36289
as(dp36290
g18
V23354
p36291
stp36292
a((dp36293
g2
(lp36294
VDo I have to parse the string and convert it into a number for this
p36295
aVEssentially, yes; but LINQ may help:
p36296
as(dp36297
g18
V23354
p36298
stp36299
a((dp36300
g2
(lp36301
VIf you control the object model, then you can write code to do it, but it is a lot of maintenance
p36302
aVThere are lots of problems, though, which mean that unless you need absolutely the fastest performance, then serialization is often the most manageable answer
p36303
aVThis is one of the cases where  works acceptably; normally I'm not a fan (due to the issues with versioning etc) - but since the serialized data is for immediate consumption this isn't an issue
p36304
aVIf you want it a bit faster (but without your own code), then  may help, but requires code changes (to add the necessary metadata etc)
p36305
aVAnd it is tree-based (not graph-based)
p36306
aVOther serializers (, ) are also fine, but if it is just for clone, they may not offer much over  (except perhaps that  doesn't need
p36307
aVSo really, it depends on your exact classes and the scenario
p36308
as(dp36309
g18
V23354
p36310
stp36311
a((dp36312
g2
(lp36313
VWhat exactly is it you want to do
p36314
aVDealing with the various meanings of operators (primitive  (mapped to specific IL instructions), custom (mapped to static methods), and lifted (provided as a pattern by the compiler)) makes this painful
p36315
aVIf you just want to use the operators, then it is possible to write code that provides operator support via generics
p36316
aVI have some code for this that is freely available in MiscUtil (description and examples)
p36317
aVAs an untyped example (an note that this isn't hugely efficient, but works):
p36318
as(dp36319
g18
V23354
p36320
stp36321
a((dp36322
g2
(lp36323
VThe message-contracts option might have this effect; the purpose here being to allow fine-grained control over the underlying request
p36324
aVUltimately, what you are sending (behind the scenes) is a request payload
p36325
aVThe reuse-types option is more typically used with objects (not things like ) - and means that if you have a 100% matching  (say) class locally, it can re-use that for the web-service rather than generating a proxy type
p36326
aVAdditionally, note that you aren't actually consuming a WCF service ( is the older web-service style)
p36327
aVAs such you may have better results with a "Web Reference"; when adding the service, hit "Advanced", then "Add Web Reference
p36328
aVThis uses the older UI and wsdl
p36329
aVexe to generate code intended for  (asmx), rather than WCF (svc)
p36330
aVOf course, rather than hosting a , you could (since the server is also 3
p36331
aV5) host a WCF service; this may make things easier
p36332
aVA final point of WCF; if you really want the same contract at client and server, you can use either assembly or class sharing to use the very same types at both end
p36333
aVThis is not supported for , though
p36334
as(dp36335
g18
V23354
p36336
stp36337
a((dp36338
g2
(lp36339
VA bit platform-specific, but Expression Blend 3 includes "SketchFlow", which I'm currently using for prototyping; in particular, it uses the same tooling as normal, but re-styles it to intentionally remind the user that it is prototype only:
p36340
aVA range of similar prototyping tools exist for various platforms; this one is quite nice because if combines this with the standard platform functionality
p36341
as(dp36342
g18
V23354
p36343
stp36344
a((dp36345
g2
(lp36346
VI think the  issue has been addressed by other answers; but to make your code easier, you might also want to look at :
p36347
as(dp36348
g18
V23354
p36349
stp36350
a((dp36351
g2
(lp36352
VReally, you want
p36353
aVNET 3
p36354
aV5 for this
p36355
aV(I know you asked about
p36356
aVNET 2
p36357
aV0, but this answer may be heplful for somebody searching for this topic in the future)
p36358
aVBefore then
p36359
aVpain
p36360
aVYou can maintain your own list of offsets, but then you have to worry about DST
p36361
as(dp36362
g18
V23354
p36363
stp36364
a((dp36365
g2
(lp36366
VWhat is difference between these two statements
p36367
aVThe first returns a filtered sequence of the original/complete source object; the second still does the filter, but returns a sequence of an anonymous type with just those three properties
p36368
aVIs there any performance related issue in these statements
p36369
aVPerformance depends on the back-end
p36370
aVIf this is LINQ-to-Objects, then with  you are creating extra objects (anonymous types) per record, so there may be a very small overhead
p36371
aVHowever, if this is LINQ-to-SQL etc (a database back-end), then this can be a huge benefit
p36372
aVThe query builder will check which columns are needed, and will only fetch the three in your anon-type; if you have (for example) a BLOB (or just long ) in your data that you don't need, this can be a huge benefit
p36373
aVAdditional notes: you can't include anonymous types in the signature of a method, so you might find you need to declare your own DTO type for this purpose:
p36374
as(dp36375
g18
V23354
p36376
stp36377
a((dp36378
g2
(lp36379
VThe first thing to do - get rid of the cursor
p36380
aVMost things should be possible direct in TSQL (it is hard to be definite without an example) - and you could consider a UDF for more complex operations
p36381
as(dp36382
g18
V23354
p36383
stp36384
a((dp36385
g2
(lp36386
VYour code should work; if it hasn't, you might be using different object instances that represent the same actual cluster, and you perhaps haven't provided a suitable  implementation (you should also update  at the same time)
p36387
aVAlso - in
p36388
aVNET 3
p36389
aV5, this could be simply:
p36390
aVAs an example of class that supports equality tests:
p36391
as(dp36392
g18
V23354
p36393
stp36394
a((dp36395
g2
(lp36396
VTo show both  and  usage:
p36397
as(dp36398
g18
V23354
p36399
stp36400
a((dp36401
g2
(lp36402
VIt depends in part on your tools - for example, Visual Studio is still a 32 bit app (but usable from x64 - just no huge gain)
p36403
aVHowever, if you are using your main OS to host VMs, then you can probably benefit from a ton of memory for your various virtuals - and then you can choose 32-bit and 64-bit VMs to suit your needs (it is harder to have a 64-bit guest VM in a 32-bit host)
p36404
aVPersonally, I'm still on 32-bit for development
p36405
aVFor most of what I do, it is fine
p36406
as(dp36407
g18
V23354
p36408
stp36409
a((dp36410
g2
(lp36411
VI suspect that the best you can do is make sure you use the overload of  that accepts an  to use as the parent
p36412
aVThis might help it choose an appropriate location; most commonly:
p36413
as(dp36414
g18
V23354
p36415
stp36416
a((dp36417
g2
(lp36418
VThis is actually notoriously tricky
p36419
aVIt works fine with UDFs, since they have stronger metadata - but a stored procedure can do lots of nasty things:
p36420
aVbranches ( etc), returning completely different shapes
p36421
aVexecute another stored procedure
p36422
aVexecute dynamic sql
p36423
aVSo very, very tricky
p36424
aVThere are two common approaches:
p36425
aVattempt to parse the TSQL; painful
p36426
aVexecute it with default (null, etc) values and check the result
p36427
aVThe  option is often used for the second (to avoid updates etc), but note that system stored procedures are still executed (perhaps
p36428
aV, so you risk doing unwanted things
p36429
as(dp36430
g18
V23354
p36431
stp36432
a((dp36433
g2
(lp36434
VWith , I expect that a large part of the problem is that the format of the xml is wrong; that isn't the xsd standard for dates
p36435
aVcan you influence the xml at all
p36436
aVOtherwise, you might have to stick with strings and process it afterwards
p36437
aVMore standard xml would be:
p36438
aVFor example:
p36439
as(dp36440
g18
V23354
p36441
stp36442
a((dp36443
g2
(lp36444
VYou can't do this via config; but you can control attributes by writing a custom component-model implementation; i
p36445
ag50
aVwriting your own , and using  or  to associate it
p36446
aVLots of work
p36447
aVUpdate
p36448
aVI thought of a sneaky way to do it; see below, where we filter it to 2 of the properties using a string at runtime
p36449
aVIf you don't own the type (to set the ), then you can use:
p36450
aVto associate the converter at runtime
p36451
as(dp36452
g18
V23354
p36453
stp36454
a((dp36455
g2
(lp36456
VNote that this is a blatant race condition unless you take a key-range lock
p36457
aVWhy not use
p36458
aVBut if you  the value, you should be able use use
p36459
aVAlso; if you don't white-list the tables, that is a SQL injection risk
p36460
as(dp36461
g18
V23354
p36462
stp36463
a((dp36464
g2
(lp36465
VThe classic example here is when you have an id (and so expect the data to exist, uniquely, by that id):
p36466
aVYou could check  if useful (to give a better error message if you get a ), but getting 2 (or more) is definitely a big problem
p36467
as(dp36468
g18
V23354
p36469
stp36470
a((dp36471
g2
(lp36472
VWell, an interface is usually preferred as it allows greater flexibility and abstraction - but you can do both, by having your  base-class implement the interface
p36473
aVThen 95% of the time you use the base-class, and when you need something different you just use the interface
p36474
aVJust don't touch the base-class from your business code
p36475
aVonly the interface
p36476
aVThe base-class is an implementation detail only
p36477
as(dp36478
g18
V23354
p36479
stp36480
a((dp36481
g2
(lp36482
VIt is neither
p36483
aVIt runs on the same UI thread as your other form(s) unless you go out of your way to do something clever, with the message pump handling messages to all of them
p36484
aVWhat is it that you want to do
p36485
aVNormally keeping the reference to the second form instance is sufficient for sending messages, etc
p36486
aVTo wait for the second form to finish, use , or if you are in a form,
p36487
as(dp36488
g18
V23354
p36489
stp36490
a((dp36491
g2
(lp36492
VYou could use  on the entity, but that would force it to bring back all the columns (even if not used); perhaps instead something like:
p36493
aVwhere  is some method that takes the two and merges them, presumably re-used from your other (property) code
p36494
aVWith LINQ-to-SQL, another option is to expose a UDF on the data-context that does the formatting inside the database; a slightly different example:
p36495
aV(which will do the work at the database; whether or not that is a good idea ;-p)
p36496
as(dp36497
g18
V23354
p36498
stp36499
a((dp36500
g2
(lp36501
VIf you are using , then typically  is being used behind the scenes
p36502
aVIt looks like the biggest problem is your empty  on
p36503
aVSince  demands a  on lists/arrays, I'd probably keep it simple and use:
p36504
aV(and maybe initialize it in the parameterless ctor to make usage simple)
p36505
aVFor info, I tend to use
p36506
aVNET naming conventions in the C#, and xml conventions in the xml - for example:
p36507
aVFor info,  (used in WCF services by default) doesn't have this annoying need for a setter
p36508
aVYou could also switch to WCF
p36509
as(dp36510
g18
V23354
p36511
stp36512
a((dp36513
g2
(lp36514
VHaving an  value is never a good idea on a web-service; when you have only xml (or similar), how can it stand a chance
p36515
aVThere are some sneaky tricks you might try with multiple subclasses; not sure if this is a good idea, though
p36516
as(dp36517
g18
V23354
p36518
stp36519
a((dp36520
g2
(lp36521
VArsenMkrt is right;  is the way to go here; some extra thoughts, though:
p36522
aVYou might consider using "component model" rather than reflection; i
p36523
ag50
aVinstead of , consider
p36524
aVThis gives you a set of  records instead of the reflection
p36525
aVWhy is this handy
p36526
aVbecause people can actually specify a converter per property (below) - this is exposed as  on
p36527
aVif the file is big, you can get a performance boost by using
p36528
aVAs an example of a property with custom converter:
p36529
as(dp36530
g18
V23354
p36531
stp36532
a((dp36533
g2
(lp36534
VDo you mean:
p36535
as(dp36536
g18
V23354
p36537
stp36538
a((dp36539
g2
(lp36540
V(edit: tried it; still gives "")
p36541
aVWhy are you using  here
p36542
aVHave you tried it with the version of  that includes the index
p36543
aVYou should also probably include an explicit  - LINQ-to-SQL lets you get away without it most of the time, but EF doesn't
p36544
as(dp36545
g18
V23354
p36546
stp36547
a((dp36548
g2
(lp36549
VA toughie, since  doesn't support serialization callback events
p36550
aVIs there any way you could use
p36551
aVThat does, but doesn't allow attributes (like  above)
p36552
aVOtherwise; you could implement , but that is lots of work, and very error-prone
p36553
aVOtherwise - perhaps checking the caller via the stack, but that is very brittle, and smells ripe
p36554
as(dp36555
g18
V23354
p36556
stp36557
a((dp36558
g2
(lp36559
VWhat version of
p36560
aVNET are you using
p36561
aVIf you are using
p36562
aVNET 3
p36563
aV5, then I have a generic operators implementation in MiscUtil (free etc)
p36564
aVThis has methods like , and other variants for arithmetic on different types (like )
p36565
aVAdditionally, this works for all the inbuilt, lifted and bespoke operators, and caches the delegate for performance
p36566
aVSome additional background on why this is tricky is here
p36567
aVYou may also want to know that  (4
p36568
aV0) sort-of solves this issue indirectly too - i
p36569
ag50
aVRe the comment about  /  - you don't actually need operators for this; you just need:
p36570
as(dp36571
g18
V23354
p36572
stp36573
a((dp36574
g2
(lp36575
Vthat the constructor will fully complete before any other thread can get a reference to the object
p36576
aVThe static initializer will be invoked once only (by the system, at least) per , and in a synchronized way, taking "beforefieldinit" into account
p36577
aVSo assuming you don't do anything bizarre, any static fields assigned in the static initializer should be OK; any other attempts to use the static field should get held (blocked) behind the static constructor
p36578
aVthe reference to the new object is assigned only after the constructor completes
p36579
aVIt happens when it happens
p36580
aVAny static field initializers happen before what you typically think of as the constructor, for example
p36581
aVBut since other threads are blocked, this shouldn't be an issue
p36582
aVHowever:
p36583
aVif your static initializer itself passes a reference outside (by calling a method with the reference as an argument (including "arg0"), then all bets are off
p36584
aVif you use reflection to invoke the static constructor (yes, you can do this), crazyness often follows
p36585
as(dp36586
g18
V23354
p36587
stp36588
a((dp36589
g2
(lp36590
VHow are you creating the
p36591
aVThere is a LicenseFile on ; are you setting this
p36592
aVI'm not 100% "up" on license files and their use within s, but that may help a little
p36593
aVUnfortunately information on this area (license files vs embedded) looks very sparse
p36594
aVyou could try copying the embedded resource to a temp file
p36595
as(dp36596
g18
V23354
p36597
stp36598
a((dp36599
g2
(lp36600
VYou can write a LINQ-based line reader pretty easily using an iterator block:
p36601
aVor to make Jon happy:
p36602
aVthen you have  as a lazily evaluated sequence without buffering, perfect for  etc
p36603
aVNote that if you use  or the standard , it will have to buffer the data in memory; ifyou need grouping and aggregation, "PushLINQ" has some fancy code to allow you to perform aggregations on the data but discard it (no buffering)
p36604
aVJon's explanation is here
p36605
as(dp36606
g18
V23354
p36607
stp36608
a((dp36609
g2
(lp36610
VYou could use a  to check that it is "^[01]+$" (or better, "^[01]{1,32}$"), and then use
p36611
aVof course, exceptions are unlikely to be a huge problem anyway
p36612
aVInelegant
p36613
aVmaybe
p36614
aVBut they work
p36615
aVExample (formatted for vertical space):
p36616
as(dp36617
g18
V23354
p36618
stp36619
a((dp36620
g2
(lp36621
VEdit: all of this is basically what dapper does - but dapper is much more optimized
p36622
aVIf I was writing this answer today, it would read simply: "use dapper"
p36623
aVIf you aren't hugely "up" on IL, there are alternatives that get you the speed of IL and the convenience of reflection
p36624
aVFirst example:
p36625
aVHyperDescriptor - uses a custom  model that deals with the IL for you, so all you have is code like (plus the one-liner to enable ):
p36626
aVSecond example:
p36627
aVLINQ expressions - quite lengthy, but I've discussed this (and the above, it turns out) on usenet - see this archive
p36628
as(dp36629
g18
V23354
p36630
stp36631
a((dp36632
g2
(lp36633
V"Content" may be more appropriate, since I believe that includes it by default when you publish the project, be it via msi (installer) or ClickOnce
p36634
as(dp36635
g18
V23354
p36636
stp36637
a((dp36638
g2
(lp36639
VAnd then, if you need the second portion as an expression tree too:
p36640
as(dp36641
g18
V23354
p36642
stp36643
a((dp36644
g2
(lp36645
VLooking at  as an example - it uses , suggesting that if you are constrained to using an array, then this might indeed be your best option
p36646
aVOr, as Indeera notes - use a different container
p36647
aVDepending on the exact usage, some options
p36648
aVif you are always inserting at 0, use a  (or keep your own array with spare capacity, but I can't think why), but think of it backwards - so "insert" becomes "append", which is cheaper (especially if you don't have to reallocate)
p36649
aVlinked list is an option
p36650
aVas is a queue / stack (depending on if/how you remove data)
p36651
aVor for both prepend and append, keep an array with spare capacity on both sides, wrapped in something like (but more complex than) a  - and maintain the offset - i
p36652
ag50
aVyou have an array of 100, and know that your "zero" is 50, and you've used 20; insert at "zero" is then simple changes the value at offset 49, decrements the main zero offset to 49 and increments the virtual length to 21
p36653
as(dp36654
g18
V23354
p36655
stp36656
a((dp36657
g2
(lp36658
VPerhaps just drop the reference to
p36659
as(dp36660
g18
V23354
p36661
stp36662
a((dp36663
g2
(lp36664
VYou should be able to just look at :
p36665
as(dp36666
g18
V23354
p36667
stp36668
a((dp36669
g2
(lp36670
VOr if you just want the  elements (no )
p36671
as(dp36672
g18
V23354
p36673
stp36674
a((dp36675
g2
(lp36676
VYou can test an exact type via reflection:
p36677
aVPersonally, though, I'd look for  - more versatile than the concrete :
p36678
as(dp36679
g18
V23354
p36680
stp36681
a((dp36682
g2
(lp36683
VI'm going to make the assumption that this is winforms
p36684
aVIf you want two-way data-binding, you need a few things:
p36685
aVto detect addition/removal etc, you need a data-source that implements ; for classes,  is the obvious choice ( simply won't do
p36686
aVto detect changes to properties of the objects, you need to implement  (normally you can use the "*Changed" pattern, but this isn't respected by )
p36687
aVFortunately,  handles both of these
p36688
aVA full example follows; I've used C#, but the concepts are identical
p36689
as(dp36690
g18
V23354
p36691
stp36692
a((dp36693
g2
(lp36694
VChange the args to 0/1 (not 1/2):
p36695
aVbecause the dynamic method it seems to be created as static, not instance (your original method is instance) - hence the args are off by one
p36696
aV(sorry for the original wrong answer - you can leave the other bit of code as )
p36697
as(dp36698
g18
V23354
p36699
stp36700
a((dp36701
g2
(lp36702
VI'm the author of protobuf-net
p36703
aVI haven't added anything to address the scenario as directly presented (other than the  code), but I'm open to suggestion on what you think it should do
p36704
aVI would also need to check whether "protoc" (the
p36705
aVproto compiler that I use to parse
p36706
aVproto prior to code generation) allows me to distinguish between regular and extended members
p36707
as(dp36708
g18
V23354
p36709
stp36710
a((dp36711
g2
(lp36712
VUpdate: to see what is actually happening without having to resort to IL: Using reflector to understand anonymous methods and captured variables
p36713
aVWhen you use:
p36714
aVYou are implicitly meaning ; so in terms of the delegate, it is the reference to  that is included
p36715
aVAs such, the instance of  (via the delegate) keeps the entire  alive (not garbage-collected) until the  is available for collection
p36716
aVIn particular, there is no need (in this case) for the compiler to generate an additional class to handle captured variables; the only thing required is the  instance, so a method can be generated on
p36717
aVThis would be be more complex if the delegate involved local variables (other than )
p36718
aVIn terms of serialization
p36719
aVwell, the first thing I'd say is that serializing delegates is a very very bad idea
p36720
aVHowever,  will walk delegates, and you can (in theory) end up with a serialized , a serialized , and a serialized delegate to link them - but only if you mark  as
p36721
aVBut I stress - this is a bad idea
p36722
aVI rarely use  (for a variety of reasons), but a common question I see by people using it is "why is it trying to serialize (some random type)"
p36723
aVUsually, the answer is "you are publishing an event, and it is trying to serialize the subscriber", in which case the most common fix would be to mark the event's field as
p36724
aVRather than looking at IL; another way to investigate this is to use reflector in
p36725
aVNET 1
p36726
aV0 mode (i
p36727
ag50
aVwithout it swapping in anonymous methods); then you can see:
p36728
aVAs you can see; the thing passed to  is a delegate to a hidden method (called ) on the current instance ()
p36729
aVSo it is the instance to the current  that is passed to the
p36730
as(dp36731
g18
V23354
p36732
stp36733
a((dp36734
g2
(lp36735
VTrying to locate the constructor manually may be hard, but you should still have the one you generated earlier
p36736
aVHave you tried passing it that one
p36737
aVI'll try to do an example
p36738
aVI could add extra code to check the result, but it is easier just to look at  in the debugger, and you can see the fields etc
p36739
aVFor more complex cases - don't forget that you don't need to write the body of a method (the IL) to use it
p36740
aVyou can write all the signatures first (, , etc), and then write all the bodies after, allowing fully cyclic code
p36741
as(dp36742
g18
V23354
p36743
stp36744
a((dp36745
g2
(lp36746
VWhat is the functionality that you want to use winforms for
p36747
aVThere are some things where winforms (via ClickOnce) might be useful - for example, interacting with hardware like a scanner (although this can also be done via OCX if you are using IE, which still doesn't mean that OCX is a good idea ;-p)
p36748
aVIf it is just a moderately complex screen - perhaps it can be done on the web with some tricks like jQuery UI
p36749
aVIf doing it all on a web page is going to be hard, perhaps look at Silverlight (v3)
p36750
aVThis gives you winforms-like levels of control, but in a cross-browser/cross-platform way
p36751
aVIt can also run out-of-browser for that "installed application" feel
p36752
aVIf you do go the winforms route, then at least make it a "smart client" - i
p36753
ag50
aVdo the data access via a web service such as WCF
p36754
aVThen you have the ability to use it remotely through firewalls etc
p36755
aVDon't talk directly to the database etc (from the winform exe) unless you have no other choice
p36756
as(dp36757
g18
V23354
p36758
stp36759
a((dp36760
g2
(lp36761
VWell, you could do something like:
p36762
aVNot sure it is worth it, though - especially given the need to use "count" rather than "end"
p36763
aVProbably easier to write your own extension method
p36764
aVRe your comment; extension methods aren't a
p36765
aVNET 3
p36766
aV5 feature
p36767
aVThey are a C# 3
p36768
aV0 feature
p36769
aVSo as long as you compile the code set to target
p36770
aVNET 2
p36771
aV0 / 3
p36772
aV0 (as appropriate), it doesn't matter if the client doesn't have
p36773
aVNET 3
p36774
aV5; you do, however, need to defined the  - a few lines of code only:
p36775
aVOr just go for broke and download LINQBridge and use all of LINQ-to-Objects in
p36776
aVNET 2
p36777
ag190
as(dp36778
g18
V23354
p36779
stp36780
a((dp36781
g2
(lp36782
VI'm not sure you should expect this to save; you can, however, have a settings file that has a setting (a  in this case) in the user's context, which saves (when you ask it to) via
p36783
as(dp36784
g18
V23354
p36785
stp36786
a((dp36787
g2
(lp36788
VFirst thought; have you enabled transport compression
p36789
aVHow complex is the data
p36790
aVIf it is something that would work with the regular  (i
p36791
ag50
aVa simple object tree), then protobuf-net may be of use
p36792
aVIt is a very efficient binary serialization library with support for WCF via additional attributes on the service contract - for example:
p36793
aV(the  is what swaps in the different serializer for this method)
p36794
aVHowever:
p36795
aVit needs to be able to identify a numeric tag for each property - either via extra attributes, or it can use the  on a  attribute
p36796
aVinheritance (if you are using it) requires extra attributes
p36797
aVit works best if you are using assembly sharing ("mex" doesn't love it
p36798
aVNicely, it also works with MTOM, reducing the base-64 cost for larger messages
p36799
as(dp36800
g18
V23354
p36801
stp36802
a((dp36803
g2
(lp36804
VNo, basically
p36805
aVThe compiler doesn't guarantee that method variables will exist (in their form as written), or with names
p36806
aVIf they were fields (instance or static), then you could use reflection to get the values; but not method variables
p36807
aVFor what you want, perhaps use a dictionary as a substitute
p36808
as(dp36809
g18
V23354
p36810
stp36811
a((dp36812
g2
(lp36813
VWhy would you use recursion here
p36814
aVJust loop; or better, figure out the math to do it in a simple equation
p36815
aVThe fact is that C# doesn't make for excellent deep recursion for things like maths; the tail-call isn't really there at the moment
p36816
aVLoop approach:
p36817
as(dp36818
g18
V23354
p36819
stp36820
a((dp36821
g2
(lp36822
V(remove  if you aren't already in a winform)
p36823
as(dp36824
g18
V23354
p36825
stp36826
a((dp36827
g2
(lp36828
V(not working - I've left this here simply for visibility so other SO users can see what didn't work)
p36829
aVI'd need to check, but I'm fairly certain it follows the usual pattern - so you could also have written  (or if that fails, try it omitting the  from the end)
p36830
aVI seem to recall that there is one minor change to normal here
p36831
aVusually the runtime will respect , but I don't think that WCF handles this - but otherwise, standard type/dll strings should work
p36832
as(dp36833
g18
V23354
p36834
stp36835
a((dp36836
g2
(lp36837
VI suspect you would have to fully parse the SQL
p36838
aVIt might be more complex than you expect, especially if your SQL is rude enough to contain things like:
p36839
aVinternally executing a stored procedure using named parameters; for example  - here only  is needed for your query
p36840
aVhaving a string with  in it -perhaps due to calling  ( is not part of your query)
p36841
as(dp36842
g18
V23354
p36843
stp36844
a((dp36845
g2
(lp36846
VThe problem is that you are thinking in terms of strings
p36847
aVDateTime Format is dd
p36848
aVMM
p36849
aVyyyy
p36850
aVNo, it isn't; the format of a  (when passed as a parameter) is really just a number as binary ;-p ( should be a  - not a )
p36851
aVWhen you are using parameters, you don't include the string tokens () - otherwise you mean "the string ", rather than "the string held in parameter "; try removing them:
p36852
as(dp36853
g18
V23354
p36854
stp36855
a((dp36856
g2
(lp36857
VMartin's answer is excellent
p36858
aVJust to add some additional points
p36859
aVsince you mention
p36860
aVNET, you should note that the CLI/JIT has some differences between x86 and x64, with different optimisations (tail-call, for example), and some subtle different behaviour of advanced things like
p36861
aVThis can all have an impact on your code
p36862
aVAdditionally, not all code works on x64
p36863
aVAnything that uses DirectX or certain COM features may struggle
p36864
aVNot really a performance feature, but important to know
p36865
aV(I removed "DirectX" - I might be talking rubbish there
p36866
aVbut simply: you need to check that anything you depend upon is stable on your target platform)
p36867
as(dp36868
g18
V23354
p36869
stp36870
a((dp36871
g2
(lp36872
VThis is nothing to do with ;  simply doesn't use  (it will use , but you don't want to do that
p36873
aVMost serializers, including  and  (and data-binding, for that matter), treat collections as different to entities
p36874
aVIt can be one or the other, but not both
p36875
aVBecause it detects that it is a "collection", it serializes the contents (i
p36876
ag50
aVwhatever is in the set), not the properties ( etc)
p36877
aVYou should encapsulate a collection, rather than inherit it
p36878
aVAlso; to correctly use , it would be wise to add the / attributes
p36879
aVFor example:
p36880
as(dp36881
g18
V23354
p36882
stp36883
a((dp36884
g2
(lp36885
VSome thoughts;
p36886
aVanybody with Vista will have
p36887
aVNET 3
p36888
aV0 (so WPF) pre-installed
p36889
aVanybody with Windows 7 will have
p36890
aVNET 3
p36891
aV5 SP1 pre-installed
p36892
aVMaybe look at these numbers instead
p36893
aVAlternatively, perhaps consider deploying as Silverlight 3
p36894
aVSimilar to WPF (although cut-down), but cross-platform and cross-browser
p36895
aVAnd a very small download
p36896
aVIf you need more than Silverlight, then you might point users (without the required
p36897
aVNET version) at the "client profile"; a smaller download than "full"
p36898
aVNET
p36899
as(dp36900
g18
V23354
p36901
stp36902
a((dp36903
g2
(lp36904
VYou could write something similar with LINQ, but since "Zip" isn't built in until
p36905
aVNET 4
p36906
aV0 it will be more code than we'd like, and/or not as efficient
p36907
aVI'd be tempted to leave it "as is", but I'd probably check  to avoid an out-of-range exception
p36908
aVPerhaps I'd make an extension method, though:
p36909
aVThen you can use:
p36910
as(dp36911
g18
V23354
p36912
stp36913
a((dp36914
g2
(lp36915
VAs I understand it, the aim here is to make it hard for people to do the wrong thing (sync
p36916
aVIO from the UI)
p36917
aVIf you are using the WCF classes, you'll probably have to live with it
p36918
as(dp36919
g18
V23354
p36920
stp36921
a((dp36922
g2
(lp36923
VAn array is a pointer to a fixed sized, random-access chunk of data
p36924
aVThe caller can update values, access values in any order etc
p36925
aVAn iterator is a key to a sequence of values (which could be infinite in length)
p36926
aVThe caller can only access them in the order supplied by the source, and cannot update them
p36927
aVThere is more overhead accessing each value in a sequence, but it has the advantage of not needing all the data at once, so can be more efficient for mid-to-long sequences
p36928
as(dp36929
g18
V23354
p36930
stp36931
a((dp36932
g2
(lp36933
VThere is an overload that accepts arguments as a :
p36934
aVWould this do
p36935
aVAlternative, you can use reflection to find the correct constructor:
p36936
as(dp36937
g18
V23354
p36938
stp36939
a((dp36940
g2
(lp36941
VNo, not as far as I know
p36942
aVI needed this recently - I just copied from the C# spec documents
p36943
aVAlso; note that some are contextual keywords ;-p
p36944
as(dp36945
g18
V23354
p36946
stp36947
a((dp36948
g2
(lp36949
VIf it didn't, I would expect it to throw an exception
p36950
aVSo do nothing; it will tell you if there is a problem
p36951
aVBut you should be "" it:
p36952
as(dp36953
g18
V23354
p36954
stp36955
a((dp36956
g2
(lp36957
VTypically, you need a sub-query for this scenario; here's a simplified example:
p36958
as(dp36959
g18
V23354
p36960
stp36961
a((dp36962
g2
(lp36963
VSince you don't mention a language, some C#:
p36964
aV(the exact regex patten would depend on what you consider a match
p36965
aVone word
p36966
aVanything
p36967
aVetc
p36968
as(dp36969
g18
V23354
p36970
stp36971
a((dp36972
g2
(lp36973
VSet the  for the row:
p36974
as(dp36975
g18
V23354
p36976
stp36977
a((dp36978
g2
(lp36979
VI'd question the wisdom, but perhaps:
p36980
aV(using  to emulate  if needed) - but you need to watch to return -1 if not found
p36981
aVso perhaps just do it the long way
p36982
as(dp36983
g18
V23354
p36984
stp36985
a((dp36986
g2
(lp36987
VIf you need them as groups:
p36988
aVIf you just need them ordered as though they are grouped:
p36989
as(dp36990
g18
V23354
p36991
stp36992
a((dp36993
g2
(lp36994
VRe the out-of-memory / 2GB; individual
p36995
aVNET objects (such as the  behind a ) are limited to 2GB
p36996
aVPerhaps try writing to a  instead
p36997
aV(edit: nope: tried that, still errors)
p36998
aVI also wonder if you may get better results (in this case) using , perhaps with compression such as GZIP if space is a premium
p36999
as(dp37000
g18
V23354
p37001
stp37002
a((dp37003
g2
(lp37004
VTo do that, you need to use reflection;
p37005
aVwhere  is  if it is a static method,  for the current instance (in which case you can also use  instead of ), or the target object otherwise
p37006
as(dp37007
g18
V23354
p37008
stp37009
a((dp37010
g2
(lp37011
VIf you are talking about a string  clause (rather than building the expression etc yourself) - then the Dynamic LINQ Library (in the 3
p37012
aV5 samples, IIRC) should suffice
p37013
aVNote that the example below is for database usage; but you can use it with LINQ-to-Objects by calling  on your in-memory data
p37014
as(dp37015
g18
V23354
p37016
stp37017
a((dp37018
g2
(lp37019
VYes, you can use Visual Studio 6
p37020
aV0 side-by side with VS2008
p37021
aVI use this for maintenance of old VB6 code
p37022
aVIt is safest to install v6 first, which is what you have done
p37023
aVSo install VS2008 and enjoy
p37024
as(dp37025
g18
V23354
p37026
stp37027
a((dp37028
g2
(lp37029
VReflection is an option, but 200 properties is
p37030
aVa lot
p37031
aVAs it happens, I'm working on something like this at the moment, but the classes are created by code-gen
p37032
aVTo fit "by name" usage, I've added an indexer (during the code generation phase):
p37033
aVThis gives the convenience of "by name", but good performance
p37034
as(dp37035
g18
V23354
p37036
stp37037
a((dp37038
g2
(lp37039
V"Realio-trulio" immutability involves the constructor
p37040
aVPopsicle immutability is where you can do, for example:
p37041
aV(or the same with an object initializer)
p37042
aVThis fits  quite well, as long as you handle to on-serialized callback to do the
p37043
aVdoesn't do serialization callbacks, so is more work
p37044
aVEither would suit if you use custom serialization (), though
p37045
aVLikewise, custom serialization is broadly doable with realio-trulio immutability, but is painful - and it is a bit of a lie, as it is "create once, then call interface method" - so not really properly immutable
p37046
aVFor true immutability, use a DTO
p37047
as(dp37048
g18
V23354
p37049
stp37050
a((dp37051
g2
(lp37052
VTry adding:
p37053
aVThere are a number of patterns recognised by parts of the framework
p37054
aVFor info,  also looks for
p37055
aVFull example (also switching to ):
p37056
aVMore information on ShouldSerialize* on MSDN
p37057
as(dp37058
g18
V23354
p37059
stp37060
a((dp37061
g2
(lp37062
VI'm not 100% sure I understand the scenario you want to model; however,  only looks one level of inheritance away
p37063
aVIf I understand correctly, try the following; note that you would need to know the potential generic types at compile time at the moment:
p37064
as(dp37065
g18
V23354
p37066
stp37067
a((dp37068
g2
(lp37069
VEF is precious about this (although LINQ-to-SQL would let you do it); just add an explicit :
p37070
aV(or order by name, or whatever else makes sense)
p37071
as(dp37072
g18
V23354
p37073
stp37074
a((dp37075
g2
(lp37076
VI would probably use a dictionary rather than a list:
p37077
aVIf you are talking about properties of an object, it will be trickier, but still doable
p37078
as(dp37079
g18
V23354
p37080
stp37081
a((dp37082
g2
(lp37083
VWhich serialization API
p37084
aVFor example,  can handle dictionaries, especially with the (optional)  markup
p37085
aVprotobuf-net will handle them (below)
p37086
aVOthers may not
p37087
aVAs will :
p37088
as(dp37089
g18
V23354
p37090
stp37091
a((dp37092
g2
(lp37093
VAs others have said, serialization may be the key here (assuming you don't want to use ORM to store the properties as columns in a table, which seems much more direct)
p37094
aVSome caveats though; a database is:
p37095
aVlong term storage
p37096
aVnot related to your
p37097
aVNET code
p37098
aVAs such, you do not want to use any serialization technique that is platform-specific or version-specific
p37099
aVYou will often see people mention  for persistance, but this falls into both of the above traps
p37100
aVYou would be scuppered if you ever changed platform, or even if you just change some properties
p37101
aVYou need an implementation-independent approach; the simplest (which also retains the ability to be human readable) is xml or json, perhaps via  or Json
p37102
aVNET (stored in a )
p37103
aVIf you don't care about human readable, "protocol buffers" (fast/binary) would do well (stored in a ), and is available for most platforms (including C#/
p37104
aVNET/etc)
p37105
as(dp37106
g18
V23354
p37107
stp37108
a((dp37109
g2
(lp37110
VIt really depends on the implementation
p37111
aVIn most cases, it is assumed (as a matter of common practice / courtesy) that a property is inexpensive
p37112
aVHowever, it could that each "get" does a non-cached search over some remote resource
p37113
aVFor standard, simple properties, you'll never notice a real difference between the two
p37114
aVFor the worst-case, fetch-once, store and re-use will be much faster
p37115
aVI'd be tempted to use  twice until I know there is a problem
p37116
aV"premature optimisation", etc
p37117
aVBut; if I was using it in a tight loop, then I might store it in a variable
p37118
aVExcept for  on an array, which has special JIT treatment ;-p
p37119
as(dp37120
g18
V23354
p37121
stp37122
a((dp37123
g2
(lp37124
VWell, rather than , I'd be tempted to use a , in case it is big
p37125
aVbut in the general case there are serialization APIs for this
p37126
aVI'd mention my own, but I think people get bored of hearing it
p37127
aVIMO,  looks more like a  (than a ) to me, btw
p37128
as(dp37129
g18
V23354
p37130
stp37131
a((dp37132
g2
(lp37133
VI know this got at least two blog posts on the weekend - mine and Ayende's
p37134
aVFor most code, this should be treated merely as a curiosity
p37135
aVI think it would be an abuse to use this for dependency injection, when established IoC/DI frameworks can do the job so much better, and so simply
p37136
aVIn particular, this approach relies on the escape hatch of 17
p37137
aV5, a Microsoft-specific extension to the spec
p37138
aVdo you want your code to run on Mono
p37139
aVI haven't tried it, but there is no specific  reason that it should compile under gmcs / dmcs
p37140
aVJon had a better example of using it in concrete code - for deliberately mocking COM, but that was for toying with
p37141
aVNET 4
p37142
aV0 /
p37143
aVAgain; this wouldn't apply to most "regular" code
p37144
aVSo no; don't do it - it is just a fun aside
p37145
as(dp37146
g18
V23354
p37147
stp37148
a((dp37149
g2
(lp37150
VAssuming you mean winforms, something like:
p37151
aV(in particular,  should give you the  and  - useful for ids, etc)
p37152
as(dp37153
g18
V23354
p37154
stp37155
a((dp37156
g2
(lp37157
VTo enforce that type of thing, you'll need multiple types (to restrict what is available from which context) - or at the least a few interfaces:
p37158
as(dp37159
g18
V23354
p37160
stp37161
a((dp37162
g2
(lp37163
VWhat exactly do you mean by "extend"
p37164
aVinheritance
p37165
aVextension methods
p37166
aVPersonally, I'd use a partial class (in the same namespace, but a different file to the codegen) to expose this as a property:
p37167
aVThis directly binds  as a regular property on the  instance
p37168
aVAs a property, it can participate in data-binding (unlike extension methods, which can't)
p37169
aVIf you had to do "option 2" (perhaps you don't have access to the DAL dll), then an extension method would be appropriate:
p37170
as(dp37171
g18
V23354
p37172
stp37173
a((dp37174
g2
(lp37175
VIf you use ClickOnce deployment, this is all handled for you (at least, in VS2008 SP1); simply:
p37176
aVProject Properties
p37177
aVPublish
p37178
aVOptions
p37179
aVFile Associatons
p37180
aV(add whatever you need)
p37181
aV(note that it must be full-trust, target
p37182
aVNET 3
p37183
aV5, and be set for offline usage)
p37184
aVSee also MSDN: How to: Create File Associations For a ClickOnce Application
p37185
as(dp37186
g18
V23354
p37187
stp37188
a((dp37189
g2
(lp37190
VThe default icon is embedded in the winforms dll - looking at reflector () it is:
p37191
aVThere is no magic in there that checks another common location, so you can't do it without changing code
p37192
aVYou could always embrace the forces of darkness with field-based reflection
p37193
aVNote: this is hacky and brittle
p37194
aVOn your own head
p37195
aVBut it works:
p37196
aVTo do it properly; two common options;
p37197
aVa base  class which has the icon set
p37198
aVa factory  method - perhaps something like:
p37199
aVcode:
p37200
aVThen instead of:
p37201
aVSomething like:
p37202
aVOf course - that isn't much prettier
p37203
aVAnother option might be a C# 3
p37204
aV0 extension method, perhaps as a fluent API:
p37205
aVand
p37206
aVThis is then just a  away from your existing code
p37207
as(dp37208
g18
V23354
p37209
stp37210
a((dp37211
g2
(lp37212
VYou don't actually need anything special here
p37213
aVsince protobuf-net respects inheritance
p37214
aVIf you have:
p37215
aVthen it will work
p37216
aVTo serialize the data, it always starts at the base (contract) type; so even if you did  the first thing it will do is detect that it has a base class that is a contract, and switch to
p37217
aVDuring deserialization it will identify the correct derived (concrete) type and use that, so you can use  with  too, and it will construct a  or  depending on what the original data was
p37218
aVThus the following are largely identical:
p37219
aVand
p37220
aVThe main difference here is how the variables are typed
p37221
as(dp37222
g18
V23354
p37223
stp37224
a((dp37225
g2
(lp37226
VI wonder if you shouldn't put it in the MSBuild path:
p37227
aVFor example, this project is consumed via:
p37228
aVand installs itself into:
p37229
aVSo perhaps define your own specific sub-folder, and use from there
p37230
aVetc
p37231
aVBecause the  variable is defined separately you shouldn't have as much difficulty with it
p37232
aVMaybe
p37233
as(dp37234
g18
V23354
p37235
stp37236
a((dp37237
g2
(lp37238
VI don't have anything to hand, but it isn't hugely difficult to knock one up
p37239
aVthe biggest gotcha is the issue of not unloading the dlls
p37240
aVbut a crude example:
p37241
aV(this uses the string , but a  works virtually identically - just change about 3 lines)
p37242
as(dp37243
g18
V23354
p37244
stp37245
a((dp37246
g2
(lp37247
VIs there anything else that you aren't showing on the control
p37248
aVIn particular; you inherit from  - I assume you give it the data-context (or some related object) at some point
p37249
aVI would personally have no expectation that  should serialize
p37250
aVIt isn't  nor , for starters
p37251
aVAdditionally it has lots of events
p37252
aVand events are rarely the friend of serialization (when using , at least)
p37253
aVUltimately, you should serialize state; but  isn't state - it is (more-or-less) part of the UI implementation
p37254
aVJust attempting to serialize a vanilla  is enough to cause an exception
p37255
aVIn short; I don't think that you should be including this control in the scope of , perhaps marking the field to your control as
p37256
as(dp37257
g18
V23354
p37258
stp37259
a((dp37260
g2
(lp37261
VIf you are actually changing type (rather than casting) - then if you have only a few classes, then just write conversion code - perhaps a ctor for  that accepts a template
p37262
aVIf you have a lot of classes
p37263
aVthere are tricks you can do with either dynamic code or serialization
p37264
aVin MiscUtil will do this, for example (using a dynamic  to do the work very quickly):
p37265
as(dp37266
g18
V23354
p37267
stp37268
a((dp37269
g2
(lp37270
VFirstly - if you you access a dictionary in this way, then you aren't using it as a dictionary - have you tried:
p37271
aV(note that if you are using , you'll probably want a  or  in there somewhere)
p37272
aVOtherwise:
p37273
aVThe  in  (and hence also for  after calling the  extension method) for a  is  - so you should be able to use  or something similar
p37274
as(dp37275
g18
V23354
p37276
stp37277
a((dp37278
g2
(lp37279
VA simple one
p37280
as(dp37281
g18
V23354
p37282
stp37283
a((dp37284
g2
(lp37285
VTo do this properly, you need to walk the assemblies, picking up the dependencies
p37286
aVif your exe needs Dll_A, and Dll_A needs Dll_B (even if the exe doesn't reference it), then your exe also needs Dll_B
p37287
aVYou can query this (on any assembly) via reflection; it takes a little work (especially to guard against circular references, which do happen; here's an example that starts at the "entry assembly", but this could just as easily be any assembly:
p37288
as(dp37289
g18
V23354
p37290
stp37291
a((dp37292
g2
(lp37293
VIn
p37294
aVNET 3
p37295
aV5 you can use :
p37296
aVOr if you want an open delegate (i
p37297
ag50
aVto any  instance, not bound to the new one):
p37298
aVHowever; note that you'd have to use these delegates via , which is much slower than using a fully typed delegate via
p37299
aVAnother option (for this scenario) is to bind to a delegate that takes , and use casting inside the delegate - via perhaps some fancy generics, a compiled , or custom IL
p37300
as(dp37301
g18
V23354
p37302
stp37303
a((dp37304
g2
(lp37305
VAre you swallowing an exception
p37306
aVWhen I try this I get (when setting ) an :
p37307
aVItems collection cannot be modified when the DataSource property is set
p37308
aVIMO, sort the list first - and bind to that; however, a quick test shows that setting  before setting the  works too - i
p37309
ag50
as(dp37310
g18
V23354
p37311
stp37312
a((dp37313
g2
(lp37314
VThere is an overload that accepts an object state - however, IMO the easiest way to pass arbitrary arguments to a threadstart (and verify the signature at compile time) is with an anonymous method:
p37315
aVJust (and this is important) - *don't change  or  after this, as the change will be reflected to the thread (as a race) - i
p37316
ag50
aVdon't do:
p37317
aVIn the case of loops, it is important (when dealing with async and captured variables) to introduce extra variables for this; these are very different
p37318
aV(which will probably print 5,5,5,5,5)
p37319
aV(which will print 1-5 in no particular order)
p37320
aVUpdate to discuss Meeh's point (comments); what does this print (99
p37321
aV999% of the time - there is a race condition)
p37322
as(dp37323
g18
V23354
p37324
stp37325
a((dp37326
g2
(lp37327
VFor enumerating jagged arrays,  (LINQ) is your friend:
p37328
aVOr in query syntax:
p37329
as(dp37330
g18
V23354
p37331
stp37332
a((dp37333
g2
(lp37334
VI quite like XSLT, but the fact is that a lot of people find it awkward
p37335
aVAdditionally, 1
p37336
aV0 has a lot of annoyances (no case-insensitive / regex), and 2
p37337
aV0 is poorly supported and tool too long to arrive
p37338
aVAt one point it was quite popular as a tool to transform xml (as a model) to (for example) a web page - but tools have improved - see the V in ASP
p37339
aVNET MVC as just one example (the tooling for other platforms is better too) - or LINQ-to-XML
p37340
aVXSLT 1
p37341
aV0 will remain a handy tool in my bag, but I don't think I'm going to invest learning 2
p37342
aV0 unless I absolutely have to
p37343
as(dp37344
g18
V23354
p37345
stp37346
a((dp37347
g2
(lp37348
VThe page instance that hosts the fields lives as the server and is discarded at the end of the request
p37349
aVWeb servers tend to be largely stateless, after all - allowing clustering etc
p37350
aVThe next request will create a new page instance (perhaps on a different machine, perhaps in a new  if it has recycled)
p37351
aVTo keep the values between requests, you need to put them into session, and fetch them back yourself - or send them to the client in the request (and bring them back again)
p37352
as(dp37353
g18
V23354
p37354
stp37355
a((dp37356
g2
(lp37357
VThe text
p37358
aVis the way that generics are written under the bonnet - meaning "List with 1 generic type arg, aka "
p37359
aVIf you have a , you should be set; this will be the closed generic
p37360
aVIs it that you want to find the  given just this
p37361
aVIf so, this is discussed in various questions, including this one; to duplicate the key bit (I prefer to code against , since it handles a few edge-cases such as inheriting from ):
p37362
as(dp37363
g18
V23354
p37364
stp37365
a((dp37366
g2
(lp37367
VI guess it is the safest of two evils
p37368
aVOften buttons process data; this way around, if you do nothing the default is that your data is validated, and it will be pretty obvious (since it doesn't work) if you didn't actually want it validating
p37369
aVContrast to the alternative - you do nothing, and your button silently works successfully performing actions on invalid data, and you don't notice because it is subtle
p37370
aVThe first is probably safer, even if it does cause a little irritation
p37371
as(dp37372
g18
V23354
p37373
stp37374
a((dp37375
g2
(lp37376
VTeam System Database Edition is available as a separate sku - you don't need the full "Team Suite" to access "data dude", but you will have to pay for it
p37377
aVThe full comparison chart (which feature is in which edition) is here
p37378
as(dp37379
g18
V23354
p37380
stp37381
a((dp37382
g2
(lp37383
VNo, I don't think so
p37384
aVTo get that I think you'd pretty-much have to be using an
p37385
as(dp37386
g18
V23354
p37387
stp37388
a((dp37389
g2
(lp37390
VTo show the property connection, right-click on the property; "show as association" or "show as collection association" (as appropriate)
p37391
as(dp37392
g18
V23354
p37393
stp37394
a((dp37395
g2
(lp37396
VWell, the inherent problem with a BLOB is that it
p37397
aVisn't text
p37398
aVIt is binary
p37399
aVIt could be an image (jpg etc), an exe, or it could be text
p37400
aVbut in which encoding
p37401
aVUTF8
p37402
aVNot simple
p37403
aVIf it was a CLOB I'd hope it works OK - but otherwise I would fully anticipate that you'd have to parse the BLOB manually, otherwise how would it be interpreted
p37404
aVFor an arbitrary BLOB, the closest I can think of is to just show something like the hex
p37405
aVbut with  even that is a challenge
p37406
aVYou could do it for a class via a
p37407
as(dp37408
g18
V23354
p37409
stp37410
a((dp37411
g2
(lp37412
VThe problems that EF etc are solving is different, and relates to tihngs like lazy loading, etc
p37413
aVI'm simply not sure that the level of complexity that dynamic subclassing requires is worth it for this scenario
p37414
aVA few thoughts, though:
p37415
aVhave a property bag in your object for flexible additional properties; if necessary the property-bag can be exposed to data-binding APIs via
p37416
aVsimply wrap your object in an implementation-specific tuple that contains the existing object and the additional properties (no subclassing)
p37417
aVIt is a shame that C# doesn't support "mixins", which would also be a nice way of implementing this type of thing with interfaces
p37418
as(dp37419
g18
V23354
p37420
stp37421
a((dp37422
g2
(lp37423
VThere are 4 schools of thought here:
p37424
aVedit it manually
p37425
aVlive with it
p37426
aVchange the class template (or export a second class template)
p37427
aVcreate the file outside the sub-directory, then drag it in
p37428
aVI tend to use the 4th; it is quicker than editing, and less hassle than changing the templates
p37429
as(dp37430
g18
V23354
p37431
stp37432
a((dp37433
g2
(lp37434
VI know LINQ was tagged, but just for completeness; if LINQ isn't an option;
p37435
as(dp37436
g18
V23354
p37437
stp37438
a((dp37439
g2
(lp37440
VIs it just a typo between  and
p37441
ag412
ag50
aVYou never seem to start , after all
p37442
as(dp37443
g18
V23354
p37444
stp37445
a((dp37446
g2
(lp37447
VHow about:
p37448
aVFor large documents it might trigger infinite recursion detection - in which case I'd try to look at something involving , and in each case only go forward as far as the next silence or EOF (if you see what I mean)
p37449
aVLet me know if you want a refactored version to show this
p37450
as(dp37451
g18
V23354
p37452
stp37453
a((dp37454
g2
(lp37455
VReplacement answer following clarification in comments:
p37456
aVFor successively building additional filters, you don't need expression trees; you can call  multiple times (as necessary, once per search term) - for example:
p37457
aVThe only thing to watch is the "capture" issue; be sure not to re-use any of the ,  etc - otherwise the last value will apply to earlier filters
p37458
aVFor an example of delegate combination (from comments) - note that I've dropped the  aspect here purely to make the example shorter (it will work identically):
p37459
aV(original answer)
p37460
aVActually, that variant of LINQ won't use an expression tree
p37461
aVit will use a delegate; but you can build the tree and compile it if you really want
p37462
aVI'm not sure why you would, though
p37463
aVWhat do you want to do
p37464
aVI'll knock up an example
p37465
aVHere you go; this uses an expression tree, but I can't think of a single good reason to do this, other than to prove that you can
p37466
as(dp37467
g18
V23354
p37468
stp37469
a((dp37470
g2
(lp37471
VSince you mention , it sounds like it implements
p37472
aVIn which case, if you are using C# 3
p37473
aV0 / LINQ, something like:
p37474
aVYou might also look at dictionaries if you have a lot of data
p37475
as(dp37476
g18
V23354
p37477
stp37478
a((dp37479
g2
(lp37480
VStatic events are actually quite dangerous, and (fortunately) also quite rare
p37481
aVAs with anything static, you would use it when it applies to the type generally, not any specific instance
p37482
aVAnd even then, you might see it on a singleton instance rather than as a static event
p37483
aVThe danger is that it is ludicrously easy to forget to unsubscribe, and end up keeping masses of objects alive forever; contrast to most instance-based events - usually, the instance will go out-of-scope eventually, making the delegates collectable (a delegate instance will keep a target instance alive)
p37484
as(dp37485
g18
V23354
p37486
stp37487
a((dp37488
g2
(lp37489
VWell, are you seeing any problems
p37490
aVThe regular WSE classes (thru to WSE3
p37491
aV0) are still in the framework, and are unlikely to be dropped any time soon; you can add new WSE services in VS2008 via "Add Service Reference", "Advanced", "Add Web Reference" (this is a
p37492
aVNET 2
p37493
aV0 web-service client)
p37494
aVThere may be some minor differences between the 2
p37495
aV0 web-service reference and the 1
p37496
aV1 equivalent, but you should be OK
p37497
aVIn general though - the trend seems to be to move to WCF (
p37498
aVNET 3
p37499
aV0 and above) web-services
p37500
aVThat doesn't mean that you have to suddenly change everything; indeed, there is a reasonable amount of ability to use WSE clients against WCF servers and WCF clients against WSE servers (but you need to plan for it in advance)
p37501
as(dp37502
g18
V23354
p37503
stp37504
a((dp37505
g2
(lp37506
VSince you are starting from , the easiest way to get the type is from the property:
p37507
aVOr do you mean you want to find the
p37508
as(dp37509
g18
V23354
p37510
stp37511
a((dp37512
g2
(lp37513
VTry:
p37514
aVYour hash-code must match equality (or at least, not contradict it); and your equality says "nulls are equal, otherwise compare the guid"
p37515
aVInternally, I expect  uses a , which explains why getting  right is so important
p37516
aVHere's my test rig (using the above ) which works fine:
p37517
aVIf your version doesn't work, you're going to have to post something about how you're using it, as it works fine for me (above)
p37518
as(dp37519
g18
V23354
p37520
stp37521
a((dp37522
g2
(lp37523
VYes, you can set  on members of //etc types
p37524
aVAs other replies have noted, external code won't be able to see the properties unless it can see the type - but there are lots of nuances:
p37525
aVif the member is on an interface it will be (essentially) part of the public API
p37526
aVthe member might be a public override of a virtual/abstract member - in which case it will truly be publicly visible, but via the base-class (again, similar to interfaces)
p37527
aVBut there is a lot of other code in the framework that uses reflection and demands public accessibility:
p37528
aVdata binding usually works on the public properties
p37529
aVsecurity checks for partial-trust can be fussy about public members
p37530
aVserialization (for example ) may want public members
p37531
aVetc
p37532
aVSo there are still lots of reasons to think about  rather than just , even if your code is only referenced by the local assembly
p37533
as(dp37534
g18
V23354
p37535
stp37536
a((dp37537
g2
(lp37538
VFor info, string concatenation is expensive
p37539
aVIt looks (from the  and from the results) like you should really be using a ; some rough pseudo-code (in C#, but trivial to translate to VB
p37540
aVNet):
p37541
as(dp37542
g18
V23354
p37543
stp37544
a((dp37545
g2
(lp37546
VAre you sure it is a space
p37547
ag412
ag50
aVthe same whitespace character that you are passing as the second argument
p37548
aVThe code you've posted works fine for me on SQL Server 2008
p37549
aVRe working on your friends PC - perhaps the whitespace got normalized when you sent it to him
p37550
as(dp37551
g18
V23354
p37552
stp37553
a((dp37554
g2
(lp37555
VHow about the following, which works both for anonymous types (the example below), or regular types (domain entities, etc):
p37556
aVusing:
p37557
as(dp37558
g18
V23354
p37559
stp37560
a((dp37561
g2
(lp37562
VIt would be better to enforce the  signature as early as possible - i
p37563
ag50
aVas an
p37564
aVwith either:
p37565
aVor:
p37566
aVOf course, delegate usage () might work just as well in many scenarios
p37567
as(dp37568
g18
V23354
p37569
stp37570
a((dp37571
g2
(lp37572
VWell, what is  here
p37573
aVIn particular, is it a local variable
p37574
aVThere are some scope / capture issues, which mean that it may be desirable to use a second variable copy, just for the query:
p37575
aVAlso; if this is LINQ-to-SQL, then in the current version you get a slightly better behaviour if you use the form:
p37576
as(dp37577
g18
V23354
p37578
stp37579
a((dp37580
g2
(lp37581
VI've heard very good things about IronPython for exactly this type of scenario
p37582
aVI'd certainly risk spending a few hours on a quick proof-of-concept, to see how it pans out
p37583
aVMichael Foord will happily wax lyrical about the success of IronPython in similar cases (most specifically for him, for spreadsheet savvy users), and his book covers (IIRC) a few pointers about hosting it from
p37584
aVNET
p37585
as(dp37586
g18
V23354
p37587
stp37588
a((dp37589
g2
(lp37590
VWell, a substring of the 4-12 rule really just makes it a 1-12 rule, so how about:
p37591
as(dp37592
g18
V23354
p37593
stp37594
a((dp37595
g2
(lp37596
VExposing a  as a property isn't actually the root of all evil; especially if it allows expected usage such as
p37597
aVYou could write a cast-safe alternative to :
p37598
aVBut your biggest problem at the moment is thread safety
p37599
aVAs a static member, you might have big problems here, especially if it is in something like ASP
p37600
aVNET
p37601
aVEven  over an existing list would suffer from this:
p37602
aVSo simply wrapping with  is not enough to make your object thread-safe; it merely protects against the consumer adding data (but they could still be enumerating it while your other thread adds data, unless you synchronize or make copies)
p37603
as(dp37604
g18
V23354
p37605
stp37606
a((dp37607
g2
(lp37608
VHe is both right and wrong at the same time
p37609
aVWith things like , this is a non-issue; the serialized stream contains full type metadata, so if you have:
p37610
aVand serialize , then it includes "I'm a " in the stream
p37611
aVThis makes life simple, but is verbose, especially when repeated
p37612
aVIt is also brittle, as it demands the same implementation when deserializing; bad for either different client/server implementations, or for long-term storage
p37613
aVWith  (which I guess the blog is talking about), there is no metadata - but the element names (or the  attributes) are used to help identify which is used
p37614
aVFor this to work, the serializer needs to know in advance what names map to which types
p37615
aVThe simplest way to do this is to decorate the base-class with the subclasses we know about
p37616
aVThe serializer can then inspect each of these (and any additional xml-specific attributes) to figure out that when it sees a  element, that maps to a  instance (note that the names don't need to match, so it can't just look for it by name)
p37617
aVHowever, if he is a purist (or the data isn't available), then there is an alternative; you can specify all this data separately via the overloaded constructor to
p37618
aVFor example, you might lookup the set of known subtypes from configuration (or maybe an IoC container), and setup the constructor manually
p37619
aVThis isn't very tricky, but it is tricky enough that it isn't worth it unless you actually need it
p37620
aVAdditionally, with  if you go the custom ctor route, it is important to cache and re-use the  instance; otherwise a new dynamic assembly is loaded per usage - very expensive (they can't be unloaded)
p37621
aVIf you use the simple constructor it caches and re-uses the model, so only a single model is used
p37622
aVYAGNI dictates that we should choose the simplest option; using  removes the need for a complex constructor, and removes the need to worry about caching the serializer
p37623
aVThe other option is there and is fully supported, though
p37624
aVRe your follow-up questions:
p37625
aVBy "factory pattern", he's talking about the case where your code doesn't know about , perhaps due to IoC/DI or similar frameworks; so you might have:
p37626
aVWhich figures out the appropriate  concrete implementation, instantiates it and hands it back
p37627
aVObviously, if our code doesn't know about the concrete types (because they are only specified in a config file), then we can't use ; but we can parse the config data and use the ctor approach (as above)
p37628
aVIn reality, most times  is used with POCO/DTO entities, so this is an artificial concern
p37629
aVAnd re interfaces; same thing, but more flexible (an interface doesn't demand a type hierarchy)
p37630
aVBut  doesn't support this model
p37631
aVFrankly, tough; that isn't its job
p37632
aVIts job is to allow you to store and transport data
p37633
aVNot implementation
p37634
aVAny xml-schema generated entities won't have methods
p37635
aVData is concrete, not abstract
p37636
aVAs long as you think "DTO", the interface debate is a non-issue
p37637
aVPeople who are vexed by not being able to use interfaces on their boundary haven't embraced separation of concerns, i
p37638
ag50
aVthey are trying to do:
p37639
aVrather than the less restrictive
p37640
aVNow, in many (most
p37641
aVcases the DTO and entities can be the same; but if you are trying to do something that the transport doesn't like, introduce a DTO; don't fight the serializer
p37642
aVThe same logic applies when people are struggling to write their object:
p37643
aVas xml of the form:
p37644
aVIf you want this, intoduce a DTO that corresponds to the transport, and map between your entity and the DTO:
p37645
aVThis also applies to all those other niggles like:
p37646
aVwhy do I need a parameterless constructor
p37647
aVwhy do I need a setter for my collection properties
p37648
aVwhy can't I use an immutable type
p37649
aVwhy must my type be public
p37650
aVhow do I handle complex versioning
p37651
aVhow do I handle different clients with different data layouts
p37652
aVwhy can't I use interfaces
p37653
aVetc, etc
p37654
aVYou don't always have these problems; but if you do - introduce a DTO (or several) and your problems go away
p37655
aVTaking this back to the question about interfaces; the DTO types might not be interface-based, but your runtime/business types can be
p37656
as(dp37657
g18
V23354
p37658
stp37659
a((dp37660
g2
(lp37661
VThe number of lines don't matter; the IL will be identical if the code is equivalent (your's isn't)
p37662
aVAnd actually, unless we know what  returns, we can't answer properly - since by casting to  you might be introducing a "box" operation, and you might be changing a conversion operation (or perhaps a passive no-op cast) into an active double-cast (cast to , cast to )
p37663
aVFor now, I'll assume that  returns , for simplicity
p37664
aVIf you'd used , we'd know at a glance that your code wasn't changing the type (box / cast / etc):
p37665
aVIn release mode (with optimize enabled) the compiler will remove most variables that are set and then used immediately
p37666
aVThe biggest difference between the two lines above is that the second version doesn't create and discard  and
p37667
aVBut if you hadn't have done that, the code would have been equivalent (again, assuming that  returns ):
p37668
aVSome subtleties exist if you re-use the variable (in which case it can't necessarily be removed by the compiler), and if that variable is "captured" by a lambda/anon-method, or used in a /
p37669
aVAnd some more subtleties for some math scenarios if the compiler/JIT chooses to do an operation purely in the registers without copying it back down to a variable (the registers have different (greater) width, even for "fixed-size" math like )
p37670
as(dp37671
g18
V23354
p37672
stp37673
a((dp37674
g2
(lp37675
VJust for completeness, you could also use option D:
p37676
aV(where  is "to keep running")
p37677
aVthe condition in a  loop doesn't have to involve
p37678
aVUnusual, though, but quite cute - only evaluates before work, though
p37679
as(dp37680
g18
V23354
p37681
stp37682
a((dp37683
g2
(lp37684
VYou are opening it twice; lose all the  stuff completely, and use  around :
p37685
aVAlso; do you really mean
p37686
as(dp37687
g18
V23354
p37688
stp37689
a((dp37690
g2
(lp37691
VSomething like:
p37692
aVOr as xPath (perhaps in ):
p37693
as(dp37694
g18
V23354
p37695
stp37696
a((dp37697
g2
(lp37698
VYou are after the 4 successive 8-bit chunks from a 32-bit integer; so a combination of masking and shifting:
p37699
as(dp37700
g18
V23354
p37701
stp37702
a((dp37703
g2
(lp37704
VI wonder if you're suffering from an overly large set of data accumulating in the data-context, making it slow to resolve rows against the internal identity cache (which is checked once during the , and for "misses" I would expect to see a second hit when the entity is materialized)
p37705
aVI can't recall 100% whether the short-circuit works for  (although it will in
p37706
aVNET 4
p37707
aV0)
p37708
aVI would try ditching the data-context (submit-changes and replace with an empty one) every n operations for some n - maybe 250 or something
p37709
aVGiven that you're calling  per isntance at the moment, you may also be wasting a lot of time checking the delta - pointless if you've only changed one row
p37710
aVOnly call  in batches; not per record
p37711
as(dp37712
g18
V23354
p37713
stp37714
a((dp37715
g2
(lp37716
VBy far the best explanation of this (that I've seen) is Jon Skeet's book - and that chapter is free
p37717
aVChapter 6, C# in Depth
p37718
aVThere is nothing I can add here that isn't covered
p37719
aVThen buy the book; you will be a better C# programmer for it
p37720
aVQ: Why didn't I write a longer answer here (paraphrased from comments); simple
p37721
aVAs Eric Lippert observes (here), the  construct (and the magic that goes behind it) is the single most complex bit of code in the C# compiler, and to try and describe it in a brief reply here is nave at best
p37722
aVThere are so many nuances to  that IMO it is better to refer to a pre-existing (and fully qualified) resource
p37723
aVEric's blog now has 7 entries (and that is just the recent ones) discussing
p37724
aVI have a vast amount of respect for Eric, but his blog is probably more appropriate as a "further information" for people who are comfortable with the subject ( in this case), as it typically describes a lot of the background design considerations
p37725
aVBest done in the context of a reasonable foundation
p37726
aV(and yes, chapter 6 does download; I verified
p37727
as(dp37728
g18
V23354
p37729
stp37730
a((dp37731
g2
(lp37732
VWell, one intriguing approach is that you could use  () to iterate over the name/value pairs, using a  on the name to handle each in turn
p37733
aVThe implementation seems a bit non-standard, though; from the example here:
p37734
aVBut it looks like you can also use :
p37735
as(dp37736
g18
V23354
p37737
stp37738
a((dp37739
g2
(lp37740
VWCF (and  in particular) doesn't use constructors
p37741
aVNo, really (it uses  to create raw objects)
p37742
aVIt is expected that all data will be initialized either by the serializer, or for non-serialized fields - by serialization callbacks that you add (for example, via )
p37743
as(dp37744
g18
V23354
p37745
stp37746
a((dp37747
g2
(lp37748
VWithout re-ordering (note I edit slightly as I think I misread the question):
p37749
aVObviously, if  was a set of objects, something like:
p37750
as(dp37751
g18
V23354
p37752
stp37753
a((dp37754
g2
(lp37755
VI wonder if you could publish it to your dev server, run it from there (so it counts as network-deployed), and then attach your IDE to the process
p37756
aV(Debug -> Attach to Process)
p37757
aVIf your update code runs early in the system, you can introduce a pause; for example, I tend to use boiler-plate that checks (in ) for ctrl+alt and displays an additional debugging console (for example, showing web-service calls as they happen, making it easy to debug connectivity issues on a live system by walking users through "hold these keys
p37758
aVnow what does it say when the bug happens
p37759
aVBy the same logic you could show a  ("debug moode; attach your debugger now")
p37760
as(dp37761
g18
V23354
p37762
stp37763
a((dp37764
g2
(lp37765
VIMO, you were better off with your original version; LINQ is great, but it isn't the answer to every problem
p37766
aVIn particular, the  approach demands an extra array (for little gain), and the  approach uses lots of intermediate strings
p37767
aVPerhaps make it an extension method, though - and lose the  stuff:
p37768
as(dp37769
g18
V23354
p37770
stp37771
a((dp37772
g2
(lp37773
VUpdated given the detail now added to the question (comments); just take a copy of the list contents before you sort it
p37774
aVNo the address is not fixed
p37775
aVAnd for arbitrary objects, no there is no sensible way of doing this
p37776
aVFor your own objects you could add something common, like:
p37777
aVA bit scrappy, but it should work, and could be used in a base-class
p37778
aVThe  is now non-changing and sequential
p37779
aVBut only -specific, and not all serialization APIs will respect it (you'd need to use serialization-callbacks to initialize the sequence in such cases)
p37780
as(dp37781
g18
V23354
p37782
stp37783
a((dp37784
g2
(lp37785
VGood news; what you have described (having existing C# classes) is the expected use-case of protobuf-net
p37786
aVAll the
p37787
aVproto stuff ("protogen", the VS add-in, etc) were all added as afterthoughts
p37788
aVThe core of protobuf-net doesn't know about them or care about them
p37789
aVprotocol buffers defines a DSL (
p37790
aVproto, as you mention) that is shared between implementations, and is (sometimes) used for code generation
p37791
aVWhen I first wrote protobuf-net, the code-generation aspect wasn't my biggest concern - simply that
p37792
aVNET developers are generally guilty (myself included) of "implementation first" rather than "contract first"
p37793
aVAs a consequence, protobuf-net doesn't need
p37794
aVproto files to work; an attributed class is sufficient to unambiguously serialize/deserialize
p37795
aVJust use  ,  and  (etc)
p37796
aVThat said; it does include some very under-developed and experimental support for this:
p37797
aVThis is far from complete, but may work for simple types
p37798
aVIf you have some specific cases where it fails, then let me know (add a comment or log an issue)
p37799
aVHowever; most of the time, people interested in
p37800
aVproto would write the
p37801
aVproto first and work from there
p37802
aVExamples of working decorated types are shown on the project home page; it is entirely up to you whether you use WCF attributes, xml attributes or protobuf-net attributes (although the latter provide more control over some specific serialization points, such as inheritance and numeric layouts)
p37803
as(dp37804
g18
V23354
p37805
stp37806
a((dp37807
g2
(lp37808
VSince you can't change the type of an object, you have a few options:
p37809
aVencapsulate
p37810
aVuse a constructor that copies the values from
p37811
aVcopy the properties from  through reflection or similar
p37812
aVFor the latter, MiscUtil has a helpful tool:
p37813
aVFor encapsulation:
p37814
aVOr as a manual copy:
p37815
aVor (comments) get the base to copy itself:
p37816
aV(where 's constructor initializes the fields from )
p37817
as(dp37818
g18
V23354
p37819
stp37820
a((dp37821
g2
(lp37822
VShuggyCoUk is right about it using the parameterless constructor
p37823
aVJust for completeness, though - if you are talking about the outermost message object, you could also create the object yourself and call
p37824
aVBut if it needs to create an object (because it currently has a  instance, or for new items in a list/array), then it looks for a default constructor
p37825
aVI suppose that I could also provide some markup in the attribute to say "just create a raw object via ", but this feels unnecessary (compared with a private parameterless constructor), and may not work on all platforms (Silverlight, CF, etc - being likely problems)
p37826
as(dp37827
g18
V23354
p37828
stp37829
a((dp37830
g2
(lp37831
VHTML Agility Pack is ideal for this; this is almost the same as the example on the home page:
p37832
aVNow just parse "href"; perhaps something like:
p37833
as(dp37834
g18
V23354
p37835
stp37836
a((dp37837
g2
(lp37838
VSo you only want to write  for the first of each
p37839
aVSomething like:
p37840
as(dp37841
g18
V23354
p37842
stp37843
a((dp37844
g2
(lp37845
VJust my tuppence
p37846
aVif you are going to use literals ("Home"), then I would absolutely bind to the , i
p37847
ag50
aV(they should probably be constants in the example given)
p37848
aVThe reflection approach might be handy if you have:
p37849
aVIf you do switch to , then note that they manifest as static fields:
p37850
aVIf it is used heavily you could also cache these in a dictionary
p37851
as(dp37852
g18
V23354
p37853
stp37854
a((dp37855
g2
(lp37856
VBecause of how data-binding works, this type of 2-way binding will only work if the control advertises changes; usually via a  event - i
p37857
ag50
aVin this case
p37858
aVSince there is no such event, you simply can't, short of subclassing , re-declaring ()  and adding a  that hooks off
p37859
aVCan you just add an event to  and do it manually
p37860
aVOr just update the object manually when you set the location/left
p37861
as(dp37862
g18
V23354
p37863
stp37864
a((dp37865
g2
(lp37866
VI don't know if it is a great idea, but you could add a generic extension method:
p37867
as(dp37868
g18
V23354
p37869
stp37870
a((dp37871
g2
(lp37872
VIn what way
p37873
aVWhat you can do is override the ComponentModel functionality, allowing your object to expose different properties at runtime than it does at compile - but this doesn't change reflection
p37874
aVThis approach is used to support data-binding of (for example)
p37875
aVYou would look at
p37876
aVIn
p37877
aVNET 4
p37878
aV0 dynamic objects arrive; there is no special C# support for authoring a dynamic object, but if you don't mind doing the legwork you can write an object that behaves for non-static callers
p37879
aVBut to echo "silky" - what do you want to achieve
p37880
as(dp37881
g18
V23354
p37882
stp37883
a((dp37884
g2
(lp37885
VSince you are doing a "GET", it doesn't sound unreasonable that some caching (at the browser, a proxy / intermediary, or the server) could be the issue
p37886
aVPerhaps try using a "POST" if you are changing data ("keeps returning the old values")
p37887
aVOr introduce some random component into the query
p37888
as(dp37889
g18
V23354
p37890
stp37891
a((dp37892
g2
(lp37893
VUsing  as an example, and treating  as an attribute:
p37894
as(dp37895
g18
V23354
p37896
stp37897
a((dp37898
g2
(lp37899
VThe text is in the text nodes; so you should be able to look at "//div/text()" and concatenate:
p37900
as(dp37901
g18
V23354
p37902
stp37903
a((dp37904
g2
(lp37905
VCreate a -based folder under the user's temp area and use that
p37906
as(dp37907
g18
V23354
p37908
stp37909
a((dp37910
g2
(lp37911
VSo what exactly is a "Type for which Type
p37912
aVIsGenericParameter is true"
p37913
aVThat means it is a generic type argument in an open generic type - i
p37914
ag50
aVwhere we haven't picked a  yet; for example:
p37915
aVSo; have you got some open generics hanging around
p37916
aVPerhaps if you can give an example of where you got your  from
p37917
as(dp37918
g18
V23354
p37919
stp37920
a((dp37921
g2
(lp37922
VYou are executing it once manually (), then the adapter will execute it once ()
p37923
aVThus twice
p37924
aVDid you mean to use a different command for the adapter
p37925
as(dp37926
g18
V23354
p37927
stp37928
a((dp37929
g2
(lp37930
VYou could have overloads for the other types - taking your string example:
p37931
aVHowever; serializability is
p37932
aVtricky; I expect you're going to have to check this at runtime
p37933
as(dp37934
g18
V23354
p37935
stp37936
a((dp37937
g2
(lp37938
VThis is a very common question; if you are using
p37939
aVNET 3
p37940
aV5, there is a lot of support for this in MiscUtil, via the  class, which supports inbuilt types and any custom types with operators (including "lifted" operators); in particular, this allows use with generics, for example:
p37941
aVOr for another example;
p37942
as(dp37943
g18
V23354
p37944
stp37945
a((dp37946
g2
(lp37947
VHow efficient do you need
p37948
aVI would probably write my own TSQL (based on the 's columns) to create the table + columns, but to fill it you have a choice; if you have a moderate number of rows, a  should be fine
p37949
aVIf you have lots of data, then  accepts a  and table name
p37950
as(dp37951
g18
V23354
p37952
stp37953
a((dp37954
g2
(lp37955
VIf it isn't encrypted, it can be read, yes
p37956
aVNote that the SQL Native Client may often perform a non-SSL based encryption (depending on lots of factors), but yes, it can also be encrypted with SSL; see technet
p37957
aVAnd yes, it slows things down slightly
p37958
aVThe requirements for the certificate are all in the technet article
p37959
aVBut please don't expose your db server to the internet
p37960
as(dp37961
g18
V23354
p37962
stp37963
a((dp37964
g2
(lp37965
VWhile fluent is nice, I'd be more interested in adding an  (or two):
p37966
aVThe  approach allows  etc, and the  allows use with things like LINQ queries
p37967
aVIf you want to use a fluent API, you can also write  as an extension method in C# 3
p37968
aV0 that preserves the original list type, by appropriate use of generic constraints:
p37969
aV(note it returns )
p37970
as(dp37971
g18
V23354
p37972
stp37973
a((dp37974
g2
(lp37975
VThere are 3 common approaches here;
p37976
aVif you are talking about  (perhaps as you fetch it from a data-reader), then  can represent null
p37977
aVI don't tend to let this out of the data-layer, though
p37978
aVdue to
p37979
aVNET 1
p37980
aV1 history,  is commonly interpreted as ; a magic number, maybe - but it works and is supported by most data-binding etc
p37981
aVin
p37982
aVNET 2
p37983
aV0,  means you can use  - i
p37984
ag50
aVa nullable-of-DateTime; just use  where-ever you mean a  that can be null, and you can give it a value of  or a valid
p37985
aVSome other thoughts on data-access and nulls:
p37986
aVwhen passing to a  you must use , not  - see below
p37987
aVwhen reading from a data-reader, I tend to check
p37988
aVcommand stuff (with  as the example):
p37989
as(dp37990
g18
V23354
p37991
stp37992
a((dp37993
g2
(lp37994
VTouch isn't hugely "there" in
p37995
aVNET 3
p37996
aV5; but the good news is that I'm pretty sure it is much better supported in the 4
p37997
aV0 toolset (WPF 4
p37998
aV0 in particular, see here)
p37999
aVIn 3
p38000
aV5, the only time I've personally seen good touch support is when I was using a "surface" device and the surface SDK; note that the surface SDK is not compatible with the regular touch API (although I think they've tried to bring the two together)
p38001
aVOh, and I suspect you'll need windows 7
p38002
as(dp38003
g18
V23354
p38004
stp38005
a((dp38006
g2
(lp38007
VAs far as I understand it,  is used for subclasses; i
p38008
ag50
aVif  inherited from , and you were serializing a  instance as an
p38009
aVIMO, the best approach here would be to use messages per-type; however, if you want to go the  route you could define a common base-class to all your supported payloads, and have, for example:
p38010
aVAnd btw, there are some APIs that support binary on CF; protobuf-net being just one (I'm biased as the author - but hey, it is free
p38011
as(dp38012
g18
V23354
p38013
stp38014
a((dp38015
g2
(lp38016
VUntested, but:
p38017
aVActually, for retail purposes - perhaps a better query is "what is the fewest coins I can give out"
p38018
aVReplace with:
p38019
aVand use either  or  ;-p
p38020
aVYou could also probably reduce the number of checked cases by subtracting (for example)  in the  test (and so on
p38021
aV- something like (simplified):
p38022
as(dp38023
g18
V23354
p38024
stp38025
a((dp38026
g2
(lp38027
VPerhaps cache them at startup in a dictionary:
p38028
aVThen fetch as  (or via  if you want to be safe)
p38029
as(dp38030
g18
V23354
p38031
stp38032
a((dp38033
g2
(lp38034
VUntested C#:
p38035
aVWhich reflector translates as:
p38036
as(dp38037
g18
V23354
p38038
stp38039
a((dp38040
g2
(lp38041
VI meant "there is an empty table with no cols and rows in returned dataset"
p38042
aVahh
p38043
aVso you want the missing table to have a stub in your
p38044
aVSeems pretty
p38045
aVoddd - but I guess you could do something like:
p38046
aVAgain, I stress that I find this desire
p38047
aVunusual; but:
p38048
aVif we  even if there isn't data, we just get an empty table, which is fine
p38049
aVif the table doesn't exist, we just get a 1-column, 0-row stub
p38050
aVThere are better ways of checking for existance of an object - for example, checking the info-schema tables; but I'm still not convinced that it is (in the general case) sensible to be overly concerned about existence / non-existence of tables, unless you're:
p38051
aVwriting tooling, such as a query analyzer or ORM tool
p38052
aVwriting a data impoty utility that can't trust ad-hoc data
p38053
as(dp38054
g18
V23354
p38055
stp38056
a((dp38057
g2
(lp38058
VApp-settings is built in, works, and has IDE support
p38059
aVPerformance isn't really an issue for this small set of data; re binary, I would actively avoid  in this case, since app-settings typically evolve between versions, and  is very brittle when it comes to versioning
p38060
aVThere are other ways to serialize data as binary, but in this case I'm not sure I'd bother
p38061
as(dp38062
g18
V23354
p38063
stp38064
a((dp38065
g2
(lp38066
VYou just want to compare the date component
p38067
aVYou could compare
p38068
aVA lot less string work, and should do the job
p38069
aVEven better; create a 1-day range and use that
p38070
as(dp38071
g18
V23354
p38072
stp38073
a((dp38074
g2
(lp38075
VRegex (edited)
p38076
as(dp38077
g18
V23354
p38078
stp38079
a((dp38080
g2
(lp38081
VYou'll need to include an object type to materialize; how about:
p38082
as(dp38083
g18
V23354
p38084
stp38085
a((dp38086
g2
(lp38087
VOne option is to introduce linking tables; so instead of:
p38088
aVyou could have:
p38089
aVNow you can save  records before  (or  first) - and just add in the linking records when you have both
p38090
aVThis also allows you to re-use  in scenarios unrelated to
p38091
aVAnother (simpler) option is just to make the FK nullable
p38092
aVthat might be OK I guess
p38093
as(dp38094
g18
V23354
p38095
stp38096
a((dp38097
g2
(lp38098
VIt sounds like you've got too much of the rest of the page going to the client
p38099
aVYou need to clear the response, and close it afterwards; try:
p38100
aVAlternatively, use a handler (ashx) to do this - since that doesn't include the regular page markup
p38101
as(dp38102
g18
V23354
p38103
stp38104
a((dp38105
g2
(lp38106
VYou are allowed to have a non-generic class of the same name
p38107
aVperhaps something like:
p38108
aVNow you can use  without any redundant
p38109
aVTypically, you might call  methods on  from  - although I suspect in your scenario you might also need a little reflection /
p38110
as(dp38111
g18
V23354
p38112
stp38113
a((dp38114
g2
(lp38115
VSerialization generally refers to creating a version of the data (rather than the objects) that can be used for storage (perhaps in a file), for transfer over a network, or perhaps just for transfer between processes / s /etc on a single machine
p38116
aVSerialization typically means writing the data as a string (think: xml / json) or as raw binary (a  etc)
p38117
aVDeserialization is the reverse process; taking the raw data (from a file, from an incoming network socket, etc) and reconstructing the object model
p38118
aVThe difference between using a db is that it has no intrinsic tabular layout, and no real tie to a database; the data can be any shape, and tends to map more closely to the object-oriented layout than to the rows/columns nature of tables
p38119
aVMost platforms have a range of serialization tools
p38120
aVFor example, it sounds like you're talking about
p38121
aVNET - so  (
p38122
aVNET-specific), , , Json
p38123
aVNET and protobuf-net / dotnet-protobufs would all qualify
p38124
as(dp38125
g18
V23354
p38126
stp38127
a((dp38128
g2
(lp38129
VThis basically describes a way to push work between threads; to push an item of work onto the other thread, use either  (synchronous) or  (asynchronous - ideally calling  later)
p38130
aVLikewise,  is used to ask "do I need to do this
p38131
aVor can I execute the work myself
p38132
aVThe most common use of this interface is in windows-forms, where it is part of how to push work onto the UI thread; you can of course use  /  equally, but forms controls implement this interface to allow abstraction - so downstream code doesn't need to tie itself to windows forms
p38133
aVIn the case of forms,  means "am I the UI thread
p38134
aVIn reality, I'm not sure it is that common to use it directly
p38135
aVIt is more common to handle events on the UI, and have the UI handle thread-switching using the most appropriate local mechanism
p38136
aVTypical usage:
p38137
aVwhich executes (via a delegate)  on the thread managed by  (which implements the interface)
p38138
as(dp38139
g18
V23354
p38140
stp38141
a((dp38142
g2
(lp38143
VI imagine it is buffered in the ; try:
p38144
as(dp38145
g18
V23354
p38146
stp38147
a((dp38148
g2
(lp38149
VSince this is executing a stored procedure, all your lovely  /  is largely redundant anyway
p38150
aVit has no choice but to bring all the data back (stored procedure calls are non-composable)
p38151
aVThe only thing it can do is not materialize objects for some of them
p38152
aVI wonder if the better approach would be to refactor the code to make two calls:
p38153
ag412
ag50
aVmake the paging parameters part of the SPROC (and to the filtering at the database, using  / , or table-variables, temp-tables, etc) - or alternatively something similar with an  parameter in the sproc:
p38154
aV(I seem to recall that  becomes , since TSQL  is really input+output)
p38155
as(dp38156
g18
V23354
p38157
stp38158
a((dp38159
g2
(lp38160
VYou could use local connections (i
p38161
ag50
aVlocal to the method); with connection pooling, the advantages of keeping a connection as a field are minimal, and regularly cause this type of
p38162
aVfun
p38163
aVOf course, you can then get into issues of blocking yourself if you are editing data - perhaps mitigated using things like
p38164
aVExample at the bottom
p38165
aVAlternatively, you could enable MARS (multiple active result sets) on the connection; that should do it
p38166
aVJust include "MultipleActiveResultSets=True" as a pair in the connection-string (SQL Server 2005 and above)
p38167
as(dp38168
g18
V23354
p38169
stp38170
a((dp38171
g2
(lp38172
VIf you accepted an , you could presumably use (in C# 3
p38173
aV0, at least):
p38174
aVAny use
p38175
aVExample :
p38176
as(dp38177
g18
V23354
p38178
stp38179
a((dp38180
g2
(lp38181
VI'm currently using SQL Server Express 2008 and C# Express 2008 - and it works fine
p38182
aVHave you installed the service packs
p38183
as(dp38184
g18
V23354
p38185
stp38186
a((dp38187
g2
(lp38188
VTo get this to work, you simply need to assign a tag (number) that it will use to identify the sub-type
p38189
aVBasically, the core "protocol buffers" wire spec doesn't handle inheritance, so protobuf-net achieves it by modelling inheritance as encapsulation
p38190
aVYou assign tags on properties/fields with , and sub-types via  (compare to )
p38191
aVNote that the tags must be unique within any single type, but that they can be re-used in sub-types - as shown in the example by both levels using tag 1
p38192
aVLike so:
p38193
as(dp38194
g18
V23354
p38195
stp38196
a((dp38197
g2
(lp38198
VA few thoughts;
p38199
aVtry batching your updates; for example, there is no point updating for every iteration in a loop; depending on the speed, perhaps every 50 / 500
p38200
aVIn the case of lists, you would buffer in a local list variable, take the list over via  / , and process the buffer on the UI thread
p38201
aVvariable capture; if you are using  and anonymous methods, you could have problems
p38202
aVI'll add an example below
p38203
aVmaking the UI update efficient - especially if you are processing a list; some controls (especially list-based controls) have a pair of methods like  / , that stop the UI redrawing when you are making lots of updates; instead, it waits until the  is called
p38204
aVcapture problem
p38205
aVimagine (worker):
p38206
aVDid you notice that at some point both threads are talking to
p38207
aVThe UI thread can be iterating it while the worker thread (which has kept running past ) keeps adding
p38208
aVThis can cause issues
p38209
aVNot usually performance issues (unless you are catching the exceptions and taking a long time to log them), but definitely issues
p38210
aVOptions here would include:
p38211
aVusing  to run the update synchronously
p38212
aVcreate a new buffer per update, so that the two threads never have the same list instance (you'd need to look very carefully at the variable scoped to make sure, though)
p38213
as(dp38214
g18
V23354
p38215
stp38216
a((dp38217
g2
(lp38218
VIf you want a proxy, your best bet would probably be to encapsulate the object inside a type that does inherit from  (as a private field), and which has public methods etc to make it usable; a facade, essentially
p38219
aVIf you want serialization - I'd use a DTO that is related to the object, but in a distinct (serializable) type
p38220
aVJust send the state, and reconstruct the actual type at the other end
p38221
as(dp38222
g18
V23354
p38223
stp38224
a((dp38225
g2
(lp38226
VWell, you can force a garbage collection ()*, but that isn't the same as  - and of course, if your code can see it (to dispose it), it can't be collected
p38227
aVSo introducing extra models to track them yourself could be counter-productive
p38228
aVI suggest simply making sure you make appropriate use of  blocks, and make sure your code knows what "owns" an  resource
p38229
aVThis gets a bit tricky with pens / brushes / etc, as the system brushes (etc) need to be treated differently to your own custom brushes
p38230
aV*=and as Mitch notes, this is rarely the right thing to do; I typically only use  from test rigs to flatten things between test cycles
p38231
aVnot in production code
p38232
as(dp38233
g18
V23354
p38234
stp38235
a((dp38236
g2
(lp38237
VThis largely depends on what framework you are using
p38238
aVIt sounds like you are using LINQ-to-SQL, which is very literal about tables to objects
p38239
aVWith Entity Framework, there is inbuilt support for many-to-many, in particular for the trivial case you've listed (a linking table with no additional properties)
p38240
aVEF will generally spot this pattern, and hide the link table from the conceptual model (I can't remember, but it might need a spanning PK over the two FK columns)
p38241
aVOf course, this then goes sour if you want to add columns to the link-table; so in some ways I'd be tempted to leave it "as is"
p38242
aVWith regards the  etc - how do you mean
p38243
aVYou can do joins over the association, and you should be able to use  etc; do you have a concrete example of what you want to do
p38244
as(dp38245
g18
V23354
p38246
stp38247
a((dp38248
g2
(lp38249
VI wouldn't say it is bad practice, but in the general case it should probably be obvious that this is going to happen, i
p38250
ag50
aVclearly documented in the  markup
p38251
aVHowever, in this case we are talking about the death of an object - so the caller probably isn't expecting to do much with the object after calling the method
p38252
aVI would also want to make it clear (perhaps in the method name) that this is async
p38253
aVRe garbage-collection; events keep the subscriber alive; not the publisher
p38254
aVIf  is eligible, then it will be collected
p38255
aVThe anonymous method doesn't seem to access any captured scope (except for  itself) - so there is nothing interesting to keep alive anyway (except for the delegate instance itself)
p38256
as(dp38257
g18
V23354
p38258
stp38259
a((dp38260
g2
(lp38261
VIf you want to test whether  is part of the pressed keys, you can perform a bitwise test;
p38262
as(dp38263
g18
V23354
p38264
stp38265
a((dp38266
g2
(lp38267
VHow about
p38268
as(dp38269
g18
V23354
p38270
stp38271
a((dp38272
g2
(lp38273
VAttributes are burnt in at compile time, and cannot for reflection be set at runtime
p38274
aVThere are a few things you can do in "ComponentModel", but they wouldn't apply here
p38275
aVThe only other common case here is for "i18n", where an attribute might be designed to pick up different values at runtime (from resx etc, based on a key rather than the description being set in the code) - and again, this doesn't apply in this case
p38276
aVSo, no
p38277
as(dp38278
g18
V23354
p38279
stp38280
a((dp38281
g2
(lp38282
VA modal popup, typically done in a javascript library such as jQuery UI (look at the right-hand-side for the various demos)
p38283
as(dp38284
g18
V23354
p38285
stp38286
a((dp38287
g2
(lp38288
V - i
p38289
ag50
aVFor a complete example:
p38290
aVAs suggested in the comments - to explain,  is the open generic type - i
p38291
ag50
aV" without any specific " (for multiple generic types, you just use commas - i
p38292
ag50
aV)
p38293
aVWhen a  is specified (either through code, or via ) we get the closed generic type - for example,
p38294
aVWhen using , any generic type constraints are still enforced, but simply at runtime rather than at compile time
p38295
as(dp38296
g18
V23354
p38297
stp38298
a((dp38299
g2
(lp38300
VI'm assuming that by "resource file" you mean a regular resx that is compiled into the assembly
p38301
aVIn which case, not directly from xslt; however, you could add an extension object and use a key-base approach, i
p38302
ag50
aVThe "resx" alias would be mapped () to a uri that you use when creating your xslt wrapper in C#
p38303
aVFor example, with the  (in the xslt preamble):
p38304
aVwe can map that in C# via:
p38305
aVand attach this to the namespace:
p38306
aVWe now have full control to inject managed code (as extensions) into our xslt
p38307
as(dp38308
g18
V23354
p38309
stp38310
a((dp38311
g2
(lp38312
VYou simply can't pass a form via WCF; WCF is intended to pass state, not implementation
p38313
aVIMO, you would be best served by creating a DTO to represent the data you want to pass, and pass that via WCF
p38314
as(dp38315
g18
V23354
p38316
stp38317
a((dp38318
g2
(lp38319
VThis is a very common question; if you are using
p38320
aVNET 3
p38321
aV5, there is a lot of support for this in MiscUtil, via the  class, which supports inbuilt types and any custom types with operators (including "lifted" operators); in particular, this allows use with generics, for example:
p38322
aVOr for another example;
p38323
as(dp38324
g18
V23354
p38325
stp38326
a((dp38327
g2
(lp38328
VPerhaps something like (untested):
p38329
aV(and group by this)
p38330
aVIf this is LINQ-to-Objects, you could also do this in a static utility function ( or similar); or with LINQ-to-SQL you could do the same with a scalar-UDF mapped to the data-context
p38331
as(dp38332
g18
V23354
p38333
stp38334
a((dp38335
g2
(lp38336
Vsorry for the delay - I had a few days off-line ;-p
p38337
aVThe protocol buffers specification has an implicit default of zero on most types
p38338
aVTo ensure compliant handling, it respects this default unless you tell it otherwise
p38339
aVI will try to make this clearer in the documentation
p38340
aVThere are several solutions:
p38341
aVAdd a  attribute  to the field to set an explicit default
p38342
aVAdd  to the  attribute
p38343
aVIf you use , I suspect it will treat zero as explicit
p38344
aVIn the case of properties, it respects the  pattern, so if the  property (with a setter) had the , it would look for
p38345
as(dp38346
g18
V23354
p38347
stp38348
a((dp38349
g2
(lp38350
VAssuming you mean to persist it to a database, you would be better served looking at a foreign-key /
p38351
aVIf you really want more structured data in a cell, then perhaps something like xml, or some other serialization format
p38352
as(dp38353
g18
V23354
p38354
stp38355
a((dp38356
g2
(lp38357
VNot built in, but easy enough to add
p38358
aV(the  field helps ensure we don't get repeats if we use it in a tight loop, and the  keeps it safe from multiple callers)
p38359
aVIn C# 3
p38360
aV0, this could be an extension method:
p38361
aVThen you could use it exactly as per your example:
p38362
as(dp38363
g18
V23354
p38364
stp38365
a((dp38366
g2
(lp38367
VFor the widest portability, just use  and
p38368
aVOne minor note: it won't use your contructor (this often surprises people), and it isn't guaranteed to produce identical xml (especially if you use attributes)
p38369
aVIf you want controllable xml (rather than WCF's preferred format, which offers less control) then there are ways to convince WCF to use  instead of  - by marking the service-contract (interface) with
p38370
as(dp38371
g18
V23354
p38372
stp38373
a((dp38374
g2
(lp38375
VOne (bad) option is to make the fields  - but don't do this; it still breaks proper encapsulation
p38376
aVTwo good options:
p38377
aVmake the setter protected
p38378
aVprovide a constructor that accepts the values
p38379
aVexamples:
p38380
aV(C# 2
p38381
aV0)
p38382
aVor:
p38383
as(dp38384
g18
V23354
p38385
stp38386
a((dp38387
g2
(lp38388
VRe your comment:
p38389
aVprivate int GetCount(IQueryable table, int intID)
p38390
aVIs that the PKID
p38391
aVShouldn't the answer be 0 or 1
p38392
aVAnyway
p38393
aVyou would have to build the  dynamically
p38394
aVSomething like (untested, based on this):
p38395
as(dp38396
g18
V23354
p38397
stp38398
a((dp38399
g2
(lp38400
V(however, I'm very vague as to what the initial  is doing; I'd tend to be a bit more particular about which nodes I am selecting)
p38401
as(dp38402
g18
V23354
p38403
stp38404
a((dp38405
g2
(lp38406
VAssuming this is html (not xhtml), I would use the HTML Agility Pack to parse it, and access InnerText:
p38407
as(dp38408
g18
V23354
p38409
stp38410
a((dp38411
g2
(lp38412
VYou should be able to set the  on the serialization attribute:
p38413
as(dp38414
g18
V23354
p38415
stp38416
a((dp38417
g2
(lp38418
V relates to the DLR, and is primarily related for playing between C# and a dynamic language (perhaps IronPython); however, more generally this type of property-bag object can be useful when the schema of your types is only known at runtime, perhaps based on database data / configuration data
p38419
aVPerhaps an example of the "inner platform" anti-pattern, but it is useful in specific scenarios to attach properties at runtime
p38420
aVOf course, for purely CLR usage (i
p38421
ag50
aVno DLR callers) you can do this a lot more simply just with an indexer and dictionary:
p38422
aVFor data-binding purposes, even with this you can achieve full data binding using custom property descriptors, via  or
p38423
aVOr for a simple example: consider
p38424
aVthis is in part what you can do here (again, in static-typed code): (untested example)
p38425
as(dp38426
g18
V23354
p38427
stp38428
a((dp38429
g2
(lp38430
VIt sounds like you are describing a property-bag; this is indeed supported for data-binding, but you need to implement  or
p38431
aVThe available properties are then defined via  or  - or in the case of lists, via
p38432
aVis suitable if the properties change per-instance;  can do per-type customisation, and works with things like  without any extra work
p38433
aVThe tricky thing is that you need to define the type of each property - not simple if you've just got
p38434
aVHere is a very simplified example, that treats all properties as strings
p38435
aVIn this example, because we are binding a list, it uses  but doesn't implement
p38436
aVNote that for , a simpler shortcut is to use a  - this allows you to tweak the properties without having to use  or  - see example
p38437
as(dp38438
g18
V23354
p38439
stp38440
a((dp38441
g2
(lp38442
VNo, basically
p38443
aVYou would have to give it one of the values (presumably the 1), and interpret the other (0) manually
p38444
as(dp38445
g18
V23354
p38446
stp38447
a((dp38448
g2
(lp38449
VHave you marked the virtual directory as an application
p38450
ag412
ag50
aVdoes it have a cog in IIS
p38451
aVThis is the usual problem when a sub-folder doesn't execute as intended
p38452
as(dp38453
g18
V23354
p38454
stp38455
a((dp38456
g2
(lp38457
VA web application is almost certainly already multi threaded by the hosting environment (IIS etc)
p38458
aVIf your page is CPU-bound (and want to use multiple cores), then arguably multiple threads is a bad idea, as when your system is under load you are already using them
p38459
aVThe time it might help is when you are IO bound; for example, you have a web-page that needs to talk to 3 external web-services, talk to a database, and write a file (all unrelated)
p38460
aVYou can do those in parallel on different threads (ideally using the inbuilt async operations, to maximise completion-port usage) to reduce the overall processing time - all without impacting local CPU overly much (here the real delay is on the network)
p38461
aVOf course, in such cases you might also do better by simply queuing the work in the web application, and having a separate service dequeue and process them - but then you can't provide an immediate response to the caller (they'd need to check back later to verify completion etc)
p38462
as(dp38463
g18
V23354
p38464
stp38465
a((dp38466
g2
(lp38467
VYes,  works in winforms
p38468
aVFor example,  will use this automatically both per-row and per-cell
p38469
aVBut it is implementation-specific, and isn't automatically applied to other bindings
p38470
aVI did once write some code to associate it to an error-provider and do the work via change events, but I don't have it to hand unfortunately
p38471
aVBut I seem to recall it wasn't huge
p38472
as(dp38473
g18
V23354
p38474
stp38475
a((dp38476
g2
(lp38477
VHow about:
p38478
aVOf course; if you have multiple manipulations to make, consider :
p38479
as(dp38480
g18
V23354
p38481
stp38482
a((dp38483
g2
(lp38484
VWhat exactly is it you want
p38485
aVYou can capture just the expression from the  - something like:
p38486
aVBecause this is going to an expression tree, there is a meaningful
p38487
aVIf you want the SQL (etc), then that will be implementation-specific
p38488
aVFor example, with LINQ-to-SQL you can use  - for example,
p38489
aVIf you want the predicate out of the middle of an  feed, then that is much trickier
p38490
as(dp38491
g18
V23354
p38492
stp38493
a((dp38494
g2
(lp38495
VGenerally, things should either be lists, or should be an entity for binding
p38496
aVIf it is a list ( or ) then much of the data-binding API will assume you actually want (for simple-binding scenarios, i
p38497
ag50
aVone row) the first item from the sublist
p38498
aVI would simply change it so that  doesn't implement , but encapsulates it, perhaps exposing it via a  property
p38499
aVYou could also look at whether a custom  would work (I'll investigate
p38500
as(dp38501
g18
V23354
p38502
stp38503
a((dp38504
g2
(lp38505
VWell, perhaps the easiest way to emulate a one-way call is to push it onto the thread-pool
p38506
aVAlthough the above suffers a bit from issues with exceptions, it would be easy enough to wrap:
p38507
aV(edit: oops, borked the exception handling
p38508
aVfixed
p38509
as(dp38510
g18
V23354
p38511
stp38512
a((dp38513
g2
(lp38514
VThe expression can only have one type; my preferred answer here would be something like:
p38515
aVHowever, if you want to do something more flexible, you'd probably need to get into custom  writing; something more like this
p38516
as(dp38517
g18
V23354
p38518
stp38519
a((dp38520
g2
(lp38521
VThis isn't ideal, but I generally just right-click->unload them until I need them
p38522
aVThey are still available in the solution (to reload on demand), but it avoids this launch niggle, and releases some resources (and makes "build solution" quicker etc)
p38523
as(dp38524
g18
V23354
p38525
stp38526
a((dp38527
g2
(lp38528
VYou'll need to capture the result of the  (strings are immutable), and ensure you use character-escaping for the :
p38529
aVFor info; most of the inbuilt methods will accept either, and assuming you are on Windows,  would be more common anyway
p38530
aVIf you want a uri, then use a :
p38531
as(dp38532
g18
V23354
p38533
stp38534
a((dp38535
g2
(lp38536
VI assume you are using
p38537
aVThis serializer is notoriously brittle, since it (by default) includes the field-name in the stream; this impacts obfuscation particularly badly
p38538
aVPresumably the obfuscator is now choosing new named for the fields (perhaps at random, perhaps due to the new fields), and so it can't deserialize correctly
p38539
aVA few options:
p38540
aVdon't obfuscate the DTO
p38541
aVimplement  so the field names don't matter
p38542
aVuse a serializer that doesn't care about field names
p38543
aVI'd personally opt for the latter, but I'm a bit biased ;-p I know of people using protobuf-net with obfuscated classes; the data only includes numeric markers, so the meaning isn't really exposed (except of course, by inspection of the data - post codes etc, but that is the job of encryption)
p38544
as(dp38545
g18
V23354
p38546
stp38547
a((dp38548
g2
(lp38549
VReflection isn't a problem here; EF won't even be able to notice the difference
p38550
aVThe delegate approach is a non-starter, by the way (since you mention EF); ultimately, it is something like:
p38551
aVNote that you can make it easier with ; the reason I haven't used that here is that it is very handy to know the member-type () when creating the constant - otherwise you can get problems with nulls
p38552
as(dp38553
g18
V23354
p38554
stp38555
a((dp38556
g2
(lp38557
VI can't think why it would show 00, but as a random suggestion you could try:
p38558
as(dp38559
g18
V23354
p38560
stp38561
a((dp38562
g2
(lp38563
VTo do something like this without demanding interfaces etc, you can use dynamic s; something like:
p38564
as(dp38565
g18
V23354
p38566
stp38567
a((dp38568
g2
(lp38569
VJust for completeness; if you are building a query based on different inputs you can compose it with successive  calls:
p38570
as(dp38571
g18
V23354
p38572
stp38573
a((dp38574
g2
(lp38575
VI don't know how far this goes in other languages, but a fun thing about C# is that not only is the runtime (the  class etc) unicode aware - but unicode is fully supported in source:
p38576
as(dp38577
g18
V23354
p38578
stp38579
a((dp38580
g2
(lp38581
VIt sounds like you are deploying to a farm; IMO, the best way to do this is not via the GAC, but simply by including the required dlls in the project(s) you need
p38582
aVAll of them
p38583
aVDisk space is cheap, and the convenience of being able to use "robocopy" (or similar) to distribute to the farm is very attractive
p38584
aVThere are very few times when the GAC is truly required - some of the "serviced component" scenarios, for example
p38585
aVFor most others probing paths are fine
p38586
as(dp38587
g18
V23354
p38588
stp38589
a((dp38590
g2
(lp38591
VBrace the  statements (etc) to make the scope of the loop obvious:
p38592
aV(etc)
p38593
aVPerhaps add some summary comments to logical blocks of code; not "add 1 to i", though
p38594
as(dp38595
g18
V23354
p38596
stp38597
a((dp38598
g2
(lp38599
VI did exactly this before, using the array approach (for Finguistics, as it happens)
p38600
aVThe trick is :
p38601
aVThe advantage of the array approach is that you can keep a strongly typed delegate type ( or similar, no matter the number of arguments
p38602
aVAnd typed  is much faster than
p38603
aVIf the values aren't all of the same type - that is doable too; let me know and I'll add an example
p38604
as(dp38605
g18
V23354
p38606
stp38607
a((dp38608
g2
(lp38609
VOn the Visual Studio homepage, on the left, is a link:
p38610
ag5115
aVGet Visual Studio : Visual Studio 2008 Trial Version
p38611
aVWhich gives you a 90 day trial edition of Visual Studio Professional
p38612
aVOr a trial version of Team Suite is available here
p38613
aVObviously these links may change when VS2010 is released
p38614
as(dp38615
g18
V23354
p38616
stp38617
a((dp38618
g2
(lp38619
VThe core of LINQ, the query syntax, isn't actually huge in scope
p38620
aVIt is simply some very literal translations, to methods and lambdas - so
p38621
aVis literally:
p38622
aVIt knows nothing about extension methods (although they are the most common (but not only)  implementation), and nothing about  etc
p38623
aVThe number of keywords (and hence the number of required method implementations) isn't huge
p38624
aVJon once attempted to implement all of them in 1 hour (in a live presentation)
p38625
aVHe didn't do too badly ;-p
p38626
aVPerhaps the more impressive part of LINQ is the expression tree support that was required to allow LINQ to be used against databases - i
p38627
ag50
aVthe lambda expression that can be compiled either to a delegate or to an object model that represents the code written
p38628
aVInterestingly, this same idea shines through into the way that DLR resolution works in 4
p38629
ag190
as(dp38630
g18
V23354
p38631
stp38632
a((dp38633
g2
(lp38634
VI don't know if true, but one explanation I heard was weight - in particular for the small frameworks (Compact Framework, Silverlight, Micro Framework); I'm not convinced by this
p38635
aVFar more convincing is that by itself knowing it is a number doesn't provide much; for example, integer division works very differently to floating point, and operators aren't always as simple as you'd like (think , )
p38636
aVIf it helps, MiscUtil offers generic operator support, allowing things like:
p38637
aVAll very cleanly and efficiently
p38638
aVNote, however, that there is no compile-time validation (since there are no suitable generic constraints)
p38639
aVBut it works
p38640
as(dp38641
g18
V23354
p38642
stp38643
a((dp38644
g2
(lp38645
VThe implementation can be different; for example, an async IO call may choose to make use of completion ports to minimise the cost to the system while not doing anything
p38646
aVIt is certainly a way; you could also use , , or  (etc) in
p38647
aVNET 4
p38648
ag190
aVVaries per implementation
p38649
aVI think what the book is trying to highlight is that delegates always include this pattern:
p38650
aVa synchronous call () that can block
p38651
aVan async call () that shouldn't really block unless the thread-pool is saturated
p38652
aVbut it isn't the only pattern
p38653
aVAlso; more recently (for example, the async IO methods in Silverlight, or in ): rather than an , an event is used to signal completion
p38654
as(dp38655
g18
V23354
p38656
stp38657
a((dp38658
g2
(lp38659
VA minor addition; in the general case, a common pattern is to have a  method, so that you know whether you are in  (where more things are available) vs the finalizer (where you shouldn't really touch any other connected managed objects)
p38660
aVFor example:
p38661
as(dp38662
g18
V23354
p38663
stp38664
a((dp38665
g2
(lp38666
VIn the first example it is a field
p38667
aVFields automatically default to 0/false/null
p38668
aVIn the second example it is a variable
p38669
aVVariables are not defaulted, and must have "definite assignment" before they are used
p38670
aVEssentially, when creating an object (or initializing a struct) it zeros the memory (or in the case of a non-default struct ctor, forces you to manually initialize everything)
p38671
aVHowever, variables are so common (in every method) that it doesn't want the overhead of having to zero the stack all the time
p38672
aVIt instead forces you to indicate the initial value
p38673
as(dp38674
g18
V23354
p38675
stp38676
a((dp38677
g2
(lp38678
VIn terms of LINQ, there are things you can do to create more versatile LINQ queries at runtime than you can purely in lambdas
p38679
aVI've used  many times as a micro-compiler, as an alternative to  and IL
p38680
aVThis approach gets stronger in
p38681
aVNET 4
p38682
aV0 (as discussed on InfoQ), but even in 3
p38683
aV5 there are lots of things you can do (generally based on runtime data; configuration etc):
p38684
aVgeneric operators
p38685
aVobject cloning
p38686
aVcomplex initialization
p38687
aVobject comparison
p38688
aVI also used it as part of a maths engine for some work I did with Microsoft - i
p38689
ag50
aVparse a math expression ("(x + 12) * y = z" etc) into an  tree, compile it and run it
p38690
aVAnother intersting use (illustrated by Jason Bock, here) is in genetic programming; build your candidates as  trees, and you have the necessary code to execute them quickly (after ), but importantly (for genetic programming), also to swap fragments around
p38691
as(dp38692
g18
V23354
p38693
stp38694
a((dp38695
g2
(lp38696
VIt has no clue what to expect in that property; have you included  etc
p38697
aVBut  simply doesn't work on a web service
p38698
aVThe ideal answer is to make the web-service much more specific, so it has (for example) a  (typed as such)
p38699
aVCan you perhaps include an example of what the server-side code looks like for this
p38700
aVI'm surprised that it works at the server
p38701
aVRe comment; Hmm
p38702
aVif the is 3rd party, this might be very tricky; you might have to resort to either editing the generating code (if XmlInclude works, which I can't guarantee), or hacking the wsdl
p38703
aVnot simple
p38704
aVIt sounds like you're using the 2
p38705
aV0 web-service reference (wsdl
p38706
aVexe, indirectly)
p38707
aVYou could also try:
p38708
aVWSE3 (wse3wsdl
p38709
aVexe)
p38710
aVWCF (in
p38711
aVNET 3
p38712
aV0 and avove; svcutil
p38713
aVexe)
p38714
as(dp38715
g18
V23354
p38716
stp38717
a((dp38718
g2
(lp38719
VAny attributes that exhibit this inside the compiler are special cases
p38720
aVThe  behaviour is described in the C# spec (17
p38721
ag7733
aV3), for example
p38722
aVYou could write a custom FxCop rule
p38723
as(dp38724
g18
V23354
p38725
stp38726
a((dp38727
g2
(lp38728
Vvirtualisation is typically done on local metal, and orovides great hardware independence etc; "the cloud" refers to pushing processing into another data-centre (which will often use virtualization in the implementation)
p38729
aVthe pricing may be cheaper for startups, in particular - and it provides a huge ability to "ramp up" the service for a short period
p38730
aVEither to tie in with marketing, or (for example) for bulk data processing
p38731
aVBut for my purposes local servers are cheaper too ;-p If you have pretty constant / expected load, and can afford the startup costs of metal, then in many cases metal is cheaper
p38732
aVBut if your volumes are very low, perhaps cloud is a better way of getting a fault-tolerant platform, without paying for lots of hardware and engineer costs
p38733
aVit depend on what you interpret as "the cloud"
p38734
aVMany cloud hosts offer very restricted sandboxes with different programming paradigms; however, some services (which can still be described as the cloud) offer full VM access, but still with the ramp-up etc; in the latter case the same code should work without much change
p38735
aVI think you've already answered that (in your specific case; it may be different for other consumers)
p38736
aV(likewise most of the rest)
p38737
aVAlso; note that there may be legal/data issues why you need to retain strong control of the data; shipping it off to a 3rd party (perhaps in a different legal jurisdiction) may not be possible and/or desirable
p38738
as(dp38739
g18
V23354
p38740
stp38741
a((dp38742
g2
(lp38743
VIn most cases,  works against the live collection (no explicit clone), and if you try to change the collection while enumerating it, then the enumerator breaks with an exception
p38744
aVSo if you are adding to , expect problems
p38745
as(dp38746
g18
V23354
p38747
stp38748
a((dp38749
g2
(lp38750
VWell, IANAL, but some quick searches yield
p38751
aVone here (emph mine)
p38752
aVMicrosoft licenses the software to you for educational use
p38753
aVThis means that you can use the software without restriction for school assignments or personal projects
p38754
aVIf you write or design something that you wish to sell, however, you need to purchase a standard licensed copy of the Microsoft software before you sell your product
p38755
aVPerhaps use the Express Editions instead
p38756
aVThere aren't any restrictions here, except for the bits of VS missing from the free edition
p38757
as(dp38758
g18
V23354
p38759
stp38760
a((dp38761
g2
(lp38762
VOn the most part, I'd say follow the pattern
p38763
aVI have deviated from it, but very rarely, and for specific reasons
p38764
aVIn the case in point, the biggest issue I'd have is that I'd probably still use an , allowing me to add extra properties later, and to use the occasional 2-way property (think , or other feedback-events where the subscriber needs to to set a property on the event object)
p38765
aVAnd once you've started down that line, you might as well use  for some
p38766
as(dp38767
g18
V23354
p38768
stp38769
a((dp38770
g2
(lp38771
VWhy do people insist on trying to use regex to parse html
p38772
aVYou can probably do it if you exclude a whole host of edge-cases
p38773
aVbut just use HTML Agility Pack and you're done:
p38774
aV(note I'm assuming it is not xhtml; if it is xhtml, use  or , and very similar code to the above)
p38775
as(dp38776
g18
V23354
p38777
stp38778
a((dp38779
g2
(lp38780
VI'm guessing, but possibly as simple as: it is very rare you want it, and when you do there are usually better options (private/protected initialization methods) that do the job adequately
p38781
aVAnd without the risk of forgetting to initialize it, or calling a method that relies on data that isn't yet initialized (a reason why calling  methods in the  is a bit risky)
p38782
aVThe only caveat is that you can't use a  field with a post- initialization method, but that is IMO less evil than making things more complex for a corner-case
p38783
as(dp38784
g18
V23354
p38785
stp38786
a((dp38787
g2
(lp38788
VYou could perhaps use the html5 data-* attributes
p38789
aVIt'll fail validation on html4, but it is still probably the best option
p38790
as(dp38791
g18
V23354
p38792
stp38793
a((dp38794
g2
(lp38795
VSomething like:
p38796
as(dp38797
g18
V23354
p38798
stp38799
a((dp38800
g2
(lp38801
VMaybe post the actual class for
p38802
aVI wonder, for example, whether you have either an association property marked , or no s at all; in which case it looks at fields - which might bork if you have a lazy-loaded member (and thus an association to the data-context)
p38803
aVNote that if you only want the one object (not associations), there are other ways of doing a shallow clone - like so, for example
p38804
as(dp38805
g18
V23354
p38806
stp38807
a((dp38808
g2
(lp38809
VWell, you could just use  and ; but manually:
p38810
aViterate forwards until you find the node you want to remove keeping the previous node available in a variable at each point
p38811
aVset
p38812
aVgo home
p38813
as(dp38814
g18
V23354
p38815
stp38816
a((dp38817
g2
(lp38818
VIn a pure  (in
p38819
aVNET 3
p38820
aV5), the closest you can get is a compound conditional:
p38821
aVNot fun, especially when it gets complex
p38822
aVIf you mean a lamda expression with a statement body (only for use with LINQ-to-Objects), then anything is legal inside the braces:
p38823
aVOf course, you might be able to outsource the work; for example, LINQ-to-SQL allows you to map a scalar UDF (at the database) to a method on the data-context (that isn't actually used) - for example:
p38824
aVwhere  is a UDF that does the work at the db server
p38825
as(dp38826
g18
V23354
p38827
stp38828
a((dp38829
g2
(lp38830
VThat really depends
p38831
aVPersonally I hate the way that MSTest does this - either with the attribute or the separate "testrunconfig" file (add items in the "Deployment" section)
p38832
aVI prefer the NUnit way (I use it with TestDriven
p38833
aVNET) - then if you want it to include a file in the output you do exactly what you would in regular VS projects; you toggle the "Copy to Output Directory" property
p38834
as(dp38835
g18
V23354
p38836
stp38837
a((dp38838
g2
(lp38839
VCompared to what
p38840
aVIf you mean , then that is essentially a wrapper around an array; so fast to read/write by index, relatively fast to append (since it allows extra space at the end, doubling in size when necessary) and remove from the end, but more expensive to do other operations (insert/delete other than the end)
p38841
aVAn array is again fast by index, but fixed size (no append/delete)
p38842
aVetc offer better access by key
p38843
aVA list isn't intrinsically slow; especially if you know you always need to look at all the data, or can access it by index
p38844
aVBut for large lists it may be better (and more convenient) to search via a key
p38845
aVThere are various dictionary implementations in
p38846
aVNET, each with different costs re size / performance
p38847
as(dp38848
g18
V23354
p38849
stp38850
a((dp38851
g2
(lp38852
VAlso, my ArrayList is automatically converted by the database API into the byte[]
p38853
aVFrankly, you are going to have to find the actual serialization API used to stand a chance of reconstructing this data
p38854
aVIt is probably , which is notoriously non-portable and version-intolerant
p38855
aVIf you need to store data as binary, and use it long-term (database) and between platforms (CF), then you are going to have to use a suitable serializer
p38856
aVFor example, protobuf-net would work in principal (although it won't like untyped , preferring typed  etc)
p38857
aVIf the data is currently stored as , then your best bet would be to extract it using your current system and re-package it (perhaps in a different column or table) in a more suitable serialization format
p38858
as(dp38859
g18
V23354
p38860
stp38861
a((dp38862
g2
(lp38863
VGenerics and history would play a big part, especially with the number of controls (etc) that expose similar events
p38864
aVWithout generics, you would end up with a lot of events exposing , which is largely useless:
p38865
aVyou still have to cast to do anything useful (except maybe a reference check, which you can do just as well with )
p38866
aVyou can't re-use the events on non-controls
p38867
aVIf we consider generics, then again all is well, but you then start getting into issues with inheritance; if class , then should events on  be , and events on  be
p38868
aVAgain, very confusing, hard for tooling, and a bit messy in terms of language
p38869
aVUntil there is a better option that covers all of these,  works; events are almost always on class instances, so there is no boxing etc - just a cast
p38870
aVAnd casting isn't very slow
p38871
as(dp38872
g18
V23354
p38873
stp38874
a((dp38875
g2
(lp38876
VWell, a static data-context already sounds like a potential issue (in particular threading, but also stale objects, and disposal)
p38877
aVMy immediate thought is: is object tracking enabled
p38878
aVNot sure if it needs to be, but certainly  one to consider
p38879
as(dp38880
g18
V23354
p38881
stp38882
a((dp38883
g2
(lp38884
V only affects the outermost element ()
p38885
aVI suspect you want
p38886
aVOf course, another way is to write an object wrapper:
p38887
aVAnd serialize this wrapper object instead of just a list
p38888
as(dp38889
g18
V23354
p38890
stp38891
a((dp38892
g2
(lp38893
VIf you want to take bytes
p38894
aVtake bytes; and your shifts are off, and  would be more intuitive:
p38895
as(dp38896
g18
V23354
p38897
stp38898
a((dp38899
g2
(lp38900
VSilverlight can be developed with WebDeveloper Express (with the addon), IIRC - so no you don't have any inbuilt license costs - but it would be easier with Blend and VS Pro or above
p38901
aVOf course, WPF can be developed with C# Express, so also free
p38902
aVBut fundamentally they are different products; Silverlight is a slimmer version designed for cross-platform use with RIA - originally in the browser, but now out-of-browser too with Silverlight 3
p38903
aVWPF is windows /
p38904
aVNET 3
p38905
aV0 specific, but has a richer framework
p38906
as(dp38907
g18
V23354
p38908
stp38909
a((dp38910
g2
(lp38911
VPersonally I think you would do better to separate out the data in the configuration section (which seemingly needs to be mutable), and how you represent it in your object model
p38912
aVThere is nothing stopping you having two representations - a simple (DTO/POCO) version for config, and your custom version (immutable in this case) for real usage in your app
p38913
as(dp38914
g18
V23354
p38915
stp38916
a((dp38917
g2
(lp38918
Vbtw; it takes a lot of processing to check 2^64 options
p38919
aVWell, the fastest way may be to just use an  (aka ) or  (), and use
p38920
aVDo you really need the
p38921
aVAs a hacky alternative, how about:
p38922
aVThe only other approach I can think of would be to use unsafe code to talk to an array as though it is an int64
p38923
aVmessy
p38924
as(dp38925
g18
V23354
p38926
stp38927
a((dp38928
g2
(lp38929
VIn the case of , I think you are best off with ;
p38930
aVSorry; I meant to add more but got disconnected (mobile data)
p38931
aVThe advantage of  over (say)  is that you can add your own types to , either at compile time or runtime
p38932
aVYou are absolutely right that there is no  - and the  method is very broken generally as far as I can tell - you can of course use an exception
p38933
as(dp38934
g18
V23354
p38935
stp38936
a((dp38937
g2
(lp38938
VYou are really talking about serialization, which can take many forms
p38939
aVSince you want small and binary, protocol buffers may be a viable option - giving version tolerance and portability as well
p38940
aVUnlike , the protocol buffers wire format doesn't include all the type metadata; just very terse markers to identify data
p38941
aVIn
p38942
aVNET there are a few implementations; in particular
p38943
aVprotobuf-net
p38944
aVdotnet-protobufs
p38945
aVI'd humbly argue that protobuf-net (which I wrote) allows more
p38946
aVNET-idiomatic usage with typical C# classes ("regular" protocol-buffers tends to demand code-generation); for example:
p38947
as(dp38948
g18
V23354
p38949
stp38950
a((dp38951
g2
(lp38952
VIt isn't clear to me where your code is to actually "go wild" with the document - i
p38953
ag50
aVrun the matches
p38954
aVIf  is the root node, then I would expect to see some  or similar at some point; otherwise you are only going to get the output as specified in the root match (and it will never apply your  etc matches)
p38955
aVIf you want to process the entire document using substitutions only when defined, then the classic match is something like:
p38956
aVBecause this matches all nodes, and cascades, it runs for every node until a more specific match is found
p38957
aVSo with the xslt:
p38958
aVMost nodes will be repeated "as is", but any  elements will be replaced with  (and without any attributes/content)
p38959
aVNote that even with this; you need to explicitly cascade if you expect child data to be processed by matches (as shown by the  example above, which doesn't cascade)
p38960
aVAnd I can't see any  in your  match
p38961
aVFinally; the  is redundant;  should suffice
p38962
as(dp38963
g18
V23354
p38964
stp38965
a((dp38966
g2
(lp38967
VI'm not entirely sure where transactions comes directly into this, other than the ability to rollback
p38968
aVThe main thing IMO is to aquire the locks in a consistent order, and early; oh, and use a timeout when aquiring locks - don't sit there looking stuck forever
p38969
aVThe reference to transactions makes me think primarily of databases, in which case another consideration is to use tricks like  to ensure you get a write lock initially to avoid issues promoting a (contested) read-lock to a write-lock (changing from a deadlock to simple blocking)
p38970
aVOf course, many databases also have better deadlock detection than most regular code
p38971
as(dp38972
g18
V23354
p38973
stp38974
a((dp38975
g2
(lp38976
VA typical line-reader is something like:
p38977
aV(note the  to ensure we  it even if we get an error, and the loop)
p38978
aVIf you want, you could abstract this (separation of concerns) with an iterator block:
p38979
aV(note we've moved this into a function and removed the "do something", replacing it with "yield return", which creates an iterator (a lazily iterated, non-buffering state machine)
p38980
aVWe would then consume this as simply as:
p38981
aVNow our processing code doesn't need to worry about how to read lines - simply given a sequence of lines, do something with them
p38982
aVNote that the  () applies to  too; you should make a habit of checking for ; for example (still including your error-logging):
p38983
as(dp38984
g18
V23354
p38985
stp38986
a((dp38987
g2
(lp38988
VI tried with your example json / class, and the following works fine:
p38989
aVIs the actual code any different
p38990
aV(where  is the string - feel free to replace by  etc; or use , which is simpler)
p38991
as(dp38992
g18
V23354
p38993
stp38994
a((dp38995
g2
(lp38996
V(edit: note that the question changed; it didn't mention  initially; see revision  1)
p38997
aVWell,  leaps to mind; but otherwise this sounds like a  scenario:
p38998
as(dp38999
g18
V23354
p39000
stp39001
a((dp39002
g2
(lp39003
VFor , you have two choices:
p39004
aVuse /
p39005
aVwrite the  in code
p39006
aVThe second is closer to the
p39007
aVIf you are using LINQ-to-SQL, you can use  to combine multiple separate lambda expressions (see this answer) - however, this isn't supported in Entity Framework
p39008
aVIn EF, you have to build the entire expression as a single block, using ; for example here or here
p39009
as(dp39010
g18
V23354
p39011
stp39012
a((dp39013
g2
(lp39014
VFor a  function see this answer
p39015
aVTo get the properties of the list for data-binding purposes, you should really use the component-model (for compatibility) - i
p39016
ag50
aVThen look at each , using  /  etc
p39017
aVYour list code will generally have to work against the non-generic ; something like:
p39018
aVHowever, if you wanted to be "complete" you'd also need to look at  and
p39019
as(dp39020
g18
V23354
p39021
stp39022
a((dp39023
g2
(lp39024
VTo take the example literally, you could perform the combination in the question by building an  on the fly:
p39025
aVHowever, while this may work with LINQ-to-SQL, it won't work with EF since EF sadly hates
p39026
aVBut as Jon notes; if you are sending this down to a database backend, the priority is irrelevant and you might as well go with the logically equivalent
p39027
aVYou can combine expressions something like:
p39028
aVIf I've missed the point, please clarify
p39029
as(dp39030
g18
V23354
p39031
stp39032
a((dp39033
g2
(lp39034
VWell, it would need to be  to be possible to override it (by writing a dynamic type that inherits from the class), and you can't have a  (it makes no sense)
p39035
aVYou could perhaps override an , but I suspect even this may hit security issues
p39036
aVSo ultimately, I'd say no
p39037
as(dp39038
g18
V23354
p39039
stp39040
a((dp39041
g2
(lp39042
VIs there any more message that goes with it
p39043
aVFor info, the easiest way to combine paths is with :
p39044
aV(note also the  to ensure it is disposed)
p39045
aVor clearer still (IMO):
p39046
aV(of course, as has been mentioned elsewhere, a  may be inappropriate for mp3)
p39047
as(dp39048
g18
V23354
p39049
stp39050
a((dp39051
g2
(lp39052
VOne option (with LINQ-to-SQL at least) is to write the functionality you are missing as a UDF and add it to the data-context; then you can use  etc in your LINQ query
p39053
aVNote that this may have performance implications if you are wanting it to run it for every row in the table
p39054
aVEssentially your TSQL will involve , etc
p39055
as(dp39056
g18
V23354
p39057
stp39058
a((dp39059
g2
(lp39060
VFrom the  usage, I assume that the method (in your example) is generic in :
p39061
aVGiven the amount of reflection you are doing, this simply isn't doing you any favors; for use from reflection you might as well use:
p39062
aVAnd use (for example)  to create an instance
p39063
aVThe above can now be used with a delegate; for example a
p39064
as(dp39065
g18
V23354
p39066
stp39067
a((dp39068
g2
(lp39069
VSome complex scenarios aren't well mapped by LINQ; I would suggest that joining onto a  is one of them
p39070
aVRe doing it as a cross join
p39071
aVhave your profiled it
p39072
aV(i
p39073
ag50
aVthe subsequent SQLfrom the  (LINQ) vs the complex  (TSQL)
p39074
aVIn many cases the profiler can get the same (or similar) query plan from the old-style approaches
p39075
as(dp39076
g18
V23354
p39077
stp39078
a((dp39079
g2
(lp39080
VYou could try adding the  attribute; no idea if that'll work
p39081
aVA few options that leap to mind:
p39082
aVbuild a class that does map 1:1 (by name), and then translate this data (via , or a LINQ query) into your actual intended class
p39083
aVwrite a wrapper SP that renames the column (not nice; you'd need a temp table, presumably forcing recompile due to DDL/DML interleave)
p39084
aVdrag the SP onto the data-context designer and rename the columns manually in the generated types (consdier this as an automated implementation of the first bullet)
p39085
aVmove (refactor) the interesting part of the SP into a UDF that you can call from your existing sp, and use the UDF directly from the data-context (drag the UDF onto the designer)
p39086
as(dp39087
g18
V23354
p39088
stp39089
a((dp39090
g2
(lp39091
V; note that the exact xml names can be controlled through various attributes, but all you really need is:
p39092
aVa public type
p39093
aVwith a default constructor
p39094
aVand public read/write members (ideally properties)
p39095
aVExample:
p39096
as(dp39097
g18
V23354
p39098
stp39099
a((dp39100
g2
(lp39101
VAssuming you mean to interrupt (cancel) the work on the current queue
p39102
aVChanging the max-threads won't affect the pending work; it'll just change the number of threads available to do it - and it is generally a bad idea to mess with this (your code isn't the only thing using the )
p39103
aVI would use a custom queue - it is fairly easy to write a basic (thread-safe) producer/consumer queue, or
p39104
aVNET 4
p39105
aV0 includes some very good custom thread queues
p39106
aVThen you can just abort the custom queue and start a new one
p39107
aVI wrote a simple one here; at the moment it wants to exit cleanly (i
p39108
ag50
aVdrain the queue until it is empty) before terminating, but it would be easy enough to add a flag to stop immediately after the current item (don't resort to interrupting/aborting threads at an arbitrary point in execution; never a good idea)
p39109
as(dp39110
g18
V23354
p39111
stp39112
a((dp39113
g2
(lp39114
VIn general, custom serialization (via ) over either SOAP or WCF is a bad idea
p39115
aVIf you are using assembly-sharing with WCF (i
p39116
ag50
aVrather than proxy generation, you ship the DTO assembly to the client) then it can work, but it still violates SOA/mex etc
p39117
aVActually, I'm surprised it doesn't just give you  or similar, but heh
p39118
aVI would simply map your existing () object model into simple types that can use the standard serialization (i
p39119
ag50
aVno )
p39120
aVBTW; have you looked at ADO
p39121
aVNET Data Services
p39122
aVThis already handles  over the wire (although not as a value)
p39123
aVFor passing as values, MetaLinq
p39124
as(dp39125
g18
V23354
p39126
stp39127
a((dp39128
g2
(lp39129
VWell, if by 3 you mean the method under inspection should be non-recursive; then that is a pain - you'd need to parse the IL
p39130
aVBut for the others;
p39131
as(dp39132
g18
V23354
p39133
stp39134
a((dp39135
g2
(lp39136
VI wonder if you could test for  and use a conditional
p39137
aVBut I actually wonder if moving away from the Dynamic LINQ Library would be better; consider (untested):
p39138
aVstring[] columnNames = { "Name", "DoB" };
p39139
aVstring query = "2008";
p39140
aVThen you should be able to use  in regular LINQ; note that this won't work with LINQ-to-Objects () due to nulls, but will probably be OK in LINQ-to-SQL; if you need it to work in LINQ-to-Objects too that is fine - just need to add a few more details to the above (let me know)
p39141
as(dp39142
g18
V23354
p39143
stp39144
a((dp39145
g2
(lp39146
VMy interpretation is that it will always interpret it in a format that happens to look a lot like C#, yes
p39147
aVSo  for members-access, etc (the same as data-binding uses  for member-access, regardless of the caller's language)
p39148
aVIt is also a lot like the  pattern, if you see the relationship ( etc)
p39149
aVOf course, if the expression gets too complex you could consider a debugger type proxy
p39150
as(dp39151
g18
V23354
p39152
stp39153
a((dp39154
g2
(lp39155
VInteresting; that is a problem I have seen before when using an , which is why I now religiously consume all the tables (even if I am only expecting one) - for example, if I am only expecting one table, something like:
p39156
aVThe problem is that the error goes into the TDS at the point you raise it; so if you raise it after the  then in follows table in the TDS - and if the reader doesn't read to the end of the stream they might not see it
p39157
aVI'll be honest - my preferred answer to this is: raise all errors before data
p39158
aVThis might mean doing the main  into a temp-table () or table-variable ()
p39159
aVBeyond that - if it is critical to catch this error (and if the inbuilt LINQ-to-SQL code isn't helping), then perhaps fall back to  and something like the above
p39160
aVI suspect (but I haven't checked) that you could also use  to do some of the ORM heavy-lifting; for example:
p39161
as(dp39162
g18
V23354
p39163
stp39164
a((dp39165
g2
(lp39166
VFirst you need to figure out where the bottleneck is; the usual culprits:
p39167
aVlatency; you mention 3 calls (rather than 300), so I don't think this is the issue
p39168
aVbandwidth; how fat are the objects you want to send
p39169
aVcore db query performance; how fast is your
p39170
aVlazy loading issues; are you actually doing n+1 db operations
p39171
aVInvestigate the last two with a SQL trace, or some simple logging (LINQ-to-SQL has a  property that can be very useful here); a SQL trace may be more accurate
p39172
aVTo investigate if the number of trips from the Silverlight client to the web-server is the issue, try a network trace; Fiddler or WireShark should do the job
p39173
aVIf bandwidth is the issue (i
p39174
ag50
aVsheer bulk of data over the wire), then consider:
p39175
aVcompression
p39176
aVa different serializer
p39177
aVFor example, protobuf-net can make huge differences to the size on the wire; either might require slightly different code, though - the simplest approach being to pass a  over the service (and using MTOM if possible)
p39178
as(dp39179
g18
V23354
p39180
stp39181
a((dp39182
g2
(lp39183
VIt (based in part on the earlier question) sounds like bandwidth is the issue; I would give serious thought to trying protobuf-net; the "protocol buffers" format designed by Google is very efficient (much more so that the default ), and it can be used very conveniently from
p39184
aVNET
p39185
aVIdeal for bandwidth-related scenarios
p39186
aVThe only glitch is that currently the WCF hooks don't work with Silverlight (so you can't just add an attribute / config entry), but you can pass the data as a  easily enough (just return  from a method)
p39187
aVFor example; if you have a record like:
p39188
aVand a , then you should be able to use:
p39189
aVI've also seen somebody return a  on the operation-contract (rather than a ) - which seemed to work better with MTOM (hint: you definitely want to enable MTOM if possible when passing raw binary)
p39190
as(dp39191
g18
V23354
p39192
stp39193
a((dp39194
g2
(lp39195
VWell, the easiest (and most accurate) option would probably be to set it to the max in the config (so it doesn't explode) and use WireShark to measure it during transmission; in theory you could use WCF message logging/tracing, but I've had hit-and-miss results when using that with large messages
p39196
aVAlternatively, you could try using  to write the data to a , and look at the  of the stream
p39197
aVNote that if you are using classes (rather than ), you might find another serializer helps; it isn't 100% scientific, but I recently compared  and protobuf-net
p39198
as(dp39199
g18
V23354
p39200
stp39201
a((dp39202
g2
(lp39203
VSince bandwidth seems to be the issue (previous questions etc)
p39204
aVIf the data is simple text strings, then things like GZIP compression may work wonders
p39205
aVI would be very tempted to investigate transforming the  into something as simple as tsv (or another delimited form), and run it through a  (encoding line by line)
p39206
aVThen send the resultant binary down the wire either as a  or a
p39207
aVAnd enable MTOM
p39208
as(dp39209
g18
V23354
p39210
stp39211
a((dp39212
g2
(lp39213
VIf you have moved it, then add a reference to the dll where it now resides, and use :
p39214
aVThis will be enough for some requests (including  IIRC) looking for a type to find it in the new assembly
p39215
aVHowever, IIRC it only works for outermost types (not nested types, and probably not generics), and you can't have renamed it / changed the namespace / etc
p39216
aVRenaming is tricker
p39217
aVis notoriously brittle about such things
p39218
aVIMO, it is only suitable for serializing transient data between two tightly coupled systems (for example, exchange between two s in the same process; when used for storage, or between systems that might get out of sync, it can be a nightmare
p39219
aVIt may be too late, but I would recommend using a contract-based serializer (rather than a type-based serializer); any of ,  (as long as you use the / attributes), etc
p39220
aVOf if you want fast binary, protobuf-net would do a good job (and can hook into  if you need)
p39221
aVAnother concept that might be worth looking at is serialization surrogates, but that is relatively hard
p39222
aVBut IIRC this gives you the control over the type that is created - but you need to do a lot of the work for it
p39223
as(dp39224
g18
V23354
p39225
stp39226
a((dp39227
g2
(lp39228
VTo be serializable via , your types must
p39229
aVbe public
p39230
aVhave a public parameterless constructor
p39231
aVit serializes the public read/write fields and properties (properties being preferred)
p39232
aVIn terms of which constructs;
p39233
aVindividual concrete entities are fine
p39234
aVconcrete lists/arrays (, , etc) are handled fine
p39235
aVbut it will struggle with interfaces, dictionaries, and various generics scenarios (other than lists)
p39236
aVYou are right that  is fine for serializing a set of like objects
p39237
aVIf you are dealing with subclasses, then  can be used to distinguish types; i
p39238
ag50
aVif you have:
p39239
aVthen this may still be serializable as long as you have:
p39240
aV(you can also specify this relationship in the ctor to , but it is extra work)
p39241
aVI don't recommend using  unless you have to; it is complex and hard to get right
p39242
aVMore importantly; it doesn't work *at all if you are using wsdl-generated proxy objects over a SOAP service; the other end won't have your  implementation
p39243
aVI also don't recommend serializing lists of arbitrary object types; if you have a finite set of known types there are tricks to do this utilising  etc
p39244
as(dp39245
g18
V23354
p39246
stp39247
a((dp39248
g2
(lp39249
VYou set the inner exception by calling the base ctor:
p39250
aVIf you need to run some code to get the exception, use a static method:
p39251
as(dp39252
g18
V23354
p39253
stp39254
a((dp39255
g2
(lp39256
VOne problem I can see is that you'll get lots of collisions for new (unsaved) records (lots of zeros) - unless you do something like have consecutive -ve ids for those
p39257
aVBut do you really need to use  as a key
p39258
aVPersonally I don't think I'd bother
p39259
as(dp39260
g18
V23354
p39261
stp39262
a((dp39263
g2
(lp39264
VIt is impossible to support properly in all sequences; many are once only (network streams, etc)
p39265
aVAnd if you can't rely on it all the time, it is useless, as the abstraction is broken
p39266
aVSure you could have an , but  on  doesn't
p39267
aVwork
p39268
aVFrankly, it was a mistake (IMO)
p39269
aVI suspect it would also have made iterator blocks even more complicated (they are currently one of the two most complex parts of the compiler; I can't remember which is "top"; them, or anonymous methods / captured variables)
p39270
as(dp39271
g18
V23354
p39272
stp39273
a((dp39274
g2
(lp39275
VI'm not hugely familiar with the C++ API; but the length prefix itself is pretty simple if you write the data to a buffer first, especially if you use the fixed-width 32-bit encoding (rather than base-128 variable-length)
p39276
aVSee also this thread on the google-groups forum
p39277
as(dp39278
g18
V23354
p39279
stp39280
a((dp39281
g2
(lp39282
V looks at the list version of metadata; the rules for this are
p39283
aVcomplex:
p39284
aVif the data-source implements ,  is evaluated and used as the data-source (continue at 2)
p39285
aVif the data-source implements ,  is used to obtain metadata (exit)
p39286
aVif a typed (non-) indexer can be found (i
p39287
ag50
aV), then  is used as the source via :
p39288
aVif a  is assigned, the this is used for metadata against the type  (exit)
p39289
aVotherwise reflection is used for metadata (exit)
p39290
aVif the list is non-empty, the first object is used for metadata via :
p39291
aVif  is implemented, then it is used (exit) [*]
p39292
aVif a  is assigned, the this is used for metadata against the type  (exit) [*]
p39293
aVotherwise reflection is used (exit)
p39294
aVelse metadata is unavailable (exit)
p39295
aV([*]=I can't remember which way around these two go
p39296
aVIf you are using  (or similar), then you hit the "simplest" (IMO) case - #3
p39297
aVIf you want to provide custom metadata, then; you best bet is to write a  and associate it with the type
p39298
aVI can write an example but it'll take a while (on the train, probably)
p39299
aVEdit: here's an example that uses ; I'll try to tweak it to use  instead
p39300
aVSecond edit: a full (yet minimal) example using  follows; long code warning
p39301
as(dp39302
g18
V23354
p39303
stp39304
a((dp39305
g2
(lp39306
VIf you've already decided that it must be a string, then your options are somewhat limited
p39307
aVThe Dynamic LINQ library would indeed do the job, or if you want t know how it all works, look at this previous answer which builds an  from the string at runtime
p39308
aVAt the moment the code only accepts a single member and has separate methods for ascending / descending, but from this example it should be fairly simple to pass a more complex string and split it; essentially as:
p39309
as(dp39310
g18
V23354
p39311
stp39312
a((dp39313
g2
(lp39314
VIn short this is a pain in 1
p39315
aV1 (and partly 2
p39316
aV0 too)
p39317
aVAssembly-sharing (or type-sharing) only really started being a feature in WCF (
p39318
aVNET 3
p39319
aV0)
p39320
aVThe proxies generated in 1
p39321
aV1 will never be directly compatible with the "actual" classes; you can share the same proxies between multiple services ("sharetypes"
p39322
aV, but not with independent source files, IIRC
p39323
aVAnd since it is C# 1
p39324
aV2 you have neither partial classes nor extension methods to cheat with to translate them
p39325
aVOptions (that I can see):
p39326
aVwrite a static utility method to laboriously translate between the two object models
p39327
aVditto but using  (less code, but not as quick)
p39328
aVlive with it
p39329
aVupgrade to WCF (quite a significant change)
p39330
as(dp39331
g18
V23354
p39332
stp39333
a((dp39334
g2
(lp39335
VYup; that isn't easy
p39336
aVFor simple cases you can try running the sp (awooga
p39337
aVpassing nulls for all the parameters, and using  - a bit risky (extended sprocs are stll executed, for example) and not robust since the TSQL could branch on the input
p39338
aVBut an option
p39339
aVThe "out" ets should be available via metadata; the "old" way would be  (there is probably an info-schema alternative for doing it the right way)
p39340
aVJust as an update; if you want the database to describe itself as an API, perhaps consider UDFs for the selects; advantages:
p39341
aVthe metadata for the return values is rigid and easy to query
p39342
aVit is composable at the caller
p39343
aVOr; just use an ORM
p39344
aVLINQ-to-SQL will work happily with this type of setup (including composability); Entity Framework will certainly do all that hard work for you for stored procedures
p39345
aVOr any of the others; NHibernate, LLBLGen Pro, etc
p39346
aVThey have all tackled this exact problem
p39347
aVIt isn't trivial; why re-invent it
p39348
as(dp39349
g18
V23354
p39350
stp39351
a((dp39352
g2
(lp39353
VGenerally, in a disconnected environment optimistic concurrency with a / is the preferred approach
p39354
aVWCF does support distributed transactions, but that is a great way to introduce lengthy blocking into the system
p39355
aVMost ORM tools will support / out-of-the-box
p39356
aVOf course, at the server you might want to use transactions (either connection-based or ) to make individual repository methods "ACID", but I would try to avoid transactions on the wire as far as possible
p39357
aVRe comments; sorry about that, I honestly didn't see those comments; sometimes stackoverflow doesn't make this easy if you get a lot of comments at once
p39358
aVThere are two different concepts here; the waiting is a symptom of blocking, but if you have 100 clients updating the same record it is entirely appropriate to block during each transaction
p39359
aVTo keep things simple: unless I can demonstrate a bottleneck (requiring extra work), I would start with a serializable transaction around the update operations ( uses this by default)
p39360
aVThat way yes: you get appropriate blocking (ACID etc) for most scenarios
p39361
aVHowever; the second issue is concurrency: if you get 100 updates for the same record, how do you know which to trust
p39362
aVMost systems will let the first update in, and discard the rest as they are operating on stale assumptions about the data
p39363
aVThis is where the timestamp/rowversion come in
p39364
aVBy enforcing "the timestamp/rowversion must match" on the UPDATE statement, you ensure that people can only update data that hasn't changed since they took their snapshot
p39365
aVFor this purpose, it is common to keep the rowversion alongside any interesting data you are updating
p39366
as(dp39367
g18
V23354
p39368
stp39369
a((dp39370
g2
(lp39371
VI'm not really sure how generics ties into data-volume; they are unrelated concepts
p39372
aVit also isn't clear to me why this requires you to read everything twice
p39373
aVBut yes: generics are fine when used in volume (why wouldn't they be
p39374
aVBut of course, the best way to find a problem is profiling (either server performance or bandwidth - perhaps more the latter in this case)
p39375
aVOf course the better approach is: don't show thousands of records on a web form; what is the user going to do with that
p39376
aVUse paging, searching, filtering, ajax, etc - every trick imaginable - but don't send thousands of records to the client
p39377
aVRe the updated question; the loop for setting properties isn't necessarily bad
p39378
aVThis is an entirely appropriate inner loop
p39379
aVBefore doing anything, profile to see if this is actually a problem
p39380
aVI suspect that sheer bandwidth (between server and client, or server and database) is the biggest issue
p39381
aVIf you can prove that this loop is a problem there are things you can do do optimise:
p39382
aVswitch to using  (rather than ), and use  to make it a lot faster
p39383
aVwrite code with  to do the job - requires some understanding of IL, but very fast
p39384
aVwrite a
p39385
aVNET 3
p39386
aV5 / LINQ  to do the same and use  - like the second point, but (IMO) a bit easier
p39387
aVI can add examples for the first and third bullets; I don't really want to write an example for the second, simply because I wouldn't write that code myself that way any more (I'd use the 3rd option where available, else the 1st)
p39388
as(dp39389
g18
V23354
p39390
stp39391
a((dp39392
g2
(lp39393
VThere are indeed a few tricks that might work; the  one you mention is pretty simple (by using a private property marked with ), but I'm not sure how you would know what type to convert it back to
p39394
aVThere is, however, an inheritance-based () way to handle a finite number of types (known in advance)
p39395
aVHere's a related example, but I'll see I can make it more specific to this case
p39396
aVWith regard to string-based approaches, you could use a prefix
p39397
ag412
ag50
aVsomething like:
p39398
aVOK; here's an example; I stress that it would be much better to work with fixed keys; the following is a bit ugly, but most of the code can be hidden away and re-used, so maybe not too bad
p39399
aVI'd prefer more strongly-typed keys, though
p39400
aVI might have mentioned that ;-p
p39401
as(dp39402
g18
V23354
p39403
stp39404
a((dp39405
g2
(lp39406
VIn general, no - you can only catch locally
p39407
aVThere are isolated exceptions occasions when you can do this - ASP
p39408
aVNET MVC controllers and WCF services being two examples that leap to mind where the error handling can easily (or easily enough) separated
p39409
aVBut in your case - don't you just want to add  to the affected tests
p39410
as(dp39411
g18
V23354
p39412
stp39413
a((dp39414
g2
(lp39415
VHohum, yup looks like a bug (now logged); repeatable example below
p39416
aVI'll see if I can fix it on the train (shortly)
p39417
aVSorry 'bout that:
p39418
as(dp39419
g18
V23354
p39420
stp39421
a((dp39422
g2
(lp39423
VI use  separation - for example
p39424
aVI also link it into the project tree via "dependentUpon" or whatever it is in the csproj, so that it nests under the file (in solution explorer) neatly
p39425
aVYou have to do that by hand (edit the csproj) or with an addin, though; for example:
p39426
aVappears as:
p39427
as(dp39428
g18
V23354
p39429
stp39430
a((dp39431
g2
(lp39432
VReally, you want to look for the Last-Modified header after issuing a  request (rather than a )
p39433
aVI wrote some code to get the  via  here
p39434
as(dp39435
g18
V23354
p39436
stp39437
a((dp39438
g2
(lp39439
VThe data in the array at the end of pointer  is updated, though:
p39440
aVSo yes; it is the data referred to be  that is updated
p39441
as(dp39442
g18
V23354
p39443
stp39444
a((dp39445
g2
(lp39446
VTo add some detail to the question you ask in the comments
p39447
aVin the good old (3
p39448
aV0) days WCF/ was pretty strict
p39449
aVIf your type wasn't explicitly marked as a  (or  for fallback) then it wouldn't serialize
p39450
aVIt used the members marked as , using the explicit name on the attribute if specified, or the member-name otherwise
p39451
aVLife was good
p39452
aVMore recently, the code was changed allowing "regular" types to be serialized - meaning: those without data-contracts
p39453
aVIt does this using the same approach as  uses - i
p39454
ag50
aVit works at the field-level
p39455
aVThis is IMO bad:
p39456
aVfields are the implementation, not the contract
p39457
aVit is brittle if you change
p39458
aVanything
p39459
aVit doesn't hold much water against obfuscation
p39460
aVsomething as innocent as switch to/from an auto-prop break it (auto-props have truly bizarre field names, that can't be emulated in regular C#)
p39461
aVI know why this was tempting (to allow WCF to transport arbitrary types), but every sinew in my body says this was a net loss
p39462
aVIt is much better to make people use the right tools (data-contracts) than it is to let their broken classes work
p39463
aVIn the original 3
p39464
aV0, there would have been an exception thrown telling you how to fix this correctly: mark it as a  and tell it which s you want to serialize
p39465
aVSee also: Obfuscation, serialization and automatically implemented properties
p39466
as(dp39467
g18
V23354
p39468
stp39469
a((dp39470
g2
(lp39471
VArguably, they have no place in the wsdl if they aren't used
p39472
aVyou can use  to specify known subtypes, but I don't think that is what you mean
p39473
aVYou could of course use a custom WSDL fragment, but I suspect the simplest option is, as you have hinted, to include a dummy method that involves them
p39474
aVTo avoid having to add lots of dummy methods you could include the custom types as properties on a  object returned from your  - but it smells a bit ripe ;-p
p39475
aVWhat do you want these types for
p39476
as(dp39477
g18
V23354
p39478
stp39479
a((dp39480
g2
(lp39481
VBy default,  (on a class) means reference equality; i
p39482
ag50
aVare they the same instance; what  would return
p39483
aVYou can provide your own == /
p39484
aV= operators to get the expected behaviour - and when you override  it is important to override  too (otherwise you break usage as a key - Why is it important to override GetHashCode when Equals method is overriden in C#
p39485
ag6864
as(dp39486
g18
V23354
p39487
stp39488
a((dp39489
g2
(lp39490
VEdit: if you just mean the delegate itself - I think you can just do:
p39491
aVYou could always capture it into the delegate; something like here: Async without the Pain, which lets you just use an  callback (or )
p39492
aVOther common patterns involve events for the callback, and perhaps ; a lot simpler than
p39493
aVPutting all this together; here's an example where neither the caller nor the code needs to get stressed about :
p39494
as(dp39495
g18
V23354
p39496
stp39497
a((dp39498
g2
(lp39499
VJust a random observation; the format would pass for python - so if you wanted to use some pre-existing code and offer more flexibility, you could just embed IronPython and use that to parse (execute) the config file
p39500
aVThis will tell you about any errors, and (upon success) should make the values available by lookup
p39501
aVProbably overkill - but actually flexible configuration scripts (as a DSL) is a bit of a strong point for python
p39502
as(dp39503
g18
V23354
p39504
stp39505
a((dp39506
g2
(lp39507
VWell, you could use , but that will return all the text-nodes inside the  tags
p39508
aVBut since the above isn't well-formed xml I'm not sure how you are going to use xpath on it
p39509
aVRegex is usually a poor choice for html, but there are html (not xhtml) parsers available
p39510
aVI hesitate to suggest one for ruby simply because that isn't "my area" and I'd just be googling
p39511
as(dp39512
g18
V23354
p39513
stp39514
a((dp39515
g2
(lp39516
VDepending on your interpretation of duck-typing, I would hope that this arrives in C# 4
p39517
aV0 and , when that becomes available on Silverlight
p39518
aVThen you can pick-and-choose which bits are duck-typed () vs static-typed (everything else)
p39519
aVAll within C#
p39520
as(dp39521
g18
V23354
p39522
stp39523
a((dp39524
g2
(lp39525
VThings like "MS_Description" etc
p39526
aVNot AFAIK; you could write an SP that talks to the store at the database (taking the database object name and column name), and query that via the data-context - but nothing built in
p39527
aVIt would also be pretty easy to write some code that uses  to get the database names (instead of the OO names) to pass in
p39528
aVSomething like:
p39529
aV(or something similar; just firing up a test db
p39530
aVWhere you provide the  method via a mapped SPROC
p39531
aVUpdate: yes, that kinda works; example:
p39532
aVThe  is a pain, but less ugly than having to have two selectors; it could be re-written that way, though:
p39533
aVUp to you which is less hacky
p39534
aVNote also that you'd need to split the owner out of
p39535
as(dp39536
g18
V23354
p39537
stp39538
a((dp39539
g2
(lp39540
VThe trick here is to use ExecuteReader in sequential mode, and read the data from the
p39541
aVHere's a version for CLOBs - BLOBs are virtually identical, but with a  and
p39542
aVSomething like:
p39543
as(dp39544
g18
V23354
p39545
stp39546
a((dp39547
g2
(lp39548
VYou can't do it directly, since you can't  and  with the same signature on the same type; there are two options - if you control the base class, add a second property:
p39549
aVElse you can introduce an extra level in the class hierarchy:
p39550
as(dp39551
g18
V23354
p39552
stp39553
a((dp39554
g2
(lp39555
VFor navigation
p39556
aVProbably :
p39557
aVFrom MSDN,
p39558
aVProvides a fast, read-only, in-memory representation of an XML document by using the XPath data model
p39559
aVUnlike  etc, it is optimised for readonly usage; more efficient but less powerful (i
p39560
ag50
aVyou can't edit it)
p39561
aVFor notes on how to query it, see here
p39562
as(dp39563
g18
V23354
p39564
stp39565
a((dp39566
g2
(lp39567
VIn C#, you have anonymous types; these are similar but have their own limitations:
p39568
aVHowever, it is hard to consume these as a caller, unless you use "cast by example" (brittle), reflection, or
p39569
aVOf the three, the last is the most appetising
p39570
aVIn most cases, it would be a better idea just to use a regular class - but this approach does have some practical uses; for example, look at how they are used in ASP
p39571
aVNET MVC to pass around configuration information simply and conveniently (which would otherwise require a dictionary)
p39572
aVA bit like how jQuery allows you to pass options as properties on an object
p39573
as(dp39574
g18
V23354
p39575
stp39576
a((dp39577
g2
(lp39578
VIt depends; from a reflection perspective: no
p39579
aVYou can't
p39580
aVBut if you are talking about attributes used by System
p39581
aVComponentModel in things like data-binding, they you can use  to append extra attributes
p39582
aVOr other customer models involving custom descriptors
p39583
aVSo it depends on the use-case
p39584
aVIn the case of xml serialization, it gets more interesting
p39585
aVFirstly, we can use fun object models:
p39586
aVThe  pattern (along with ) is recognised and used to control which elements to include
p39587
aVAnother alternative is to use the non-default ctor:
p39588
aVNote though that if you use this second approach you need to cache the serializer instance, as it emits an assembly every time you do this
p39589
aVI find the first approach simpler
p39590
as(dp39591
g18
V23354
p39592
stp39593
a((dp39594
g2
(lp39595
VTo get around delegate signatures, an anonymous method (or lambda) can help:
p39596
aVYou can also use captured variables to avoid the parameter completely
p39597
aVfor example (using a lambda this time, and the overload that takes a ):
p39598
as(dp39599
g18
V23354
p39600
stp39601
a((dp39602
g2
(lp39603
VThe lambda for  needs to take the entity type; I would expect that you would need:
p39604
aVHowever; the  method doesn't feel like an entity responsibility
p39605
aV(separation of concerns); which is why it isn't helpful in the "list" case; maybe you need to move that to the list
p39606
aVBut when it works, something like:
p39607
as(dp39608
g18
V23354
p39609
stp39610
a((dp39611
g2
(lp39612
VIdeally, you want to use  - you could of course cheat:
p39613
aVAnd use  passing in the selector and a bool
p39614
aVIf you don't need the static typing, you can also build the expressions dynamically from the ground up, of course - like this short sample (similar in nature to the dynamic LINQ library)
p39615
as(dp39616
g18
V23354
p39617
stp39618
a((dp39619
g2
(lp39620
VHmm
p39621
aVI'm surprised that compiles (it does, I checked)
p39622
aVI'm not aware of any guarantee that would make this safe
p39623
aVUse a static constructor
p39624
aVEdit: I accept (see better answer above) that it will work; but my idea with code is to keep it as simple and obvious as possible
p39625
aVIf it isn't obvious that it will work (and it can't be if you have to ask), then don't write it that way
p39626
aVIn particular, problems with relying on field order:
p39627
aVit can break if you move code around (which I often do)
p39628
aVit can break if you split the code into  classes
p39629
aVMy advice remains: use a static constructor for this scenario
p39630
as(dp39631
g18
V23354
p39632
stp39633
a((dp39634
g2
(lp39635
VUpdate : this is now fixed in r274; you would use:
p39636
aVUltimately the protocol buffers wire
p39637
aVformat doesn't provide any scope for [Flags] enums - it enforces enum values against
p39638
aVthe discreet set
p39639
aVI could allow this easily enugh, but:
p39640
aVI'd probably have to disable enum mappings in this case, or do a lot of ugly bit-
p39641
aVmatching work
p39642
aVit would not be strictly compatible
p39643
aVAn easier way of doing this may be to do a shim in your code:
p39644
aVThe other alternative would be to add a flag that works like the above on your
p39645
aVbehalf; treating it as an int rather than an enum
p39646
as(dp39647
g18
V23354
p39648
stp39649
a((dp39650
g2
(lp39651
VIf you want to expose a different view on your object model, then the simplest approach is simply to expose the data on a slimmer DTO - i
p39652
ag50
aVwrite a second class (typically in a different namespace) and translate the data between them
p39653
aVEither by hand (write some code, perhaps a static conversion operator, that does this), or with utilities like  (like so)
p39654
aVHaving a separate DTO also allows you to extend your core object model without silently impacting client performance, and makes versioning much simpler
p39655
as(dp39656
g18
V23354
p39657
stp39658
a((dp39659
g2
(lp39660
VIt would need to be a public property of an instance; in this case, the "this" would suffice:
p39661
aVFor two-way notification, you'll need either  or :
p39662
aVIf you don't want it on the public API, you could wrap it in a hidden type somewhere:
p39663
aVFor info, the "events list" stuff goes something like:
p39664
as(dp39665
g18
V23354
p39666
stp39667
a((dp39668
g2
(lp39669
VWith , you can exclude a field by marking it , but then you won't get the data
p39670
aVYou could use custom serialization (), but that is hard
p39671
aVPersonally, I'd use a different serializer; in particular,  or protobuf-net, either of which allows you to create a second property to use for the serialization, writing your own code to represent it as something simpler (a string, perhaps)
p39672
as(dp39673
g18
V23354
p39674
stp39675
a((dp39676
g2
(lp39677
VIt the problem is that you'd quite like to use just the one type:
p39678
aVWith
p39679
aVNET 2
p39680
aV0 web-service proxies this is a PITA, and you need to manually port data between the two
p39681
aVThankfully, this is fixed in WCF, which lets you use types (as long as they match) from other assemblies
p39682
aVYou can do this with the  param to , or the IDE walks you through it painlessly in VS2008
p39683
aVIs switching to WCF at the client a possibility
p39684
aVIf the problem is the namespaces - then either fully qualify them, or use type aliasing:
p39685
aVthen you can use  to represent  - but it is only an alias, and only works for the single code file
p39686
as(dp39687
g18
V23354
p39688
stp39689
a((dp39690
g2
(lp39691
V is designed to be a very direct translation of your objects to xml; you can use , but it is rarely worth it
p39692
aVYou would do better to create objects that mirror the xml structure
p39693
aVOr, simpler - use xsd to do it for you:
p39694
aVOr I suspect the following would work (untested):
p39695
aVIn particular; if you want the element names ("Customer" etc) to vary based on data ("Name" etc) - then it isn't going to hapopen unless you use , or write it yourself with  (or similar)
p39696
aVFor simple data like this, maybe  is a viable option
p39697
aVBut then you make a lot of extra work, especially during deserialization
p39698
aVHere's an example using your existing class via LINQ-to-XML:
p39699
as(dp39700
g18
V23354
p39701
stp39702
a((dp39703
g2
(lp39704
VYou could potentially wrap this in
p39705
aVNET 4
p39706
aV0 using  (note you'd still have to write the code that provides the dynamic behaviour, which isn't trivial) - not sure I'd bother though
p39707
aVNote that ASP
p39708
aVNET MVC uses some good code for automatically mapping request inputs (in the route (= path), the form, the query-string, etc) into method parameters and object properties
p39709
aVIf you value this kind of automation, try ASP
p39710
aVNET MVC ;-p
p39711
as(dp39712
g18
V23354
p39713
stp39714
a((dp39715
g2
(lp39716
V= can be confused with assignment and equality; actually, the form I really don't like is when it looks like a string (usually when spaces are involved):
p39717
aVor
p39718
aVI far prefer the alternative notation:
p39719
as(dp39720
g18
V23354
p39721
stp39722
a((dp39723
g2
(lp39724
VAnd by that do you mean a 1024-bit integer
p39725
aVBetter wait until  in 4
p39726
ag190
aVUntil then, the cheekiest you can do with the core libraries is to (ab)use , which has 96 bits for the integer part
p39727
aVOr use a 3rd-party dll
p39728
as(dp39729
g18
V23354
p39730
stp39731
a((dp39732
g2
(lp39733
VI think you haven't grouped by day; perhaps something like:
p39734
aVUpdate re comment; to reverse it, something like:
p39735
aVTo filter to a specific day:
p39736
as(dp39737
g18
V23354
p39738
stp39739
a((dp39740
g2
(lp39741
VSo you want the deep () version to skip the list
p39742
aVto
p39743
aVdoesn't look at  - it just looks at the public members () - so it should still serialize them
p39744
as(dp39745
g18
V23354
p39746
stp39747
a((dp39748
g2
(lp39749
VYou have a few choices for strings; xml, which can be done simply with  (or , but that offers much less control over the xml) or JSON (JSON
p39750
aVnet, etc)
p39751
aVTypical classes for  would look simply like:
p39752
aV(note I would expect the above to work the JSON
p39753
aVnet too)
p39754
aVThe above class should also work fine in data-binding scenarios etc, thanks to the properties
p39755
aVYou would serialize this:
p39756
aVbut you can customize the xml:
p39757
aVis ideally more like:
p39758
as(dp39759
g18
V23354
p39760
stp39761
a((dp39762
g2
(lp39763
VIt sounds like you've got back an empty object; so to understand that we really need to see the class itself
p39764
aVASMX uses , which serializes public properties and fields; so as long as you have something like:
p39765
aVIt should work fine
p39766
aVNote that it doesn't look at interface-specific members, read-only/write-only members, internal members, etc
p39767
aVTrivial aside: it is fine to declare and init on the same line, but this won't impact the above (but it makes it simpler to read, IMO):
p39768
aVor (if you want) in C# 3
p39769
aV0:
p39770
as(dp39771
g18
V23354
p39772
stp39773
a((dp39774
g2
(lp39775
VAn interesting question
p39776
aVIn my fevered opinion, with a few exceptions (*), most APIs should target properties (for all the usual reasons) unless the developer gives indication (for example, by marking a field with an attribute)
p39777
aVSo I largely agree
p39778
aVIndeed, there is very little performance issue
p39779
aVThe biggest reason I can think of (from experience) is that read-only properties are a pain; maybe that is what they are thinking of
p39780
aVBut that is a poor excuse
p39781
aV*=the exception being things like  which by definition is (by default) a state serializer
p39782
aVAnd I'm not a fan of that ;-p
p39783
as(dp39784
g18
V23354
p39785
stp39786
a((dp39787
g2
(lp39788
VYou would have to use use  (non-generic); I posted a reply using , but that will still cheat (it checked for the desired type as a special case) - you might need something like:
p39789
as(dp39790
g18
V23354
p39791
stp39792
a((dp39793
g2
(lp39794
VIn regular
p39795
aVNET, it doesn't and can't (unless you tell it manually); sorry
p39796
aVYou'll need to include some  in the attribute constructor / properties
p39797
aVIf you are talking AOP (PostSharp etc), then all bets are off
p39798
aVIf you mean some of the attributes used by  (, , etc), then there may be other options - but rather specific and non-trivial to implement
p39799
as(dp39800
g18
V23354
p39801
stp39802
a((dp39803
g2
(lp39804
VAnother two thoughts; you can use C# 3
p39805
aV0 auto props if you like, but you need to use the constructor to do the initial :
p39806
aVAlso; if you are using xml serialization via , the property (annoyingly) needs to have a () setter (regardless of whether you use auto-props or an explicit field); much gnashing of teeth over this (also, the class must be ):
p39807
as(dp39808
g18
V23354
p39809
stp39810
a((dp39811
g2
(lp39812
VFirstly, you don't need the , since you are already correctly working on two threads
p39813
aVRemove that
p39814
aVAfter that, I expect the problem is simply doing too much too quickly
p39815
aVIs it possible to batch updates, and only send an update, say, every 20
p39816
aV50
p39817
aVtimes
p39818
aVIt isn't clear what the control is, but many have multiple-update modes; for example with :
p39819
aVI would then see about passing over a list of updates, say, every 20 times (unless each takes a considerable time) [note it must be a different list per , and you need to remember to send any remaining items at the end, too]
p39820
as(dp39821
g18
V23354
p39822
stp39823
a((dp39824
g2
(lp39825
VI used to struggle with MSTest, in a lot of areas (including code-coverage) - frankly, it* doesn't exactly go out of its way to make life easy - especially with the extra testrunconfig etc duplicating a lot of things already in the csproj
p39826
aVAnyway; than I found that TestDriven
p39827
aVNET has this built in (as long as you have the right edition of Visual Studio to include MSTest and coverage):
p39828
aVThis will use your existing test framework (including MSTest), but it will jump through all the usual hoops to get test coverage enabled, without you needing to mess with the configuration
p39829
aVIt even works with the source-code colorization (red/blue untested/tested etc)
p39830
aVHandy
p39831
aV*=the tool itself, and the GUI integration
p39832
as(dp39833
g18
V23354
p39834
stp39835
a((dp39836
g2
(lp39837
VI wonder whether xaml wouldn't do most of what you want for free
p39838
aVBut if you want bespoke data, I too would suggest that csv has had its day, especially when the data gets complex
p39839
aVFor a complete xml example (written for space, so ignore the formatting):
p39840
aVThis way you mainly deal with the object model, not the serialization
p39841
aVIndeed, it would be trivial to modify the above to use  (for WCF), protobuf-net (portable binary), etc
p39842
as(dp39843
g18
V23354
p39844
stp39845
a((dp39846
g2
(lp39847
VIf you only want the  column to be manipulated, then it is usually better to simply set up the column bindings (for things like ) manually; however, you can also use things like  (removes a property from display) and  (treat a property as read-only even if it has a setter) to control how properties (/columns) are handled
p39848
aVIf you want to control how new instances are created, inherit from  and override
p39849
as(dp39850
g18
V23354
p39851
stp39852
a((dp39853
g2
(lp39854
VValues for user settings are typically saved to a  in the user's profile, especially for published apps
p39855
aVThe exe
p39856
aVconfig is not really intended to be edited at runtime, as it comes back to the installation (protected by system) vs documents (user) issue, especially for non-admins
p39857
aVCheck for a location such as:
p39858
aV{user profile}\u005cAppData\u005cLocal{appname}\u005c{appname}
p39859
aVexe_{gibberish}\u005cuser
p39860
aVconfig
p39861
as(dp39862
g18
V23354
p39863
stp39864
a((dp39865
g2
(lp39866
VIt sounds like there is a  somewhere that is unhappy
p39867
aVThe  and  sounds like you are keeping a  hanging around, which I expect will contribute to this
p39868
aVTo be honest, in most common cases you are better off just using the inbuilt connection pooling, and  your connections locally - i
p39869
ag50
aVHere you get a clean , which will be mapped to an unmanaged connection via the pool, i
p39870
ag50
aVit doesn't create an actual connection each time (but will do a logical reset to clean it up)
p39871
aVThis also allows much more flexible use from multiple threads
p39872
aVUsing a  connection in a web app, for example, would be horrendous for blocking
p39873
as(dp39874
g18
V23354
p39875
stp39876
a((dp39877
g2
(lp39878
VIf I am returning simple data (not a page), I probably wouldn't use aspx; that is really web-forms, but what you are returning isn't a web-form
p39879
aVTwo options leap to mind:
p39880
aVuse ASP
p39881
aVNET MVC; sounds corny, but it really is geared up to return different types of response much more elegantly
p39882
aVuse a handler (ashx) - which omits all the web-form noise, just leaving you with a  with which to construct your response
p39883
aVYou could also try (within aspx) clearing the response (
p39884
aVand calling  afterwards
p39885
aVBut IMO a lot more roundabout than just using a handler
p39886
as(dp39887
g18
V23354
p39888
stp39889
a((dp39890
g2
(lp39891
VThat isn't the default/element namespace, though - it is simply an unused alias to a namespace that might be used
p39892
aVIt isn't actually breaking anything
p39893
aVI would strongly advise to simply leave it alone
p39894
aVIf you really, really wanted to do this - perhaps write a message inspector
p39895
as(dp39896
g18
V23354
p39897
stp39898
a((dp39899
g2
(lp39900
VRather than fight the source, perhaps ask the  to officiate:
p39901
aV(and don't set  on the list)
p39902
as(dp39903
g18
V23354
p39904
stp39905
a((dp39906
g2
(lp39907
VIIRC You would need to call  on the additional controls (perhaps placing them in a second  and calling  on that)
p39908
aVSee MSDN for an example
p39909
as(dp39910
g18
V23354
p39911
stp39912
a((dp39913
g2
(lp39914
VThat does return 2008 for me
p39915
aVIs that your actual code
p39916
aVFor info, 0x07d9 is simply 2009 in hex
p39917
aVYou can toggle this in the debugger by hovering over the value and checking / unchecking "Hexadecimal Display"
p39918
as(dp39919
g18
V23354
p39920
stp39921
a((dp39922
g2
(lp39923
VIt is easier to work with , but if you don't control the property this isn't an option
p39924
aVNote that this is seen commonly in soap-generated proxies, but IIRC there is a command-line switch you can use if you prefer lists to arrays
p39925
aVNote that if you are doing this regularly, an extension method may be helpful:
p39926
aVWhich you can then use for your property:
p39927
aV(note this works even if  is null, creating an array of length 1)
p39928
aVIf it were a field/variable, then a simple  argument might also work:
p39929
as(dp39930
g18
V23354
p39931
stp39932
a((dp39933
g2
(lp39934
VI have a related issue in some open-source code that I maintain; I have separate project files, but to reduce maintenance, I use a hand-crafted project file that automatically includes all *
p39935
aVcs files in the project tree:
p39936
aVThis way, I don't have to keep remembering to add files to the other build scripts - although I do need to be religious about deleting obsolete files (not just removing them from the project)
p39937
as(dp39938
g18
V23354
p39939
stp39940
a((dp39941
g2
(lp39942
VAs already noted in comments; note that the example given is susceptible to issues with captured variables if used asynchronously - but probably OK "as is"
p39943
aVTo do it thoroughly involves a lot of edge-cases (or you can cheat and use ) - but here's an example that shows the overall themes (without using ):
p39944
as(dp39945
g18
V23354
p39946
stp39947
a((dp39948
g2
(lp39949
VLike so:
p39950
aVAlternatively; just add a reference to LINQBridge
p39951
as(dp39952
g18
V23354
p39953
stp39954
a((dp39955
g2
(lp39956
VYou can't 100% pretend it was there from the beginning; you're going to have to work around it
p39957
aVIf the code is in an external text file, you have a number of options:
p39958
aVuse  to compile the code at runtime; you'd need to add extra fluff to make it a well-defined class (presumably implementing a common interface); then use reflection to create an instance of the type; yeuch - and beware you can't unload, etc
p39959
aVwait until
p39960
aVNET 5
p39961
aV0 and hope that the compiler-as-a-service stays
p39962
aVuse Mono, where compiler-as-a-service already exists
p39963
aVrun the external file as (for example) a python script via IronPython (note that this changes the script language)
p39964
aVI'd look at the last option (IronPython) first
p39965
aVseems made for this job
p39966
as(dp39967
g18
V23354
p39968
stp39969
a((dp39970
g2
(lp39971
VThe fact that you have duplicates (in terms of multiple files requiring B) means that it would be a pain to use the most obvious "requires" structure as a tree, since that would involve nesting B multiple times (from different parents)
p39972
aVA few options:
p39973
aVkeep the object-references in the object model, but only list the name (or some other reference) in the file; relatively simple to do, but requires fixups after deserialization
p39974
aVonly list the name (or some other reference) in the relationship, and mirror this in the object model - i
p39975
ag50
aV"file
p39976
aVParent" is a key, not another object
p39977
aVhave the full object model, and use a graph serializer, such as  with preserve-object-references enabled
p39978
aVI would probably choose between the last two; the last has "not very pretty" xml, but is relatively simple to implement
p39979
aVBut I'd be tempted to just use the middle option, and have just the key references in the object model, i
p39980
ag50
aVmaybe not pure OO, but simple to do
p39981
aVAlso - avoid the need to duplicate data; if you store it just like the above, you can always scan to see "what uses this file" (with some indexing if you need)
p39982
aVBut trying to maintain relationships in both directions (i
p39983
ag50
aV"UsedBy") is a nightmare
p39984
as(dp39985
g18
V23354
p39986
stp39987
a((dp39988
g2
(lp39989
VIn short - I don't think this has anything to do with your xml code, nor any of the code
p39990
aVposted
p39991
aVI expect you're going to have to clarify what the other code () does for us to help
p39992
aVWell, for me:
p39993
aVOutputs:
p39994
aVSo it seems to work fine
p39995
aVTreble-check your xml, and treble-check your report method ()
p39996
aVIt all seems fine in the code you have posted
p39997
as(dp39998
g18
V23354
p39999
stp40000
a((dp40001
g2
(lp40002
VHow about:
p40003
aVOr in 2
p40004
aV0:
p40005
aVThen display  however you want
p40006
aVFor displaying in a :
p40007
as(dp40008
g18
V23354
p40009
stp40010
a((dp40011
g2
(lp40012
VA few thoughts:
p40013
aVhas it actually changed value - it is very lazy, and only persists perceived changes; calling the  is not enough
p40014
aVis it part of the primary key / identity
p40015
aV(the  makes me think not, though)
p40016
aVis it in the dbml
p40017
aVor did you add it manually and forget
p40018
as(dp40019
g18
V23354
p40020
stp40021
a((dp40022
g2
(lp40023
VNot tested (for obvious reasons), but something like:
p40024
as(dp40025
g18
V23354
p40026
stp40027
a((dp40028
g2
(lp40029
VAn alternative using , allowing custom object models to show flexible properties at runtime (i
p40030
ag50
aVwhat you see can be more than just what is on the class, and can use custom type-converters to do the string conversion):
p40031
aVNote that reflection is the default implementation - but many other more interesting models are possible, via  and
p40032
as(dp40033
g18
V23354
p40034
stp40035
a((dp40036
g2
(lp40037
VIt is a pretty reasonable way to do it (I've done something very similar before) - but there are always downsides:
p40038
aVany code needing the entity will need the extra reference (assuming that the attribute and entity are in different assemblies)
p40039
aVthe values (unless you are clever about it) must be determined at compile-time
p40040
aVyou can't use it on entities outside of your control
p40041
aVIn most cases the above aren't a problem
p40042
aVIf they are an issue, you might want to support an external metadata model - but unless you need it, this would be overkill
p40043
aVDon't do it unless you must (meaning: go ahead and use attributes; they are usually fine)
p40044
as(dp40045
g18
V23354
p40046
stp40047
a((dp40048
g2
(lp40049
VWell, having a conflicting property and namespace and class name is usually a big warning sign (or 3, in this case); the first thing I'd try is fixing the names to be unambiguous;
p40050
as(dp40051
g18
V23354
p40052
stp40053
a((dp40054
g2
(lp40055
VFrom code, the closest you can do it to hide it, and perhaps make it a pain to call directly - note that even when hidden it is callable, and none of this will work past a cast:
p40056
aVPersonally, I wouldn't bother
p40057
aVIt isn't robust (just cast)
p40058
as(dp40059
g18
V23354
p40060
stp40061
a((dp40062
g2
(lp40063
VYou can use  to write to a stream:
p40064
aVAnd write the  to a  /  / etc column in a database if that is what you need (you mentioned database) - or just use xml
p40065
aVIf you are writing to a file, then just use a  in place of a
p40066
as(dp40067
g18
V23354
p40068
stp40069
a((dp40070
g2
(lp40071
VDon't call one of your types  - that is a seriously bad idea; you will regret it
p40072
aVpick a different name
p40073
aV(or , etc)
p40074
aVAre you sure the error isn't actually on the line above ( etc)
p40075
aVUnfortunately, you don't show any of the code relating to  (for example, could it have become ), and you don't indicate if (for example) you have added any  methods to the data-context or entity, or have any events
p40076
aVI would expect the problem to be in one of those areas
p40077
as(dp40078
g18
V23354
p40079
stp40080
a((dp40081
g2
(lp40082
VIn the code as written - the enumerator will keep on going
p40083
aVThe point about  is that all your code needs to agree
p40084
aVIf you had used:
p40085
aVThen when your other thread attempts to acquire the lock it will queue behind the first - waiting for the first thread to release the lock (either by exiting the  (), or calling )
p40086
as(dp40087
g18
V23354
p40088
stp40089
a((dp40090
g2
(lp40091
VSure - just use  on the table's rows and you're done:
p40092
aVFor a typed , I don't think even this is needed
p40093
aVNote that LINQ queries the data (into a new/independent query) - it doesn't filter the existing table
p40094
as(dp40095
g18
V23354
p40096
stp40097
a((dp40098
g2
(lp40099
VWould a generic method be acceptable
p40100
aVOtherwise; wait until
p40101
aVNET 4
p40102
aV0 / C# 4
p40103
aV0 / VS2010
p40104
as(dp40105
g18
V23354
p40106
stp40107
a((dp40108
g2
(lp40109
VIf you are exposing the underlying , then in short: you can't
p40110
aVYou could write your own collection-wrapper class, or perhaps inherit from  (which still exposes , but you can  a few things to sense-check data before it is added)
p40111
as(dp40112
g18
V23354
p40113
stp40114
a((dp40115
g2
(lp40116
VYou could use  to deserialize it
p40117
as(dp40118
g18
V23354
p40119
stp40120
a((dp40121
g2
(lp40122
VWell, the WCF-generated proxies are  classes, so you can add behaviour at the client, even if you are using mex-generation
p40123
aVYou can also use assembly-sharing ( at the command-line, or check the boxes in the IDE) - then you can use the exact same type at client and server, but it breaks most rules of "pure" SOA
p40124
aVIt depends on how "pure" you feel, I guess
p40125
aVThe pain of being pure but having to maintain two similar code bases may outweigh the convenience but dirtyness of assembly-sharing
p40126
aVIt depends on what the app is
p40127
aVI've happily used assembly-sharing on a number of occasions, and I feel no guilt; it was the most sensible option for the scenario
p40128
aVJust remember that client code is a convenience - always treat the client as hostile, so even if your client uses assembly sharing, remember that a hostile client may not, so won't adhere to your rules; always validate at the server
p40129
as(dp40130
g18
V23354
p40131
stp40132
a((dp40133
g2
(lp40134
VThe example xml is confusing, because in most cases the serializer will omit nulls, especially for attributes
p40135
aVThe exception to this is  when used with elements, for example:
p40136
aVMight result in:
p40137
aVWhich is again very different to your example xml
p40138
aVIn the general case, it is possible to control serialization using a number of methods:
p40139
aVthe  property of
p40140
aVadding a
p40141
aVadding a  method
p40142
aVadding a  property
p40143
aVHowever; without a repeatable example to run your example against, it is impossible to answer fully
p40144
aVRe the updated question; this should accomplish that, but it isn't clear what these other properties are (that you want to not show if null)
p40145
as(dp40146
g18
V23354
p40147
stp40148
a((dp40149
g2
(lp40150
VI would use :
p40151
as(dp40152
g18
V23354
p40153
stp40154
a((dp40155
g2
(lp40156
VCan the external dll reference the assembly with the entities in them
p40157
aVThen you can return any collection/set/whatever of your types
p40158
aVThat is the simplest use
p40159
aVI would, however, tend to avoid exposing  on the API, since it is very hard to guarantee full support for all operations, and hard to guarantee that the caller doesn't break your DAL (accidentally or on purpose); I would have discreet operations that return known constructs such as , , etc
p40160
aVIf you can't add a reference, then other options include:
p40161
aVserialization (this is essentially how WCF transfers such objects; just enable serialziation on the designer surface, and use ; you will need a matching data-contract at the other end, but it doesn't have to be the same type)
p40162
aVtransfer into a known type such as  - a bit like this and this, although I'm not really a fan of
p40163
aVexpose it as , and use reflection (ho-hum)
p40164
as(dp40165
g18
V23354
p40166
stp40167
a((dp40168
g2
(lp40169
VNo, but you could use a custom  to achieve the same thing, via
p40170
aVIf you really wanted
p40171
aVNot sure it would be worth it, though, unless you desparately wanted to display it in a , , or similar
p40172
aVThere is also a separation of concerns issue; the purpose of the flag is to understand a boolean value - the string representation relates only to the UI
p40173
aVYou could use a custom attribute:
p40174
aVand take it from there
p40175
as(dp40176
g18
V23354
p40177
stp40178
a((dp40179
g2
(lp40180
VYou need to have surround paths with spaces with the extra quotes; but you should also use  instead of hard-code to "c"
p40181
as(dp40182
g18
V23354
p40183
stp40184
a((dp40185
g2
(lp40186
VTo ask each subscriber separately, you need to access the list:
p40187
aVThen you can check each in turn; otherwise you just get the final vote
p40188
as(dp40189
g18
V23354
p40190
stp40191
a((dp40192
g2
(lp40193
VThis is a complex area; I've done some things like this at runtime, and it quickly gets messy
p40194
aVIf possible, you might find that the simplest way to do this is to serialize the objects and compare the serialized form (perhaps xml-diff and )
p40195
aVThis is complicated a little by the types not being known at runtime, but not hugely (you can always use  etc)
p40196
aVThat would be my default approach, anyway
p40197
as(dp40198
g18
V23354
p40199
stp40200
a((dp40201
g2
(lp40202
VA  will usually do the job; here's some code that works for  - just add in your code to read the descriptions (via reflection etc - I've just used a string prefix for now to show the custom code working)
p40203
aVNote you would probably want to override  too
p40204
aVThe converter can be specified at the type or the property level (in case you only want it to apply for some properties), and can also be applied at runtime if the enum isn't under your control
p40205
as(dp40206
g18
V23354
p40207
stp40208
a((dp40209
g2
(lp40210
VHave you marked those files to be an embedded resource (solution explorer)
p40211
aVAlso - try it without the extension
p40212
aVYou can use  to check what is available
p40213
as(dp40214
g18
V23354
p40215
stp40216
a((dp40217
g2
(lp40218
VThis isn't going to work, on multiple levels:
p40219
aVyou can't bind to properties of containers (such as ) - it assumes you want the first item from the container (i
p40220
ag50
ag38293
aVdictionary doesn't provide notification events
p40221
aVTo do what you want, you would probably have to have your own dictionary implementation (or subclass) with notofication events, and manually propagate that a higher-level object ( or ) as a facade property, and forward the event
p40222
aVIt will be easier to just update it manually, I suspect
p40223
as(dp40224
g18
V23354
p40225
stp40226
a((dp40227
g2
(lp40228
VI'm a little confused by the comments under the question
p40229
aVIf you are using a web-reference (2
p40230
aV0), you are asked for a "web reference name"; this doubles as your namespace to the item
p40231
aVYou can access the service via something like
p40232
aVWhen you use the "add service reference" dialog (3
p40233
aV0+), you are prompted for a "namespace", which acts identically
p40234
aVIn this case, the service is available at something like
p40235
as(dp40236
g18
V23354
p40237
stp40238
a((dp40239
g2
(lp40240
VIf you are using VS2008 (tags), you should ideally use , not
p40241
aVYou can convert from a  to a  like so; then just use a  or  to get the data into the database
p40242
as(dp40243
g18
V23354
p40244
stp40245
a((dp40246
g2
(lp40247
VYou could write an extension method:
p40248
aVThen:
p40249
as(dp40250
g18
V23354
p40251
stp40252
a((dp40253
g2
(lp40254
VIs the type under your control
p40255
aVYou could add a  /  pair of events
p40256
aVAnother option would be to write a custom property-model with , but I suspect that would be quite a lot of work
p40257
aVMy first attempt would be a before/after pair
p40258
aVSomething like (updated to show 3
p40259
aV5 approach; see history for a 2
p40260
aV0 example):
p40261
aVThen just handle the two events and enable / disable updates as appropriate
p40262
as(dp40263
g18
V23354
p40264
stp40265
a((dp40266
g2
(lp40267
VA bit of LINQ
p40268
as(dp40269
g18
V23354
p40270
stp40271
a((dp40272
g2
(lp40273
VWell, if whitespace isn't an issue:
p40274
aVI'd need to check re whitespace, though
p40275
aVYou could always normalize:
p40276
as(dp40277
g18
V23354
p40278
stp40279
a((dp40280
g2
(lp40281
VIf the list had 's in it (or other things that aren't  or subclasses of ), then it would simply break with an invalid-cast
p40282
aVYou probably want:
p40283
aVin
p40284
aVNET 3
p40285
ag691
aV(I'm assuming that the list itself will be non-null, btw)
p40286
as(dp40287
g18
V23354
p40288
stp40289
a((dp40290
g2
(lp40291
VI'm not hugely familiar with ILM, but I'm guessing that it is pretty granular to specific data queries
p40292
aVWith WCF you can hook your own identity-provider by implementing  (like so) and providing your own "principal"
p40293
aVI suspect it would be pretty easy to write a principal that works against ILM, but this would presumably be for pretty broad checks - "do I have CustomerAudit access", rather than "can I access CustomerAudit for customers in the north-east"
p40294
aVA nice thing about using a principal is that you can also use  checks on methods, so you don't need to add broad security checks to your code (the CLR enforces  directly)
p40295
as(dp40296
g18
V23354
p40297
stp40298
a((dp40299
g2
(lp40300
VCurious; I can reproduce this
p40301
aVa reall oddity (for me) is that setting the menu's  fixes it
p40302
aVbut setting it to anything (it seems to ignore the value completely):
p40303
aVSee if that works
p40304
aVIt does for me, even though it makes no real sense
p40305
aVEven:
p40306
aVleaves enough space, but
p40307
aVdoesn't (presumably it checks for non-changes and ignores whatever side-effects the above has)
p40308
as(dp40309
g18
V23354
p40310
stp40311
a((dp40312
g2
(lp40313
VThe config file should get published automatically; if not, ensure that it is configured to copy to output, and (if that fails) check the publish files (project properties -> publish -> application files; the config file should be marked as "include (auto)" or "include")
p40314
aVYou shouldn't attempt to update anything in the app install directory
p40315
aVThat is a bad idea generally (since you can't assume you can update "program files" unless you're an admin), but the same holds true for ClickOnce too
p40316
aVJust create a settings file with some user settings; these will be saved in the user's profile, so can be updated reliably
p40317
aVYou can't edit the files deployed via ClickOnce; even if you had access, it would (by default) break the hashing function, and it will refuse to load them
p40318
aVYou can turn off the hashing, but
p40319
aVthis still isn't a great idea
p40320
as(dp40321
g18
V23354
p40322
stp40323
a((dp40324
g2
(lp40325
VI might be tempted to make the API explicit and use plurality in the names:
p40326
aVActually, the  is rarely useful here - you don't usually know the ids at compile-time
p40327
as(dp40328
g18
V23354
p40329
stp40330
a((dp40331
g2
(lp40332
VThere are multiple ways of expressing lambdas, depending on the exact scenario - some examples:
p40333
aVThe signature of the lambda must match the signature of the delegate used (whether it is explicit, like above, or implied by the context in things like
p40334
aVYou can use lambdas without arguments by using an empty expression list:
p40335
aVIdeally, the expression on the right hand side is exactly that; a single expression
p40336
aVThe compiler can convert this to either a  or an  tree:
p40337
aVHowever; you can also use statement blocks, but this is then only usable as a :
p40338
aVNote that even though the
p40339
aVNET 4
p40340
aV0  trees support statement bodies, the C# 4
p40341
aV0 compiler doesn't do this for you, so you are still limited to simple  trees unless you do it "the hard way"; see my article on InfoQ for more information
p40342
as(dp40343
g18
V23354
p40344
stp40345
a((dp40346
g2
(lp40347
VNot sure I understand why, but perhaps something like:
p40348
aVNote that the regex won't necessarily spot examples such as (valid C#):
p40349
as(dp40350
g18
V23354
p40351
stp40352
a((dp40353
g2
(lp40354
s(dp40355
g18
V23354
p40356
stp40357
a((dp40358
g2
(lp40359
VThe problem is simply that the  check only compares attributes of the same actual type (i
p40360
ag50
aVthe concrete type instantiated) - and is perhaps best used with  attributes for this reason
p40361
aVIt will, for example, enforce the following (as an illegal duplicate), inheriting this from :
p40362
aVIn short, I don't think you can do what you want here
p40363
aV(enforce no more than one instance including subclasses of  per property)
p40364
aVA similar example of this problem would be:
p40365
aVThe intent above is to provide a  from resx at runtime (fully supported by  etc) - but it can't stop you also adding a
p40366
as(dp40367
g18
V23354
p40368
stp40369
a((dp40370
g2
(lp40371
VI would start by testing it with just a ; locks are very cheap when not contested
p40372
aVHowever - a simpler scheme is to rely on the atomic nature of reference updates:
p40373
aVYou might also want to make  a  field, just to be sure it isn't held in the registers anywhere
p40374
aVThis still has the problem that anyone expecting there to be a given key may get disappointed (via an exception), but that is a separate issue
p40375
aVThe more granular option might be a
p40376
as(dp40377
g18
V23354
p40378
stp40379
a((dp40380
g2
(lp40381
VI would expect them to be about the same if they are value-types
p40382
aVThere is an extra cast/type-check for , but nothing huge
p40383
aVOf course,  should be preferred
p40384
aVIf speed is the primary concern (which it almost always isn't, at least not in this way), then you might also want to profile an array () - harder (=more expensive) to add/remove, of course - but if you are just querying/assigning by index, it should be the fastest
p40385
aVI have had to resort to arrays for some very localised performance critical work, but 99
p40386
aV95% of the time this is overkill and should be avoided
p40387
aVFor example, for any of the 3 approaches (//) I would expect the assignment cost to be insignificant to the cost of ing up the new instance to put into the storage
p40388
as(dp40389
g18
V23354
p40390
stp40391
a((dp40392
g2
(lp40393
VThe syntax  is C# syntax, not
p40394
aVNET syntax (which uses back-ticks, counters, etc)
p40395
aVWhat you mean is:
p40396
aVNote that  is usually a better choice, as you can just use namespace-qualified names:
p40397
as(dp40398
g18
V23354
p40399
stp40400
a((dp40401
g2
(lp40402
VWhy not try it:
p40403
aVwith code (formatted for vertical space):
p40404
as(dp40405
g18
V23354
p40406
stp40407
a((dp40408
g2
(lp40409
VUntil C# 4
p40410
aV0, you best bet is overloads that call into the "real" version:
p40411
aVIn C# 4
p40412
aV0, this will be just:
p40413
aVCalled, for example:
p40414
as(dp40415
g18
V23354
p40416
stp40417
a((dp40418
g2
(lp40419
VFundamentally, this is:
p40420
as(dp40421
g18
V23354
p40422
stp40423
a((dp40424
g2
(lp40425
VThe simplest option may be to cascade:
p40426
aVor similar; you could of course pass a delegate to make it fairly generic:
p40427
aVthen things like:
p40428
as(dp40429
g18
V23354
p40430
stp40431
a((dp40432
g2
(lp40433
VPerhaps the Dynamic LINQ Library (in the MSDN samples) would help
p40434
aVIn particular, usage like:
p40435
aVThis should work with any  source - including LINQ-to-Objects simply by calling  on the sequence (typically )
p40436
as(dp40437
g18
V23354
p40438
stp40439
a((dp40440
g2
(lp40441
VShort version:
p40442
aVis short-hand for  /  (with exception handling etc)
p40443
aVIf nobody else has the lock, you can get it (and run your code) - otherwise your thread is blocked until the lock is aquired (by another thread releasing it)
p40444
aVDeadlock typically happens when either A: two threads lock things in different orders:
p40445
aV(here, if they each acquire the first lock, neither can ever get the second, since neither thread can exit to release their lock)
p40446
aVThis scenario can be minimised by always locking in the same order; and you can recover (to a degree) by using  (instead of /) and specifying a timeout
p40447
aVor B: you can block yourself with things like winforms when thread-switching while holding a lock:
p40448
aVThe deadlock appears obvious above, but it isn't so obvious when you have spaghetti code; possible answers: don't thread-switch while holding locks, or use  so that you can at least exit the lock (letting the UI play)
p40449
aV// are different; they are for signalling
p40450
aVI use this in this answer to signal so that:
p40451
aV: if you try to dequeue data when the queue is empty, it waits for another thread to add data, which wakes up the blocked thread
p40452
aV: if you try and enqueue data when the queue is full, it waits for another thread to remove data, which wakes up the blocked thread
p40453
aVonly wakes up one thread - but I'm not brainy enough to prove that the next thread is always the one I want, so I tend to use , and simply re-verify the conditions before continuing; as an example:
p40454
aVWith this approach, I can safely add other meanings of , without my existing code assuming that "I woke up, therefore there is data" - which is handy when (in the same example) I later needed to add a  method
p40455
as(dp40456
g18
V23354
p40457
stp40458
a((dp40459
g2
(lp40460
VIIRC, the event usage (rather than ) works async
p40461
aVI would be interested to know what thread the event is being raised on
p40462
aVI wonder if there is no message pump servicing messages for your icon
p40463
aVDo you have a form anywhere
p40464
aVOr something else with a message loop
p40465
aVI would be tempted to call into the form (using ), and ask the form to show the icon - since then it should have an active message pump
p40466
aVSorry for the delay; reading your comments, it sounds like you've broadly got a workaround
p40467
aVThe only gotcha is cross-threaded issues; ideally, you would ask the UI to make such a change on the UI thread; for example, if you have a  kicking around (owning the icon) - add to your form class:
p40468
aVThis does a thread-switch (if needed) to the UI thread
p40469
aVAny use
p40470
as(dp40471
g18
V23354
p40472
stp40473
a((dp40474
g2
(lp40475
VBased on KristoferA's answer, I ended up with something like below; this is evil and brittle (reflection often is), but may have to suffice for now
p40476
aVThe other side of the battle is to change the triggers to behave:
p40477
as(dp40478
g18
V23354
p40479
stp40480
a((dp40481
g2
(lp40482
VWell, I'd want to look at a couple of things:
p40483
aV1: is  correctly implemented:
p40484
aV2: if this is the generic dictionary, does the type also implement (explicitly)
p40485
aV3: did you supply a custom  to the dictionary in the constructor
p40486
aVTo rule out the last, perhaps look at:
p40487
as(dp40488
g18
V23354
p40489
stp40490
a((dp40491
g2
(lp40492
VIt isn't an  per-request
p40493
aVIf you want to use thread-specific state, try:
p40494
aVEach thread now gets its own value of  (or rather: 'foo')
p40495
aVThis is not to be used lightly - it does have costs, but is a valid way of sharing state on a per-thread basis
p40496
aVI've used this once, maybe twice - and I've written a lot of C#
p40497
aVDon't over-use it
p40498
aVIn particular, watch out for initialization issues (i
p40499
ag50
aVforgetting to do it), and remember to clean up after yourself etc
p40500
aVAnd be very careful if you use any async code, as any callbacks/workers/etc will have different state
p40501
as(dp40502
g18
V23354
p40503
stp40504
a((dp40505
g2
(lp40506
VThey aren't structures because they need to have finalizers to wrap the underlying objects and provide a sensible  implementation
p40507
aVWhat happens if you  your own copy of a
p40508
aVDo you clone the handle each time
p40509
aVIt isn't really much stress on the GC
p40510
aVIt also allows the  to be re-used safely without worry about it changing half way through an operation ;-p
p40511
as(dp40512
g18
V23354
p40513
stp40514
a((dp40515
g2
(lp40516
VHow about (to show the interaction):
p40517
aVRe signalling; when dealing with  (aka ), there are two types of blocking; there is the "ready queue", where threads are queued waiting to execute
p40518
aVOn the line after  the pool queue enters the ready queue
p40519
aVWhen the lock is released a thread from the ready queue can acquire the lock
p40520
aVThe second queue is for threads that need waking; the call to  places the thread in this second queue (and releases the lock temporarily)
p40521
aVThe call to  moves all threads from this second queue into the ready queue ( moves only one thread), so that when the pool thread releases the lock the main thread is allowed to pick up the lock again
p40522
aVIt sounds complex (and perhaps it is) - but it isn't as bad as it sounds
p40523
aVhonestly
p40524
aVHowever, threading code is always tricky, and needs to be approached with both caution and a clear head
p40525
as(dp40526
g18
V23354
p40527
stp40528
a((dp40529
g2
(lp40530
VHow about:
p40531
aV(actually, it could be , since this (not ) defines )
p40532
as(dp40533
g18
V23354
p40534
stp40535
a((dp40536
g2
(lp40537
s(dp40538
g18
V23354
p40539
stp40540
a((dp40541
g2
(lp40542
VSomething like:
p40543
aVBased on types like:
p40544
as(dp40545
g18
V23354
p40546
stp40547
a((dp40548
g2
(lp40549
VTo read binary, the best approach is to use the raw input stream - here showing something like "echo" between stdin and stdout:
p40550
as(dp40551
g18
V23354
p40552
stp40553
a((dp40554
g2
(lp40555
VYou could use a fluent API and append it:
p40556
aVwhere the  method returns the same instance (fluent) - something like:
p40557
aV(you could centralize the check a bit more if needed)
p40558
as(dp40559
g18
V23354
p40560
stp40561
a((dp40562
g2
(lp40563
VI don't really follow this guidance unless I'm in the scenarios you need it:
p40564
aVthere is an actual ambiguity - mainly this impacts either constructors () or things like  ()
p40565
aVyou want to pass a reference to the current instance
p40566
aVyou want to call an extension method on the current instance
p40567
aVOther than that I consider this clutter
p40568
aVSo I turn the rule off
p40569
as(dp40570
g18
V23354
p40571
stp40572
a((dp40573
g2
(lp40574
VCertainly the authors of ASP
p40575
aVNET MVC In Action advise against it, and I agree
p40576
aVIt isn't necessary, so why do it
p40577
aVIn the early betas a code-behind file was included, but this was removed at RTM (or shortly before)
p40578
aVTypically, it simply encourages you to do more non-view work than you should in the view, as it is out of sight / out of mind
p40579
as(dp40580
g18
V23354
p40581
stp40582
a((dp40583
g2
(lp40584
VRe your other comments; doing anything before the event has fired would be premature; after all, some other code might cancel the close, and you'd be left with a scuppered form
p40585
aVPersonally, I'd be tempted to override ; not much of a VB head, but in C#:
p40586
as(dp40587
g18
V23354
p40588
stp40589
a((dp40590
g2
(lp40591
VTypically, you would serialize state (entities), not the WSDL service wrapper
p40592
aVMost code-gen since 2
p40593
aV0 will write files as  classes, which means you can add a second code file to add things like attributes:
p40594
aVThis is combined with the other half in the wsdl-generated types, and should make it usable from  - however, personally I suspect that is a bad way to do it
p40595
aVSince you are using wsdl
p40596
aVexe, your types are already serializable via
p40597
aVInstead of serializing them with  (which is what will be used by default, and which is very brittle), consider serializing them via  to a  or a , and add that to session-state
p40598
aVThis will work without extra code changes, and is a lot more robust as it avoids the multiple brittle points of
p40599
aVFor example:
p40600
as(dp40601
g18
V23354
p40602
stp40603
a((dp40604
g2
(lp40605
VSince they don't need to be unique
p40606
aVas many as you can get away with until you break the compiler
p40607
aVbut it sounds like you are already abusing them
p40608
aVFor info:
p40609
aV(this shouldn't be a problem in real world usage
p40610
as(dp40611
g18
V23354
p40612
stp40613
a((dp40614
g2
(lp40615
VSince you give an xml example, just use an xml parser:
p40616
aVxml is not a simple text format, and  isn't really a very good fit; using an appropriate tool will protect you from a range of evils
p40617
aVfor example, the following is identical as xml:
p40618
aVIt also means that when the requirement changes, you have a simple tweak to make to the code, rather than trying to unpick a regex and put it back together again (which can be tricky if you are access a non-trivial node)
p40619
aVEqually, xpath might be an option; so in your data the xpath:
p40620
aVis all you need
p40621
aVIf you haven't got
p40622
aVNET 3
p40623
aV5:
p40624
as(dp40625
g18
V23354
p40626
stp40627
a((dp40628
g2
(lp40629
VOr for formatting (filling in the blanks) - see this example
p40630
as(dp40631
g18
V23354
p40632
stp40633
a((dp40634
g2
(lp40635
VIn reality, your scenario doesn't hugely map to a  - but we'll try anyway ;-p
p40636
aVI've tweaked the setup a bit; instead:
p40637
aVone entity can have the grounds at a time
p40638
aVwhen a team finishes, they tell the first person they see (if anyone is waiting)
p40639
aVwhen the cleaner finishes, they are noisy - so everyone notices them leave and tries to get on the pitch
p40640
aVHere's the code; note that they don't have the lock when using the grounds, as that would prevent other people from joining the queue for
p40641
aVIn reality, we could do all of this with just  (not using  at all), and just use the standard blocking behaviour
p40642
aVBut this sample shows  and  being used to re-activate threads when a condition is met
p40643
as(dp40644
g18
V23354
p40645
stp40646
a((dp40647
g2
(lp40648
VDoes  have a public parameterless constructor
p40649
aVIf not, you could derive from  and override  to call your custom constructor
p40650
aV(edit) Alternatively - just wrap your list in a  and it may work:
p40651
as(dp40652
g18
V23354
p40653
stp40654
a((dp40655
g2
(lp40656
VNote to reader: see the two comments below; it sounds like I'm accidentally inflating the definition of CAS to (incorrectly) include RBS
p40657
aVI'll leave the answer here for reference, but note the distinction
p40658
aVThere are two havles to CAS; the thing you'll see most about in that exam is all the nuances for code calling other code, which may be useful for partial trust, but most of the time it is simply a pain - and worse: if your code has full trust (which most / too-much does) none of it actually executes (it is skipped entirely)
p40659
aVThe useful part of CAS RBS is principal permission, which is used; of course, your UI should verify access to features, but you can put (in your low-down logic):
p40660
aVThis will be enforced even in full trust; you can define your own principal (tied to the user) by implementing  (look at )
p40661
aVAnd since principals are supported in most environments (winforms, webforms, mvc, wcf, etc) this can make for a very flexible way to double-check security at the business layer without having to reference the specific security model
p40662
aVNote that the above check would work in any environment
p40663
aVYou can also perhaps use this to drive your UI
p40664
aVI did have a usenet post that enabled / disabled winforms controls based on the principal (using runtime properties to specify the role per control, a bit like  etc) - I can't find it at the minute, though (edit: maybe this one)
p40665
as(dp40666
g18
V23354
p40667
stp40668
a((dp40669
g2
(lp40670
VYou need to  anyway, so you can  and :
p40671
aVwith add like:
p40672
aVYou might also want to look at this question, which limits the size of the queue (blocking if it is too full)
p40673
as(dp40674
g18
V23354
p40675
stp40676
a((dp40677
g2
(lp40678
VA facade property is the easiest option - especially if it is readonly; just add a property (in a  class if the type is generated) that walks the relation
p40679
aVThere are other routes, though
p40680
aVYou can write a  and decorate the property with it; this is a pain for generated types, though (since you can't add an attribute to a member declared in a separate partial class file)
p40681
aVYou can also use custom property models (/), but these would be massively overkill just for this
p40682
aVI can expand on any of these as necessary
p40683
aVbut most (except the first) are lots of work
p40684
as(dp40685
g18
V23354
p40686
stp40687
a((dp40688
g2
(lp40689
V1: because the  calls the ; that is the purpose of the
p40690
aV2: to close each of the encapsulated resources, in this case threads (asking them to exit, then waiting for them to exit)
p40691
aV3: it returns to the caller; in this case the caller is a , so this cleanly exits the thread
p40692
aVOr in English:
p40693
aVthe  in this case acts to wait for all the threads to exit; without the  we would close too early
p40694
aVthe  signals each thread to exit when it has finished processing its load, and waits for them all
p40695
aVthe  is detected as a "now exit" signal, causing each thread to exit
p40696
as(dp40697
g18
V23354
p40698
stp40699
a((dp40700
g2
(lp40701
VVery little point switching to bool; which is bigger:
p40702
aVor
p40703
aVNot much in it ;-p
p40704
aVThe record count is really big
p40705
aVIf bandwidth becomes an issue, and you control both ends of the service, then rather than change your entities you could look at some other options:
p40706
aVpre-compress the data as (for example) gzip, and pass (instead) a  or , noting to enable MTOM on the service
p40707
aV(or) switch serializer; proobuf-net has WCF hooks, and can achieve significant bandwidth improvements over the default  (again: enable MTOM)
p40708
aVIn a test based on Northwind data (here) it reduced 736,574 bytes to 133,010
p40709
aVand reduced the CPU required to process it (win:win)
p40710
aVFor info, it reduces enums to integers, typically requiring only 1 byte for the enum value and 1 byte to identify the field; contrast to , which under UTF8 is 21 bytes (more for most other encodings), or  at 14 bytes
p40711
aVHowever, either change will break your service if you have external callers who are expecting regular SOAP
p40712
as(dp40713
g18
V23354
p40714
stp40715
a((dp40716
g2
(lp40717
VIf you are doing binary math, it sounds like you are talking about a value
p40718
aVIf you are talking about a value, an immutable concrete type would be a good choice (perhaps a , depending on the size)
p40719
aVAnd if you have a concrete type, you can add a bespoke operator
p40720
aVAlternatively you could add an  method to the interface (or add an extension method to do the same), but this may involve the first operand choosing the concrete type
p40721
aVbut then, I'm not sure what the interface is adding anyway
p40722
as(dp40723
g18
V23354
p40724
stp40725
a((dp40726
g2
(lp40727
VThere are ways of doing this with a generic method:
p40728
aVor by creating a list with data and then emptying it
p40729
as(dp40730
g18
V23354
p40731
stp40732
a((dp40733
g2
(lp40734
VTry , i
p40735
ag50
as(dp40736
g18
V23354
p40737
stp40738
a((dp40739
g2
(lp40740
V, by default, has connection pooling enabled
p40741
aVThe  simply releases the connection to the pool sooner
p40742
aVThis means other code can then re-use this connection, reducing the connections to the SQL server, and reducing the time to establish a physical connection
p40743
aVSo yes: it can improve overall performance
p40744
aVThe alternatives:
p40745
aVif your code exits cleanly and you always remember to  the connection, then probably no difference
p40746
aVif your code throws an exception (that you haven't handled), or you forget to  the connection, then you could be leaving unused connections lying around until there is enough memory pressure to trigger GC and the finalizer
p40747
aVThis could mean you need more physical connections to the SQL server (a pain), and every time a new underlying connection is needed it has to take the performance hit of establishing the actual database connection
p40748
aVOverall, though - think of  as a contract; it is your job as a
p40749
aVNET developer to notice  resources, and actively  them when you are done, ideally with  if the usage is tightly scoped (like in this case)
p40750
as(dp40751
g18
V23354
p40752
stp40753
a((dp40754
g2
(lp40755
VThe  syntax defines an anonymous type with properties  and , with values "foo" and "bar" respectively
p40756
aVYou are doing this to return multiple values per row
p40757
aVWithout some kind of new object, you could only return (for example) the
p40758
aVTo return multiple properties, a values is required
p40759
aVIn this case, an anonymous type is fine since this data is only used local to this query
p40760
aVYou could also define your own , and use  with that instead:
p40761
aVor
p40762
aVByt that is overkill unless  has some useful meaning outside of this context
p40763
as(dp40764
g18
V23354
p40765
stp40766
a((dp40767
g2
(lp40768
VNote that there are some cases where you can do something like this with lambdas, by compiling them to an  tree rather than a delegate (which is cheating, but may be enough to help):
p40769
aVNote that
p40770
aVNET 4
p40771
aV0 expression trees can encapsulate the statement bodies as per the original question (discussed at the end of this article) - but the C# compiler doesn't support compiling C# code to such expressions (you need to do it the hard way)
p40772
as(dp40773
g18
V23354
p40774
stp40775
a((dp40776
g2
(lp40777
VIt only ever appears null if you have a breakpoint outside the  line; inside, it should be non-null
p40778
aVI've just tested it, and got an  with , as expected
p40779
as(dp40780
g18
V23354
p40781
stp40782
a((dp40783
g2
(lp40784
VFor ASCII values, you should just be able to cast to char
p40785
aV(C#:)
p40786
aVor as a string:
p40787
as(dp40788
g18
V23354
p40789
stp40790
a((dp40791
g2
(lp40792
VThe list of tracks could be either:
p40793
aVor
p40794
aVIf you want the concrete type to expose a more concrete API, you could implement the above via explicit implementation
p40795
aVYou could in theory make:
p40796
aVbut I don't think that is a good idea
p40797
aVRe exposing tracks as properties; if I understand correctly, you could do this "kind of" at runtime by implementing  on the concrete album type
p40798
aVBut it is non-trivial and a bit messy - and it won't help hugely unless you are using data-binding
p40799
as(dp40800
g18
V23354
p40801
stp40802
a((dp40803
g2
(lp40804
VMatthew has the real answer for this - but as a stop-gap; don't forget the "Recent" tab on the "Add References" dialog
p40805
aVIn many ways it is a shame that it doesn't default to this tab
p40806
aVThis tab makes adding your common libraries pretty painless (once that lethargic dialog opens)
p40807
as(dp40808
g18
V23354
p40809
stp40810
a((dp40811
g2
(lp40812
VHow about using the non-generic version:
p40813
as(dp40814
g18
V23354
p40815
stp40816
a((dp40817
g2
(lp40818
VIf you mean a LINQ-to-SQL , I would advise against this; use s as a short-lived unit-of-work, then  it; don't keep it for lots of different purposes (there are issues with stale data, cache growth, threading, concurrency, plus (importantly) how to handle failure / rollback)
p40819
aVRe the bigger picture:
p40820
aVEssentially you are describing a work queue, such as a producer/consumer queue
p40821
aVThere are plenty of such around, or they are relatively easy to write (for example, see here or here; just add a loop to dequeue+process items)
p40822
aVIIRC
p40823
aVNET 4
p40824
aV0 also includes (in the parallel extensions) such constructs pre-canned
p40825
as(dp40826
g18
V23354
p40827
stp40828
a((dp40829
g2
(lp40830
VSimilar to some existing answers, but doing the projection in the query, to make the  call a lot simpler:
p40831
as(dp40832
g18
V23354
p40833
stp40834
a((dp40835
g2
(lp40836
VYou shouldn't mess with the priority of the regular , since you aren't the only consumer
p40837
aVI suppose the logical approach would be to write your own - perhaps as simple as a producer/consumer queue, using your own (s) as the consumer(s) - setting the thread priority yourself
p40838
aVNET 4
p40839
aV0 includes new libraries (the TPL etc) to make all this easier - until then you need additional code to create a custom thread pool or work queue
p40840
as(dp40841
g18
V23354
p40842
stp40843
a((dp40844
g2
(lp40845
VIn essence it's job is very similar to  - to represent a queryable data source - the difference being that the various LINQ methods (on ) can be more specific, to build the query using  trees rather than delegates (which is what  uses)
p40846
aVThe expression trees can be inspected by your chosen LINQ provider and turned into an actual query - although that is a black art in itself
p40847
aVThis is really down to the ,  and  - but in reality you rarely need to care about this as a user
p40848
aVOnly a LINQ implementer needs to know the gory details
p40849
aVRe comments; I'm not quite sure what you want by way of example, but consider LINQ-to-SQL; the central object here is a , which represents our database-wrapper
p40850
aVThis typically has a property per table (for example, ), and a table implements
p40851
aVBut we don't use that much directly; consider:
p40852
aVthis becomes (by the C# compiler):
p40853
aVwhich is again interpreted (by the C# compiler) as:
p40854
aVImportantly, the static methods on  take expression trees, which - rather than regular IL, get compiled to an object model
p40855
aVFor example - just looking at the "Where", this gives us something comparable to:
p40856
aVDidn't the compiler do a lot for us
p40857
aVThis object model can be torn apart, inspected for what it means, and put back together again by the TSQL generator - giving something like:
p40858
aV(the string might end up as a parameter; I can't remember)
p40859
aVNone of this would be possible if we had just used a delegate
p40860
aVAnd this is the point of  / : it provides the entry-point for using expression trees
p40861
aVAll this is very complex, so it is a good job that the compiler makes it nice and easy for us
p40862
aVFor more information, look at "C# in Depth" or "LINQ in Action", both of which provide coverage of these topics
p40863
as(dp40864
g18
V23354
p40865
stp40866
a((dp40867
g2
(lp40868
V3 options for you:
p40869
aVmake the class generic, and use inference on the method for the value
p40870
aVuse an example object for inference on the method
p40871
aVforget about the object type entirely and just use an example
p40872
aVThese are all shown below
p40873
aVRe the  safety - I would be tempted to check the expression-type (you can also handle methods, btw) - some more code shown here
p40874
as(dp40875
g18
V23354
p40876
stp40877
a((dp40878
g2
(lp40879
VMy first thought is that you haven't closed
p40880
aVIf you use  this happens automatically
p40881
aVSince gzip buffers data, you could be missing some
p40882
aVSecondly; don't increment ; that is the offset in the buffer (not the stream)
p40883
aVLeave at 0:
p40884
as(dp40885
g18
V23354
p40886
stp40887
a((dp40888
g2
(lp40889
VTo create a delegate to the property accessors, you just use  and ; can you explain where it is breaking down
p40890
aVA simplified example:
p40891
aVNote that to handle things just on  there are tricks involving base-classes etc - or perhaps consider things like HyperDescriptor; similar performance, but much simpler, since you just use  and  (after enabling it):
p40892
aVA last option is ; I cover various tricks for property access in  in this series
p40893
as(dp40894
g18
V23354
p40895
stp40896
a((dp40897
g2
(lp40898
VI don't know about inside a function, but VS2010 has sequence diagram generation from code - see  here or here
p40899
as(dp40900
g18
V23354
p40901
stp40902
a((dp40903
g2
(lp40904
V doesn't respect the usual  rules, especially in things like:
p40905
aVHere,  is not guaranteed to spot external changes to  even though the underlying field () is ;  doesn't know about it, so doesn't have the right code
p40906
aVHowever
p40907
aVThis should be a non-issue:
p40908
aVif you are using , then use  for all access to the field
p40909
aVif you are using , then use  for all access to the field
p40910
aVFollow those rules and it should work OK
p40911
aVRe the edit; yes, that behaviour is a critical part of
p40912
aVTo be honest, I don't know how it is implemented (memory barrier, etc - note they are "InternalCall" methods, so I can't check ;-p) - but yes: updates from one thread will be immediately visible to all others as long as they use the  methods (hence my point above)
p40913
as(dp40914
g18
V23354
p40915
stp40916
a((dp40917
g2
(lp40918
VYou want
p40919
aVwith first answer (note the inclusion of 9 is taken from your original version of the code, but it may be desirable to use  instead):
p40920
aVOptimised version (and correct range):
p40921
aVThis reduces the number of strings created, uses integer equality, and correctly uses the range (the second parameter to  is the count, not the end)
p40922
as(dp40923
g18
V23354
p40924
stp40925
a((dp40926
g2
(lp40927
VThat question is doing brute forcing; LINQ is actually quite handy in such cases - I discussed this here: Brute force (but lazily)
p40928
aVJust to expand on some of the previous answers:
p40929
aVLINQ is typically designed around deferred execution, meaning nothing happens until start iterating the result
p40930
aVThis is typically done via an iterator block; consider the difference between these:
p40931
aVand:
p40932
aVThe difference is that the second version does all the work when you call , returning a single result, where-as the second (via the magic of iterator blocks) only does work when the enumerator calls
p40933
aVIterator blocks are discussed more in the free sample chapter 6 of C# in Depth
p40934
aVGenerally, the advantage of this is that it makes queries composable - especially important for database-based queries, but just as valid for regular work
p40935
aVNote that even with iterator blocks, there is a second consideration; buffering
p40936
aVConsider  - no matter how you do it, to reverse a sequence, first you need to find the end of the sequence
p40937
aVNow consider that not all sequences end
p40938
aVContrast this to , ,  etc - which can filter rows without buffering (simply by dropping items)
p40939
aVA good example of using this in an infinite sequence is this Fibonacci question, where we can use the non-buffered, deferred approach:
p40940
aVWithout deferred execution, this would never complete
p40941
as(dp40942
g18
V23354
p40943
stp40944
a((dp40945
g2
(lp40946
VFor the first:
p40947
aVFor the second - not elegant, but it works (returns the 8 permutations of the sample):
p40948
as(dp40949
g18
V23354
p40950
stp40951
a((dp40952
g2
(lp40953
VHave you edited the url in web
p40954
aVconfig / app
p40955
aVconfig
p40956
aVNote that if the web-reference is in a dll (not the web layer itself) you might not even see the setting in web
p40957
aVconfig; in such cases, copy the setting from the dll's config in VS - into web
p40958
aVconfig
p40959
aVNote that dll configs don't really do anything, except provide somewhere to copy/paste that value from
p40960
as(dp40961
g18
V23354
p40962
stp40963
a((dp40964
g2
(lp40965
VTo do it properly I expect you'd need to override the message processing to respond to the title bar being held, etc
p40966
aVBut you could cheat, and just use a timer so that you make it opaque for a little while when moved, so continuous movement works:
p40967
aVObviously you could tweak this to fade in/out, etc - this is just to show the overall concept
p40968
as(dp40969
g18
V23354
p40970
stp40971
a((dp40972
g2
(lp40973
VFirst make it accessible:
p40974
aVthen something like:
p40975
aVNote that if the property is get-only:
p40976
aVThen you can use the alternative syntax (which sets properties without attempting to change the student reference):
p40977
as(dp40978
g18
V23354
p40979
stp40980
a((dp40981
g2
(lp40982
VApplying left-to-right (no precedence), I can get:
p40983
aVWith (edit: oops - the "no div" stuff was unnecessary):
p40984
as(dp40985
g18
V23354
p40986
stp40987
a((dp40988
g2
(lp40989
VLambdas are great for many scenarios - but if you don't want them, perhaps simply don't use them
p40990
aVI hate to say it, but simple strings are tried and tested, especially for scenarios like data binding
p40991
aVIf you want fast access, you could look at HyperDescriptor, or there are ways of compiling a delegate to the property accessors, or you can build an  from the string and compile it (including a cast to  if you want a known signature, rather than calling the (much slower) )
p40992
aVOf course, in most cases even crude reflection is fast enough, and isn't the bottleneck
p40993
aVI suggest starting with the simplest code, and check it is actually too slow before worrying about it being fast
p40994
aVIf it isn't too slow, don't change it
p40995
aVAny of the above options would work otherwise
p40996
aVAnother thought; if you are using , you could do something like:
p40997
aVand then take the expression apart
p40998
aVA bit tidier, at least
p40999
aVhere's some sample code showing the deconstruction:
p41000
aVOnce you know the s ( in the above), building your own lambdas for individual access should be trivial
p41001
aVFor example (including a cast to  to get a single signature):
p41002
as(dp41003
g18
V23354
p41004
stp41005
a((dp41006
g2
(lp41007
VI don't know about making it slower, but it certainly makes it harder to get right
p41008
aVIn the many cases where the two approaches are virtually identical in performance (or when it simply doesn't matter if it takes 500 pico-seconds rather than 100 pico-seconds), then pick the simplest approach - generally
p41009
aVThere are very few cases when that extra bit of performance is key; and if it is, I suspect you'd do well to use the pre-rolled pattern implementations from established libraries
p41010
aVGetting lock-free code working properly (and proving that it works properly in all conditions) is often very hard
p41011
aVNote also that some environments offer a level of locking above the OS-provided mutex; mutex behaviour, but without some of the overheads (for example,  in
p41012
aVNET)
p41013
as(dp41014
g18
V23354
p41015
stp41016
a((dp41017
g2
(lp41018
VYou need to handle the  event:
p41019
aVThe args contains other bits of information relating to error conditions etc - check those too
p41020
aVAlso note that you'll be coming into  on a different thread; if you are in a UI (winform, wpf, etc) you'll need to get to the UI thread before updating the UI
p41021
aVFrom winforms, use
p41022
aVFor WPF, look at the
p41023
as(dp41024
g18
V23354
p41025
stp41026
a((dp41027
g2
(lp41028
Vcross join
p41029
aVFor triples:
p41030
as(dp41031
g18
V23354
p41032
stp41033
a((dp41034
g2
(lp41035
V is a ; why would it also be an
p41036
aVrelates to sources of data - not instances of the data itself (possible exception: )
p41037
aVI suspect your method  should simply return ; and lose a lot of the casts
p41038
as(dp41039
g18
V23354
p41040
stp41041
a((dp41042
g2
(lp41043
VThe key word here is "async"; when you call , it only starts the download; it isn't complete yet
p41044
aVYou need to process the data in the callback ()
p41045
aVAlso - don't assume ASCII;  would be better; or just :
p41046
as(dp41047
g18
V23354
p41048
stp41049
a((dp41050
g2
(lp41051
VThe  isn't a list of s - you need to use  objects, like below; note I'm using the fact that the list () has a field-initializer (you could actually remove the  and it would still work, as long as you aren't using ):
p41052
aVNote that you could simplify this with a few bespoke constructors
p41053
as(dp41054
g18
V23354
p41055
stp41056
a((dp41057
g2
(lp41058
VLINQ
p41059
aVafter:  (left vague as your meaning isn't clear)
p41060
aVbefore:  (left vague as your meaning isn't clear)
p41061
aVlast:
p41062
aVfirst:
p41063
aVodd:
p41064
aVeven:
p41065
as(dp41066
g18
V23354
p41067
stp41068
a((dp41069
g2
(lp41070
V (already mentioned) is the obvious answer in most cases
p41071
aVNote that you might also consider alternatives, for example:
p41072
aVAs shown here and discussed more here
p41073
as(dp41074
g18
V23354
p41075
stp41076
a((dp41077
g2
(lp41078
VYou can not change the type of a managed
p41079
aVNET object
p41080
aVIf you were encapsulating the object (in a wrapper - for example ) you could swap the reference, but that is about it
p41081
aVIn some (limited) cases, you might be able to serialize/deserialize an encapsulated instance, changing the type in the process (only works for contract-based serializers, with compatible contracts; very unlikely)
p41082
aVYou certainly can't change the type of the current instance
p41083
aVRe the edit; again, you can't change the type of how you expose the details, but with some casting you could make it work; vaguely, something like:
p41084
aVIt sounds like you should also be making use of polymorphism
p41085
aVIf you are doing data-binding there are some other things you can do (with considerable effort) to make this more friendly, but it won't affect regular code
p41086
as(dp41087
g18
V23354
p41088
stp41089
a((dp41090
g2
(lp41091
VI expect the array is expecting two levels of elements; try:
p41092
aV(which tells it to use a single level of elements called  for the array contents)
p41093
aVbtw, you can name your classes more naturally by adding attributes to control naming; for example:
p41094
aVFor info, I tested it and it works fine:
p41095
as(dp41096
g18
V23354
p41097
stp41098
a((dp41099
g2
(lp41100
V is a versatile way of expressing code operations as an object model
p41101
aVThis is extended much more in 4
p41102
aV0, but this is an area I use a lot; I have some blog points here, or another attempt at explaining it all on InfoQ
p41103
aVI've also presented this subject a few times - perhaps try the download here (but it won't make as much sense without the words; sorry)
p41104
aVI'll be honest; it isn't a simple subject - but it is hugely powerful when you grok it
p41105
aVFrom the above, I'd probably start with the InfoQ
p41106
as(dp41107
g18
V23354
p41108
stp41109
a((dp41110
g2
(lp41111
VThat is LINQ's  - i
p41112
ag50
aVor
p41113
as(dp41114
g18
V23354
p41115
stp41116
a((dp41117
g2
(lp41118
VIf you are doing this at the server in a single http request (for example, responding to a button event in your code-behind), then the server doesn't really care much about the browser
p41119
aVIf you want the inserts to stop when the browser stops, I would suggest perhaps doing this via an ajax loop - but note that this will be considerably slower, as you will have 100 round-trips, and 100 separate sets of processing at the server
p41120
as(dp41121
g18
V23354
p41122
stp41123
a((dp41124
g2
(lp41125
VThe most likely cause here is that  is from a different assembly in the two cases, and is thus a different
p41126
aVNET type
p41127
aVEven if it is the same code, it can be a different type
p41128
aVCheck the
p41129
aVNote also that if you are loading this assembly with reflection you can get a different type even with the same AssemblyQualifiedName, thanks to the load-context
p41130
as(dp41131
g18
V23354
p41132
stp41133
a((dp41134
g2
(lp41135
VNope - far from it; I'll write a long-hand version for you
p41136
aVit is too grungy
p41137
aVNote it also helps if you understand that the  is actually:
p41138
aVAs you can see, it builds a state machine in the iterator, with the state machine progressed by
p41139
aVI've used the pattern with a  field, as you can see how this would work for more complex iterators
p41140
aVImportantly:
p41141
aVany variables in your iterator block become fields on the state machine
p41142
aVif you have a  block (including ), it goes in the
p41143
aVportions of code leading to a  become a  (roughly)
p41144
aVbecomes a  (or similar)
p41145
aVThe way the C# compiler does this is very complicated, but it makes writing iterators a breeze
p41146
as(dp41147
g18
V23354
p41148
stp41149
a((dp41150
g2
(lp41151
VAny properties that are value-types ( etc) will need boxing; or you will need to use a different  overload
p41152
aVAlso:
p41153
aVyou need to load the object each time (arg0)
p41154
aVis a fluent API; you either need to pop the value, or re-use it:
p41155
aVas a consequence, you don't need the field
p41156
aV(personally, though, I'd return a , but "meh")
p41157
aVLike so:
p41158
aVThis generates the equivalent to:
p41159
as(dp41160
g18
V23354
p41161
stp41162
a((dp41163
g2
(lp41164
VIn C#,  and  are exactly the same thing (as long as you haven't created your own type called , which would be stupid)
p41165
aVis defined as an alias to
p41166
aVAs such, there is no boxing here
p41167
aVIn java,  is a boxed , with type-erasure being a key part of the generics implementation
p41168
as(dp41169
g18
V23354
p41170
stp41171
a((dp41172
g2
(lp41173
VOn the wire they will be indistinguishable - i
p41174
ag50
aVboth  and  are going to look (roughly) like:
p41175
aVSo there is no point having logic that treats the two differently
p41176
aVUltimately,  is a pain to work with ( etc), so I would tend to use  - of course,  nicely defaults to arrays, IIRC - but there is a command line switch (or perhaps there is for wse/wcf)
p41177
as(dp41178
g18
V23354
p41179
stp41180
a((dp41181
g2
(lp41182
V is intended to be a natural map between the object model and the xml; the answer, then, is to structure your DTO the same as your xml
p41183
aVIn this case, by wrapping  in a second object:
p41184
aVThe alternative is implementing , but that is effort, and easy to get wrong
p41185
aVIt isn't uncommon to require a separate object representation for serialization purposes - it shouldn't be assumed that your "regular" business/data objects are necessarily directly suitable for serialization
p41186
as(dp41187
g18
V23354
p41188
stp41189
a((dp41190
g2
(lp41191
V(update: as always, Eric Lippert has a timely blog entry)
p41192
aVIf you don't use a lock, you risk either missing data, state corruption, and probably the odd  - but only very occasionally, so very hard to debug
p41193
aVAbsolutely you need to synchronize here
p41194
aVI would expose a lock on the client (so we can span multiple operations):
p41195
aVYou could make a synchronous  method on , but it is often useful to span multiple - perhaps to check  and then  only if missing, etc
p41196
aVJust to clarify 2 points:
p41197
aVall access to the list (even reads) must also take the ; otherwise it doesn't work
p41198
aVthe  should be a readonly reference-type
p41199
aVfor the second, perhaps:
p41200
as(dp41201
g18
V23354
p41202
stp41203
a((dp41204
g2
(lp41205
VWhen you call , the first argument must be an existing  - it can't be an  to a
p41206
aVOr in other words: it isn't going to evaluate  per row  and use a different sub-expression each time
p41207
aVInstead, you would retrieve this lambda first, perhaps making it  and accessing it via reflection if you only know it by name:
p41208
aVAnd pass  in as the argument to ; here's a fully working LINQ-to-Objects example showing this (via ):
p41209
as(dp41210
g18
V23354
p41211
stp41212
a((dp41213
g2
(lp41214
VUpdate:
p41215
aV 7
p41216
ag691
aV7 This access
p41217
aVA this-access consists of the reserved word
p41218
aVthis-access:
p41219
aVA this-access is permitted only in the block of an instance constructor, an instance method, or an instance accessor
p41220
aVThis is none of these
p41221
aVThe 4
p41222
aV0 compiler looks to be correct
p41223
aVPresumably it isn't happy because this in essence provides access to  at a point when the type isn't initialized
p41224
aVMaybe ;-p
p41225
aVNote that I expect that it isn't really the  that causes this - more that the use of a field causes  to be captured, meaning it wants to hoist the  instance onto a compiler-generated class - as though you had written:
p41226
aVThe C# 3
p41227
aV0 compiler spots the above abuse of
p41228
aVReproduced
p41229
aVInvestigating
p41230
aVIt looks like an issue resolving the implicit  in the constructor chaining
p41231
aVThe most likely workaround would be to use a  method instead of a delegate, and simply override it in the derived class
p41232
aVOne workaround would be to pas the instance in as an argument, so the delegate becomes "obj => obj
p41233
aVwhatever
p41234
aV, and use
p41235
aVSimpler repro:
p41236
aVI would need to check the spec, but I'm not sure whether  is valid in this context
p41237
aVso the 4
p41238
aV0 compiler could be correct
p41239
as(dp41240
g18
V23354
p41241
stp41242
a((dp41243
g2
(lp41244
VI'm assuming you would normally do something like this as part of a factory implementation, where the actual types aren't known at compile-time
p41245
aVFirst, note that an easier approach may be a post-create init step, then you can use generics:
p41246
aVYou can then use  and/or
p41247
aVOtherwise; you can do this with on the fly with  (3
p41248
aV5) or  (2
p41249
aV0); the  approach is easiest (examples on the way
p41250
aVand
p41251
as(dp41252
g18
V23354
p41253
stp41254
a((dp41255
g2
(lp41256
VOne approach here would be to use captured variables so that all delegates essentially become  or maybe  - and leave the rest to the caller via the magic of anonymous methods, captured variables, etc - i
p41257
ag50
aV(caveat: watch out for async / capture - often a bad combination)
p41258
aVwhere  accepts an
p41259
aVThen when you invoke the  the parameters are automatically added etc
p41260
aVIn some RPC library code I've taken this approach the other way, using  - so I express a service interface (as normal), and then have methods like:
p41261
aVcalled, for example:
p41262
aVThen the caller says what to if we had an implementation of that interface - except we never actually do; instead, we pull the  apart and look at the method being called, the args, etc - and pass these to the RPC layer
p41263
aVIf you are interested, it is discussed more here, or the code is available here
p41264
as(dp41265
g18
V23354
p41266
stp41267
a((dp41268
g2
(lp41269
VYou have an  - you can do all sorts of things
p41270
aVFor example
p41271
as(dp41272
g18
V23354
p41273
stp41274
a((dp41275
g2
(lp41276
VYou mention binary, and indeed  is very brittle here
p41277
aVThe problem is that  is type and field based
p41278
aVInstead, you want a contract-based serializer, such as ,  (3
p41279
aV0), etc
p41280
aVOr for binary, protobuf-net is a C# implementation of Google's "protocol buffers" wire format, but re-implemented along
p41281
aVNET lines; (note: I'm the author
p41282
aVIt is (like the others) data-contract based, but instead of  etc, it uses numeric tags to identify things instead; so:
p41283
aVAs you add more members you give them new unique numbers; this keeps it extensible without relying on any names etc
p41284
aVPlus it is very fast ;-p As with , it will ignore things it doesn't expect (or it can store them for safe round-trip of unexpected data), and supports the same default things
p41285
aVYou can even use your existing xml attributes:
p41286
aVI could talk about this subject all day, so I'd better shut up before [too late]
p41287
as(dp41288
g18
V23354
p41289
stp41290
a((dp41291
g2
(lp41292
VIf the property exposes the array:
p41293
aVIf you mean "can I have an indexed property", then no - but you can have a property that is a type with an indexer:
p41294
as(dp41295
g18
V23354
p41296
stp41297
a((dp41298
g2
(lp41299
VI tried a few things
p41300
aVone sure fire way of getting it not to compile would be to re-declare the properties as obsolete or take away the setter - not nice, though
p41301
aVI tried a few other settings (non-browsable, marked immutable*), but it didn't help much:
p41302
aVAnyway, in the above  can't be set for an attribute, even though it can on the base
p41303
aVHacky and ugly
p41304
as(dp41305
g18
V23354
p41306
stp41307
a((dp41308
g2
(lp41309
VNo, I don't think that  is supported (see MSDN)
p41310
aVPerhaps throw the data in as xml and strip it apart at the server
p41311
aVSQL/XML is pretty good in 2005/2008
p41312
aVYou might also want to look at table-value-parameters, but I doubt that CE supports these
p41313
as(dp41314
g18
V23354
p41315
stp41316
a((dp41317
g2
(lp41318
VSimilarities:
p41319
aVthey are both logical code expansions, providing boiler-plate code of otherwise complex scenarios
p41320
aVboth involve a hidden variable introduced by the compiler: for the iterator and the snapshot of the disposable object, respectively
p41321
aVBut that is about where it ends
p41322
aVdemands ;  might trigger from , but is actually duck typed (you don't need  for )
p41323
aVhas a predictable / construct;  might involve a  if the iterator is
p41324
aVIf anything, I'd say  is closer to  than to
p41325
as(dp41326
g18
V23354
p41327
stp41328
a((dp41329
g2
(lp41330
VIMO, those methods should be throwing an exception
p41331
aVA lot of this could (in theory) be improved in 4
p41332
aV0 with code-contracts, since that makes it a bit more formal when a method claims to return null (or not) and demand non-null (or not)
p41333
aVBut no; there is no inbuilt checking for this; the compiler enforces that things are definitely assigned, but not what they are assigned to
p41334
aVIn C# 3
p41335
aV0 you could perhaps do something cheeky like:
p41336
aVThen you could use this as a fluent API:
p41337
aVThen  will never be null
p41338
as(dp41339
g18
V23354
p41340
stp41341
a((dp41342
g2
(lp41343
VSorry for the delay - working hours, etc
p41344
aVDo both ends know about this change
p41345
aVUnfortunately, the WCF integration doesn't play very nicely with "mex"-generated proxies at the client, but works OK with assembly sharing
p41346
aVAlternatively, there is some work in progress to use an endpoint behaviour that can be specified in the config; this isn't 100%, but should be very soon - and allows WCF to use protobuf-net transparently, with no midifications to the service contract (although the members still need to know about it, either through  etc, or
p41347
as(dp41348
g18
V23354
p41349
stp41350
a((dp41351
g2
(lp41352
VSometimes you simply have to mix models
p41353
aVPerhaps use  for this part of your repository (since this plugs directly into the bulk-copy API), and Entity Framework for some of the rest
p41354
aVAnd if necessary, a bit of direct ADO
p41355
aVNET
p41356
aVUltimately the goal is to get the job done
p41357
as(dp41358
g18
V23354
p41359
stp41360
a((dp41361
g2
(lp41362
VIt seems unusual that you would have that many fields that are truly nullable, but if you need to describe "no value" separately to any magic domain value of (for example) an , then yes:  may help
p41363
aVNote that you must manually translate from  to  at the data-layer, as  on a  means "don't send this parameter", not "send the value " (if you see the distinction)
p41364
as(dp41365
g18
V23354
p41366
stp41367
a((dp41368
g2
(lp41369
VIf all else fails, try it
p41370
aVI've just tested the following in VS2010b2, compiled targeting 2
p41371
aV0:
p41372
aVThis uses two new C# 4
p41373
aV0 language features, which use the meta-data that is also present in
p41374
aVNET 2
p41375
aVx/3
p41376
aVx/CLR 2; it executes fine on my regular (CLR 2) machine (my VS2010b2 is a VM)
p41377
aVSo I conclude "yes, for some features"
p41378
aVObviously if you use a framework-dependent feature (, etc) it isn't going to end so well
p41379
aVEdit: re your comment; I've tried  at the command-line, and by default this does target CLR 4; I'll try to see if I can get it to target CLR 2 (like VS obviously can)
p41380
aVUnfortunately, it no longer includes the (faked, btw) command line in the build output window
p41381
aVUpdate: some "in the know" people came back with:
p41382
aVPass /nostdlib and a reference to the 2
p41383
aV0 mscorlib
p41384
aVdll
p41385
aVAnd sure enough:
p41386
aVworks fine (exe works on my non-4
p41387
aV0 machine)
p41388
aVCredit: Kevin Pilch-Bisson
p41389
as(dp41390
g18
V23354
p41391
stp41392
a((dp41393
g2
(lp41394
VIf you are doing this regularly, then for this volume, I would use  to push to data into a staging table (same schema to the target table, but isolated), and then use a stored procedure to do the inserts / updates (from the staging table into the actual table) - probably wrapped in a transaction
p41395
aVThis will minimize the round-trips, and use the bulk insert API for pushing the data
p41396
aVIf you don't need everything in one batch, another option would be to process the data in blocks of (say) 100 records; this should work, without causing the transactions to take too long - it will be noticeably slower than the bulk-copy approach, but has the advantage of being object-based, and not requiring you to use an extra set of tools / languages
p41397
as(dp41398
g18
V23354
p41399
stp41400
a((dp41401
g2
(lp41402
VIf it is a custom attribute, is it set to inherit = true
p41403
aVAlso; perhaps side-step the issue; don't make the public attributed method  - instead make it call a  method
p41404
aVA little abstraction goes a long way
p41405
as(dp41406
g18
V23354
p41407
stp41408
a((dp41409
g2
(lp41410
VNET 3
p41411
aV5 (commonly confused with C# 3
p41412
aV0, although they are completely separate) introduced:
p41413
aVand concrete types:
p41414
aV(and a load of private stuff, but those are the main public ones)
p41415
as(dp41416
g18
V23354
p41417
stp41418
a((dp41419
g2
(lp41420
VYou have a debugger in front of you
p41421
aVPut a break point on that line, and when it stops investigate all the fields/variables/etc involved
p41422
aVIt sounds like however  is defined, it is currently
p41423
as(dp41424
g18
V23354
p41425
stp41426
a((dp41427
g2
(lp41428
VYou can't
p41429
aVThat is a key part of the API
p41430
aVYou could, however, do something around the side, such as accepting a  argument
p41431
aVYou might also think up some exotic "fluent API / extension method" way of doing it, but to be honest it probably won't be worth it; but something like:
p41432
aVor with generic type inference:
p41433
aVEach merge step would simple store away the work to do, only accessed by
p41434
as(dp41435
g18
V23354
p41436
stp41437
a((dp41438
g2
(lp41439
VIt is hard to answer this fully without sample data and actual types, but I would refactor it like below
p41440
aVFrom the original example, I'm assuming we don't want to mess with the constructors of the entities ( etc), and that we want to retain the separate "" model, putting our entities inside the tree (rather than changing the entities to model things as associated collections)
p41441
aVI've also assumed that we can take more liberties with  than we can with the entities, so I've introduced a constructor that accepts , since this allows use with LINQ sub-queries:
p41442
aVWith framework code below:
p41443
as(dp41444
g18
V23354
p41445
stp41446
a((dp41447
g2
(lp41448
VJust to clarify: if you are serializing to xml for the purposes of having xml in a known format, then  is a bad choice; you would do better to use , which has more control over xml layout
p41449
aVYou would use the  /  /  /  attributes instead of  etc
p41450
aVIf you just want to use xml because it is text and stores the object, then  is fine; and has other advantages, for example - not demanding a public parameterless constructor (which  does), and working with private members (which  doesn't)
p41451
as(dp41452
g18
V23354
p41453
stp41454
a((dp41455
g2
(lp41456
VOf course, it this is for displaying password equivalents, it might be better to use a fixed number of asterisks - the less clues the better
p41457
aVOf course, since you'd obviously be hashing the password (with salt) and storing just the hash, you couldn't know the actual length anyway ;-p
p41458
as(dp41459
g18
V23354
p41460
stp41461
a((dp41462
g2
(lp41463
VThat is the LINQ ; and can be used:
p41464
aV(you can also pass in the column index or the  in place of the string)
p41465
aVfor untyped datarows, or:
p41466
aVfor typed datarows
p41467
aVMSDN has full documentation on this; for example, here is the overload I am using in the examples above
p41468
as(dp41469
g18
V23354
p41470
stp41471
a((dp41472
g2
(lp41473
VIt usually makes very little sense to serialize a delegate
p41474
aVNormally, you would choose to mark delegate fields as , and recreate it when needed
p41475
aVIf your main intent is to store the delegates, then I would recommend thinking of a completely different approach, frankly
p41476
aVAdditionally, note that  is brittle if you are planning to keep the data for any length of time (but acceptable for transient data)
p41477
aVTo look further, I suspect we'd need to look at some reproducible code
p41478
aVUpdate: actually, I suspect you could serialize it by writing your own explicit capture classes (rather than the compiler-generated ones)
p41479
aVBut I still think the concept is fundamentally flawed
p41480
aVAnd writing capture classes by hand isn't fun
p41481
aVTo address the points in comments; re long term storage - because it is so darned brittle - something as simple as changing from:
p41482
aVto
p41483
aVwill destroy serialization; as will changing assemblies, type names, "looking at it funny", etc
p41484
aVRe the delegates; to give an example of a manual capture; instead of:
p41485
aVyou might do:
p41486
aVwith
p41487
aVAs you can see - not always trivial (this is the simplest of examples)
p41488
as(dp41489
g18
V23354
p41490
stp41491
a((dp41492
g2
(lp41493
VInside the current assembly, you can make it
p41494
aVOutside the current assembly, the best you can do is make it available to specific assemblies, via
p41495
aVNET does not offer more granular "friend" access
p41496
as(dp41497
g18
V23354
p41498
stp41499
a((dp41500
g2
(lp41501
VNumbered backreference is just \u005cn, so \u005c1 should work here:
p41502
as(dp41503
g18
V23354
p41504
stp41505
a((dp41506
g2
(lp41507
VIt really depends on what you mean; there are lots of options:
p41508
aVCodeDOM - provides an object model that can generate code for multiple languages, but can be tricky to use
p41509
aVT4 (aka TT) - the "in fashion" codegen of the moment
p41510
aVxslt - a useful fallback; not as fashionable as T4, but workable - tricky for whitespace-dependent languages like VB
p41511
aVIn all cases, I would build a basic object-model that represents the data and work from there
p41512
aVI have known somebody write code-gen from a database just with , but it was ugly as sin, and painful in the extreme to maintain
p41513
aVRe your questions about , ,  etc - I don't understand the question, but: whatever the target language wants
p41514
aVVB is the tricky one here (C# etc are easier as they don't care much about whitespace)
p41515
aVI've used xslt successfully, but largely because I already knew xslt, and needed to support 2
p41516
aV0 (T4 isn't in 2
p41517
aV0); otherwise T4 would have been my next stab, simply because I want to learn it ;-p
p41518
as(dp41519
g18
V23354
p41520
stp41521
a((dp41522
g2
(lp41523
VHow complex is the data
p41524
aVIf it is an object tree (rather than a full graph), then you might get some interesting results from trying protobuf-net
p41525
aVIt is generally pretty easy to fit onto existing classes, and is generally much smaller, faster, and less brittle (you can change the object model without trashing the data)
p41526
aVDisclosure: I'm the author, so might be biased - but it really isn't terrible
p41527
aVI'd happily lend some* time to help you try it, though
p41528
aV*=within reason
p41529
as(dp41530
g18
V23354
p41531
stp41532
a((dp41533
g2
(lp41534
VI do this in my build script:
p41535
aVusing the community build tasks
p41536
aVThis essentially applies a regex to the AssemblyInfo
p41537
aVcs, replacing the current revision with the svn revision
p41538
as(dp41539
g18
V23354
p41540
stp41541
a((dp41542
g2
(lp41543
VIt sounds like it is trying to write files into system32, presumably as a working directory
p41544
aVPerhaps change the working directory
p41545
aVOr if the code is yours, write to temp
p41546
aVI'm not sure why it would want to copy mscorlib, unless this is some kind of shadow-copy gone bad
p41547
as(dp41548
g18
V23354
p41549
stp41550
a((dp41551
g2
(lp41552
VIn what way have you serialized it
p41553
aVNormally you would just reverse that process
p41554
aVFor example:
p41555
aVObviously you may need to tweak this if you have used a different serializer
p41556
aVOr if you can get the data as a  (rather than a ) you can lose the  step
p41557
as(dp41558
g18
V23354
p41559
stp41560
a((dp41561
g2
(lp41562
VI assume you mean with the static analysis tools
p41563
aV(I would expect the runtime check to work, at least - and you could presumably leave it in debug builds)
p41564
aVI doubt that this is something that static analysis is going to be able to see through -  is simply too complex, etc
p41565
aVIn short; I doubt it
p41566
aVlambdas () are an option, but they are much slower than passing just a string
p41567
as(dp41568
g18
V23354
p41569
stp41570
a((dp41571
g2
(lp41572
VNormally, stick with  etc
p41573
aVIn addition to the other answers; there are also cases where you intentionally only want to support the given data-size, because it represents some key truth about the data
p41574
aVThis may be key when talking to external systems (in particular interop, but also databases, file-formats, etc), and might be mixed with  arithmetic - to spot overflows as early as possible
p41575
as(dp41576
g18
V23354
p41577
stp41578
a((dp41579
g2
(lp41580
VOne key point: only access  /  once in a related check - otherwise you can get some very freaky results just on the stroke of midnight
p41581
aVAn extreme edge-case, maybe
p41582
as(dp41583
g18
V23354
p41584
stp41585
a((dp41586
g2
(lp41587
VGetting configuration right is so important that I would throw an  if it is at all dodgy
p41588
aVbetter to spot a configuration error as soon as it is made
p41589
aVScenario "a": developer tries to reconfigure the site; gets a YSOD, reads the error message on their local machine, fixes the error, deploys the change
p41590
aVScenario "b": developer tries to reconfigure the site; it looks OK, deploys the change, somebody notices "day 0" in production, some minor grumbles, it gets fixed by an embarrassed dev
p41591
aVScenario "c": developer tries to reconfigure the site; it looks OK, deploys the change, the difference is subtle and nobody notices until the end-of-year accounts look odd; it goes in front of the board / directors
p41592
aVI want scenario "a" every time
p41593
as(dp41594
g18
V23354
p41595
stp41596
a((dp41597
g2
(lp41598
VSpeaking for C# generally (not mono specifically): it makes no difference
p41599
aVI tend to leave one line of whitespace
p41600
aVNote that FxCop StyleCop would (with the default settings) actually tell you to re-order them:
p41601
aVOddly enough, LINQ-to-SQL / SqlMetal has a subtle bug (fixed in 4
p41602
aV0) relating to this distinction
p41603
as(dp41604
g18
V23354
p41605
stp41606
a((dp41607
g2
(lp41608
V1: pretty much; note that all the files must be considered together (they aren't generally compiled individually and then combined), and that technically IL isn't "executed" (since it isn't native CPU instructions); it must be either translated (by the JIT or NGEN) into machine code, or on some platforms ("micro framework") it is interpreted
p41609
aVBut the result is the same
p41610
aV2: same process, except it doesn't call the exes directly - it just invokes the code directly
p41611
as(dp41612
g18
V23354
p41613
stp41614
a((dp41615
g2
(lp41616
VYou can re-declare it (or rather, tell the compiler that you intend to hide it):
p41617
aVBut this is confusing, and you'll need to use explicit implementations etc, and probably a bit of casting at the caller if you want to use the hidden version
p41618
aVIf you went this route, I would recommend exposing both the  and  on :
p41619
aVRe the comments; to expose on the implementing type:
p41620
aVThis would also work if you make it (which I prefer):
p41621
as(dp41622
g18
V23354
p41623
stp41624
a((dp41625
g2
(lp41626
VYou seem to have attached the attribute to the field; attributes always adhere to the next thing (in this case, the field)
p41627
aVYou should re-order so that they adhere to the property instead of the field
p41628
aVBTW; protected fields are rarely a good idea (they should be private); but especially if the property is public: what is the point
p41629
as(dp41630
g18
V23354
p41631
stp41632
a((dp41633
g2
(lp41634
VHmm
p41635
aVI didn't know that the java-me story was lacking; you might want to ask on the specific group
p41636
aVThe 3rd party page lists one other that might be worth a look
p41637
aVOf course, you could write your own ;-p (and yes: I realise that defeats the purpose even further; I'm half in jest here
p41638
aVnearly half
p41639
as(dp41640
g18
V23354
p41641
stp41642
a((dp41643
g2
(lp41644
VI would say "no", but don't start using it insanely
p41645
aVActually,  is, from what I've benchmarked, faster than basic reflection, since it is keeping delegates (rather than using reflection  all the time)
p41646
aVIn particular, two strengths are:
p41647
aVcalling into generic methods ( etc is just so painful)
p41648
aVcalling operators
p41649
aVHowever, there are using ways of doing what you need with interfaces etc;  on a non-dynamic type really amounts to duck-typing
p41650
aVThis is useful in a very limited set of scenarios; mostly: interfaces would be preferred
p41651
aVBy don't rule them out
p41652
aVThe downside of  is that to be useful (without writing insane code) you need to know the names at compile-time; which often isn't the case, or we wouldn't be in this pickle
p41653
aVWhen you only know the name at runtime, there are other options (, , "HyperDescriptor", , etc) of access the data in a fast way
p41654
as(dp41655
g18
V23354
p41656
stp41657
a((dp41658
g2
(lp41659
VWith the first,  will work
p41660
aVnot with the second
p41661
aVArrays are always mutable in that you can re-assign by index, even if you can't add/remove
p41662
aVA read-only-collection is just that: read-only
p41663
as(dp41664
g18
V23354
p41665
stp41666
a((dp41667
g2
(lp41668
VAs an example:
p41669
as(dp41670
g18
V23354
p41671
stp41672
a((dp41673
g2
(lp41674
VIf you are writing code that returns  as an error condition, then don't: generally, you should throw an exception instead - far harder to miss
p41675
aVIf you are consuming code that you fear may return null, then mostly these are boneheaded exceptions: perhaps do some  checks at the caller to sense-check the output during development
p41676
aVYou shouldn't really need vast numbers of  checks in you production, but if some 3rd party library returns lots of s unpredictably, then sure: do the checks
p41677
aVIn 4
p41678
aV0, you might want to look at code-contracts; this gives you much better control to say "this argument should never be passed in as null", "this function never returns null", etc - and have the system validate those claims during static analysis (i
p41679
ag50
aVwhen you build)
p41680
as(dp41681
g18
V23354
p41682
stp41683
a((dp41684
g2
(lp41685
VPersonally, I'd be more worried about simply using structs inappropriately; what you have described sounds like an object (class) to me
p41686
aVIn particular, I'd worry about your struct being too big; when you pass a struct around (between variables, between methods, etc) it gets copied
p41687
aVIf it is a big fat beast with lots of fields (some of which are themselves beasts) then this copy will take more space on the stack, and more CPU time
p41688
aVContrast to passing a reference to an object, which takes a constant size / time (width per your x86/x64 architecture)
p41689
aVIf we talk about basic nullable types, such as classic "values";  of course has an overhead; the real questions are:
p41690
aVis it too much
p41691
aVis it more expensive than the check I'd still have to do for a "magic number" etc
p41692
aVIn particular, all casts and operators on  get extra code - for example:
p41693
aVis really more similar to:
p41694
aVThe only way to see if this is too much is going to be with your own local tests, with your own data
p41695
aVThe fact that the data is on a struct in this case is largely moot; the numbers should broadly compare no matter where they are
p41696
as(dp41697
g18
V23354
p41698
stp41699
a((dp41700
g2
(lp41701
VThe unclear spacing in the question doesn't help (especially around the , which has different spacing than the rest, implying we need to use trimming), but here's some custom LINQ methods that do the job
p41702
aVI've used the anon-type purely as a simple way of flattening out the inconsistent spacing (I could also have rebuilt a string, but it seemed unnecessary)
p41703
aVNote that without the odd spacing, this can be simply:
p41704
aVFull code:
p41705
as(dp41706
g18
V23354
p41707
stp41708
a((dp41709
g2
(lp41710
VIf you do that, you are forcing it to do a string conversion
p41711
aVIt would be better to build a start/end date range, and use:
p41712
aVThis will allow it to use the index (if there is one on ), rather than a table scan
p41713
as(dp41714
g18
V23354
p41715
stp41716
a((dp41717
g2
(lp41718
VI suspect you're going to need to add more detail - that isn't reproducible just from your code
p41719
aVIn particular (as already noted) we'd need to see inside the , and verify that the exception is actually being thrown from inside the  and not somewhere else
p41720
aVOther possibilities:
p41721
aVyou have dodgy code inside the exception handler that is itself throwing an exception
p41722
aVyou have a dodgy  that is getting called ( etc)
p41723
aVyou are in
p41724
aVNET 1
p41725
aV1 and the thing getting thrown (in code not shown) isn't an , but some other object
p41726
as(dp41727
g18
V23354
p41728
stp41729
a((dp41730
g2
(lp41731
VThere is a small overhead in having an extra type (), but nothing huge
p41732
aVBut it really depends on what you want to do
p41733
aVIn many ways,  is still a bad idea since it burns  into the public API, and  isn't very extensible (none of the methods are , for example)
p41734
aVmight have more extensibility options
p41735
aVI'd argue in favor of abstraction or encapsulation:
p41736
aVor:
p41737
aVIt is a shame that C# doesn't make the encapsulation approach simple (I'm thinking "mixins")
p41738
aVNote that another trick (sometimes suitable, sometimes not) would be to use extension methods to add the illusion of extra methods on
p41739
aVthis is a tricky debate, so I'm just mentioning it, not saying "do this"
p41740
as(dp41741
g18
V23354
p41742
stp41743
a((dp41744
g2
(lp41745
VPicking apart binary streams really needs a lot of knowledge about the implementation
p41746
aVis proprietary, so
p41747
aVunless that data is really valuable, it might be cheaper to consider it lost
p41748
aVYou could do a lot of scrobbling, but it won't be easy, and dev time isn't cheap
p41749
aVI'm not saying it can't be done, though
p41750
aVFWIW, I can think of ways of doing this for some other serializers - just not
p41751
as(dp41752
g18
V23354
p41753
stp41754
a((dp41755
g2
(lp41756
VYou can do this, but it involves reflection - , in particular:
p41757
aVI haven't completed that, since your example is confusing; the method is instance, but is called as though it were static
p41758
aVInterestingly (perhaps),  might make this easier in 4
p41759
aV0 - I don't have my VM to hand, but imagine:
p41760
aVI'd need to check, but I expect that would do a lot of the heavy lifting for us
p41761
aVThe other common approach is to expose methods that work on a , rather than via generics
p41762
as(dp41763
g18
V23354
p41764
stp41765
a((dp41766
g2
(lp41767
VRegistry is always fun, but doesn't that mean that you are editing the user registry settings of the "local system" user
p41768
aVSo unless your actual user is logged in as "local system" (which I seriously doubt), they aren't going to see anything
p41769
aVI suspect you need to edit the machine-wide settings, or the active user(s)
p41770
as(dp41771
g18
V23354
p41772
stp41773
a((dp41774
g2
(lp41775
VI doubt that  is going to have anywhere near strong enough metadata to be useful, and you'll need classes
p41776
aVI did a few pots (starting here) on getting it working with LINQ-to-SQL that you might find useful
p41777
as(dp41778
g18
V23354
p41779
stp41780
a((dp41781
g2
(lp41782
V is really the pre-generics version; you should just be able to use
p41783
aVYou could encapsulate, of course; this will then work even for custom implementations:
p41784
as(dp41785
g18
V23354
p41786
stp41787
a((dp41788
g2
(lp41789
VThere is an edge case where this matters; if you "capture" the variable into an anonymous method / lambda
p41790
aVOtherwise it is premature and makes no difference
p41791
aVAt all
p41792
aVAn example of when it does matter:
p41793
aVvs
p41794
as(dp41795
g18
V23354
p41796
stp41797
a((dp41798
g2
(lp41799
VThe default columns are based on the data-type
p41800
aVI haven't checked, but for a link you could try exposing the data as , but that might be hopeful
p41801
aVReally, if you want a specific type of column - add the columns through code and set  to
p41802
aVAs Andrew implies; normally something like reflection is used to generate the columns, and you'll get a column for every (browsable + public + readable) property
p41803
aVThere is a layer of abstraction on top of this if you need, but this won't help with adding a hyperlink column
p41804
as(dp41805
g18
V23354
p41806
stp41807
a((dp41808
g2
(lp41809
VYou can use things like the  in MiscUtil, which wraps a  and simply ignores / requests
p41810
aVFor just this purpose
p41811
as(dp41812
g18
V23354
p41813
stp41814
a((dp41815
g2
(lp41816
Vdoes NOT change the bound data
p41817
aVfor 2-way binding, you need notification events - this can take 2 common forms:
p41818
aVa , where  is the bound property (, for example)
p41819
aVthe object can implement
p41820
aVThis is certainly how object-to-control binding works; I'm pretty sure that control-to-object detection is very similar
p41821
aVNote that there is a  event, but no  event
p41822
as(dp41823
g18
V23354
p41824
stp41825
a((dp41826
g2
(lp41827
VBinary data (such as images) doesn't work in a
p41828
aVNET string; you want something like (assuming  isn't an option):
p41829
aVThis treats the image as binary (), and uses a buffer/loop to avoid blowing up if you have a big image (when  could be expensive)
p41830
as(dp41831
g18
V23354
p41832
stp41833
a((dp41834
g2
(lp41835
VGotta love variance
p41836
aVA  is not a  - otherwise,  could attempt to add a  to the list, and the compiler wouldn't spot it
p41837
aVOne trick is to use a generic method:
p41838
aVIn terms of the example I presented above - note that we are able to add a  to the list; useful in particular if we add the  constraint, or pass in (for example) a
p41839
aVNote also that  becomes covariant in C# 4
p41840
aV0 /
p41841
aVNET 4
p41842
aV0, so if you passed in just an  (rather than a list) it would work "as is":
p41843
as(dp41844
g18
V23354
p41845
stp41846
a((dp41847
g2
(lp41848
VWell, first define "advanced", i
p41849
ag50
aVwhat specifically do you need that  doesn't have
p41850
aVIn terms of POCO,  has an overloaded ctor that accepts all the attributes you could ever want to add, to avoid having to add them to your object model - but it does still require a public parameterless constructor, and only works on public read/write fields/properties
p41851
aVAnd you should cache/re-use the serializer if you use this approach
p41852
aVI'm not aware of any like alternatives, simply because in most cases this is "good enough" - and it is often a mistake to try to brute-force your existing domain object into a DTO
p41853
aVIt may be simpler and more maintainable to simply map your domain entities onto a new DTO(s) that are attributed (and have appropriate ctor/properties/etc)
p41854
aVNote that for the ctor/properties issue  has some answers, but this doesn't have as much fine-grained control over what the xml looks like
p41855
as(dp41856
g18
V23354
p41857
stp41858
a((dp41859
g2
(lp41860
VDo you mean / or similar
p41861
aVThat would suggest that the lock is contended - in which case, fix whichever code is holding the (write) lock at the time
p41862
aVIf the delay is literally with the locking class, then maybe  would have less overhead
p41863
aVwould indeed be simpler still (hence cheaper), but doesn't allow the same granularity - it is essentially a mutex lock, so only one thread can play with the object
p41864
aVContrast a reader/writer lock which allows one writer NAND multiple readers
p41865
aVTo be honest, it sounds as simple as "occasionally, some code will take a write lock (blocking other callers), and take a while to complete"
p41866
aVFinding the offending code is a black art, but has little to do with the lock itself
p41867
as(dp41868
g18
V23354
p41869
stp41870
a((dp41871
g2
(lp41872
VAs has been mentioned, you can't change the property name; how would you code against it, for example
p41873
aVHowever, if this is for data-binding, you can do some tricks to bend the display name of properties at runtime - for example / (and a custom )
p41874
aVLots of work; it would need to really be worth it
p41875
aVAnother option is a custom attribute:
p41876
as(dp41877
g18
V23354
p41878
stp41879
a((dp41880
g2
(lp41881
VThere are three ways of doing this; either you can use  against the type, or you can use / against the property
p41882
aVThey are all shown below; uncomment the pair you prefer:
p41883
as(dp41884
g18
V23354
p41885
stp41886
a((dp41887
g2
(lp41888
VIntellisense is showing you the additional comments data (generated from your /// comments, and typically stored in an xml file next to your dll/exe), which is not available to reflection, so no
p41889
aVYou would have to load this manually
p41890
aVYou can access the  attribute, but this is not the same
p41891
as(dp41892
g18
V23354
p41893
stp41894
a((dp41895
g2
(lp41896
VThe currency-manager is shared whenever you use the same data-source reference
p41897
aVOne trick is to set the binding-context per control:
p41898
aVAnother option is to use difference references, for example by abstracting through a different  for each control
p41899
as(dp41900
g18
V23354
p41901
stp41902
a((dp41903
g2
(lp41904
VThe compiler is never going to be able to spot reflection
p41905
aVBy definition, by using reflection you have stepped outside the compiler
p41906
aVIMO, though, this is a bad use of structs - that looks very much like it should be working on classes
p41907
as(dp41908
g18
V23354
p41909
stp41910
a((dp41911
g2
(lp41912
VNow try it in release mode, outside of the debugger ;-p
p41913
aVI get different results with/without a debugger
p41914
aVThe debugger upsets a lot of subtle nuances / optimisations, so I can only guess this is one of those times where the debugger matters
p41915
aVWhich makes it even harder to debug ;-p
p41916
as(dp41917
g18
V23354
p41918
stp41919
a((dp41920
g2
(lp41921
VFrom the FAQ
p41922
aVHow do I completely remove a file from
p41923
aVthe repository's history
p41924
aVThere are
p41925
aVspecial cases where you might want to
p41926
aVdestroy all evidence of a file or
p41927
aVcommit
p41928
aV(Perhaps somebody accidentally
p41929
aVcommitted a confidential document
p41930
aVThis isn't so easy, because Subversion
p41931
aVis deliberately designed to never lose
p41932
aVinformation
p41933
aVRevisions are immutable
p41934
aVtrees which build upon one another
p41935
aVRemoving a revision from history would
p41936
aVcause a domino effect, creating chaos
p41937
aVin all subsequent revisions and
p41938
aVpossibly invalidating all working
p41939
aVcopies
p41940
aVThe project has plans, however, to
p41941
aVsomeday implement an  command which would
p41942
aVaccomplish the task of permanently
p41943
aVdeleting information
p41944
aV(See issue 516
p41945
aVIn the meantime, your only recourse is
p41946
aVto  your repository, then
p41947
aVpipe the dumpfile through
p41948
aV(excluding the bad path)
p41949
aVinto an  command
p41950
aVSee
p41951
aVchapter 5 of the Subversion book for
p41952
aVdetails about this
p41953
as(dp41954
g18
V23354
p41955
stp41956
a((dp41957
g2
(lp41958
VJust
p41959
aVYou need to add  to make it pause
p41960
as(dp41961
g18
V23354
p41962
stp41963
a((dp41964
g2
(lp41965
VIn the scenario given, you should be able to use the async nature of things like  / , which will support all this already, using completion-ports rather than just threads
p41966
aVRe "kill now" - you should never abort a thread unless you are tearing down your process
p41967
aVThis is a bad thing, and can leave the system in a corrupt state, or with irretrievable locks
p41968
aVHowever tool itself may offer alternatives:
p41969
aVNote that in an async callback (the  above) you would, in anything like winforms/wpf, have to switch to the UI thread; for example:
p41970
as(dp41971
g18
V23354
p41972
stp41973
a((dp41974
g2
(lp41975
VThat is the variable name, not the object name
p41976
aVIt also poses the question: what is the name here:
p41977
aVYou can't do this for constructors etc; in limited scenarios it is possible to get a variable name via , if you really want:
p41978
aVNote that this relies on the capture implementation, etc - and is generally cheeky
p41979
as(dp41980
g18
V23354
p41981
stp41982
a((dp41983
g2
(lp41984
VI'm making the assumption that you are using
p41985
aVFirst, I'd argue that  is not always a good idea (it is very brittle, and doesn't withstand much change)
p41986
aVBut I'd also suggest that the problem is that you are trying to serialize the implementation, when in fact all you need to serialize is the data
p41987
aVI would approach this problem by writing my own DTO that represents the state of the system, and serialize the DTO:
p41988
aVAdvantages:
p41989
aVyou know what data (state) you are serializing
p41990
aVit is implementation unaware; you can use a different  implementation and it doesn't matter
p41991
aVyou can use your choice of serializers by using the appropriate attributes etc
p41992
aVit doesn't break serialization when you update your version of the  library (your dto can stay the same)
p41993
as(dp41994
g18
V23354
p41995
stp41996
a((dp41997
g2
(lp41998
VThe first thing I'd try is losing the  array
p41999
aVPerhaps using just 4 variables for the 4 nearest locations
p42000
aVYou always treat this by constant index, so this should be a simple change, especially if you name like the array index:
p42001
aVThe next thing I'd look at is the  usage; I don't know if  (in this use) will be optimized out, so I would try pre-caching that
p42002
aVIn a linear array,  is optimized (in the full CLR, at least) - but not  AFAIK:
p42003
aVAlso; what is
p42004
aVA  or a
p42005
aVI would be tempted to try this as both - making sure it is immutable, and passing in the data via the constructor to make the IL slimmer:
p42006
aVIn the following, you are doing some work that is discarded most of the time:
p42007
aVI would do:
p42008
aVI'm also interested in that that  line; there is a lot there that we can't see that might need more work - the  operator, and the  method
p42009
aVAm I right in assuming that  involves a square-root
p42010
aV(expensive) You could avoid this by working in square distances instead
p42011
aVYou might need to make this explicit with a square-length method that doesn't take the root, and compare square lengths throughout, but you can save lots of CPU cycles
p42012
aVThis is available as LengthSquared()
p42013
as(dp42014
g18
V23354
p42015
stp42016
a((dp42017
g2
(lp42018
VThe  pattern is best following the standard pattern, which allows use with non-structs, too:
p42019
aVNote I've accepted a  here, because that is what me most commonly mean by ; otherwise,  might be more appropriate
p42020
aVI see no reason for this to be an extension method (as per  in the question's example), and certainly it is inadvisable to pollute  with too many extension methods
p42021
as(dp42022
g18
V23354
p42023
stp42024
a((dp42025
g2
(lp42026
VYou can subclass most of the common attributes quite easily to provide this extensibility:
p42027
aVThere are more complex options that involve writing custom s, exposed via ,  or  - but that is usually overkill
p42028
as(dp42029
g18
V23354
p42030
stp42031
a((dp42032
g2
(lp42033
VFor info, this has changed in VS2010 (in beta 2, at least)
p42034
aVIt looks like this filtering has been removed (presumably it caused too much confusion), and the methods are now visible, along with the extension-method glyph
p42035
as(dp42036
g18
V23354
p42037
stp42038
a((dp42039
g2
(lp42040
VI had this problem recently, and had to deconstruct stored state to investigate a performance issue; the rough code was something like:
p42041
as(dp42042
g18
V23354
p42043
stp42044
a((dp42045
g2
(lp42046
VThis is a common problem in file parsing
p42047
aVCommonly, you read the known part of the descriptor (which luckily is fixed-length in this case, but isn't always), and branch it there
p42048
aVGenerally I use a strategy pattern here, since I generally expect the system to be broadly flexible - but a straight switch or factory may work as well
p42049
aVThe other question is: do you control and trust the downstream code
p42050
aVMeaning: the factory / strategy implementation
p42051
aVIf you do, then you can just give them the stream and the number of bytes you expect them to consume (perhaps putting some debug assertions in place, to verify that they do read exactly the right amount)
p42052
aVIf you can't trust the factory/strategy implementation (perhaps you allow the user-code to use custom deserializers), then I would construct a wrapper on top of the stream (example:  from protobuf-net), that only allows the expected number of bytes to be consumed (reporting EOF afterwards), and doesn't allow seek/etc operations outside of this block
p42053
aVI would also have runtime checks (even in release builds) that enough data has been consumed - but in this case I would probably just read past any unread data - i
p42054
ag50
aVif we expected the downstream code to consume 20 bytes, but it only read 12, then skip the next 8 and read our next descriptor
p42055
aVTo expand on that; one strategy design here might have something like:
p42056
aVYou might build a dictionary (or just a list if the number is small) of such serializers per expected markers, and resolve your serializer, then invoke the  method
p42057
aVIf you don't recognise the marker, then (one of):
p42058
aVskip the given number of bytes
p42059
aVthrow an error
p42060
aVstore the extra bytes in a buffer somewhere (allowing for round-trip of unexpected data)
p42061
aVAs a side-note to the above - this approach (strategy) is useful if the system is determined at runtime, either via reflection or via a runtime DSL (etc)
p42062
aVIf the system is entirely predictable at compile-time (because it doesn't change, or because you are using code-generation), then a straight  approach may be more appropriate - and you probably don't need any extra interfaces, since you can inject the appropriate code directly
p42063
as(dp42064
g18
V23354
p42065
stp42066
a((dp42067
g2
(lp42068
VSince the 2010 editions have a go-live license and a release date, I wouldn't be too concerned about using them about now
p42069
aVI would probably want my projects to be released after
p42070
aVNET 4
p42071
aV0 RTM though, but I would expect any last-minute changes to be easy enough to fix
p42072
aVWhich edition is a trick
p42073
aVI'd start with Express and maybe a "pro" evaluation
p42074
aVOf course, during the beta you can go mad and use any edition - decide whether it has features you need
p42075
aVI see no benefit going 2005 - especially as 2008/2010 can multi-target
p42076
aVTellingly, the 2005 express editions have been withdrawn
p42077
aVI use express for odd-jobs, but I write my real code in VSTS; in addition to the missing direct features, express lacks extensibility
p42078
aVI use a few (not too many) VSTS addins to make development more productive
p42079
as(dp42080
g18
V23354
p42081
stp42082
a((dp42083
g2
(lp42084
VSomething like:
p42085
aVYou might also consider making it more reusable:
p42086
as(dp42087
g18
V23354
p42088
stp42089
a((dp42090
g2
(lp42091
VFirst - you can't "kill the Object "A" explicitly"; you can clear the reference to it, but that just sets a local variable to , and has nothing to do with the actual object on the managed heap
p42092
aVYou can  it, but that is nothing to do with GC
p42093
aVIt all depends; can anything else see  /
p42094
aVIf not, they are eligible for collection
p42095
aVBut GC is non-deterministic; it only happens when it chooses
p42096
aVAt some indeterminate time, GC will kick in, detect that these objects are unreachable, and remove them
p42097
aVIn the process, it will check for any that have finalizers (that are still outstanding), and execute the finalizers (in a 2-step process)
p42098
aVOne thing people often forget about in terms of reachability is events; if / subscribe to events on a long-lived object, then / are reachable (by the event publisher)
p42099
aVTo clarify; GC works by building a tree from the root objects (threads, etc)
p42100
aVIt walks every reference, flagging all the objects that can be reached
p42101
aVAnything that isn't flagged at the end is eligible for collection
p42102
aVThis avoids the COM/COM+ issue of getting memory leaks due to disconnected islands of data, where X => Y and Y => X (so both X and Y have positive ref-counts, so neither gets cleared)
p42103
as(dp42104
g18
V23354
p42105
stp42106
a((dp42107
g2
(lp42108
VMaybe make like easier:
p42109
aVOr see here for a discussion allowing use like:
p42110
as(dp42111
g18
V23354
p42112
stp42113
a((dp42114
g2
(lp42115
VThat should already work - just add a  (it still uses C#-style operators, not implicit math operations such as "10x === 10 * x"):
p42116
as(dp42117
g18
V23354
p42118
stp42119
a((dp42120
g2
(lp42121
VYou want:
p42122
aVThis will only add  for the content items - not the list itself
p42123
aVYou might also want to look at  /  if you want finer control
p42124
as(dp42125
g18
V23354
p42126
stp42127
a((dp42128
g2
(lp42129
VI'm assuming you mean the Rijndael encryption algorithm - in which case RinjdaelManaged would be of use
p42130
aVThe MSDN documentation (previous link) has examples, or there are lots of other references, for example see here
p42131
aVI see (comments to other reply) that you are looking at implementing this yourself
p42132
aVsome thoughts:
p42133
aVdon't
p42134
aVwhy
p42135
aVdon't
p42136
aVUnless this is purely for interest, stick to the existing implementation
p42137
aVIt will eat time, and potentially introduce security weaknesses
p42138
aVI can't think of a good reason to rewrite this
p42139
as(dp42140
g18
V23354
p42141
stp42142
a((dp42143
g2
(lp42144
VA few thoughts:
p42145
aVuse assembly sharing via WCF; this allows you to use the same actual assembly at both ends
p42146
aVAs long as this is a DTO assembly, this is fine (not hugely portable, though)
p42147
aVThis is  (also ) in , or you can do it via the IDE
p42148
aVuse  and round-trip (like you are already; just that WCF maps most closely to , not )
p42149
as(dp42150
g18
V23354
p42151
stp42152
a((dp42153
g2
(lp42154
VIt will behave differently with regards to nulls, so it depends what you want to happen; you mention that  would be OK, but there is nothing in the code cited that would raise this, hence why it could cause unexpected errors downstream
p42155
aVI never have, but I'm always tempted to add:
p42156
aVso I can use:
p42157
as(dp42158
g18
V23354
p42159
stp42160
a((dp42161
g2
(lp42162
VExtension methods are magic - they only look like instance methods, but given the extension method:
p42163
aVthen:
p42164
aVcompiles to:
p42165
aVAnd you wouldn't expect that to throw a  - and indeed it doesn't
p42166
aVThis is double-edged
p42167
aVOn some levels it is confusing, but it can be really useful
p42168
aVIt would be good practice to add your own null-ref check at the start unless you have a reason to allow nulls
p42169
aVAnother useful one:
p42170
as(dp42171
g18
V23354
p42172
stp42173
a((dp42174
g2
(lp42175
VThe best way is simply to do your IO work on another thread, perhaps via , or the async methods of
p42176
aVSee perhaps here
p42177
aVBe sure to use  when talking back to the UI controls (thread affinity); full example:
p42178
as(dp42179
g18
V23354
p42180
stp42181
a((dp42182
g2
(lp42183
VI would guess that since  doesn't inherit from , when you call the property  you get a disconnected object
p42184
aVPerhaps add an indexer to the object instead:
p42185
aVActually, I would mainly say ditch remoting and use WCF/SOA
p42186
aVAnd there is little purpose in  being
p42187
aVYou might also want to put some thought into thread-safety
p42188
aVTo clarify; the  instances will also be standalone, so local updates won't affect the server; basically, you have two scenarios:
p42189
aVif the type is , then it only lives at the server; all client operations are remoted to the actual object - but only for  types
p42190
aVotherwise, the object is serialized and an actual object is reconstructed
p42191
aVIf you an indexer with (for example)
p42192
aVthen this is:
p42193
aV(if  was , this would update the server, but don't do that)
p42194
aVBut if we push the value back:
p42195
aVthen we have updated the server
p42196
aVAs you've discovered, an operation-centric design may be far simpler (i
p42197
ag50
ag38293
aVBut I really think remoting is a bad idea here
p42198
as(dp42199
g18
V23354
p42200
stp42201
a((dp42202
g2
(lp42203
Vcsproj isn't the place for this; an app
p42204
aVconfig or a settings file - fine
p42205
aVBut not the csproj
p42206
aVEnd users should never see this
p42207
aVThe standard web-reference tools (, , ) all support configuration-based locations, for example (from ):
p42208
aV/appsettingurlkey:
p42209
aVThe configuration key to use in the code generation to read the default
p42210
aVvalue for the Url property
p42211
aVThe default is to not read from the config
p42212
aVfile
p42213
aVShort form is '/urlkey:'
p42214
aVIf you mean other developers
p42215
aVit can get messy - especially if the devs have separate client/server setups
p42216
aVOne trick I've used successfully is to standardise on the IIS mapping, and for all the developers add a "hosts" entry (perhaps "localserver") to their own server (commonly a VM)
p42217
as(dp42218
g18
V23354
p42219
stp42220
a((dp42221
g2
(lp42222
V(apologies for the C# terminology/examples
p42223
aVNo
p42224
aVYou can restrict :
p42225
aVto the current assembly ()
p42226
aVto named other assemblies ()
p42227
aVto subclasses ()
p42228
aV(and some combinations, such as )
p42229
aVThat's about it
p42230
aVNothing based on the caller's namespace
p42231
aVAfter all - I can just do this:
p42232
aVand I've broken it
p42233
as(dp42234
g18
V23354
p42235
stp42236
a((dp42237
g2
(lp42238
VYou can do this in LINQ-to-SQL by creating a UDF mapped to the data-context; this involves writing TSQL, and use ctx
p42239
aVSomeFunctionblah(
p42240
aVThe alternative is to work with expression trees - for example, it could be:
p42241
aVand use  - is that close enough
p42242
aVYou can't use the query syntax in this case, but it gets the job done
p42243
aVAdded dodgy  method to show how you might use it in query syntax
p42244
aVI don't suggest this is fantastic, but you might find it handy
p42245
as(dp42246
g18
V23354
p42247
stp42248
a((dp42249
g2
(lp42250
VFor regular apps,  will return this
p42251
aVIf this is web, then  is what you want (for example, )
p42252
aVRe comments; try ;  in the absense of  (comments), then try
p42253
as(dp42254
g18
V23354
p42255
stp42256
a((dp42257
g2
(lp42258
VImpossible to say without more code, but those look like static methods, i
p42259
ag50
aVcreate a new class (cs) file, and add something like:
p42260
aVIf  is actually an instance, take away the word
p42261
aVNote that to be callable, you also need to know about namespaces
p42262
aVThe above is in the default namespace, but that is a bit vulgar
p42263
aVIt should really be more like:
p42264
aVThen only code with  will see your class (this is a good thing for retaining sanity; there are lots of classes in the
p42265
aVNET framework)
p42266
as(dp42267
g18
V23354
p42268
stp42269
a((dp42270
g2
(lp42271
VI suspect that anything at this level would be done with the debugging hooks outside of managed code
p42272
aVBy design, it isn't really geared up to let you do that
p42273
aVOf course, you could just use any existing debugger, etc (even just windbg/sos)
p42274
aVFor you own threads - simply store away a reference when you create them
p42275
aVBut of course, don't do this as a mechanism to abort them etc - there are much better (i
p42276
ag50
aVworkable) ways of doing that with things like , , etc
p42277
aVOf course, if you don't mind stepping outside of managed code I'm sure there are options
p42278
as(dp42279
g18
V23354
p42280
stp42281
a((dp42282
g2
(lp42283
VYou should catch the exception at the method you use at the top of the thread, and do the logging from there
p42284
aVAn unhandled exception (at the top of a thread) will (in 2
p42285
aV0 onwards) kill your process
p42286
aVNot good
p42287
ag412
ag50
aVwhatever method you pass to  (etc) should have a /, and do something useful in the  (logging, perhaps graceful shutdown, etc)
p42288
aVTo achieve this, you could use:
p42289
aVstatic logging methods
p42290
aVcaptured variables into the delegate (as an anonymous method)
p42291
aVexpose your method on an instance that already knows about the logger
p42292
as(dp42293
g18
V23354
p42294
stp42295
a((dp42296
g2
(lp42297
VIf you don't need to include form-data, then you can just send as the body of a post:
p42298
aVor if you need to use a different http-method (perhaps "PUT"):
p42299
as(dp42300
g18
V23354
p42301
stp42302
a((dp42303
g2
(lp42304
VRe the enum; the point about  is that it is up to the caller's build whether to actually perform the invoke - the declaring/implementing code is always included; so assume that your code is a standalone library; you must include the enum, otherwise the caller (assume the caller is separate) cannot possibly ever call the method
p42305
aVIt sounds like  is a better fit for your problem - or you could use conditional inclusion in the build (csproj supports this, although it risks causing confusion;  would be more obvious)
p42306
aVNote that to perform overload resolution it must first identify the types, so you can't really mix  with  since the enum is in the signature
p42307
as(dp42308
g18
V23354
p42309
stp42310
a((dp42311
g2
(lp42312
VYou can create a new template with File -> Export Template
p42313
aV-> Item Template, but to be honest I never bother - there is a "Remove Unused Usings" option for cleaning down, and Ctrl+
p42314
aVfor adding them
p42315
as(dp42316
g18
V23354
p42317
stp42318
a((dp42319
g2
(lp42320
VYou can iterate over the available fields and use , though
p42321
aVOr you could use protobuf-net ;-p
p42322
as(dp42323
g18
V23354
p42324
stp42325
a((dp42326
g2
(lp42327
VIt depends; does the base-class need to know about it in the ctor
p42328
aVIf so, the  approach may be a bad idea ( doesn't work very well inside the ctor)
p42329
aVOtherwise, either is OK
p42330
as(dp42331
g18
V23354
p42332
stp42333
a((dp42334
g2
(lp42335
VWith anything that is , it is your job to ensure it gets cleaned up promptly, to close open resources etc (connections, etc)
p42336
aVSo in short, yes
p42337
aVFinalizers only happen when GC kicks in, which can be a long time - and doesn't allow for the best pooling use etc
p42338
aVNote however that WCF has a history of dodgy  implementations, making just  a bit hit-n-miss (you can lose the actual exception)
p42339
aVOf course, it is also recommended to use WCF via async methods, which again makes it hard to use ; you'll often need to keep a reference and call  explicitely in the IO callback
p42340
aVRe your comments; a few examples:
p42341
aV: if you leave this hanging around (open) you prevent it reusing the connection from a pool; you can ultimately saturate the available connections this way, breaking your app
p42342
aVGDI: IIRC, VS2005 itself (or 2003
p42343
aVhad a bug where an undisposed GDI object; GDI objects don't take much memory, so it didn't trigger GC, but it ran out of available handles and broke (this is a common bug in user code too, but more famous in an IDE)
p42344
aVfail to dispose something like a : you've blocked your file system
p42345
aVfail to dispose a  and you've caused db (etc) blocking
p42346
as(dp42347
g18
V23354
p42348
stp42349
a((dp42350
g2
(lp42351
VI don't love the , but perhaps something like below; note that the  test assumes no more  after the end of the data, but you could replace this with a test for blank strings etc
p42352
aVEdit; to simply remove blanks:
p42353
as(dp42354
g18
V23354
p42355
stp42356
a((dp42357
g2
(lp42358
VIt doesn't have any value until you give it one (or rather, it has the value )
p42359
aVIf you assign it a  reference, then yes: it is a , exposed via the  interface
p42360
aVYou can only give it  or things that implement
p42361
as(dp42362
g18
V23354
p42363
stp42364
a((dp42365
g2
(lp42366
VI can't advocate datasets, especially in an SOA environment like WCF - it'll work, but for mostly the wrong reasons
p42367
aVThey simply aren't portable, and IMO don't really "work" over service boundaries
p42368
aVOf course,  IMO they don't work in most other scenarios too ;-p
p42369
aVSo then it comes down to how much plumbing you want to do
p42370
aVMost ORMs will create WCF-serializable types for you; personally I'd use LINQ-to-SQL at the moment; it is both simpler and more complete than EF, although EF 4
p42371
aV0 is meant to be much better than EF in 3
p42372
aV5sp1
p42373
aVYou can use custom TSQL (via , which still does the mapping back to objects), but I tend to use either SPROC (for complex queries) or LINQ-generated queries (for simple requests)
p42374
aVWriting the types yourself is fine too, and will work with NHibernate etc
p42375
aVSo many options
p42376
as(dp42377
g18
V23354
p42378
stp42379
a((dp42380
g2
(lp42381
VTwo choices:
p42382
aVor use  and re-select:
p42383
as(dp42384
g18
V23354
p42385
stp42386
a((dp42387
g2
(lp42388
VYou're going to have to create your own utility class for that; you can'd add static methods via extension methods
p42389
as(dp42390
g18
V23354
p42391
stp42392
a((dp42393
g2
(lp42394
s(dp42395
g18
V23354
p42396
stp42397
a((dp42398
g2
(lp42399
V (in winforms) is tied to the win32 control
p42400
aVIf you want more flexibility, I would switch to ; this still lets you display tabular data, but you can change the styling at various levels of granularity
p42401
as(dp42402
g18
V23354
p42403
stp42404
a((dp42405
g2
(lp42406
VIt sounds to me that you could just use  from the resource manager
p42407
aVThe GC will do the rest
p42408
aVYou'll need to do a little casting, but it will be simple, and will work
p42409
as(dp42410
g18
V23354
p42411
stp42412
a((dp42413
g2
(lp42414
VUnlike , I don't think (from memory) that there is a ctor for passing in this extra metadata at runtime
p42415
aVPerhaps another viable option is to have a twin DTO class that is attributed, and shuffle the data into there
p42416
aVYou can add a conversion method / operator (between the two) in the partial class
p42417
aVNot ideal maybe, but it'll work
p42418
as(dp42419
g18
V23354
p42420
stp42421
a((dp42422
g2
(lp42423
VI suspect it might be confusing that you are uploading it as form-encoded
p42424
aVbut that isn't what you are sending (unless you're glossing over something)
p42425
aVIs that MIME type really correct
p42426
aVHow big is the data
p42427
aVDo you need chunked upload
p42428
aVSome servers might not like this in a single request; I'd be tempted to use multiple simple requests via
p42429
as(dp42430
g18
V23354
p42431
stp42432
a((dp42433
g2
(lp42434
VPersonally I'd change the web-service to do this filtering and sorting at the server to reduce bandwidth needs, probably returning a simple data-type or custom class (not  or anything similar)
p42435
aVBut LINQ would do the job
p42436
aV(updated after re-reading the question)
p42437
aVusing custom  method:
p42438
as(dp42439
g18
V23354
p42440
stp42441
a((dp42442
g2
(lp42443
VOne simple option is to disable  (set to ) and over-size it so there is spare space
p42444
aVAlternatively, perhaps use  instead of just , although this has a different meaning, so you may need to put it in a  or similar)
p42445
aVUltimately this works like the first - by over-sizing it in the first place; so perhaps the first option is simpler
p42446
as(dp42447
g18
V23354
p42448
stp42449
a((dp42450
g2
(lp42451
VUltimately, yes; but it isn't simple and you'll need to either:
p42452
aVlearn the Expression API
p42453
aVuse the pre-rolled dynamic LINQ library (from the samples download)
p42454
aVIf you want to go the first option, then you need to create your own lambdas; imagine, for example, that you have something like (making things up here
p42455
ag6864
aVThen you would need to do something like:
p42456
aVThe above (for each "Add" element) creates a lambda that filters the given member to the supplied value (assumes string, but you could of course do any conversions etc)
p42457
aVAll the other operations are availble, but this shows the minimal effect
p42458
aVNote that  becomes restricted through the loop
p42459
as(dp42460
g18
V23354
p42461
stp42462
a((dp42463
g2
(lp42464
VI suspect that the data you are enumerating is not typed - for example, a lot of things that were written in 1
p42465
aV1 only implement , and don't have a custom iterator (you don't actually need  to do typed iteration - and indeed you don't even need  to use ; a lot of 1
p42466
aV1 typed wrote special enumerator types to avoid boxing/casting etc - lots of work)
p42467
aVIn many cases it would be a breaking change to fix them
p42468
aVA trivial example here is :
p42469
aVbut actually, 's enumerator is just , so  is  - and hence you'll always get  when you use :
p42470
aVContrast this to the (equally 1
p42471
aV1) ; this has a custom enumerator (); so if you used  with , you'd get  (not )
p42472
aVIn anything 2
p42473
aV0 and above, it would be reasonable to expect better typing, for two reasons:
p42474
aVgenerics (for the simple cases), making it possible to write strongly-typed collections sensibly
p42475
aViterator blocks (for the non-trivial cases), making it possible to write custom iterators without going insane
p42476
aVBut even then there are still cases when you don't get the type you expect; you can either (and perhaps more clearly) specify the type manually, or use  /
p42477
as(dp42478
g18
V23354
p42479
stp42480
a((dp42481
g2
(lp42482
VHow complex is the data
p42483
aVI'm not overly familiar with , but I wonder if you might have more joy using  directly
p42484
aVEspecially for like data in a loop, it can be used pretty easily
p42485
aVI would, however, have concerns over xml as the choice for this data
p42486
aVIs this s requirement
p42487
aVOr simply a convenient available format
p42488
aVIn particular, it can be hard to parse that size of xml conveniently, as you'd have to use  (which is harder to get right than )
p42489
aVIf you can use other formats, I'd advise it
p42490
aVa few leap to mind, but I won't babble on unless you mention that you'd be interested
p42491
as(dp42492
g18
V23354
p42493
stp42494
a((dp42495
g2
(lp42496
V is an object that supports different (named/custom) formats - for example, numbers, etc
p42497
aVBy using an interface, multiple blocks of code can use the value and a format string, and this is common (for example) in data-binding and
p42498
aVAn  fills in some gaps dealing with formatting - particularly i18n
p42499
aVMost commonly, a  is used as the provider, either giving a specific local format, or the invariant culture
p42500
aVAs far as I know,  is unrelated, and ties more into serialization ()
p42501
aVI could be wrong
p42502
aVAn example of an  object:
p42503
as(dp42504
g18
V23354
p42505
stp42506
a((dp42507
g2
(lp42508
VYou can validate your xml against the xsd by specifying it on the , and simply iterating through the  with , handling the validation events (on )
p42509
aVFor an example, see MSDN
p42510
aVNote that this will report all schema errors, so if you have other problems you'll need to filter it out
p42511
as(dp42512
g18
V23354
p42513
stp42514
a((dp42515
g2
(lp42516
V is, by default, going to be comparing object references (unless  implements a custom equality method)
p42517
aVSo unless you still have a reference to the second item around, you are going to have to get it either by reference, or by finding the desired item:
p42518
aVIndex may be easier
p42519
as(dp42520
g18
V23354
p42521
stp42522
a((dp42523
g2
(lp42524
VDo you have an object hierarchy that you can map the the JSON
p42525
aVYou could create an object tree (i
p42526
ag50
aVdeserialize the JSON), and use LINQ's , , etc
p42527
as(dp42528
g18
V23354
p42529
stp42530
a((dp42531
g2
(lp42532
VVisualSVN server offers an easy way into SVN, and is free
p42533
aVMix that with TortoiseSVN client and you're sorted
p42534
aVInterestingly, TFS2010 may be interesting to single-devs/small-teams, but we'll see how it unfolds
p42535
as(dp42536
g18
V23354
p42537
stp42538
a((dp42539
g2
(lp42540
VTwo different reasons;
p42541
aVinterning - since the  string(s) are compiled into the source, they are the same reference - check  - it will return
p42542
aVcustom equality - string has equality operators (in particular,  /  (aka  / )
p42543
aVThe  version fails because:
p42544
aVthey aren't the same reference (these are regular managed objects created separately on the managed heap)
p42545
aVdoesn't have the operators
p42546
aVCall  on each, and it gets more interesting:
p42547
aVthe two strings aren't the same reference
p42548
aVbut the operator support guarantees a
p42549
as(dp42550
g18
V23354
p42551
stp42552
a((dp42553
g2
(lp42554
VAre you closing down the entire
p42555
aVor just the
p42556
aVI'm wondering if this is some caching in the
p42557
aVYou could try using a new binding-context per
p42558
aVAlso; as always, double check events etc - in particular any using captured variables, as that is a subtle way of adding a dependency (note the capture scopes mean you might be capturing more than you think if you have complex anonymous methods / lambdas)
p42559
aVYou might need to drop into profilers or windbg to find the remaining reference
p42560
as(dp42561
g18
V23354
p42562
stp42563
a((dp42564
g2
(lp42565
VWhy would you put "
p42566
aVstuff
p42567
aVbetween the property and the field
p42568
aVI'm a firm believer in keeping tightly-coupled things as close as possible:
p42569
aVI would also not introduce an extra field unless I had to:
p42570
aVbecause I need logic the in accessors
p42571
aVfor () serialization reasons
p42572
aVIn the example given, I'd just use an auto prop:
p42573
aVObviously, some kind of auto-prop syntax that allowed a default would be nice here, but I don't need it, so I don't expect it any time soon
p42574
aVIt doesn't solve a big enough problem to be worth much effort
p42575
as(dp42576
g18
V23354
p42577
stp42578
a((dp42579
g2
(lp42580
VSee "Async without the pain" for some thoughts on this; the code supplied uses a callback approach, but events would be easy enough if you drop it on an instance
p42581
as(dp42582
g18
V23354
p42583
stp42584
a((dp42585
g2
(lp42586
VNot counting bugs, the most common example is varargs; but much of COM interop is extensions; for example interface constructors
p42587
aV17
p42588
aV5 in the spec basically says "anything in  can do what it wants"
p42589
aVMSDN documents this here
p42590
as(dp42591
g18
V23354
p42592
stp42593
a((dp42594
g2
(lp42595
VIs that path always a file path
p42596
aVOr can it be a URL
p42597
aVIt should be pretty simple to set up a temp localhost web-server using  (or similar), that streams back the file in response to an http request
p42598
aVAnother possibility would be named pipes; I wonder if you can convince the control to open a named pipe as though it were a file
p42599
aV(they have a logical file path, after all)
p42600
aVI've barely touched these, though - so I can't say 100% whether it would work
p42601
as(dp42602
g18
V23354
p42603
stp42604
a((dp42605
g2
(lp42606
VI'm wondering if something like:
p42607
aV(completely untested; you could also try  and )
p42608
as(dp42609
g18
V23354
p42610
stp42611
a((dp42612
g2
(lp42613
VAre the entities in question already cached in the context
p42614
aV(i
p42615
ag50
aVhave you queried them already
p42616
aVIf so, the identity manager will always give you back the original object (rather than creating a new object with the same identity in the same context)
p42617
aVHence for data that has already been read (by other queries) only the identity/primary-key field(s) are considered
p42618
as(dp42619
g18
V23354
p42620
stp42621
a((dp42622
g2
(lp42623
VThe question isn't clear, but as I interpret it, perhaps something like:
p42624
aVIf you need the row data, then select that into a variable and do a separate
p42625
as(dp42626
g18
V23354
p42627
stp42628
a((dp42629
g2
(lp42630
V1: broadly yes, but it depends on your IIS configuration and network topology
p42631
aVTypically, most of the internet won't be able to address your IIS unless you have configured the firewall etc
p42632
aVAnd DNS would be more typical for public servers
p42633
aVIn complex scenarios you may have host-headers, multiple NICs/IPs, or other complications meaning that the IP (by itself) does little
p42634
aV2: Entirely up to you; it depends largely on the project
p42635
aVIf you are only serving your own projects, you can probably ignore the WSDL and rely on VS to do the right thing
p42636
aVIf interop/portability is a major concern (to other frameworks/languages), then perhaps write the WSDL first
p42637
as(dp42638
g18
V23354
p42639
stp42640
a((dp42641
g2
(lp42642
VNote that if you introduce data you may want to use , and you probably want to use / object-name escaping
p42643
as(dp42644
g18
V23354
p42645
stp42646
a((dp42647
g2
(lp42648
VThe only way to do that is to use  - i
p42649
ag50
aV(in C#):
p42650
aVRegular integers have no concept of /
p42651
as(dp42652
g18
V23354
p42653
stp42654
a((dp42655
g2
(lp42656
VThe obvious scenario would be where a new () / null () transaction is explicitly specified - but there is also a timeout/unbinding glitch that can cause connections to miss the transaction
p42657
aVSee this earlier post (the fix is just a connection-string change), or full details
p42658
as(dp42659
g18
V23354
p42660
stp42661
a((dp42662
g2
(lp42663
V(I'm assuming it knows that the id is the primary key etc)
p42664
aVWhich exact version
p42665
aVThat looks like LINQ-to-SQL; in 3
p42666
aV5 (no service packs), yes - the identity manager was a bit rubbish at this
p42667
aVIt got better in 3
p42668
aV5 SP1, and is supposedly fixed in 4
p42669
ag190
aVIn
p42670
aVNET 3
p42671
aV5 SP1, the  approach works IIRC, so perhaps use that and catch block
p42672
aVA / will be faster than a network hop
p42673
aVFrom the later connect post:
p42674
aVThis bug has now been fixed and will
p42675
aVbe included in
p42676
aVNET Framework 4
p42677
ag190
aVThe
p42678
aVoptimization to search the cache first
p42679
aVfor ID-based lookups will now be done
p42680
aVfor
p42681
aVSingle/SingleOrDefault/First/FirstOrDefault(predicate)
p42682
aVas well as
p42683
aVWhere(predicate)
p42684
aVSingle/SingleOrDefault/First/FirstOrDefault(),
p42685
aVwhere predicate has the same
p42686
aVrestrictions as before
p42687
as(dp42688
g18
V23354
p42689
stp42690
a((dp42691
g2
(lp42692
V"back in the day", I've used ASPUpload
p42693
aVIt was cheaper to buy than to spend time fighting with form data
p42694
aVA bit like ASP
p42695
aVNET, it makes both the regular fields and uploaded files available for query, but it does (IIRC) break the old Form object - i
p42696
ag50
aVonce you've read from ASPUpload, the input stream will be consumed, and attempting to use regular form inputs will fail
p42697
aVYou can use both approaches in the same app - just not both during the same page request; pick one or the other, basically (usually based on the incoming MIME)
p42698
as(dp42699
g18
V23354
p42700
stp42701
a((dp42702
g2
(lp42703
V(note this uses , which is the same signature as )
p42704
as(dp42705
g18
V23354
p42706
stp42707
a((dp42708
g2
(lp42709
VThe problem is that  (per the spec) only works with primitives (int etc) and strings
p42710
aVBut yes, it would be nice to have F#-style matching
p42711
aVFrom 8
p42712
ag8441
aV2:
p42713
aVThe governing type of a switch statement is established by the switch expression
p42714
aVIf the type of the switch expression is sbyte, byte, short, ushort, int, uint, long,
p42715
aVulong, char, string, or an enum-type, then that is the governing type of the switch
p42716
aVstatement
p42717
aVOtherwise, exactly one user-defined implicit conversion (6
p42718
aV4) must exist from
p42719
aVthe type of the switch expression to one of the following possible governing types:
p42720
aVsbyte, byte, short, ushort, int, uint, long, ulong, char, string
p42721
aVIf no such implicit
p42722
aVconversion exists, or if more than one such implicit conversion exists, a compile-time
p42723
aVerror occurs
p42724
aVIt is obvious, however, that working with such a restricted set allows for simple (and efficient) IL
p42725
aVNote that  is handled via a dictionary map to an integer
p42726
as(dp42727
g18
V23354
p42728
stp42729
a((dp42730
g2
(lp42731
VThat might work better as 2 questions
p42732
aVRe  - that will obviously die in a tight loop, so an existing  would be more random ;-p But you perhaps want a cryptographic random - something like:
p42733
aVNote that this makes testing harder though, as it can't be seeded etc
p42734
as(dp42735
g18
V23354
p42736
stp42737
a((dp42738
g2
(lp42739
VDoes the default view for that table have a  set
p42740
aVTry comparing to
p42741
as(dp42742
g18
V23354
p42743
stp42744
a((dp42745
g2
(lp42746
VTo create a node reader:
p42747
as(dp42748
g18
V23354
p42749
stp42750
a((dp42751
g2
(lp42752
VCan you just cast
p42753
aVNote that if this is 2
p42754
aV0 or above, a generic  would be far simpler
p42755
aVand in 1
p42756
aV1  would do the job (although IIRC you need to watch for case-insensitivity in the key)
p42757
as(dp42758
g18
V23354
p42759
stp42760
a((dp42761
g2
(lp42762
VCould you not post to a regular ASP
p42763
aVNET page (perhaps an ashx/handler, or MVC) and just use
p42764
aVThis supports multi-part
p42765
as(dp42766
g18
V23354
p42767
stp42768
a((dp42769
g2
(lp42770
VThat is perfectly well defined; the explicit interface implementations take priority when using the interface, and the regular property takes effect otherwise (including from within the body of the get/set)
p42771
aVAs for making it tidier
p42772
aVthe best I can offer is to reformat it to make it less verbose
p42773
aV(note also that the  is implicit and redundant)
p42774
aVAs an aside - the safety is only a convenience, not a guarantee
p42775
aVexternal callers can still use your interface, and can usually (ab)use reflection to jump past mere things like  - or even just set the fields directly
p42776
as(dp42777
g18
V23354
p42778
stp42779
a((dp42780
g2
(lp42781
VA  approach using lazy match and back-reference:
p42782
as(dp42783
g18
V23354
p42784
stp42785
a((dp42786
g2
(lp42787
VI'm guessing  is ; you need an  to use ; fortunately, your first  returns this, so just catch that:
p42788
as(dp42789
g18
V23354
p42790
stp42791
a((dp42792
g2
(lp42793
VI find that odd not so much because of the name, but because the lambda is unnecessary; it could use an anonymous-type and be more flexible:
p42794
aVThis is a pattern used in much of ASP
p42795
aVNET MVC (for example), and has other uses (a caveat, note also Ayende's thoughts if the name is a magic value rather than caller-specific)
p42796
as(dp42797
g18
V23354
p42798
stp42799
a((dp42800
g2
(lp42801
VDo you need to use a different proxy
p42802
aVOr the system's proxy
p42803
aVNote that  will probably work differently since this is activex, but IIRC  will use the  winhttp proxy by default
p42804
aVSo all you need to do is configure winhttp
p42805
aVHow to do this varies per OS; typically it is easiest to simply import the wininet settings from IE:
p42806
aVVista/Win7:
p42807
aVXP (from memory, please double-check):
p42808
aVYou can also set the proxy per-application (rather than system-wide) via the config file; see MSDN
p42809
as(dp42810
g18
V23354
p42811
stp42812
a((dp42813
g2
(lp42814
V is more a  or  thing
p42815
aVI wouldn't expect to see this from
p42816
aVAre you sure it is in the code posted
p42817
aVThe line:
p42818
aVRuns without any error
p42819
aVI'm wondering if you are calling something like:
p42820
aVand it happens that  is empty
p42821
as(dp42822
g18
V23354
p42823
stp42824
a((dp42825
g2
(lp42826
V1: as long as you don't change the current directory, yes
p42827
aVThere are more thorough ways to get the app directory, though
p42828
aV2: any number ways to parse such a string; , , etc; purely as an illustration, I'll (ab)use :
p42829
aVedit  may not exist in windows-mobile; perhaps just  on  or use ; it comes down to the exact format
p42830
as(dp42831
g18
V23354
p42832
stp42833
a((dp42834
g2
(lp42835
V(inferring from xml-serialization tag) You want  for
p42836
aVis for  etc, and only applies to fields, not properties (which is probably why you are getting  failures)
p42837
as(dp42838
g18
V23354
p42839
stp42840
a((dp42841
g2
(lp42842
VI would guess that it is a namespace issue (i
p42843
ag50
aVxml namespaces)
p42844
aVCan you show example xml and the  class
p42845
aVFor info, you can read from an  "as is", via:
p42846
aVMuch simpler than messing with encoding and streams
p42847
aVWith your sample xml/code, you can fix this by adding:
p42848
aVto the class
p42849
aVIf the class advertises itself as a  you can even do this in a separate code file, so you don't need to edit the generated code
p42850
aVThis would be (in the correct namespace):
p42851
as(dp42852
g18
V23354
p42853
stp42854
a((dp42855
g2
(lp42856
Vprotobuf-net uses a strategy pattern; as needed (once only per type) it uses reflection to look at the types, and builds a set of serializers (based on a common interface) that it can use to serialize and deserialize - so when in use it is just stepping through the known set of serializers
p42857
aVInside that, it tries to make sensible use of reflection when talking to members; it uses  to talk to properties, and  (and custom IL) to talk to fields (when possible; it depends on the target framework)
p42858
aVThis means that it is always talking to known delegate types, rather than just  (which is very slow)
p42859
aVWithout going mad, the code does have some optimisations (arguably at the expense of readability) in terms of:
p42860
aVlocal  buffering (of the input/output streams)
p42861
aVusing fixed-size arrays (rather than lists etc); perhaps too much
p42862
aVusing generics to avoid boxing
p42863
aVnumerous tweaks/twiddles/etc around the binary processing loops
p42864
aVIn hindsight, I think I made a mistake on the generics point; the complexity meant that forcing generics into the system bent it out of shape in a few places, and actively causes some major problems (for complex models) on compact framework
p42865
aVI have some designs (in my head only) to refactor this using non-generic interfaces, and to instead (for suitable frameworks) make more use of  (my first choice would have been , but that forces a higher framework version)
p42866
aVThe problem, however, is that this is going to take a considerable amount of time to get working, and until very recently I've been pretty swamped
p42867
aVRecently I've managed to start spending some time on protobuf-net again, so hopefully I'll clear my backlog of requests etc and get started on that soon
p42868
aVIt is also my intention to get it working with models other than reflection (i
p42869
ag50
aVdescribing the wire mapping separately)
p42870
aVand doesn't produce any generated code
p42871
aVI should also clarify that there are two (optional) codegen routes if you want to use generated code; protogen
p42872
aVexe, or the VS add-in, allow code generation from a
p42873
aVproto file
p42874
aVBut this is not needed - it is useful mainly if you have an existing
p42875
aVproto file, or intent to interoperate with another language (C++ etc) for contract-first development
p42876
as(dp42877
g18
V23354
p42878
stp42879
a((dp42880
g2
(lp42881
VTwo options; , or just
p42882
aVMeaning:
p42883
aVor
p42884
aVor (C# 2
p42885
aV0)
p42886
aVNote that all do exactly the same thing in terms of creating arrays etc
p42887
aVThe final option is to create a more-specific overload:
p42888
as(dp42889
g18
V23354
p42890
stp42891
a((dp42892
g2
(lp42893
VI would love to help (I'm the author of protobuf-net), but that isn't a huge amount to go on
p42894
aVCan you provide any kind of example for this
p42895
aVAt the simplest level, I'm wondering if the service is fully configured - in particular if you are using "mex" or add-service-reference
p42896
as(dp42897
g18
V23354
p42898
stp42899
a((dp42900
g2
(lp42901
VThe most common use is with generics; while it works for "regular" types (i
p42902
ag50
aVetc), this is quite uncommon in hand-written code
p42903
aVI do, however, use this approach when doing code-generation, as it means I don't need to hard-code all the different defaults - I can just figure out the type and use  in the generated code
p42904
aVIn generics, the classic usage is the  pattern:
p42905
aVHere we have to assign a value to exit the method, but the caller shouldn't really care what it is
p42906
aVYou can contrast this to the constructor constraint:
p42907
as(dp42908
g18
V23354
p42909
stp42910
a((dp42911
g2
(lp42912
VFor strings, you could perhaps look at interning; either with the inbuilt interner, or (preferably) a custom interner - basically a
p42913
aVWhat this means is that each identical string uses the same reference - and the duplicates can be collected
p42914
aVDon't do anything with the int; that is already optimal
p42915
aVFor example:
p42916
aVYou could take this further with  if desired
p42917
aVNote importantly that you don't need to change your design - you just change the code that populates the object to use the interner/cache
p42918
as(dp42919
g18
V23354
p42920
stp42921
a((dp42922
g2
(lp42923
VIs this as simple as getting the  parameters right
p42924
aV(you seem to be passing in file-path as the url, and not using the encoding):
p42925
as(dp42926
g18
V23354
p42927
stp42928
a((dp42929
g2
(lp42930
VThere are various things you can do here - you could (although it is a bad answer) expose the controls in question on the public interface - but I'm not sure that is a great idea
p42931
aVPersonally, I would just re-expose the properties I am interested in, perhaps putting them into a different  - making sure to have both setters and getters
p42932
aVA bit like:
p42933
as(dp42934
g18
V23354
p42935
stp42936
a((dp42937
g2
(lp42938
VSince it is a , inheritance isn't an issue (otherwise "A" makes  easier) - so I would go with "B", simply because I expect to call  more than I call
p42939
aVless indirection
p42940
aVFor a  with a genuine need for  and inheritance (unlikely), I would go "A"
p42941
as(dp42942
g18
V23354
p42943
stp42944
a((dp42945
g2
(lp42946
V(edit: only just saw that you are data-binding)
p42947
aVThe first thing to try is disabling data-binding; perhaps set the source to null and re-bind afterwards
p42948
aVhas ,  and  for this
p42949
aVIf the real problem is just lookup, you could take a snap of the , and use:
p42950
aVI seem to recall that this is the fastest route (the string overload locates the  from the list)
p42951
aVAlternatively - use a  model instead of  ;-p
p42952
as(dp42953
g18
V23354
p42954
stp42955
a((dp42956
g2
(lp42957
VGeneric types and generic methods are very different things
p42958
aVIt sounds like you have a generic type:
p42959
aVand are discussing having a generic method inside it:
p42960
aVThese are very different
p42961
aVIn the first, inside , then  means "the  that got passed to "
p42962
aVIn the second, inside , this is a separate and independent  - "the  that got passed to "
p42963
aVIn fact, calling it  (in this case) is a mistake
p42964
aVYou could have, for example:
p42965
aVNote that there is no easy way (within ) of saying "the  in " - hence why you should rename the method's generic type parameter
p42966
aVThere are valid scenarios for this type of scenario (generic methods on generic types), for example (and note the new name):
p42967
aVThis allows us to do some very interesting things in terms of inheritance, etc - or you might want a generic method that has little or no relation to
p42968
aVThat is fine too
p42969
as(dp42970
g18
V23354
p42971
stp42972
a((dp42973
g2
(lp42974
VTry declaring  specifically as  rather than  (which will pick up the  (it will still be ordered)
p42975
aVAlternatively, re-structure it so we order at the end, allowing us to (optionally) bring in the  in the middle:
p42976
aV(obviously, we look at )
p42977
aVThe reason it is erroring is that currently you have (essentially):
p42978
as(dp42979
g18
V23354
p42980
stp42981
a((dp42982
g2
(lp42983
VHmm
p42984
aVit looks more like an MSDN glitch
p42985
aVFrom what I can see  doesn't override, overload or re-declare () the  method
p42986
aVNot sure what MSDN is up to, to be honest
p42987
aVI wonder if this distinction only exists for documentation purposes, because there are no unmanaged resources for a  (and indeed the underlying buffer is still available)
p42988
aVCloses the current stream and releases any resources (such as sockets and file handles) associated with the current stream
p42989
aVvs
p42990
aVCloses the stream for reading and writing
p42991
aVit does override , though
p42992
as(dp42993
g18
V23354
p42994
stp42995
a((dp42996
g2
(lp42997
VThe "MiscUtil" answer (already accepted) would be my first choice ;-p
p42998
aVYou might also consider LINQ at the caller:
p42999
aVSince the caller knows the type (assuming it isn't itself generic, this should work
p43000
aVJust for completeness, another option here (in 4
p43001
aV0) is :
p43002
as(dp43003
g18
V23354
p43004
stp43005
a((dp43006
g2
(lp43007
VIf you want to ensure it is written promptly and in-order, then mark it as , or (with more pain) use  /  (not an attractive option, and easy to miss one, making it useless)
p43008
aVOtherwise you have virtually no guarantees of anything (as soon as you talk multiple threads)
p43009
aVYou might also want to look at locking () or , which would achieve the same effect as long as the same approach is used from all access (i
p43010
ag50
aVall , or all , etc)
p43011
as(dp43012
g18
V23354
p43013
stp43014
a((dp43015
g2
(lp43016
VIf you know the signatures (i
p43017
ag50
aVthe return type and parameters), then  can be used very effectively here:
p43018
aVNote that for properties, you want to look at  and
p43019
aVThis doesn't work so well if you don't know the signature, as  is very slow
p43020
aVTo get benefit from , you must cache and re-use the delegate instance; don't recreate it each time
p43021
aVFor properties, even if you don't know the property-type, then perhaps consider HyperDescriptor (you need to add the 1-line to enable hyper-descriptor):
p43022
as(dp43023
g18
V23354
p43024
stp43025
a((dp43026
g2
(lp43027
VYou can declare this on an interface:
p43028
aVand let implicit interface implementation work its magic
p43029
aVThen the question becomes: "how to let it know that my entities implement this interface
p43030
aVTwo options:
p43031
aVadd a partial class per entity (in a different file):
p43032
aVedit the dbml to specify this interface as the base class:
p43033
aV(this makes LINQ-to-SQL's code-generation add the  for you)
p43034
aVThen just use this interface in the generic clause:
p43035
as(dp43036
g18
V23354
p43037
stp43038
a((dp43039
g2
(lp43040
VWell  is right shift; in this case, it will (effectively) return halve the value of  (except for some cases involving -ve numbers)
p43041
aVI don't know what your  is, but I'm guessing we're building a matrix of half of a table or something
p43042
as(dp43043
g18
V23354
p43044
stp43045
a((dp43046
g2
(lp43047
VOn-the-fly codegen
p43048
aVYou mean at runtime
p43049
aVI use this for creating high performance access to code that would other wise use reflection
p43050
aVMuch of the time you can use things like , but there are times when  etc have their place
p43051
aVI use this in protobuf-net to access fields at runtime (by building a wrapper; note that properties use ), and in HyperDescriptor to create a faster  implementation
p43052
aVBut in both cases I use  directly - not CodeDom
p43053
aVIn fact, personally I really wouldn't bother to learn CodeDom unless I had to; for runtime work, I would look at  first
p43054
aVI have an article on InfoQ discussing this, or various things here on SO or on my blog that might be interesting
p43055
aVIf you mean regular codegen - i
p43056
ag50
aVat compile-time (or before), then this is used by any scenario that does modelling separately to implementation
p43057
aVLINQ-to-SQL (SqlMetal), EF, etc would be classic examples, but many other modellers have codegen
p43058
aVFor protobuf-net, I use xslt for the codegen (from
p43059
aVproto); I didn't want to use T4 as I wanted to support 2
p43060
aV0 / mono etc, and xslt allows the end-user to customise the codegen with notepad (if they so choose)
p43061
as(dp43062
g18
V23354
p43063
stp43064
a((dp43065
g2
(lp43066
VThe real problem here is the deferred execution
p43067
aVIn the case of argument-checking, you can do this by adding a second method:
p43068
aVExceptions happen; even for non-deferred result (, for example) you can get errors (perhaps if another thread adjusts the list while you are iterating)
p43069
aVThe above approach lets you do as much as possible ahead of time to reduce the unexpected side-effects of  and deferred execution
p43070
as(dp43071
g18
V23354
p43072
stp43073
a((dp43074
g2
(lp43075
V only walks one level;  walks the entire DOM for elements, and you can then (per-element) check the attributes:
p43076
as(dp43077
g18
V23354
p43078
stp43079
a((dp43080
g2
(lp43081
VYou cannot change a query like this - so you have two choices:
p43082
aVhave two separate queries in the SPROC (one for each branch) - OK for two, but doesn't scale very well to more complex combinations
p43083
aVuse dynamic SQL; i
p43084
ag50
aVbuild the query in a  and use  to invoke it; fairly obviously you can change a string to include an extra  etc
p43085
aVAll that said, though, I generally prefer a single SPROC to always return the same schema - it completely messes with most ORM tools if you change the columns based in the parameters
p43086
aVSomething to watch
p43087
as(dp43088
g18
V23354
p43089
stp43090
a((dp43091
g2
(lp43092
VLINQ-to-SQL does not AFAIK support the xml extensions in TSQL
p43093
aVTwo choices that I see:
p43094
aVwrite a SPROC/udf for your entire query that uses the sql/xml syntax, and map that to your data-context
p43095
aVwrite a UDF that does the test for a single row (returning a bool), map that to the data-context, and use  in the  clause of the LINQ
p43096
as(dp43097
g18
V23354
p43098
stp43099
a((dp43100
g2
(lp43101
VYou can't really change the performance of a nested loop without some additional knowledge, but that would be use-specific
p43102
aVIf you have got  items in  and  items in , it is always going to be O(n*m)
p43103
aVYou can change the look of it though:
p43104
aVThis is still O(n*m), but has nominal extra overhead of LINQ (you won't notice it in normal usage, though)
p43105
aVWhat are you doing in your case
p43106
aVThere may be tricks
p43107
aVOne thing to definitely avoid is anything that forces a cross-join to buffer - the  approach is fine and doesn't buffer - but if you add each item to a , then beware the memory implications
p43108
aVDitto  etc (if used inappropriately)
p43109
as(dp43110
g18
V23354
p43111
stp43112
a((dp43113
g2
(lp43114
VI would probably add a parameter to the template, and use with-param in the apply-templates to pass it down
p43115
aVAvoids all the ambiguity
p43116
aVand something like:
p43117
aVAnother option is to use  etc frmo the child - perhaps using a template-match on the  (from both places) to avoid duplication
p43118
as(dp43119
g18
V23354
p43120
stp43121
a((dp43122
g2
(lp43123
VFirstly, the choice of namespace alias should make no difference to a well-formed parser
p43124
aVBut; does it have to be
p43125
aVWith , you can use the overload of  that accepts a
p43126
aVThis allows you to pick and choose the namespaces and aliases that you use
p43127
aVUltimately;  is not intended to give full xml control; that isn't its aim
p43128
aVIf you want strict xml control,  is a better choice, even if it is older (and has some nuances/foibles of its own)
p43129
aVFull example:
p43130
aVOutput:
p43131
as(dp43132
g18
V23354
p43133
stp43134
a((dp43135
g2
(lp43136
VYou could copy the pattern used by , and write a wrapper that must be actively completed - if you don't call , then the  method (which gets called either way) assumes an exception and does your handling code:
p43137
aVPersonally, though, I'd stick with try/catch - it is clearer for maintainers in the future - and it provides access to the
p43138
as(dp43139
g18
V23354
p43140
stp43141
a((dp43142
g2
(lp43143
VI wonder if  would work:
p43144
aVHe're I'm assuming that you've referenced your preferred version and can use the type  to get the ; you could also use:
p43145
aVI haven't tried it, but here I'm essentially saying "deploy one version of the dll, and when the system asks for the old one - lie"
p43146
as(dp43147
g18
V23354
p43148
stp43149
a((dp43150
g2
(lp43151
VThe simplest trick here is at the VS command line:
p43152
aVEt voila; one example
p43153
aVcs file with example C# that shows how to get that xml from
p43154
aVNET objects via
p43155
aVIn this case, I expect the following would work:
p43156
aVupdate: validated it; yup, it works
p43157
as(dp43158
g18
V23354
p43159
stp43160
a((dp43161
g2
(lp43162
VI wouldn't say I have a strong view against either - but IMO the biggest issue is that  and  get messy if you have it nested, with the side effect that you can't copy/paste blocks around safely (quite)
p43163
aVYou can too-easily end up with the wrong code commented/enabled, or can end up with it not compiling because you've ended up with a
p43164
aVIf you copy a block of  around, no harm - just those lines remain commented
p43165
as(dp43166
g18
V23354
p43167
stp43168
a((dp43169
g2
(lp43170
VIf you are already using TCP bindings for your WCF, then I would imagine that you can use protobuf-net; quite simply, I haven't tried this combination, but since the transport and serializer are separate I can't think of a reason why not
p43171
aVI will have to try it, perhaps using the new endpoint stuff
p43172
aVI have a test rig, so I'll try reconfiguring the transport - see if it works
p43173
aVIt is largely a case of applying the info here
p43174
as(dp43175
g18
V23354
p43176
stp43177
a((dp43178
g2
(lp43179
V is really a map sorted by key, not a list
p43180
aVBad naming, maybe
p43181
aVBut there are ways to emulate what you want, depending on your exact requirements
p43182
aVYou could, for example, encapsulate a  and have add/remove something like:
p43183
aVUltimately you could use a simple list () too - it depends what you are doing
p43184
aVIn part, I expect that data-binding etc makes it hard to implement a regular list that sorts immediately - you need to implement a lot of interfaces to get that working, as normally it expects the item you add to stay at the end
p43185
as(dp43186
g18
V23354
p43187
stp43188
a((dp43189
g2
(lp43190
VNo, this is myth
p43191
aVLambdas create regular delegates (in this usage, at least)
p43192
aVThe confusion is often simply that if the publishing object is going to be finished with before or at around the same time as the subscriber, then there is no need to unsubscribe
p43193
aVThe event delegate only keeps the subscriber aliver, not the publisher
p43194
aVIn the example given, therefore, it depends on whether your publisher:  (presumably a person or similar) is going to be used after the form/page/whatever has finished
p43195
as(dp43196
g18
V23354
p43197
stp43198
a((dp43199
g2
(lp43200
VMost things "click and play" should be simple enough just to stick some pre-defined building-block objects together (probably using interfaces on the boundaries)
p43201
aVMeaning: you might not need to do dynamic code generation - just "fake it"
p43202
aVFor example, using property-bag objects (like  etc, although that isn't my first choice) for values, etc
p43203
aVAnother option for dynamic evaluation is the  class; especially in
p43204
aVNET 4
p43205
aV0, this is hugely versatile, and allows compilation to a delegate
p43206
as(dp43207
g18
V23354
p43208
stp43209
a((dp43210
g2
(lp43211
VOK; I'm hoping this is coincidence, but: SelectMany; combining IDisposable and LINQ, which (with the custom  implementation) would allow:
p43212
aV(note that I'm assuming there is a sensible reason to do this per )
p43213
aVor with the  extension method (instead of ):
p43214
as(dp43215
g18
V23354
p43216
stp43217
a((dp43218
g2
(lp43219
VNET arrays are immutable in size once created
p43220
aVYou can't trim it; you must reallocate and copy
p43221
aVSo  already does everything you need
p43222
aVPerhaps just ignore the elements at the end if you really don't want to do this
p43223
aVOr; use a , which encapsulates an array, and does have
p43224
aVIn C# terms:
p43225
as(dp43226
g18
V23354
p43227
stp43228
a((dp43229
g2
(lp43230
VUnfortunately, no
p43231
aVhas some things that are
p43232
aVirritating
p43233
aVThis is one of them
p43234
aVOptions:
p43235
aVuse  (which supports  etc, but doesn't offer full xml control)
p43236
aVannotate with  - nothing wrong with it
p43237
aVimplement  - hard work and very easy to get wrong
p43238
aVtake off the setter, and have a separate  method to set the value
p43239
aVuse the  constructor that lets you specify everything at runtime; lots of work/maintenance, and you need to manually cache the serializer (otherwise it creates lots of dynamic assemblies)
p43240
as(dp43241
g18
V23354
p43242
stp43243
a((dp43244
g2
(lp43245
VIf not regex, then is there a good parsing method that i can use in c# that doesnt throw exception
p43246
aVI tried using xmlReader but it didnt work for me
p43247
aVUsing  and  (catching any exception) is probably the fastest pure managed approach
p43248
as(dp43249
g18
V23354
p43250
stp43251
a((dp43252
g2
(lp43253
VDoes your type implement  (directly or indirectly, perhaps via inheritance)
p43254
aVThe biggest difference between in-proc and the rest is that in-proc doesn't serialize, so serialization is the first thing to look at
p43255
aVIt does sound very odd, though - if it was "off", I would expect to get either an exception or an uninitialised object - not a null
p43256
aVMaybe a silly question, but the incoming request definitely has all the right headers/cookies
p43257
ag412
ag50
aVit still knows which session it is in
p43258
aVTo explain, if your type neither implements  nor has  I would expect an exception; you've added , but the fact that it didn't already error makes me think there is some  in the mix
p43259
as(dp43260
g18
V23354
p43261
stp43262
a((dp43263
g2
(lp43264
VPerhaps just use :
p43265
aVAt the moment the class is recursive (a tree) - I don't think that is what you intended
p43266
aV(I also switched to a property, but that isn't the problem -  is the biggie; but there are lots of reasons to use properties instead of fields, and with auto-properties (C# 3
p43267
aV0) there are few excuses not to)
p43268
aVEdit: also, try looking at the inner-most exception; in this case, the message is:
p43269
aVCannot serialize member 'Link' of type LinksInterface
p43270
aVLinkElement
p43271
aVXmlAttribute/XmlText cannot be used to encode complex types
p43272
aVThat gives a reasonable indication of where the problem is ;-p
p43273
as(dp43274
g18
V23354
p43275
stp43276
a((dp43277
g2
(lp43278
VSince a linked list isn't a dictionary, I would expect it to use
p43279
aVThis supports (in order):
p43280
aV(for the  in question)
p43281
aV(which uses reference equality by default, or supports an overridden )
p43282
aVNote that  also handles the usual  rules etc for both classes and
p43283
aV(update: checked, and correct; from )
p43284
aVUpdate to prove this working when , as per comments:
p43285
as(dp43286
g18
V23354
p43287
stp43288
a((dp43289
g2
(lp43290
VThe problem with the syntax as mentioned (with an ) is: what properties/members should  have
p43291
aVDifferent exception types are not necessarily compatible, unless there is inheritance involved (in which case, catch the least-derived that you care about)
p43292
aVThe only current option is to just use  (or similar) and check (/) inside the handler
p43293
aVOr; refactor the common code into a method that can be used by all three
p43294
as(dp43295
g18
V23354
p43296
stp43297
a((dp43298
g2
(lp43299
VThe custom designer file is essential if you are using the designer surface to lay out child controls etc (pretty-much anything in the designer)
p43300
aVIf you aren't doing then this (for example, you are using custom painting, or adding the child controls manually), then you can usually kill this file pretty safely
p43301
aVIn some ways this makes it easier to implement  etc
p43302
as(dp43303
g18
V23354
p43304
stp43305
a((dp43306
g2
(lp43307
VI expect you would have to load the page into a dom (,  or ) and check for any nodes like:
p43308
aVThis should be (in xpath) something like  - then look at  and
p43309
as(dp43310
g18
V23354
p43311
stp43312
a((dp43313
g2
(lp43314
VYou don't need to know the type at all:
p43315
aVThe generics approach isn't appropriate (or needed) in this case
p43316
aVYou might want special handling for , though - or simply not allow it () could be  etc
p43317
as(dp43318
g18
V23354
p43319
stp43320
a((dp43321
g2
(lp43322
VI'm pretty certain that you're on your own, I'm afraid
p43323
aVSorry that doesn't help much
p43324
aVThere is only  - nothing more granular
p43325
as(dp43326
g18
V23354
p43327
stp43328
a((dp43329
g2
(lp43330
V works:
p43331
as(dp43332
g18
V23354
p43333
stp43334
a((dp43335
g2
(lp43336
VI'm not sure I would refactor it, but perhaps:
p43337
aVOtherwise - just maybe a  method, and a  method
p43338
as(dp43339
g18
V23354
p43340
stp43341
a((dp43342
g2
(lp43343
VDon't initialize with values that are never used; and keep declaration and initialization close together:
p43344
aVhas been mentioned - but don't use  unnecessarily:
p43345
aVshould be just:
p43346
aVPersonally, I'd use LINQ for the line-reader, but that is just me ;-p
p43347
as(dp43348
g18
V23354
p43349
stp43350
a((dp43351
g2
(lp43352
VYou need to handle  references and , so (in turn):
p43353
aVNote that  is something different, that allows you to choose between  and  /
p43354
as(dp43355
g18
V23354
p43356
stp43357
a((dp43358
g2
(lp43359
VThings that would cause problems:
p43360
aVdependency on things with thread affinity; UI controls; asp
p43361
aVnet context
p43362
aVanything with thread-specific state (thread-static / thread-local)
p43363
aVanything with mutable state and side-effects
p43364
aVBut more importantly; do you need it
p43365
aVIn many cases it is overkill, and threading always has a slight overhead (the total CPU time increases, even if the elapsed time decreases)
p43366
aVNow; if you already in a highly threaded environment (such as a busy web-server), this isn't going to help
p43367
aVThere are a couple of scenarios where it comes into its own, usually when the elapsed time is more important than the overall CPU time - so very useful at the client, or on some web-server scenarios
p43368
aVIt is especially useful if the state is immutable, so it is pretty trivial to tear the work apart and put the result back together again
p43369
aVThere are some great examples of processing fractals etc, or other CPU-intensive work, with
p43370
as(dp43371
g18
V23354
p43372
stp43373
a((dp43374
g2
(lp43375
VReally, you should mainly be storing your own state data / objects (ideally modelled as DTO classes), in which case the answer is: any you mark as  or
p43376
aVYou shouldn't be adding raw UI controls or other unknown objects to session-state
p43377
aVIn particular, for reasons like this, which had a major performance impact on an app the other day
p43378
as(dp43379
g18
V23354
p43380
stp43381
a((dp43382
g2
(lp43383
VReally
p43384
aVthat is
p43385
aVodd; I would have expected the unit tests to spt such a breaking change
p43386
aVAre you sure you are using the right version
p43387
aVThere is a 2
p43388
aV0 version (which doesn't include  support, since this is in WCF, a 3
p43389
aV0 extension) and a separate 3
p43390
aV0 version
p43391
aVYou want the 3
p43392
aV0 version ()
p43393
aVTested successfully with r275/NET30:
p43394
aVWith output:
p43395
as(dp43396
g18
V23354
p43397
stp43398
a((dp43399
g2
(lp43400
VYour change-handler is on the setter of the list; but you aren't calling the setter (changing the list) - you are adding items to the existing list
p43401
aVThere are separate interfaces (/ etc) for handling list notifications
p43402
aVis a reasonable default implementation for a 2
p43403
aV0 list with notification support
p43404
aVIn
p43405
aVNET 3
p43406
aV0 and above, see also  and
p43407
aVIMO:
p43408
as(dp43409
g18
V23354
p43410
stp43411
a((dp43412
g2
(lp43413
VAs you read from any stream, the position increases
p43414
aVIf you read a stream to the end (as is typical), and then try to read again, then it will return EOF
p43415
aVFor some streams, you can seek - set the  to 0, for example
p43416
aVHowever, you should try to avoid relying on this as it is not available for many streams (especially when network IO is involved)
p43417
aVYou can query this ability via , but it would be simpler to avoid this - partly as if you are branching based on this, you suddenly have twice as much code to maintain
p43418
aVIf you need the data twice, then the options depends on the size of the data
p43419
aVFor small streams, buffer it in-memory, as either a  or a
p43420
aVFor larger streams (or if you don't know the size) then writing to a scratch file (and deleting afterwards) is a reasonable approach
p43421
aVYou can open and read the file as many times (in series, not in parallel) as you like
p43422
aVIf you are happy the stream isn't too large (although maybe add a cap to prevent people uploading swap-files, etc):
p43423
as(dp43424
g18
V23354
p43425
stp43426
a((dp43427
g2
(lp43428
Vsimulate my application running in an IIS app pool instead of the local
p43429
aVNET VM
p43430
aVWell, the local VM won't be miles out (assuming you're hosting in some kind of web-server), but to be honest - why simulate
p43431
aVHost it in IIS; that is fine
p43432
aVTo check for subtle server OS issues, I run a server OS in a VM and deploy / remote-debug etc to that
p43433
aVTo check at runtime, you might check ; most service-based code will report false - where-as winforms etc will return true
p43434
aVIMO, this is rarely an issue, though
p43435
as(dp43436
g18
V23354
p43437
stp43438
a((dp43439
g2
(lp43440
VHow about:
p43441
aVNote that ideally you would cache and re-use the  - or perhaps use  instead (it is marked as deprecated, though)
p43442
as(dp43443
g18
V23354
p43444
stp43445
a((dp43446
g2
(lp43447
VThat has no setter; you'd need:
p43448
aV(you might have to use  - I'll try in a moment)
p43449
aVWithout a setter, you'd have to rely on patterns / field names (which is brittle), or parse the IL (very hard)
p43450
aVThe following works fine:
p43451
aVIt also works with an auto-implemented property:
p43452
aV(where relying on the field-name would break horribly)
p43453
as(dp43454
g18
V23354
p43455
stp43456
a((dp43457
g2
(lp43458
VYou need to bind to the table, not the adapter:
p43459
aVAlso - if you use , you can simplify the code a bit (you don't need the  etc):
p43460
aVAs a final point - as you progress with
p43461
aVNET development, you may want to think about separating your UI and data logic
p43462
aVTalking to a db-command and ui-control in the same method (or even dll) is often a code-smell
p43463
as(dp43464
g18
V23354
p43465
stp43466
a((dp43467
g2
(lp43468
VI think you are over-complicating this, and risking the infamous /capture issue (since LINQ uses deferred execution)
p43469
aVPerhaps just:
p43470
as(dp43471
g18
V23354
p43472
stp43473
a((dp43474
g2
(lp43475
VTry the pattern:  - i
p43476
ag50
aVreplace one-or-more non-alpha (you might allow numeric, though
p43477
as(dp43478
g18
V23354
p43479
stp43480
a((dp43481
g2
(lp43482
VSimplest to write
p43483
aVNot quite as efficient, of course
p43484
aVa bit more like it:
p43485
as(dp43486
g18
V23354
p43487
stp43488
a((dp43489
g2
(lp43490
VI doubt there is
p43491
aVPersonally I would create a separate DTO, as it sounds like you're trying to make one object serve two jobs
p43492
aVAnother option would be to use the  ctor that allows you to specify attribs at runtime, but this is much more work than
p43493
aVSo if you just want it to work:
p43494
aVIf you want it to be "pure", create a second DTO model and translate between them
p43495
as(dp43496
g18
V23354
p43497
stp43498
a((dp43499
g2
(lp43500
VIf there are multiple rows for the order, which date do you want to show
p43501
aVperhaps:
p43502
as(dp43503
g18
V23354
p43504
stp43505
a((dp43506
g2
(lp43507
VI wouldn't expect so
p43508
aVIIRC, there isn't even a guaranteed uninstall for beta 1 - the idea is that you either install it in a VM, or on an OS you don't mind wiping if it doesn't uninstall cleanly (I wouldn't try ringing support if it goes screwy
p43509
aVYou're going to have to download the full beta 2
p43510
aVUltimately, there is no long-term benefit in supporting this option (an upgrade path between beta 1 and beta 2) - as it isn't part of their supported product base, and it introduces extra variables, which you don't want during a beta
p43511
aVDownload the full thing and reinstall
p43512
aVSorry
p43513
as(dp43514
g18
V23354
p43515
stp43516
a((dp43517
g2
(lp43518
VReflector all the way
p43519
aVYou can't rely on local variable names since they don't really exist (only fields retain their names), but having the matching pdb would go a long way to helping
p43520
aVIf you use the pro/EAP version of reflector it will do must of the work for you (generating the full C# disassembly etc, so you don't have to go method-by-method or use a plugin)
p43521
aVYou may still need to look at each directory separately, of course
p43522
as(dp43523
g18
V23354
p43524
stp43525
a((dp43526
g2
(lp43527
VTest it; I get about double performance by reuse (in release, reuse = 3000ms, recreate = 4900ms)
p43528
as(dp43529
g18
V23354
p43530
stp43531
a((dp43532
g2
(lp43533
VWithin the same type, you would just invoke it:
p43534
aVIf you are dealing with sublasses, you might also consider  /  /
p43535
aVThere is a chaining syntax, but it only applies to constructors (  or )
p43536
as(dp43537
g18
V23354
p43538
stp43539
a((dp43540
g2
(lp43541
VNot inside the regular framework
p43542
aVYou would need to track them manually
p43543
aVYou can, however, do this in windbg/sos - mainly for debugging purposes (not for routine code)
p43544
as(dp43545
g18
V23354
p43546
stp43547
a((dp43548
g2
(lp43549
VCertainly C#, and I believe java:
p43550
as(dp43551
g18
V23354
p43552
stp43553
a((dp43554
g2
(lp43555
VIn C#, interfaces are distinct from classes (even abstract classes);
p43556
aVinterfaces can only define the API (method signatures, event declarations, property declarations), not the implementation (fields, method bodies, etc)
p43557
aVyou can only inherit one base class, but you can implement multiple interfaces
p43558
aVBut they have similarities in some usages - for example when used in an abstract factory implementation
p43559
as(dp43560
g18
V23354
p43561
stp43562
a((dp43563
g2
(lp43564
VTo allow the properties to be set in any order, but retain an established validation API (used automatically by some APIs, including  and ASP
p43565
aVNET MVC validation), one option is
p43566
aVThis isn't the simplest interface to implement, but is workable (below)
p43567
aVYou can generalise your validation as something like:
p43568
aVHere's an implemention:
p43569
as(dp43570
g18
V23354
p43571
stp43572
a((dp43573
g2
(lp43574
VI'm assuming that the weight is an integer
p43575
aVHere's an approach which joins to a dummy table to increase the row-count per the weight; first, lets prove it just at TSQL:
p43576
aVThis outputs something like:
p43577
aVShowing that we have the correct overall distribution
p43578
aVNow lets bring that into LINQ-to-SQL; I've added the two tables to a data-context (you will need to create something like the  table to do this) - my DBML:
p43579
aVNow we'll consume this; in the  for the data-context, add a compiled-query (for performance) in addition to the  method:
p43580
aVThis LINQ-to-SQL query is very similar to the key part of the TSQL we wrote; lets test it:
p43581
aVThis runs the query once to show the TSQL is suitable, then (like before) 11k times to check the distribution; output (not including the progress updates):
p43582
aVwhich doesn't look too bad at all - it has both tables and the range condition, and the , so it is doing something very similar; data:
p43583
aVSo again, we've got the right distribution, all from LINQ-to-SQL
p43584
aVSorted
p43585
as(dp43586
g18
V23354
p43587
stp43588
a((dp43589
g2
(lp43590
VAs mentioned already, the  approach should do the job - the  is a convenience, and expresses what we know should be the case, of course
p43591
aVis there any particular reason you don't want it
p43592
aVAnother approach would be to pass in a factory method - this might help in particular with any DI concerns etc:
p43593
aVYou could then call as (for example):
p43594
aVor:
p43595
as(dp43596
g18
V23354
p43597
stp43598
a((dp43599
g2
(lp43600
VSince  is taken, here's an  answer:
p43601
aVOr with :
p43602
as(dp43603
g18
V23354
p43604
stp43605
a((dp43606
g2
(lp43607
VGenerally, to preserve the service boundary, you work with mex-generated proxy classes at the client; these are structure only, so don't have any methods etc (just properties), and may even have different names (and almost certainly a different namespace)
p43608
aVHowever; if this
p43609
aVNET to
p43610
aVNET, you can get WCF (via either svcutil or the IDE) to re-use types in existing assemblies
p43611
aVVia the IDE it does this automatically (by default - you can disable it) if you have a reference to a dll containing matching types
p43612
aVAt the command line, you use  IIRC
p43613
as(dp43614
g18
V23354
p43615
stp43616
a((dp43617
g2
(lp43618
VMethod hiding in an interface isn't nearly as grungy; I'd go with something like:
p43619
as(dp43620
g18
V23354
p43621
stp43622
a((dp43623
g2
(lp43624
VAt the start, you have:
p43625
aVYou create a new thread, running a loop on B1; the key here is that delegates and instance methods (during use) themselves have a reference to the instance (it is "arg0" in IL terms); so you have:
p43626
aVYou then unhook the event and cancel the field:
p43627
aVAnd recreate and rehook against a different instance:
p43628
aVSo: your thread continues processing against [B1], but no longer impacts [A1]
p43629
as(dp43630
g18
V23354
p43631
stp43632
a((dp43633
g2
(lp43634
VI'm not sure I understand fully, but perhaps simply:
p43635
aVIf you want the elapsed time in seconds and milliseconds:
p43636
aVIf you want separate timings for parse vs transform:
p43637
as(dp43638
g18
V23354
p43639
stp43640
a((dp43641
g2
(lp43642
VFirstly, I would update to 2008 Express; 2005 Express is no longer available for download, but 2008 Express can still target
p43643
aVNET 2
p43644
aV0, in addition to giving you 3
p43645
aV0/3
p43646
aV5 goodness
p43647
aVAnd it is still free
p43648
aVActually, 2010 Express is just around the corner
p43649
aVIn particular, you'll find it increasingly hard to find people who can answer 2005 Express IDE-specific issues, simply because few people have 2005 Express still installed
p43650
aVAdd an application manifest file (via the IDE) - it will appear as app
p43651
aVmanifest; it should add (by default):
p43652
aVWhich should (IIRC) help - but a: where is the app running from, and b: what does it do
p43653
aV(does it try to edit the registry, etc)
p43654
as(dp43655
g18
V23354
p43656
stp43657
a((dp43658
g2
(lp43659
VEnums are really just integers - (typically ) - and are compared exactly as such
p43660
aVIf you have:
p43661
aVThen you'll find that
p43662
aVThe only times the names matter are:
p43663
aVin your code
p43664
aVwhen using  (etc)
p43665
aVwhen displaying it via  etc (I suspect it is undefined whether  or  is displayed above)
p43666
aVwhen using things like xml serialization (similar to the above)
p43667
as(dp43668
g18
V23354
p43669
stp43670
a((dp43671
g2
(lp43672
VWhat harm is it doing
p43673
aVPersonally, I'd leave it as is; it does what it says, and is simple to understand
p43674
aVThat, to me, is elegant
p43675
aVYou can also add properties at the top level later (you can't do this if it is itself a list)
p43676
as(dp43677
g18
V23354
p43678
stp43679
a((dp43680
g2
(lp43681
VYou can use  to check (more simply) for , and just use  - like below (I've only included the  etc as demo):
p43682
as(dp43683
g18
V23354
p43684
stp43685
a((dp43686
g2
(lp43687
s(dp43688
g18
V23354
p43689
stp43690
a((dp43691
g2
(lp43692
VIt depends in part on how your are configuring WCF; one option is to use assembly sharing (rather than mex-generated proxies) - in which case you already have your service contract: it is just the interface (and DTO classes) in the paired dll
p43693
aVFrom this you can mock away to your hearts content, and changing to the real service is simply a case of configuring your app
p43694
aVconfig/web
p43695
aVconfig and switching your IoC/DI layer to use WCF (not hard, but "how" depends on your choice of IoC/DI)
p43696
as(dp43697
g18
V23354
p43698
stp43699
a((dp43700
g2
(lp43701
VA LINQ answer (that reads all the triples):
p43702
aVor (to get the string directly):
p43703
as(dp43704
g18
V23354
p43705
stp43706
a((dp43707
g2
(lp43708
VHmmm
p43709
aV0x0D000D0A
p43710
aVYour line endings indeed look borked
p43711
aVYou might have to parse it more manually via a Stream
p43712
aVI would have expected 0x0D000A000
p43713
aV(since this is little-endian)
p43714
aVI wonder if a non-Unicode process has done a "replace lf with crlf" sweep and mucked it up
p43715
aVYou could of course do the same, and (processing bytes in blocks of two) replace 0D0A with 0A00 (starting on even bytes only)
p43716
aVBut starting with non-corrupt data is always a better option
p43717
aVwas:
p43718
aV0xFFFE is a BOM, so anything involving  etc (such as ) should handle this automatically and choose the right encoding
p43719
aVIf not, give it a clue:
p43720
as(dp43721
g18
V23354
p43722
stp43723
a((dp43724
g2
(lp43725
VI'd be interested in seeing the code where you get the date out of the command/reader/adapter - if the database column is typed as a , then what comes over the wire isn't actually "2009/10/01" - it is a binary number (like most dates are on the wire)
p43726
aVAs such there is no ambiguity
p43727
aVI expect that somewhere you are treating it as a string (perhaps some ) - this shouldn't be necessary
p43728
aVIf it is, you aren't ing it as a , but as a
p43729
as(dp43730
g18
V23354
p43731
stp43732
a((dp43733
g2
(lp43734
VJust an alternative answer; if you want the performance, but a similar API - consider HyperDescriptor; this uses  underneath (so you don't have to), but exposes itself on the  API, so you can just use:
p43735
aVOne line of code to enable it, and it handles all the caching etc
p43736
as(dp43737
g18
V23354
p43738
stp43739
a((dp43740
g2
(lp43741
VInteresting; you could report this on "connect"
p43742
aVAs a stop-gap, you could also try wrapping with , but I expect this is papering over a crack (it may still happen, but less frequently)
p43743
aVThe other approach, of course, is to pre-buffer an entire message (but not the entire stream); then read from something like  - assuming your network protocol has logical (and ideally length-prefixed, and not too big) messages
p43744
aVThen when it is decoding all the data is available
p43745
as(dp43746
g18
V23354
p43747
stp43748
a((dp43749
g2
(lp43750
VFor a single type, it is pretty easy to encapsulate, as below
p43751
aVNote that as a key you want to make it immutable too
p43752
aVIf you want to use generics, it gets harder (ask for more info):
p43753
as(dp43754
g18
V23354
p43755
stp43756
a((dp43757
g2
(lp43758
VWith  you don't need to know the type; the metadata is included in the stream (making it bigger, but hey
p43759
aVHowever, you can't cast unless you know the type
p43760
aVOften in this scenario you have to use common known interfaces (non-generic  etc) and reflection
p43761
aVAnd lots of it
p43762
aVI also can't think of a huge requirement to know the type to show in a  - since this accepts , just give it what  provides
p43763
aVIs there a specific issue you are seeing there
p43764
aVAgain, you might want to check for  (non-generic) - but it isn't worth worrying about , since this isn't what  checks for
p43765
aVYou can of course find the  if you want (like so) - and use  and  - not pretty
p43766
aVOK; here's a way using custom descriptors that doesn't involve knowing anything about the object or the list type; if you really want it is possible to expand the list items directly into the properties, so in this example you'd see 2 fake properties ("Fred" and "Wilma") - that is extra work, though ;-p
p43767
as(dp43768
g18
V23354
p43769
stp43770
a((dp43771
g2
(lp43772
VIf I understand correctly - perhaps (using C#, sorry - but no real C# specific logic here):
p43773
aVEven if the VB fights you, I'm sure you can use  instead of  and a  check
p43774
aVFor info, using elements here to me sounds like an odd idea; I'd just have the color name as the text if possible:
p43775
aVor even as an attribute:
p43776
as(dp43777
g18
V23354
p43778
stp43779
a((dp43780
g2
(lp43781
VTwo common issues:
p43782
aVset the  to
p43783
aV(optional) to receive changes from the object, implement the  event pattern or
p43784
aVTo be honest though, I'm sure most of that isn't necessary; you should just be able to say:
p43785
aVFull example:
p43786
as(dp43787
g18
V23354
p43788
stp43789
a((dp43790
g2
(lp43791
V represents a sequence of data, not a random-access list
p43792
aVNot all sequences can be reversed, or even replayed
p43793
aVSequences based on network streams, database access, etc - or this beauty:
p43794
aVThe best you can do is start again - not by calling  (which is deprecated), but by getting a fresh enumerator instead
p43795
aVEven without  it is trivial to come up with simple sequences that cannot be reversed (without buffering and reversing the buffer)
p43796
aVFor what you want, consider looking at  instead - you can access data via the indexer in any order
p43797
as(dp43798
g18
V23354
p43799
stp43800
a((dp43801
g2
(lp43802
VRoutine exceptions are expected; it would be better to bubble them as faults (the WCF term - look for ), but either way the exception will simply get translated onto the wire and handled by the client
p43803
aVWCF clients really don't like to get exceptions, and this is usually terminal for a proxy (the client should clean up their existing proxy and spin up a new one to get a new session etc)
p43804
aVBut your server process (minus the borked session) will keep running and serving requests
p43805
aVThere are of course a category of pretty nasty and server-fatal exceptions - stack overflows, out of memory, thread-abort, etc
p43806
aVBut there isn't much you can do about those anyway
p43807
as(dp43808
g18
V23354
p43809
stp43810
a((dp43811
g2
(lp43812
VThat is pretty evil, but the closest I can think would be to special-case the provider:
p43813
aV(obviously there are other ways to switch on )
p43814
aVThen use via fluent syntax (not query syntax):
p43815
as(dp43816
g18
V23354
p43817
stp43818
a((dp43819
g2
(lp43820
VIf you are only changing the state of the object (i
p43821
ag50
aVnot reassigning the reference, but setting properties / calling methods / etc), then no: don't use
p43822
aVTo me ref indicates that the function is going to change x in some way
p43823
aVIndeed it does
p43824
aVBut you aren't changing  - you are changing to object referred to by , which is a different thing
p43825
aVUse  if:
p43826
aVchanging the reference itself (for reference-types)
p43827
aVchanging the state of a value-type (yuck, should be immutable, or use the return value of the method, which may be simpler)
p43828
aVSo in short; "no"
p43829
aVActually,  is pretty uncommon and poorly understood, which is another reason to minimise use of it unless necessary
p43830
as(dp43831
g18
V23354
p43832
stp43833
a((dp43834
g2
(lp43835
VWould IronPython be more appropriate
p43836
aVThat should work well on "full" framework - but it looks like it might not work (yet) on xbox 360 (which uses compact framework)
p43837
aVFor an IronPython / xna example, see here
p43838
as(dp43839
g18
V23354
p43840
stp43841
a((dp43842
g2
(lp43843
VSo you want the "extra thing" to happen on a worker thread
p43844
aV(else you'd just run it in th  method)
p43845
aVPerhaps just use :
p43846
aVat the end of (or after) your  method
p43847
aVFor info, you may find it easier/tidier to call  with an anonymous method too:
p43848
aVthis avoids creating a delegate type, and provides type-checking on your call to  - note that it captures , though - so if you are in a loop you'll need a copy:
p43849
as(dp43850
g18
V23354
p43851
stp43852
a((dp43853
g2
(lp43854
VThe principal / identity model is still present, so you can use , or (above methods) , etc
p43855
aVIn VS2008 you can hook the identity/principal directly into an ASP
p43856
aVNET authentication module (look for "client application services"), but it is fairly easy to write your own principal too, or use windows groups
p43857
aVThe good thing about "principal" - the abstraction means the same model works everywhere; WCF, winforms, webforms, asp
p43858
aVnet mvc, etc
p43859
as(dp43860
g18
V23354
p43861
stp43862
a((dp43863
g2
(lp43864
VRe cross-thread error
p43865
aVsimply don't try binding from the wrong thread
p43866
aVYou'll have to switch back to the main thread for UI updates, sorry
p43867
aVAs it happens I have used a cross-thread safe list in the past (for whatever meaning "safe" has when multiple threads are mutating the same list
p43868
aVit raises notification events on the UI thread, I mean) - but it certainly won't work on CF
p43869
as(dp43870
g18
V23354
p43871
stp43872
a((dp43873
g2
(lp43874
VIn the button, set a field, for example:
p43875
aVand check this in the "closing":
p43876
as(dp43877
g18
V23354
p43878
stp43879
a((dp43880
g2
(lp43881
VA few thoughts:
p43882
aVdoes the form have an accept-button (set on the ) that might be stealing ret
p43883
aVdoes the textbox have validation enabled and it failing
p43884
aVtry turning that off
p43885
aVdoes something have key-preview enabled
p43886
as(dp43887
g18
V23354
p43888
stp43889
a((dp43890
g2
(lp43891
VFor equality on an emum
p43892
aVSimply:
p43893
aVYou could add  to the top line, but there isn't a need to do that
p43894
aVFor a full example including demo:
p43895
as(dp43896
g18
V23354
p43897
stp43898
a((dp43899
g2
(lp43900
VIn the first example; unboxing (what you show) is different to downcasting or conversion; it is perhaps unfortunate that C# uses the same syntax for all 3
p43901
aVYou must unbox value-types (such as int/double) correctly
p43902
aVOr use  which has the logic for this embedded
p43903
aVIn the second example, this is a conversion (not an unbox, and not a downcast)
p43904
aVConversions are defined either in the language spec (like in this case) or via custom static operators
p43905
aVThe difference is
p43906
aVThe box changes everything
p43907
as(dp43908
g18
V23354
p43909
stp43910
a((dp43911
g2
(lp43912
VIs the knowledge of printing a key part of your  class
p43913
aVIf not, it probably shouldn't be in that class (separation of concerns etc)
p43914
aVThis applies doubly if printing can be different in different contexts
p43915
aVI would probably do something more like:
p43916
aVAs for what  is
p43917
aVif you need to support other types in the future, I'm guessing you might either have a concrete implementation of an abstract base class (as shown above, where  is an abstract method), or alternative an interface
p43918
aVAs to me the job feels more like input, but if the widget only has to print 1 job, so be it
p43919
aVAnother possibility (in C# 3) is an extension method:
p43920
aVwhich allows you to use , but without putting the code into
p43921
as(dp43922
g18
V23354
p43923
stp43924
a((dp43925
g2
(lp43926
VI don't think it'll affect the exception - but some thoughts:
p43927
aVwould  be easier (and more reliable) than
p43928
aVcan return an id from another session during parallel operations
p43929
aVAlso avoid , which can be impacted by triggers doing s
p43930
aVwhy not let the calling (
p43931
aVNET) code worry about the transaction
p43932
aVIt is far easier (and more versatile) to manage at a higher level, either on the connection () or wider ()
p43933
aVExample  approach:
p43934
aVExample  approach (** must SPAN the connection **)
p43935
as(dp43936
g18
V23354
p43937
stp43938
a((dp43939
g2
(lp43940
VThere is no such thing as an "empty" , so supporting  will be tricky unless you store a bit-map of which are defined - but if you simply use a collection of  (i
p43941
ag50
aV) it is done for you
p43942
aVNo extra work, and no boxing:
p43943
aVTo get an  from an , any of:
p43944
aVAnd when you don't need to be able to test for empty, just a  (no )
p43945
aVNo extra code
p43946
aVNo special collection class
p43947
aVAnd it works for most anything
p43948
as(dp43949
g18
V23354
p43950
stp43951
a((dp43952
g2
(lp43953
VOK - this might help; it generates the IL to switch between delegate types, as long as they match the standard pattern
p43954
aVIt adds a castclass only when necessary (so if you are going from a  to an  it isn't necessary, but in the reverse direction it is)
p43955
aVSince you are clearly working with reflection, I haven't used generics (which would make things harder)
p43956
aVThe cheeky bit is that instead of using a capture class, it pretends the method belongs to the data I would capture, and uses the state as
p43957
aVI can't decide if that makes it evil or clever, so I'll go with "clevil"
p43958
aVObviously you still need to generate a delegate to the event using regular methods ( etc), but you can then wrap it to an , or the reverse
p43959
as(dp43960
g18
V23354
p43961
stp43962
a((dp43963
g2
(lp43964
VA familiar curiosity
p43965
aVthe language spec states (14
p43966
aV1):
p43967
aVAn enum declaration may explicitly declare an underlying type of byte, sbyte, short, ushort, int, uint, long or ulong
p43968
aVNote that char cannot be used as an underlying type
p43969
aVAn enum declaration that does not explicitly declare an underlying type has an underlying type of int
p43970
aVBut since  is generally just an alias for  it isn't unreasonable to think either might work
p43971
aVbut indeed it doesn't
p43972
aVIt isn't generally a big problem, but intriguing none the less
p43973
as(dp43974
g18
V23354
p43975
stp43976
a((dp43977
g2
(lp43978
VYou use standard syntax (using  like a method) to pick the overload, inside the class:
p43979
aVthen:
p43980
aVNote also:
p43981
aVyou can chain to constructors on the base-type using
p43982
aVyou can put extra code into each constructor
p43983
aVthe default (if you don't specify anything) is
p43984
aVFor "why
p43985
ag6864
aVcode reduction (always a good thing)
p43986
aVnecessary to call a non-default base-constructor, for example:
p43987
aVNote that you can also use object initializers in a similar way, though (without needing to write anything):
p43988
as(dp43989
g18
V23354
p43990
stp43991
a((dp43992
g2
(lp43993
VSolve all in one go; ClickOnce - like 1, but managed by the system, and with it doing automatic update for you
p43994
aVIn Visual Studio, this is what the "Publish" feature does for you (when writing an exe, obviously)
p43995
aVSteps:
p43996
aVyou publish to a web-server, network share, or any other suitable deployment medium (CD would do)
p43997
aVeach user "runs" (for want of a better word) the  file
p43998
aVprofit
p43999
aV2 is indeed a security nightmare, especially on vanilla 2
p44000
aV0 (it gets easier in 3
p44001
aV5 SP1), and 3 takes too much time to do per machine
p44002
aVSo ClickOnce as far as possible
p44003
aVIf you need more (install COM etc), then an msi installer
p44004
aVOr consider Silverlight etc - different framework, but even easier to deploy
p44005
as(dp44006
g18
V23354
p44007
stp44008
a((dp44009
g2
(lp44010
VHow about:
p44011
aVHowever, you could just  on a list/array
p44012
aVYou only need a dictionary if you need O(1) lookup via the (unique) key
p44013
as(dp44014
g18
V23354
p44015
stp44016
a((dp44017
g2
(lp44018
VI expect an overload is your best option here:
p44019
aVThis is even more appropriate since you can't subclass a struct, thus the only viable  in your example would be  and  - may as well have specific methods, then
p44020
aVRe restricting generics to multiple cited types; not really - and even if there were, the name "Add" suggests you'd want to use operator support, which also isn't in C# (3
p44021
aV0)
p44022
aVHowever, in C# 4
p44023
aV0,  might be an option here - this acts as an optimised form of duck-typing; you wouldn't get compiler support (validation etc), but it should work
p44024
aVYou would cast to  inside the method:
p44025
aVAnother option (in
p44026
aVNET 3
p44027
aV5) is to use the  support in MiscUtil, using  or
p44028
as(dp44029
g18
V23354
p44030
stp44031
a((dp44032
g2
(lp44033
VGiven , then if you mean by name:
p44034
aVIf you mean by numeric value, you can usually just cast:
p44035
aV(with the cast, you might want to use  to check for valid values, though)
p44036
as(dp44037
g18
V23354
p44038
stp44039
a((dp44040
g2
(lp44041
VTry commenting out (separately) the "load" and "paint" code, see which is the problem
p44042
aVIf the problem is the paint
p44043
aVI wonder - rather than creating your own , use the one given to you
p44044
aVNamely,
p44045
aVNote that you didn't create this, so it isn't your job to  it (so don't do that)
p44046
aVI would also cache the  etc in fields rather than create them each time
p44047
aVNote that if you do create a  (etc) in a method, then  is a better way to  it
p44048
aVThere is also a  comment in the paint code that suggests something has been removed - this may be relevant to the problem
p44049
as(dp44050
g18
V23354
p44051
stp44052
a((dp44053
g2
(lp44054
VThe first thing to try is gzip; beyond that, I would try protobuf-net - I can think of a few ways of encoding that quite easily, but it depends how you are building the xml, and whether you mind a bit of code to shim between the two formats
p44055
aVIn particular, I can imagine representing the different data-types as either 3 optional fields on the same type, or 3 different subclasses of an abstract contract
p44056
aVWith test:
p44057
aVResults (21 bytes)
p44058
as(dp44059
g18
V23354
p44060
stp44061
a((dp44062
g2
(lp44063
V(you mean just LINQ, not really LINQ-to-SQL)
p44064
aVSure, you can do it - but it is massive amounts of work
p44065
aVHere's how; I recommend "don't"
p44066
aVYou could also look at the source code for DbLinq - see how they do it
p44067
aVIf you just want , it is a bit easier - but as soon as you start getting joins, groupings, etc - it will be very hard to do
p44068
aVHere's just  support on a custom LINQ implemention (not a fully queryable provider, but enough to get LINQ with  working):
p44069
as(dp44070
g18
V23354
p44071
stp44072
a((dp44073
g2
(lp44074
VPlease excuse formatting - wrong tools "to hand"
p44075
as(dp44076
g18
V23354
p44077
stp44078
a((dp44079
g2
(lp44080
VIMO, the best approach here is an initialize method, i
p44081
ag50
aVHowever, you can do what you want with  (but without compile-time support):
p44082
aVNote that this caches and reuses the delegate for performance
p44083
as(dp44084
g18
V23354
p44085
stp44086
a((dp44087
g2
(lp44088
V returns an empty sequence if there are no matches; this is a perfectly valid sequence (not null)
p44089
aVThe only way you'd get a null is if you call  or
p44090
aVAre you sure the bug is where you think it is
p44091
as(dp44092
g18
V23354
p44093
stp44094
a((dp44095
g2
(lp44096
VIt depends what you mean by "serialization" (it is an overloaded term)
p44097
aVIf you mean your existing object as columns, then and ORM: EF, LINQ-to-SQL, NHibernate, etc
p44098
aVIf you mean your object as a single  / :
p44099
aVWhatever else you do, don't use  - this will break if you change the fields (for example, changing a regular property into an auto-property)
p44100
aVYou need something contract-based, most of which will be fine with changes
p44101
aVSuggestions:
p44102
aV/  / Json
p44103
aVNET (text)
p44104
aVprotobuf-net (binary, uses google's "protocol buffers" wire format)
p44105
aVWith the above you can generally use pretty standard DTOs; for example (compatible with  and protobuf-net):
p44106
aVI wouldn't use  for similar reasons to  - fine for short-lived requests, but not good for storage
p44107
aVNote that most serializers use concrete classes, since very few include the type metadata in the output (and hence would need additional configuration to tie  to your  class)
p44108
as(dp44109
g18
V23354
p44110
stp44111
a((dp44112
g2
(lp44113
VIf you are using , it should work fine, but the scope must surround the connection(s):
p44114
aVThere is an edge case where a  can fail causing the later command to run without a transaction
p44115
aVAlternatively, for a single connection use , but remember to associate the transaction (from the connection) to each command
p44116
as(dp44117
g18
V23354
p44118
stp44119
a((dp44120
g2
(lp44121
VNot an enum, but:
p44122
as(dp44123
g18
V23354
p44124
stp44125
a((dp44126
g2
(lp44127
VMainly, you would need inheritance:
p44128
aVNote that you can create subclasses at runtime using , , etc - but it isn't fun, and should be reserved for when you absolutely need it
p44129
as(dp44130
g18
V23354
p44131
stp44132
a((dp44133
g2
(lp44134
VYou can't do this at the compiler, short of something like an fxcop add in
p44135
aVThe best you can do is check (once) at runtime, perhaps via a static constructor that verifies the  in question and throws an error for your unit tests to catch:
p44136
as(dp44137
g18
V23354
p44138
stp44139
a((dp44140
g2
(lp44141
VYes:
p44142
aVExcept for , which might also be  (if you check the IL,  doesn't actually get written as an attribute - there is a special type modifier; either approach works fine, though)
p44143
as(dp44144
g18
V23354
p44145
stp44146
a((dp44147
g2
(lp44148
VIt will work fine for data-binding (I suspect this is its intended use-case), which uses reflection under the hood
p44149
aVIt will also work fine with  in
p44150
aVNET 4
p44151
aV0:
p44152
aVOther than that
p44153
aVreflection or
p44154
as(dp44155
g18
V23354
p44156
stp44157
a((dp44158
g2
(lp44159
s(dp44160
g18
V23354
p44161
stp44162
a((dp44163
g2
(lp44164
VWith  you indeed can't get the enumerator - you could, however, have the enumerator return () a tuple that includes that data; in fact, you could probably use LINQ to do it for you
p44165
aV(I couldn't cleanly get the index using LINQ - can get the total and current value via , though; so here's the tuple approach)
p44166
as(dp44167
g18
V23354
p44168
stp44169
a((dp44170
g2
(lp44171
VThere is an overload of  that takes a  (i
p44172
ag50
aVa  or ) - the  is the index
p44173
as(dp44174
g18
V23354
p44175
stp44176
a((dp44177
g2
(lp44178
VAside: for getting columns back in a known order: there is no defined order for members, except that which you create
p44179
aVFor example (from MSDN):
p44180
aVThe GetProperties method does not return properties in a particular order, such as alphabetical or declaration order
p44181
aVYour code must not depend on the order in which properties are returned, because that order varies
p44182
aVIf you don't need to rely on the order, either reflection or TypeDescriptor would do; for example (noting that this writes TSV text, not  - my interpretation is that the problem is getting the data, not writing the Excel):
p44183
aVIf you need order, you would need to either:
p44184
aVpass it in (for example, as a )
p44185
aVuse attributes on the properties
p44186
aVuse alphabetical
p44187
aVThe  approach above has the advantages (over ) that:
p44188
aVit works with custom object models (, for example, if you use )
p44189
aVyou can tweak the implementation for performance - for example HyperDescriptor (useful if you are doing this lots)
p44190
as(dp44191
g18
V23354
p44192
stp44193
a((dp44194
g2
(lp44195
VI'm guessing:
p44196
aVbtw, it may (or maybe not) be easier to use  (in which case change  to ) - but either should work
p44197
as(dp44198
g18
V23354
p44199
stp44200
a((dp44201
g2
(lp44202
VIf there is a reasonable chance that an abstract entity (interface or abstract class) might need to be disposable, it should implement it
p44203
aV, for example doesn't itself need , nor does
p44204
aVAn abstract base class may be simpler, as you can have a default (empty) implementation of  then, and possibly the finalizer / Dispose(bool) pattern, i
p44205
ag50
as(dp44206
g18
V23354
p44207
stp44208
a((dp44209
g2
(lp44210
VAn event may be desirable, but as a delegate property:
p44211
aVTo avoid an edge-case (thread-race / ), you might also want:
p44212
as(dp44213
g18
V23354
p44214
stp44215
a((dp44216
g2
(lp44217
VYou need to tell it about inheritance:
p44218
aVNote that you don't need  for
p44219
aVAlso - look at the inner exceptions:
p44220
aVTo see:
p44221
aVThe type B was not expected
p44222
aVUse the XmlInclude or SoapInclude attribute to specify types that are not known statically
p44223
as(dp44224
g18
V23354
p44225
stp44226
a((dp44227
g2
(lp44228
VI've seen it done with a delegate and IL interrogation, but that isn't exactly simpler
p44229
aVIn short, no: there is no  in C#
p44230
aVHere's Eric Lippert's take on this: In Foof We Trust: A Dialogue
p44231
as(dp44232
g18
V23354
p44233
stp44234
a((dp44235
g2
(lp44236
VI don't like this, but it seems to work; the real problem seems to be the  coming in oddly (and not being dropped ("pop") automatically), but:
p44237
as(dp44238
g18
V23354
p44239
stp44240
a((dp44241
g2
(lp44242
VIn short, no; AFAIK you'd have to fix the source values, or use your own replacement to
p44243
aVNote that if you are passing in a custom culture (to ) you may want to use , rather than just
p44244
as(dp44245
g18
V23354
p44246
stp44247
a((dp44248
g2
(lp44249
V10k views - that's one every 8 seconds
p44250
aVnot sure you need to worry too much
p44251
aV;-p
p44252
aVBut re the code - that is overcomplicating things, and you could still end up initializing it twice
p44253
aVI'd just use a static constructor to do this; it'll be more robust
p44254
aVIf you must have full isolated lazy loading (even with other static methods on the type), there is a trick with an inner class to achieve the same:
p44255
aVI would also be concerned about the chance of somebody mutating the list - might want to use a readonly list
p44256
as(dp44257
g18
V23354
p44258
stp44259
a((dp44260
g2
(lp44261
VYou could do something based on this answer, noting that this compares the public properties, not the fields, and that  could do anything crazy it wants
p44262
aVIt wouldn't be hard to change it to use fields instead, but
p44263
aVto be honest, I'm not sure what the driver is here
p44264
aVI'd just write the  and  and use  (which handles , nulls, , etc - using  as the fallback strategy)
p44265
aVFor something that I think meets your updated need:
p44266
as(dp44267
g18
V23354
p44268
stp44269
a((dp44270
g2
(lp44271
VWell, what is the protection level of
p44272
aVAnd where is your code in relation
p44273
aVIt will be inaccessible if, for example
p44274
aVit is  and you're in an unrelated class
p44275
aVit is  and you're not in a subclass
p44276
aVit is  and you're in a different assembly without [
p44277
aVit is  and both of the two above apply
p44278
aVTo be honest, it looks like a field, and fields generally aren't  - so it wouldn't amaze me if somebody has changed the accessibility, perhaps adding a public static property to wrap it - or simply changed the name (although that would give a different error)
p44279
aVTry looking for  or similar (in intellisense / object-browser)
p44280
aVRe your comment; you have:
p44281
aVso just add:
p44282
aVand change your calling code to use
p44283
as(dp44284
g18
V23354
p44285
stp44286
a((dp44287
g2
(lp44288
VYou can use things like "Process Explorer" (easy to find) on the machine in question to double-check which process is locking a file
p44289
aVIf you don't own the competing process, the best you can do is ask the operator to kindly close the file and/or app that is blocking you
p44290
aVAssuming you do you manage the other process that is locking the file
p44291
aVThe most common cause of unexpected locks is files not being closed cleanly
p44292
aVCheck that you are religiously closing all file handles after use, ideally using  so that they are closed even in error conditions - for example:
p44293
as(dp44294
g18
V23354
p44295
stp44296
a((dp44297
g2
(lp44298
VIf you do a lot of work with dates, yes - a range can be handy
p44299
aVThis is actually one of those oh-so-rare cases where you should probably write it as a  (immutable)
p44300
aVNote, however, that "Noda Time" will probably give you all of this and more (when it is complete)
p44301
aVI've done scheduling software before; I had a couple of such structs (for slightly different jobs)
p44302
aVNote, there isn't a handy BCL construct for this
p44303
aVAlso - think of all the wonderful methods (and possibly operators) that you can centralise when you have a range; "contains" (of a datetime
p44304
aVof another range
p44305
aVincluding/excluding limits
p44306
aV, "intersects", offset-by (a timespan), etc
p44307
aVA definite case for having a type to handle it
p44308
aVNote that at the ORM level, this is easier if your ORM supports composite values - I believe NHibernate does, and possibly EF 4
p44309
ag190
as(dp44310
g18
V23354
p44311
stp44312
a((dp44313
g2
(lp44314
V doesn't support change events;  would be a good substitute to support this scenario, and it also supports item-level change events if your type  implements
p44315
aVIn 3
p44316
aV0 and above, there is also , which acts similarly to
p44317
aVIt all comes down to interfaces such as , , etc
p44318
aVFrom comments; for a 2
p44319
aV0/3
p44320
aV0 example of adding a  to :
p44321
aVNote that in 3
p44322
aV5 (or in
p44323
aVNET 2
p44324
aV0/3
p44325
aV0 with LINQBridge and C# 3
p44326
aV0) you don't need this - any of the LINQ extension methods would do the same thing
p44327
as(dp44328
g18
V23354
p44329
stp44330
a((dp44331
g2
(lp44332
VIt depends on how you execute it ;-p
p44333
aVOnce you're inside the methods on the loaded type, yes: regular GIT etc applies normally (note that security checks may make things a little slower if it is partially trusted, but not much)
p44334
aVBut first you need to invoke some code on the dynamic object:
p44335
aVIf you can cast the object to an interface or base-class that is known statically, then it will be identical
p44336
aVIf this isn't possible, but you can bind specific operations to known delegates (for example , via ), then it will be almost as fast, but less convenient
p44337
aVIf you do everything via , it will be pretty treacle-like
p44338
aVIn 4
p44339
aV0,  may offer a halfway house, in that it offers duck-typing with optimised caching per type
p44340
aVSo: how are you accessing it
p44341
as(dp44342
g18
V23354
p44343
stp44344
a((dp44345
g2
(lp44346
VIf you mean the collection, then just :
p44347
aVHowever, I'm assuming (from the example) that you have a :
p44348
aVThe object will never be "of" type  - but it might implement it; I would expect that:
p44349
aVwould do
p44350
aVIf you don't know the  ( in the above), then check all the implemented interfaces:
p44351
aVand call:
p44352
aVif this is null, it isn't  for any  - otherwise check
p44353
as(dp44354
g18
V23354
p44355
stp44356
a((dp44357
g2
(lp44358
VIf you have a data-context, you can just use:
p44359
aVFortunately, LINQ-to-SQL is very forgiving here
p44360
aVOne warning, though - it is safer to use  (for an  instance) that
p44361
aVThis and a lot of similar material is covered in a series of blog entries starting here covering writing an ADO
p44362
aVNET Data Services layer for LINQ-to-SQL (which has similar challenges to this)
p44363
as(dp44364
g18
V23354
p44365
stp44366
a((dp44367
g2
(lp44368
Vno, don't do that, except for specific cases such as static fields or when you know a variable/field lives a lot longer than the code referencing it
p44369
aVyes, but with a working knowledge of your VM's limits (and how to cause blocks of memory to be held accidentally)
p44370
aVn/a
p44371
as(dp44372
g18
V23354
p44373
stp44374
a((dp44375
g2
(lp44376
VIn the more general case, with LINQ (supports any type of abstract typed list):
p44377
as(dp44378
g18
V23354
p44379
stp44380
a((dp44381
g2
(lp44382
VThe code snippets should still work
p44383
aVTools => Code Snippets Manager
p44384
aV, or the chord:
p44385
aVCtrl+K, Ctrl+B
p44386
aVFor example,  Tab Tab gives:
p44387
aVwith ability to step through the pieces to change
p44388
aVThe full list is in the manager
p44389
as(dp44390
g18
V23354
p44391
stp44392
a((dp44393
g2
(lp44394
VYou don't need a static class for enums - they can be top-level (meaning: namespace level)
p44395
aVYes, you need a class for constants (and a static class would suffice), but I would tend to have multiple classes - one per intent
p44396
aVThere is no need to cram them all together
p44397
aVIn C#, any  only apply to that file, so there is not much point having a class for them (put them in the project / build-script instead)
p44398
aVAnd macros don't exist
p44399
as(dp44400
g18
V23354
p44401
stp44402
a((dp44403
g2
(lp44404
VYou mean , using  to create instances:
p44405
as(dp44406
g18
V23354
p44407
stp44408
a((dp44409
g2
(lp44410
VYou can't see it because it is hidden:
p44411
aVNormally, the assumption is that it makes sense in a base-class, but isn't supported for the current type  - but  inherits from , so I'm not sure what is going on here
p44412
aVIn particular, MSDN doesn't make any comments that suggest any reason why it is hidden, unless perhaps it conflicted with the designer (node editor)
p44413
as(dp44414
g18
V23354
p44415
stp44416
a((dp44417
g2
(lp44418
VThe first is useful and normal for non-trivial amounts of code, or where you want to re-use code (you can do this with an anonymous method by capturing into a variable, but it loses the shine somewhat
p44419
aVThe second and third are largely identical (in C# 3
p44420
aV0, at least), and are really handy for short blocks of code
p44421
aVActually, there is a 4th option, useful if you don't care about the args:
p44422
aVNote we haven't had to declare any args (the compiler writes a compatible signature that just doesn't use them)
p44423
aVThe above trick is probably mot handy for  events (I'm guessing that for  you are interested in which key was pressed, so probably don't use this one in your scenario)
p44424
as(dp44425
g18
V23354
p44426
stp44427
a((dp44428
g2
(lp44429
V(this reply relates to C# only, AFAIK)
p44430
aVDon't tell Eric Lippert that references are pointers ;-p They happen to be the same thing in MS C# /
p44431
aVNET, but that is an implementation detail
p44432
aVA reference is an opaque, safe "thing" that allows you to locate an object
p44433
aVA pointer is a memory address
p44434
aVThey worked hard to make sure that you always know which you mean
p44435
aVIt would be entirely feasible to implement a CLI and compiler that didn't treat the two as the same; you would still be passing a reference to the value, though
p44436
aVReferences are not addresses
p44437
as(dp44438
g18
V23354
p44439
stp44440
a((dp44441
g2
(lp44442
VRe
p44443
aVthis isn't a standard proto type; I have added a BCL
p44444
aVDateTime (or similar) to my own library, which is intended to match the internal serialization that protobuf-net uses for , but I'm fairly certain I haven't (yet) updated the code-generator to detect this as a special-case
p44445
aVIt would be fairly easy to add if you want me to try
p44446
aVIf you want maximum portability, a "ticks" style approach might be pragmatic
p44447
aVLet me know
p44448
aVRe serializing to a file - if should be about the same as the Getting Started example, but note that protobuf-net wants to work with data it can reconstruct; just  might cause problems -  should be fine, though (it'll default to  as a concrete type when reconstructing)
p44449
aVRe corruption - perhaps use  - it can then detect issues even at a message boundary (where they are otherwise undetectable as an EOF)
p44450
aVThis (as the name suggests) writes the length first, so it knows whether is has enough data (via )
p44451
aVAlternatively, reserve the first [n] bytes in your file for a hash / checksum
p44452
aVWrite this blank spacer, then the data, calculate the hash / checksum and overwrite the start
p44453
aVVerify during deserialization
p44454
aVMuch more work
p44455
as(dp44456
g18
V23354
p44457
stp44458
a((dp44459
g2
(lp44460
VThe best I can do would be:
p44461
aVor:
p44462
aVor:
p44463
aVRe:
p44464
aVBonus points would be the instance variable
p44465
aVBy using  (or just ) you can get the property name and value fairly easily
p44466
aVI'll do an example for the middle - note that the first requires an extra type for the DSL, but nothing heavy:
p44467
aVOr slightly better message:
p44468
as(dp44469
g18
V23354
p44470
stp44471
a((dp44472
g2
(lp44473
VReflection is one way to do this ()
p44474
aVA second way to get this curiosity is if you give away the reference too early, by passing  (or sometihng involving an implicit , such as a field captured into an anonymous method / lambda) out of the :
p44475
aVOr more likely (given the question):
p44476
aVAnother relevant question might be - can it not be assigned in the first place
p44477
aVAnd the answer to that is yes, especially if you are using serialization
p44478
aVContrary to popular belief, you can actually bypass the constructors, if you have a reason;  is a good example of something that does this
p44479
aVThe following will create a  with a null field:
p44480
as(dp44481
g18
V23354
p44482
stp44483
a((dp44484
g2
(lp44485
VIn the absence of , the best you can do is  via expression trees
p44486
as(dp44487
g18
V23354
p44488
stp44489
a((dp44490
g2
(lp44491
VYour question isn't very clear (can you define "not serializing"
p44492
aV, but some thoughts:
p44493
aVYou should really use  to capture the buffer, not  (which is cheaper, but returns the oversized array, and should only be used in conjunction with )
p44494
aVWhere are you seeing this
p44495
aVwrites the objects type, then either uses reflection to write the fields (for ) or uses customer serialization (for )
p44496
aVIt never calls  (unless that is what your  does)
p44497
aVHowever, strings etc will be in the output "as is"
p44498
aVNote that  can be brittle between versions, so be careful if you are keeping this data for any length of time (it is generally fine for transport, though, assuming you update both ends at the same time)
p44499
aVIf you know in advance what your  objects are, there are a range of contract-based serializers that might provide more stability
p44500
aVI can provide more specific help if you think this would be worth investigating
p44501
as(dp44502
g18
V23354
p44503
stp44504
a((dp44505
g2
(lp44506
VIn C# there is only one escape code you need (double-quote)
p44507
aVif you use verbatim string literals:
p44508
aVI always write regex with  strings - avoids many headaches
p44509
as(dp44510
g18
V23354
p44511
stp44512
a((dp44513
g2
(lp44514
VThis might be a shot in the dark, but I would look at the csproj files, to see if the one that isn't working has any obvious differences
p44515
aVIn particular, I would look for a  element
p44516
aVAnything that relates to web-hosting is of interest too, of course; so anything under:
p44517
aV(or similar, depending on your flavor of project; compare between the 3 for anything that looks out of place)
p44518
as(dp44519
g18
V23354
p44520
stp44521
a((dp44522
g2
(lp44523
VEach  has a  collection that you can iterate through to get the full hierarchy, but unfortunately  items use a different object model (they aren't all s); as such, you can iterate such a setup (to include the menu items too), but it isn't trivial; here's an example:
p44524
aVYou might call this, for example, via something like:
p44525
aVOf course, then the question is: what do you want to do with each item
p44526
as(dp44527
g18
V23354
p44528
stp44529
a((dp44530
g2
(lp44531
VIt depends a little bit on your requirements; in general I would use a  here - well supported and extensible:
p44532
aVThis handles culture etc (see overloads - use invariant for serialization), and if a type outside your control doesn't have a converter, you can still add one:
p44533
aVYou can also decorate your own types simply as:
p44534
aVOne caveat, though; it ( / ) isn't on all frameworks; if you need to support CF / Silverlight / etc you should check that it is supported first
p44535
aVFine on regular
p44536
aVNET, though
p44537
aVI have some serialization code that needs to work on all frameworks, and I couldn't use this for that reason - I use  and  instead
p44538
as(dp44539
g18
V23354
p44540
stp44541
a((dp44542
g2
(lp44543
VI'm assuming that  is a typo, and you mean
p44544
aVAnd is
p44545
aVOr is this another typo
p44546
aVI'm making the assumption that
p44547
aVWith , it will have to be a :
p44548
aVsince lists aren't covariant, even in 4
p44549
ag190
as(dp44550
g18
V23354
p44551
stp44552
a((dp44553
g2
(lp44554
VThe sender approach should be fine
p44555
aVYou can, however, cast:
p44556
aVNote that there are scenarios where the sender isn't what you think, but this is the rarity, and mainly relates to event forwarding via code like:
p44557
aVhere,  will be , which you can't see
p44558
aVNormally this isn't a problem, though
p44559
as(dp44560
g18
V23354
p44561
stp44562
a((dp44563
g2
(lp44564
VI wouldn't say it is bad, although I'd almost certainly refactor the second block of code into a second method, so keep it comprehensible
p44565
aVAnd probably catch something more specific than
p44566
aVA second try is sometimes necessary, especially for things like  implementations that might themselves throw (WCF, I'm looking at you)
p44567
as(dp44568
g18
V23354
p44569
stp44570
a((dp44571
g2
(lp44572
VNo, that doesn't exist AFAIK, but shouldn't be hard to implement; it does, of course, involve the nuances of variance, so your collection must expect casting problems when assigning/adding
p44573
aVNote that arrays () already act like this (arrays of reference-types have variance support, with typecast checking etc), but you can't add to an array, and it doesn't fire change events
p44574
aVTo implement this would largely be an encapsulation job; object construction (when data-binding to new rows) would be the tricky bit, and may force you to add extra interfaces
p44575
ag7733
aV0 won't add anything here: What C# 4
p44576
aV0 covariance *doesn't* do
p44577
aVUntested, but:
p44578
as(dp44579
g18
V23354
p44580
stp44581
a((dp44582
g2
(lp44583
Vfor subexpressions; works on LINQ-to-SQL and LINQ-to-Objects, but not EF in 3
p44584
aV5SP1 (for , call  first):
p44585
aVexample LINQ-to-SQL output (EF explodes in sparks):
p44586
aVidentity-manager short-circuit without roundtrip - i
p44587
ag50
aVetc should not need to go to the database if an object with that identity has already been materialized and stored in the identity-manager; applies also to , ,
p44588
aVSee LINQ-to-SQL (also here and here; you can verify by attaching to ); example:
p44589
aVlog output shows only only two trips; one to get the object the first time, and one for the count; it also shows the same object reference is returned by the materializer:
p44590
aVUDF support; for a simple example that also works for LINQ-to-Objects:
p44591
aVand then order by ; example:
p44592
aVwith output:
p44593
aVIf I was feeling truly evil, recursive lambda; probably not worth supporting this in any way
p44594
aVlikewise, 4
p44595
aV0 expression (DLR) node-types
p44596
as(dp44597
g18
V23354
p44598
stp44599
a((dp44600
g2
(lp44601
VThe visual cue comes as standard if you set the default button
p44602
aVYou could, however, do something with key-preview, capturing carriage-return and performing the required action(s) necessary
p44603
aVTo give a C# example (same concepts apply to VB
p44604
aVNET):
p44605
as(dp44606
g18
V23354
p44607
stp44608
a((dp44609
g2
(lp44610
VYes, if you have the pdb in the same folder as the dll, or a symbol server
p44611
aVNote that "reflector pro" (currently in preview) also offers the ability to do this (still inside VS) by decompiling the second dll on-demand
p44612
as(dp44613
g18
V23354
p44614
stp44615
a((dp44616
g2
(lp44617
VI wouldn't shy away from a config-based option; it usually has the advantage of not requiring a rebuild
p44618
aVIf you don't want that, another option might be type-metadata via an attribute
p44619
aVThis would make it trivial to add data for new types (that you write), and you can (indirectly) add attributes to exiting types ( etc) via  - as long as you use  to get them back out again ;-p
p44620
aVWhether this is a good idea or not
p44621
aVwell, reflection (and the twin, ) can be slow, so if you want to use this in a tight loop I'd look first at something involving a dictionary
p44622
as(dp44623
g18
V23354
p44624
stp44625
a((dp44626
g2
(lp44627
V in TSQL needs to take multiple arguments per item
p44628
aVAt the moment, if you pass it "123,456,789", it is looking for the single row with value "123,456,789"
p44629
aVIt isn't looking for "123", "456" or "789"
p44630
aVLook for something like a split udf - plenty on the internet
p44631
aVThis takes your delimited string and returns a column of values
p44632
aVTypically you then join the the udf results (rather than use )
p44633
aVDON'T use  here, as you shouldn't trust the input
p44634
as(dp44635
g18
V23354
p44636
stp44637
a((dp44638
g2
(lp44639
VThe comma case is easy enough - ; for the space
p44640
aVperhaps cheat and replace the commas
p44641
aVOr write a custom culture with space as the group separator
p44642
aVNote also that this is culture-dependent
p44643
aVThe comma above doesn't mean "comma", it means the culture's group separator
p44644
aVYou might want to specify a fixed culture if this matters (perhaps the invariant culture)
p44645
as(dp44646
g18
V23354
p44647
stp44648
a((dp44649
g2
(lp44650
VYes; it isn't supported, neither here nor in
p44651
aVPerhaps iterate manually over
p44652
as(dp44653
g18
V23354
p44654
stp44655
a((dp44656
g2
(lp44657
V maybe
p44658
aVNote I also added (to ):
p44659
aVhere's the code:
p44660
as(dp44661
g18
V23354
p44662
stp44663
a((dp44664
g2
(lp44665
VYou can't invoke it unless you give it arguments; and you can't give it arguments unless you know the signature
p44666
aVTo get around this, I would place that burden on the caller - I would use  and anon-methods/lambdas, i
p44667
ag50
aVOtherwise, you can use  and , but that is slow and you need to know which args to give it
p44668
as(dp44669
g18
V23354
p44670
stp44671
a((dp44672
g2
(lp44673
VDon't use  etc; xml typically uses different string representations than it accepts; just cast (note no ):
p44674
aVhas conversion operators to do all the work, returning appropriate values
p44675
as(dp44676
g18
V23354
p44677
stp44678
a((dp44679
g2
(lp44680
VWith the question update; if that is the only method in the service (and assuming you don't have any exotic base-classes etc), then I conclude that your VS install is borked
p44681
aVDo you have another machine you can try from
p44682
aVAlso, check that your method has the appropriate attributes etc, but that shouldn't cause the problem shown
p44683
aVHave you tried using  at the command-line
p44684
aVIt is very easy, and hopefully won't have this problem
p44685
as(dp44686
g18
V23354
p44687
stp44688
a((dp44689
g2
(lp44690
V1: An "object initializer"
p44691
aV2: Nope; it is very handy for code samples, in particular ;-p
p44692
aVThings you can't do in an object initializer:
p44693
aVsubscribe events
p44694
aVcombine with collection initializers on the same collection instance (an initializer is either an object initializer (sets properties) or a collection initializer (adds items)
p44695
aVYou can get past these limitations by cheating:
p44696
as(dp44697
g18
V23354
p44698
stp44699
a((dp44700
g2
(lp44701
VIf you are databound, you should have (via ) access to all the properties, by casting  to whatever type you need
p44702
aVOtherwise, just look at the cells, or set a  against the rows when you add them
p44703
aVHere's an example showing a data-bound  and a couple of buttons, pulling out data for the selected row:
p44704
aVThere are other ways of handling the click events, and usually much of the above would be done via the designer rather than like this (but it is very hard to show designer code in a snippet)
p44705
as(dp44706
g18
V23354
p44707
stp44708
a((dp44709
g2
(lp44710
VHere's something I wrote a while ago; it should work reasonably well, but note the cost of lots of updates
p44711
as(dp44712
g18
V23354
p44713
stp44714
a((dp44715
g2
(lp44716
VNetworkService is the only one that is going to include network credentials here, and that will be the local machine's identity
p44717
aVDoes the machine account have access to the share
p44718
aVIf this isn't correct, you'll need to run the service as a dedicated, specific user account
p44719
as(dp44720
g18
V23354
p44721
stp44722
a((dp44723
g2
(lp44724
VWhat is the ~ character used for in C#"
p44725
aVFor info, ~ is also used (in a different context) to denote a destructor / finalizer:
p44726
aVNote that you very rarely need a destructor; usually only when your type directly wraps an unmanaged resource (an OS handle, etc)
p44727
as(dp44728
g18
V23354
p44729
stp44730
a((dp44731
g2
(lp44732
VLazy loading, deferred initialization, etc
p44733
aVNoet that  should (in this case) ideally return , not  to avoid the chance that it gets called lots of times because it is legitimately null
p44734
as(dp44735
g18
V23354
p44736
stp44737
a((dp44738
g2
(lp44739
VTypically, rather than passing a , I would pass the  (perhaps a constrained-stream, to stop it from reading outside of our expected region) or the wrapping reader, and use that - i
p44740
ag50
aVlet the class read what it needs
p44741
aVAnother simple option is to length-prefix the data during serialization, so that you know the size is in advance
p44742
aVOr, save a lot of bother and use a pre-rolled binary serialization framework
p44743
aVThere are several
p44744
aVthey have all had to solve this problem
p44745
aVHappy to advise (it is a pet area of mine)
p44746
aVI also worry about separation of concerns in your class, but that is a side-issue
p44747
as(dp44748
g18
V23354
p44749
stp44750
a((dp44751
g2
(lp44752
VCertainly anything involving  or  (i
p44753
ag50
aVdynamic at the database itself) would qualify, but I guess you could argue that any SQL generated at runtime (rather than fixed at build / install) would qualify
p44754
aVSo yes, you could argue that a runtime-generated, yet correctly parameterized query is "dynamic" (for example, LINQ-to-SQL generated queries), but to be honest as long as it doesn't expose you to injection attacks I don't care about the name ;-p
p44755
as(dp44756
g18
V23354
p44757
stp44758
a((dp44759
g2
(lp44760
VIf you mean without declaring the delegate type, then probably not; very few (if any) inbuilt delegates use ; but you could make it generic:
p44761
aVI'm not sure this saves much though
p44762
aVThere may also be some tricks here with extension methods, but it is hard to tell without more detail
p44763
as(dp44764
g18
V23354
p44765
stp44766
a((dp44767
g2
(lp44768
VThe usage is very similar to ; you could use MSDN  on  for a broad overview; you might also want to learn xpath syntax (MSDN)
p44769
aVExample:
p44770
aVThe second argument to  is the default returned in case the attribute is not found
p44771
as(dp44772
g18
V23354
p44773
stp44774
a((dp44775
g2
(lp44776
VPersonally I would say it is closer to Java than C++, but a few extras for the melting pot:
p44777
aVDelegates (roughly function pointers)
p44778
aVUser-defined value-types
p44779
aVGenerics are different for all 3, but Java's type-erasure generics are probably (although it is an odd comparison) closer to C++ templates than C# runtime-based generics
p44780
as(dp44781
g18
V23354
p44782
stp44783
a((dp44784
g2
(lp44785
VIn C# 2
p44786
aV0 and above, they are identical
p44787
aVIn C# 1
p44788
aV2 (the one that shipped with
p44789
aVNET 1
p44790
aV1), only the first syntax (with ) compiles ;-p
p44791
aVThe second syntax saves key presses, but VS intellisense will typically suggest the first
p44792
aVUltimately, it makes very little difference
p44793
aVI generally use the second syntax in code-samples online, simply because it avoids going over the (narrow) column width
p44794
as(dp44795
g18
V23354
p44796
stp44797
a((dp44798
g2
(lp44799
VAs a snapshot:
p44800
aVAs they happen:
p44801
aVSomething like:
p44802
as(dp44803
g18
V23354
p44804
stp44805
a((dp44806
g2
(lp44807
VDo you mean something that does the  (or equivalent) for you (in the most appropriate way for the data)
p44808
aVLike
p44809
aVThis is where delegates come to the fore; just pass an , and apply to each in turn
p44810
aVI've avoided using  in the above deliberately, as this most commonly applies to scenarios where  isn't already provided
p44811
aVHowever; IMO, since C# (from 2
p44812
aV0 onwards) has  syntax (iterator blocks), it is easier just to support
p44813
aVYou could of course add a  extension method on  ;-p Internal iterators may have been attractive in
p44814
aVNET 1
p44815
aV1 (C# 1
p44816
aV2) where (correctly) writing an iterator was incredibly painful
p44817
as(dp44818
g18
V23354
p44819
stp44820
a((dp44821
g2
(lp44822
VIf you want the static constructor to get called, then add a dummy method to the type and simply call it at the start of your code ( etc); if it is a trivial / empty method you might want to mark it for no inlining etc
p44823
aVYou can use reflection to call the static constructor, but I don't recommend it; if you use reflection you can actually call the
p44824
aVcctor multiple times, and that is never a good thing
p44825
as(dp44826
g18
V23354
p44827
stp44828
a((dp44829
g2
(lp44830
VYou want to build from aspx
p44831
aVOdd, but
p44832
aVUltimately you have  which can execute any command, but you should think very carefully about which security context / identity your web-server is running as, and where it can read / write files, and the impact of using a web-server as a build-server
p44833
aVAnother option is to use the web-server to queue the work (perhaps MSMQ etc), and have a separate service (on a separate machine) dequeuing and doing the build / publish
p44834
as(dp44835
g18
V23354
p44836
stp44837
a((dp44838
g2
(lp44839
Vprotobuf-net can be compatible with both binary (Google's efficient "protocol buffers" format) and xml at the same time on the same class definitions*
p44840
aVIt can even work without any changes if your xml is element based and includes attributes like  (to work, it needs to be able to find a unique number per property, you see)
p44841
aVNote that if you use inheritance () you'll need to add additional attributes (again, to nominate a number - via the similar )
p44842
aVOtherwise, you can add additional attributes, and job done; just call
p44843
aVResult: smaller, faster serialization
p44844
aV*=and as proof, this is actually how the codegen works: compile the "
p44845
aVproto" DSL to binary ("protoc"), load the binary into the object-model ("protobuf-net"), write as xml () , run through xslt to get C#
p44846
aVThe alternative might be to run the xml through an xslt into C# and compile it, but
p44847
aVugly
p44848
aVI've done this myself when absolutely needed; it was horrible enough to break reflector
p44849
aV(no, really)
p44850
as(dp44851
g18
V23354
p44852
stp44853
a((dp44854
g2
(lp44855
VCalling generic methods with reflection genuinely can be this ugly
p44856
aVTo resolve the correct  I normally try to pick the simplest unique factor and work with that - which might mean the number of generic-parameters / method-parameters, etc
p44857
aVI try to avoid having to compare the unbound generic types themselves
p44858
aVWith  in 4
p44859
aV0, I believe (although I'd need to check) that this can make many of these calls simpler (since it essentially does the method/generic resolution at runtime), but it doesn't work for extension methods ;-(
p44860
aVAnother option is , which can be a bit prettier in some ways, but you need to  it etc, and  is itself complicated
p44861
aV(actually, forget that - it is still hard)
p44862
as(dp44863
g18
V23354
p44864
stp44865
a((dp44866
g2
(lp44867
VIt is often easier to move scripts into extension-objects; you do this by exposing a regular method on a  basic object, and using  to expose it in an xslt namespace:
p44868
aVIn your xslt, you associate your namespace-alias with the namespace, and just use "alias:someFunc(
p44869
aVin the xslt
p44870
aVThis gives you better IDE support (but you can't just use xslt); example:
p44871
aVxslt:
p44872
aVxml:
p44873
as(dp44874
g18
V23354
p44875
stp44876
a((dp44877
g2
(lp44878
V1: is it the same data-context, and
p44879
aV2: is it the same entity instance (or one that looks like it)
p44880
aVThis would only happen for the same data-context, I suspect
p44881
aVIf it is the same entity, then it is already there; just call
p44882
aVOtherwise, either use a second data-context or detach the original entity
p44883
as(dp44884
g18
V23354
p44885
stp44886
a((dp44887
g2
(lp44888
VCannot reproduce:
p44889
aVWhat exact compiler version are you using
p44890
aVIs something else amiss
p44891
as(dp44892
g18
V23354
p44893
stp44894
a((dp44895
g2
(lp44896
VNice unicode glitch ;-p
p44897
aVI'm not sure why it does this, but amusingly:
p44898
aVI'm guessing this is treated a bit like the non-joining character that Jon mentioned at devdays; some string functions see it, and some don't
p44899
aVAnd if it doesn't see it, this becomes "does (some string) start with an empty string", which is always true
p44900
as(dp44901
g18
V23354
p44902
stp44903
a((dp44904
g2
(lp44905
VNo (or at least: not unless the exceptions you want to group happen to share a common base-class specific to that group, which they don't in your example); the only thing you can do in this scenario is  and do runtime testing on
p44906
aVBy the time you've done that, I expect your code is already "prettier" as-is (since, importantly, you've already refactored the handling code into a method)
p44907
aVI'd be tempted to tweak the spacing so I can focus on the important code:
p44908
aV(or something)
p44909
aVIn some ways this also ties into this question: switch / pattern matching idea
p44910
as(dp44911
g18
V23354
p44912
stp44913
a((dp44914
g2
(lp44915
VIf you want to change the type, you need to either write code, or sometimes you can serialize
p44916
aVCasting doesn't change the type (unless a custom operator has been written)
p44917
aVThe simplest option is to create it as the right type in the first place:
p44918
aVAlternatively, add a conversion operator or some other method for creating a  from a post:
p44919
aVYou can also use other tricks, like reflection-based property copies, or serialization; for example, using MiscUtil:
p44920
aVor protobuf-net (requires some extra serialization attributes):
p44921
as(dp44922
g18
V23354
p44923
stp44924
a((dp44925
g2
(lp44926
VTo avoid boxing for  / , I would use:
p44927
aVThis supports any  that implement , using  as a backup, and handles  etc (and lifted operators for ) automatically
p44928
aVThere is also  which handles comparison tests
p44929
aVThis handles  that implement , falling back to  - again handling  and lifted operators
p44930
as(dp44931
g18
V23354
p44932
stp44933
a((dp44934
g2
(lp44935
VDon't forget you can use C# in:
p44936
aVMS
p44937
aVNET (Windows)
p44938
aVNET Compact Framework (PocketPC, XBox 360)
p44939
aVSilverlight (Windows, Mac)
p44940
aVMoonlight (Mono / Linux)
p44941
aVMonoTouch (iPhone)
p44942
aVMonoDevelop (various including android)
p44943
aVMicro Framework (some watches etc)
p44944
aVNot exactly bad coverage
p44945
aVThe language has very few requirements on the runtime / OS
p44946
as(dp44947
g18
V23354
p44948
stp44949
a((dp44950
g2
(lp44951
VMy first answer would be "to reduce the complexity to the absolute minimum", but I guess you could also argue that it obfuscates the data if there is an attack surface somewhere - a dodgy router / sniffer / man-in-the-middle  - "xxxx xxxx xxxx xxxx" is almost certainly a credit card number, but "xxxxxxxxxxxxxxxx" could be a number of things
p44952
aVOf course, that won't hold back much determined hacking, and hopefully is largely mitigated by SSL etc
p44953
aVI stress, I don't think this is a good reason, but it may be a reason
p44954
as(dp44955
g18
V23354
p44956
stp44957
a((dp44958
g2
(lp44959
VIt is invaluable for library code that doesn't have any need to know about the caller - like with generics, but richer access to the data
p44960
aVExamples:
p44961
aVORMs (materialization etc)
p44962
aVserialization / deserialization
p44963
aVobject cloning / deep copy
p44964
aVUI / binding code (strictly this is ComponentModel, but you can mix the two - for example, HyperDescriptor)
p44965
aVYou should of course try to minimise the amount of reflection you do, but you can mitigate the cost by caching delegates from  /  /
p44966
as(dp44967
g18
V23354
p44968
stp44969
a((dp44970
g2
(lp44971
VFor a tree structure, what you ask for may be beyond LINQ
p44972
aVThere is , but that works by trying to add a  etc; which won't work for a tree
p44973
aVI expect that in this case, calling a UDF would be a good option (moving the interesting code to the database)
p44974
aVHow to walk the tree depends on your version etc and the exact SQL server version
p44975
aVFor example:
p44976
aVNow may the UDF to your data-context, etc
p44977
as(dp44978
g18
V23354
p44979
stp44980
a((dp44981
g2
(lp44982
VBased on the code sample, I would be a bit tempted to use the inbuilt principal / role definitions here, and some string constants:
p44983
aValthough maybe this just shifts the responsibility to creating an appropriate custom principal
p44984
as(dp44985
g18
V23354
p44986
stp44987
a((dp44988
g2
(lp44989
VYou should juts be able to use relative paths to your project root; for example:
p44990
aVThe question is: which test framework are you using
p44991
aVWith NUnit, most test-runners (in the IDE, such as TestDriven
p44992
aVNET, R#, etc) just use the project-item's properties
p44993
aVSo make sure that "Copy to Output Directory" is "Copy Always" or "Copy if Newer"
p44994
aVFor the inbuilt MSTest runner that ships with some VS SKUs, things are different; you can use either the testrunconfig or attributes on your test-fixture to tell it what to deploy
p44995
aVWhich is silly, IMO
p44996
aVFor testrunconfig, double click the testrunconfig and select "Deployment", then "Add File
p44997
aV; for attributes, you want  - as in:
p44998
as(dp44999
g18
V23354
p45000
stp45001
a((dp45002
g2
(lp45003
VEdit: Eric comments more on this here, and hints that there are some times when  is used
p45004
aValthough note that his  example isn't guaranteed ;-p
p45005
aVIn the original compiler (pre-1
p45006
aV1), the compiler did treat non-virtual instance methods (without ) as static; the problem was that this lead to some odd problems with  checking, i
p45007
ag50
aVdidn't threw an exception (for  and non-virtual method  which didn't touch )
p45008
aVWhich was bad if you ever changed the implementation of
p45009
aVWhen they investigated the cost of adding the explicit null check (i
p45010
ag50
aVnull-check then static-call), it turned out to be just the same as using a virtual-call, so they did that instead, which makes it far more flexible and predictable
p45011
aVNote that the "don't throw an exception" is also entirely the behaviour if  is an extension-method (static)
p45012
aVI think at one point you could emit IL to invoke a regular instance method via static-call, but the last time I tried I got the "oh no you don't
p45013
aVmessage from the CLR (this operation may destabilise the runtime); either they blocked this entirely, or (perhaps more likely) I borked the custom IL
p45014
as(dp45015
g18
V23354
p45016
stp45017
a((dp45018
g2
(lp45019
VYou can use LINQ:
p45020
aVThis would be simple, although it does build the hash-set multiple times; advancing all n at once (to take advantage of sorted) would be hard, but you could also build a single hash-set and remove missing things
p45021
as(dp45022
g18
V23354
p45023
stp45024
a((dp45025
g2
(lp45026
VHow are you putting the data in there
p45027
aVIf you are using regular  it should start at 1
p45028
aVYou can, however, bulk-insert into the table, or otherwise use identity-insert; in which case all bets are off:
p45029
aVwith output:
p45030
aVOr is the problem relating to  (in which case: use  instead)
p45031
as(dp45032
g18
V23354
p45033
stp45034
a((dp45035
g2
(lp45036
VIf you are spawning a child-process, it is quite hard and you'd probably need to use each browser's specific API (it won't be the same between FF and IE, for example)
p45037
aVIt doesn't help that in many cases the exe detects an existing instance and forwards the request there (so you can't trust the exit-code, since the page hasn't even been requested in the right exe yet)
p45038
aVPersonally, I try to avoid assuming any particular browser for this scenario; just launch the url:
p45039
aVThis will use the user's default browser
p45040
aVYou have to hope it appears though - you can't (reliably and robustly) check that externally without lots of work
p45041
aVOne other option is to read the data yourself () - but this may have issues with complex cookies, login, user-agent awareness, etc
p45042
as(dp45043
g18
V23354
p45044
stp45045
a((dp45046
g2
(lp45047
VI would go "S1"+"D1", or "S1"+ClickOnce; it makes for simple deployment and versioning, and is compatible with ClickOnce deployment, xcopy deployment, MSI deployment, web, etc
p45048
aVGAC is not appropriate IMO
p45049
aVRe updates; well, you'll want to test/release them individually, no
p45050
aVI have  a cascading build configured on my build server, so if I update a library dll it trickles up and rebuilds everything that uses that dll, and upwards (before anyone says: yes, it detects and eliminates cycles)
p45051
aVThe "common folder" approach has issues with dll resolution, so by itself is a real PITA
p45052
aVThe GAC approach would work, but is lots of unnecessary effort, and pretty painful to save a few duplicated dlls
p45053
aVIt is also a pain if you need to deploy to a non-admin
p45054
as(dp45055
g18
V23354
p45056
stp45057
a((dp45058
g2
(lp45059
VThe first thing I'd look at is: are they running exactly the same version of
p45060
aVNET
p45061
aVIf your server is running 2
p45062
aV0 SP1, and your "devenv" is VS2008 SP1 (i
p45063
ag50
aVNET 3
p45064
aV5 SP1), then they are not 100% the same, and there can be subtle differences even when just using the 2
p45065
aV0 dlls (i
p45066
ag50
aVthe things that have been fixed / changed in service-packs)
p45067
aVThe second thing I'd look at is: are they processing the same input data
p45068
aVThe third thing I'd look at is "culture"; is your dev machine set to French, and your server to Russian
p45069
aV(or something)
p45070
aVUnlikely in this case, but in the general case different cultures and default-encodings / codesets can make a difference
p45071
as(dp45072
g18
V23354
p45073
stp45074
a((dp45075
g2
(lp45076
VCan I query:
p45077
aVyou have a
p45078
aVyou have a , bound to a  on that table
p45079
aVon a different thread, you are updating the
p45080
aVYes, that won't work
p45081
aVForms have thread affinity, and your change events are going to be firing on the wrong thread
p45082
aVIt is not OK to just update the  on a background thread
p45083
aVIt sounds to me like you need to think about batching up the changes you want to make, and use  to ask the UI thread to make the changes; then it should work:
p45084
aVThis will involve hopping between threads (via ), hence the desire to batch the changes
p45085
as(dp45086
g18
V23354
p45087
stp45088
a((dp45089
g2
(lp45090
VIt depends on how much modification is required, how big the data is, and whether you are familiar with xslt
p45091
aVIf "not" to the last, just use  etc (last time I ran a profile,  was quicker than  for my data - run your own tests)
p45092
aVUse  / , find your node, edit it, and save it
p45093
aVIf you must use xslt, then  isn't really an option; once you've loaded it into  you might as well stay with  - I would not recommend parsing it into a second DOM
p45094
aVOf course, it makes we wonder: why modify the xml outside of xslt if you are going to use xslt; perhaps just translate during the xslt
p45095
aVTo get a 100% accurate answer for your data you'll need to profile it, of course
p45096
aVBut things such as appropriate use of xslt grouping constructs will often make a much bigger difference than  vs
p45097
as(dp45098
g18
V23354
p45099
stp45100
a((dp45101
g2
(lp45102
VThere is no inbuilt macro or similar for this
p45103
aVYour best bet might be a custom build task, such as on tigris, using the  task and  or similar
p45104
aVNot simple to get right
p45105
aVPersonally I use the repository version to update AssemblyInfo - broadly related
p45106
as(dp45107
g18
V23354
p45108
stp45109
a((dp45110
g2
(lp45111
VIf you have specific xml,  may be a poor choice - it isn't designed to give you control
p45112
aVI suspect you might need  on the service if you expect a specific xml format
p45113
aVIn this case, some  /  should give that format
p45114
aVSomething like (with  on the service-contract):
p45115
as(dp45116
g18
V23354
p45117
stp45118
a((dp45119
g2
(lp45120
VMuenchian grouping is the best approach; something like:
p45121
as(dp45122
g18
V23354
p45123
stp45124
a((dp45125
g2
(lp45126
VFirstly, don't do that; you are silently dropping the fact that you can't parse the data
p45127
aVBetter to throw an exception in this case, or handle expected scenarios (, for example)
p45128
as(dp45129
g18
V23354
p45130
stp45131
a((dp45132
g2
(lp45133
VThat is function composition, used for partial application
p45134
as(dp45135
g18
V23354
p45136
stp45137
a((dp45138
g2
(lp45139
VWorking fine for me; what is the error message
p45140
aVExample:
p45141
as(dp45142
g18
V23354
p45143
stp45144
a((dp45145
g2
(lp45146
VI believe you can just return  (for example, the root element) and it'll work
p45147
as(dp45148
g18
V23354
p45149
stp45150
a((dp45151
g2
(lp45152
VI would do something like:
p45153
as(dp45154
g18
V23354
p45155
stp45156
a((dp45157
g2
(lp45158
VIf the types are unrelated, MiscUtil has:
p45159
aVthen set manually:
p45160
aVYou could alternatively write a conversion method / operator, but you'll need to maintain it ( is automatic)
p45161
aVRe your inheritance point; I don't think that fits well here; you could do something with the partial class, but it won't work with LINQ-to-SQL any more if you do (it handles inheritance itself, and won't love you doing this)
p45162
as(dp45163
g18
V23354
p45164
stp45165
a((dp45166
g2
(lp45167
VHere, I might use  and check for :
p45168
as(dp45169
g18
V23354
p45170
stp45171
a((dp45172
g2
(lp45173
VThe simplest approach here is to add a property to the type
p45174
aVIf this is generated (perhaps EF etc) then use a :
p45175
aVIf this is a , you could add a computed column
p45176
aVIf this is a type outside of your control, it is possible to do this (directly to the type) using a custom type-descriptor (via ), but it is very hard
p45177
aVI would instead prefer to encapsulate the instance, adding pass-thru properties that mimic the encapsulated class, and adding the new one:
p45178
aVand bind to the shims instead
p45179
as(dp45180
g18
V23354
p45181
stp45182
a((dp45183
g2
(lp45184
VYes; to send data out-of-process (especially over a network) you need to serialize it
p45185
aVMostly this is implicit in
p45186
aVNET - you just tell it how
p45187
aVWith "asmx" it'll use , so not much needed (except a public )
p45188
aVWith WCF, it is best to use explicit  etc
p45189
aVNote that in both cases it uses xml-based variants; the description of "binary" is simple: everything is binary (or worse: electrons, or fields, or something) in computers
p45190
aVThe text representation is just in our imagination ;-p
p45191
aVIf you use "remoting", then it uses  by default, which is (as it suggests) a true binary formatter, but it has a few niggles of its own
p45192
aVI would draw a big distinction between using data for transport (comms etc), and for storage
p45193
aVIn the first case, it is short-lived, and you can abuse a few more SOA techiques if you absolutely must (although I try not to) - for example,  and  include type metadata, which is loosely acceptable, but can be a pain if you store it anything other than short-term
p45194
aVOnce stored, you need to be very careful that you can recreate it, and metadata/field-based storage is very brittle
p45195
aVFor storage, I stick with contract-based data:
p45196
aVxml (via , or )
p45197
aVjson
p45198
aVbinary (perhaps protobuf-net)
p45199
aV(and in the bottom case, binary means: not text-based at all)
p45200
as(dp45201
g18
V23354
p45202
stp45203
a((dp45204
g2
(lp45205
VYou can't have it treat the arguments as  (or ) and make use of the  feature at the same time
p45206
aVIt simply doesn't work
p45207
aVThe best you can do is to create an array parameter, make the array , declare an array variable and call the method passing the array, then inspect each element manually by index
p45208
aVSo: you cannot do what you want
p45209
aVEven if you could,  /  never work unless there is an exact match between data type, so it would still have to be:
p45210
aVWhich still isn't what you want
p45211
as(dp45212
g18
V23354
p45213
stp45214
a((dp45215
g2
(lp45216
VI don't know anything odd about , but you don't necessarily need the  - try:
p45217
aVStill not ideal, but it looks cleaner to me
p45218
as(dp45219
g18
V23354
p45220
stp45221
a((dp45222
g2
(lp45223
Vmost commonly to serve as a base-class or interface (some languages have a separate  construct, some don't) - it doesn't know the implementation (that is to be provided by the subclasses / implementing classes)
p45224
aVabstraction and re-use
p45225
aVwhen the base-class can provide no meaningful default-implementation for a method (but allowing subclasses to re-use the non-abstract parts of the implementation; any fields, non-abstract methods, etc)
p45226
aVFor example:
p45227
aVWhat the heck is a stream by itself
p45228
aVWhat kind of stream
p45229
aVa stream to a file
p45230
aVa network
p45231
aVa memory buffer
p45232
aVEach may have different and unrelated ways of reading / writing, but provide a common API
p45233
aVIt makes no sense to create just a , but via the  class,  you can code to the  API without knowing the details:
p45234
as(dp45235
g18
V23354
p45236
stp45237
a((dp45238
g2
(lp45239
VThe best you could do is write something that keeps a buffer (perhaps a ) of the data consumed from one and not the other (which would get messy/expensive if you advanced one iterator by 1M positions, but left the other alone)
p45240
aVI really think you would be better off rethinking the design, though, and just using  (i
p45241
ag50
aVanother ) to start again - or buffer the data (if short) in a list/array/whatever
p45242
aVNothing elegant built in
p45243
aVUpdate: perhaps an interesting alternative design here is "PushLINQ"; rather than clone the iterator, it allows multiple "things" to consume the same data-feed at the same time
p45244
aVIn this example (lifted from Jon's page) we calculate multiple aggregates in parallel:
p45245
as(dp45246
g18
V23354
p45247
stp45248
a((dp45249
g2
(lp45250
VIndeed, a dll isn't usually "executed" as such
p45251
aVThere are hosts for dlls (COM+, for example), but typically you would have either an exe (perhaps a service) or IIS (or another web-server) act as the host process
p45252
aVFor an example, see MSDN
p45253
aVFor re-use purposes it is fine to have the "real" code in the dll, and have the host exe a 5-liner that just calls into the dll (allowing you to use the dll in other scenarios)
p45254
as(dp45255
g18
V23354
p45256
stp45257
a((dp45258
g2
(lp45259
VThere is no inbuilt  extension - so just loop and update:
p45260
aVNote also that you can use  to do this in one query:
p45261
as(dp45262
g18
V23354
p45263
stp45264
a((dp45265
g2
(lp45266
VThe  achieves very little; you might as well just call:
p45267
aVRe the problem - I would guess that either  hasn't really loaded, or it is trying to load some other data lazily
p45268
aVI would suggest investigating by (in a dev session):
p45269
aVWith this, you should be able to see any extra database trips that are happning after the  but before the
p45270
aVThe point being: this data is needed for serialization, so either a: ensure it gets loaded, or b: exclude it from serialization
p45271
as(dp45272
g18
V23354
p45273
stp45274
a((dp45275
g2
(lp45276
VI think if you do custom serialization this should work - i
p45277
ag50
aVimplement
p45278
aVNot a nice option, though:
p45279
aVDo you just want to store the data
p45280
aVI can also think of a way to do this using protobuf-net (rather than , which I assume you are using)
p45281
as(dp45282
g18
V23354
p45283
stp45284
a((dp45285
g2
(lp45286
VIs this winforms
p45287
aVjust use  on the picker and you'll get the right  - no need to parse
p45288
aVUltimately, "1/12/2010" isn't "MM/dd/yyyy"; you could also try ""M/d/yyyy" as a fallback
p45289
as(dp45290
g18
V23354
p45291
stp45292
a((dp45293
g2
(lp45294
VIn C#, anonymous methods are very helpful here; perhaps there is something similar in VB
p45295
aV(my VB-fu is weak)
p45296
aVYou might also re-use the current method rather than have two; as an example:
p45297
aVNote that I've used  here deliberately - this is handled as a special case by , meaning it doesn't have to use the (very slow)
p45298
aVI could also have done the  in the anon method, but that seems to violate DRY
p45299
as(dp45300
g18
V23354
p45301
stp45302
a((dp45303
g2
(lp45304
VThe designer hates (i
p45305
ag50
aVdoesn't support) generic controls, and that isn't going to change any time soon, so don't do that
p45306
aVInstead, consider having a property (or similar) that accepts a , and do some work at runtime (reflection etc) - or: don't use the designer
p45307
aVFor example, if you have:
p45308
aVYou can use:
p45309
aVThis will give you everything you currently have (, , etc) - but it just can't do any validation at compile-time
p45310
as(dp45311
g18
V23354
p45312
stp45313
a((dp45314
g2
(lp45315
VYou can't have a type and a namespace with the same name ("CILib
p45316
aVExpress")
p45317
aVIf you want a  namespace, the simplest option is to move/rename the  type
p45318
aVYou can, however, also have nested types
p45319
aVYou could, for example, have:
p45320
aVIf separate files are a concern:
p45321
aVfile 1:
p45322
aVfile 2:
p45323
aVHowever,  directives only relate to namespaces; I don't think you could have , as that is a type not a namespace
p45324
as(dp45325
g18
V23354
p45326
stp45327
a((dp45328
g2
(lp45329
VIf you are adding ad-hoc columns, ORM gets very tricky
p45330
aVIn some ways, dropping back to / (of which I am not a fan) may be an option
p45331
aVPersonally, I would look first at other options for storing the custom data:
p45332
aVan  column
p45333
aVa set of key/value pairs against each record (in a second table)
p45334
aVsome other delimited format in a
p45335
aVDo you really have to add columns
p45336
as(dp45337
g18
V23354
p45338
stp45339
a((dp45340
g2
(lp45341
Vor (equivalent):
p45342
aVI wonder, though, if your current  code isn't already better - it doesn't buffer the ones it intends to drop, for example
p45343
as(dp45344
g18
V23354
p45345
stp45346
a((dp45347
g2
(lp45348
VIs the dll (RivWorks
p45349
aVWeb
p45350
aVService
p45351
aVdll) in the build output
p45352
aVNext, try (for the "jsonpMessageEncoding" extension):
p45353
aVNote the different spacing both in terms of  and carriage returns
p45354
aVAfter that, I would treble check the string
p45355
aVWrite a console exe that references the dll you need (RivWorks
p45356
aVWeb
p45357
aVService), and output:
p45358
aVThat is the string you want in the xml, verbatim
p45359
aVDon't include any extra whitespace in this string
p45360
as(dp45361
g18
V23354
p45362
stp45363
a((dp45364
g2
(lp45365
V is, IIRC, async
p45366
aVIt might be better here to use
p45367
aVor HTML Agility Pack /
p45368
as(dp45369
g18
V23354
p45370
stp45371
a((dp45372
g2
(lp45373
VYou could try generics, although it isn't pretty:
p45374
as(dp45375
g18
V23354
p45376
stp45377
a((dp45378
g2
(lp45379
VUltimately yes: you are talking about serialization
p45380
aVThis can take many forms, especially in
p45381
aVNET, but ultimately you need to pick between:
p45382
aVtext vs binary; direct binary tends to be smaller than text, as it usually involves less parsing etc; text (xml, json, etc) is usually represented in the stream as UTF8 (although any encoding is possible)
p45383
aVThey are broadly human-readable, and despite being more verbose can usually be compressed pretty well
p45384
aVcontract vs metadata; contract-based serializers focus on representing data - it is assumed that the other end of the pipe understands the structure, but it is not assumed that they share an implementation
p45385
aVThis has limitations in that you can't suddenly introduce some completely unexpected subclass, but makes it platform-independent
p45386
aVBy contrast, metadata-based serializers send the type information on the stream (i
p45387
ag50
aV"this is a  instance)
p45388
aVThis makes it really easy to get working, but rarely works between different platforms (and often not between versions) - and all that type information can be verbose
p45389
aVmanual vs automatic; fact: manual serializers can often be the most efficient in terms of bandwidth, since you can hand-customise the heck out of the stream - but it takes lots of effort and you need to understand serialization lots
p45390
aVAutomatic serializers are much better for general purpose uses (in reality: most scenarios)
p45391
aVAvoid manual unless you have no choice
p45392
aVAutomatic serializers handle all the complexities of worrying about different types of data, etc
p45393
aVManual serializer approaches include (just mentioning the "serializer" keyword): , , , ,
p45394
aVYou don't want to do that
p45395
aVFocusing more on the automatic serializers:
p45396
aVSince you are talking raw streams, my preference would be a binary contract-based serializer - but then, I wrote protobuf-net, so I may be biased ;-p
p45397
aVFor comparison with common RPC stacks:
p45398
aVremoting" uses
p45399
aVasmx" web-services (including WSE*) use
p45400
aVWCF can use many, most commonly  or , and sometimes  (it can also be configured to use, for example, protobuf-net)
p45401
aVI can happily write an example of using protobuf-net on a stream to represent different messages of different types, but a simple example of socket processing using protobuf-net is in one of the sample projects (here, in fact)
p45402
as(dp45403
g18
V23354
p45404
stp45405
a((dp45406
g2
(lp45407
VUntested, but something like:
p45408
aVYou pass in your table () as the , and lambdas to indicate the columns ( /  etc)
p45409
aVUpdate; tested on LINQ-to-Objects, I'm hopeful it'll work on LINQ-to-SQL as well:
p45410
as(dp45411
g18
V23354
p45412
stp45413
a((dp45414
g2
(lp45415
VThe whole point of an  it defines (only) an / API (like how a property defines /)
p45416
aVThe entire point of an event is that externally you can't do this (access the subscribers)
p45417
aVI'm guessing that in the "clock" example, the code that accesses the list is inside the type that declares the ; that is fine: inside the type, you have full access to the backing implementation (often a delegate field)
p45418
aVExternally, you should only care about your own handlers, that you already know about because you subscribed them
p45419
aVAttempts to fetch the backer exist, but it is brittle and not recommended
p45420
aVIn this case, it uses an , for example
p45421
aVWhy do you need this
p45422
aVIt usually means that you are doing something wrong (sorry, but it does)
p45423
as(dp45424
g18
V23354
p45425
stp45426
a((dp45427
g2
(lp45428
VSince  returns a , don't use  at all - just
p45429
aVWhere  is the  of paths to write, and  is the destination file
p45430
as(dp45431
g18
V23354
p45432
stp45433
a((dp45434
g2
(lp45435
VWell, , but that is a but grungy
p45436
aVI wonder if  would be better - i
p45437
ag50
aVNow calls to  /  are only included if  or  are defined as symbols in the build ("conditional compilation symbols")
p45438
aVIt also means you can switch between them by changing the configuration and defining different symbols in each
p45439
as(dp45440
g18
V23354
p45441
stp45442
a((dp45443
g2
(lp45444
VEric Lippert discusses this here; firstly, it is incorrect that "value types are stored on the stack"
p45445
aVThey sometimes are, but not as:
p45446
aVfields on a class
p45447
aVcaptured variables
p45448
aVvariables in an iterator block
p45449
aVWhen they can be stored on the stack it is a convenient way of modelling their lifetime, but it isn't required to store them on the stack
p45450
aVYou could write a compiler+CLI that doesn't have a stack, for example
p45451
as(dp45452
g18
V23354
p45453
stp45454
a((dp45455
g2
(lp45456
VUAC
p45457
aVHave you added a manifest that requests elevated access
p45458
aVOne of (don't ask me which
p45459
ag6864
aVor
p45460
aVin the manifest file ()
p45461
aVThe settings are discussed on MSDN
p45462
as(dp45463
g18
V23354
p45464
stp45465
a((dp45466
g2
(lp45467
VIs an  really
p45468
aVI might expect, for example, that (for a single grid):
p45469
aVor if you are trying to represent multiple grids:
p45470
aVAlthough I might be tempted to make it more explicit as a method:
p45471
aVNote that you don't need  for , but it makes life far more predictable, and makes it possible to use LINQ etc
p45472
as(dp45473
g18
V23354
p45474
stp45475
a((dp45476
g2
(lp45477
VIn the "Open With
p45478
aVdialog, use "Add
p45479
aVto select your editor / tool, then click "Set as Default"
p45480
aVNote that I'm assuming this is for your personal use, and not as part of a VS customisation to deploy
p45481
as(dp45482
g18
V23354
p45483
stp45484
a((dp45485
g2
(lp45486
VDefine "stable" ;-p
p45487
aVIf you mean "time in the field", then for
p45488
aVNET the order would be SOAP (asmx), WCF, REST
p45489
aVNote that there is a big shift between the data-centric REST services (typical of ADO
p45490
aVNET Data Services) and WCF / asmx, which are operation-centric
p45491
aVREST is perhaps more flexible for the caller; WCF / asmx has more rigid control (in terms of exposing discreet operations)
p45492
aVBoth have their places, but I tend to still make my default the operation-centric approach (via WCF) in most cases (a defined number of things to test, etc)
p45493
aVWCF is a bit more evolved than the original web-services offered in
p45494
aVNET, and has better WSE support (although asmx can be extended via WSE3)
p45495
aVIf you are starting today, WCF would be a better choice than asmx in most cases
p45496
as(dp45497
g18
V23354
p45498
stp45499
a((dp45500
g2
(lp45501
VDuring deserialization it (AFAIK) always uses a new object (), but to get it to substitute the objects after deserialization (but before they are returned to the caller), you can implement , like so:
p45502
aVdone
p45503
aVproof:
p45504
aVNote there are some extra notes on this for partial trust scenarios on MSDN, here
p45505
as(dp45506
g18
V23354
p45507
stp45508
a((dp45509
g2
(lp45510
VThe first thing I'd look at is a database
p45511
aVHowever, serialization is an option
p45512
aVIf you go for binary serialization, then I would avoid  - it has a tendency to get angry between versions if you change fields etc
p45513
aVXml via  would be fine, and can be side-by-side compatible (i
p45514
ag50
aVwith the same class definitions) with protobuf-net if you want to try contract-based binary serialization (giving you a flat file serializer without any effort)
p45515
as(dp45516
g18
V23354
p45517
stp45518
a((dp45519
g2
(lp45520
VIf you mean "at least one of the flags":
p45521
aValso - if you declare it as  (rather than ), you can drop the
p45522
aVIf you mean "exactly one of", I would just use a  or  etc
p45523
as(dp45524
g18
V23354
p45525
stp45526
a((dp45527
g2
(lp45528
VJust
p45529
aVdon't
p45530
aVThat isn't the job of a service
p45531
aVFor this job you should be using a user app (perhaps in their startup) that (if necessary) talks to a service via IPC
p45532
aVI'm believe the plan is to make the UI unavailable from services at some point (Vista onwards
p45533
aVI stopped doing service<=>desktop a long time ago)
p45534
aVFor considerations:
p45535
aVwhat if you have multiple users logged in (fast user switching)
p45536
aVwhat if you have multiple RDP sessions
p45537
aVWhat you are proposing only really scales to 1, and possibly not event that if you consider that "session 0" is reserved for admin use on some systems (so the interactive user isn't necessarily on session 0)
p45538
as(dp45539
g18
V23354
p45540
stp45541
a((dp45542
g2
(lp45543
VThat would certainly work - a  qualifies as a resource, etc
p45544
aVThe main benefit of  comes from the  statement, so it really depends on whether the typical use for the owner of the object is to use the object for a duration of time in a single method - i
p45545
ag50
aVIf that makes sense (perhaps a work pump), then fine;  would be helpful for the case when an exception is thrown
p45546
aVIf that isn't the typical use then other than highlighting that it needs some kind of cleanup, it isn't quite so helpful
p45547
as(dp45548
g18
V23354
p45549
stp45550
a((dp45551
g2
(lp45552
VStrictly speaking, that isn't a pure refactor, since it changes the code in a way that significantly changes the behaviour (in particular, calling )
p45553
aVI would hope that either "Resharper" or "Refactor
p45554
aVPro" would have a bulk "introduce using" (or similar)
p45555
aVI've checked on "Refactor
p45556
aVPro" (since that is what I use), and although it detects the undisposed local (at least, it does with ), it doesn't offer an automated fix (trivial to do manually, of course)
p45557
aVI would suggest:
p45558
aVcheck Resharper (there is an evaluation period)
p45559
aVif not, do it manually
p45560
as(dp45561
g18
V23354
p45562
stp45563
a((dp45564
g2
(lp45565
VNope; identical
p45566
aVis defined as an alias to , and is generally preferred, except in public method names, where you should use the proper name (, etc) - because your callers might not be C#
p45567
aVThis is more noticeable in  vs , etc
p45568
aVThere certainly isn't the Java-style boxing difference
p45569
aV(of course, if you do something like declare a more-namespace-local  that does something completely different, then there are differences, but that would be silly)
p45570
as(dp45571
g18
V23354
p45572
stp45573
a((dp45574
g2
(lp45575
VThe problem is that anything here could be an implementation detail, and it could be different between x86 / x64 / ia64, server vs workstation (very different GC profile), Mono vs MS
p45576
aVNET, OS version,
p45577
aVNET/CLI major version,
p45578
aVNET/CLI patch version, Compact Framework, Micro Framework, etc
p45579
aVI don't think you should assume any specific behaviour, other than "objects with finalizers that are not in use will probably get finalized at some point, but even that isn't guaranteed"
p45580
as(dp45581
g18
V23354
p45582
stp45583
a((dp45584
g2
(lp45585
VRather than compare to the current one, why not just let it worry about it; then it is simply a case of handling the "no context" case:
p45586
as(dp45587
g18
V23354
p45588
stp45589
a((dp45590
g2
(lp45591
VRather than having to worry about encoding, perhaps just use , and pass that  to your serialization code
p45592
aVThat will avoid this issue, and other issues (such as having to buffer very large strings for large object graphs)
p45593
aVThere is an overload that accepts an  for finer control
p45594
aVis accepted by most xml code
p45595
as(dp45596
g18
V23354
p45597
stp45598
a((dp45599
g2
(lp45600
VSure
p45601
as(dp45602
g18
V23354
p45603
stp45604
a((dp45605
g2
(lp45606
VI'm assuming you mean  in place of
p45607
aVmeans "shift left by n* bits"
p45608
aVSince you start with 1=binary 00
p45609
aV00001, if you shift left 4 times you get binary 00
p45610
aV10000 = 16 (it helps if you are familiar with binary arithmetic - otherwise "calc
p45611
aVexe" has a binary converter)
p45612
aVEach bit moves left  places, filling (on the right) with 0s
p45613
aV*=note that  is actually "mod 32" for , so (as a corner case) 1 << 33 = 2, not 0 which you might expect
p45614
aVThere is also  (right shift), which moves for the right, filling with  for s and +ve s, and  for -ve s
p45615
as(dp45616
g18
V23354
p45617
stp45618
a((dp45619
g2
(lp45620
VThis isn't an uncommon approach, especially if you do a lot of mocking; however, it has issues with:
p45621
aVdata-binding support (especially when adding rows to tables)
p45622
aVxml serialization (including comms WCF, asmx, etc), or contract-based serialization in general
p45623
aVYou need to figure out whether the advantages of mocking etc outweigh these issues
p45624
aVIt might be that you use  in most scenarios, but (for example) at the comms layer it may be simpler to use raw DTOs rather than interfaces
p45625
aVNote that I'm applying the above to classes
p45626
aVIf you involve structs, then remember that in most cases this will involve boxing too
p45627
as(dp45628
g18
V23354
p45629
stp45630
a((dp45631
g2
(lp45632
VAs a mechanism for obtaining the value fro a property, it'll work (but it won't provide any mechanism for noticing updates promptly)
p45633
aVHowever, it depends on how you intend to use it
p45634
aVTo do this conveniently you'll need to use a pile of lambdas in the code, or have some  /  code do it at runtime
p45635
aVIn most cases, something more similar to reflection would be more convenient
p45636
aVI wouldn't necessarily worry about the "value type" aspect; in most cases this isn't a bottleneck, despite the FUD - and it is generally a lot easier to handle such code with  than it is via generics or similar
p45637
aVI have some code in my IDE that demonstrates  vs raw reflection (that I intend to blog some day soon), showing how reflection-based code doesn't have to be slow (or just use )
p45638
aVThe other option is to implement the correct interfaces / add the correct events
p45639
aVPerhaps via PostSharp, perhaps via dynamic types (inheriting and overriding at runtime), perhaps with regular code
p45640
as(dp45641
g18
V23354
p45642
stp45643
a((dp45644
g2
(lp45645
g412
ag50
aVor
p45646
as(dp45647
g18
V23354
p45648
stp45649
a((dp45650
g2
(lp45651
VYou want to look for +winforms +skinning
p45652
aVI haven't tried these, but the first hits don't look bad
p45653
aVMost decent skinning tools will be paid for
p45654
as(dp45655
g18
V23354
p45656
stp45657
a((dp45658
g2
(lp45659
V has an overload that accepts two arrays; one for the keys, and one for the items
p45660
aVThe items of both are sorted according to the  array:
p45661
aVSo in your case, it sounds like you want:
p45662
as(dp45663
g18
V23354
p45664
stp45665
a((dp45666
g2
(lp45667
VThe  is sufficient
p45668
aVThe MS language spec (3
p45669
aV0) itself mentions this exact scenario in 8
p45670
aV12, without any mention of :
p45671
aVA better approach is to synchronize
p45672
aVaccess to static data by locking a
p45673
aVprivate static object
p45674
aVFor example:
p45675
as(dp45676
g18
V23354
p45677
stp45678
a((dp45679
g2
(lp45680
VFor completeness, this changes between C# 1
p45681
aV2 (with
p45682
aVNET 1
p45683
aV1) and C# 2
p45684
aV0 (with
p45685
aVNET 2
p45686
aV0)
p45687
aVSo from 2
p45688
aV0 onwards you can indeed omit the  in most scenarios
p45689
aVOddly, the tooling hasn't changed, so in the IDE if you type  the IDE will suggest (via tab tab) the full version including delegate type
p45690
as(dp45691
g18
V23354
p45692
stp45693
a((dp45694
g2
(lp45695
Vprobing paths in your app
p45696
aVconfig
p45697
aVTo borrow the example from MSDN:
p45698
as(dp45699
g18
V23354
p45700
stp45701
a((dp45702
g2
(lp45703
VFor SQL-Server, there are two common approaches for this
p45704
aVThe third option to be avoided is to pass in a  and concatenate it into a dynamic SQL statement with  - this is a clear injection attack surface
p45705
aVReasonable options:
p45706
aVpass in a  and use a UDF to split the data on a delimiter (like in this question), perhaps comma, pipe, tab, etc
p45707
aVJoin to the result:
p45708
aVuse a table-valued-parameter (SQL2008) and join directly (avoid the UDF)
p45709
as(dp45710
g18
V23354
p45711
stp45712
a((dp45713
g2
(lp45714
VWell, you could replace one  loop with a  loop, or maybe use the  that does the same internally, but ultimately LINQ is a query syntax (hence the Q), not a mutation syntax, and it isn't usually very beneficial to try to represent the updates via an anonymous method (/lambda)
p45715
aVNote that
p45716
aVNET 4
p45717
aV0 introduces  nodes that allow better support for mutation, but the C# compiler doesn't add any support for them, so  lambdas are still limited to query (at least, via the language)
p45718
aVIn short: maybe stick with what you have
p45719
aVYou could add some LINQ here, but it would radically change the code in the same way that it can for some queries, so I don't see the benefit
p45720
as(dp45721
g18
V23354
p45722
stp45723
a((dp45724
g2
(lp45725
VIt sounds like you are storing the list in session, fetching it out, and mutating it
p45726
aVActually, you might see different results if you switch from the in-process state to distributed state or database state
p45727
aVThe problem is that with in-process state there is only one list
p45728
aVIt isn't serialized / deserialized, so when you remove an item it stays removed
p45729
aVYou could clone the list easily enough:
p45730
aVwhich should solve this
p45731
aVWith the other state implementations the data is serialized, and each deserialized copy is separate, so you won't see this
p45732
aVBut I wouldn't depend on the state implementation
p45733
aVPersonally I've never understood why such behaviour-changing subtleties are allowed with state; I would have preferred it to always serialize/deserialize, even when in-process
p45734
as(dp45735
g18
V23354
p45736
stp45737
a((dp45738
g2
(lp45739
VYou might be able to do something here with AOP, perhaps via PostSharp; but unles you are going to do this lots, I'd argue in favor of keeping it simple, and just add the extra code
p45740
aVOf course, it gets more complex if you need polymorphism and need overrides to still call the method first (probably involving a public non-virtual method and a protected virtual method):
p45741
as(dp45742
g18
V23354
p45743
stp45744
a((dp45745
g2
(lp45746
VHere's a secret: I don't bother learning precedence rules
p45747
aVThey are too easy to get wrong, and it makes the next person to look at the code think too much
p45748
aVTo paraphrase: assume the person who maintains your code is an axe-wielding psycho who knows where you live
p45749
aVBe nice too them
p45750
aVSo rather than:
p45751
aVI would use:
p45752
aVOr perhaps better (subjective), break it down into separate statements The trickier question, perhaps, is what happens in "clever" lines of code that has side-effects on expressions later in the line:
p45753
aVSuch things should be used sparingly, and you should try to know what behaviour is defined and what is explicitly undefined but works (or fails) depending on the compiler you use
p45754
as(dp45755
g18
V23354
p45756
stp45757
a((dp45758
g2
(lp45759
VIs it just
p45760
aVOr is it (for example)
p45761
aVIf so:
p45762
aVNote than any 1-d array of reference-types should be castable to  (even if it is actually, for example, ), but value-types (such as ) can't be
p45763
aVSo you could try:
p45764
aVBut if it is something like , you'll have to loop manually
p45765
as(dp45766
g18
V23354
p45767
stp45768
a((dp45769
g2
(lp45770
VYes, in theory at least they should match at the binary level, but you might want to limit yourself to types that map simply to "
p45771
aVproto" - so avoid things like , inheritance (), etc
p45772
aVThis also has the advantage that you should be able to use:
p45773
aVto get the
p45774
aVproto; it () isn't 100%, but it works for basic types
p45775
aVBut ultimately, the answer is "testing and tweaking"; perhaps design for interop from the outset - i
p45776
ag50
aVtest this early
p45777
as(dp45778
g18
V23354
p45779
stp45780
a((dp45781
g2
(lp45782
VBasically, you can't do this
p45783
aVIn your operator either the input or output type must be of the type that declares the operator
p45784
aVOne option might be an extension method, but to be honest LINQ  comes pretty close by itself, as does
p45785
aVAs an example of the extension method approach:
p45786
aVor more generally with LINQ :
p45787
aVand just use
p45788
as(dp45789
g18
V23354
p45790
stp45791
a((dp45792
g2
(lp45793
VIt sounds like you want to pass an  (or similar), so that at whichever point the class wants the delegate, it can call ; for example:
p45794
aVThen  will be the instance when it is created, and it has the advantage that the compiler-generated method doesn't require any state / capture (unless you need that yourself)
p45795
aVHowever
p45796
aVI would cautious of calling a delegate inside a constructor, for the same reason that  should be treated with caution - in a deep object model the entire class may not be fully created at the point your mid-level constructor (that invokes the delegate or overridden method) fires, providing dodgy access to an object in an incomplete state
p45797
as(dp45798
g18
V23354
p45799
stp45800
a((dp45801
g2
(lp45802
VIt isn't an error, as there is a () conversion; it does generate a warning in the example given:
p45803
aVThe result of the expression is always 'false' since a value of type 'int' is never equal to 'null' of type 'int
p45804
aVIf you check the IL, you'll see that it completely removes the unreachable branch - it doesn't exist in a release build
p45805
aVNote however that it doesn't generate this warning for custom structs with equality operators
p45806
aVIt used to in 2
p45807
aV0, but not in the 3
p45808
aV0 compiler
p45809
aVThe code is still removed (so it knows that the code is unreachable), but no warning is generated:
p45810
aVWith the IL (for ) - note everything except the  (which could have side-effects) has been removed:
p45811
aVthis is basically:
p45812
as(dp45813
g18
V23354
p45814
stp45815
a((dp45816
g2
(lp45817
VIf you are always including microseconds, you might as well use the fixed number of bytes as already discussed - however, if this is general purpose serialization you might want to exploit the fact that a lot of regular values have date or hour values
p45818
aVFor protobuf-net, it marks the scale (days, hours, minutes, seconds, milliseconds or ticks) and sends the integer number of [whatever] between the given time and an arbitrary epoch (1/1/1970)
p45819
aVTo further minimise this, the integer is passed with variable length encoding, allowing most common values to be passed very conveniently
p45820
aVThis lets it send things like date values in a minimal number of bytes
p45821
as(dp45822
g18
V23354
p45823
stp45824
a((dp45825
g2
(lp45826
VHow about:
p45827
aVwhich sorts the existing list, or:
p45828
aVwhich creates a second list
p45829
as(dp45830
g18
V23354
p45831
stp45832
a((dp45833
g2
(lp45834
VAnother possible option (that avoids LINQ, for better or worse):
p45835
aVHowever, if you just need to know if it is there - perhaps short-circuit
p45836
as(dp45837
g18
V23354
p45838
stp45839
a((dp45840
g2
(lp45841
VIt sounds to me like a borked designer surface
p45842
aVhave you hit save and rebuilt it
p45843
aVPerhaps close the IDE, reopen it, and check that your carefully designed form is still pretty
p45844
aVBTW, when using  you should also use  (since it doesn't  itself when shown with ):
p45845
as(dp45846
g18
V23354
p45847
stp45848
a((dp45849
g2
(lp45850
VAlthough you can do this in some contexts, the result is largely meaningless
p45851
aVAs has been noted, References are not addresses - or at least, they don't have to be
p45852
aVSo what you are attempting, even if it works, isn't guaranteed over all implementations, and isn't usually particularly useful
p45853
aVIf you don't pin, the value isn't reliable, and if you do pin you change the very thing you are reporting
p45854
aVReally, you should be using different tools outside the language for this
p45855
aVwindbg+SOS, for example
p45856
as(dp45857
g18
V23354
p45858
stp45859
a((dp45860
g2
(lp45861
V is re-entrant, so it sounds like the thread with your  method has failed to release a lock
p45862
aVSo when it asks for the lock () it gets the lock (incrementing the counter by another one)
p45863
aVAll other threads will be denied
p45864
aVYou will need to debug where the lock gets taken and held
p45865
aVI have checked and double checked the pairings of TryEnter and Exit \u2013 the methods always release the lock when the critical section ends
p45866
aVsorry, but I think you're going to treble-check
p45867
aVIn particular, unlike ,  won't have any special exception handling
p45868
aVYour code should look like:
p45869
aVAlso - ensure that you never reasign your  in the code, as this won't unlock the correct object
p45870
aV(or similar using a flag, especially in
p45871
aVNET 4
p45872
aV0 where there are new overloads for  etc)
p45873
as(dp45874
g18
V23354
p45875
stp45876
a((dp45877
g2
(lp45878
VIt is common for property changes (via ) to detect and ignore changes that do nothing, so in the line:
p45879
aVI expect that  is already , so nothing happened
p45880
aVNo code executed except to test the reference
p45881
aVChecking in reflector confirms this ():
p45882
aVSo it only does anything when the reference is updated
p45883
aVAdditionally, since  doesn't implement the necessary binding interfaces, the grid has no idea that the list contents have been changed, hence the error
p45884
aVNow contrast:
p45885
aVHere, the  has changed, as  is an entirely new object
p45886
aVThis causes the entire grid to rebind
p45887
aVAnother option is to use , or to remove from the  (rather than the ) which should operate in both directions
p45888
as(dp45889
g18
V23354
p45890
stp45891
a((dp45892
g2
(lp45893
VWith :
p45894
aVor with :
p45895
as(dp45896
g18
V23354
p45897
stp45898
a((dp45899
g2
(lp45900
VVariables
p45901
aV(obviously you need to  and  /  these too)
p45902
as(dp45903
g18
V23354
p45904
stp45905
a((dp45906
g2
(lp45907
VTo talk to different databases / connections, you'll need a distributed transaction via TransactionScope; fortunately, this is actually easier than db-transactions (although you need a reference to System
p45908
aVTransactions
p45909
aVdll):
p45910
aVAdditionally,  nest naturally, and  enlists automatically, making it really easy to use
p45911
as(dp45912
g18
V23354
p45913
stp45914
a((dp45915
g2
(lp45916
V is only used by (for example) serialization APIs (like ), and some UI elements (like )
p45917
aVIt doesn't set the value itself; you must use a constructor for that:
p45918
aVor set the field manually, i
p45919
ag50
aVnot using an automatically implemented-property:
p45920
as(dp45921
g18
V23354
p45922
stp45923
a((dp45924
g2
(lp45925
VIn many cases, you can use the  constructor-overload that accepts a  to specify this extra name information (for example, passing a new ) - however, this doesn't work for arrays AFAIK
p45926
aVI expect for the  example it would be simpler to just write it manually
p45927
aVIn most cases,  is a lot of extra work - I avoid it as far as possible for reasons like this
p45928
aVSorry
p45929
as(dp45930
g18
V23354
p45931
stp45932
a((dp45933
g2
(lp45934
VWhat you are describing is the duck-typing aspect of  (there are other facets)
p45935
aVThe answer is that it could be anything:
p45936
aVa true dynamic object ()
p45937
aVany regular object, via reflection
p45938
aVA useful example (for reading properties, at least) might be an anonymous type; it could also be a COM object, for example - or (in Silverlight) an object in the html DOM
p45939
aVOr it could be your vendor's  object that doesn't implement any common interface, but is remarkably like your own  object
p45940
aVHeck, it could be an IronPyton object
p45941
as(dp45942
g18
V23354
p45943
stp45944
a((dp45945
g2
(lp45946
VI've spent quite a bit of time with  (and various other serialization APIs), and I'm pretty sure that simply: you can't
p45947
aVImplementing  is all or nothing
p45948
aVThe closest I can think of is to cheat and move all the fixed properties to a sub-object; this would give you slightly different xml - something like:
p45949
aVbut I expect it would work
p45950
aVYou would have pass-thru properties on your base object:
p45951
aVMake sense
p45952
aVYou could also mark  as , but it seems pretty redundant
p45953
aVIn your bespoke serialize method you'd use
p45954
aVEdit: Here's a working "serialize" example:
p45955
as(dp45956
g18
V23354
p45957
stp45958
a((dp45959
g2
(lp45960
VWith the inbuilt loaders there isn't much; you could, however, write an intercepting stream - load your document from this stream, and expose the  via events
p45961
ag412
ag50
aVraise an event in the  method (at intervals)
p45962
aVHere's an example that supports updates during both read and write:
p45963
as(dp45964
g18
V23354
p45965
stp45966
a((dp45967
g2
(lp45968
VHow about:
p45969
aVWorks with any type that supports  or
p45970
aVActually, with LINQ, another alternative is:
p45971
as(dp45972
g18
V23354
p45973
stp45974
a((dp45975
g2
(lp45976
VThe most efficient is to use  etc on your , but this isn't convenient, as you must use the same connection, and each  needs the transaction setting etc
p45977
aVThe simplest is , and if you are on SQL-Server 2005 or above, you will rarely notice a significant performance difference between this and :
p45978
aVHere it doesn't matter if  etc use the same connection, as  will enlist into a  automatically
p45979
aVAlternatively, let an ORM handle this for you; most will create transactions for saving a group of changes
p45980
aVOne thing to watch;  relies on services (DTC) that may not be available on all clients (since you mention WPF, which is client-side)
p45981
as(dp45982
g18
V23354
p45983
stp45984
a((dp45985
g2
(lp45986
VIn some cases, yes (not always); and despite rumour to the contrary, it is possible
p45987
aVI wrote some code for "MiscUtil" (free, etc) that does exactly this, and which works for all types with suitable operators (even your own structs and classes, or , etc)
p45988
aVThe problem here is that there is no interface that supports  etc, so until  comes along (in 4
p45989
aV0) it is tricky to do; but it can be done - here's the usage page, with a simiplfied  (the actual code in "MiscUtil" is slightly more complex):
p45990
aVAgain, a lot of this is relatively simple in 4
p45991
aV0 with , since this supports operators; however, last time I benchmarked it,  was slower than my (ab)use of
p45992
aVAs an aside, the reason that standard LINQ can provide a  /  is because of /, assisted by
p45993
as(dp45994
g18
V23354
p45995
stp45996
a((dp45997
g2
(lp45998
VDo you mean the protected  member ()
p45999
as(dp46000
g18
V23354
p46001
stp46002
a((dp46003
g2
(lp46004
VOne option here is to refactor this loop into a method ("extract method"), and use
p46005
as(dp46006
g18
V23354
p46007
stp46008
a((dp46009
g2
(lp46010
VYou could use  rather than query syntax:
p46011
aVbut personally I simply wouldn't use  here - it doesn't scale beyond 2, but this is a classic "search" pattern
p46012
aVI might use:
p46013
aVThis allows multiple conditions to be composed (in this case "AND") for a more specific query
p46014
aVYou can also do "OR" but it is slightly more complex (unless you use /, which is messy)
p46015
as(dp46016
g18
V23354
p46017
stp46018
a((dp46019
g2
(lp46020
VEach object on the managed heap can be used as a lock-object, which is a means to synchronize access between threads
p46021
aVI thought it just stops the thread until the content of {} is finished
p46022
aVWell, a  it stops other threads from acquiring the lock until the lock is released, which is most commonly at the end of a  statement (but it could also be a )
p46023
aVThe  usage is dangerous because locking is complex, and understanding exactly which threads are locking which object(s) at which time is very important to avoid deadlocks; however, if you  you aren't in control of other threads - which could also be (unexpectedly) locking the same object
p46024
aVIt is far safer to use a  field for locking
p46025
aVAs an example, if you have (in a synchronized list):
p46026
aVThen it isn't hard to imagine another bit of code also having a reference to this synchronized list, and locking on it, for example:
p46027
aVWhich is a potential deadlock; it would be much better if  didn't , but locked a private object, i
p46028
ag50
aVNow there is no risk of this issue
p46029
aVAnother issue here is that both field-like events and  cause
p46030
aVLocking on a  (for static methods) is equally dangerous for exactly the same reasons
p46031
as(dp46032
g18
V23354
p46033
stp46034
a((dp46035
g2
(lp46036
s(dp46037
g18
V23354
p46038
stp46039
a((dp46040
g2
(lp46041
VWhat is it you are using as the key
p46042
aVWhere are you getting the data from
p46043
aVIf these are words (not full setences), I'm wondering if you have a lot of duplicated keys (different  instances with the same fundamental value), in which case you might benefit from implementing a local interner to re-use the values (and let the transient copies get garbage collected)
p46044
aVInstantiate this when building the tree, and use (when you think a value is likely to be duplicated):
p46045
as(dp46046
g18
V23354
p46047
stp46048
a((dp46049
g2
(lp46050
VWell, saving data to a stream is serialization; the real trick is: what kind
p46051
aVFor example, I assume you're talking about things like  or  that require you to deserialize the whole thing, but that isn't always necessary
p46052
aVBy writing each string with a length-prefix, you should be able to seek past items you don't want pretty easily
p46053
aVThe other option is to write (separately) an index of offsets, but that is sometimes overkill
p46054
aVAs a basic example,  here is , without it reading the entire stream or deserializing the unwanted strings; note that it could be optimized by (for example) using a variable-length encoding for the  (length), which would also fix the current assumption that endianness is the same between reader and writer:
p46055
as(dp46056
g18
V23354
p46057
stp46058
a((dp46059
g2
(lp46060
VAssuming that all the items here are classes (not structs), then yes, but actually there is no need for  to be passed as ; you are already passing a reference (by value), and you aren't re-assigning the reference, so no need for  here at all
p46061
aVYour changes are preserved and available to the caller
p46062
aVFor exactly the same reason that this would work:
p46063
aVhere, because  is (presumably) a , there is only one object, and two variables that refer to the same object (at a simplified level, they are glorified pointers to the same object)
p46064
as(dp46065
g18
V23354
p46066
stp46067
a((dp46068
g2
(lp46069
VSubst  /  ( is the query,  is the current iterator item):
p46070
aVBTW, you could just use  here
p46071
as(dp46072
g18
V23354
p46073
stp46074
a((dp46075
g2
(lp46076
V1: nothing, unless you have defined a custom equality operator with params  / , in which case in one example  is null, in the other  is null
p46077
aV2: not in C#
p46078
aV3: use neither;  is never null; just  - but historically, in C/C++ the  is preferred to avoid the mistype bug ; in C# this type rarely (but sometimes) compiles, so it is less of an issue;  is clearer and IMO more common in C#
p46079
aV4: that won't compile unless you provide a subtraction operator, in which case what it returns is defined by your operator
p46080
as(dp46081
g18
V23354
p46082
stp46083
a((dp46084
g2
(lp46085
VBecause that syntax simply isn't defined
p46086
aVBesides,  evaluates as a bool, so what does  mean
p46087
aVIt isn't really an overhead; besides, you could write a utility method if you really want -  - I wouldn't myself, but hey
p46088
as(dp46089
g18
V23354
p46090
stp46091
a((dp46092
g2
(lp46093
VI wouldn't; I'd just use:
p46094
aVBut you could use:
p46095
as(dp46096
g18
V23354
p46097
stp46098
a((dp46099
g2
(lp46100
VI seem to recall that you can use vb
p46101
aVnet to write Silverlight apps; once compiled, this should be fairly portable (onto all Silverlight / Moonlight enabled browsers)
p46102
aVOf course, if you talk about web apps, the client (html) should already be portable, regardless of the server
p46103
as(dp46104
g18
V23354
p46105
stp46106
a((dp46107
g2
(lp46108
VWhat you are doing sounds a lot like how  already works, which is essentially:
p46109
aVTo avoid lots of work with alignment, using  to set the positions might help:
p46110
aVI wonder if it is easier to use  in simple circumstances, though
p46111
aVOr there are some 3rd-party versions that work similarly
p46112
as(dp46113
g18
V23354
p46114
stp46115
a((dp46116
g2
(lp46117
VYou can do that in the project properties, but not in source code
p46118
aVProject Properties => Build => Conditional compilation symbols
p46119
aVYou can specify whichever symbols you need (space delimited, but IIRC is is quite forgiving)
p46120
aVNote that  and  can also be toggled with a checkbox
p46121
aVI have some projects with multiple "release" build configurations, with different symbols in each (for building 2
p46122
aV0 vs 3
p46123
aV0 vs 3
p46124
aV5 versions - see  here)
p46125
as(dp46126
g18
V23354
p46127
stp46128
a((dp46129
g2
(lp46130
VIt sounds like the problem is that the value here is , and  isn't convertible to , since it doesn't know anything about it (but  might be convertible to )
p46131
aVGlancing through the code (reflector), there is no obvious way that  is ever going to like this usage
p46132
aVI'd be interested in knowing what grid component you are using, and where the  is coming from, because normally you would expect it to be dealing mainly to/from , via the  associated with the type or property (via )
p46133
aVSince it sounds like you have written your own , it would also be worth showing the  implementation
p46134
aVOutside the grid usage, in regular C# you should be able to do this simply by define a static conversion operator ( / )
p46135
as(dp46136
g18
V23354
p46137
stp46138
a((dp46139
g2
(lp46140
VWell, you could use  / , but  is the obvious choice here
p46141
as(dp46142
g18
V23354
p46143
stp46144
a((dp46145
g2
(lp46146
VI haven't used the SL version much, but have you tried adding  or  to your command
p46147
aV(like with )
p46148
aVThis option is shown on MSDN, so I expect it'll work
p46149
as(dp46150
g18
V23354
p46151
stp46152
a((dp46153
g2
(lp46154
VI think you need to profile to see where the bottleneck is; I expect you have unnecessary code going on in your aspx that isn't really needed for the
p46155
aVPersonally, I wouldn't use  now; I'd use a simple (but separate) page (or route, if using MVC) that just does the code needed for this work, and use jQuery to load it
p46156
as(dp46157
g18
V23354
p46158
stp46159
a((dp46160
g2
(lp46161
VWhat exactly is it you are trying to do
p46162
aVis used mainly by serialization code; outside of that you shouldn't really use it
p46163
aVIt sounds like you might just need something like , i
p46164
ag50
aV(for these types)
p46165
as(dp46166
g18
V23354
p46167
stp46168
a((dp46169
g2
(lp46170
VProtocol buffers would be a good option here
p46171
aVOn the C# side, I would recommend Jon Skeet's dotnet-protobufs for this use-case, since it has the same API on both sides (his C# version is a port of the Google Java version, part of the core distribution)
p46172
aVIf you want the C# to be more "typical
p46173
aVNET", then protobuf-net may help
p46174
aV(the wire format is obviously identical between versions; the API may vary)
p46175
aVSmall, fast, efficient, portable
p46176
aVFor info, I know that protobuf-net has
p46177
aVNET 2
p46178
aV0 support; I honestly haven't tried this on Jon's version, but I expect it would - there isn't much that you need 3
p46179
aV0/3
p46180
aV5 for in protobuf
p46181
as(dp46182
g18
V23354
p46183
stp46184
a((dp46185
g2
(lp46186
VIf nothing else, perhaps use xpath as a backup:
p46187
as(dp46188
g18
V23354
p46189
stp46190
a((dp46191
g2
(lp46192
VIf you want to run it from the exe, ClickOnce isn't quite right
p46193
aVClickOnce executes as a , and you should be able to just click the radio button (on the "Publish" tab) for "The application is available online only", which avoids any local ClickOnce install
p46194
aVOtherwise, just build as Release and take the /bin/Release output; this is your standalone exe app
p46195
aVTo get the right trust, a
p46196
aVNET exe can be executed from:
p46197
aVlocal drives
p46198
aVmapped network drives (f: etc) with the right
p46199
aVNET service pack
p46200
aVanywhere if "caspol" has been used to set a policy
p46201
as(dp46202
g18
V23354
p46203
stp46204
a((dp46205
g2
(lp46206
VWith reasonable efficiency via  (and noting that the fastest way to get data out of a  is via the  indexer):
p46207
as(dp46208
g18
V23354
p46209
stp46210
a((dp46211
g2
(lp46212
VThis should be fine
p46213
aVIf you want, you can formalise things using partial methods; declare the partial stub in one file, and implement it in the other
p46214
aVThis will quickly identify if you have two classes or one, and will highlight attempts to implement a partial method that isn't defined:
p46215
aVNote that  methods must be non-public, and can't have  or non-void return types
p46216
as(dp46217
g18
V23354
p46218
stp46219
a((dp46220
g2
(lp46221
VIf you pass a  into a , then it will copy the data initially (in the constructor), but as long as you release the  it can be garbage collected
p46222
aVInherently there is no "doubling" (especially if you can set the size correctly to start with, and write directly to the  rather than the )
p46223
aVI would entirely say switch to  (but only use  in the API - nothing moer specific; your consuming code doesn't need to know which type)
p46224
aVMost importantly, you can choose to use the  (to read directly from the socket) or  (if you want to buffer to disk), or  if you want to buffer in-process
p46225
aVYou will also need to make sure you read that volume of data via stream-based code
p46226
aVIterator blocks () can be very helpful here, as can the LINQ  methods (except for , , etc, which buffer)
p46227
aVNeither passing a  nor passing a  causes anything to get copied, as they are reference-types - the only thing copied is the reference (4 or 8 bytes, depending on x86/x64)
p46228
as(dp46229
g18
V23354
p46230
stp46231
a((dp46232
g2
(lp46233
VSomething like:
p46234
aVYou could also do something involving generics and delegates or expressions (instead of the string "ServerInfo"), but I'm not sure it is worth it
p46235
aVFor :
p46236
as(dp46237
g18
V23354
p46238
stp46239
a((dp46240
g2
(lp46241
V will be limited to the max of an array, which is 2GB (even in x64)
p46242
aVIf that isn't enough, you're using the wrong type of data storage
p46243
aVYou can save a lot of overhead by starting it the right size, though - by passing an  to the constructor
p46244
aVRe your edit - with 134217728 x Int32, that is 512MB
p46245
aVRemember that  uses a doubling algorithm; if you are drip-feeding items via  (without allocating all the space first) it is going to try to double to 1GB (on top of the 512MB you're already holding, the rest of your app, and of course the CLR runtime and libraries)
p46246
aVI'm assuming you're on x86, so you already have a 2GB limit per process, and it is likely that you have fragmented your "large object heap" to death while adding items
p46247
aVPersonally, yes, it sounds about right to start getting an out-of-memory at this point
p46248
aVEdit: in
p46249
aVNET 4
p46250
aV5, arrays larger than 2GB are allowed if the  switch is enabled
p46251
aVThe limit then is 2^31 items
p46252
aVThis might be useful for arrays of references (8 bytes each in x64), or an array of large s
p46253
as(dp46254
g18
V23354
p46255
stp46256
a((dp46257
g2
(lp46258
VWhat are the "3 lists" here
p46259
aVI can see the list of doubles
p46260
aVif the columes are dynamic, then implementing  might be useful, but I'll be honest - it is a pig to implement correctly; it would be easier to fill a
p46261
aVI've used this, for example, to transpose an array on the fly
p46262
aVIf performance is your concern, perhaps switch to virtual mode
p46263
aVThis would appear to match your use-case quite well
p46264
as(dp46265
g18
V23354
p46266
stp46267
a((dp46268
g2
(lp46269
VIn addition to the "field disambiguation" and "passing a reference of the current isntance" answers (already given), there is an additional scenario where  is necessary; to call extension methods on the current instance (I'm ignoring the usage of  in declaring an extension method, as that isn't quite the same meaning as the question):
p46270
aVTo be fair, this isn't a common scenario
p46271
aVA more likely one is simply to make code more readable, for example:
p46272
aVIn the above (or similarly for ,  etc), without the  I find it a little
p46273
aV"unbalanced"
p46274
as(dp46275
g18
V23354
p46276
stp46277
a((dp46278
g2
(lp46279
VI would imagine  would work
p46280
as(dp46281
g18
V23354
p46282
stp46283
a((dp46284
g2
(lp46285
VNo
p46286
aVThe closest you have is an  constructor, or a  constructor and a separate factory method (probably , so you haven't saved much)
p46287
as(dp46288
g18
V23354
p46289
stp46290
a((dp46291
g2
(lp46292
VThe real problem here is that you aren't using properties; you should have:
p46293
aVor
p46294
aVRe the attributes: Essentially, those attributes simply aren't supported (don't exist) for compact-framework
p46295
aVThe MSDN article you cite is for "full"
p46296
aVNET
p46297
aVIf you look at (for example) DisplayNameAttribute it makes no claim to work on CF
p46298
aVProperties etc should already be available to set at design-time; you just don't have the same level of ability to tweak the design-time experience
p46299
aVAs an aside,  is pretty uncommon in most code, but it isn't a problem
p46300
as(dp46301
g18
V23354
p46302
stp46303
a((dp46304
g2
(lp46305
VNo, that doesn't create new objects unless you use :
p46306
aVYour example shows the initializer syntax for setting properties of existing sub-objects
p46307
aVThere is also a similar syntax for calling "Add" methods on collections
p46308
aVYour code is broadly comparable to:
p46309
as(dp46310
g18
V23354
p46311
stp46312
a((dp46313
g2
(lp46314
VOoh, that is
p46315
aVnice
p46316
aVThe  methods always expect an entity type; there is no , which is a pain (but understandable, as it wants to behave as an ORM)
p46317
aVTo be honest, I would be tempted to use ADO
p46318
aVNET for the guts against this table, but if you have mapped the wide table to the  you should be able to use either regular C# or reflection
p46319
aVSince the number doesn't change, unless you have multiple tables I'd just bite the bullet and write some ugly code:
p46320
aVIf you have multiple tables
p46321
aVreflection, perhaps optimised via :
p46322
as(dp46323
g18
V23354
p46324
stp46325
a((dp46326
g2
(lp46327
VI use callbacks in a few cases where I know it will only ever fire once, and the callback is specific to a single method call (rather than to an object instance) - for example, as the return part of an async method
p46328
aVThis is particularly true of static utility methods (since you don't have an instance, and static events are deadly when used carelessly, and to be avoided), but of course the other option is to create a class instance with an event instead
p46329
as(dp46330
g18
V23354
p46331
stp46332
a((dp46333
g2
(lp46334
VExpression trees are immutable, so if it has object references in it, they will be to the original objects
p46335
aVTo deep-copy it, you'd need some kind of visitor with substitution; I have some similar code somewhere, but it is a lot of work
p46336
aVOf course, if it doesn't have object-specific references in it, you can just use it "as is" quite safely
p46337
aVAssuming you mean the  field; I'm not familiar with how you are parsing it, so I can't comment on how easy it would be to do, but a common option here is to parameterize the lambda; pass in the target object as an argument, and you can re-use the lambda with multiple different objects at runtime (as long as they are of the appropriate type)
p46338
as(dp46339
g18
V23354
p46340
stp46341
a((dp46342
g2
(lp46343
VI'm pretty sure I've heard that this is a compiler bug, fixed in the next release
p46344
aVI'm just firing up my 4
p46345
aV0 VM, with a simpler test-case:
p46346
aVworks in VS2008, but in VS2010:
p46347
aVError 1	Keyword 'this' is not available in the current context	
p46348
as(dp46349
g18
V23354
p46350
stp46351
a((dp46352
g2
(lp46353
VI wonder if this is a timing bug, perhaps related to "beforefieldinit"
p46354
aVhow are you looking at the value
p46355
aVIt is possible that the type-initializer (for ) isn't getting triggered by the VS debugger (which is peeking under the covers, so to speak)
p46356
aVEspecially since  is the default value for a field
p46357
aVThe  static field is set in the static constructor; and the time that an initializer executes is
p46358
aVvery hard to predict
p46359
aVIf you are using a debugger, all bets are off
p46360
aVThe only way to reliably check the value of this field is via code (when the CLR will run the initializer at some point before it is required):
p46361
aVDon't trust the debugger / watch windows etc
p46362
as(dp46363
g18
V23354
p46364
stp46365
a((dp46366
g2
(lp46367
VPass-thru
p46368
aVAlso, a prop called  is asking for trouble
p46369
aVit may need disambiguation against the  class in a few places
p46370
as(dp46371
g18
V23354
p46372
stp46373
a((dp46374
g2
(lp46375
VIf it was a method/prop, you could re-declare () the member without the offending attribute
p46376
aVI don't know of a way with class-level attributes
p46377
as(dp46378
g18
V23354
p46379
stp46380
a((dp46381
g2
(lp46382
VIf the format is guaranteed,  may be safer (sepcifying the pattern):
p46383
as(dp46384
g18
V23354
p46385
stp46386
a((dp46387
g2
(lp46388
VYou are removing the item during a , yes
p46389
aVSimply, you can't
p46390
aVThere are a few common options here:
p46391
aVuse  and  with a predicate
p46392
aViterate backwards by index, removing matching items
p46393
aVuse , and put matching items into a second list; now enumerate the second list and remove those items from the first (if you see what I mean)
p46394
as(dp46395
g18
V23354
p46396
stp46397
a((dp46398
g2
(lp46399
VThis is the sort of thing that might play nicely with an IoC or DI framework - having some interface that includes the database information, and have it pushed into all the callers for you
p46400
aVEven without IoC, hiding the implementation in an interface sounds like a solid plan
p46401
aVWith your  concept; a  might work but is a little hacky (and you need to be religious about cleaning the data between callers), or another option is to squirrel some information away on the , as this is relatively easily configured from both WCF (per-call) and winforms (typically per-process)
p46402
aVIn either case, be careful about any thread-switching (async, etc)
p46403
aVIn particular, note that ASP
p46404
aVNET can change threads in the middle of a single page pipeline
p46405
as(dp46406
g18
V23354
p46407
stp46408
a((dp46409
g2
(lp46410
VLINQ isn't necessarily best-suited to unknown-depth recursion; just use regular code
p46411
aVwith:
p46412
aVOr if you don't like the recursion above:
p46413
as(dp46414
g18
V23354
p46415
stp46416
a((dp46417
g2
(lp46418
VThis might be a scenario where generics helps
p46419
aVMaking the entire class generic is possible, but unfortunately the designer hates generics; don't do this, but:
p46420
aVNow  works, and  doesn't
p46421
aVLikewise, if it wasn't necessary at design time, you could have something like:
p46422
aVBut this won't help with the designer
p46423
aVYou're probably going to have to just use validation:
p46424
as(dp46425
g18
V23354
p46426
stp46427
a((dp46428
g2
(lp46429
VIsn't that block an abstraction over the database
p46430
aVWhat would the code do if it wasn't SQL-Server
p46431
aVI personally don't think it makes sense to encapsulate this in a general-purpose (and database-neutral) library
p46432
aVAlso; it is pretty basic functionality, so you shouldn't have any problem writing a method for the basic scenario that accepts a connection-string, table name, and  /
p46433
aVIn non-trivial usage is has lots of configuration options (column mapping, events, etc), and probably doesn't warrant wrapping
p46434
aVTo be honest, while I use , I don't use it often enough (or similarly enough) to warrant hiding it away
p46435
aVPerhaps just use  directly in your repository / DAL / whatever code
p46436
as(dp46437
g18
V23354
p46438
stp46439
a((dp46440
g2
(lp46441
VI might argue that the answer here generally is "don't"
p46442
aVUnless you absolutely need all the data at once, consider using a -based API (or some variant of reader / iterator)
p46443
aVThat is especially important when you have multiple parallel operations (as suggested by the question) to minimise system load and maximise throughput
p46444
aVFor example, if you are streaming data to a caller:
p46445
as(dp46446
g18
V23354
p46447
stp46448
a((dp46449
g2
(lp46450
VI was hoping that  would work, but it seems to get escaped; you could implement , but that is very tricky
p46451
aVThe following is ugly, but gives the right result (although you might get some xml whitespace differences)
p46452
as(dp46453
g18
V23354
p46454
stp46455
a((dp46456
g2
(lp46457
Vwhich has the advantage of working with any type with a type-converter (or you can add your own at runtime)
p46458
aVIt does have boxing, but really, it isn't so bad
p46459
aVIf that is your biggest problem, then you're going about this the wrong way
p46460
as(dp46461
g18
V23354
p46462
stp46463
a((dp46464
g2
(lp46465
VWell, you're using , so presumably you're using unsafe code
p46466
aVRather than treating each row origin () as a , consider treating it as an ;  arithmetic is pretty quick, and you only have to do 1/4 as much work
p46467
aVAnd for images in ARGB you might still be talking in pixels, making the math simple
p46468
as(dp46469
g18
V23354
p46470
stp46471
a((dp46472
g2
(lp46473
Vor in
p46474
aVNET 4
p46475
aV0 you could try (although I'm not sure it will compile):
p46476
as(dp46477
g18
V23354
p46478
stp46479
a((dp46480
g2
(lp46481
VOn the designer surface, click on the background (i
p46482
ag50
aVnot on any specific entity), and change the "Serialization Mode" to "Unidirectional"
p46483
aVThat should add the necessary  /  attributes to the whole model, enabling WCF
p46484
as(dp46485
g18
V23354
p46486
stp46487
a((dp46488
g2
(lp46489
VNot with an enum, but with strings - voila (enforced by the runtime, even in full-trust):
p46490
aVAll you need to do now is to represent the user as a principal
p46491
aVThis is done for you in ASP
p46492
aVNET, and there is a winform plugin (in VS2008 etc) to use ASP
p46493
aVNET for membership
p46494
aVIt can be configured for vanilla winforms and WCF, too; at the most basic level,  / :
p46495
aVBut you can write your own principal / identity models easily enough (deferred / cached access checks, for example)
p46496
as(dp46497
g18
V23354
p46498
stp46499
a((dp46500
g2
(lp46501
VI wouldn't - you'll end up with a lot of
p46502
aVIn C# 4
p46503
aV0 you have optional parameters and named arguments; wait a few more months and consider using them
p46504
aVUntil then, overloads, or pass it objects that represent the args:
p46505
as(dp46506
g18
V23354
p46507
stp46508
a((dp46509
g2
(lp46510
VGenerics don't have this type of variance; not now, and not (for value-types such as /) in 4
p46511
ag190
aVSimply,  doesn't return a
p46512
aVThe best you can do is:
p46513
aVwhich has an implicit conversion from  to  in the returned value
p46514
as(dp46515
g18
V23354
p46516
stp46517
a((dp46518
g2
(lp46519
VIf you want to talk about the amount of code saved, the biggest savers (IMO) are:
p46520
aViterator blocks
p46521
aVExample:
p46522
aVSaved:
p46523
aVwriting an  implementation
p46524
aVwriting an  implementation
p46525
aVhandling state of the enumerator; have you seen how horrible it is
p46526
aVSeriously
p46527
aVcaptured variables (anon methods / lambdas)
p46528
aVExample:
p46529
aVSaved:
p46530
aVwriting a class to hold the state
p46531
aVin complex cases, nested state
p46532
aVinitializing the state wrapper
p46533
aVwriting a method on that class
p46534
aVExpression lambda compiler
p46535
aVExample (from above):
p46536
aVSaved:
p46537
aVyeuch - lots of tree code; very, very complex; in the above I can see (in no particular order) , , , , , ,
p46538
aVcombine ;-p
p46539
as(dp46540
g18
V23354
p46541
stp46542
a((dp46543
g2
(lp46544
VIt doesn't surprise me that it is struggling
p46545
aVWith a  binding, it is going to try and find a match (meaning ) between the  of each (i
p46546
ag50
aV) and the bound property ()
p46547
aVBut it is never true that (for example) , so this will never match
p46548
aVSo it is presumably deciding that there isn't a selected item (since none match)
p46549
aVBasically, use a  here, or use  throughout
p46550
as(dp46551
g18
V23354
p46552
stp46553
a((dp46554
g2
(lp46555
VImportant: if you only need the one endian, see the pointer magic by wj32 / dtb
p46556
aVPersonally, I would be writing directly to a  (perhaps with some buffering), and re-using a shared buffer that I can generally assume is clean
p46557
aVThen you can make some shortcuts and assume index 0/1/2/3
p46558
aVCertainly don't use , as that can't be used for both little/big-endian, which you require
p46559
aVI would also be inclined to just use bit-shifting rather than unsafe etc
p46560
aVIt is actally the fastest, based on the following (so I'm glad that this is how I already do it my code here, look for ):
p46561
aVcode:
p46562
as(dp46563
g18
V23354
p46564
stp46565
a((dp46566
g2
(lp46567
VIt isn't 100% clear what you want, but I'm assuming you want the text minus markup; so:
p46568
as(dp46569
g18
V23354
p46570
stp46571
a((dp46572
g2
(lp46573
VI do this with protobuf-net, and I use a few approaches:
p46574
aVconditional compilation symbols in the project file to trigger subtle code-branches (yes, it isn't perfect, but it works)
p46575
aVre-introduction of some things; attributes might be an example here - your code can still use re-introduced attributes, even if the framework code doesn't; as a more extreme example of this, for compact framework I had to re-introduce a good chunk of the  API, which was fun
p46576
aVjust drop some things ;-p
p46577
aVHowever if you are using  (which you mention), I can see that whole approach falling apart pretty messily; component-model is complex enough already, without having to force your way through the hacks too
p46578
aVIt really depends quite how far you've gone down this road
p46579
aVMaybe 4
p46580
aV0 /  will open up some of these options again
p46581
as(dp46582
g18
V23354
p46583
stp46584
a((dp46585
g2
(lp46586
VWhere is the code sitting
p46587
aVAs a guess, I would imagine that the input stream () doesn't have an EOF (is it perhaps an incoming pipe from another process
p46588
aVor a network stream
p46589
aVand therefore you are waiting in  at the end of the current data
p46590
aVTry closing the incoming stream
p46591
aV(it might be called , but I'm not making the assumption that it is actually a file /
p46592
aVI've been bitten by such assumptions before ;-p)
p46593
aVYou also might want to think about introducing  as appropriate (, perhaps)
p46594
as(dp46595
g18
V23354
p46596
stp46597
a((dp46598
g2
(lp46599
VIt is an anonymous type, with a property called , given the value from evaluating
p46600
aVIn some cases it is an interesting way of passing a set of key/value pairs - easier than a dictionary, for example:
p46601
aVis simpler than the same with a dictionary and two records ("Forename"/"Fred", "Surname"/"Jones")
p46602
aVMVC uses this approach in a number of places to pass in semi-optional parameters (a bit like convention over configuration)
p46603
aVIt is also quite comparable to a lot of jQuery, and let's face it: most MVC users are also using jQuery, so the two approaches site quite nicely together
p46604
aVI discuss this topic (along with a  example from SO) on my blog, here: Pass data simply; learning from jQuery and ASP
p46605
aVNET MVC
p46606
as(dp46607
g18
V23354
p46608
stp46609
a((dp46610
g2
(lp46611
VHow about:
p46612
aVThe  is "one or more" (greedy) of the back-reference to the first capture-group,  (any character)
p46613
as(dp46614
g18
V23354
p46615
stp46616
a((dp46617
g2
(lp46618
VIt sounds like you need to know about the list, but not the specific types
p46619
aVThat is where the non-generic interfaces come in; try accessing the list as  (which has all the indexer / Add / Remove etc),  (for notifications), etc
p46620
aVIn the more general case there is also  /  /  etc, but I don't think you'll need those in this case
p46621
as(dp46622
g18
V23354
p46623
stp46624
a((dp46625
g2
(lp46626
VCannot reproduce (indeed, you don't actually use the extension in your xslt)
p46627
aVI tested it, adding (to the xslt):
p46628
aVand using the input xml:
p46629
aVAnd it worked fine (I changed to  to match xsd format, but it worked OK either way)
p46630
aVIf there is a problem, it is in code that you aren't showing us
p46631
as(dp46632
g18
V23354
p46633
stp46634
a((dp46635
g2
(lp46636
VHmmm
p46637
aVI thought that there were some things with  that would work, but apparently not; I'm a bit confused why you get , though - since you haven't told it about any default I would expect  to get into the output
p46638
aVIf you have some default code (or a  / ) then you could try:
p46639
aVBut again - I'm not entirely sure why you are seeing a  in the first place
p46640
aVI've just tested this with something based on the WCF template in VS2008, and it works fine:
p46641
as(dp46642
g18
V23354
p46643
stp46644
a((dp46645
g2
(lp46646
VWith , yes it is (at the end of )
p46647
aVWith , no it isn't
p46648
aVFun ;-p
p46649
aVFor ShowDialog, see MSDN:
p46650
aVBecause a form displayed as a dialog box is not closed, you must call the Dispose method of the form when the form is no longer needed by your application
p46651
aVTo prove it, though:
p46652
as(dp46653
g18
V23354
p46654
stp46655
a((dp46656
g2
(lp46657
VActually, it isn't quite true that you need
p46658
aVNET 3
p46659
aV5 for this
p46660
aVWhat you need is the  classes; you can write these for 2
p46661
aV0 (I've done it for C# 3
p46662
aV0 targetting CF, which lacks ), but is isn't very easy, and I'd question the benefit
p46663
aVIf you value your sanity, I'd say stick with strings until you upgrade to 3
p46664
ag691
aVSorry
p46665
as(dp46666
g18
V23354
p46667
stp46668
a((dp46669
g2
(lp46670
VPerhaps:
p46671
as(dp46672
g18
V23354
p46673
stp46674
a((dp46675
g2
(lp46676
VWhat is the middle  intended to do
p46677
aVYou can make it compile by:
p46678
aVOr maybe you mean:
p46679
as(dp46680
g18
V23354
p46681
stp46682
a((dp46683
g2
(lp46684
VI would be tempted to say "wait until EF in
p46685
aVNET 4
p46686
aV0", which has much improved POCO support (compared to EF current) and hopefully a POCO T4 template in VS2010
p46687
aVAt the moment SqlMetal will emit rich objects; while LINQ-to-SQL can work on POCO types, you would have to write the POCOs yourself, or use xslt / T4 / whatever on the dbml
p46688
as(dp46689
g18
V23354
p46690
stp46691
a((dp46692
g2
(lp46693
VIMO, the problem here is having a property that has non-obvious side-effects; this should be a method:
p46694
aVOtherwise bad things happen everywhere (the debugger, data-binding, etc)
p46695
aVDon't assume that somebody only reads a property once
p46696
aVThe only sensible use of side-effects in properties is things like lazy-loading, deferred initialization, etc
p46697
aVIt should still report the same value when called sequentially without any other obvious mutating calls
p46698
as(dp46699
g18
V23354
p46700
stp46701
a((dp46702
g2
(lp46703
VThis is a common but tricky question
p46704
aVPersonally I don't like overly fragmented dlls, as it makes it quite hard (IMO) to track and deploy
p46705
aVI prefer a limited number of more chunky dlls
p46706
aVIn addition to project/dll management, this also reduces the amount of work "Fusion" has to do when loading things
p46707
aVYou should obviously aim for reusable components, but just don't go mad making them too granular - consider "System
p46708
aVWindows
p46709
aVForms
p46710
aVdll", for example; quite a lot in there
p46711
aVVertically, the obvious ones to keep separate are UI / repository / logic concerns; horizontally I tend to have one column of dlls per logical area - but you can still compartmentalize that with namespaces, so you don't have to keep a dll to just one thing
p46712
as(dp46713
g18
V23354
p46714
stp46715
a((dp46716
g2
(lp46717
VIt would be easy enough to test for exactly that expression (the body will be a  with value )
p46718
aVBut in the general case
p46719
aVNo - too complex
p46720
aVwith
p46721
as(dp46722
g18
V23354
p46723
stp46724
a((dp46725
g2
(lp46726
V is used by a lot of the component-model way as a mechanism to avoid it being included
p46727
aVPerhaps the best option is to not add
p46728
aVThere are several other ways of filtering , including (in increasing complexity) , ,  - but the simplest is probably to tell  the attributes that describe things you do want (), and mark the other properties
p46729
aVNote that another option is to create a custom tab - but that is hit'n'miss in my experience
p46730
aVHere's an example using , which is used by , but not by most other bindings; it works by having a custom type-converter which excludes a specific property by name, but you could also use something like  to do the masking:
p46731
as(dp46732
g18
V23354
p46733
stp46734
a((dp46735
g2
(lp46736
V means create an element with the name from  - do you mean
p46737
as(dp46738
g18
V23354
p46739
stp46740
a((dp46741
g2
(lp46742
VAssuming you just want sequential pairs (note this doesn't draw them - it just lists them):
p46743
as(dp46744
g18
V23354
p46745
stp46746
a((dp46747
g2
(lp46748
VMy first question would be; why do you need thousands of books in memory
p46749
aVThere are valid scenarios for this, but then you just have to accept the cost
p46750
aVBut for most things (searching, filtering, sorting, paging) etc you can just fetch the data page(s) you actively need from the database, which often isn't nearly as many
p46751
aVEven if you do need all of them, you don't necessarily need them at the same time - for example, you could set up an iterator block () over something like , and only process a row at a time
p46752
aVThis isn't actually as much overhead as you might think, and is commonly preferable to buffering large volumes of data
p46753
aVIf you need multiple aggregates on the streaming data (reading it only once), PushLinq can help with that for you
p46754
aVIn many other cases, it is possible to do things like aggregates inside the database; this is one of the things LINQ does nicely - letting you express an aggregate at the backend database using the object-model from your domain model
p46755
aVWhat is the specific scenario
p46756
as(dp46757
g18
V23354
p46758
stp46759
a((dp46760
g2
(lp46761
VHow are you holding your objects behind the scenes
p46762
aVDo you have a  field somewhere
p46763
aVJust serialize / deserialize that, and let it worry about it
p46764
aVTo be honest, this should just happen if you mark the custom collection wrapper as  and mark any unnecessary fields (such as ) as  (i
p46765
ag50
aVwithout you having to implement )
p46766
aVNote that in most scenarios I tend to advise against ; it is OK for sending short-lived (transient) messages, but I don't advise using it for storage purposes (in a file or in a database); you can get lots of versioning issues trying to deserialize at a later date
p46767
as(dp46768
g18
V23354
p46769
stp46770
a((dp46771
g2
(lp46772
VFrom  in your database
p46773
aVSince you can add your own errors in SQL Server (via ), there is no definitive list
p46774
aVAlso, the pre-defined list (below 50000) can differ (grow) per database version
p46775
aV(or do you just mean  on each  instance
p46776
as(dp46777
g18
V23354
p46778
stp46779
a((dp46780
g2
(lp46781
VWith LINQ:
p46782
as(dp46783
g18
V23354
p46784
stp46785
a((dp46786
g2
(lp46787
VTo avoid the hard work of implementing something like , you might do something along the lines of a semi-hidden pass-thru  property; note, however, that this doesn't quite do what you want since you can only have one root  value (not two, as per your example); you would need a list to do that
p46788
as(dp46789
g18
V23354
p46790
stp46791
a((dp46792
g2
(lp46793
Vor maybe just:
p46794
aVbtw, you'll probably want to initialise the list:
p46795
as(dp46796
g18
V23354
p46797
stp46798
a((dp46799
g2
(lp46800
s(dp46801
g18
V23354
p46802
stp46803
a((dp46804
g2
(lp46805
VUsing the iterator-block answer from here:
p46806
aVor for a list:
p46807
aVOutput:
p46808
as(dp46809
g18
V23354
p46810
stp46811
a((dp46812
g2
(lp46813
s(dp46814
g18
V23354
p46815
stp46816
a((dp46817
g2
(lp46818
VIt depends on the design, really
p46819
aVMuch recursion can be replaced with (for example) a local stack () or queue (), in which case a cancel flag can be held locally without too much pain
p46820
aVAnother option is to use some kind of progress event that allows subscribers to set a cancel flag
p46821
aVA third option is to pass some kind of context class into the function(s), with a (volatile or synchronized) flag that can be set
p46822
aVIn any of these cases you should have relatively easy access to a cancel flag to exit the recursion
p46823
aVwith (in your function that accepts the context):
p46824
aVAnother interesting option is to use iterator blocks for your long function rather than regular code; then your calling code can simply stop iterating when it has had enough
p46825
as(dp46826
g18
V23354
p46827
stp46828
a((dp46829
g2
(lp46830
VcurrSetIL
p46831
aVEmit(OpCodes
p46832
aVCall bool [mscorlib]System
p46833
aVString::IsNullOrEmpty(string);// call bool [mscorlib]System
p46834
aVString::IsNullOrEmpty(string)
p46835
aVYou need to get the  - in this case:
p46836
aVActually, though, I'd be looking into  for this - I believe there is a  for silverlight , and you don't have to learn IL
p46837
aVNote that if there are multiple overloads you generally have to do a lot more work to get the  (it just happens that  is easy to use)
p46838
aVAlso, note that "instance" methods should use ; static methods (like this one) should use
p46839
as(dp46840
g18
V23354
p46841
stp46842
a((dp46843
g2
(lp46844
VIf I interpret the question correctly, then using the code from here:
p46845
aVNote that it would also work with properties, but the  will have to throw an exception (the  applies to all)
p46846
aVFor that reason, I prefer the explicit method approach (no  on the interface)
p46847
aVIt could also be a -only property, but they are really rare:
p46848
as(dp46849
g18
V23354
p46850
stp46851
a((dp46852
g2
(lp46853
VIf you just want it to work, then perhaps:
p46854
aVThis will only include the attribute when there is a non-null value
p46855
as(dp46856
g18
V23354
p46857
stp46858
a((dp46859
g2
(lp46860
VIt depends on a few things
p46861
aVdoes the method return anything
p46862
aVin 3
p46863
aV5 can't do multiple separate "action" operations (a statement body), but you can cheat if you can do something with a fluent API:
p46864
aV(perhaps using generics to make it simpler)
p46865
aVdo you have access to 4
p46866
ag190
aVIn 4
p46867
aV0 there are additional  types allowing statement bodies and exactly what you ask for
p46868
aVI discuss some similar examples in an article here (look for , although this is based on a beta a while ago - it may have been renamed by now)
p46869
aVAlternative; since you are compiling to a delegate, consider that an  is multicast; you could build a set of simple operations, and combine them in the delegate; this would work in 3
p46870
aV5; for example:
p46871
as(dp46872
g18
V23354
p46873
stp46874
a((dp46875
g2
(lp46876
VThis is from a related (but subtly different) question, but I think the answer is pretty tidy - so I thought it warranted adding here too
p46877
aVHere's an option that uses  trees to discuss our intent, capturing the value at each node - allowing a single release:
p46878
as(dp46879
g18
V23354
p46880
stp46881
a((dp46882
g2
(lp46883
VWould it be possible to re-test with the VS2010 beta
p46884
aVThere is, IIRC, a bug with one of the  implementations re base-classes that is fixed in 4
p46885
ag190
aVYou might find it works in 4
p46886
aV0, and then the question becomes: wait until April
p46887
as(dp46888
g18
V23354
p46889
stp46890
a((dp46891
g2
(lp46892
VHow large do you consider large
p46893
aVIf you are talking sessions-state (so it doesn't go back/fore to the actual user, like view-state) then state is often a pretty good option
p46894
aVEverything except the in-process state provider uses serialization, but you can influence how it is serialized
p46895
aVFor example, I would tend to create a local model that represents just the state I care about (plus any id/rowversion information) for that operation (rather than the full domain entities, which may have extra overhead)
p46896
aVTo reduce the serialization overhead further, I would consider using something like protobuf-net; this can be used as the implementation for , allowing very light-weight serialized objects (generally much smaller than , , etc), that are cheap to reconstruct at page requests
p46897
aVWhen the page is finally saved, I would update my domain entities from the local model and submit the changes
p46898
aVFor info, to use a protobuf-net attributed object with the state serializers (typically ), you can use:
p46899
as(dp46900
g18
V23354
p46901
stp46902
a((dp46903
g2
(lp46904
VIt works fine for me (fixing the  in , the  in , and passing a  namespace-resolver), giving the category "20"
p46905
aVDo you expect something different
p46906
aVIf so, what and why
p46907
aVLikewise:
p46908
aVgives "20"
p46909
as(dp46910
g18
V23354
p46911
stp46912
a((dp46913
g2
(lp46914
VThere is no appropriate reflection object that describes (at runtime) a "file with a dozen classes"; only classes, assemblies, and (by inspection against types) namespaces
p46915
aVYou could use an assembly-level attribute, but frankly I'm not liking this approach much
p46916
aVBut something like:
p46917
aVmight work
p46918
aVYou'd still need to read the attribute manually
p46919
aVI would stick to regular configuration approaches, or if you wan't something more fluid, perhaps use an ironpython / ironruby script that you embed and execute
p46920
as(dp46921
g18
V23354
p46922
stp46923
a((dp46924
g2
(lp46925
VA cheeky option (not quite as much info though) is to assert that  returns
p46926
aVYou could write a wrapper method that forces a collection ( on each)
p46927
aVBut to be honest you might as well just call  in the unit test code:
p46928
as(dp46929
g18
V23354
p46930
stp46931
a((dp46932
g2
(lp46933
VMaybe this is the opposite of my problem here; try changing the key line to:
p46934
aVYou should be able to use this by overriding  in your data-context:
p46935
as(dp46936
g18
V23354
p46937
stp46938
a((dp46939
g2
(lp46940
VFor completeness, field-like events do have thread-safety built in, but they are alone in this
p46941
aVAutomatically implemented properties do not have any such features
p46942
aVYou can, however, do something like:
p46943
aVThe problem with this is that it will lock the , which is a bad thing
p46944
aVI would implement my own synchronization for this, personally
p46945
as(dp46946
g18
V23354
p46947
stp46948
a((dp46949
g2
(lp46950
VIn C# 4
p46951
aV0, this would just be:
p46952
aVOtherwise; reflection:
p46953
aVAnother easier approach is to have the type implement a common interface:
p46954
as(dp46955
g18
V23354
p46956
stp46957
a((dp46958
g2
(lp46959
VYou could exclude at source
p46960
as(dp46961
g18
V23354
p46962
stp46963
a((dp46964
g2
(lp46965
VWhat you are talking about here are typically handled as events in C#, for example;
p46966
aVWith subscribers
p46967
aVthe handler could be a method, but in your discussion of signatures etc, a common way of re-using existing methods with non-matching signatures is with anonymous methods:
p46968
aVYou can have a list of delegates:
p46969
aVbut this might be redundant because delegate instances are multicast - so you can do this more directly:
p46970
aVNote that more complex delegate usage might involv incoming argument values - for example:
p46971
aVBy combining things like anonymous methods (or lambdas, as above) with captured variables, the issue of signatures having to match is rarely an issue - you can just wrap with a lambda to make the signature match (adding extra values or dropping arguments, as required)
p46972
aVNote that with events (in particular) the common approach is to keep the signature:
p46973
aVwhere  - or use  which will do this for you
p46974
as(dp46975
g18
V23354
p46976
stp46977
a((dp46978
g2
(lp46979
VThe DesignOnly attribute promises to do just that
p46980
aVActually, no; it tries to make it clear when accessing it in code isn't available; if you lie (i
p46981
ag50
aVclaim that something is design-only when it is available) then you should expect it to misbehave
p46982
aVThe compiler knows what is available, and this design-only attribute is not defined in the C# spec, so it makes no difference to the compiler if you add this attribute
p46983
aVTry adding:
p46984
aVwhich the code editor (IDE) looks at (but only when using a separate assembly) - note that this doesn't stop you using it - it just hides it
p46985
aVI believe the MSDN text is trying to describe the difference between properties that actually exist on code, vs properties that only pretend to exist; you can actually do all sorts of things to make fake properties appear in the designer, and it is these pretend properties that might be marked as design-only
p46986
as(dp46987
g18
V23354
p46988
stp46989
a((dp46990
g2
(lp46991
VIf it is a direct map, you should just be able to use it directly, as long as the types as public and have public parameterless constructors, and the properties (including lists) are get/set
p46992
aVIf you need to tweak the names there is an  constructor that allows you to specify all the attributes
p46993
aVThis is ideal for your scenario, but you must cache and re-use the serializer if you use this constructor overload, otherwise you will leak memory (the dynamic assemblies are not collected)
p46994
aVHere's a full example that removes one property (), changes another to an attribute, and leaves a third as an element
p46995
aVNote also that if you only need to change things at the type level (such as ) then you can do this via the  that LINQ-to-SQL generates; for example:
p46996
as(dp46997
g18
V23354
p46998
stp46999
a((dp47000
g2
(lp47001
VIMO, the easiest answer here:
p47002
aVNow you can change ,  and  if you only need to change one dimension, or change  to change everything
p47003
aVIf you need the name  to implement an interface, then do it explicitly:
p47004
as(dp47005
g18
V23354
p47006
stp47007
a((dp47008
g2
(lp47009
VThis is necessary for scenarios such as remoting, serialization, materialization, etc
p47010
aVYou shouldn't use it blindly, but note that these facilities have always been available in any system (essentially, by addressing the memory directly)
p47011
aVReflection simply formalises it, and places controls and checks in the way - which you aren't seeing because you are presumably running at "full trust", so you are already stronger than the system that is being protected
p47012
aVIf you try this in partial trust, you'll see much more control over the internal state
p47013
aVIs it an anti-pattern
p47014
aVOnly if your code uses it inappropriately
p47015
aVFor example, consider the following (valid for a WCF data-contract):
p47016
aVIs it incorrect for WCF to support this
p47017
aVI suspect not
p47018
aVthere are multiple scenarios where you want to serialize something that isn't part of the public API, without having a separate DTO
p47019
aVLikewise, LINQ-to-SQL will materialize into private members if you so elect
p47020
as(dp47021
g18
V23354
p47022
stp47023
a((dp47024
g2
(lp47025
VIn
p47026
aVNET 4
p47027
aV0, there are inbuilt enumerable file listing methods; since this isn't far away, I would try using that
p47028
aVThis might be a factor in particular if you have any folders that are massively populated (requiring a large array allocation)
p47029
aVIf depth is the issue, I would consider flattening your method to use a local stack/queue and a single iterator block
p47030
aVThis will reduce the code path used to enumerate the deep folders:
p47031
aVIterate that, creating your s from the results
p47032
as(dp47033
g18
V23354
p47034
stp47035
a((dp47036
g2
(lp47037
VYou would need to expose those 2 properties on a type and use the  attribute to indicate that it shouldn't generate an extra element:
p47038
aVIf you want to flatten those properties onto the object itself (the  instance in my example), you would need extra code to make the object model pretend to fit what  wants, or a completely separate DTO model
p47039
as(dp47040
g18
V23354
p47041
stp47042
a((dp47043
g2
(lp47044
VHow about:
p47045
aVit uses  to avoid lots of intermediate s; I haven't tested it rigorously, but it seems to work
p47046
aVIt also tries to avoid an extra  when there are no matches
p47047
as(dp47048
g18
V23354
p47049
stp47050
a((dp47051
g2
(lp47052
VPerhaps just take off the extension first and put it back on after
p47053
aVSomething like (but add your own list of special characters):
p47054
as(dp47055
g18
V23354
p47056
stp47057
a((dp47058
g2
(lp47059
VActually  is a real type in many ways (you can use , for example), and  is not merely a compiler trick, but a runtime trick
p47060
aVBut you can indeed check the open generic type, via something like:
p47061
as(dp47062
g18
V23354
p47063
stp47064
a((dp47065
g2
(lp47066
VStarting a thread per object is not necessarily wise; you should probably have a small number of worker threads picking items off the list (or better, a ), synchronizing access to that list/queue
p47067
aVAn example of a thread-safe queue can be found in this thread
p47068
aVOnce you have a work item, there is no magic bullet for making the rest of the code you write (to process it) thread-safe
p47069
aVA sensible approach that keeps things simple is immutability - either true immutability (the items can't change), or simply don't change the object
p47070
aVYou can of course implement locking around the work item, but this only helps if all your code uses the same locking strategy, which is hard to enforce
p47071
as(dp47072
g18
V23354
p47073
stp47074
a((dp47075
g2
(lp47076
VWell, what does the binary array contain
p47077
aVIs it an existing  represented as a
p47078
aVUnlike things like  / , there is no common/shared understanding of  as
p47079
aVBut if it is a
p47080
aVNET  you could use the overload of  - but you'll need to pack the bytes into ints first; which means you need to know the endianness
p47081
aVOr is the array actually a
p47082
aVIn which case,  should help
p47083
aVHaving seen the update to the question, I suspect that you are going to have to cast this data (in TSQL) before it comes out of SQL Server, or dig out the implementation-specific encoding used to pack the data in SQL Server (which would be brittle, and IMO probably shouldn't leave the server)
p47084
aVThere is a  type, but this also doesn't accept a
p47085
as(dp47086
g18
V23354
p47087
stp47088
a((dp47089
g2
(lp47090
VI worry about the fact that  is mutable
p47091
aVIf (after adding it to the dictionary) you have changed any of the values that are used when generating  (i
p47092
ag50
aVall of them) then all bets are off and you are not guaranteed to see your item again
p47093
aVI would not make these public setters, i
p47094
ag50
aVActaully, I'd probably drop the explicit fields and use C# 3
p47095
aV0 automatically implemented properties:
p47096
aVAs an example that breaks by changing the parameter:
p47097
aVAs a final thought; if the typical usage is to lookup by , then why not use the name as the key for the internal dictionary
p47098
aVAt the moment you aren't using the dictionary properly
p47099
as(dp47100
g18
V23354
p47101
stp47102
a((dp47103
g2
(lp47104
V(note that this relies on either referential equality of the  instances, or a suitable  /  implementation on the  type)
p47105
as(dp47106
g18
V23354
p47107
stp47108
a((dp47109
g2
(lp47110
VYou need to check ,  and  - if any of these are  it will explode
p47111
aVIf these are fundamental to the object, it is usually a good idea to initialize them in the constructor, and limit whether they can be changed / set back to null
p47112
aVFor example:
p47113
aVThe advantage of this is that it is very obvious where the problem is (it will show as an , of the  argument, with the stack-trace pointing at the  constructor and whatever is calling it, etc)
p47114
as(dp47115
g18
V23354
p47116
stp47117
a((dp47118
g2
(lp47119
VThere are a few things to investigate; the first is  options; these can make a huge difference to some queries
p47120
aVLook at the  options in the trace, and repeat these when you are testing in Management Studio (or Query Analyzer)
p47121
aVNote that you'd have to look at an actual profile session to really see these (not just what your code logs)
p47122
aVThe next thing I'd look at is transactions; what transaction model are you using in your C#
p47123
aVAny
p47124
aVNone
p47125
aVWhat isolation
p47126
aVSerializable
p47127
aVPerhaps distributed
p47128
aVIt could be there is some obscure lock being held on the table
p47129
aVOf course, if locking is an issue you might see something via  /  while the query is running
p47130
as(dp47131
g18
V23354
p47132
stp47133
a((dp47134
g2
(lp47135
VUsing xml to "instruct" your app seems backwards to me
p47136
aVI'd be more inclined to use an IronPython script if that was my aim
p47137
aVXml, normally, is intended to serialize data
p47138
aVSure you can write a language via xml, but ultimately it is fighting the system
p47139
aVYou would also massively struggle to invoke methods (easy enough to set properties etc via , though)
p47140
aVHere's A 3 minute guide to embedding IronPython in a C# application to show what might, IMO, be a better way to "instruct" a C# application via a separate script file
p47141
as(dp47142
g18
V23354
p47143
stp47144
a((dp47145
g2
(lp47146
VHow about just a
p47147
as(dp47148
g18
V23354
p47149
stp47150
a((dp47151
g2
(lp47152
VThe WPFToolkit sounds like you might want to install this (at a guess)
p47153
aVThe  sounds like a different dll version; perhaps missing an overload or extension method
p47154
aVCheck the references are identical on the build server (or better: include references inside the project)
p47155
aVIt could also be the difference (say) between
p47156
aVNET 3
p47157
aV5 and
p47158
aVNET 3
p47159
aV5 SP1 (or similar), but it is hard to tell without seeing the offending line of code
p47160
as(dp47161
g18
V23354
p47162
stp47163
a((dp47164
g2
(lp47165
VAre you sure it is , and not
p47166
aVThis makes a big difference, as the existence of a non- public indexer () makes a big difference
p47167
aVThe following works fine:
p47168
as(dp47169
g18
V23354
p47170
stp47171
a((dp47172
g2
(lp47173
VThere kinda was once
p47174
aVAndy:
p47175
as(dp47176
g18
V23354
p47177
stp47178
a((dp47179
g2
(lp47180
VWhat does the graph look like
p47181
aVOne problem here is the stream; the SQL 2005 requirement is a pain, as otherwise you could write directly to , however, I don't think it would be too hard to write your own  implementation that buffers 8040 (or some multiple) bytes and writes it incrementally
p47182
aVHowever, I'm not sure that it is worth this extra complexity - I would be hugely tempted to just use a file as the scratch buffer and then (once serialized) loop over the file inserting/appending chunks
p47183
aVI don't think that the file system is going to hurt your overall performance here, and it will save you starting to write doomed data - i
p47184
ag50
aVyou don't talk to the database until you already know what data you want to write
p47185
aVIt will also help you minimise the time the connection is open
p47186
aVThe next problem is the serialization itself
p47187
aVPersonally I don't recommend using  to write to persistent stores (only for transport), since it is implementation specific both in the encoder itself, and in your types (i
p47188
ag50
aVit is brittle if you make innocent-looking changes to your data types)
p47189
aVIf your data can be represented sufficiently as a tree (rather than a full graph), I would be very tempted to try protocol buffers / protobuf-net
p47190
aVThis encoding (devised by Google) is smaller than the  output, faster both for read and write, and is contract-based rather than field-based, so you can reliably rehydrate it again later (even if you switch platform entirely)
p47191
aVThe default options mean that it has to write the object-length before each object (which might be expensive in your case), but if you have nested lists of large (deep) objects you can use grouped encoding to avoid this need - allowing it to write the stream in a forwards-only, single-pass way; here's a brief simple example using grouped encoding, but if you want to throw a more complex scenario at me, just let me know
p47192
aVNote: I do have some theories on how to hack Google's wire format to support full graphs, but it is going to need some time to try it
p47193
aVOh, re the "very large arrays" - for primitive types (not objects) yuo can use "packed" encoding for this;  - might be useful, but hard to say without visibility of your model
p47194
as(dp47195
g18
V23354
p47196
stp47197
a((dp47198
g2
(lp47199
Vnote I'm assuming you mean ; if you mean  or a reference, then you already have it:  (from ) - just check for
p47200
aVIn the case of ; you can't cast to a single non-generic type (other than ) - but you don't need to; just check that it isn't , since empty  is boxed to , and  returns  (hence it boxes the value)
p47201
aVTo clarify,  is a static utility class that is completely separate to the  struct; so you don't cast to  at all
p47202
aVAs it happens,  exists to provide things like the  that helps you work with
p47203
as(dp47204
g18
V23354
p47205
stp47206
a((dp47207
g2
(lp47208
VGetting the referenced types and members for an arbitrary assembly would be extremely hard; you'd need a deep IL tool - essentially reflector
p47209
aVByt to get the references assemblies (and watching for cyclic references, which are possible), something like:
p47210
as(dp47211
g18
V23354
p47212
stp47213
a((dp47214
g2
(lp47215
VIf the types aren't fully known up front (i
p47216
ag50
aVis only known as , and is not strictly known to be a string), use things like:
p47217
aVOf course, you could cast, but in this case you'd need a double-cast () which is ugly
p47218
aVIf you know the two objects are the same type (i
p47219
ag50
aVtwo  values), then you can use:
p47220
aVThe advantage of the above is that it avoids boxing of structs and supports lifted  operators, and  in addition to
p47221
as(dp47222
g18
V23354
p47223
stp47224
a((dp47225
g2
(lp47226
VYou might get a benefit if you can balance the time processing records against the time reading records; in which case you could use a producer/consumer setup, for example synchronized queue and a worker (or a few) dequeueing and processing
p47227
aVI might also be tempted to investigate parallel extensions; it is pertty easy to write an  version of your reading code, after which  (or one of the other  methods) should actually do everything you want; for example:
p47228
as(dp47229
g18
V23354
p47230
stp47231
a((dp47232
g2
(lp47233
VTry this iterator block version that avoids recursion and the  objects:
p47234
aVNote also that 4
p47235
aV0 has inbuilt iterator block versions (, ) that may be faster (more direct access to the file system; less arrays)
p47236
as(dp47237
g18
V23354
p47238
stp47239
a((dp47240
g2
(lp47241
VLike so
p47242
as(dp47243
g18
V23354
p47244
stp47245
a((dp47246
g2
(lp47247
VThe first char provides access (via ) to an address in memory of the fist character in the buffer
p47248
aVThe length tells it how many characters are in the , making  efficient (better than looking for a  char)
p47249
aVNote that strings can be oversized (especially if created with , and a few other scenarios), so sometimes the actual buffer is actually longer than the string
p47250
aVSo it is important to track this
p47251
aVStringBuilder, for example, actually mutates a string within its buffer, so it needs to know how much it can add before having to create a larger buffer (see , for example)
p47252
as(dp47253
g18
V23354
p47254
stp47255
a((dp47256
g2
(lp47257
VUsing the current tab control, if it is possible you'd need to hook a lot of win-32 events (there may be a pre-wrapped implementation out there)
p47258
aVAnother alternative would be a 3rd-party tabbed control replacement; I'm sure plenty of vendors will sell you one
p47259
aVIMO, you might find it less pain to look at WPF; it is a big change, but has more control over things like this
p47260
aVYou can host WPF inside winforms if needed (if you can't justify a full make-over, which is a pretty common reality)
p47261
as(dp47262
g18
V23354
p47263
stp47264
a((dp47265
g2
(lp47266
VWhat is it you actually want to do here
p47267
aVAs has been noted, you can't use  unless the type is serializable, but you would also need to consider all the things that might be contained in the container
p47268
aVThey would also need to be serializable
p47269
aVYou can get around the "must be " issue by not using , but most other serializers (for example ) would have a problem with not knowing all the subclasses up-front, and things like non-settable properties
p47270
aVIf you have the right
p47271
aVNET versions, you could also consider things like , which may provide some interesting possibilities
p47272
as(dp47273
g18
V23354
p47274
stp47275
a((dp47276
g2
(lp47277
VWell, if you bring them all back you certainly have the network costs (data transfer between the db and your
p47278
aVNET code) and materialization costs (creating the object /  representation in your DAL), so then you would definitely have some costs
p47279
aVEither way you have to consider the page size of the database
p47280
aVBut perhaps the key thing is: do you need all the data
p47281
aVIf so, there is only so much you can do
p47282
aVUsing multiple tables and introducing joins will also impact performance
p47283
aVIn most cases though, and especially ASP
p47284
aVNET, the most important figures are things like:
p47285
aVwhat volume data actually goes to the client application
p47286
aV(could you use paging / ajax /
p47287
aVetc
p47288
aVwhat data is stored in session
p47289
aVhow many round-trips do you do between client and app-server
p47290
aVsince bandwidth and latency between your app-server and the client tends to be the pinch-point
p47291
aVMeasure things; make sure you are targetting the right performance concerns
p47292
aVAlso, ASP
p47293
aVNET has a reputation for not being shy about storing more than you expect in things like view-state; keep an eye on this, or switch to a more light-weight model like ASP
p47294
aVNET MVC
p47295
as(dp47296
g18
V23354
p47297
stp47298
a((dp47299
g2
(lp47300
VYou mention the trace logs - but have you enabled message logging
p47301
aVWith this in place, you should have clear visibility of the underlying messages, so you should be able to see exactly what data is on the wire
p47302
as(dp47303
g18
V23354
p47304
stp47305
a((dp47306
g2
(lp47307
VIf you want it to be atomic, you must lock something, but that doesn't mean you have to lock it for long
p47308
aVI would first try with some tightly scoped transactions, but I'd also be interested to try the update variant that does a  at the same time :
p47309
aVYou could see if that has any concurrency issues - in honesty, I don't know without checking
p47310
aVYou may need to add something like
p47311
aVPersonally, though, I'd want to keep it simple and try a serializable transaction
p47312
aVAlso note that this doesn't guarantee which record you will get (first
p47313
aVlast
p47314
as(dp47315
g18
V23354
p47316
stp47317
a((dp47318
g2
(lp47319
VI'm not sure that is a good idea; the synchronization would be a nightmare, and you'd need to use a key that didn't risk keeping all the objects alive forever (don't use the object-reference)
p47320
aVBetter to use a property bag inside the object, or wrap your object in something else that provides the missing properties
p47321
aVYou could also use inheritance, but that has more limitations (you can encapsulate a sealed type or an interface)
p47322
aVYou can forward the members if you really want:
p47323
as(dp47324
g18
V23354
p47325
stp47326
a((dp47327
g2
(lp47328
VUse different variables, or simply don't use all the columns
p47329
aVYou can't change the schema of a table variable mid-query
p47330
aVFor info, if you are migrating some #temp_table code, then note that this is also a bad idea here, as it can force recompiles
p47331
aVPlus mixing DDL and DML is never a great idea
p47332
as(dp47333
g18
V23354
p47334
stp47335
a((dp47336
g2
(lp47337
VAre generics an option
p47338
aVHere's a cheeky hack that hunts the  method and calls it via a (cached) delegate:
p47339
as(dp47340
g18
V23354
p47341
stp47342
a((dp47343
g2
(lp47344
VIs  null
p47345
aVYou might need to select-single with the query
p47346
aVFor info,  means all anchors at the root
p47347
aVdoes  work
p47348
aVThere is also  which might be easier - i
p47349
ag50
as(dp47350
g18
V23354
p47351
stp47352
a((dp47353
g2
(lp47354
VWell, a simple way would be a static constructor on your service class
p47355
aVPresumably global
p47356
aVasax works too
p47357
aVYet another route would be to write and register an http-module that listens to startup
p47358
as(dp47359
g18
V23354
p47360
stp47361
a((dp47362
g2
(lp47363
VYour  property will be fine in LINQ-to-Objects, but as the message states, it will have no clue what to do with this if it needs to create TSQL
p47364
aVIt can't read through your C# code (IL at the time) to infer meaning
p47365
aVAt best there may be something you can do with some function that returns an  of some form, but it won't be fun to work with
p47366
aVBasically, when interacting with the ORM you can only talk in terms of things it already knows about
p47367
aVYou could possibly map a UDF to the data-context and use that, but again - not pretty
p47368
aVTo work with , you'd need to use  and self-rolled lambdas (when combining them to do interesting things like comparing them to an expected value); it really isn't going to be nice
p47369
aVI could probably get an example together, but frankly I think your DAL/repository should just not use these extra properties, but limit itself to using the ORM properties instead
p47370
aVEven if it violates a little DRY
p47371
as(dp47372
g18
V23354
p47373
stp47374
a((dp47375
g2
(lp47376
VWell, you could write it in LINQ query syntax with a  and a , but I'm not sure it is a big change; I'd be more interested in knowing if the lookup is unnecessary:
p47377
aVto:
p47378
aVOther than that, I'm not sure it is worth the bother of changing it; I'd probably leave it as:
p47379
as(dp47380
g18
V23354
p47381
stp47382
a((dp47383
g2
(lp47384
VThis would really depend on the exact scenario (that is vague), but the most likely cause would be different assembly references / versions
p47385
aVPerhaps you have some "top level" code that references version "A" of a dll, and references a library which references version "B" of a similar dll; then:
p47386
aVwould have the  (on the left) from "A", with  the  from "B"
p47387
aVTry ensuring that all your projects are using the same version of all the assemblies you rely on
p47388
aVAnother scenario is the same name in different namespaces, but that is a bit of an obvious one, and I suspect the error message would make this obvious
p47389
aVThere are some other scenarios where types with the same names in the same namespace (but different assemblies) conflict with eachother; here "extern aliases" can help, but are a complete PITA to work with
p47390
as(dp47391
g18
V23354
p47392
stp47393
a((dp47394
g2
(lp47395
VWhat are "objects" if not a mechanism for describing "data"
p47396
aVBut I digress - I suspect I would look at a TCP socket between the two
p47397
aVIf the data is very basic, then fine - just write directly to the stream; if there is any complexity, perhaps use something like "protocol buffers" to provide an easy way of reading/writing dense data to a stream without having to write every last byte yourself
p47398
aVI think microsecond delays are going to be a challenge for any approach here
p47399
aVwill millisecond delays do
p47400
as(dp47401
g18
V23354
p47402
stp47403
a((dp47404
g2
(lp47405
VCannot reproduce; it works fine for me; you should be testing the  and type of , btw - but that isn't stopping it calling
p47406
aVDo you have a complete example (perhaps based on the following) that shows it not calling
p47407
as(dp47408
g18
V23354
p47409
stp47410
a((dp47411
g2
(lp47412
VI can't remember whether  buffers - you could overwrite a single
p47413
aVBut to be honest there is very little overhead from an extra object here
p47414
aVHow big are the packets
p47415
aV(putting it into a  will clone the )
p47416
aVI'd be tempted to use the simplest thing that works and see if there is a real problem
p47417
aVProbably the one change I would make is to introduce  (since they are ):
p47418
as(dp47419
g18
V23354
p47420
stp47421
a((dp47422
g2
(lp47423
VHow about switching to LINQ-to-Objects for the projection:
p47424
as(dp47425
g18
V23354
p47426
stp47427
a((dp47428
g2
(lp47429
VYou should still be able to do the same;  (including the SqlMetal generated ones) include constructor overloads that accept a connection string
p47430
aVJust fetch the string you want from  (or whatever) and pass it in
p47431
aVActually, if you don't mind hacking the DBML directly, it does actually support reading from  directly; the problem is that the IDE designer hates this, and breaks it every time you look at it
p47432
aVWhich is a shame (discussed here)
p47433
as(dp47434
g18
V23354
p47435
stp47436
a((dp47437
g2
(lp47438
VThis is pretty-much what the dynamic LINQ library (one of the
p47439
aVNET 3
p47440
aV5 samples) does
p47441
aVThe source is all available, or for usage see here
p47442
aVYou should be able to trace the code that parses the strings into s
p47443
aVOf course, it isn't hard to split on  and assemble it manually; I have a dynamic  implementation here that does this
p47444
as(dp47445
g18
V23354
p47446
stp47447
a((dp47448
g2
(lp47449
VIt looks like the default implementation () is to use ; the "unidirectional" stuff is an instruction to a different serializer (), and doesn't add
p47450
aV(Note: I've added a memo to myself to try to write a protobuf-net transcoder for memcached; that would be cool and would fix most of this for free)
p47451
aVI haven't tested, but a few options present themselves:
p47452
aVwrite a different transcoder implementation that detects  and uses , and hook this transcoder
p47453
aVadd  to your types via a partial class (I'm not convinced this will work due to the LINQ field types not being serializable)
p47454
aVadd an  implementation in a partial class that uses
p47455
aVlike 3, but using protobuf-net, which a: works with "unidirectional", and b: is faster and smaller than
p47456
aVwrite a serializable DTO and map your types to that
p47457
aVThe last is simple but may add more work
p47458
aVI'd be tempted to to look at the 3rd option first, as the 1st involves rebuilding the provider; the 4th option would also definitely be on my list of things to test
p47459
aVI struggled with 3, due to the DCS returning a different object during deserialization; I switched to protobuf-net instead, so here's a version that shows adding a  to your existing  type that makes it work with
p47460
aVActually, I suspect (with evidence) this will also make it much efficient (than raw ), too:
p47461
as(dp47462
g18
V23354
p47463
stp47464
a((dp47465
g2
(lp47466
VNo, basically
p47467
aVAfter a hunt through reflector, you only have access to the value of the member being tested - not the containing object or even the member-info of the property/field/whatever
p47468
aVWhich I agree is very limiting and frustrating, but it looks like this is fixed in 4
p47469
aV0 - my previous reply hinted at this, but in 4
p47470
aV0 there is an  overload that accepts a , which provides this infomation via
p47471
as(dp47472
g18
V23354
p47473
stp47474
a((dp47475
g2
(lp47476
VYou could just do
p47477
aVTo be honest, though, I'm not quite sure what the point is of starting a second thread and pausing the first; just do the work on the original thread
p47478
aVThe problem with the code is possibly that  is being held in a register; try marking it as , or alternatively use a  at both places that access this variable
p47479
aVEven better would be to use a  or similar, and open it from the activation code
p47480
as(dp47481
g18
V23354
p47482
stp47483
a((dp47484
g2
(lp47485
VIt could have an  setter, or it could be that the  is passed into the constructor and set there
p47486
aVOr it could use reflection to set the field directly (or call an otherwise unavailable accessor), but I rather doubt it
p47487
as(dp47488
g18
V23354
p47489
stp47490
a((dp47491
g2
(lp47492
VI guess it would depend a bit on what you want to validate, and for what purpose
p47493
aVIf it is intended for interop to other systems, then validating via xsd is a reasonable idea not least because you can use  to write your classes for you from the xsd (you can also generate xsd from xml or dll, but it isn't as accurate)
p47494
aVLikewise you can use  (appropriately configured) to check against xsd,
p47495
aVIf you just want valid
p47496
aVNET objects, I'd be tempted to leave the serialized form as an implementation detail, and write some C# validation code - perhaps implementing , or using data-annotations
p47497
as(dp47498
g18
V23354
p47499
stp47500
a((dp47501
g2
(lp47502
VAs presented, that will be an anonymous type, which can be accessed (even easier in 4
p47503
aV0 via ) but it is ugly to do so
p47504
aVIt also currently suffers from ambiguity over when the data access happens, as the LINQ is deferred, meaning that if you pass that query into the view, you are really doing you data access during the view (and not inside the controller)
p47505
aVI would be tempted to create a class to represent the data (essentially a view-model), and return a list of the entities (not a deferred query)
p47506
as(dp47507
g18
V23354
p47508
stp47509
a((dp47510
g2
(lp47511
VWell, the version in the question:
p47512
aVwould definitely be worse, as you should test for  first (not second) - ideally short-circuiting on  so you don't attempt to call
p47513
aVBut generally I'd just use
p47514
aVYou could always write an extension method to make it less verbose if you want (you can call extension methods on  values)
p47515
as(dp47516
g18
V23354
p47517
stp47518
a((dp47519
g2
(lp47520
VHere's the thing
p47521
aVI've written a fair amount of serialization code (including a lot of xml processing), and I find myself in exactly the same boat as you
p47522
aVI have a very simple piece of guidance, therefore: don't
p47523
aVI'll happily use  as a way to write xml quickly, but I'd walk over hot coals before choosing to implement  another time - I'd simply write a separate  and map the data into that; it also means the schema (for "mex", "wsdl", etc) comes for free
p47524
as(dp47525
g18
V23354
p47526
stp47527
a((dp47528
g2
(lp47529
VThe old way of doing this is to write a class to represent the state, and put the method there:
p47530
as(dp47531
g18
V23354
p47532
stp47533
a((dp47534
g2
(lp47535
VIn your exmaple,  is not the root; are you trying to rename the array
p47536
aVI would write a wrapper:
p47537
as(dp47538
g18
V23354
p47539
stp47540
a((dp47541
g2
(lp47542
VYou say that  works; does your base-class name the known types
p47543
aVYou might also want to look at
p47544
aVIn general, WCF isn't going to like the interface-based approach (), as it is going to want to know exactly what to expect from the data it is (de)serializing; I would expect it to work fine with the above and using  on the API
p47545
as(dp47546
g18
V23354
p47547
stp47548
a((dp47549
g2
(lp47550
VWhile WCF may not be as complete in Mono, Mono 2
p47551
aV6 provides everything required for silverlight / moonlight, so a WCF-based implementation should be perfectly feasible
p47552
aVAs long as you don't try anything exotic (different transports, inspectors etc) it should be more than sufficient to provide an RPC stack that is reliable between windows / mono / etc
p47553
aVThe key difference between WCF and remoting is in usage - remoting is based abound an object that pretends to be at a different end, where-as WCF is based around a service; the point being you should base your interactions around discrete methods (rather than accessing properties etc) - this also has the advantage of helping making it explicit when you are crossing the boundary
p47554
aVAnother option would be to write a very basic socket server; very lightweight, and you could use something like protobuf-net to provide a portable (cross-platform) serializer implementation (you shouldn't really trust  between the two - it is
p47555
aVflakey)
p47556
aVIn short - I wouldn't build around  at all; I would write a service layer, something like:
p47557
aVand abstract these details away from the caller
p47558
aVIf you end up using WCF, then that is all you need; and for existing remoting support I would write an  implementation that encapsulates (privately) the whole  story
p47559
aVDitto if I wrote a socket server
p47560
as(dp47561
g18
V23354
p47562
stp47563
a((dp47564
g2
(lp47565
VGoogle's protocol buffers provides a C++ implementation in the core package; as a nice benefit, you can then share this data with lots of other languages - but you will be limited to using the generated types rather than your own (which some serialization engines in other languages support)
p47566
aVIn reality this isn't a problem, as (if necessary) you can just treat the generated types as a DTO that twin to your actual domain objects
p47567
as(dp47568
g18
V23354
p47569
stp47570
a((dp47571
g2
(lp47572
VWhich SQL dialect
p47573
aVHere's some TSQL, but I'm vague to the actual question ("every person with manager name"); if you mean "given a manager name, list the people (reports)", then:
p47574
aVIf you mean "list the people, along with their manager's name", then:
p47575
as(dp47576
g18
V23354
p47577
stp47578
a((dp47579
g2
(lp47580
VWell, the actual packets kind of are (they could all take different routes, for example), but at some point you're going to want a stream where you read the data out in the same order you put it in - that being a key point of TCP
p47581
aVHow else would you do this
p47582
aVYou could always use separate sockets to give additional parallelism
p47583
aVOr have I misunderstood your meaning
p47584
aVSome network protocols do offer "broadcast", but this is not always available (for example many network devices such will deliberately be configured to block UDP broadcasts)
p47585
as(dp47586
g18
V23354
p47587
stp47588
a((dp47589
g2
(lp47590
VIf is entirely possible that they pick different versions - overload resolution is a complex area that is defined in great detail in spec documents
p47591
aVFor example,  you need to specify in what order to consider use of generics, use of implicit cases / conversions / boxing, etc
p47592
aVAlso - remember that in C#  must be explicit, so the  version isn't even a valid overload from the code
p47593
aVIn VB it is implicit, and (via the generic version) can use an exact match without any conversions / casts / etc
p47594
aVConfusingly, it can be that overload resolution comes before accessibility checks, so the  thing (by itself) isn't surprising
p47595
aVI also don't think intellisense necessarily defines the version actually being invoked - just the overload*s* that are available
p47596
as(dp47597
g18
V23354
p47598
stp47599
a((dp47600
g2
(lp47601
VFor a simplistic approach:
p47602
aVpersonally I'd try and do some kind of lazy loading, but IIRC this involves adding dummy nodes with the standard
p47603
as(dp47604
g18
V23354
p47605
stp47606
a((dp47607
g2
(lp47608
VFrom the question it sounds like you are loading all the data from the database into this  for each request; if that is the case that would explain things - you only want to fetch out the bare minimum of data from the database, via "WHERE" clauses etc
p47609
aVBeyond that; you're probably going to need to profile
p47610
aVPut in some trace points that allow you to see where the time is being spent
p47611
aVIt could be anywhere, but this  sounds an odd thing for ajax (JSON or xml would be the obvious choices, ultimately serialized as part of http/encoding)
p47612
aVOh; and  data (such as ) is a big no-no on a web-service; you're either going to corrupt it horribly, or serialize your requests (scaling to 1 user)
p47613
as(dp47614
g18
V23354
p47615
stp47616
a((dp47617
g2
(lp47618
VI'm not sure we can answer that unless you state how you are storing (in the xml) these facts
p47619
aVPersonally, though, I think I'd just test it in javascript - i
p47620
ag50
aVask selectDOG / selectCAT what options are selected and selectively submit
p47621
as(dp47622
g18
V23354
p47623
stp47624
a((dp47625
g2
(lp47626
VIMO, since you can't predict what you can/can't do after an OOM (so you can't reliably process the error), or what else did/didn't happen when unrolling the stack to where you are (so the BCL hasn't reliably processed the error), your app must now be assumed to be in a corrupt state
p47627
aVIf you "fix" your code by handling this exception you are burying your head in the sand
p47628
aVI could be wrong here, but to me this message says BIG TROUBLE
p47629
aVThe correct fix is to figure out why you have chomped though memory, and address that (for example, have you got a leak
p47630
aVcould you switch to a streaming API
p47631
aVEven switching to x64 isn't a magic bullet here; arrays (and hence lists) are still size limited; and the increased reference size means you can fix numerically fewer references in the 2GB object cap
p47632
aVIf you need to chance processing some data, and are happy for it to fail: launch a second process (an  isn't good enough)
p47633
aVIf it blows up, tear down the process
p47634
aVProblem solved, and your original process/ is safe
p47635
as(dp47636
g18
V23354
p47637
stp47638
a((dp47639
g2
(lp47640
VIf the types exist then this gets very tricky; you can't add actual properties to an existing type, but if the code that *inspects *the values uses  (which most data-binding does) then you can add properties sort of via custom s - either by implementing  (which requires that you do something at build), or
p47641
aVBoth are very complex, and both also demand that you have somewhere handy to put the extra data (a property-bag)
p47642
aVNote that in 4
p47643
aV0,  may have some usefulness here
p47644
aVIf you want to avoid this, then just wrap the types in something that looks similar but with extra properties
p47645
aVIt'll get the job done while retaining sanity
p47646
as(dp47647
g18
V23354
p47648
stp47649
a((dp47650
g2
(lp47651
VYou mention conversion; have you tried creating it as a VB
p47652
aVNET assembly
p47653
aVIf the code isn't too complex (and doesn't rely on things like COM+) you may well be able to migrate it to VB
p47654
aVNET without too much bother
p47655
aVObviously that won't magically refactor the code to use full OO idioms, but it may be close enough to get it to compile, and then you can reference the dll from your C# (or other
p47656
aVNET language) code
p47657
as(dp47658
g18
V23354
p47659
stp47660
a((dp47661
g2
(lp47662
VA property by itself doesn't provide anywhere to put the data - you need the field () for storage, but it entirely correct to hide that behind a property for many, many reasons
p47663
aVIn C# 3
p47664
aV0 you can reduce this to:
p47665
aVWhich will do much of the same
p47666
aVNote that exposing an array itself may be problematic, as there is no mechanism for protecting data in an array - at least with an  you could (if needed) add extra code to sanity check things, or could make it immutable
p47667
aVI'm not saying this needs fixing, but it is something to watch
p47668
as(dp47669
g18
V23354
p47670
stp47671
a((dp47672
g2
(lp47673
VI am not aware of any thread-safety specific attributes, simply because it is generally too complex
p47674
aVAnd "testing" threaded code (with addition of extra  etc) is a common cause of heisenbugs
p47675
aVYou could look at "CHESS"
p47676
aVIt isn't a silver bullet, but it may be helpful
p47677
as(dp47678
g18
V23354
p47679
stp47680
a((dp47681
g2
(lp47682
VAttributes can only use constant strings, so no: you can't do this (you would have to use the pre-combined version, or literal concatenation - not )
p47683
aVYou could use the test-project deployment settings too (testrunconfig
p47684
aV, but frankly I prefer to use the NUnit approach of just marking the file (in the csproj, like normal) for deployment
p47685
aVI have yet to figure out why MS added a separate way of defining this
p47686
as(dp47687
g18
V23354
p47688
stp47689
a((dp47690
g2
(lp47691
VThat  method is a really expensive way to grow an array, especially when  is designed to address this; and the other replies are right: you must check the number of bytes read:
p47692
aVOf course, you could just read directly from the stream (pass it to your reader)
p47693
aVAlso - if your serialization is too big, you might consider alternative encoders, such as protobuf-net (although this will change the code a little)
p47694
aVThis may fix the problem with a huge object
p47695
as(dp47696
g18
V23354
p47697
stp47698
a((dp47699
g2
(lp47700
VCapturing  first avoids a corner-case of running it at around midnight
p47701
as(dp47702
g18
V23354
p47703
stp47704
a((dp47705
g2
(lp47706
VThe  field is persisted for the duration of your , and it is cached when first created:
p47707
aVActually, there is an edge case when it could run twice (or more), but it is unlikely
p47708
aVThis is a pretty common pattern for deferred initialization, and is used pretty much identically in a number of places in the BCL
p47709
aVNote that if it had to happen at most once, it would need either synchronization ( etc) or something like a nested class with a static initializer
p47710
as(dp47711
g18
V23354
p47712
stp47713
a((dp47714
g2
(lp47715
VWhy do you need to know the list of keywords
p47716
aVa: they don't change very often, and b: for any regular code (I'm excluding things like "sql server management studio") you can just use square brackets:
p47717
as(dp47718
g18
V23354
p47719
stp47720
a((dp47721
g2
(lp47722
VIt seems to work well enough for stackoverflow ;-p Especially if you use compiled queries, this is unlikely to be your bottleneck, compared (for example) to appropriate DB design and fetching the right columns / rows, and avoiding n+1 loading
p47723
as(dp47724
g18
V23354
p47725
stp47726
a((dp47727
g2
(lp47728
VWhich do you expect it to return: the identity of the caller
p47729
aVor the identity of the service account that is running the web-service
p47730
aVIn most cases the windows identity would depend on how the server is configured; is it using impersonation
p47731
aVPlus are you passing the callers identity over when calling the service
p47732
aVFor example,  or
p47733
aVAnd is the service configured to recognise the users claims
p47734
aVGenerally I try not to use impersonation; it requires elevation at the server, doesn't support all environments, and can have a big impact on the effectiveness of pooling - so I wouldn't expect the windows identity to flow, but if you are passing the callers identity in some form I might expect the "principal" () to represent the caller
p47735
aVI can't remember from asmx, but with WCF you can write your own code to setup the principal from your own authentication scheme if you want
p47736
as(dp47737
g18
V23354
p47738
stp47739
a((dp47740
g2
(lp47741
VSince you have rules out a shared DTO assembly (why, btw
p47742
aV, the simplest option in this case looks to be to generate the types in different C# namespaces (i
p47743
ag50
aVtwo calls to ), and map the data between the two
p47744
aVEssentially: treat the DTOs from the two services as coincidentally similar
p47745
aVYou can use things like automapper to reduce the work, or you could juts serialize from type A and deserialize into type B (assuming the actual data namespaces etc are identical)
p47746
as(dp47747
g18
V23354
p47748
stp47749
a((dp47750
g2
(lp47751
VYou mention an exception during (de)serialization; what you have should work OK (at least, according to how you define the question)
p47752
aVI wonder if you actually have:
p47753
aV(not uncommon to not want a public setter)
p47754
aVWell,  is fussy about this; you either need a public setter, or (as somebody pointed out recently) no setter; for example:
p47755
as(dp47756
g18
V23354
p47757
stp47758
a((dp47759
g2
(lp47760
VThe last time I did this, it got so thorny (some irrelevant issues involving COM+, deployment, etc tripping us up) that I actually ditched the COM boundary, and re-wrote the interface as a POX web-service talking to a handler (ashx) in the
p47761
aVNET
p47762
aVI would give serious consideration to this approach
p47763
aV(unless you need to share windows handles, or similar)
p47764
aVIf you really want a COM API, you need to generate a COM-callable wrapper; this is largely a case of:
p47765
aVensuring the necessary types / methods are public
p47766
aVmarking the assembly / types as
p47767
aVusing  to export the type library if you need
p47768
aVusing  to register the type in COM (either in the GAC or from a fixed location on a drive)
p47769
aVAfter that your VB6 should just see it as another COM package, but I strongly recommend that you limit this interface to the bare minimum; it isn't change-friendly, and the VB6-style interface forwarding (i
p47770
ag50
aVwhere you can get away with adding a method, without breaking binary compatibility) is not here
p47771
as(dp47772
g18
V23354
p47773
stp47774
a((dp47775
g2
(lp47776
VIt really depends on how complex you want to make it
p47777
aVThis is pretty much what "web folders" offered (via WebDAV), but in general it creates more problems than it will ever fix
p47778
aVI don't recommend this approach
p47779
aVYour best bet to make this simple is a dedicated client app - perhaps (although this is a dubious example) how Office talks to sharepoint
p47780
aVIn a simpler example, you could create a silverlight out-of-browser application that saved via a web-service to a site using WCF or similar
p47781
as(dp47782
g18
V23354
p47783
stp47784
a((dp47785
g2
(lp47786
VThe 2 lines, to me, only makes sense to inspect  values, i
p47787
ag50
aV(instead of )
p47788
aVOther than that, a breakpoint / watch should work fine
p47789
aVIn a release build you should find that the extra variable has been eliminated by the compiler
p47790
aVUntil it is assigned, the value is meaningless, so what purpose having an additional line to look at
p47791
aVJust use inline initialization (this also allows  if you so choose):
p47792
as(dp47793
g18
V23354
p47794
stp47795
a((dp47796
g2
(lp47797
VI've done property-bag implementations in the past, including all the muck like  /  to get it binding - and it can be a lot of work
p47798
aVEspecially if you include serialization (not including , which has its own issues)
p47799
aVThis type of dynamic object doesn't really fit very well in a generally statically typed language like C#, but it can be made to work
p47800
aVWhile I'm not their greatest fan (not even a little), could you perhaps just use  /  here
p47801
aVIt does what you ask, without the many man-hours development / debugging
p47802
as(dp47803
g18
V23354
p47804
stp47805
a((dp47806
g2
(lp47807
VI did some work pulling apart session recently, and from what I could see, the entire state object is deserialized once and once only per request
p47808
aVOf course, it is easy enough to check - just fetch it out twice and check
p47809
aVOf course, placing the value in a field between uses would save some "lookup" time, but you should only pay the deserialization cost once
p47810
aVIf you really wanted to be sure, you could also double-check this by implementing  and logging serialize / deserialize calls
p47811
as(dp47812
g18
V23354
p47813
stp47814
a((dp47815
g2
(lp47816
VYou mention "modify the object's property" in the context of a struct, but importantly a struct is not an object
p47817
aVOther people have answered as to the issue with structs being copied (and changes discarded), but to take that further the real problem here is that you have a mutable (changeable) struct at all
p47818
aVUnless you are on XNA (or similar) there is simply no need
p47819
aVIf you want to be able to change properties, make it a class:
p47820
aVThis is now a reference-type, and your changes () will be preserved through the foreach
p47821
aVIf you really want/need a struct, make it immutable:
p47822
aVNow you can't make the mistake of changing the value of a copy; you would instead have to use the indexer to swap the value ()
p47823
aVMore verbose (and you can't use ), but correct
p47824
aVBut IMO, use a class
p47825
aVStructs are pretty rare, to be honest
p47826
aVIf you aren't sure: class
p47827
as(dp47828
g18
V23354
p47829
stp47830
a((dp47831
g2
(lp47832
VFor info,  /  is not a reference-type; it is simply a "nullable type", meaning: a struct (essentially and  and a  flag) with special compiler rules (re null checks, operators, etc) and CLI rules (for boxing/unboxing)
p47833
aVThere is no "integer reference-type" in
p47834
aVNET, unless you count boxing:
p47835
aVbut this creates an unnecessary object and has lots of associated other issues
p47836
aVFor what you want,  should be ideal
p47837
aVYou could use the long-hand syntax () but IMO this is unnecessarily verbose, and I've seen it confuse people
p47838
as(dp47839
g18
V23354
p47840
stp47841
a((dp47842
g2
(lp47843
VThe "wrong" here is in creating an implementation that is buggy (although starting with a complex language is a bad idea); having a scriptable language does have some user-cases, but my view is that there already are plenty of scribt languages with reasonable implementations on multiple platforms
p47844
aVIf I needed a script language, I'd probably aim to use one of those
p47845
aVAs an aside, IIRC the C# spec calls out that the spec anticipates to be used with a compiler, but that this is not a requirement, and that a legal interpreted version would be possible
p47846
as(dp47847
g18
V23354
p47848
stp47849
a((dp47850
g2
(lp47851
VIt is here:
p47852
aVvs:
p47853
aVIn the second, you access a property, therefore you clone the struct; essentially this is the same as:
p47854
aVNote we've updated a different struct value; contrast to field access, which talks to the existing struct value
p47855
aVYet another example of why mutable structs are evil
p47856
aVDON'T DO IT
p47857
aVMake the struct immutable (no  methods, property setters, or other shenanigans)
p47858
aVOr use a class
p47859
as(dp47860
g18
V23354
p47861
stp47862
a((dp47863
g2
(lp47864
VWell, in a number of scenarios you may well need some serialization code (for whatever serialization interfaces your serializer API demands - things like  /  in
p47865
aVNET), but I guess that isn't what you mean
p47866
aVIt really depends on the scenario
p47867
aVIf you have an object model that is simple enough to allow you to use your domain model for serialization, then for small projects there may be little benefit in splitting it out - a separation of concerns issue
p47868
aVProbably
p47869
aVGoing to cause long-term pain
p47870
aVProbably not (at least, not if you use a contract-based serializer, so you can swap it without anyone noticing)
p47871
aVFor more complex models, you often will need a separate DTO model to the domain model - in which case you might need somewhere to put the conversion logic (methods / operators / etc) between domain and DTO - so that might live in there, but if you have got a separate DTO it is unlikely to have much additional logic - that logic belongs mainly in the domain model and the other business classes
p47872
as(dp47873
g18
V23354
p47874
stp47875
a((dp47876
g2
(lp47877
VYou can do that with a route-constraint, such as regex - a very similar example is here
p47878
aVSomething like:
p47879
as(dp47880
g18
V23354
p47881
stp47882
a((dp47883
g2
(lp47884
VWhich ORM framework is it
p47885
aVNote that ORM-generated types tend to be particularly obnoxious when used with , since they aren't always "POCO": they often have fields that relate to the ORM - so creating them standalone has issues
p47886
aVIn short, I'm not hugely surprised that it doesn't work in this case
p47887
aVYou might want to consider using something like , , protobuf-net, or maybe  - these all do a similar job, but because they work on public properties (rather than fields) they tend to be more effective - and indeed many have inbuilt support for these approaches for use as a DTO
p47888
as(dp47889
g18
V23354
p47890
stp47891
a((dp47892
g2
(lp47893
VThe  should be extracted from the first command (,  or ) and passed into the next command
p47894
aVBy that, I mean that the  should be at the end of the first command
p47895
aVIn SQL 2008 there is additional syntax for bring values back as part of the , which makes this simpler
p47896
aVOr more efficiently: combine the commands into one to avoid round-trips
p47897
as(dp47898
g18
V23354
p47899
stp47900
a((dp47901
g2
(lp47902
VI can't explain the "C:\u005cxyz\u005cxyz
p47903
aVcore
p47904
aVdll" (except as a curiosity), but the rest is exactly what I would expect
p47905
aVThis seems all tied into code-access security
p47906
aVUntil recently, you would need to use "caspol" to configure CAS to allow you to execute the exe from any type of network share
p47907
aVThis was changed (either
p47908
aVNET 3
p47909
aV5 or
p47910
aVNET 3
p47911
aV5 SP1) such that mapped shares ("f:" etc) do get execute permission, but UNC shares do not
p47912
aVYou can use "caspol" to grant access to the UNC (like this), but IMO it is a far better option to switch to ClickOnce deployment
p47913
aVThis can still be via a network share, but it includes additional publication information that lets the runtime mount it
p47914
aVI believe it can also be used to deploy such that it works offline (when the network is unavailable) but update automatically from the share when possible I know this works for http deployment - I believe it works for network)
p47915
aVThe IDE presents this under the guise of "publish", and it is about 5 clicks all done
p47916
as(dp47917
g18
V23354
p47918
stp47919
a((dp47920
g2
(lp47921
VRounding errors happen; it isn't infinite precision
p47922
aVYou will have to test whether values are suitably close - don't just test for equality
p47923
aVIn some cases you might also see subtle differences by applying the operators in a different sequence, so you don't swamp small numbers with magnitude
p47924
as(dp47925
g18
V23354
p47926
stp47927
a((dp47928
g2
(lp47929
VNot pretty, but it works:
p47930
as(dp47931
g18
V23354
p47932
stp47933
a((dp47934
g2
(lp47935
VI wonder if it might be better to use  directly, and
p47936
aVA  quick check shows that  makes a slightly better job of it, but xml and whitespace gets tricky very quickly
p47937
as(dp47938
g18
V23354
p47939
stp47940
a((dp47941
g2
(lp47942
VWell:
p47943
aVis fairly simple, but not very efficient for huge text files
p47944
aVI'd probably use a  in most cases, to avoid excessive buffering:
p47945
as(dp47946
g18
V23354
p47947
stp47948
a((dp47949
g2
(lp47950
VYou can't really query the current value of the event's delegate, except in the code that defines the event
p47951
aVWhat is your intent here
p47952
aVNormally you shouldn't be too concerned (necessarily) with other subscribers
p47953
aVThere are ways of hacking past the encapsulation to find the current value, but they are not recommended (it just isn't a good idea)
p47954
aVIf your concern is whether you are already handling that event with that handler (i
p47955
ag50
aVyou don't want to double-subscribe, then you can always either a: fix the code so it doesn't do this, or b: cheat (C# example):
p47956
aVTo get the invocation list is
p47957
aVbrittle but doable
p47958
aVIn simple cases you can just use reflection to get the field, and snag the value
p47959
aVBut with forms etc it uses sparse techniques (to minimise the space for events without subscribers)
p47960
aVIn the case of , this is keyed via
p47961
aVIt might make more sense with an example (C#, sorry):
p47962
aVIn the case of an , the delegate is directly on a field, so less indirection is required:
p47963
as(dp47964
g18
V23354
p47965
stp47966
a((dp47967
g2
(lp47968
VThat is troublesome; to make the compiler happy you can double-cast, but that implies a box for value types:
p47969
aVIn reality, I think you may be better just using an  return type
p47970
as(dp47971
g18
V23354
p47972
stp47973
a((dp47974
g2
(lp47975
VWhy open them "as strings"
p47976
aVStrings in
p47977
aVNET are immutable, so it could get expensive if you are making lots of changes
p47978
aVThe normal approach would be to parse / deserialize the data out into an object model, and pass that object model into your forms - i
p47979
ag50
aVor similar
p47980
aVThen your form can access properties of the model:
p47981
aVor use data-binding if you really want:
p47982
aV(which will enable 1-way or 2-way binding, depending on whether your model also provides change-notifications)
p47983
as(dp47984
g18
V23354
p47985
stp47986
a((dp47987
g2
(lp47988
VYou need to pass an instance of the type into
p47989
aVIf it is a static property, pass
p47990
aVCurrently you are passing the type
p47991
aVI would expect to see (roughly):
p47992
aVNote that if you aren't sure of the type of array, you can just use  (instead of ), or for single-dimension arrays  may be useful (and will handle arrays, lists etc):
p47993
as(dp47994
g18
V23354
p47995
stp47996
a((dp47997
g2
(lp47998
VNote the conversion to
p47999
aVYou'll get an empty result if there are none (just handle that after the fact - I'm mainly illustrating how to stop the exception)
p48000
aVI also made "non-zero" use  rather than
p48001
as(dp48002
g18
V23354
p48003
stp48004
a((dp48005
g2
(lp48006
VThis kind of reverses , and is more comparable to what we did with PushLINQ - but it is a lot simpler than implementing an iterator block on the fly (through IL), while retaining blinding performance thanks to dynamic-method; the use of  is in case your data is non-orthogonal and you need multiple types through the same API:
p48007
as(dp48008
g18
V23354
p48009
stp48010
a((dp48011
g2
(lp48012
VA data-reader is a hose of data
p48013
aVIt becomes "empty" (or a better analogy: runs dry) when you consume all the data it is reading
p48014
aVIt is not a storage device (it isn't a bucket)
p48015
aVIf you want the data afterwards, store it somewhere - a  or a class model, for example
p48016
as(dp48017
g18
V23354
p48018
stp48019
a((dp48020
g2
(lp48021
VGenerics and reflection don't make good friends
p48022
aVA simpler approach here is to use the non-generic list interface:
p48023
aV(where  includes the namespace information, but doesn't have to be assembly-qualified)
p48024
aVThis is still runtime type-safe (it'll throw at runtime if it is wrong), and still adjusts the same list
p48025
aVNote also that we only look inside  directly via
p48026
as(dp48027
g18
V23354
p48028
stp48029
a((dp48030
g2
(lp48031
VThe biggest problem I see there is the use of  to implement a queue; there are performance issues doing this, as removing the first item involves copying all the data
p48032
aVAdditional thoughts; you're raising the signal even if you didn't add data, and the use of events itself may have issue with threading (there are some edge cases, even when you capture the value before the  test - plus it is possibly more overhead than using the  to do the signalling)
p48033
aVI would switch to a  which won't have this problem - or better use a pre-rolled example; for example Creating a blocking Queue in
p48034
aVNET
p48035
aV, which does exactly what you discuss, and supports any number of both producers and consumers
p48036
aVIt uses the blocking approach, but a "try" approach would be:
p48037
aVFinally - don't you "push" to a stack, not a queue
p48038
as(dp48039
g18
V23354
p48040
stp48041
a((dp48042
g2
(lp48043
VI'm guessing you read a lot more than you write
p48044
aVIf so, a  may be more appropriate to reduce blocking (take read when you just want to check for the key, and write to manipulate the data)
p48045
aVBy that I mean you could do double-checked locking with a read at first, then if it fails take a write lock, check again and add if necessary
p48046
aVAlso - the  is generally frowned upon; having a separate lock object is preferred
p48047
aVNote that to be effective, all access must respect the lock; there are some places where  is locked, and some places where it is accessed without a lock, for example; those second cases may explode in a gooey mess
p48048
aVFor example:
p48049
aVIn the above, if it is possible that two threads are looking at , then you've already failed by attempting  without the lock
p48050
aVIf another thread is mutating the state when you do this
p48051
aVboom
p48052
as(dp48053
g18
V23354
p48054
stp48055
a((dp48056
g2
(lp48057
VAs far as the dictionary / list is concerned, it can just see
p48058
aVis largely in the eye of the beholder - i
p48059
ag50
aVthe calling code; under the hood it is "object plus a little sugar"
p48060
aVSo you shouldn't see any problems here
p48061
aVProof:
p48062
as(dp48063
g18
V23354
p48064
stp48065
a((dp48066
g2
(lp48067
VIt simply isn't there - most notably, because neither is  (although you can reintroduce pieces of that if you need)
p48068
aVSimply, you'll have to limit yourself to "regular" code for data-access (LINQ-to-SQL etc) / services (ADO
p48069
aVNET Data Services etc)
p48070
aVOf course, when you have data from whatever source, you can still use , so there are plenty of local options for data query
p48071
as(dp48072
g18
V23354
p48073
stp48074
a((dp48075
g2
(lp48076
Vdone
p48077
aVThat do
p48078
aVIn particular, the C# compiler will provide the "lifted" operators to map to  for you
p48079
aVArguably, though, it might be slightly larger than just a  or single enum
p48080
aVNote: don't use , as this would actually be a boxing operation
p48081
aVIf you couldn't use  (i
p48082
ag50
aVyou wanted to implement from scratch) I would map it to an  (possibly a  enum, but I'd default to  as normal):
p48083
as(dp48084
g18
V23354
p48085
stp48086
a((dp48087
g2
(lp48088
VOriginal answer (reading the question as "in the IDE")
p48089
aVThe toolbox control lists the controls that you have registered in the IDE (or in local projects)
p48090
aVIf the 3rd-party exe contains usable controls (
p48091
aVNET or ActiveX) then:
p48092
aVright-click on the toolbox
p48093
aVclick "Choose Items
p48094
aVwait a stupid amount of time
p48095
aVbrowse to your exe
p48096
aVpick the controls
p48097
aVNote that your code will still need to be able to resolve the control at runtime, which means deploying the
p48098
aVNET assembly, or for ActiveX deploying the interop assembly and having the COM dll registered
p48099
aVRevised answer (see comment)
p48100
aVTo host a separate exe inside a running forms application is not trivial; you would have to spawn the exe () and then use win32 calls to obtain the appropriate window handle, with the intention of subclassing the window into one of your own
p48101
aVThis is a reasonable amount of work, very easy to get wrong, and very brittle (bad thins happen if you bork it)
p48102
aVPersonally: I simply wouldn't
p48103
as(dp48104
g18
V23354
p48105
stp48106
a((dp48107
g2
(lp48108
VIndeed, an expression tree should work; for basic member access (a field/property directly off the object):
p48109
aVwith
p48110
aVFrom there you can do pretty much anything; in particular you can get the / accessors (if you want to create a delegate), or use  /
p48111
aVNote that in
p48112
aVNET 4
p48113
aV0 you can set properties directly on an  (but the C# compiler doesn't add any extra support for this, so you'd need to write your own  by hand)
p48114
as(dp48115
g18
V23354
p48116
stp48117
a((dp48118
g2
(lp48119
VServiceModel is part of 3
p48120
aV0, not 3
p48121
aV5 - but either way I expect you should be able to use WSE3 to connect, since this offers WS*
p48122
aVJimmy Ziemowit has some thoughts on this here
p48123
aVIn the past I've had success simply deploying System
p48124
aVServiceModel
p48125
aVdll etc with the app onto 2
p48126
aV0 machines (back in the early days of 3
p48127
aV0); it may work for you too
p48128
aVA full 3
p48129
aV0 install is preferred, of course
p48130
as(dp48131
g18
V23354
p48132
stp48133
a((dp48134
g2
(lp48135
VYou need to add type converters / editors; a good start would be to add:
p48136
aVabove each  definition
p48137
aVFor example, the following works fine (note I changed to properties, removed the list setter, etc):
p48138
aVThe specific error message also makes me wonder if your actual type is public with a public parameterless constructor (the fact that it doesn't compile makes me suspect you haven't posted the actual code
p48139
as(dp48140
g18
V23354
p48141
stp48142
a((dp48143
g2
(lp48144
VTo raise the event,  should work fine
p48145
aVIf you want to query it you have to get more abusive and use reflection (sorry, example is C# but should be virtually identical - I'm not using any language-specific features here):
p48146
aVet voila; the handler or handlers (via )
p48147
aVSo basically in your example (regarding that post), use:
p48148
as(dp48149
g18
V23354
p48150
stp48151
a((dp48152
g2
(lp48153
VThe key here is that  is not virtual and cannot be overridden
p48154
aVSince a struct is effectively , methods cannot be overridden any more than the struct, so the runtime and compiler can treat struct methods that have been overridden as static calls
p48155
aVIf you write a struct (rare) you should override all the methods like , ,  for exactly this reason
p48156
aVIf you don't it must box
p48157
aVHowever,  cannot be overridden, thus needs boxing
p48158
aVThis actually leads to some odd edge-cases with  and boxing, since an empty  boxes to , so:
p48159
as(dp48160
g18
V23354
p48161
stp48162
a((dp48163
g2
(lp48164
VIf they are not properties, the only logical conclusion is that the base constructor has assigned them
p48165
aVUnexpected, perhaps, but not impossible
p48166
aVThe  allows you to combine multiple code files into a single class; you only need it if you have separated your code file (usually for designers)
p48167
aVSome digging in reflector shows that the ctor calls into , which does exactly this (reflecting over the fields, assigning them via )
p48168
as(dp48169
g18
V23354
p48170
stp48171
a((dp48172
g2
(lp48173
VMy advice
p48174
aVUse sp_ExecuteSQL instead of concatenation / replacement:
p48175
aVOverall, though - the  should work; are you sure that  is not empty
p48176
as(dp48177
g18
V23354
p48178
stp48179
a((dp48180
g2
(lp48181
VThe obvious problem would be the risk of abandoning a transaction, which could cause blocking for an indeterminate time (or until timeout)
p48182
aVBut you could leave all sorts off mess - unrecoverable  locks, semaphores, etc, memory leaks, etc
p48183
aVIn short: try as hard as possible to avoid having to abort a thread unless you know exactly what it is doing at the time
p48184
aVAnd the only way you could know what it is doing is if it is already in a known "safe spot" (to use your term) - so you might as well just throw an exception or something and let it raise itself in a managed way
p48185
as(dp48186
g18
V23354
p48187
stp48188
a((dp48189
g2
(lp48190
VIn the LINQ part, you are inside a single line, so you might want to exclude the empty lines first:
p48191
aVYou then do two splits - one on newline, which is odd (since that won't be there, since we know we are reading lines)
p48192
aVI expect you mean something like:
p48193
aVAlso, note that  is a buffered operation; if you want true streaming, you might want something like:
p48194
aVwhich is not buffering (you don't load the entire file at once)
p48195
aVJust change the first line to:
p48196
as(dp48197
g18
V23354
p48198
stp48199
a((dp48200
g2
(lp48201
VAssuming the class you are wrapping exposes things like , you should just be able to derive from , overriding a few key methods - something like:
p48202
aVThis should result in the lists staying in sync as you manipulate them
p48203
as(dp48204
g18
V23354
p48205
stp48206
a((dp48207
g2
(lp48208
VHow about:
p48209
aVYou could probably combine the second/third lines if you like:
p48210
aVThe choice of  is because this skips the validation check that casting  or  perform - i
p48211
ag50
aVit is (ever-so-slightly) faster (and we've already checked that it isn't )
p48212
as(dp48213
g18
V23354
p48214
stp48215
a((dp48216
g2
(lp48217
VIt depends on the control; look for  /  or  / , etc (and use them in a / block)
p48218
aVNote, however, that only some controls have these methods, and they aren't bound to a handy interface so it is a bit manual
p48219
aVFor example:
p48220
aVNote that data-bound controls may have other mechanisms for disabling data-related changes; for example,  has a settable  that turns off change-notifications while you edit data
p48221
aVYou might also look at things like "virtual mode"
p48222
as(dp48223
g18
V23354
p48224
stp48225
a((dp48226
g2
(lp48227
VMy biggest gripe would be the name, ;  might be more illusrative of the usage
p48228
aVI'd also add  to the generic method, but the "fluent API" seems usable
p48229
aVI'd also be inclined to flatten the code a bit
p48230
aVI can also see some ways of using the  API to walk an entire tree and capture all the intermediate steps, but it wouldn't be trivial - but imagine:
p48231
aVwhere that is an expression tree and we get the intermediaries automatically
p48232
aV(also, you could  or  the list in )
p48233
aVLike so:
p48234
as(dp48235
g18
V23354
p48236
stp48237
a((dp48238
g2
(lp48239
V is easy - you can just call  in a loop
p48240
aVis much trickier
p48241
aVYou mention SQL, so I'm assuming this is something like LINQ-to-SQL, in which case one way I've found to do this involves building custom  trees at runtime - like so (the example is C#, but let me know if you need help translating it to VB; my VB isn't fantastic any more, so I'll let you try first
p48242
aVyou can probably read C# better than I can write VB)
p48243
aVUnfortunately, this won't work with EF in 3
p48244
aV5SP1 (due to the ), but I believe this is fixed in 4
p48245
ag190
as(dp48246
g18
V23354
p48247
stp48248
a((dp48249
g2
(lp48250
VI'm not sure I understand the question, but if you are using data-binding it is the bound control / form that binds to your class - either via the  interface (as in this case) or as reflection against the  pattern (via )
p48251
aVIf you really want you could intercept the / parts of the event and look at the stack trace to see who is adding/removing handlers:
p48252
as(dp48253
g18
V23354
p48254
stp48255
a((dp48256
g2
(lp48257
VWith a dictionary,  is critical
p48258
aVFor things that are equal () it must return the same number (but it is permitted to have collisions - i
p48259
ag50
aVtwo items can return the same number by coincidence but not be considered equals)
p48260
aVAdditionally - the hash-code must not change while the item is in the dictionary
p48261
aVHashing on  values are good for this, but alternatively: just don't change it
p48262
aVFor example, if your equals / hashcode spans an entities  and  (say), then don't change those properties of the object, or you may never see that record again (even if you pass in the same instance as the key)
p48263
as(dp48264
g18
V23354
p48265
stp48266
a((dp48267
g2
(lp48268
VThe  support exists (at the moment) as a mechanism for injecting protobuf-net into the middle of existing APIs that use  - for example, you can do this to reduce the overhead of
p48269
aVNET remoting or (serialized) session-state
p48270
aVHowever, this still results in a pb-net BLOB in the middle of a  wrapper (in particular, the bf header specifies the concrete type assembly-qualfied-name)
p48271
aVRe the question about the constraint - that is simply to help guide usage; that API is only intended to be used as part of this injection into  via
p48272
aVOtherwise it is preferred to just use the  based API
p48273
aVIf you are looking at CF, then of course  ceases to be useful, but the  based API is fine
p48274
aVIt works on CF, but you should note that for models with lots of classes there are currently some  glitches on CF caused by the overuse of generics ("missing method" or some-such)
p48275
aVThe good news is that I'm making good progress on some refactoring that ditches this, making it much more stable on the smaller frameworks
p48276
as(dp48277
g18
V23354
p48278
stp48279
a((dp48280
g2
(lp48281
VThis isn't pretty, but it seems to do the job:
p48282
as(dp48283
g18
V23354
p48284
stp48285
a((dp48286
g2
(lp48287
VThe inbuilt LINQ operators use the expected sort operations (for LINQ-to-Objects, it does this using
p48288
aVYour lambda expression is strongly typed; behind the scenes the compiler inferred some generics for you - it is actually:
p48289
aVIt already knows it is a , so the only time you'd need to do something extra here is if your dates contain a range of different timezones
p48290
aVOf course, within a timezone you should be fine, but you could (if you were paranoid) convert all to UTC - I don't think you need to do this in your case, but:
p48291
aVNote that this actually creates a second list (it doesn't change the ordering of the original list); you can use the code from here to do an in-place sort using lambdas:
p48292
as(dp48293
g18
V23354
p48294
stp48295
a((dp48296
g2
(lp48297
VActually, it is not true that a critical fail in one  can't impact others
p48298
aVIn the case of bad things, the best bet it to tear down the process
p48299
aVThere are a few examples, but to be honest I haven't memorised them - I simply took a mental note "bad things = tear down process (check)"
p48300
aVBenefits of :
p48301
aVyou can unload an ; I use this for a system that compiles itself (meta-programming) based on data from the database - it can spin up an appdomain to host the new dll for a while, and then swap it safely when new data is available (and built)
p48302
aVcomms between s are relatively cheap
p48303
aVIMO this is the only time I am happy  to use remoting (although you still need to be really careful about the objects on the boundary to avoid bleeding references between them, causing "fusion" to load extra dlls into the primary , causing a leak) - it is really easy too - just  (or is it
p48304
aVvs spawing an extra process - you could go either way; but you don't need another exe for  work, and it is much easier to set up any comms that you need
p48305
as(dp48306
g18
V23354
p48307
stp48308
a((dp48309
g2
(lp48310
VThis is a common problem, but the best approach depends on the scenario
p48311
aVAn additional problem is that in many cases it isn't a problem visiting the same object twice - that doesn't imply recursion - for example, consider the tree:
p48312
aVThis may be valid (think , which would simply write the  instance out twice), so it is often necessary to push/pop objects on a stack to check for true recursion
p48313
aVThe last time I implemented a "visitor", I kept a "depth" counter, and only enabled the stack checking beyond a certain threshold - that means that most trees simply end up doing some /, but nothing more expensive
p48314
aVYou can see the approach I took here
p48315
as(dp48316
g18
V23354
p48317
stp48318
a((dp48319
g2
(lp48320
VC# generally runs at the server (unless you are talking about Silverlight etc), so there will be no way of knowing much about the client
p48321
aVLikewise, I would not expect this information to be exposed unless you are writing a browser extension / add-in
p48322
aVBasically, I think the short version is "no"
p48323
as(dp48324
g18
V23354
p48325
stp48326
a((dp48327
g2
(lp48328
VFirst off I'm a little unsure about why this both inherits () and wraps () a list - either individually should be fine
p48329
aVHowever
p48330
aVTo define the types of new objects you can create you need to derive from  and override the  property - and associate this editor with your type
p48331
aVI'm a little bit unclear on what objects you want to be addable, and whether this is the best design
p48332
aVIf you want to add existing objects you may need a completely custom editor / uitypeeditor
p48333
aVWith the updated question, it definitely sounds like a job for a custom ; here's a version that uses a drop-down; you can do popups too (see methods on ):
p48334
as(dp48335
g18
V23354
p48336
stp48337
a((dp48338
g2
(lp48339
VIn addition to external config files, you could use a DSL in C# to configure the system, much like is common in things like ASP
p48340
aVNET MVC and/or StructureMap registration
p48341
aVOf course, if you like the python approach you could run a py script via IronPython to configure your system with a bit less xml
p48342
aVThis would avoid the need to recompile, while allowing a code-based config script
p48343
as(dp48344
g18
V23354
p48345
stp48346
a((dp48347
g2
(lp48348
VWith the exception of Silverlight, those are all essentially the same platform (
p48349
aVNET), so you should just be able to bring the assembly/assemblies over the projects and all is good
p48350
aVYou could use an extern or similar, but it'll work any which way
p48351
aVSilverlight is a little different, as you might need (or just choose) a different build for that - but if they are all tightly related (to the same project / product etc) you should be able to keep them pertty close without difficulties
p48352
as(dp48353
g18
V23354
p48354
stp48355
a((dp48356
g2
(lp48357
VIt is hard to guess in isolation, but my assumption would be that it was written by someone who assumes that more files might be added at some point (or this file included in another project), so gives the least necessary access for the code to function
p48358
aVEssentially limiting the public API to the minimum
p48359
as(dp48360
g18
V23354
p48361
stp48362
a((dp48363
g2
(lp48364
VWhat exactly is the data
p48365
aVWith xml, the obvious answer would be to use smoething like  to compress it - making it smaller and obscure
p48366
aVYou could use  but it is brittle and IMO unsuitable for long-term storage
p48367
aVI would say "protocol buffers", (maybe protobuf-net), but it depends what the "custom data" is
p48368
aVBut if you are using  at the moment protobuf-net may work virtually without changes (maybe add a few attributes) - and it is (in every case I've seen to date) both smaller and faster than
p48369
aVHere's the steep learning curve (see also: Getting Started):
p48370
aVTo be fair, it can get a little trickier if you are using inheritance - not much though
p48371
aVIn many cases you can actually use your existing attributes - it'll work with xml / wcf attributes if an explicit element order is included
p48372
as(dp48373
g18
V23354
p48374
stp48375
a((dp48376
g2
(lp48377
VUltimately, no - you have to scan them
p48378
aVLINQ makes it fairly pain-free though
p48379
aVNote this only scans loaded assemblies "as is"
p48380
as(dp48381
g18
V23354
p48382
stp48383
a((dp48384
g2
(lp48385
Vprotobuf-net doesn't have brilliant support for extensions; you need to use the field numbers (I don't think it does anything with  at the moment)
p48386
aVHowever, to get values out you should be able to use  /  (note to self: make those extension methods in C# 3
p48387
aV0)
p48388
aVTo set a value use  - it can't know whether this is a single-value or a list (), so the same API handles both scenarios
p48389
aVIt is possible that Jon's version (being much closer to the Java version) has better support here
p48390
aVExample (I'm using hand-written classes for brevity, but it should work with generated types too):
p48391
as(dp48392
g18
V23354
p48393
stp48394
a((dp48395
g2
(lp48396
VTry
p48397
aVIn the , the brackets enforce the precedence, but cast  takes precedence over the multiply - so you current have: , which rounds (during the cast) to 9
p48398
aVIn particular, see "7
p48399
ag5115
aV1 Operator precedence and associativity" in the MS spec, which defines cast ahead of multiplication:
p48400
ag8441
aV5: Primary:    x
p48401
aVy  f(x)  a[x]  x++  x--  new typeof  default  checked  unchecked  delegate
p48402
ag8441
aV6: Unary:  +  -
p48403
aV~  ++x  --x  (T)x
p48404
ag8441
aV7: Multiplicative: *  /  %
p48405
aVetc
p48406
as(dp48407
g18
V23354
p48408
stp48409
a((dp48410
g2
(lp48411
VIf you just want to parse hex:
p48412
aVI've used  here for illustration, as  could be 32/64
p48413
as(dp48414
g18
V23354
p48415
stp48416
a((dp48417
g2
(lp48418
VYes, that is possible in ASP
p48419
aVNET
p48420
aVThere are some places (async etc) where ASP
p48421
aVNET does thread-switching and uses different threads for a single request (at different points), which means that it is entirely possible that half way through a request that thread goes on to process another request
p48422
aVAt what points in the pipeline do you take/release the lock
p48423
aVCan you reduce this
p48424
aVPersonally I would limit the thread duration to some synchronous method that is separated from the UI/presentation code
p48425
aVIt won't be changing threads in the middle of a synchronous method
p48426
as(dp48427
g18
V23354
p48428
stp48429
a((dp48430
g2
(lp48431
VThat is never going to work; after all  just copies the reference (unless you add your own implicit static conversion operator to your own list type) - so it is still a list of  and could contain things other than  instances
p48432
aVEven in 4
p48433
aV0, co/contra variance doesn't extend to a: lists (both  and ), or b: concrete types (like )
p48434
aVInterestingly though, it will (and always has) work for arrays of reference types, but only in the direction
p48435
aVIt doesn't convert anything; if you try and put the wrong data in it'll throw an exception
p48436
as(dp48437
g18
V23354
p48438
stp48439
a((dp48440
g2
(lp48441
V(note: I couldn't reproduce the "group tags" issue; see edit history for my first thoughts on this, now removed; if you can help me reproduce this I'd be grateful)
p48442
aVThe problem is
p48443
aVYou have defined this both as a list and as a serialization entity (); the latter takes precedence, so it was trying to serialize the single sub-report on the list (which is always
p48444
aVIf you change this to:
p48445
aVor if you remove it completely and make  a  it should work fine
p48446
aVThe following works:
p48447
aVDisplaying the blob:
p48448
as(dp48449
g18
V23354
p48450
stp48451
a((dp48452
g2
(lp48453
VWell, the error message is correct in as much that the value of  is not preserved during the operation
p48454
aVIn pure "functional" terms (and lambdas are really designed to act functionally) it will be confusing
p48455
aVFor example, an interesting test would be:
p48456
aVwhat happens if I iterate the query twice
p48457
aVFor example:
p48458
aVI believe you can see
p48459
aV,  - confusing
p48460
aVThe following would be repeatable:
p48461
aVIf you needed you could of course write a reusable extension method that took a lambda
p48462
as(dp48463
g18
V23354
p48464
stp48465
a((dp48466
g2
(lp48467
VFirstly, note that if you don't need duplicates,  may be helpful
p48468
aVThe  is going to want to compare  instances, so your comparison needs to work on  (most easily enforced by implementing :
p48469
as(dp48470
g18
V23354
p48471
stp48472
a((dp48473
g2
(lp48474
VWhat is
p48475
aVI'm guessing it is a  - which will make things very tricky
p48476
aVI would suggest writing a wrapper type:
p48477
aVThen you can associate the correct attributes
p48478
aVIf you need to support ad-hoc attributes on  you'd still need to use attribute-overrides (hence I haven't decorated the above at all), but  should be happy to take the attributes
p48479
aVAlternately, just write a separate DTO and map the values
p48480
aVIf it is simple, you might just be able to use:
p48481
aVAlternatively, if you must use attribute-overrides, I'd still use a wrapper object:
p48482
as(dp48483
g18
V23354
p48484
stp48485
a((dp48486
g2
(lp48487
VA  should work just fine; having arrays on the object API is just going to cause pain:
p48488
aVAlternatively, you could write an append extension method, but this is not an efficient way to manipulate lists of data:
p48489
as(dp48490
g18
V23354
p48491
stp48492
a((dp48493
g2
(lp48494
VOperators must relate to instances of the type in which they are declared
p48495
aVSince you can't have instances of a static class, it makes no sense to define operators
p48496
aVThere are no "extension operators" in
p48497
aVNET
p48498
aVFor your purposes, consider implementing an  (covers  and ) and / or  (covers , or you might just use compare returning ; it depends whether you consider "sorts equal" and "equal" as the same)
p48499
as(dp48500
g18
V23354
p48501
stp48502
a((dp48503
g2
(lp48504
VIf you want that type of access, consider a  or , or get familiar with bitwise arithmetic
p48505
aVYou can do explicit layout of structs in C# (causing a union), but I don't think it is to your advantage
p48506
aVIt is primarily aimed at interop scenarios
p48507
aVFor info, the bitwise operators work mainly on /// - not so much the smaller integer types
p48508
as(dp48509
g18
V23354
p48510
stp48511
a((dp48512
g2
(lp48513
VTo do that you want  and  (ideally both of to make it explicit):
p48514
as(dp48515
g18
V23354
p48516
stp48517
a((dp48518
g2
(lp48519
VC# doesn't define the endianness
p48520
aVIn reality, yes it will probably always be little-endian (IIRC even on IA64, but I haven't checked), but you should ideally check  if endianness is important - or just use bit-shifting etc rather than direct memory access
p48521
aVTo quote a few lines from protobuf-net (a build not yet committed):
p48522
ag412
ag50
aVit checks the endianness and does a flip if necessary
p48523
as(dp48524
g18
V23354
p48525
stp48526
a((dp48527
g2
(lp48528
VI don't know if it has a "name" as such, but it looks like some kind of manual service resolver
p48529
aVThe problem I can see (from experience, sadly) is that it is inflexible in real terms, in that:
p48530
aVthe registration only has a single configuration
p48531
aVit is hard to unit test
p48532
aVPersonally I'd look at an IoC container if I was doing this in a new system; the IoC can handle this relationship, and provide a lot more capabilities for free (lifetimes, enrichment, extra setup, etc), and solve many associated problems
p48533
aVBTW, it may be easier to:
p48534
as(dp48535
g18
V23354
p48536
stp48537
a((dp48538
g2
(lp48539
VIf you are already transporting "plenty of data" over the network from the database to the app, then the last step of pivoting it in memory isn't likely to be a big problem
p48540
aVIMO, either pivot it "at source", or just pivot it locally and then see if it is a bottleneck
p48541
aVYou could also write some funky binding model, but I doubt it is worth it
p48542
aVA final option is to use "virtual mode" (if the list supports it), and perform the translation during the lookup (ideally using a dictionary-based row lookup - perhaps a precomputed )
p48543
as(dp48544
g18
V23354
p48545
stp48546
a((dp48547
g2
(lp48548
s(dp48549
g18
V23354
p48550
stp48551
a((dp48552
g2
(lp48553
s(dp48554
g18
V23354
p48555
stp48556
a((dp48557
g2
(lp48558
VRegarding the list not updating; there are two issues;
p48559
aVTo notice add/remove, you need list binding events
p48560
aVThe easiest way to do this is to ensure you use a  rather than a
p48561
aVTo notice changes to individual properties (in this context) you'll need to implement  on your type:
p48562
aVFor an example showing binding that to a list:
p48563
as(dp48564
g18
V23354
p48565
stp48566
a((dp48567
g2
(lp48568
VYour implementation assumes the  is seekable
p48569
aVIf it is known to be seekable, why do anything
p48570
aVJust create an  at your position; consume the data; ditch the reader; and seek the  back to where you started
p48571
aVHow large is the xml
p48572
aVYou may find that throwing the data into a DOM ( /  / ec) is a viable way of getting a reader that does what you need without requiring lots of rework
p48573
aVIn the case of ,  would suffice, for example (it would also provide xpath support if you want to use non-trivial queries)
p48574
as(dp48575
g18
V23354
p48576
stp48577
a((dp48578
g2
(lp48579
VCannot reproduce; this works fine - can copy/paste both in the grid and the popup (does your property have a setter
p48580
ag6864
as(dp48581
g18
V23354
p48582
stp48583
a((dp48584
g2
(lp48585
VThe dll config file that you see in the IDE (if you are using the designer to add settings etc) is largely for convenience
p48586
aVThe runtime won't look for it; it wants the file from
p48587
aVSome components provide the facility to specify a separate config file path - I don't know if this is the case for entlib
p48588
aVAlternatively if you are spawning your own s you can specify the config file path
p48589
aVAnd finally some config sections can be referenced in from other files rather than using the file completely (see  here) - but in general (and especially for tests) it is easier to just copy the configuration section into the top-level app's config file (or the unit test's config file in this case)
p48590
as(dp48591
g18
V23354
p48592
stp48593
a((dp48594
g2
(lp48595
VI suspect that in many cases the  may do much of what you want here (watch out - it can also be )
p48596
aVBut just  or  to that
p48597
aVIf you do keep a global object - perhaps type it just as  - less chance of unintended abuse
p48598
as(dp48599
g18
V23354
p48600
stp48601
a((dp48602
g2
(lp48603
VIn your scenario, either type-inheritance or interface-implementation would work - but interface based abstraction allows types outside of your existing type model to provide the functionality
p48604
aVIt could be a mock object, or it could be some kind of super killer robot, that can walk run and eat but isn't really a mammal (so having it inherit from a  class could be confusing or just impossible)
p48605
aVIn particular, interfaces allow us to express this relationship neatly, while avoiding the subtle points from C# having single (type-)inheritance
p48606
as(dp48607
g18
V23354
p48608
stp48609
a((dp48610
g2
(lp48611
VSomewhere else in your project, create a utility class, for example:
p48612
aVNow you should be able to use it from both places as ; note that it should be a static method, so you'll need to pass the textbox in as a parameter
p48613
as(dp48614
g18
V23354
p48615
stp48616
a((dp48617
g2
(lp48618
VHere's examples of 3 different ways:
p48619
aVformat string on the cell template
p48620
aVcell-formatting event
p48621
aVcustom type converter
p48622
aVAny use
p48623
as(dp48624
g18
V23354
p48625
stp48626
a((dp48627
g2
(lp48628
VTo get all properties (public + private/protected/internal, static + instance) of a given  (maybe using  to get ):
p48629
as(dp48630
g18
V23354
p48631
stp48632
a((dp48633
g2
(lp48634
VIn terms of performance and memory usage; precisely nothing
p48635
aVHaving a static class means you know there are no instances, but back in 1
p48636
aV1 having a private constructor sufficed
p48637
aVUse a static class if it simply makes no sense to have an instance
p48638
aV(utility classes etc)
p48639
as(dp48640
g18
V23354
p48641
stp48642
a((dp48643
g2
(lp48644
VAssuming you have a root element you can use a DTO to wrap up the differences:
p48645
as(dp48646
g18
V23354
p48647
stp48648
a((dp48649
g2
(lp48650
VVirtually any kind of recursive code could be classified as reentrant (i
p48651
ag50
aVyou can call back into the same method without having finished it), but this is used in particular when talking about locks, mutex, semaphores etc
p48652
aVFor example, a lock is re-entrant if once you have the lock you can successfully "lock" the code again (i
p48653
ag50
aVyou don't deadlock yourself) - for example:
p48654
aVHere the fact that the lock is re-entrant means we can call  and  without worrying that we already have the "exclusive" lock, making the code simpler
p48655
aVInternally, a counter is used rather than a simple "in use" flag
p48656
as(dp48657
g18
V23354
p48658
stp48659
a((dp48660
g2
(lp48661
VPerhaps the easiest way to use  is with , since this will handle a lot of the nuances for you automatically:
p48662
aVAlternatively you can just use assembly-qualified names, so:
p48663
aVIn a rather peculiar case involving multiple s, I've found you can also work some magic with the  event, but that should be avoided if possible
p48664
aVI also have a complete re-working of the metadata layer in the pipeline, allowing much more flexibility at runtime (rather than having to declare everthing at compile, which is causing some of the pain above)
p48665
as(dp48666
g18
V23354
p48667
stp48668
a((dp48669
g2
(lp48670
V is part of
p48671
aVNET 3
p48672
aV5; it might work simply by bundling the dll, but that isn't the supported route
p48673
aVThe "fix" here is to either target
p48674
aVNET 3
p48675
aV5 and have
p48676
aVNET 3
p48677
aV5 as a pre-requisite; or don't use DataSetExtensions (use regular access instead; perhpas with some LINQBridge and just write the missing extension methods you want yourself)
p48678
aVIf you aren't using DataSetExtensions in your code, then just remove the unnecessary references to System
p48679
aVData
p48680
aVDataSetExtensions and System
p48681
aVXml
p48682
aVLinq (in solution explorer)
p48683
as(dp48684
g18
V23354
p48685
stp48686
a((dp48687
g2
(lp48688
VTo sort the existing list:
p48689
aVIt is also possible to write a  extension method, allowing:
p48690
aVfor example:
p48691
as(dp48692
g18
V23354
p48693
stp48694
a((dp48695
g2
(lp48696
VPersonally I tend to; for two reasons:
p48697
aVit means that if somebody has forgotten to release the  (perhaps from an event) any downstream objects (a  in this case) can still be collected (at some point in the future - whenever the GC feels like it); it is likely that this is just a shallow wrapper around an unmanaged resource, but every little helps
p48698
aVI really don't like accidentally keeping an entire object graph hanging around just because the user forgot to unhook one event;  is a handy "almost-kill" switch - why not detach everything available
p48699
aVmore importantly, I can cheekily now use this field to check (in methods etc) for disposal, throwing an  if it is
p48700
as(dp48701
g18
V23354
p48702
stp48703
a((dp48704
g2
(lp48705
VOne trick here is xsd
p48706
aVexe:
p48707
aVThis should generate compatible classes for you
p48708
aVHowever, the specific problem in this case is that you want , not :
p48709
as(dp48710
g18
V23354
p48711
stp48712
a((dp48713
g2
(lp48714
VThis avoids having to materialize any attribute instances (i
p48715
ag50
aVit is cheaper than
p48716
as(dp48717
g18
V23354
p48718
stp48719
a((dp48720
g2
(lp48721
VIMO that is simply not a good thing to do - the expectation is that if the  doesn't throw it assigned the value
p48722
aVTest in the UI (or where-ever) before doing the , or throw and handle an exception
p48723
aVAlternatively, the caller might be less confused by a method:
p48724
aVwhich returns  or  to indicate whether it happened
p48725
aVYou should also avoid bleeding UI code into domain logic; perhaps use an event to let the UI talk to the user without inflicting a particular UI implementation on the caller
p48726
as(dp48727
g18
V23354
p48728
stp48729
a((dp48730
g2
(lp48731
VThat doesn't look too evil, but you could also create a "DataContext" (for want of a better word) that exposes both the request and response, and only have each know about the context
p48732
ag412
ag50
aVto ask about the request the response would ask about:
p48733
aVIt isn't a memory problem though;
p48734
aVNET doesn't do reference counting, so you don't need to worry about an island of circular references
p48735
aVIf they are all unreachable from other objects, they'll get collected
p48736
aVThe scenario in the question won't cause the world to end
p48737
as(dp48738
g18
V23354
p48739
stp48740
a((dp48741
g2
(lp48742
VCF 3
p48743
aV5 has some WCF, but at current only the full-fat framework has WCF with the hooks to support swapping out the serializer on the fly
p48744
aVI know of some users who are using CF but passing a  over the wire (as far as WCF is concerned) and handling the protobuf-net (de)serialization outside of WCF (a  may work similarly, but they chose  - I can't recall why- perhaps base-64 issues
p48745
aVWould that help
p48746
as(dp48747
g18
V23354
p48748
stp48749
a((dp48750
g2
(lp48751
VWith the HTML Agility Pack (assuming it is html, not xhtml):
p48752
as(dp48753
g18
V23354
p48754
stp48755
a((dp48756
g2
(lp48757
VJust add some reusable functions
p48758
aVfor example:
p48759
aVAnd then (for example):
p48760
aV(where  is whatever control you are using with a  and )
p48761
as(dp48762
g18
V23354
p48763
stp48764
a((dp48765
g2
(lp48766
VI haven't tried it on ruby, but you could look at protocol buffers
p48767
aVDesigned as a fast but portable binary format, it has a ruby port here
p48768
aVYou would probably have to treat the generated types as a separate DTO layer, though (i
p48769
ag50
aVyou map your existing data into the new types, rather than serialize your existing objects)
p48770
aVNote that there is no inbuilt date-time support, but you could just use ticks in an epoch etc
p48771
as(dp48772
g18
V23354
p48773
stp48774
a((dp48775
g2
(lp48776
VReturning  is indeed not ideal
p48777
aVFor alternatives; it depends on the use
p48778
aVIMO, this version (copied from the main post) is the simplest yet does everything we need:
p48779
aVand as an advantage, it'll work with , where-as anything with a  won't work (a bug; it sees the setter but doesn't notice it can't use it)
p48780
aVThe lazy approach is usually overkill IMO, as in most interesting cases you're going to populate the lists anyway
p48781
as(dp48782
g18
V23354
p48783
stp48784
a((dp48785
g2
(lp48786
VI'm not sure that  is the service - that sounds like a message
p48787
aVLook for another type in that namespace (maybe ending in "service" or "client" if you are lucky, but ultimately named based on what you typed when using "add web reference" etc), that inherits from
p48788
aVThis should have your service method(s) as  public methods
p48789
aVHaving seen the service, I expect the problem is that you are adding a service-reference (WCF / 3
p48790
aV0) rather than a web-reference (2
p48791
aV0)
p48792
aVIf you are targetting 3
p48793
aV0 / 3
p48794
aV5, you can add a web-reference by using the "Advanced
p48795
aV=> "Add Web Reference" option
p48796
aV(in the "Add Service Reference" dialog)
p48797
aVThen you can use (where  is whatever you named it when adding the reference):
p48798
aVIf you instead use a WCF service-reference, then the name tends to include the "Soap" overhead (where  is whatever you named it when adding the reference):
p48799
aVEither way, it should work the same
p48800
as(dp48801
g18
V23354
p48802
stp48803
a((dp48804
g2
(lp48805
VYou could make  either  or  on the base-type (), and  it in the derived types, but you can't change the return type when overriding, so it would have to be  (nothing more specific)
p48806
aVYou can redeclare methods (
p48807
aV, but that gets messy, and you can't  and  a method by the same name/signature in the same type
p48808
aVBut if you're happy for the return type to be
p48809
as(dp48810
g18
V23354
p48811
stp48812
a((dp48813
g2
(lp48814
VIn short, no
p48815
aVYou would have to look at another language
p48816
aVYou can overload many of the existing operators, or define any other methods (including extension methods which are very handy) - but you can't define custom operators in any variant of C# that I know of
p48817
as(dp48818
g18
V23354
p48819
stp48820
a((dp48821
g2
(lp48822
VIndeed, the actual method takes precedence over the extension method
p48823
aVAnd just to make it clear - "order of execution" suggests both might be called; only the original method will be invoked
p48824
aVPerhaps pick another name / signature; you can't use extension methods to monkey-patch, if that is your intent
p48825
aVIf there is some base-class / interface (that the type implements) that doesn't have this method, you could perhaps cast it to there
p48826
as(dp48827
g18
V23354
p48828
stp48829
a((dp48830
g2
(lp48831
VIf you just want the file sent as the body of a POST / STOR / etc, then  makes this easy:
p48832
aVIf you need a form it is trickier; you'll need multipart-mime, which isn't supported directly; you'll have to write it or use existing code from the net
p48833
as(dp48834
g18
V23354
p48835
stp48836
a((dp48837
g2
(lp48838
VFrom the comments, you don't need WCF and just want to share data
p48839
aVIn which case, I would look at protobuf-net
p48840
aVI'm quite biased (since I'm the author), but it is free (with source), so I'm not recommending it from self gain
p48841
aVSimply; it is a fast, portable serialization API modelled after google's "protocol buffers" data format
p48842
aVVery fast to process (typically much faster than xml, for example) and pretty small on the wire
p48843
aVIf you already using data-contracts, you might be able to tweak them simply by adding unique  values (it uses this as a numeric identifier):
p48844
aV(or you can use the specific protobuf-net attributes)
p48845
aVThe full source is available, and it works on Mono, regular
p48846
aVNET, CF, etc
p48847
as(dp48848
g18
V23354
p48849
stp48850
a((dp48851
g2
(lp48852
VLet's dissect the line:
p48853
aVSo how many ways can we get  problems
p48854
aV(your "captured" variable) could be
p48855
aVcould be null, meaning there is a  in the list
p48856
aVyou've handled the case of  being  ()
p48857
aVbut maybe  (the category on a record in the list) is  () - however, I'm not sure that this would cause a
p48858
aV(the list / source) could be
p48859
aVSo: out of 5 options you've eliminated 1; look at the other 4
p48860
aVThere is also the definite possibility that the issue is caused by something invisible not shown in the code; for example the  could be:
p48861
aVand  could be ; if you eliminate the other 4 (pretty easy to do), look at at this one as a last resort
p48862
as(dp48863
g18
V23354
p48864
stp48865
a((dp48866
g2
(lp48867
VThe C# compiler is fully unicode aware - what problems are you having specifically
p48868
aVIt is generally fairly rare for actual source code to contain large amounts of non-ASCII anyway
p48869
aVBut I suspect the simplest thing in your case would be to change the files to UTF8
p48870
aVno more problem
p48871
aVIt would be pretty easy to script loading it with a specific  and then saving with
p48872
as(dp48873
g18
V23354
p48874
stp48875
a((dp48876
g2
(lp48877
VGeenrics and operators don't mix
p48878
aVIn 4
p48879
aV0 you can use  for this; until then, MiscUtil has  which should work perfectly for cases like:
p48880
aVHowever, speciailizing in  won't really work well
p48881
aVYou might as well start with  (instead of ) in that case
p48882
aVYou could use  and , but that isn't neither robust nor efficient
p48883
aVEdit - there is also , so you could try:
p48884
as(dp48885
g18
V23354
p48886
stp48887
a((dp48888
g2
(lp48889
VNot directly
p48890
aVThe only way to do this is through dynamic SQL - either  or
p48891
aVThe latter has the advantage of query cache/re-use, and avoiding injection via parameters for the values - but you will have to concatenate the table-name itself into the query (you can't parameterise it), so be sure to white-list it against a list of known-good table names
p48892
as(dp48893
g18
V23354
p48894
stp48895
a((dp48896
g2
(lp48897
VYou could just re-open the file
p48898
aVBut to keep a single  without it getting closed, you could try  in MiscUtil
p48899
aVJust be sure to reset the  if appropriate
p48900
as(dp48901
g18
V23354
p48902
stp48903
a((dp48904
g2
(lp48905
VIn C#, certainly the bits aren't packed by default, so multiple bool fields will each take 1 byte
p48906
aVYou can use , , or simply bitwise arithmetic to reduce this overhead
p48907
aVAs variables I seem to recall they take 4 bytes (essentially handled as  = )
p48908
aVFor example, the following sets  to 4:
p48909
as(dp48910
g18
V23354
p48911
stp48912
a((dp48913
g2
(lp48914
VI really think you should profile for such a question
p48915
aVNot only does it depend on the exact database product, but in theory it could also depend on the skew of your data
p48916
aVHowever
p48917
aVBy default I would say write the code that most clearly expresses your intent
p48918
aVYou are after  records without a matching , so IMO the clearest code is
p48919
aVIt probably won't matter, but I would use  (not ), since the  is not important in the "without a matching  logic
p48920
aVOnce you have code that expresses what you intend and works, then look at optimising based on profiling
p48921
as(dp48922
g18
V23354
p48923
stp48924
a((dp48925
g2
(lp48926
VLINQ-to-SQL plays nicely as long as you let it do its thing by itself
p48927
aVIMO, the best way to handle this scenario is to leave the DBML-generated type at the DAL - only return those if that is exactly a 100% fit for what you want to return
p48928
aVInstead, I would create a new type that is not managed by LINQ-to-SQL, and return this instead (you can do initializer-based projections for non-DBML types); for example:
p48929
aVThis should allow you to get your data out, without any silent n+1 issues, and without the data-context complaining
p48930
aVIt also means you are in complete control over which columns are queried and how they are mapped
p48931
aVEssentially this then uses LINQ-to-SQL just to do the database integration, using our own type for the main application
p48932
as(dp48933
g18
V23354
p48934
stp48935
a((dp48936
g2
(lp48937
VMost are used at runtime only
p48938
aVA very limited number are used by the compiler, including:
p48939
aV- omit method calls per build symbols
p48940
aV- emit a warning/error as build output
p48941
aV- gets written as a CLI flag
p48942
aV- used for extension methods
p48943
aV- affects how attributes are applied
p48944
ag15761
aVThere are a range of things like ,  etc that are used by the compiler when creating the assembly file, and things like  which affect accessibility
p48945
aVAdditionally, tools like PostSharp do extra post-compile steps based on attributes
p48946
aVThere are some other attributes that the compiler may add to generated types/methods (for anon-methods / types, iterator blocks, etc)
p48947
as(dp48948
g18
V23354
p48949
stp48950
a((dp48951
g2
(lp48952
VWhich version of the framework are you using
p48953
aVOlder versions don't trust network shares much - so you might need to use "caspol" to enable trust (or move the file locally before running it)
p48954
aVMore recently, the framework does trust mappped shares (such as ), but doesn't trust UNC shares () without a "caspol" tweak
p48955
aVThe simplest option, though, is to run the exe from a local drive rather than over the network
p48956
as(dp48957
g18
V23354
p48958
stp48959
a((dp48960
g2
(lp48961
VI haven't played with the C++ API, so you'll have to give me a bit more context / information
p48962
aVWhat does this method do
p48963
aVPerhaps a sample usage
p48964
aVIf you are consuming data from a stream, there are "WithLengthPrefix" versions to automate limiting to discreet messages, or I believe the method to just read the next length from the stream is on the public API
p48965
aVIf you want to get a length in place of serializing, then currently I suspect the easiest option might be to serialize to a dummy stream and track the length
p48966
aVOddly enough, an early version of protobuf-net did have "get the length without doing the work" methods, but after discussion on the protobuf-net I removed these
p48967
aVThe data serialized is still tracked, obviously
p48968
aVHowever, because the API is different than the binary data length for objects is not available "for free"
p48969
aVIf you clarify what the use-case is, I'm sure we can make it easily available (if it isn't already)
p48970
aVRe the comment; that is what I suspected
p48971
aVBecause protobuf-net defers the binary translation to the last moment (because it is dealing with regular
p48972
aVNET types, not some self-generated code) there is no automatic way of getting this value without doing the work
p48973
aVI could add a mechanism to let you get this value by writing to
p48974
aVbut if you need the data anyway you might benefit from just writing to  and checking the  in advance of copying the data
p48975
as(dp48976
g18
V23354
p48977
stp48978
a((dp48979
g2
(lp48980
VThere are various ways to do this; if you are re-opening the file, perhaps set it to truncate:
p48981
aVIf you are overwriting the file while already open, then just trim it after writing:
p48982
aVI would try to avoid delete/recreate, since this loses any ACLs etc
p48983
as(dp48984
g18
V23354
p48985
stp48986
a((dp48987
g2
(lp48988
VThe  implementation is indeed specific for compile-time properties, as it uses  etc and caches the generated code
p48989
aVIf you are using  you are already in a very different performance profile - for example, if your custom s work against a dictionary or hash-table as a property-bag they may already be significantly faster than raw reflection
p48990
aVIt may be possible to further optimise it, but I'd need to know more about the specific implementation
p48991
aVBut it would be non-trivial work, so first satisfy yourself that this member-access is actually a bottleneck, and that you couldn't do something simple like paging or "virtual mode" first
p48992
aV(clarification: I'm the author of HyperDescriptor, so I know this area well)
p48993
as(dp48994
g18
V23354
p48995
stp48996
a((dp48997
g2
(lp48998
VSince you are implementing  there is no need to add any attributes; you can just override  on the
p48999
aVI'm thinking it should be pretty simple to write an intermediary type that mimics (via  and ) a wrapped type but always returns readonly  instances
p49000
aVLet me know if you want an example (it isn't trivial though)
p49001
aVYou might also want to check whether something like this offers it built it
p49002
as(dp49003
g18
V23354
p49004
stp49005
a((dp49006
g2
(lp49007
VAn interesting part of this is that the behaviour will depend on your session-state provider
p49008
aVYou are presumably using the in-process provider at the moment, which keeps references - but most providers (understandably) use serialization
p49009
aVThis often bites people when they try to scale up, as they find that they have something non-serializable in session
p49010
aVSo you might consider pushing state into a different provider; SQL-Server, memcached, etc - they will all do serialization so the data will be independent
p49011
as(dp49012
g18
V23354
p49013
stp49014
a((dp49015
g2
(lp49016
VNot using the generated code
p49017
aVYou could hook into a stored procedure, but that may involve extra work
p49018
aVFor "last updated" data, it is possible to hook into the 's change-set that is obtained during the  method - so it is possible set properties (perhaps based on an interface) for the rows that are being submitted for
p49019
aVI have a similar issue, where my audit triggers behave differently based on which columns are part of the  statement (via  in the trigger), so in a similar question I needed to hack the data-context to always consider a specific column dirty
p49020
aVThat may have some cross-over
p49021
aVBut no: I don't think you can disable the triggers completely
p49022
as(dp49023
g18
V23354
p49024
stp49025
a((dp49026
g2
(lp49027
VThere is nothing wrong with the cast to  - however, I would actually avoid xor - it is easy to create collisions with likely values of the enums (1,2,3, etc)
p49028
aVNote that collisions don't break anything, but they can make things more expensive
p49029
aVI might use something like (picking at random taking inspiration from the C# compiler's handling of anonymous types):
p49030
as(dp49031
g18
V23354
p49032
stp49033
a((dp49034
g2
(lp49035
VVMs are ideal for i18n testing
p49036
aVCreate a VM for each OS languauge you need, and you're sorted
p49037
aVThere is an "all languages" version of Windows, but since that isn't what your client is going to be using it isn't a true test
p49038
aVTo get the true experience, you do need to have the right OS language - for example,
p49039
aVNET error messages can be wildly different (let's hope nothing is coded to the exact strings ;-p)
p49040
aVHowever, not knowing the text (to see what is right/wrong) could be a big problem
p49041
as(dp49042
g18
V23354
p49043
stp49044
a((dp49045
g2
(lp49046
VScoping aside (i
p49047
ag50
aVwhether the variable exists outside of the loop) there is usually no difference, since
p49048
aVNET variables are actually (in the IL) all at the start of the method anyway
p49049
aVHowever, there is an exception: if you capture the variable (into an anonymous method / lambda), then it behaves differently - the capture is constructed to respect the C# declaration
p49050
aVSo:
p49051
aVand:
p49052
aVWill do different things (the first prints the same address-based hash-code 9 times; the second prints 9 different address-based hash-codes, indicating that in the second loop we've captured 9 different variables, instead of a single variable)
p49053
aVIn both cases there are 9  objects created - simply that we can't see 8 of them any more in the first case
p49054
as(dp49055
g18
V23354
p49056
stp49057
a((dp49058
g2
(lp49059
VIn your code file, just change it:
p49060
aV(typically still only one class / etc per file)
p49061
aVIf you are moving all of them, then find+replace may help (ctrl+h)
p49062
aVYou should also be able to use the "class view" to help track them: View => Class View, or ctrl+w,c
p49063
as(dp49064
g18
V23354
p49065
stp49066
a((dp49067
g2
(lp49068
VThe compiler produces the following C# code:
p49069
aVNo - the compiler produces IL, which you are then translating to C#
p49070
aVAny resemblence to C# code is purely accidental (and not all the generated IL can be written as C#)
p49071
aVThe presence of all those "nop" tells me you're in "debug" mode
p49072
aVI would retry in "release" mode - it can make a big difference to these things
p49073
aVI fired it up in release mode, using:
p49074
aVGiving:
p49075
aVSo identical
p49076
as(dp49077
g18
V23354
p49078
stp49079
a((dp49080
g2
(lp49081
Vbut isn't _cache
p49082
aVAdd() making a copy (via Serialization) before it exits
p49083
aVNot necessarily
p49084
aVIf it is "in process" it will just store the object reference;  isn't really very serializable anyway (a  is a hose, not a bucket)
p49085
aVYou want to store the BLOB - not the :
p49086
as(dp49087
g18
V23354
p49088
stp49089
a((dp49090
g2
(lp49091
V(if you have LINQ and a  directive)
p49092
as(dp49093
g18
V23354
p49094
stp49095
a((dp49096
g2
(lp49097
VIf it is a struct, you're going to have to get the value out, modify it, and pass it back in:
p49098
aVBut frankly I think your assertion of an object (class) per cell being too expensive is missing the point
p49099
aVBTW, I would also advise that structs should be immutable whenever possible (with the possible exception of XNA, for specific reasons)
p49100
as(dp49101
g18
V23354
p49102
stp49103
a((dp49104
g2
(lp49105
VFirstly; C# has methods, not functions ;-p
p49106
aVMethods are scoped to the type; if you are trying to restrict to a file, can I therefore assume that this is a partial class (or maybe a set of nested types) that is (/are) split over multiple files
p49107
aVIf not (and it is a single file) just make the methods private
p49108
aVIf it is currently partial, then no: there is no way to avoid cross-calling between different files that are the same type
p49109
aVYou could create some nested static types per partial portion, but that seems ugly, hacky, and just wrong
p49110
aVIf it isn't actively hurting you - perhaps don't change it
p49111
as(dp49112
g18
V23354
p49113
stp49114
a((dp49115
g2
(lp49116
VWhat do you mean "an item"
p49117
aVIf a type is internal, you should see an error message
p49118
aVThe outermost exception isn't usually very helpful, but trace down through  to the bottom and it usually spells out exactly what the problem is
p49119
aVIf a member is entirely internal, then sure - it will be skipped
p49120
aVIMO, unit /integration tests are your real friend here - the desired output from serialization is ultimately outside the compiler, so it doesn't matter whether you get a compile-time message if the output doesn't match what you expect
p49121
aVWhat I mean here is: do the serialization and compare to an expected output file
p49122
aVDitto input
p49123
aVFor example, trying to serialize:
p49124
aVgives (at runtime):
p49125
aVUnable to generate a temporary class (result=1)
p49126
aVerror CS0200: Property or indexer 'MyType
p49127
aVValue' cannot be assigned to -- it is read only
p49128
aVwhich is pretty specific
p49129
as(dp49130
g18
V23354
p49131
stp49132
a((dp49133
g2
(lp49134
VTo control the namespace alias, use
p49135
aVIf you need to change the namespace at runtime, you can additionally use
p49136
as(dp49137
g18
V23354
p49138
stp49139
a((dp49140
g2
(lp49141
Vprotobuf-net has a  method that lets you deserialize into an existing instance
p49142
aVOnly values found in the stream are written (it doesn't wipe the object)
p49143
aVNot Microsoft, but pretty stable
p49144
aVTo expand on this; getting robust serialization that handles all the common scenarios is (I know from painful experience) a lot of work
p49145
aVMy recommendation would definitely be to re-use existing code where possible
p49146
aVprotobuf-net seems to offer everything you need; the current binaries simply require you to decorate your class (very similar to  from WCF - in fact it even supports  / ), but work is in place to allow it to work even against POCO - so you can use it with types outside your control
p49147
as(dp49148
g18
V23354
p49149
stp49150
a((dp49151
g2
(lp49152
VC# supports "lifted" operators, so if the type ( in this case) is known at compile you should just be able to use:
p49153
aVIf you need generics, then  is your friend:
p49154
aVNote, however, that both of these approaches use the "" approach (contrast to ANSI SQL)
p49155
aVIf you need ""  then you'll have to test that separately:
p49156
as(dp49157
g18
V23354
p49158
stp49159
a((dp49160
g2
(lp49161
VOne idea here might be to add a level of indirection (some kind of proxy / wrapper object)
p49162
aVThis would allow you to update objects, and remove objects (by setting it to ) without breaking iterators ( still remains a pain, though)
p49163
aVObviously you'd want to add an occasional "proper" remove that sweeps for , but this might work quite nicely with a  - since "get", iterate", "update" and "remove via set-to-null" now only require a read lock, and only "add" and "cleanup removed keys" requires a write lock
p49164
aVNote I'm using  here to avoid having to add my own code to ensure atomicity:
p49165
as(dp49166
g18
V23354
p49167
stp49168
a((dp49169
g2
(lp49170
VIn
p49171
aVNET, the group names are available against the  instance:
p49172
aVThen you can iterate based on this:
p49173
aVOr if you want to use LINQ:
p49174
as(dp49175
g18
V23354
p49176
stp49177
a((dp49178
g2
(lp49179
VPLEASE use  for this;  is rarely suitable for money types:
p49180
aVAnyway, a very crude approach (also assumes that the coins are sorted descending and that all values are non-negative) is below
p49181
aVIt gets trickier if you don't have coins for the lowest values (i
p49182
ag50
aVyou have 0
p49183
aV5M and 0
p49184
aV2M but no 0
p49185
aV1M and need to issue 0
p49186
aV8M - since this needs 4x0
p49187
aV2M, not 0
p49188
aV5M+0
p49189
aV2M+(damn))
p49190
as(dp49191
g18
V23354
p49192
stp49193
a((dp49194
g2
(lp49195
VThis isn't really up to the list being constructed, but rather is up to the specific  being iterated
p49196
aVIs this thread safe
p49197
aVIf it doesn't support concurrent iteration and edit, then expect an exception (or worse: unpredictable results)
p49198
aVMost
p49199
aVNET iterators will not like this; 4
p49200
aV0 introduces more concurrent collections, or you can write your own
p49201
aVIf the list is createD successfully (iterating the source), then once constructed the origin has no impact - the two are disconnected
p49202
as(dp49203
g18
V23354
p49204
stp49205
a((dp49206
g2
(lp49207
VWell - best practice is that structs should always (except in a few very specific scenarios, and even then at risk) be immutable
p49208
aVAnd immutable data is always thread safe
p49209
aVSo if you followed best practice and made this:
p49210
aVthen yes; that is thread-safe
p49211
aVIn all other cases the answer is "probably not"
p49212
aVNote also that atomicity rules apply, so even a single read or update to  cannot be assumed to be thread-safe, even with an immutable struct
p49213
aVYou could (especially for oversized structs) have one thread reading the struct while another thread re-writes it; without synchronization bad things will happen (eventually)
p49214
as(dp49215
g18
V23354
p49216
stp49217
a((dp49218
g2
(lp49219
V(note: might read a little oddly; that is because I merged a virtually identical
p49220
aVNET question; C# and Java are close enough that the concepts are identical)
p49221
aVWell, you should avoid  unless you are using
p49222
aVNET 1
p49223
aV1 (or micro-framework) - prefer typed collections like  where possible
p49224
aVThe difference comes from the cost of traversal and manipulation
p49225
aVIt is trivial to remove a node from the start or middle of a linked list, since you just re-link the nodes (likewise insert at any point)
p49226
aVRemoving an element from the start or middle of an array-backed list (including  and ) involves copying all the elements above that point (as does inserting)
p49227
aVIn both cases, inserting at the end is cheap (although the  etc will occasionally have to resize the underlying array to make space, but it does this in a fairly sensible way)
p49228
aVIf you just want to append, then use  etc
p49229
as(dp49230
g18
V23354
p49231
stp49232
a((dp49233
g2
(lp49234
VI don't know about Java, but in some languages nested types can do this:
p49235
aVOtherwise, use an accessor method or  a  field (although they are often abused)
p49236
as(dp49237
g18
V23354
p49238
stp49239
a((dp49240
g2
(lp49241
VI can see two problems; firstly you don't need the  for the  thru  cases (it is implicit)
p49242
aVSecondly - your delegate only has one arg (the array)
p49243
aVYou're going to need to get the items out of the array and cast - something like below (which handles pass-by-value only; for  /  you'll have to define a local and use stloc / ldloca / etc):
p49244
aVFor info - I'm lazy - if I want to know what IL to write I write it in C# and then load it into reflector
p49245
aVFor example, to do this I wrote a method:
p49246
aVand reversed it from there
p49247
as(dp49248
g18
V23354
p49249
stp49250
a((dp49251
g2
(lp49252
VI might suggest , except a: this is still slow AFAIK, and b: I tried it (below) and it seems to want to throw an exception on the property (don't know why; didn't look too deep)
p49253
aVAnother option may be , but you don't really want to do the  each time (better to do it once only and cache it, but that demands a known format)
p49254
aVFinally, you might cache a set of pre-compiled  setters (keyed against the member name)
p49255
aVIn reality this is probably your best bet
p49256
aVProperties are easy (you use Delegate
p49257
aVCreateDelegate) - fields might need DynamicMethod - but if you can't predict the layout in advance it'll have the least overhead
p49258
aVFor the keyed / IL approach (you won't get faster):
p49259
as(dp49260
g18
V23354
p49261
stp49262
a((dp49263
g2
(lp49264
V is pretty optimised - it is basically a wrapper over a raw mem-copy; so it should be pretty fast (and avoids messing with pointers and  code)
p49265
aVIt should be the default
p49266
aVYou could of course measure it each way
p49267
as(dp49268
g18
V23354
p49269
stp49270
a((dp49271
g2
(lp49272
VJust use  - and look for -ve, +ve and 0
p49273
aVThis supports both  and , and works for classes, structs and -of-structs
p49274
as(dp49275
g18
V23354
p49276
stp49277
a((dp49278
g2
(lp49279
VC# allows the  operator to be overloaded (and the  method to be overridden - although  and  don't have to mean the same thing)
p49280
aVIf you want to mean "the same instance", then  (for reference-types) is the best option
p49281
aVValue types default to internal equality
p49282
as(dp49283
g18
V23354
p49284
stp49285
a((dp49286
g2
(lp49287
Vsigned ( /  etc, rather that  / ) have the advantage of being CLS compliant, so that is recommended unless you have a good reason
p49288
aVRe  vs  - in most cases it is more efficient to compute with  (or ), since all the operators are optimised for this
p49289
aVIf you are only storing and retrieving it then this isn't an issue, of course
p49290
as(dp49291
g18
V23354
p49292
stp49293
a((dp49294
g2
(lp49295
VWith a  it is a bit of a moot point - since you are ultimately talking to a managed  (so it is still going to wait for routine garbage collection)
p49296
aVBut in general, yes: you should close (better:  via , so it gets shut down upon exception) the stream when done, otherwise you might not flush some data to the underlying (unmanaged) destination
p49297
aVAnd there are some streams that don't actually fully "flush" on  - they need to be d (compression streams in particular)
p49298
as(dp49299
g18
V23354
p49300
stp49301
a((dp49302
g2
(lp49303
VIf you are using , then it will be virtually impossible
p49304
aVDon't go there
p49305
aVProtocol buffers is designed to be portable, cross platform and version-tolerant (so it won't explode when you add new fields etc)
p49306
aVGoogle provide the C++ version, and there are several C# versions freely available (including my own) - see here for the full list
p49307
aVSmall, fast, easy
p49308
aVNote that the v1 of protobuf-net won't handle structs directly (you'll need a DTO class), but v2 (very soon) does have tested struct support
p49309
as(dp49310
g18
V23354
p49311
stp49312
a((dp49313
g2
(lp49314
VThe simplest thing here would be to simply enable http compression of your existing JSON
p49315
aVYou could possibly get more aggressive with it though - for example, I haven't played with it but a few weeks ago somebody mentioned a javascript protocol buffers implementation
p49316
aVHave your server return some raw bytes (or maybe base-64 or hex) and you could see some significant savings
p49317
aVIt would involve changing your code quite a bit, though
p49318
aVCaveat: although I'm pretty familiar with protobufs generally, I have not used that javascript implementation
p49319
aVYMMV
p49320
as(dp49321
g18
V23354
p49322
stp49323
a((dp49324
g2
(lp49325
Vprotobuf-net encodes this as a pair of fixed-length 64 bit values at fields 1 and 2
p49326
aVI haven't tried it for interop purposes, but you could try importing the (bespoke) bcl
p49327
aVproto (I think this is in the deployment folder; if not let me know and I'll add it; otherwise it is in the trunk)
p49328
aVBut conceptually it is just:
p49329
aVIf you get any problems, a fallback approach would be to send it (instead) as a  chunk, by adding  a shim property
p49330
aVLet me know if you want an example of that
p49331
as(dp49332
g18
V23354
p49333
stp49334
a((dp49335
g2
(lp49336
VBrowsers are inherently disconnected systems (to all intents and purposes)
p49337
aVYou cannot rely on getting any notification (from the client) for the end of a user's browser session
p49338
aVPersonally (as a user) I would find this single-login behaviour annoying as I regularly the the same website on different computers (laptop vs desktop vs home vs work vs vm host vs vm guest) or simply multiple browsers on the same machine (in particular browser-compatibility testing), but I accept that it may be a requirement
p49339
aVIMO, if you have a "single session" requirement the better approach to this is "last wins" - i
p49340
ag50
aVif you login the second session you doom the first (essentially breaking their token) - so the first session becomes logged off
p49341
aVThat is easy to do (in the database, just change a guid or increment a counter (against the specific user) at login)
p49342
aVIf needed you could log the IP (or whatever) of the second session against the one you are dooming, but if the second session can authenticate itself as "singh_nirajan" then that should be enough in most common scenarios
p49343
as(dp49344
g18
V23354
p49345
stp49346
a((dp49347
g2
(lp49348
VFor example:
p49349
as(dp49350
g18
V23354
p49351
stp49352
a((dp49353
g2
(lp49354
VThe wire format (defined by google - not inside my control
p49355
aVonly sends data for items
p49356
aVIt makes no distinction between an empty list and a null list
p49357
aVSo if there is no data to send - yes, the length is 0 (it is a very frugal format ;-p)
p49358
aVProtocol buffers do not include any type metadata on the wire
p49359
aVAnother common gotcha here is that you might assume your list property is automatically instantiated as empty, but it won't be (unless your code does it, perhaps in a field initializer or constructor)
p49360
aVHere's a workable hack:
p49361
aVHacky maybe, but it should work
p49362
aVYou could also lose the  "set" if you want and just drop the :
p49363
as(dp49364
g18
V23354
p49365
stp49366
a((dp49367
g2
(lp49368
VDepending on the serializer, it may be possible to drop items onto the end of the stream independently (and have it still possible to read the stream back again)
p49369
aVNot with "pure" xml (due to the root element), but I know of at least one serializer that supports sequential object read/write (no prizes for guessing which)
p49370
aVIf size is absolutely key, then perhaps go via a  - something like (pseudo code)
p49371
aVJob done
p49372
aVThis avoids writing partial objects by completing each individual object to the memory-stream (reusing the underlying memory whenever possible), and thus you only copy the data to the actual stream when you know it will fit
p49373
aVHere's a complete example using protobuf-net:
p49374
aVYou may be able to extend this approach to other serializers (such as  or ), but you'll presumably have to write your own length-prefix (at write), consume it (at read) and limit the data
p49375
aVNot rocket science, but not entirely trivial
p49376
as(dp49377
g18
V23354
p49378
stp49379
a((dp49380
g2
(lp49381
VThe key here is that the  can only be applied to a root type such as a class; if you are using a  as the root it won't work - but we can shim that with
p49382
aVI'm using the  approach (via ), but note that this isn't really the heart of the issue IMO (the root type is):
p49383
as(dp49384
g18
V23354
p49385
stp49386
a((dp49387
g2
(lp49388
VYou don't
p49389
aVYou setup a scheduled task; services as (generally) for background running processes
p49390
as(dp49391
g18
V23354
p49392
stp49393
a((dp49394
g2
(lp49395
VI suspect it is trying to re-use the types from the other reference
p49396
aVClick Advanced
p49397
aVand remove the "re-use types in referenced assemblies" box
p49398
aVYou should also ensure that the service name is unique, to avoid conflicts
p49399
as(dp49400
g18
V23354
p49401
stp49402
a((dp49403
g2
(lp49404
VYou mention
p49405
aVbut your source (and the bound property) are both  - so it isn't a value you want to bind, but the item itself
p49406
aVUnfortunately, there is no  so you might need to hack it a bit to get 2-way binding
p49407
as(dp49408
g18
V23354
p49409
stp49410
a((dp49411
g2
(lp49412
VIn terms of efficiency I expect you'd be hard-pressed to beat:
p49413
aVThis avoids the array construction / allocation associated with  , and only looks as far as the first delimited
p49414
aVBut I should stress that this is unlikely to be a genuine performance bottleneck unless the data volume is huge, so pretty-much any approach should be fine
p49415
aVIn fact, perhaps the most important thing (I've been reminded by the comment below) is to suspend the UI while adding:
p49416
as(dp49417
g18
V23354
p49418
stp49419
a((dp49420
g2
(lp49421
VThe short versions is: yes
p49422
aVit looks like that is the simplest approach
p49423
aVI've tried the "obvious" things (in particular the  and  patterns that  supports, but also ) and it just keeps on not including the value
p49424
aVThe next options would be either  (which is plain hard), or  (a duplication of effort) - neither of which is particularly enticing here
p49425
aVI wonder if your current approach is less work
p49426
aVYou could of course simply export the WSDL and edit that to remove the default (and generate from the edited version)
p49427
aVAs an aside - if this was WCF, there is the  that does control this; maybe they added this as a feature request
p49428
as(dp49429
g18
V23354
p49430
stp49431
a((dp49432
g2
(lp49433
V to the rescue; a simple (but complete) example:
p49434
as(dp49435
g18
V23354
p49436
stp49437
a((dp49438
g2
(lp49439
VHaving  (which includes ) doesn't demand a comma - it simply allows it
p49440
aVSo you could use  with or without the comma
p49441
aVOr use  or
p49442
aVNote that "comma" is swappable with "thousands separator" - i
p49443
ag50
aVin some of Eurupe it may vary (period etc)
p49444
aVIf you mean "comma is thousands" then use a fixed culture (such as )
p49445
as(dp49446
g18
V23354
p49447
stp49448
a((dp49449
g2
(lp49450
VWhile practice is all well and good, CSV is actually a lot more complex than the name suggests - you have quoted/unquoted, multi-line, and the horrible issue where in some areas the "c" becomes a period ("
p49451
aVI strongly recommend you use something pre-rolled, such as CsvReader
p49452
aV(Fortunately TSV isn't usually nearly so nasty)
p49453
as(dp49454
g18
V23354
p49455
stp49456
a((dp49457
g2
(lp49458
VIn line with the wire-spec, there is an implicit zero default (which can be changed to other values with
p49459
aVYou can tell it to behave itself as you want by setting  in the attribute:
p49460
as(dp49461
g18
V23354
p49462
stp49463
a((dp49464
g2
(lp49465
VIn C# you can do this as below, so I hope this translates identically to VB
p49466
aVNote this only applies to field-like events (i
p49467
ag50
aVwhere you don't have your own /):
p49468
aVOtherwise something like:
p49469
as(dp49470
g18
V23354
p49471
stp49472
a((dp49473
g2
(lp49474
VIt really depends what you want to do; but ultimately common data-binding (for simple properties, done manually) consists of:
p49475
aVobtaining a property; preferably via , giving you an abstraction ()
p49476
aVasking the property if it is read-only ()
p49477
aVobtain (or set) the value (, )
p49478
aVasking it for a converter to format / parse the value (, , ) THIS is a key bit that means you don't have to worry about what the data type is
p49479
aVasking it for the caption (, or  if that it empty/null)
p49480
aVasking it if it supports property-specific notification ()
p49481
aVasking it to add/remove a change handler (, )
p49482
aVyou might also want to look at whether the object supports centralised notification (look for )
p49483
aVIf you might be binding to a list rather than a single object:
p49484
aV- the list might be abstracted behind
p49485
aV- the list might have custom properties, so check for
p49486
aV- otherwise, identify the  of the items and use
p49487
aV- you need to consider a "currency manager" (i
p49488
ag50
aVshould all the things bound to the same list be pointing to the same record in the list all the time)
p49489
aVThere are also things like  and  to consider, but most of the time  handles this for you automatically
p49490
aVAs you can see - lots of things to think about
p49491
aVLots of work
p49492
aVthe one thing that you don't have to do is reflection; this is abstracted behind
p49493
aVThe reason for this is that not all data is static-typed; think about  - the columns (which map to bindable data properties) are not fixed at compile-time, so reflection isn't appropriate
p49494
aVLikewise, some other types have custom "property bag" implementations
p49495
aVlets your code handle either dynamic (not in the 4
p49496
aV0 sense) and reflective properties identically
p49497
aVIt also works nicely with things like "HyperDescriptor", another property customisation
p49498
as(dp49499
g18
V23354
p49500
stp49501
a((dp49502
g2
(lp49503
VSimply:
p49504
aV(or have I misunderstood something
p49505
as(dp49506
g18
V23354
p49507
stp49508
a((dp49509
g2
(lp49510
VNo
p49511
aVC# lambdas don't support events, so there is no way of representing this
p49512
aVYou'll have to use reflection
p49513
as(dp49514
g18
V23354
p49515
stp49516
a((dp49517
g2
(lp49518
VRe-use the  instance
p49519
aVNOTE I've edited this to show passing the  instance down, but I'm really not sure what  is trying to do - it looks like it is juts burning up CPU cycles
p49520
aVI would suggest you can remove  completely (and just use the next value from the  in ), but presumably you are trying to do something here - I'm just not sure what
p49521
aVWhen you create a , it is "seeded" using the system clock, but this is rounded heavily
p49522
aVIf you create lots of  in a tight loop, they all get the same "seed", so they all create the same next number
p49523
aVIf necessary you could move the  further out (if you have other loops), or make it  (but if you do that you need to worry about synchronization too)
p49524
as(dp49525
g18
V23354
p49526
stp49527
a((dp49528
g2
(lp49529
VI can only really comment on sql-server, but there are some thigns to try:
p49530
aVcommand batching (i
p49531
ag50
aVdo multiple  in a single hit to the db)
p49532
aVbulk insert (via )
p49533
aVeither should give significant improvements on single-row inserts (the latter being fastest)
p49534
as(dp49535
g18
V23354
p49536
stp49537
a((dp49538
g2
(lp49539
VI'm reading "bulk insert" as
p49540
aVThere are two ways to work with
p49541
aVThe first is to pre-process your data into a
p49542
aVThis is simple and easy, but is only suitable for small-to-moderate data due to the requirement to buffer all the data into a  first
p49543
aVThe second is to create an ; this is a streaming API, so can be used for huge forwards-only data sources (such as massive log files)
p49544
aVI wrote a  that you can see here (ignore the xml; focus on the usage) that I use in a few places
p49545
aVIt works fine; all you do is:
p49546
aVin the constructor, tell the base constructor the types for the columns
p49547
aVin  attempt to read the next row (perhaps  on a text-reader), and  either call  and return , or return  if there is no more data
p49548
aVoverride  if you want to clean up anything once the data is consumed (close the file, perhaps)
p49549
as(dp49550
g18
V23354
p49551
stp49552
a((dp49553
g2
(lp49554
VUltimately this indicates that at you last line of defence (before any database constraints, at least) your data was invalid
p49555
aVIf you want to do something other than scream loudly, then perhaps verify the data (via any of a multitude of approaches) before adding it to the insert list
p49556
aVAs an additional thought, you could try overriding  (on the data-context); obtain the change-set, verify the inserts and remove (delete-on-submit, which IIRC checks the insert list and drops them) any that you've decided were mistakes
p49557
aVThen call the
p49558
aVBut to me this is a bit backwards
p49559
aVTo illustrate, this only does a single insert (not two as requested), but I don't like this approach
p49560
aVAt all
p49561
aVAs long as we're clear ;-p
p49562
as(dp49563
g18
V23354
p49564
stp49565
a((dp49566
g2
(lp49567
VIt really depends on what you need to achieve
p49568
aVDatabases have a place, but flat files are also perfectly fine for data (via serialization)
p49569
aVSo; what problems is the xml giving you
p49570
aVIf you can answer that, then you'll know what the pain points are that you want to address
p49571
aVYou mention "game", and indeed flat files tend to be more suitable (assuming you want minimum overhead etc), but either would normally do fine
p49572
aVBinary serialization might be more efficient in terms of CPU and disk (but I don't recommend  - it will bite you when you change the types)
p49573
aVI'm not anti-database (far from it) - I just wanted to present a balanced viewpoint ;-p
p49574
as(dp49575
g18
V23354
p49576
stp49577
a((dp49578
g2
(lp49579
V only affects a very specific use-case; i
p49580
ag50
aVfrom within
p49581
aVFor the rest of reflection, it knows nothing about the extra attribute
p49582
aVAnd indeed,  doesn't really apply to methods or parameters
p49583
aVSo in short; you can't
p49584
aVYou will need to store this information somewhere else (bespoke), or add it at compile-time
p49585
as(dp49586
g18
V23354
p49587
stp49588
a((dp49589
g2
(lp49590
VYou should be able to do this via the :
p49591
aVAs for considerations - the main one would be: does the underlying data format support append
p49592
aVMany don't, unless it is your own raw data, or text etc
p49593
aVA well-formed xml document doesn't support append (without considering the final end-element), for example
p49594
aVNor will something like a Word document
p49595
aVSome do, however
p49596
aVSo; is your data OK with this
p49597
as(dp49598
g18
V23354
p49599
stp49600
a((dp49601
g2
(lp49602
VSome quick searching (google) shows that this is the EVE API cache mechanism kicking in
p49603
aVIf you query the same data from the same key and IP, it tells you to re-use what you already have
p49604
aVSo make sure you write any results you do get to disk or database straight away
p49605
aVSome cache times are 1 day
p49606
as(dp49607
g18
V23354
p49608
stp49609
a((dp49610
g2
(lp49611
VThere are various approaches here, but utlimately most of them come down to your changing the executed threads to do something whenever they leave (success or via exception, which you don't want to do anyway)
p49612
aVA simple approach might be to use  to reduce a counter - and if it is zero (or -ve, which probably means an error) release a  or  an object; in either case, the original thread would be waiting on that object
p49613
aVA number of such approaches are discussed here
p49614
aVOf course, it might be easier to look at the TPL bits in 4
p49615
aV0, which provide a lot of new options here (not least things like  in PLINQ)
p49616
aVIf you are using a synchronized work queue, it might also be possible to set that queue to close (drain) itself, and simply wait for the queue to be empty
p49617
aVThe assumption here being that your worker threads are doing something like:
p49618
aVin which case, once the queue is empty all your worker threads should already be in the process of suicide
p49619
as(dp49620
g18
V23354
p49621
stp49622
a((dp49623
g2
(lp49624
VIs everything a simple getter
p49625
aVEven
p49626
aVI can only assume that sometihng funky is going on (perhaps with dynamic type creation and silent overrides that you don't see in you code - are the members
p49627
aVHowever, to fix it I would try grabbing the particulars into variables:
p49628
as(dp49629
g18
V23354
p49630
stp49631
a((dp49632
g2
(lp49633
VSimple:
p49634
aVand add the  parameter with value:
p49635
as(dp49636
g18
V23354
p49637
stp49638
a((dp49639
g2
(lp49640
VHave you checked what the column thinks it is called
p49641
aVIt might have underscores, for example
p49642
aVLoop over the columns and find out (sorry, examples in C#):
p49643
aVActually, it is faster to use the column if you are doing it in a loop, so I might use something like:
p49644
as(dp49645
g18
V23354
p49646
stp49647
a((dp49648
g2
(lp49649
VIt depends what you are doing, but ultimately this is rarely going to be a significant decision (since the value is the same)
p49650
aVPerhaps worry about "bigger" problems
p49651
aVFor interest, in
p49652
aVNET the JIT (not the compiler) can spot this pattern and eliminate the out-of-bounds checks, but only if it is something obvious like:
p49653
as(dp49654
g18
V23354
p49655
stp49656
a((dp49657
g2
(lp49658
VYou could just keep the previous value instead:
p49659
as(dp49660
g18
V23354
p49661
stp49662
a((dp49663
g2
(lp49664
VIs your enum by any chance in a file named the same as the dbml
p49665
aVThere is a bug in 3
p49666
aV5 (fixed in 4
p49667
aV0) where conflicts cause an empty file
p49668
aVOddly, usually moving the  directives (and right-click; run custom tool) fixes it
p49669
aVSo if you have "foo
p49670
aVdbml" and your own "foo
p49671
aVcs" (in the same folder) with:
p49672
aVit will break (generate an empty foo
p49673
aVdesigner
p49674
aVcs)
p49675
aVIf you have:
p49676
aVit will work
p49677
aVI'm not kidding
p49678
aVLikewise, renaming "foo
p49679
aVcs" to "bar
p49680
aVcs" (and right-click, run custom tool) will fix it
p49681
as(dp49682
g18
V23354
p49683
stp49684
a((dp49685
g2
(lp49686
VI honestly have no idea whether AutoMapper will do that (since I don't use AutoMapper much), but I know that protobuf-net supports both those patterns, so you could use  to flip between them
p49687
aVThe current version is, however, pretty dependent on having attributes (such as ) on the members - I don't know if that causes an issue
p49688
aVThe in progress version supports vanilla types (without attributes), but that isn't complete yet (but soon)
p49689
aVExample:
p49690
as(dp49691
g18
V23354
p49692
stp49693
a((dp49694
g2
(lp49695
VNo; that won't guarantee that the  is disposed if the  constructor throws an exception
p49696
aVBut you can do:
p49697
as(dp49698
g18
V23354
p49699
stp49700
a((dp49701
g2
(lp49702
VNot conveniently, no
p49703
aVYou can get values for types you expect by using the indexer - either  or  - but to get a list of all the data inside would require reflection (it isn't exposed on the API)
p49704
aVBy inspection (although this is brittle), there is a field called  that is a  (keyed by )
p49705
aVEach object in the  is itself a  (keyed by member-name, with  for the type's own settings)
p49706
aVGood luck, and don't blame me if it falls in a big heap when you apply some hotfix or new
p49707
aVNET version
p49708
as(dp49709
g18
V23354
p49710
stp49711
a((dp49712
g2
(lp49713
V100 is far too few, and running in a test framework may skew things
p49714
aVIt is also possibly (see comments) related to any additional cost associated with the first lock against an object; try:
p49715
aVlocking once outside the loop first
p49716
aVdoing lots more iterations
p49717
aVin a console exe, at the command line, in release mode
p49718
aVAlso, note that in 4
p49719
aV0  is not  - so expect different results in 4
p49720
ag190
aVBut I get:
p49721
aVFrom the test rig:
p49722
as(dp49723
g18
V23354
p49724
stp49725
a((dp49726
g2
(lp49727
VSimple; don't inherit from :
p49728
as(dp49729
g18
V23354
p49730
stp49731
a((dp49732
g2
(lp49733
VThere are a number of different ways to do this
p49734
aVThe simplest is to do something akin to how certain i18n products do it - subclass the attribute and intercept the text; but this only works if you own the type, and from an attribute you can't access the context
p49735
aVThe next things to look at would be , since this provides access to the component-model view on the properties, and is simpler than the next two options ;-p This will work with , but not  etc
p49736
aVNext on the list is  - not a fun interface to implement, but you can swap in your own property-descriptor
p49737
aVThis requires that you own the type (in order to provide the interface support)
p49738
aVFinally,  is like the last, but works even for types you don't own, and allows access to tweaked metadata at both the type and object level (everything else only supports object)
p49739
aVWhich to choose
p49740
aVI suspect that  would be the most sensible; you need the object-context (which a subclassed attribute doesn't provide), but you don't need the extra complexity
p49741
aVHere's an example; note that in the  code we have access to the object-context
p49742
aVIf the name is simple, then putting it in the  (when creating the property) should suffice
p49743
as(dp49744
g18
V23354
p49745
stp49746
a((dp49747
g2
(lp49748
VIt is up to the underlying data-source what operations it supports
p49749
aVI believe that  is the only one that out of the box supports this
p49750
aVYou could check (in this case) via:
p49751
aVSo; what is the underlying data source
p49752
aVA  (or even ) won't provide this
p49753
as(dp49754
g18
V23354
p49755
stp49756
a((dp49757
g2
(lp49758
VHmm
p49759
aVthe only thing in there that I might expect to be messy is the  (I recently realised that my encoding of this appears to be fairly crazy-endian)
p49760
aVSo I think that should work fine, give or take some messy code to decipher the
p49761
aVTo rule out an encoding error, what I would suggest is:
p49762
aVserialize the data via C#, to a file (or just look at the bytes on-screen in the debugger)
p49763
aVserialize the /same/ data via C++, to a file (or just look at the bytes on-screen in the debugger)
p49764
aVThen:
p49765
aVcompare the bytes
p49766
aVcheck the length is what you expect (i
p49767
ag50
aVthe number you are passing over)
p49768
aVThat should indicate whether it is the encoding, vs something to do with passing the wrong memory address or similar
p49769
aVAlso - check you aren't using  (or at least, if you do use , make sure you use the  from the , and not from the oversized )
p49770
as(dp49771
g18
V23354
p49772
stp49773
a((dp49774
g2
(lp49775
VIIRC, there is also a warning about generics via reflection
p49776
aVI believe it calls out interfaces rather than concrete types, but the same may apply - in particular when using reflection
p49777
aVPersonally, I'm just dropping reflection when dealing with iPhone - it is easier
p49778
aVI'm still doing meta-programming, but I'm pre-generating regular code (on the full framework) which I then take over to MonoTouch
p49779
aVIt seems to work pretty robustly
p49780
as(dp49781
g18
V23354
p49782
stp49783
a((dp49784
g2
(lp49785
Vthe difference between  and  in the two
p49786
aVthe difference between a  alias and a
p49787
aVwhen do my objects get collected
p49788
aVhow do I destroy them now
p49789
aVhow big is an
p49790
aV(it is actually defined in C#)
p49791
aVwhere's my linker
p49792
aV(actually, Mono does have a full AOT linker for some scenarios)
p49793
as(dp49794
g18
V23354
p49795
stp49796
a((dp49797
g2
(lp49798
VWell, I'd just use  (if you are trying to avoid a custom equality operator, perhaps cast to  - it will be a nop cast anyway)
p49799
aVOther than than, my money would go with , but you could also use  since it handles  etc
p49800
aVFor completeness: why would I just use  /
p49801
aVSimple: the compiler can do this directly
p49802
aVThe IL for a null-check against an object is actually:
p49803
aVload the ref
p49804
aVbranch if true (or branch if false)
p49805
aVThat's it
p49806
aVTwo IL instructions
p49807
aVIt doesn't even do a "load null, equality check" - since the definition of "true" is "anything that isn't 0/null", and "false" is "0/null"
p49808
aVFor something like , that is:
p49809
aVload the ref
p49810
aVload the null
p49811
aVcall the method
p49812
aV(which creates a stackframe)
p49813
aVload the first arg
p49814
aVload the second arg
p49815
aVdo an equality check
p49816
aV(then passes the value back down the stack frame returning true/false)
p49817
aVbranch if true (or branch if false)
p49818
aVI know which I prefer
p49819
as(dp49820
g18
V23354
p49821
stp49822
a((dp49823
g2
(lp49824
VThe messages are events on the connection; look at , or the example here
p49825
as(dp49826
g18
V23354
p49827
stp49828
a((dp49829
g2
(lp49830
VI assume you only have one server, so this isn't due to load-balancing
p49831
aVStatic data should stick around, unless IIS is recycling the app for some reason
p49832
aVBTW, you should really use  for that, but this shouldn't cause the problem you are seeing (unless you are under massive load, and you are seeing things like
p49833
as(dp49834
g18
V23354
p49835
stp49836
a((dp49837
g2
(lp49838
VWhich  is that
p49839
aVIs that a BCL class
p49840
aVTPL class
p49841
aVOr custom
p49842
aVNo matter; simply - I wouldn't
p49843
aVYou could do something early in the thread's life to store the thread reference, but I simply wouldn't use the  for this job as it sounds like it is longer running
p49844
aVA regular  would seem more appropriate
p49845
aVI'm also surprised that there is no inbuilt method of telling the queue to release all the workers - I've written blocking queues before, and I tend to use the pattern (for example, from here):
p49846
aVwith this:
p49847
aVreturning true immediately if there is data
p49848
aVblocking and (eventually) returning true if there isn't data but some is added
p49849
aVblocking and (eventually) returning false if the queue is being shut down
p49850
as(dp49851
g18
V23354
p49852
stp49853
a((dp49854
g2
(lp49855
VXml with invalid characters in it is not xml
p49856
aVIt could be an isolated glitch, or it could be a portent that there is significant data corruption throughout the file - some which manifests as invalid characters (breaking standard readers), and some which silently damages your data without you noticing
p49857
aVI would treat the entire thing as suspect (i
p49858
ag50
aVreject it) and get it fixed at source
p49859
as(dp49860
g18
V23354
p49861
stp49862
a((dp49863
g2
(lp49864
VWith the generic list, you can  /  etc cheaply (at least, at the far end)
p49865
aVResizing an array (to add/remove) is more expensive
p49866
aVThe obvious downside is that a list has spare capacity so maybe wastes a few bytes - not worth worrying about in most cases, though (and you can trim it)
p49867
aVGenerally, prefer lists unless you know your data never changes size
p49868
aVAPI-wise, since LINQ there is little to choose between them (i
p49869
ag50
aVthe extra methods on  are largely duplicated by LINQ, so arrays get them for free)
p49870
aVAnother advantage is that with a list you don't need to expose a setter:
p49871
aVeliminating a range of  bugs, and allowing you to keep control over the data (especially if you use a different  implementation that supports inspection / validation when changing the contents)
p49872
as(dp49873
g18
V23354
p49874
stp49875
a((dp49876
g2
(lp49877
VIf finding the "<>
p49878
aVname is tricky for your scenario, how about making it a regular method
p49879
aVThis is usually very simple; the only tricky thing is captured variables, but that isn't too bad - for example these do the same thing:
p49880
as(dp49881
g18
V23354
p49882
stp49883
a((dp49884
g2
(lp49885
VWell,  and  aren't objects - they are s
p49886
aVSo they don't have a heap presence (unless they are on a field), but conversely copying them does possibly have an impact (not a huge one - they aren't very big)
p49887
aVIf you are using them in a tight loop, then fine - pre-initialise them in a variable
p49888
aVOf course, you could just refactor your current x / y and width / height to use the  etc for storage
p49889
aVNote also that (contrary to most scenarios) they are actually mutable structs, so you can change their internal values inside your loop, etc
p49890
aVAlso note that IIRC there are overloads of many of the graphics operations that take the primitive values instead of the structs - have you considered those
p49891
aVUltimately, though, I don't think this is going to have any noticeable impact compared to the actual graphics operations
p49892
aVDon't stress it; if your code works
p49893
as(dp49894
g18
V23354
p49895
stp49896
a((dp49897
g2
(lp49898
VHow about:
p49899
as(dp49900
g18
V23354
p49901
stp49902
a((dp49903
g2
(lp49904
VFor a reference-type, it returns
p49905
aVFor a value-type other than  it returns a zero-initialized value
p49906
aVFor  it returns the empty (pseudo-null) value that (actually, this is a re-statement of the second bullet, but it is worth making it explicit)
p49907
aVThe biggest use of  is in generics, and things like the  pattern:
p49908
aVAs it happens, I also use it in some code-generation, where it is a pain to initialize fields / variables - but if you know the type:
p49909
as(dp49910
g18
V23354
p49911
stp49912
a((dp49913
g2
(lp49914
VDoesn't that compile to the equivalent of (in C# terms):
p49915
aVwhere-as to get "DATABASEPW" in the right namespace you would need the equivalent of:
p49916
aVTranslate to VB and you should be set
p49917
aVReflector assures me (but don't quote me
p49918
aVthat this is something like:
p49919
as(dp49920
g18
V23354
p49921
stp49922
a((dp49923
g2
(lp49924
VI would expect that to work at both ends, but I'm not sure it is a great idea; it requires extra configuration, and won't work on Silverlight etc
p49925
aVBut it'll probably work for "full"
p49926
aVNET with the same bits at each end
p49927
as(dp49928
g18
V23354
p49929
stp49930
a((dp49931
g2
(lp49932
VIf you are on about speed, then technically I would expect the  version to be faster, as there is a specific IL instruction for getting an  from an array (see )
p49933
aVTo do a custom struct it has to get the address () and then copy the struct () - processing the type metadata for both of those steps
p49934
aVIn short - the  approach should have better optimisations
p49935
aVBut this is micro-optimisation - in general prefer the version that makes your code more readable
p49936
aVWhat you might consider is writing the struct with a custom static implicit conversion operator from  to your struct - then you can have the  and still do:
p49937
aV(it'll do a static call in the middle, of course)
p49938
aVYou might also consider using a union so you don't need to do lots of shifting:
p49939
aVIMPORTANT I haven't sanity checked the endianness on this; just change the offsets of R/G/B to change it
p49940
as(dp49941
g18
V23354
p49942
stp49943
a((dp49944
g2
(lp49945
VBy default, protobuf (the Google spec, not proobuf-net specifically) is designed to allow you to treat consecutive messages as part of a single object - i
p49946
ag50
aVyou can add fields to a message simply by concatenating, which is essentially what you are doing here
p49947
aVEach top-level object does not (by default) have any kind of separation from the next object
p49948
aVTo get it to treat them as different objects, look at the  methods (or you can use the  versions - perhaps ; note also that it will apply length prefixes automatically if you give it something like a list to serialize); for example:
p49949
aVEssentially:
p49950
as(dp49951
g18
V23354
p49952
stp49953
a((dp49954
g2
(lp49955
VFor sub-objects,  gives you an xml-reader limited to the sub-objects, but I really think that you are doing this the hard way
p49956
aVUnless you have very specific requirements for handling unusual / unpredicatable xml, use  (perhaps coupled with  if you really want)
p49957
aVis
p49958
aVtricky
p49959
aVContrast to:
p49960
as(dp49961
g18
V23354
p49962
stp49963
a((dp49964
g2
(lp49965
VCan you define "will not work"
p49966
aVNote that the client and server must agree; Silverlight has only a limited subset of extension points, but it seems that  is supported (source and more info) - so perhaps add it to the client
p49967
as(dp49968
g18
V23354
p49969
stp49970
a((dp49971
g2
(lp49972
VThe first argument is resolved from the object reference (or  for static methods); no magic there
p49973
aVRe the second argument, however - it is an unmanaged pointer (native int); in short, there is no alternative direct C# syntax that can use this constructor - it uses a specific IL instruction () to resolve the function from metadata
p49974
aVHowever, you can use  to create delegates via reflection
p49975
aVYou can also use IL emit ( etc), but it isn't fun
p49976
as(dp49977
g18
V23354
p49978
stp49979
a((dp49980
g2
(lp49981
VLINQ is a broad set of technologies, based around (for example) a query comprehension syntax, for example:
p49982
aVwhich is mapped by the compiler into code:
p49983
aVand here the real magic starts
p49984
aVNote that we haven't said what  is here - and the compiler doesn't care
p49985
aVAs long as it can resolve some suitable method called  that can take a lambda, and the result of that has some  method that can accept the lambda, it is happy
p49986
aVNow consider that the lambda can be compiled either into an anonymous method (delegate, for LINQ-to-Objects, which includes LINQ-to-DataSet), or to an expression-tree (a runtime model that represents the lambda in an object model)
p49987
aVFor in-memory data (typically ), it just executes the delegate - fine and fast
p49988
aVBut for  the object-representation of the expression (a ) it can pull it apart and apply it to any "LINQ-to-Something" example
p49989
aVFor databases (LINQ-to-SQL, LINQ-to-Entities) this might mean writing TSQL, for example:
p49990
aVBut it could (for ADO
p49991
aVNET Data Services, for example) mean writing an HTTP query
p49992
aVExecuting a well-written TSQL query that returns a small amount of data is faster that loading an entire database over the network and then filtering at the client
p49993
aVBoth have ideal scenarios and plain-wrong scenarios, though
p49994
aVThe goal and benefit here is to allow you to use a single, static-checked syntax to query a wide range of data-sources, and to make the code more expressive ("traditional" code to group data, for example, isn't very clear in terms of what it is trying to do - it is lost in the mass of code)
p49995
as(dp49996
g18
V23354
p49997
stp49998
a((dp49999
g2
(lp50000
VYou could add the  constraint:
p50001
aVIf you don't have the constraint, then  may help (minus the compile-time checking):
p50002
aVIf you mean you the type itself, then probably something like:
p50003
as(dp50004
g18
V23354
p50005
stp50006
a((dp50007
g2
(lp50008
VHowever, note that  is not necessarily a good choice for this (prefer  unless you have a good reason)
p50009
aVOr to avoid LINQ entirely:
p50010
as(dp50011
g18
V23354
p50012
stp50013
a((dp50014
g2
(lp50015
VRe-using expression trees is a black art; you can do it, but you would need to switch a lot of code to reflection and you'd lose all the static checking
p50016
aVIn particular, working with the anonymous types becomes a nightmare (although  in 4
p50017
aV0 might be workable)
p50018
aVFurther, if you cheat and use , then it isn't supported by all providers (most noticeably not on EF in
p50019
aVNET 3
p50020
aV5SP1)
p50021
aVUnless this is a major pain point, I'd leave it with duplication
p50022
aVOr do you need to re-use the expression tree
p50023
as(dp50024
g18
V23354
p50025
stp50026
a((dp50027
g2
(lp50028
VThe serializer and the transport are largely unrelated
p50029
aVThere are pre-configured bindings for common scenarios, but my understanding is that you can plug the binary serializer () into any transport
p50030
aVOr write your own ;-p
p50031
aVHowever - a different transport may be trickier to configure (firewalls etc) than plain HTTP
p50032
aVSee here (although I would dispute the speed claim; I've seen  thrashed on occasion
p50033
aVRe comment - not so much the transport (I suspect you're best off staying with http), but consider this and this
p50034
aVAn alternative binary serializer, excellent for sending some types of messages
p50035
aVAnd it plays nicely with MTOM (over http) too
p50036
as(dp50037
g18
V23354
p50038
stp50039
a((dp50040
g2
(lp50041
Vthere are tens of events
p50042
aVPersonally, then I'd just add the non-serialized markers, which for field-like events is most easily done via:
p50043
aV(you don't need to add a manual backing delegate)
p50044
aVWhat are your serialization requirements exactly
p50045
aVis in many ways the least friendly of the serializers; the implications on events are a bit ugly, and it is very brittle if stored (IMO it is only really suitable for transport, not for storage)
p50046
aVHowever; there are plenty of good alternatives that would support most common "deep clone" scenarios:
p50047
aV(but limited to public members)
p50048
ag23295
aVprotobuf-net (which includes  for this purpose)
p50049
aV(note that in most of those serialization support would require extra attributes, so not much different to adding the  attributes in the first place
p50050
as(dp50051
g18
V23354
p50052
stp50053
a((dp50054
g2
(lp50055
V(this answer is incorrect (see comments), but is deliberately left here to stop other answers stumbling blindly into the same hole)
p50056
aVIIRC, it also needs to be an
p50057
aV(and ideally the service itself would be a )
p50058
as(dp50059
g18
V23354
p50060
stp50061
a((dp50062
g2
(lp50063
VThe real issue here is the use of , which breaks "composition" of queries; this has two effects:
p50064
aVyou are reading all (or at least, more than you need) of your table each time, even if you ask for a single row
p50065
aVyou are running LINQ-to-Objects rules, so case-sensitivity applies
p50066
aVInstead, you want to be using  inside your data layer, allowing you to combine multiple queries with additional , , , , etc as needed and have it build the TSQL to match (and use your db's case-sensitivity rules)
p50067
aVIs there a more efficient way to write these "helper" type classes
p50068
aVFor more efficient (less code to debug, doesn't stream the entire table, better use of the identity-map to short-circuit additional lookups (via  etc)):
p50069
as(dp50070
g18
V23354
p50071
stp50072
a((dp50073
g2
(lp50074
VIf you just need to know if it exists, then perhaps:
p50075
aVIf you want the row (or  if it doesn't exist), then:
p50076
aVactually, in
p50077
aVNET 3
p50078
aV5 there is arguably a benefit to using:
p50079
aVbut this is fixed in 4
p50080
aV0 and both work the same
p50081
aVThe difference is that in 3
p50082
aV5SP,  doesn't check the identity-manager, so it would hit the db even if it already knows about the row you asked for (because it has it in-memory)
p50083
as(dp50084
g18
V23354
p50085
stp50086
a((dp50087
g2
(lp50088
VFirst; do you have a  that spans this, that you haven't committed
p50089
aVHowever, more liktely: is this a database file that you are deploying with the system (rather than a separate database server)
p50090
aVIf so, every time you hit "build" etc, it copies the version from your solution folder into the build output (bin/debug or bin/release)
p50091
aVLook in the build output copy; see if that has been updated
p50092
as(dp50093
g18
V23354
p50094
stp50095
a((dp50096
g2
(lp50097
VData-binding 50k rows is going to take a while
p50098
aVI would first look at reducing the data volume (what is any user really going to do with 50k rows)
p50099
aVBut otherwise: "virtual mode" (what | how)
p50100
aVEdit; I suspect most of the time is being spent doing things like building control trees and other structures, but it might be that the reflection-based member-access is slowing this down; if so, maybe HyperDescriptor could help (simply by adding a 1 line call in your code to enable it for the associated type)
p50101
as(dp50102
g18
V23354
p50103
stp50104
a((dp50105
g2
(lp50106
VThe most pragmatic option may be compositon:
p50107
aVIf you need something re-usable, you're going to have to get your hands dirty building (and probably parsing) expression-trees ()
p50108
aVNot trivial
p50109
as(dp50110
g18
V23354
p50111
stp50112
a((dp50113
g2
(lp50114
VPerhaps
p50115
aVOr just use an xml DOM ( or ) as data-storage
p50116
aVNeither is ideal, of course - but there is little point creating a type at runtime just for this if your real code will ever see it
p50117
aVWhat purpose would the extra class type serve
p50118
aVAmong other issues you'd have to use lots of reflection just to talk to it
p50119
aVThe other option is a custom property-bag and , but that is effort
p50120
as(dp50121
g18
V23354
p50122
stp50123
a((dp50124
g2
(lp50125
Vd'oh
p50126
aVFound it:
p50127
aVTwo different commands
p50128
aVYou want:
p50129
aV(or assign  and  to be the same thing)
p50130
aVI think it might already be the default, but you could try setting the  to  explicitly
p50131
aVAlso, note that  can cause more query-plans than necessary to be created; I would explicitly create the variable with a known size (the size of the column plus spare for the )
p50132
aVThe existing string-concat should already ensure it isn't  (which is usually the problem)
p50133
aVAdditionally, note that both  and  are  - both could be wrapped in  here
p50134
as(dp50135
g18
V23354
p50136
stp50137
a((dp50138
g2
(lp50139
VIf you mean via , then it must be an  (in short, it pre-dates generics)
p50140
aVYou could write something that shims this, but it probably isn't worth the trouble
p50141
as(dp50142
g18
V23354
p50143
stp50144
a((dp50145
g2
(lp50146
s(dp50147
g18
V23354
p50148
stp50149
a((dp50150
g2
(lp50151
VXml is not a fixed-width record format
p50152
aVIt is very hard (read: don't bother) to edit the internals without re-writing it
p50153
aVIn most sensible use-cases of xml this is fine and expected
p50154
aVIf this is a problem, consider an alternative storage mechanism (a database leaps to mind), and simply import/export xml when needed
p50155
as(dp50156
g18
V23354
p50157
stp50158
a((dp50159
g2
(lp50160
VDo you mean  as a regex  or a C#
p50161
aVI always use verbatim string literals with regex:
p50162
aV(the only thing you need to escape is  to )
p50163
as(dp50164
g18
V23354
p50165
stp50166
a((dp50167
g2
(lp50168
VBinaryFormatter is not very tolerant to assembly changes
p50169
aVI long ago reached the conclusion that it is OK (just about) for transport, but not good for any kind of storage - it is just too brittle
p50170
aVIn short, I would use another serializer - but contract-based, not type-based (so any type with the same cnotract can share the data):
p50171
aVin many cases  will do; it has some limitations (public types and members), but it works generally
p50172
aVwith
p50173
aVNET 3
p50174
aV0,  is useful
p50175
aVor if you want something outside of the code libs, protobuf-net is very fast and efficient
p50176
aVOf those, only  will currently support "graph" mode (rather than trees)
p50177
aVIf you have existing data that you're fighting, I would be sorely tempted to use the old code (or something very close to it) to re-write the data in a contract-based form
p50178
aVAlthough you say you've only just created it, so maybe this isn't a problem
p50179
as(dp50180
g18
V23354
p50181
stp50182
a((dp50183
g2
(lp50184
VIt sounds like you are describing custom attributes - i
p50185
ag50
aVThis requires some reflection to read the attributes, but is quite a nice way of decorating types / members / etc
p50186
aVYou might also look at the pre-rolled  for security checks
p50187
aVIs this what you mean
p50188
aVNote the above would require:
p50189
aV(and similar for the other)
p50190
aVYou can read them out with
p50191
as(dp50192
g18
V23354
p50193
stp50194
a((dp50195
g2
(lp50196
VAn  isn't really a visible control - it is a resource
p50197
aVIIRC you would have to associate accessibility concerns with the control that is using the
p50198
as(dp50199
g18
V23354
p50200
stp50201
a((dp50202
g2
(lp50203
VIf you are using data-binding to a type and auto-generated columns, this is the , i
p50204
ag50
aVOtherwise this is the  on the column, i
p50205
ag50
aVA basic way to add a column is:
p50206
aVOr you can be more specific, for example to add a column of hyperlinks:
p50207
aV(you could obviously set more properties on the new column first)
p50208
as(dp50209
g18
V23354
p50210
stp50211
a((dp50212
g2
(lp50213
VAt one level, it is correct; the transaction is always aborted (you aren't calling Complete())
p50214
aVIs that the exact code
p50215
aVAdditionally, having the  outside the  makes me suspect that it might be doing some odd things since the transaction isn't there when the data-context first gets created
p50216
aVHave you tried (both of):
p50217
aVreversing the creation order, so the  spans the
p50218
aVcalling
p50219
as(dp50220
g18
V23354
p50221
stp50222
a((dp50223
g2
(lp50224
VEven in java, the  interface is just one approach
p50225
aVI would give good consideration here to protocol buffers; there are java, C++ and C# (/
p50226
aVNET) implementations, and many others; giving you interop / portability in addition to fast, efficient binary serialization
p50227
as(dp50228
g18
V23354
p50229
stp50230
a((dp50231
g2
(lp50232
VThere isn't a way to do this directly; FxCop would be your best bet
p50233
aVYou could get creative, though, and re-declare the type
p50234
aVCaveat: this is dodgy dodgy
p50235
aVBut it'll work:
p50236
aVThis is so nasty
p50237
aVBut takes an  to get around
p50238
aVIt might also monkey with some string-based reflection () of course
p50239
as(dp50240
g18
V23354
p50241
stp50242
a((dp50243
g2
(lp50244
VIt depends how far it has to scale
p50245
aVIf a single server will suffice, then fine; keep it conveniently in memory (as long as you can recreate the data if the server gets restarted)
p50246
aVIf the data-volume is low, then simple blocking () should work fine to synchronize the data, or for higher throughput a
p50247
aVI would probably not store it directly in the WCF class instance, though
p50248
aVI would avoid anything involving sessions (if/when this ties into the WCF life-cycle); this is rarely helpful to simple services
p50249
aVFor distributed load (over multiple servers) I would give consideration to a separate dedicated backend
p50250
aVA database or memcached / AppFabric / etc would be worth consideration
p50251
as(dp50252
g18
V23354
p50253
stp50254
a((dp50255
g2
(lp50256
VTyop aside, the first thing to try is setting  to see if any TSQL is issues (or better: run a SQL trace)
p50257
aVIf nothing is getting sent then maybe  was already true - it won't re-save such changes unless it has to (unless you force it)
p50258
aVLess likely, you could perhaps have accidentally turning off object-tracking ()
p50259
aVOther common mistakes include:
p50260
aVnot calling  when using  (if you are using )
p50261
aVwith database files (rather than a separate server), checking in the original file (in the solution) rather than in the build output (typically /bin/debug or /bin/release)
p50262
aVI'm also assuming that  is actually a db-mapped property (they don't have to be)
p50263
as(dp50264
g18
V23354
p50265
stp50266
a((dp50267
g2
(lp50268
VHow about:
p50269
as(dp50270
g18
V23354
p50271
stp50272
a((dp50273
g2
(lp50274
VWith LINQ:
p50275
aVFor info, the difference here between  and  is that  will do extra work to guarantee uniqueness; so if you don't expect duplicates (or alternatively: don't mind them) then  is faster
p50276
as(dp50277
g18
V23354
p50278
stp50279
a((dp50280
g2
(lp50281
VWhat would I need to do to reproduce this error
p50282
aVThe first bit (about matching data-contract) sounds like WCF isn't very happy with you, which suggests you have two similar (but different) contracts "in play"
p50283
aVIf you are re-using the types from a shared library this shouldn't be a problem
p50284
aVIf you do end up excluding the types (and having a different model at the client and server) then it can get a bit tricker, since "mex" doesn't guarantee the positions will remain intact (and indde, they regularly change) - but you can fix this in a partial class, by using a few  against the type (not pretty but it works)
p50285
aVBut I stress - the main problem here seems to be WCF; if that isn't happy such that the code doesn't codegen / compile etc, then my hands are fairly tied (since it won't get as far as talking to protobuf-net)
p50286
as(dp50287
g18
V23354
p50288
stp50289
a((dp50290
g2
(lp50291
VYou're talking about garbage collection and structs in the same line, which doesn't make sense
p50292
aVUltimately, every time you look at a struct it is likely to copy itself
p50293
aVIf you want to re-use the same reference, then you either need a class, or you need to wrap the struct in a class (boxing; either inbuilt or manual)
p50294
aVWhat actually happens in your code is:
p50295
aVWhich when you think about it is (space-wise) identical to:
p50296
aVNote that the copy doesn't go onto the stack (the struct=stack is a common myth)
p50297
aVThe data goes into the array (inside the ) which is on the heap
p50298
aVPassing the structs arount by reference would make no difference whatsoever to the behaviour of  (it simply avoids copying the struct when passing it into this method, but memory-copy is fast)
p50299
as(dp50300
g18
V23354
p50301
stp50302
a((dp50303
g2
(lp50304
VXslt can output text; just make sure that you set the output-mode of the xslt to text, and wriet to a  (there are multiple overloads available)
p50305
aVWriting something that is nearly xml in xslt is painful, but possible with disabling the escape rules
p50306
aVHere's an example (albeit ugly) xslt for writing non-xml:
p50307
as(dp50308
g18
V23354
p50309
stp50310
a((dp50311
g2
(lp50312
VDynamic query requires:
p50313
aVthe source be  (so if it is  or similar, just call  on it)
p50314
aVan extra dll to be referenced in the code that wants to perform dynamic query
p50315
aVthe appropriate  directives to be in place at the top of the local source file
p50316
aVCheck those three, and you should be able to add , , etc
p50317
as(dp50318
g18
V23354
p50319
stp50320
a((dp50321
g2
(lp50322
VCan you clarify "received assembly errors"
p50323
aVYou might be able to reference both by using , but this is tricky and confusing
p50324
aVIn hindsight, perhaps placing this dependency in the API was an error
p50325
aVAlternatively: can you possibly rebuild the logic dll for the target framework
p50326
as(dp50327
g18
V23354
p50328
stp50329
a((dp50330
g2
(lp50331
VI guess you could reverse the process (looking at all public members/properties that aren't marked , aren't , and don't have a  that returns  or any of the other patterns), but this seems a lot of work
p50332
as(dp50333
g18
V23354
p50334
stp50335
a((dp50336
g2
(lp50337
VAn alternative is:
p50338
aVwhich creates the object in memory but doesn't run any constructor
p50339
aVScary
p50340
as(dp50341
g18
V23354
p50342
stp50343
a((dp50344
g2
(lp50345
VFirst the fixed code, then the answers to your questions:
p50346
aVor in 3
p50347
aV0:
p50348
aV(and use  instead of )
p50349
aVXmlSerializer is not generic
p50350
aVI have to cast from and to object on (de)serialization
p50351
aVThat is common for serializers
p50352
aVI have my own serializer, and initially I did make it fully generic
p50353
aVAnd it turned out to be a big design mistake
p50354
aVHuge
p50355
aVNo, seriously
p50356
aVI'm currently in the process of re-writing every line of code to switch it out
p50357
aVSimply; serializers generally involve some level of reflection (either for code-gen or for the actual work, depending on the implementation)
p50358
aVReflection and generics don't play nicely, especially on some of the frameworks like WCF
p50359
aVHaving your code do the final cast is a fair compromise
p50360
aVI have a number of blog entries on this if you really want
p50361
aVEvery property has to be fully public
p50362
aVThat is indeed a limitation of  (although a list/colletion without a setter is fine, it will throw if you have a public get and private set)
p50363
aVAlso, the type needs to be public and have a parameterless constructor
p50364
aVWhy aren't we just using Reflection to access private setters
p50365
aVFor performance,  builds an assembly on the fly to do what you want
p50366
aVIt doesn't have automatic access to your code's internals
p50367
aVFor info, I'm doing something similar but I offer 2 levels of generation; fully static (into a deployable dll), which then only works with public members, or in-memory, which can still access private members
p50368
aVI guess they wanted to settle on only 1 model, which makes sense - and they needed "sgen", which dictates the first model
p50369
aVPrivate fields cannot be serialized
p50370
aVI'd like to decorate private fields with an attribute to have XmlSerializer include them
p50371
aVThen use , which will serialize any member (including private) marked
p50372
as(dp50373
g18
V23354
p50374
stp50375
a((dp50376
g2
(lp50377
VWell, the first thing I note is that you are creating a new factory, and hence new , each iteration
p50378
aVCan you re-use the factory (creating multiple types in the same dynamic assembly)
p50379
as(dp50380
g18
V23354
p50381
stp50382
a((dp50383
g2
(lp50384
VUltimately, they are just a generic struct with a bool flag - except with special boxing rules
p50385
aVBecause structs are (by default) initialized to zero, the bool defaults to false (no value):
p50386
aVExtra differences, though:
p50387
aVspecial boxing rules (you can't normally do this)
p50388
aVspecial C# rules for comparing to null etc
p50389
aVlifted" operators in C# (and in
p50390
aVNET via ,  etc)
p50391
aVspecial rules on generic type constraints (to prevent )
p50392
as(dp50393
g18
V23354
p50394
stp50395
a((dp50396
g2
(lp50397
V does not support serialization callbacks
p50398
aVYou have some options, though
p50399
aVFor example, if you want to choose whether to serialize a property called , you can add a method:
p50400
aVIf you need to know during deserialization too, you can use:
p50401
aV(although you might find - I can't be sure - that the  is only called for the  case)
p50402
aVThe other option, of course, is to implement , but that should only be done as a last resort
p50403
aVIt isn't fun
p50404
as(dp50405
g18
V23354
p50406
stp50407
a((dp50408
g2
(lp50409
VThat sounds something a bit like the things Typemock isolator offers, in particular their claimed ability to rip out and mock existing types
p50410
aVBut I've never used it ;-(
p50411
aVAs an example,  is something that shouldn't be mockable, right
p50412
as(dp50413
g18
V23354
p50414
stp50415
a((dp50416
g2
(lp50417
VI might look at a second property:
p50418
as(dp50419
g18
V23354
p50420
stp50421
a((dp50422
g2
(lp50423
VSomething like (EDITED after re-reading the question) - but note that  doesn't work on EF in 3
p50424
aV5SP1 (but it is fine in LINQ-to-SQL):
p50425
as(dp50426
g18
V23354
p50427
stp50428
a((dp50429
g2
(lp50430
VHave you defined "my" in the namespace-manager
p50431
aVOr better - choose something that is unlikely to conflict
p50432
aVIt does seem odd that it didn't pick it up from the name-table, though
p50433
as(dp50434
g18
V23354
p50435
stp50436
a((dp50437
g2
(lp50438
VFor most purposes, you shouldn't have to get too concerned about GC
p50439
aVIf you are worrying about this, it probably means you've got underlying coding problems (accidentally leaking object references, perhaps via static events etc)
p50440
aVSo treat this as a reactive thing when you find you have a problem - and use a memory profiler to find and fix that problem
p50441
as(dp50442
g18
V23354
p50443
stp50444
a((dp50445
g2
(lp50446
V and
p50447
as(dp50448
g18
V23354
p50449
stp50450
a((dp50451
g2
(lp50452
VI don't know about the painting, but on point 2 - maybe add a glyph via  - there's an example on codeproject
p50453
as(dp50454
g18
V23354
p50455
stp50456
a((dp50457
g2
(lp50458
VAll that  gains you is an implicit  constructor, and a few obvious things involving
p50459
aVPerhaps more importantly, callers can't use classes, interfaces or
p50460
aVWhat types of operations are you after
p50461
aVFor operators, try  in 4
p50462
aV0, or MiscUtil in 3
p50463
ag691
as(dp50464
g18
V23354
p50465
stp50466
a((dp50467
g2
(lp50468
VYou need to clarify exactly what / where  is, but no; it is not safe
p50469
aVIt can be held in a register on x86 (but this is unlikely in most non-trivial examples)
p50470
aVYou need to make it , or to synchronize ( etc) access to it
p50471
aVFor an example, see here
p50472
as(dp50473
g18
V23354
p50474
stp50475
a((dp50476
g2
(lp50477
VFields (variables on classes / structs) are initialized to /zero/etc
p50478
aVLocal variables
p50479
aVwell - since (by "definite assignment") you can't access them without assigning there is no sensible way of answering; simply, it isn't defined since it is impossible
p50480
aVI believe they happen to be /zero/etc (provable by hacking some  code via dynamic IL generation), but that is an implementation detail
p50481
aVFor info, here's some crafy code that shows the value of a formally uninitialised variable:
p50482
aVThe IL just does a "ret" - it never assigns anything
p50483
as(dp50484
g18
V23354
p50485
stp50486
a((dp50487
g2
(lp50488
VWhat are you seeing
p50489
aVWhat makes you thank that proxy is an issue
p50490
aVIf that is server-side code, it should use the browsers settings (WinINet) which should work fine
p50491
aVPerhaps the "localhost" would be an issue, though, since to the client that still means "talk to yourself" (i
p50492
ag50
aVnot the server)
p50493
aVIf that is server side you'll probably need to configure WinHTTP appropriately; in particular, to skip the proxy for local addresses
p50494
aVOf course, "localhost" should loop-back anyway
p50495
as(dp50496
g18
V23354
p50497
stp50498
a((dp50499
g2
(lp50500
VI agree with Jon's points; if you are coding over multiple environments, then his version gives you a similar API to the other "core" implementations
p50501
aVprotobuf-net is much more similar to how most of the
p50502
aVNET serializers are implemented, so is more familiar (IMO) to
p50503
aVNET devs
p50504
aVAnd as Jon notes - the raw binary output should be identical so you can re-implement with a different API if you need to later
p50505
aVSome points re protobuf-net that are specific to this implementation:
p50506
aVworks with existing types (not just generated types from
p50507
aVproto)
p50508
aVworks under things like WCF and memcached
p50509
aVcan be used to implement  for existing types
p50510
aVsupports inheritance* and serialization callback methods
p50511
aVsupports common patterns such as
p50512
aVworks with existing decorated types (/ or /) - meaning (for example) that LINQ-to-SQL models serialize out-of-the-box (as long as serialization is enabled in the DBML)
p50513
aVin v2, works for POCO types without any attributes
p50514
aVin v2, works in
p50515
aVNET 1
p50516
aV1 (not sure this is a huge selling feature) and most other frameworks (including monotouch - yay
p50517
aVpossibly (not yet implemented) v2 might support full-graph* serialization (not just tree serialization)
p50518
aV(*=these features use 100% valid protobuf binary, but which might be hard to consume from other languages)
p50519
as(dp50520
g18
V23354
p50521
stp50522
a((dp50523
g2
(lp50524
VAre you setting  to
p50525
aVIt will default to , meaning: don't serialize this
p50526
as(dp50527
g18
V23354
p50528
stp50529
a((dp50530
g2
(lp50531
VPersonally, I would not use  for this purpose - it is implementation specific and overly expensive
p50532
aVI would be tempted to (one of):
p50533
aV1: use  /  to do it manually (but note that this is easy to interpret from any API):
p50534
aVor 2: use an implemenation-independent serialization format, such as protobuf; here I'm using protobuf-net
p50535
aVNote that (1) uses 24 bytes for the example (6 * 4 bytes); (2) uses 10 bytes (in part because the numbers are simple, but actually protobuf has some tricks (such as "packed" data) that we aren't even using here)
p50536
as(dp50537
g18
V23354
p50538
stp50539
a((dp50540
g2
(lp50541
VThen you have:
p50542
aVOf course some collections (,  etc) already have an  - this simply makes it available to those that don't
p50543
as(dp50544
g18
V23354
p50545
stp50546
a((dp50547
g2
(lp50548
VWell, you're only fooling the static analysis - you're still doing a virtual call in the ctor
p50549
aVIf it is needed during the ctor, perhaps instead this should be a required base-constructor value, that subclasses pass down:
p50550
aVOr perhaps do it in something that is fixed at compile - attributes:
p50551
aVand look this up via reflection on:
p50552
as(dp50553
g18
V23354
p50554
stp50555
a((dp50556
g2
(lp50557
VThis might sound crazy, but I wonder if it will work differently if you remove the  assignment, and just add it to the  collection
p50558
aVGive it a try, at least
p50559
as(dp50560
g18
V23354
p50561
stp50562
a((dp50563
g2
(lp50564
V allows you to add attributes (at least, as far as  is concerned) to types and objects - but not to specific properties
p50565
aVTo do that (in a general way would require  - however, be advised that this is not a trivial thing to implement, and you need to write all of:
p50566
aVthe provider itself
p50567
aVan
p50568
aVa  for the things you want to manipulate
p50569
aVIt is the  that would allow you to pretend you had additional attributes (or, via  change the  more directly, without messing with attributes)
p50570
as(dp50571
g18
V23354
p50572
stp50573
a((dp50574
g2
(lp50575
VSQL CE should work OK, but no: you don't have to use SQL
p50576
aVYou could just populate a  and save/load that to a file on disk
p50577
aVOr you could use any other serializable object tree and a serializer such as  etc
p50578
aVAll of these should work fine with standard bindings like
p50579
aVNote, though, that databases get you more granular control over the data
p50580
aVIt all depends on whether that is valuable, or if a single flat file will suffice
p50581
as(dp50582
g18
V23354
p50583
stp50584
a((dp50585
g2
(lp50586
VFirstly - are you trying to use protobuf-net on the iPhone
p50587
aVv1 is not expected to work via monotouch; v2 does work (that was a big driver for the v2 work), but is not yet released (it is usable but incomplete at the moment)
p50588
aVLet me know if you are trying to do this, as it would matter ;-p
p50589
aVI expect they've obtained that
p50590
aVproto by calling , which is unfortunately not fool-proof, especially when things like  are involved (I'll add a TODO to try to fix that in v2)
p50591
aVThe good news is that it models  as , where  should be:
p50592
aVAnd  is modelled as  (bcl
p50593
aVproto), which is:
p50594
aVNote, however, that no "proto" is needed at all if working
p50595
aVNET-to-
p50596
aVNET; just compatible types
p50597
as(dp50598
g18
V23354
p50599
stp50600
a((dp50601
g2
(lp50602
VLambdas in C# are a two-faced beast
p50603
aVThey can operate very much like anonymous methods, or (depending on the method signature) the C# compiler can compile them into  trees
p50604
aVThe two MSDN links (previous) should help; otherwise books like C# in Depth might light a few bulbs for you
p50605
aVOr I cover expression-trees quite a lot on my blog (or here)
p50606
aVIf you are talking about their use in LINQ-to-SQL, Entity Framework, etc - then it is the expression-tree facet that matters; which has a few more limitations than the anonymous-method facet (for example, you can't have a "statement body" in a
p50607
aVNET 3
p50608
aV5 expression-tree -
p50609
aVNET 4
p50610
aV0 trees support this, but the C# 4
p50611
aV0 compiler still doesn't)
p50612
as(dp50613
g18
V23354
p50614
stp50615
a((dp50616
g2
(lp50617
VDo you need to call
p50618
aVI'm unclear on why you can't just loop over adding to the dictionary (or call )
p50619
aVHowever; have you profiled
p50620
aVIf there is a bottleneck here, you might try dropping back to  and treating it as a firehose:
p50621
aVWith your existing code, though, I would be very tempted to make it:
p50622
aVThe difference is that by not calling  it should work even when the attribute isn't set
p50623
aVOf course if you demand that this attribute is always set then an exception may be acceptable in this case
p50624
as(dp50625
g18
V23354
p50626
stp50627
a((dp50628
g2
(lp50629
VAny serialization API should do fine here
p50630
aVI would recommend something that is contract based (not , which is type-based) as that will keep it usable over time (as your assembly changes)
p50631
aVSo I would build a basic object model (DTO) and use any of:
p50632
aVprotobuf-net (you all knew it was coming
p50633
aVOO, simple, and easy
p50634
aVAnd easy to use for passing fragments of the data (either between users of to a central server)
p50635
as(dp50636
g18
V23354
p50637
stp50638
a((dp50639
g2
(lp50640
VI wonder if what you are trying to do would would better as a  via
p50641
aVBut either way, both  and  seem to be populated in a quick test (for both  and ):
p50642
aVOr as a type-converter:
p50643
as(dp50644
g18
V23354
p50645
stp50646
a((dp50647
g2
(lp50648
VHow about don't add that  unless you need to
p50649
aVThis works because LINQ queries are composable with deferred execution, so this filter is still part of the final TSQL
p50650
as(dp50651
g18
V23354
p50652
stp50653
a((dp50654
g2
(lp50655
VIt really depends on how often you're going to be calling it
p50656
aVIf it isn't massive throughput, then fine - but note that the reflection-based  /  are pretty slow
p50657
aVYou could cache the delegates, but another simple approach might be to look at HyperDescriptor - this uses the same API as  (so you again get  / ), but it uses dynamic methods underneath
p50658
aVThe API then is something like:
p50659
aVor
p50660
aVthen
p50661
as(dp50662
g18
V23354
p50663
stp50664
a((dp50665
g2
(lp50666
VSure
p50667
as(dp50668
g18
V23354
p50669
stp50670
a((dp50671
g2
(lp50672
VIIRC, to do this you need to set the principal permission mode to "custom" and use an authorization policy, like so
p50673
aVAs far as I know, the call to  is the only place it is expecting you to set a principal, and when I tried this without using  it discarded my principal (which makes sense, since there is no guarantee that WCF will use the same thread at each point in the pipeline)
p50674
as(dp50675
g18
V23354
p50676
stp50677
a((dp50678
g2
(lp50679
VIn your example,  is always a , so you can simply use either  or
p50680
aVIf, however, you mean that you have a  instance hanging around somewhere, then you get into the area of reflection
p50681
aVNote that this works, but is slow if used in a tight-loop, so make sure that you understand the performance aspect;
p50682
as(dp50683
g18
V23354
p50684
stp50685
a((dp50686
g2
(lp50687
VProperties are a useful way of expressing a feature of an object, allowing get/set in a common way that can be used by APIs like data-binding, reflection and serialization
p50688
aVSo for simple values of the object, properties are handy
p50689
aVProperties can't take arguments, should not have significant side-effects*, and should return quickly and repeatably
p50690
aVAlso, there is no such thing as an "extension property" (to mirror an extension method) nor a generic property
p50691
aV(*=lazy loading etc isn't uncommon, however)
p50692
aVMethods (C# doesn't have functions) are better for expressing things that either change the state, or which have an expectation of taking some time and not necessarily being reproducible
p50693
aVThey don't tend to work in binding / serialization etc
p50694
aVNote that properties are actually just a special way of writing methods
p50695
aVThere is little functional difference
p50696
aVIt is all about expressing intent
p50697
aVThe one thing you don't want to expose, however, is fields (the actual  instance variable)
p50698
aVSo I would have:
p50699
aVor just (if on the  object):
p50700
aVOf course
p50701
aVthen the question becomes "in what unit
p50702
aVI assume that is years
p50703
as(dp50704
g18
V23354
p50705
stp50706
a((dp50707
g2
(lp50708
VIt is returning a collection, but you are treating it as a single instance ( is typed as , not some kind of collection)
p50709
aVIs the WCF code generated from the "mex"
p50710
aVIt should just work
p50711
aVIf that is your code, try changing  to
p50712
aVNote that over "mex" / soap / etc you don't get the real objects back - you get lightweight proxies
p50713
aVSo your custom collection types may have evaporated
p50714
as(dp50715
g18
V23354
p50716
stp50717
a((dp50718
g2
(lp50719
VWe can probably get  working if you show the xml or the code you used to write it, but I'm not sure that is the best option here
p50720
aVPresumably, to display them in a combobox the data-volume isn't immense
p50721
aVIn that case, it would be much simpler to use any of:
p50722
aVXmlDocument
p50723
aVXDocument
p50724
aVXmlSerializer
p50725
aVetc to load the data into a DOM or object-model, and work from their
p50726
aVLINQ-to-XML (via ) may be particularly appealing
p50727
aVFor example, with the xml:
p50728
aVThe  code like below may work:
p50729
as(dp50730
g18
V23354
p50731
stp50732
a((dp50733
g2
(lp50734
VPersonally I think only the second expansion makes sense (in terms of keeping along the same line as  etc):
p50735
aVbut to be honest I find it a little bit unnecessary
p50736
aVPeople usually "get" , but tend to have a problem with null-coalescing ()
p50737
aVAdd a null-coalescing-assignment operator and
p50738
aVwell, I don't see it ending well
p50739
aVPersonally I favor the original code:
p50740
aVAlso - consider: in all the other ,  etc - the right hand side is always evaluated
p50741
aVIn this case it wouldn't be (in some cases)
p50742
aVThat adds even more confusion
p50743
aVBy which I mean:
p50744
as(dp50745
g18
V23354
p50746
stp50747
a((dp50748
g2
(lp50749
Vx, per iteration, is the sequence of elements (excluding the first one)
p50750
aVI suspect you want:
p50751
aVAlthough you could also bring the group-key out in the projection if you wanted, by simplifying further:
p50752
as(dp50753
g18
V23354
p50754
stp50755
a((dp50756
g2
(lp50757
VParameters
p50758
aVAlways parameters:
p50759
aVand add a parameter called "@someVar" with that value
p50760
aVSolves (among other issues) problems with i18n / encoding, concatenation / injection and query-plan re-use
p50761
as(dp50762
g18
V23354
p50763
stp50764
a((dp50765
g2
(lp50766
VI would be tempted to use something like:
p50767
aV(although the inner  is optional and could be removed so you had links/link/link)
p50768
as(dp50769
g18
V23354
p50770
stp50771
a((dp50772
g2
(lp50773
VSomething like:
p50774
aVand (minimum shown)
p50775
aV(although if I had to do this I'd probably do something more interesting with exceptions that don't happen to be )
p50776
as(dp50777
g18
V23354
p50778
stp50779
a((dp50780
g2
(lp50781
VBetter to only read the first half in the first place, though
p50782
as(dp50783
g18
V23354
p50784
stp50785
a((dp50786
g2
(lp50787
VI'm surprised that unplugging makes a difference
p50788
aVI would expect some difference running from a share, though - you get a different security mode, i
p50789
ag50
aVnot full trust
p50790
aVIn full trust most of the internal security is simply skipped
p50791
aVWithout full trust it works a lot harder
p50792
aV"Fusion" (assembly resolution and loading) also will have to work harder, but this shouldn't be a problem when repeating operations you've already done once in that session (i
p50793
ag50
aVwhen the dlls have loaded)
p50794
aVHave you considered deploying (still to a network share) as ClickOnce ()
p50795
aVThis should then copy locally automatically and run with a better trust model (and no network performance impact)
p50796
as(dp50797
g18
V23354
p50798
stp50799
a((dp50800
g2
(lp50801
VI think we'd need to see reproducible code, but I can see 4 scenarios:
p50802
aVyou are talking to a different  instance in the two cases - my bet is here
p50803
aVyou have a variable called  in one of the methods (try using  when you mean the field if there is any ambiguity)
p50804
aVthe write or read is cached (try marking the field ; again unlikely)
p50805
aVa thread-specific field (thread-local storage) - very unlikely
p50806
aVThe first two are much more likely
p50807
as(dp50808
g18
V23354
p50809
stp50810
a((dp50811
g2
(lp50812
V5 + 6 is integer 11; which you then cast to double (in the assignment) and divide by two; 5
p50813
ag691
aV5 + 6 is integer 11; integer 11 / 2 = 5 under integer arithmetic, which you then cast to double (in the assignment)
p50814
ag691
aV0 + 6
p50815
aV0 is double 11
p50816
aV0; divide by double 2
p50817
aV0 giving double 5
p50818
ag691
aV5 + 6 is integer 11; there is an implicit cast to double 11
p50819
aV0 for the division, then divide double 2
p50820
aV0 giving double 5
p50821
ag691
as(dp50822
g18
V23354
p50823
stp50824
a((dp50825
g2
(lp50826
VActually, you don't need anything special here
p50827
aVoffers a  method that will do everything you need without requiring any additional generic constraints (which tend to propagate horribly)
p50828
aVIt works for both  and , and supports classes, structs and
p50829
aVJob done
p50830
aVFor info, this is how the LINQ  /  implementations work, and likewise
p50831
aVSo a common and well supported part of the BCL
p50832
as(dp50833
g18
V23354
p50834
stp50835
a((dp50836
g2
(lp50837
VLoop through  by  and find which it thinks is different
p50838
aVThe fact that writing it to disk and comparing the ASCII / text tells me that it is probably either carriage-return / line-feed related (which is somehow normalized during save), or relates to some non-ASCII character (maybe a high-unicode whitespace), which will be stripped when saving as ASCII
p50839
as(dp50840
g18
V23354
p50841
stp50842
a((dp50843
g2
(lp50844
VNote that in C# 3
p50845
aV0 you can use a collection initializer to initialize a static field, then you don't need your own constructor
p50846
aVKeep the data private and provide an access mechanism to avoid the need to synchronize the data (since it is only ever read):
p50847
aVIf you have lots of data to load, consider some kind of serialized form
p50848
aVXml, binary, a database - whatever
p50849
as(dp50850
g18
V23354
p50851
stp50852
a((dp50853
g2
(lp50854
VYou should be able to have an empty element with the  attribute set to the second file (relative to the first)
p50855
aVSee here for how to enable it for custom sections
p50856
as(dp50857
g18
V23354
p50858
stp50859
a((dp50860
g2
(lp50861
VI'm thinking of the changes to the "old" spec
p50862
aVthe  change won't be available, since that requires a new overload - but the "field-like events" change should work
p50863
aVI'll have to check what the compiler emits ;-p
p50864
aVAnd sure enough:
p50865
aVgets the new-style accessors ;-p
p50866
as(dp50867
g18
V23354
p50868
stp50869
a((dp50870
g2
(lp50871
VA common omission with  is events; if you have objects subscribed that are not serializable, bad things happen
p50872
aVPlus you probably don't mean to serialize the subscribers
p50873
aVYou can mark these as  or
p50874
aVIf all else fails, give it the  of your object (or if that fails, base64)
p50875
aVThat said, I would advise against  here - it is brittle and takes more bandwidth than it needs to
p50876
aVI've had some success using protobuf-net instead (see here, but a different implementation) ; which is smaller, faster, and version safe
p50877
aVI might be able to help shim this for you
p50878
aVOr you can use the  hook from protobuf-net
p50879
as(dp50880
g18
V23354
p50881
stp50882
a((dp50883
g2
(lp50884
VHere's a small C# sample, which can be used directly by your code, or built into an exe and called at the comand-line as "":
p50885
aVSample input:
p50886
aVSample output (note you can remove the  with ):
p50887
aVNote that if you want a string rather than write to a file, just swap with :
p50888
as(dp50889
g18
V23354
p50890
stp50891
a((dp50892
g2
(lp50893
VYes
p50894
aVThe access is to the type, not the instance
p50895
aVThis is especially useful for things like implementing equality, as you can test
p50896
aVAccess is also available to nested types
p50897
as(dp50898
g18
V23354
p50899
stp50900
a((dp50901
g2
(lp50902
V is brittle, and is not designed to be friendly if you have changes to the types involved
p50903
aVIf you want that type of behaviour, you need a contract-based serializer such as ,  or protobuf-net
p50904
aVAnything except
p50905
as(dp50906
g18
V23354
p50907
stp50908
a((dp50909
g2
(lp50910
V0 is correct
p50911
aVStart at position zero and you can (trivially) match a zero-length string
p50912
aVLikewise, "" contains ""
p50913
as(dp50914
g18
V23354
p50915
stp50916
a((dp50917
g2
(lp50918
VTo do this in managed code would essentially mean writing your own browser
p50919
aVI expect that to do what you want the simplest approach would be to drop a  control into the page (essentially re-hosting IE) and use that
p50920
aVThere are other hostable controls, of course - but that is the simplest for Windows
p50921
as(dp50922
g18
V23354
p50923
stp50924
a((dp50925
g2
(lp50926
VNo, that isn't possible unless you use PostSharp or similar
p50927
aVThis isn't a standard attribute feature - rather it is something that ASP
p50928
aVNET MVC is adding for you
p50929
aVYou don't get it for all attributes
p50930
as(dp50931
g18
V23354
p50932
stp50933
a((dp50934
g2
(lp50935
VReflection has many features
p50936
aVhas, via "sgen
p50937
aVexe" the ability to pre-build the serialization code to a binary (dll)
p50938
aVThis is useful in some scenarios that don't allow dynamic code, but dlls (just like your code) are limited to the accessible API
p50939
aVHowever
p50940
aVreflection isn't this limited, and with enough access you can do pretty much anything
p50941
aVFor performance you probably don't want to be using reflection directly a lot, but if you have enough permissions to create IL directly in memory (), then you can tell it (on a per-dynamic-method basis) which  the code is associated with
p50942
aVFor example, if I create a  passing  as the  argument, then that dynamic method has full access to all members (including fields) on
p50943
aVFor info,  provides similar access to otherwise protected data
p50944
aVSince  doesn't worry about pre-generation, it can use this access
p50945
as(dp50946
g18
V23354
p50947
stp50948
a((dp50949
g2
(lp50950
VSo it looks like to problem is that you are putting too much into state; most likely this means one (or both) of:
p50951
aVyou are reading far, far too many rows
p50952
aVthe serializer is walking the (perhaps lazy-loaded
p50953
aVproperties, causing more data than you expect to be loaded / serialized
p50954
aVTo combat this, I would suggest projecting instead to a simple DTO model before doing anything that could put the data into state (so you know exactly what data you are serializing), and to look closely about how many rows you are handling (using  and  appropriately)
p50955
as(dp50956
g18
V23354
p50957
stp50958
a((dp50959
g2
(lp50960
VYou could try:
p50961
aVwhich will handle s; also check: have you got session-state disabled for the page
p50962
aV(although I would have perhaps expected a more obvious error in that case)
p50963
as(dp50964
g18
V23354
p50965
stp50966
a((dp50967
g2
(lp50968
Vor
p50969
aVor project the string:
p50970
as(dp50971
g18
V23354
p50972
stp50973
a((dp50974
g2
(lp50975
VHow about adding an interface, and using an extension method
p50976
aVThat way:
p50977
aVno unnecessary inheritance
p50978
aVno duplication
p50979
as(dp50980
g18
V23354
p50981
stp50982
a((dp50983
g2
(lp50984
VIf I understand correctly, then not without implementing  (which is not fun; don't go there)
p50985
aVThere are things like the  /  patterns, but it still won't write something for s (even if you return true)
p50986
as(dp50987
g18
V23354
p50988
stp50989
a((dp50990
g2
(lp50991
VIMO, the other answers miss one key detail - that delegates (and therefore events) are immutable
p50992
aVThe significance of this is that subscribing or unsubscribing an event handler doesn't simply append/remove to a list - rather, it replaces the list with a new one with an extra (or one less) item on it
p50993
aVSince references are atomic, this means that at the point you do:
p50994
aVyou now have a rigid instance that cannot change, even if in the next picosecond another thread unsubscribes (causing the actual event field to become )
p50995
aVSo you test for null and invoke it, and all is well
p50996
aVNote of course that there is still the confusing scenario of the event being raised on an object that thinks it unsubscribed a picosecond ago
p50997
as(dp50998
g18
V23354
p50999
stp51000
a((dp51001
g2
(lp51002
VVarious ways you could do that; Muenchian grouping in xslt for example
p51003
aVBut in C#, if the xml layout is known and fixed, perhaps the easiest would be:
p51004
aVIf you need something more flexible, an  (for use with ) would be more valuable
p51005
as(dp51006
g18
V23354
p51007
stp51008
a((dp51009
g2
(lp51010
VWe can't see your web structure, but is it possible that your app isn't configured as an application in IIS, therefore is picking up the master web
p51011
aVconfig
p51012
aVWhich would look exactly like that
p51013
aVGo into IIS and ensure it is an application (it may have a cog icon)
p51014
as(dp51015
g18
V23354
p51016
stp51017
a((dp51018
g2
(lp51019
VIt is VS2005, and isn't generating the async methods
p51020
aVOK; is it
p51021
aVNET 2
p51022
aV0 or
p51023
aVNET 3
p51024
aV0 (via the VS2005/WCF add-on)
p51025
aVIt looks like "wsdl
p51026
aVexe" (the original) will generate "FooAsync" methods, but WCF ("scvutil
p51027
aVexe") may generate the "BeginFoo" pattern
p51028
aVYou might also look to see if you have used WSE*, for example, "wsewsdl2
p51029
aVexe" or "wsewsdl3
p51030
aVexe"
p51031
aVMy bets would be of the WCF version
p51032
aVNote also that different frameworks (Silverlight etc) have their own proxy generation classes
p51033
as(dp51034
g18
V23354
p51035
stp51036
a((dp51037
g2
(lp51038
VAll of the interesting LINQ methods require a generic lambda expression - i
p51039
ag50
aVan , for example  for predicates (), or  for projections ()
p51040
aVWhat you are doing sounds like , but you're going to have to give it a more specific lambda to be useful, and that doesn't work easily - you'd probably need a bit of  etc
p51041
aVRe applying an  to LINQ-to-Objects, that is the easy bit
p51042
aVYou can just use:
p51043
aVor
p51044
aV(but note again that  there must be appropriately typed;  won't cut it)
p51045
aV(Alternatively, you can call  on the lambda and use regular LINQ-to-Objects)
p51046
as(dp51047
g18
V23354
p51048
stp51049
a((dp51050
g2
(lp51051
VYou can do this by decorating each file, or you could do it by choosing which files to include
p51052
aVBoth MSBuild and csc have options for including all files under a path, and MSBuild additionally has the ability to conditionally include build items based on an attribute (rather than requiring a separate csproj per configuration)
p51053
aVBut it is probably easier to decorate the files directly ;-p
p51054
as(dp51055
g18
V23354
p51056
stp51057
a((dp51058
g2
(lp51059
VMaking the code 1
p51060
aV1-compatible is tricky; not only to overcome the (very significant, in many cases - generics  being the most notable, but by not means the only) language issues, but also the core framework
p51061
aVAvoiding the new features, bug-fixes, behaviour changes, etc is hard
p51062
aVIn most cases you will struggle to re-write 2
p51063
aV0 code in 1
p51064
aV1 (lets pray there aren't any iterator blocks, for example)
p51065
aVOddly enough I'm re-writing some code at the moment, and by accident of design it happens to be a good fit for 1
p51066
aV1, but that is an extreme edge-case
p51067
aVIn most cases it isn't worth it
p51068
aVSo if you want to go that route, be prepared to spend significant effort doing it
p51069
as(dp51070
g18
V23354
p51071
stp51072
a((dp51073
g2
(lp51074
VWhat is the data volume
p51075
aVYou have 2 options that I can see:
p51076
aV1: filter it at source, by implementing your own  and using some hash over the data, and simply skipping any duplicates so that they never get passed into the TDS
p51077
aV2: filter it in the DB; at the simplest level, I guess you could have multiple stages of import - the raw, unsanitised data - and then copy the  data into your actual tables, perhaps using an intermediate table if you want to
p51078
aVYou might want to use  for some of this, but it depends
p51079
as(dp51080
g18
V23354
p51081
stp51082
a((dp51083
g2
(lp51084
VWhy demand a huge 2-D array
p51085
aVYou can simulate this with, for example, a jagged array -  - almost as fast, and you won't hit the same single-object limit
p51086
aVYou'll still need buckets-o-RAM of course, so x64 is implied
p51087
aVBesides which - you might want to look at sparse-arrays, eta-vectors, and all that jazz
p51088
as(dp51089
g18
V23354
p51090
stp51091
a((dp51092
g2
(lp51093
VFor
p51094
aVNET 3
p51095
aV5, LINQ-to-SQL; drag the tables onto a data-context, job done
p51096
aVActually any ORM would probably do, but LINQ-to-SQL is a very quick way of getting the job done using just the MS tools and VS IDE
p51097
aVThey aren't "pure" POCO done this way (they have L2S attributes etc), but it is easy
p51098
aVYou can do pure POCO with L2S, but it takes a bit more effort
p51099
aVWith 2
p51100
aV0, NHibernate
p51101
aVBut more work as unless you use additional tooling you'll have to write the classes and/or mapping files
p51102
as(dp51103
g18
V23354
p51104
stp51105
a((dp51106
g2
(lp51107
VYou want to move the types to a new assembly
p51108
aVYou can do that with
p51109
aVIf you originally have ():
p51110
aVYou can instead move that type into , and have a virtually empty  which references  and simply contains:
p51111
aVThen anything trying to load  from  actually gets the type from
p51112
aVMost of the runtime respects this attribute
p51113
aVeverything except WCF extensions
p51114
aVWhich bit me ;-p Oh, and it isn't a fan of nested types
p51115
as(dp51116
g18
V23354
p51117
stp51118
a((dp51119
g2
(lp51120
VYou can't, basically
p51121
aVThe code that checks the object for the presence of the attribute must also assume responsibility for telling any code which type/object it was looking at
p51122
aVYou can't obtain any additional metadata from within an attribute
p51123
as(dp51124
g18
V23354
p51125
stp51126
a((dp51127
g2
(lp51128
VAFAIK there isn't a strict requirement, but it is probably one of those things where it is simpler (read: less brittle, more predictable, cheaper to implement, whatever) to generate the resx if there is even the suggestion that one could possibly be required (even if it turns out to be trivial) than it is to fully track the nuances of when one is absolutely demanded
p51129
aVI agree; in the scenario you describe no resx is required, but it isn't going to upset me
p51130
aV(it still happens in VS2010, btw - but then I suspect you shouldn't hope for much change to winforms in VS2010)
p51131
as(dp51132
g18
V23354
p51133
stp51134
a((dp51135
g2
(lp51136
VWith unsafe code perhaps
p51137
aV(the bytes in the buffer will default to 0, but you can always zero them manually)
p51138
as(dp51139
g18
V23354
p51140
stp51141
a((dp51142
g2
(lp51143
V may be a useful first thing to try, if the types are public etc
p51144
aVIf that fails, v2 of protobuf-net (in progress, you'd need to build from source, but I can help) works with unattributed objects, so ideal for types outside your control - you just need to tell it what to include (via a DSL)
p51145
aVThe v2 code isn't complete, but it covers most common scenarios, including collections etc (the incomplete work is mainly callbacks and enums)
p51146
as(dp51147
g18
V23354
p51148
stp51149
a((dp51150
g2
(lp51151
V:  or
p51152
ag6864
ag6864
aV:  (perhaps implicit)
p51153
as(dp51154
g18
V23354
p51155
stp51156
a((dp51157
g2
(lp51158
VJon's already covered the primary point here
p51159
aVbut just a random piece of trivia; your constructor might return
p51160
aVNot really a common case, and certainly not the real reason that  does this, and you really shouldn't torture your code for this - but it can happen (look for )
p51161
as(dp51162
g18
V23354
p51163
stp51164
a((dp51165
g2
(lp51166
VThis is a paranoia thing to do with threading
p51167
aVIf another thread unsubscribes the last handler just after you've checked it for , it could become  and you'll cause an exception
p51168
aVSince delegates are immutable, capturing a snapshot of the delegate into a variable stops this from happening
p51169
aVOf course, it does have the other side effect that you could (instead) end up raising the event against an object that thinks it already unsubscribed
p51170
aVBut to stress - this is only an issue when multiple threads are subscribing / unsubscribing to the object, which is a: rare, and b: not exactly desirable
p51171
as(dp51172
g18
V23354
p51173
stp51174
a((dp51175
g2
(lp51176
VWhat exactly do you want the output to look like
p51177
aVYou can write it manually (see Lirik's answer), or if you want runtime support, perhaps something like protobuf-net
p51178
aVThis would be trivial to do if you were using classes (which I expect you actually should be), but additionally protobuf-net v2 (only available as source at the moment) should work with that "as is"
p51179
aVFor info, here is how I would do it as classes:
p51180
aVThis could be decorated with serialization attributes, or (again, using protobuf-net v2) something like this test (which passes):
p51181
aV(and writes 46 bytes)
p51182
aVIt should work with private fields, structs, etc - I'd have to take a look
p51183
aVIf you are able to add attributes, then you don't need to set up the model manually (the first 4 lines)
p51184
aVThe rest of the code is just showing full round-trip usage
p51185
as(dp51186
g18
V23354
p51187
stp51188
a((dp51189
g2
(lp51190
VCodeRush has some support for spotting obvious variants of this
p51191
aVAnother possible option is (perhaps via an optional compilation symbol) add a finalizer to your own  objects, and complain loudly if they get finalized without being disposed (set a bool flag in the )
p51192
aVBut note: having a finalizer  changes the behaviour of the objects, so don't leave it in production code (or even your regular unit tests)
p51193
as(dp51194
g18
V23354
p51195
stp51196
a((dp51197
g2
(lp51198
VThat is a debug build (from the )
p51199
aVAll bets are off, but it looks like it is simply introducing a bool variable for simplicity:
p51200
aVBuild in release with optimisations enabled, which should remove such variables
p51201
as(dp51202
g18
V23354
p51203
stp51204
a((dp51205
g2
(lp51206
VIf you mean "how do I make this the current tab", then:
p51207
aVIf you mean "how do I respond when this tab is selected", then look at the  event (you don't necessarily need to care about the index when handling this event - you can just check  again)
p51208
as(dp51209
g18
V23354
p51210
stp51211
a((dp51212
g2
(lp51213
VYou could do that in TSQL via save points ( on SQL Server), but frankly I don't recommend it
p51214
aVYou can't do it via , as any abort is terminal (the entire transaction is rolled back as soon as any transaction in the tree indicates failure)
p51215
aVPersonally: check the data first, and only perform valid actions
p51216
aVIf it fails, that is terminal - roll it back
p51217
aVPossibly separate the work into atomic units that can be truly committed (or rolled back) in isolation
p51218
as(dp51219
g18
V23354
p51220
stp51221
a((dp51222
g2
(lp51223
VIf you want the same API on multiple platforms, Jon Skeet's implementation may be more appropriate to you
p51224
aVThe difference is that protobuf-net is designed around common C# development patterns, for example it doesn't demand that you use the generated types (you can use your own, exactly like you can with , , etc) - and it supports some BCL concepts directly
p51225
aVThe two should be 100% compatible on the wire, but here's some API differences:
p51226
aVdirect support for , ,  etc (described by the contracts in bcl
p51227
aVproto in the zip)
p51228
aVsupport for inheritance (mapped as nested data on the wire)
p51229
aVsupport for your own types
p51230
aVsupport for mutable types (rather than the builder/immutable pair)
p51231
aVsupport for serialization callbacks
p51232
aV(possibly a few others - do you need a 100% complete list
p51233
aVThe one you are most likely to notice is inheritance
p51234
aVSimply: don't use this if you are planning to use interop
p51235
aVI have tried to make it very explicit in the intellisense if you are doing something that will use
p51236
aVNET-specific tricks, but if you start from a
p51237
aVproto it won't use these anyway (it should be portable-friendly)
p51238
as(dp51239
g18
V23354
p51240
stp51241
a((dp51242
g2
(lp51243
VAs suggested, this can be done - but in many cases you'll find yourself fighting the framework etc
p51244
aVIMO it may be simpler to just pass a  into the form (as a property, perhaps), and instances via an  property (or an interface / base-class if such applies)
p51245
aVYou can use generics, but in many cases in this scenario it won't actually help you much, and the designer hates it
p51246
as(dp51247
g18
V23354
p51248
stp51249
a((dp51250
g2
(lp51251
VI would say use the simple delegate; simply - it is already (internally) a list, so you are duplicating effort by wrapping it in
p51252
aVYou also have the overhead of extra list objects and arrays, that could be null, so more impact on garbage collection etc
p51253
aVAlso, if you are doing lots of this, consider , which exists to provide efficient access to sparse events - i
p51254
ag50
aVwhere you want to expose lots of events but many of them can be unassigned
p51255
aVThe first example is far closer to "standard" events (although you might want to watch for unassigned / null handlers when calling , as it could be null)
p51256
aVAdditionally, note that some languages (I honestly don't know what VB does here) applies synchronization to events, but in reality very few events really need to be thread-safe, so that could be overkill
p51257
aVedit it also occurs that there is a functional difference between them:
p51258
aVthe delegate approach treats different instances with the same target method / instance as equal (I don't think the  will)
p51259
aVduplicate delegates: delegate removes last first; list removes earliest first
p51260
aVcomposites: add A, add B, and remove (A+B) - with a delegate this should yield null / empty, but the list approach will retain A and B (with the (A+B) remove failing to find anything)
p51261
as(dp51262
g18
V23354
p51263
stp51264
a((dp51265
g2
(lp51266
VGenerics and reflection don't mix well, especially for lists
p51267
aVI would strongly suggest using (non-generic) , or if that fails (some generic lists don't implement it),  (since ) and invoke the  manually
p51268
aVI feel your pain, really (I maintain an OSS serialization API)
p51269
as(dp51270
g18
V23354
p51271
stp51272
a((dp51273
g2
(lp51274
VSimply, there is nothing in that code that would require boxing
p51275
aVThere are scenarios where boxing is unavoidable, and there are also additional opcodes for bridging the gap between value/ref types () in some cases
p51276
aVBut not in this case; no actual boxing required (the JIT can remove a few box-like cases - but not all, sadly)
p51277
as(dp51278
g18
V23354
p51279
stp51280
a((dp51281
g2
(lp51282
VAgreed, you shouldn't need an explicit dependency -  is fine
p51283
aVAnd protobuf-net uses the same logic re ignore etc
p51284
aVHow / where are you storing the data
p51285
aVIn my experience the most common cause of this is that people are over-writing a buffer (or file) with different data, and not truncating it (leaving garbage at the end of the stream), as discussed here
p51286
aVIs this related to your scenario
p51287
as(dp51288
g18
V23354
p51289
stp51290
a((dp51291
g2
(lp51292
VTwo likely possibilities occur to me:
p51293
aVyou have some other code (perhaps an event handler responding to the observable collection's events, or perhaps another thread) that is explicitly calling remove
p51294
aVTo check this, I would add some debug code that subscribes to the observable collection and writes a trace line when items are added removed - that should answer it pretty quickly
p51295
aVyou have multiple threads, and a thread-race situation is happening
p51296
aVNote that this collection is not synchronized, so if multiple threads change it (add/remove/re-assign) at the same time, all bets are off and it is entirely possible to lose data, especially with
p51297
aVTo check this, I would use the same trace handler as above, but I would include (in the output )
p51298
as(dp51299
g18
V23354
p51300
stp51301
a((dp51302
g2
(lp51303
VI have:
p51304
aV()
p51305
aV()
p51306
aVEach decorated (in the IDE) with the custom tool () and it is working fine
p51307
aVTwo  files are generated, one each nested under the  files, with the necessary generated types in each
p51308
aVHave I missed something
p51309
aVI guess I could make the first file (alone) generate the types from the imported files, but to do that I'd actually need to write a parser from scratch (at the moment it uses google's
p51310
aVproto parser under the hood)
p51311
aVRe changing the language - that isn't up to me; but do you simply mean the (existing)  declaration
p51312
as(dp51313
g18
V23354
p51314
stp51315
a((dp51316
g2
(lp51317
VWell, printing itself would suggest a predefined function
p51318
aVPresumably, though, you could obtain the characters and concatenate them manually in reverse (i
p51319
ag50
aVloop over it backwards)
p51320
aVOf course, you could say concatenation is a predefined function
p51321
aVso maybe the char array itself
p51322
aVBut again
p51323
aVwhy
p51324
aVIs the source allowed to contain "egaugnal detatneiro tcejbo si avaj" ;-p
p51325
aVAlso - note that string reversal is actually pretty complex if you consider unicode combining characters, surrogate pairs, etc
p51326
aVYou should note the caveat that most string reversal mechanisms will only deal with the more common cases, but may struggle with i18n
p51327
as(dp51328
g18
V23354
p51329
stp51330
a((dp51331
g2
(lp51332
Vare they isolated features
p51333
aVare there legal / management reasons they should be isolated
p51334
aVis it dictated that they share a release target, or is it an aim
p51335
aVIf one slips, do you want to be able to release the other
p51336
aVOr hold both back
p51337
aV(either answer can be right)
p51338
aVdoes one (but not both) depend on external factors outside your control
p51339
aVthe release of a 3rd-party toolkit, for example
p51340
aVare they both public knowledge
p51341
aVperhaps you want to release a beta/preview of one but not both
p51342
aVIn general I'm all in favor of keeping things simple
p51343
aVSometimes that means keeping them isolated, and sometimes it is easier to mix them up
p51344
aVIt really depends on the project, the team, etc
p51345
as(dp51346
g18
V23354
p51347
stp51348
a((dp51349
g2
(lp51350
VPersonally, I don't see huge value in that type of rule, but that is just me
p51351
aVBut it sounds like it is talking about nested types (it says "interfaces", not "interface implementations"), i
p51352
ag50
aV(since the other comparison is enums)
p51353
aVin which case you can order it as it suggests
p51354
aVI just wouldn't ;-p (and nested interfaces is a rarity anyway)
p51355
aVIf it means "explicit interface implementations", then you could just have them at this location and order them internally as already defined
p51356
as(dp51357
g18
V23354
p51358
stp51359
a((dp51360
g2
(lp51361
VThe constant expression is going to point to a capture-class generated by the compiler
p51362
aVI've not included the decision points etc, but here's how to get 30 from that:
p51363
aVis now
p51364
aVNote that I'm assuming that  is a property, but in reality you would write a  method that handles property / field
p51365
as(dp51366
g18
V23354
p51367
stp51368
a((dp51369
g2
(lp51370
VThe correct way to read such a reader would be, for example:
p51371
aVYou could also use an iterator block, and you might be able to use  / , but I couldn't say for sure so I've just used  in the above
p51372
as(dp51373
g18
V23354
p51374
stp51375
a((dp51376
g2
(lp51377
VIf you are using the inbuilt processing, then  only really wants to use the default constructor
p51378
aVYou could do that via:
p51379
aVbut note that there is a big difference between a  parent and a parent-id
p51380
aVI suspect the best approach would be to either write the data in a more hierarchical fashion, or to stick with what you have, but use a simple DTO during deserialization
p51381
aVThen translate this data into what you actually want in the next stage
p51382
aVSo, if you have:
p51383
aVYou might translate that as:
p51384
aVthis should do what you need
p51385
as(dp51386
g18
V23354
p51387
stp51388
a((dp51389
g2
(lp51390
VBy using  you are saying "split on any of these characters"; to split on the sequence  you must use the overload that accepts a :
p51391
aVOr in C# 3:
p51392
as(dp51393
g18
V23354
p51394
stp51395
a((dp51396
g2
(lp51397
VIn most cases involving serialization problems, the simplest thing to do is to translate the data into a simple DTO model that models exactly what you want (and not the bits you don't)
p51398
aVSo have an  class that looks like your  class, but which doesn't have the relationship you don't want
p51399
aVLINQ is good at that:
p51400
aVYou could also look at AutoMapper or implicit conversion operators to do the same without having to write too much extra mapping code each time
p51401
as(dp51402
g18
V23354
p51403
stp51404
a((dp51405
g2
(lp51406
VRather than  (which won't limit the results at the database), have you tried:
p51407
as(dp51408
g18
V23354
p51409
stp51410
a((dp51411
g2
(lp51412
VYou've used a mutable field () as part of the hash - that is unfortunately doomed
p51413
aVBy which I mean: when you add it, the  is 0
p51414
aV-1
p51415
aVit doesn't matter what exactly, but it isn't the final id - and it is stored with this key / hash
p51416
aVWhen you save it, the actual id (the  column from the database) is updated into the object
p51417
aVQuite simply, you cannot reliably hash against this value if it can change when it is part of a dictionary
p51418
aVOne possible workaround would be to consider the unit-of-work, i
p51419
ag50
aVan insert is a unit-of-work
p51420
aVMeaning: if the data etc only lives as long as this, then it is a non-issue as you will never attempt to access the data after saving it
p51421
aVSubsequently (in a different context) loading the data should be fine too, as the id doesn't then change during the lifetime
p51422
aVAlternatively: drop this hash/equality
p51423
as(dp51424
g18
V23354
p51425
stp51426
a((dp51427
g2
(lp51428
VIt is connected when it needs to be - i
p51429
ag50
aVwhen querying data and when submit changes
p51430
aVIf you supply a connection (to the overloaded constructor) that connection will be re-used, otherwise IIRC connection-pooling is used
p51431
aVFor fully disconnected, there are things like "sync services", which builds a local copy of the data
p51432
as(dp51433
g18
V23354
p51434
stp51435
a((dp51436
g2
(lp51437
VThere is another reason that much of this CLI info may be hard to get at - much of it may be implementation details, which could vary between (for example) MS
p51438
aVNET, CF, MF, Silverlight, Mono (regular), Mono (iPhone), etc
p51439
aVAnd certainly from a language perspective (C# etc) it is well off topic
p51440
aVYou'd have to check the CLI spec (ECMA 335)
p51441
aVEither the info is in there (in which case you're sorted) or it isn't (in which case it is an implementation detail)
p51442
as(dp51443
g18
V23354
p51444
stp51445
a((dp51446
g2
(lp51447
VIt needs to return exactly  to properly implement the  interface
p51448
aVIt is doing this using an "explicit interface implementation", so on the public API you see , but  is still happy
p51449
aVBut in reality you would very rarely write an enumerator this way in C# 2
p51450
aV0 or above; you'd use an iterator block ()
p51451
aVSee C# in Depth chapter 6 (free chapter
p51452
aVFor info, the reason that  exists at all here is that this looks like a
p51453
aVNET 1
p51454
aV1 sample, where that is the only way to create a typed enumerator
p51455
aVIn
p51456
aVNET 2
p51457
aV0 and above there is  / , which has a typed (via generics)
p51458
aVIn
p51459
aVNET 2
p51460
aV0 / C# 2
p51461
aV0 (or above) I would have simply:
p51462
as(dp51463
g18
V23354
p51464
stp51465
a((dp51466
g2
(lp51467
VWhat operations are you performing
p51468
ag412
ag50
aVwhat is the payload size
p51469
aVIf you perform vast numbers of operations with very small payloads, then you will obviously suffer more from latency etc; however bandwidth can also be an issue with non-trivial payloads
p51470
aVIf you are suffering from this, you could try a different serializer
p51471
aVLet me know if the payload size is a possible issue here, as there may be some options there
p51472
aVAlso; what security / streaming / etc options are you using
p51473
aVMessage-based security is more expensive at both ends (compared to transport security), and IIRC blocks streaming as the entire message must be available in order to verify it
p51474
aVSimilarly, if you are throwing blobs around you may benefit from enabling MTOM (which is posible over basic-http) and using the streaming APIs
p51475
as(dp51476
g18
V23354
p51477
stp51478
a((dp51479
g2
(lp51480
VI believe the  should be thread-safe - i
p51481
ag50
aVit won't error if  gets called twice with the same key, but obviously the query might execute twice
p51482
aVAnother question, however, is is the data thread-safe
p51483
aVThere is no guarantee that each  is isolated - it depends on the cache-provider
p51484
aVThe in-memory cache provider stores the objects directly, so there is a risk of collisions if any of the threads edit the data (add/remove/swap items in the list, or change properties of one of the items)
p51485
aVHowever, with a serializing provider you should be fine
p51486
aVOf course, this then demands that  is serializable
p51487
as(dp51488
g18
V23354
p51489
stp51490
a((dp51491
g2
(lp51492
V is a using directive, not a using statement
p51493
aVBut you need to add a reference because the  is not one of the standard dlls included in a winform / wpf etc project
p51494
aVThis is in part because it is unlikely you will need it, and in part because it isn't supported on "client profile"
p51495
aVThis is really just a library management issue; the CLR is huge; it doesn't assume you want everything
p51496
as(dp51497
g18
V23354
p51498
stp51499
a((dp51500
g2
(lp51501
VSomething like:
p51502
as(dp51503
g18
V23354
p51504
stp51505
a((dp51506
g2
(lp51507
VCheck  on them
p51508
as(dp51509
g18
V23354
p51510
stp51511
a((dp51512
g2
(lp51513
VYou cannot bind directly to method variables, since a: there is no reflection to them, and b: they may not actually exist by the time the compiler is through
p51514
aVAlso, in implementation terms it would be very confusing for something like a class () to have access to the current stack position (since the two would be miles apart)
p51515
aVYou can reflect on fields though (variables on a class / struct) using reflection (, usually needing the non-public | instance binding-flags)
p51516
aVFor your example, "captured variables" might be of use, but you'd need to be using lambdas / expressions for that to work
p51517
aVBut in C# terms:
p51518
as(dp51519
g18
V23354
p51520
stp51521
a((dp51522
g2
(lp51523
V is generic, isn't a collection class, and can't involve inheritance since it relates to s
p51524
aVThe generic delegate families are quite nice - , ,  - it is much clearer what  is rather than some custom  or whatever
p51525
as(dp51526
g18
V23354
p51527
stp51528
a((dp51529
g2
(lp51530
V is a public generic class (derived from ) with a single generic type argument called , where any supplied  must implement the  interface (caveat: the  pattern is merely a convention;  could be a class, I suppose)
p51531
aVThe type  is not a concrete type; it must be further subclassed to be instantiated - presumably by things like below (although a generic subclass would also suffice):
p51532
as(dp51533
g18
V23354
p51534
stp51535
a((dp51536
g2
(lp51537
VYou should be able to use an anonymous method or lambda to provide full static checking:
p51538
aVor if you want to do something with the result:
p51539
aVbut note that this "do something" still runs in the context of the new thread (but with access to the other variables in the outer method () courtesy of "captured variables")
p51540
aVIf you have C# 2
p51541
aV0 (and not above), then:
p51542
aVand
p51543
as(dp51544
g18
V23354
p51545
stp51546
a((dp51547
g2
(lp51548
V@thecoop's answer is a very good description of "field-like events" (noting the "simplified" caveat) - but note that actually events can be implemented any way you like
p51549
aVAll the event defines is an / accessor pair (which is why it can be defined on the interface, like a property)
p51550
aVFor example, with sparce events the following may be common:
p51551
aVwhere  is an , usually delay-loaded:
p51552
aVOr you could do anything else you like
p51553
aVWithin reason (noting the expected behaviour of event subscriptions and delegate equality / composite delegates)
p51554
as(dp51555
g18
V23354
p51556
stp51557
a((dp51558
g2
(lp51559
VCtrl+W,O
p51560
aVIt is on the menu in expert mode; Tools => Settings => Expert Settings
p51561
aVIn reality most of the useful options are in expert mode; I can't think of a sane reason to use basic mode, nor why it is the default (instead perhaps of asking me "Have you ever programmed before
p51562
as(dp51563
g18
V23354
p51564
stp51565
a((dp51566
g2
(lp51567
VYou're going to have to take complete control of it, then - for example my marking that member as  and adding a public  property such as:
p51568
as(dp51569
g18
V23354
p51570
stp51571
a((dp51572
g2
(lp51573
V is the list - so you can just call  on yourself
p51574
aVYou can't reassign the list - that would essentially be changing
p51575
as(dp51576
g18
V23354
p51577
stp51578
a((dp51579
g2
(lp51580
VNo
p51581
aVYou can do it project wide via a build flag, but otherwise a field is just another (small) block
p51582
aVOf course, you could assign it a value somewhere
p51583
aVthat'll make it happy ;-p (I'm assuming it is actually assigned a value via reflection or something
p51584
as(dp51585
g18
V23354
p51586
stp51587
a((dp51588
g2
(lp51589
VThe only truly secure way to protect your dll is not to give it to them
p51590
aVExpose it instead via a web-service etc (obviously this doesn't work in all cases)
p51591
aVEvery obfuscator can be broken with patience
p51592
aVThink how much the games industry spends on this, and things are broken / reverse-engineered within days, sometimes hours
p51593
aVLawyers" may serve as a layer of protection, and obfuscation will certainly discourage idle browsing
p51594
aVBut a determined hacker (for example, for commercial illegal spying) will be able to get at your code eventually
p51595
aVI guess you simply need to weigh the costs and benefits
p51596
as(dp51597
g18
V23354
p51598
stp51599
a((dp51600
g2
(lp51601
Vor for your own type:
p51602
as(dp51603
g18
V23354
p51604
stp51605
a((dp51606
g2
(lp51607
VNone is important for  enums, and should have the value 0
p51608
aVOtherwise
p51609
aVquestionable
p51610
aVA  would also suffice
p51611
aVBut  may be demanded for their serialization or ORM layers (it might map to an expected string / int-value etc)
p51612
aVOr it might just make the API simpler
p51613
as(dp51614
g18
V23354
p51615
stp51616
a((dp51617
g2
(lp51618
VFrom what I can see,  is not  (nor is ), so we're really talking about garbage collection here, not disposal
p51619
aVYou should be able to add your own finalizer (), but that should only talk to unmanaged objects - the other managed objects will also be collected, after all (and should handle their own unmanaged objects, if any - which is rare)
p51620
as(dp51621
g18
V23354
p51622
stp51623
a((dp51624
g2
(lp51625
VIf it was up to me, I would go for Win7 x64 for a host, with as much memory as I could afford, and use virtual machines to represent the server (and desktop) platforms I am targetting
p51626
aVHosting on Server 2008
p51627
aVFire up a Server 2008 VM
p51628
aVDatabase is SQL 2005 on Server 2003
p51629
aVAdd a VM
p51630
aVOtherwise, with <= 4 gig RAM, Win7 x86; my (slightly old) laptop works much better on Win 7 than it ever did (same laptop) on XP / Vista
p51631
aVI also tend to find that VMWare Player (Workstation if you have the cash) works better for me than either Microsoft Virtual PC or Windows Virtual PC
p51632
as(dp51633
g18
V23354
p51634
stp51635
a((dp51636
g2
(lp51637
VLINQ is a broad technology name covering a large chunk of
p51638
aVNET 3
p51639
aV5 and the C# 3
p51640
aV0 changes;  "query in the language" and tons more
p51641
aVA delegate is comparable to a function-pointer; a "method handle" as an object, if you like, i
p51642
ag50
aVis a way of writing a delegate that I can then call
p51643
aVDelegates also underpin eventing and other callback approaches
p51644
aVAnonymous methods are the 2
p51645
aV0 short-hand for creating delegate instances, for example:
p51646
aVthey also introduced full closures into the language via "captured variables" (not shown above)
p51647
aVC# 3
p51648
aV0 introduces lambdas, which can produce the same as anonymous methods:
p51649
aVbut which can also be compiled into expression trees for full LINQ against (for example) a database
p51650
aVYou can't run a delegate against SQL Server, for example
p51651
aVbut:
p51652
aVcan be translated into SQL, as it is compiled into an expression tree ()
p51653
aVSo:
p51654
aVan anonymous method can be used to create a delegate
p51655
aVa lambda might be the same as an anon-method, but not necessarily
p51656
as(dp51657
g18
V23354
p51658
stp51659
a((dp51660
g2
(lp51661
VI'd be interested in who those "Many people" are; Mono is a considerable achievement, with serious backing (Novell) and also gets assistance from Microsoft
p51662
aVIt is used in many serious and commercial applications
p51663
aVThere would be little benefit in duplicating this huge amount of work
p51664
aVThe Mono CLI implementation is pretty solid
p51665
aVThere are certainly some gaps in libraries (WPF, for example) - but that is a strategic decision; the plan there is to track Silverlight, and bring Moonlight up until the inevitable point when WPF and Silverlight  are largely indistinguishable
p51666
aVThere are also several things that are in advance of Microsoft's
p51667
aVNET implementation; full AOT, for example, or the compiler-as-a-service (managed compiler)
p51668
aVYou have mono on the server, on the desktop, in the browser (Moonlight) and on the mobile (Android and iPhone, 3
p51669
ag9575
aV1 aside) - possibly other places too
p51670
as(dp51671
g18
V23354
p51672
stp51673
a((dp51674
g2
(lp51675
VIf "Date" is a blob, it should already come out as a byte[] - not sure why you are calling , but  will only parse a single byte
p51676
as(dp51677
g18
V23354
p51678
stp51679
a((dp51680
g2
(lp51681
VIf you have the root of the tree you wan't, can't you just use:
p51682
as(dp51683
g18
V23354
p51684
stp51685
a((dp51686
g2
(lp51687
VMeta-programming has all the advantages of build-time code-gneneration, but without the additional code step
p51688
aVThis is very common in library code, such as ORMs, serializers, some types of AOP, DI/IoC containers, etc
p51689
aV+ avoids the need for extra build steps or writing mundane code
p51690
aV+ such code can handle what actually is the case at runtime, rather than having to handle any uncommon edge-cases or lots of wrappers around wrappers (decorator pattern)
p51691
aV+ allows codegen in scenarios where the metadata is only known at runtime
p51692
aV+ runtime IL can have more access to private fields etc, thanks to how  can be associated with a type; fully generated (dll) code would require  or similar, which may be impossible
p51693
aV- not all systems support runtime code-gen; it is disabled on some server setups, compact framework, iPhone, etc
p51694
aV- it is bug ugly to do
p51695
aVRegardless of how you do it, this is not normal code
p51696
aV- it needs a really good understanding of how things actually work under the covers
p51697
aV+ if forces you to get a really good understanding of how things actually work under the covers
p51698
aVI'm currently re-writing an existing library to use runtime IL generation; it is very rewarding and I'm happy with it; but it is unlike anything I've written before
p51699
as(dp51700
g18
V23354
p51701
stp51702
a((dp51703
g2
(lp51704
VYou say "this value is clearly 7", but it depends entirely on the encoding
p51705
aVIf we assume full-width bytes, then in little-endian, yes; 7, 0 is 7
p51706
aVBut in big endian it isn't
p51707
aVFor little-endian, what you want is
p51708
aVand for big-endian:
p51709
aVBut other encoding schemes are available; for example, some schemes use 7-bit arithmetic, with the 8th bit as a continuation bit
p51710
aVSome schemes (UTF-8) put all the continuation bits in the first byte (so the first has only limited room for data bits), and 8 bits for the rest in the sequence
p51711
as(dp51712
g18
V23354
p51713
stp51714
a((dp51715
g2
(lp51716
VThe variables aren't important (although you could store them in a single  field if it made things easier)
p51717
aVThe normal way to do this is to look through the  collection (recursively, if necessary)
p51718
aVThe above assumes all the buttons were added to the same parent control; if that isn't the case, then walk recursively:
p51719
as(dp51720
g18
V23354
p51721
stp51722
a((dp51723
g2
(lp51724
VI think the best we can do from here is give you some pointers:
p51725
aVquery less data from the sql server (caching, appropriate query filters)
p51726
aVwrite better queries (indexing, joins, paging, etc)
p51727
aVminimise any inappropriate blockages such as locks between different requests
p51728
aVmake sure session-state hasn't exploded in size
p51729
aVuse bigger metal / more metal
p51730
aVuse appropriate looping code etc
p51731
aVBut to stress; from here anything is guesswork
p51732
aVYou need to profile to find the general area for the suckage, and then profile more to isolate the specific area(s); but start by looking at:
p51733
aVsql trace between web-server and sql-server
p51734
aVnetwork trace between web-server and client (both directions)
p51735
aVcache / state servers if appropriate
p51736
aVCPU / memory utilisation on the web-server
p51737
as(dp51738
g18
V23354
p51739
stp51740
a((dp51741
g2
(lp51742
VIt is checking whether the grid contains your new column (which obviously it won't; you haven't added it yet); you actually want to check whether it contains a different column with the same name
p51743
aVPerhaps just loop over the , checking for one with
p51744
as(dp51745
g18
V23354
p51746
stp51747
a((dp51748
g2
(lp51749
V is a family of delegate types, that return some value, and take some number of arguments; for example:
p51750
aVis simply something that takes an int and returns a bool (the return is always at the end); for example a predicate:
p51751
aVis a method that returns string, such as
p51752
aVmight be something like
p51753
aVLikewise there is  which does the same but without a return type
p51754
aVThere's nothing magic about  - it is just a simpler way of expressing delegates, while a: using generics (useful for LINQ), or b: not needing you to look up what the arguments are; if the delegate type is something obscure ( for example) it can be hard to know what it takes; if that was expressed as the comparable  it would be clear that it takes no parameters and returns
p51755
as(dp51756
g18
V23354
p51757
stp51758
a((dp51759
g2
(lp51760
VFor any interval, you just want something like:
p51761
aV(you don't need to worry about "entirely in this interval", since "starts in" and "ends in" covers that)
p51762
aVNote I'm assume that @start is inclusive and @end is exclusive, which is a pretty common way of doing it (avoiding double-counting on boundaries, etc) - but feel free to add / remove a few  on the inequalities
p51763
aVFor example, to include both ends:
p51764
as(dp51765
g18
V23354
p51766
stp51767
a((dp51768
g2
(lp51769
VIf you are using the designer then it generates the C# class for you; so if have a form called , you should just need to do something like:
p51770
aVor for a modal popup:
p51771
as(dp51772
g18
V23354
p51773
stp51774
a((dp51775
g2
(lp51776
VThe most common example I can think of here is things like  vs ; the concrete types ( etc) generally do a lot of method hiding to make the return types of properties / methods display the correct implementation type
p51777
aVThis is because the related objects themselves have additional (implementation-specific) features, and the caller doesn't want to have to cast every time they call do anything
p51778
as(dp51779
g18
V23354
p51780
stp51781
a((dp51782
g2
(lp51783
VYou probably don't even need  here; the simplest way to do this is something like:
p51784
as(dp51785
g18
V23354
p51786
stp51787
a((dp51788
g2
(lp51789
VWhy would it contain a root
p51790
aVYou aren't adding one in , where you create the
p51791
aVI wonder if you should have something more like (C#, sorry):
p51792
aVThis uses the regular  core for things like writing the outer element(s)
p51793
aVAlternatively, change  to include an outer element of your choosing
p51794
as(dp51795
g18
V23354
p51796
stp51797
a((dp51798
g2
(lp51799
VIt is hard to tell without a full sample, but a common reason for  /  returning  is xml namespaces
p51800
aVIf you xml makes use of element namespaces, you'll probably need to use an  along with your query, and define a suitable alias for the namespace you want
p51801
as(dp51802
g18
V23354
p51803
stp51804
a((dp51805
g2
(lp51806
VIt knows that a struct is never null ( aside); that is enough to emit the warning
p51807
aVThere is a known compiler issue in this area, that arose between the C# 2
p51808
aV0 compiler and the C# 3
p51809
aV0  compiler (and remains in the C# 4
p51810
aV0 compiler at the moment) [I'm not sure why you are seeing it on VS2005, though]
p51811
aVThe equality test does not raise an unreachable-code warning for custom structs with  /  operators
p51812
aVhas these operators; your struct doesn't - hence the difference
p51813
aVThis issue is logged on connect, and has been looked at fairly recently by the compiler team (who are keen to fix it when opportunity arises)
p51814
as(dp51815
g18
V23354
p51816
stp51817
a((dp51818
g2
(lp51819
VIf this is an unexpected case (i
p51820
ag50
aVindicates an error), a  constraint should suffice
p51821
aVThere is no direct way to do it via LINQ-to-SQL, so your  (or a  on a connection passed in) is a viable mechanism
p51822
aVAnother might be an instead-of trigger, or a stored-procedure to do the
p51823
aVWhat you have is probably the simplest; see if it is fast enough (it has an extra round-trip) and stick with it
p51824
as(dp51825
g18
V23354
p51826
stp51827
a((dp51828
g2
(lp51829
VI'm assuming that  is a projection of a column from a simple table map, such as:
p51830
aVWell, that by itself doesn't actually do any execution; it builds a composed query representation that is (from the outside in):
p51831
aV[predicate]
p51832
aV(wrapping)  [selector]
p51833
aV(wrapping)  [selector]
p51834
aV(wrapping) a table query
p51835
aVNothing else happens until you either iterate the data (, , etc) or call  (etc)
p51836
aVWith LINQ-to-SQL (from the tags) it then builds a single TSQL query (making the "order of execution" a problem only for the db engine itself) suitable for the current connection (the specific SQL-Server flavour), which will look something like:
p51837
aVprobably passing  as
p51838
aVIf this were LINQ-to-Objects, data is fetched from the outside in, with each layer asking inner layers for data and filtering/manipulating it as necessary
p51839
aVAs such, with LINQ-to-Objects it makes sense to do the  ahead of the
p51840
aVWith LINQ-to-SQL it won't matter
p51841
as(dp51842
g18
V23354
p51843
stp51844
a((dp51845
g2
(lp51846
VIt depends on the scenario; in most cases: rather than cancel the event, just do nothing, for example:
p51847
aVor:
p51848
aVThere are some events that expose a  (or similar), allowing to to cancel some external behaviour via the  - form-closing being the most obvious example (set )
p51849
aVNote that in this scenario I would not have an automatic dialog-result on the button; apply that manually when (if) the handler completes successfully
p51850
as(dp51851
g18
V23354
p51852
stp51853
a((dp51854
g2
(lp51855
VThe canonical answer would be , but that is a: a bit slow if used in a tight loop, and b: not useful for  enums
p51856
aVPersonally, I'd stop worrying about that, and just  appropriately, remembering:
p51857
aVif it is OK not to recognise everything (and just not do anything), then don't add a  (or have an empty  explaining why)
p51858
aVif there is a sensible default behaviour, put that in the
p51859
aVotherwise, handle the ones you know about and throw an exception for the rest:
p51860
aVLike so:
p51861
as(dp51862
g18
V23354
p51863
stp51864
a((dp51865
g2
(lp51866
VI don't know how  loads the types, but you could try using  -  subscribe to the  event, and load the assembly yourself and return (yes, return) the  instance (or  if you don't recognise it)
p51867
aVNot all such code uses approaches compatible with this, but it is worth a try
p51868
as(dp51869
g18
V23354
p51870
stp51871
a((dp51872
g2
(lp51873
VI'm not entirely clear on the entire scenario; however  can be used to pass a concrete item in (in the case where you want to create an empty concrete instance yourself and let protobuf-net fill in the properties)
p51874
aVIf the  is decorated with  for the expected  it should allow deserialization - abstract types are supported just as long as it never finds it needs to create one
p51875
aVSee also my answer here which shows this in use
p51876
aVIf you can supply an example that I can use to reproduce the issue I should be able to provide more information
p51877
aVBased on some off-forum examples, I think I've concluded that this is supported, but:
p51878
aVif you just use , the outmost  derivative will be created by default as ; you can get around this by using  instead, passing in a concrete list instance of your choosing to be filled
p51879
aVall of , ,  should be marked as contract-types, with appropriate inheritance markers between  and , and  and
p51880
aVin "v2" (soon) there is more control to manage concrete list types (and item types for untyped lists)
p51881
aVthere does seem to be a glitch related to list deserialization where the stated item type is not the root type
p51882
aVThis looks to have been fixed automatically in "v2", but I need to chase it through (this unfortunately touches on the wrapper "WithLengthPrefix" / list outermost methods, which I'm still working on)
p51883
aVin "v2" you can do the whole thing without needing the attributes if you like (although it still needs to be told how at some point)
p51884
aVBut yes; it should work
p51885
aVI've e-mailed you a sample, and intend to tidy up the aforementioned outermost methods
p51886
as(dp51887
g18
V23354
p51888
stp51889
a((dp51890
g2
(lp51891
VAs different possible results from the same method
p51892
aVThat would be ugly, and doesn't allow a rigid schema (think: WSDL) to exist
p51893
aVPerhaps encapsulate all 4 options on a single type that you do return
p51894
aVOr use some kind of inheritance and
p51895
aVIn the case of multiple values, you can return
p51896
aVIf you mean "I want all these in one hit to the method", then just wrap them:
p51897
aVand return an instance of  (or  for multiple values)
p51898
as(dp51899
g18
V23354
p51900
stp51901
a((dp51902
g2
(lp51903
V is going to be problematic
p51904
aVI would try something more like:
p51905
aVNote that the unreleased "v2" code offers much more ability to define the relationships at runtime rather than through attributes (which is quite limiting here)
p51906
as(dp51907
g18
V23354
p51908
stp51909
a((dp51910
g2
(lp51911
VHave you tried it
p51912
aVWhich bit specifically suggests no lists
p51913
aVFor info, as soon as I have all the tools together (VS2010 / Phone 7 sdk etc) I plan on seeing what protobuf-net can do for Phone 7, but  should be a solid default
p51914
as(dp51915
g18
V23354
p51916
stp51917
a((dp51918
g2
(lp51919
V(although it should still probably be exposed as a  property rather than a public field)
p51920
as(dp51921
g18
V23354
p51922
stp51923
a((dp51924
g2
(lp51925
VTry in System
p51926
aVServiceModel
p51927
aVWeb
p51928
aVdll
p51929
as(dp51930
g18
V23354
p51931
stp51932
a((dp51933
g2
(lp51934
VI would use explicit invariant for serialization to avoid any unexpected gotchas
p51935
aVYou may also want to think whether you need UTC or not; for example:
p51936
as(dp51937
g18
V23354
p51938
stp51939
a((dp51940
g2
(lp51941
VThere is no direct generic operator support in C#
p51942
aVYou can fake it in C# 4
p51943
aV0 on
p51944
aVNET 4 using  - i
p51945
ag50
aVOr you can do it in
p51946
aVNET 3
p51947
aV5 and above using MiscUtil which provides an  class with utility methods (which supports custom and inbuilt operators):
p51948
aVAlternatively; provide an  interface and write implementations per-type
p51949
as(dp51950
g18
V23354
p51951
stp51952
a((dp51953
g2
(lp51954
VUltimately this type of data-binding is often  reflection-based, and reflection is -based; so boxing is a reality
p51955
aVActually, you can control this when implementing , but it would be a large amount of work, and I'm guessing they simply haven't (sensibly)
p51956
aVThe simpler way to do this (which I'm assuming they are using) is to trust the , calling  and then using
p51957
aVOnce you've called  there isn't any point not using the object you've already boxed (and would have to then unbox)
p51958
aVAnd if you don't trust the  you are getting into very implementation-specific code, that doesn't support the general  view of the world (so it won't work on data-tables or bespoke models, etc)
p51959
as(dp51960
g18
V23354
p51961
stp51962
a((dp51963
g2
(lp51964
VYou should probably exclude the  case too, to reduce a few CPU cycles:
p51965
as(dp51966
g18
V23354
p51967
stp51968
a((dp51969
g2
(lp51970
VIt is a bit artificial to unit test this, since each LINQ provider is implementation-specific
p51971
aVYou might use various different approaches in your test, and it simply won't tell you anything about the real implementation
p51972
aVFor example, if it is mocked via LINQ-to-Objects, I could use:
p51973
aVThat will work with LINQ-to-Objects
p51974
aVbut only with LINQ-to-Objects
p51975
aVLikewise, a UDF usage (or one of the SQL helper methods) will work in LINQ-to-SQL but not Entity Framework
p51976
aVI've reached the conclusion that only integration tests are useful for this scenario, so no; mocking isn't very helpful here
p51977
aVIt will give you a warm happy feeling that you've done something useful, but ultimately it doesn't test that what you write in your app will work
p51978
aVAn even better approach, IMO, is not to expose such over your repository interface
p51979
aVIf you limit the LINQ queries to your data-layer you remove the risk and now you are testing (/mocking) a pure, predicatable interface
p51980
aVI discuss this more here
p51981
as(dp51982
g18
V23354
p51983
stp51984
a((dp51985
g2
(lp51986
Vor with LINQ:
p51987
as(dp51988
g18
V23354
p51989
stp51990
a((dp51991
g2
(lp51992
VHTML Agility Pack
p51993
aVSimilar API to , for example (from the examples page):
p51994
aV(you should also be able to use  to load a string of html, rather than from a path)
p51995
as(dp51996
g18
V23354
p51997
stp51998
a((dp51999
g2
(lp52000
VWhen you say "can no longer run it"
p52001
aVwhat happens
p52002
aVthe sln files are not compatible; you'll need different sln files for each VS version
p52003
aVthe csproj are mostly compatible, although you might see a "version 4 not recognised, using 3
p52004
aV5 instead" warning or two, which is usually fine
p52005
aVthe cs is compatible as long as you don't use  or the other new language features
p52006
aVIn most cases you can get away with just having a separate sln for VS2010
p52007
aVSo just rename it to "Whatever_2010
p52008
aVsln", get your old "Whatever
p52009
aVsln" back from your source repository, and rename it to "Whatever_2008
p52010
aVsln"
p52011
as(dp52012
g18
V23354
p52013
stp52014
a((dp52015
g2
(lp52016
VI would guess the easiest way to do this would be to intercept key-presses at a higher level, such as PreviewKeyDown in winforms (or use  on the form, set  to , and use  to stop the key going down to the controls)
p52017
aVThere might be a direct API to the device; there might not
p52018
as(dp52019
g18
V23354
p52020
stp52021
a((dp52022
g2
(lp52023
VThe correct time to set a WCF principal is via , by specifying a custom policy in configuration
p52024
aVThis covered in full here
p52025
aVIf you try setting the principal at other points (an inspector, perhaps) it can get reset by the system
p52026
as(dp52027
g18
V23354
p52028
stp52029
a((dp52030
g2
(lp52031
VTwo options; the simplest (but giving odd xml) is:
p52032
aVWith example output:
p52033
aVThe more elegant is:
p52034
aVWith example output:
p52035
aVIn either case you must cache and re-use the  instance; otherwise you will haemorrhage memory from dynamic compilation
p52036
as(dp52037
g18
V23354
p52038
stp52039
a((dp52040
g2
(lp52041
VNo, basically
p52042
aVIt is optimised to provide some specific/common scenarios
p52043
aVIf you go outside those scenarios it won't work
p52044
aVIf you need  etc, use  instead
p52045
as(dp52046
g18
V23354
p52047
stp52048
a((dp52049
g2
(lp52050
VLook at pre-rolled logging implementations; they may save you lots of headaches
p52051
aVObviously keeping the stream open means you might lose some of the end data if it crashes, but may gaing performance from buffering the IO more
p52052
aVSome implementations may also offer features such as asynchronous logging from a spooler/queue
p52053
as(dp52054
g18
V23354
p52055
stp52056
a((dp52057
g2
(lp52058
VWhen you start getting inheritance, it indeed gets tricky to choose a
p52059
aVThe base-type is the obvious choice, but I wonder if it isn't more appropriate to just override  and
p52060
aVYou might also conclude that such complex scenarios might be poor choices for a key, and use a simpler, more predictable key instead
p52061
aVIn particular you want the "hash" to be based on some immutable facet of the type, and the "hash" and "equals" must be compatible
p52062
aVThese nuances are very hard to guarantee if the type isn't
p52063
as(dp52064
g18
V23354
p52065
stp52066
a((dp52067
g2
(lp52068
VA  operator that invokes a constructor can throw any exception that you can imagine
p52069
aVFro example, if inside the constructor it tries to allocate something big and fails, then that exception might be caught and re-raised as something more exotic
p52070
aVOf course, at the point when you start seeing out-of-memory you should probably consider the process terminally ill, and put it out of its misery ASAP
p52071
aVConstructors can also, despite all the rumours to the contrary, return  even for classes - but that is an extreme edge-case, bordering on the pathological
p52072
as(dp52073
g18
V23354
p52074
stp52075
a((dp52076
g2
(lp52077
VIt is generated during build, but you can provide your own (disambiguating it in project-properties as necessary)
p52078
aVLook in obj/debug for an app file; I have (courtesy of "C# 2010 Express")  with:
p52079
as(dp52080
g18
V23354
p52081
stp52082
a((dp52083
g2
(lp52084
VIf you have an , you can use  as an  to pass to , but I wonder if it would be better to do it the other way; use an  to get the outermost element name, and give that to
p52085
as(dp52086
g18
V23354
p52087
stp52088
a((dp52089
g2
(lp52090
VWhich method
p52091
aVIf you mean , then I believe that is already transactional
p52092
aVOtherwise, just spin up your own  around what you want controlled, or pass in a configured connection to the  overloaded constructor
p52093
as(dp52094
g18
V23354
p52095
stp52096
a((dp52097
g2
(lp52098
VYes, that is a very stanadrd scenario for serialization
p52099
aVThe only caveat is that I would advise using something "contracts" based, such as  (or if you want binary instead of xml, protobuf-net)
p52100
aVFor , adding a parameterless constructor would be necessary, and you might want to add some xml adornments to control the formatting:
p52101
aVThen you could serialize with:
p52102
as(dp52103
g18
V23354
p52104
stp52105
a((dp52106
g2
(lp52107
VHere's two different approaches; the first applies the filter before doing the , since the joined queries don't have to just be basic tables
p52108
aVThe second approach applies the filter after the join, using an intermediary projection (and changing it to return the predicate, rather than applying it internally)
p52109
aVThis has been tested successfully on
p52110
aVNET 3
p52111
aV5 and
p52112
aVNET 4; note that in 3
p52113
aV5 (SP1) the  (for the second example) won't work on EF, but is fine for LINQ-to-SQL
p52114
aVIf you want to run the example, I've used Northwind (just because that is what I had locally):
p52115
as(dp52116
g18
V23354
p52117
stp52118
a((dp52119
g2
(lp52120
VAt a guess, the table is going to use reflection () to create instances of the cell on a per-row basis; so yes - it will need a public parameterless constructor to do that
p52121
as(dp52122
g18
V23354
p52123
stp52124
a((dp52125
g2
(lp52126
VThe xml is intact, so any xml-model should work
p52127
aVshould be fine, for example; but how about an ad-hoc model of anonymous types
p52128
aVNow explore  ;-p
p52129
as(dp52130
g18
V23354
p52131
stp52132
a((dp52133
g2
(lp52134
VAn abstract type is defined largely as one that can't be created
p52135
aVYou can create subtypes of it, but not of that type itself
p52136
aVThe CLI will not let you do this
p52137
aVAn  class has a  constructor (by default) allowing derived types to initialize it
p52138
aVFor example, the base-type  is abstract
p52139
aVWithout a derived type where would the data go
p52140
aVWhat would happen when you call an  method
p52141
aVThere would be no actual implementation of the method to invoke
p52142
as(dp52143
g18
V23354
p52144
stp52145
a((dp52146
g2
(lp52147
VI would guess that you have an event-handler that isn't happy
p52148
aVWhat exactly does the message say
p52149
aVYou might also be having problems if you are adding the same  instance to the list multiple times; since  will only find the first occurrence
p52150
aVThis line makes me very suspicious:
p52151
aVsince it could potentially (on consecutive clicks / etc) do exactly this
p52152
aVNote: if you used  instead all you'd have to doo is  - no resetting required:
p52153
aVfield:
p52154
aVinit grid:
p52155
aVadd item:
p52156
as(dp52157
g18
V23354
p52158
stp52159
a((dp52160
g2
(lp52161
VYou are trying to protect your system from something that is stronger than your code
p52162
aVIf you don't trust certain code, run it with partial trust - then when it asks to reflect your type it will be denied
p52163
aVReflection (and related techniques like ) can with enough trust get virtually unrestricted access to your data (even, for example, changing the characters of a  without ever re-assigning it); thus you must reduce trust for non-trusted code
p52164
aVIn a similar way, anyone with debugger or admin access to your process (or the dlls it loads) can subvert your code
p52165
aVThis is not an interesting attack, as the "hacker" must already have at least as much access than your code (probably more)
p52166
as(dp52167
g18
V23354
p52168
stp52169
a((dp52170
g2
(lp52171
VLook at the line:
p52172
aVThat should immediately leap out as the cause
p52173
aVThe generated  must be suitable typed
p52174
aVThis type of metaprogramming often involves either using the non-generic API, or using reflection to create the correct type on the fly
p52175
aVFortunately, a suitable example is here
p52176
aVYou should be able to use that approach re  (or simpler: just use the code "as is" from inside )
p52177
as(dp52178
g18
V23354
p52179
stp52180
a((dp52181
g2
(lp52182
VThere are different options here depending on the scenario
p52183
aVI'm using SQL Server for a lot of the examples below, but much of it is broadly transferable between systems
p52184
aVFor a relatively small array (ideally vector) you can construct a delimited string (tab delimited, comma delimited, whatever), and pass that into your DB and parse - usually manually (DBMS often lack a "split" routine), but it is very easy to obtain a pre-written "split" implementation (for example, as a UDF in SQL Server)
p52185
aVTypical usage:
p52186
aVXml is another option, especially for complex data; SQL Server 2005 and above has inbuilt xml parsing, but that should not be assumed in general
p52187
aVTable-valued parameters are another option, but this is SQL Server 2008 only - it might well be what you are looking for, though
p52188
aVAnother option, especially for large data, is to pump the data into the server separately (bulk insert, , "bcp", SSIS whatever) and process the data via SQL once it is there
p52189
aVTo get array/tabular data out, a standard  should be your default option, although you can of course also construct xml or delimited character data
p52190
aVThe latter can be accomplished via a quirk of SQL:
p52191
as(dp52192
g18
V23354
p52193
stp52194
a((dp52195
g2
(lp52196
VThis sounds like the common issue of referential equality vs , and is especially common with serialization
p52197
aVOverride  (and ) appropriately and you should be back in business
p52198
aVFor info, using  should generally be avoided unless you are using
p52199
aVNET 1
p52200
aV1 (or micro-framework), or have a very valid reason to do so; prefer the generic typed collections, such as
p52201
as(dp52202
g18
V23354
p52203
stp52204
a((dp52205
g2
(lp52206
VDo whatever makes the API clearest
p52207
aVIf the caller only needs to enumerate it you could expose as , but I wouldn't be concerned about exposing it as
p52208
aVYou could declare a custom type (interface or class) with just an indexer and enumerator, of course
p52209
as(dp52210
g18
V23354
p52211
stp52212
a((dp52213
g2
(lp52214
VWhat does the code that raises this look like
p52215
aVI'm guessing it is something like:
p52216
aVwhich is implicitly:
p52217
aVwhich does a capture of , and pretty-much means that the expression tree must be constructed (with ) from scratch each time
p52218
aVAnd then you parse it each time
p52219
aVSo the overhead is definitely non-trivial
p52220
aVIs is too much though
p52221
aVThat is a question only you can answer, with profiling and knowledge of your app
p52222
aVIt is seen as OK for a lot of MVC usage, but that isn't (generally) calling it in a long-running tight loop
p52223
aVYou need to profile against a desired performance target, basically
p52224
as(dp52225
g18
V23354
p52226
stp52227
a((dp52228
g2
(lp52229
VAs I understand it - if it can't use the pre-compiled query exactly (because you have composed it further), it just runs it as it would any regular  query - so it will indeed still issue a  (it shouldn't iterate the entire table / whatever)
p52230
aVBut the real answer is: profile it; you can hook  to see the TSQL, for example:
p52231
aVor just use SQL trace to see what goes up and down the wire
p52232
as(dp52233
g18
V23354
p52234
stp52235
a((dp52236
g2
(lp52237
VThat doesn't sound nice
p52238
aVI wonder if configuring this through IoC is going to be simpler and easier to support
p52239
aVMost IoC containers will support singeton-style object re-use, and highly configurable initialization
p52240
aVWithout the side-effect making your object all ugly
p52241
aVSingleton is nice, but is vastly over-used
p52242
aVOf course I'm as guilty of this as the next geek
p52243
as(dp52244
g18
V23354
p52245
stp52246
a((dp52247
g2
(lp52248
VI'm very confused by the double-reading, but it looks like you actually intend to do something like:
p52249
aVSee if that works as desired
p52250
aVI wonder, however, if the  isn't the cause of the drop; try it without this assigned, see if that makes it quicker
p52251
aVOr only run this periodically:
p52252
aVAlso, try increasing the buffer-size
p52253
as(dp52254
g18
V23354
p52255
stp52256
a((dp52257
g2
(lp52258
VI don't like it much, but it works (for some range of values, at least)
p52259
as(dp52260
g18
V23354
p52261
stp52262
a((dp52263
g2
(lp52264
VHave you disabled layout while adding the controls
p52265
as(dp52266
g18
V23354
p52267
stp52268
a((dp52269
g2
(lp52270
VYour best bet with  would be to just use the non-generic :
p52271
aVHowever
p52272
aVAdding something other than  will cause a runtime exception
p52273
as(dp52274
g18
V23354
p52275
stp52276
a((dp52277
g2
(lp52278
VYes, but you want , not , and:
p52279
as(dp52280
g18
V23354
p52281
stp52282
a((dp52283
g2
(lp52284
VSimply:
p52285
aVWith captured variables, it is where it is declared that is important
p52286
aVSo by declaring the captured variable inside the loop, you get a different instance of the capture-class per iteration (the loop variable, , is technically declared outside the loop)
p52287
as(dp52288
g18
V23354
p52289
stp52290
a((dp52291
g2
(lp52292
VIt really depends on who is using the enum
p52293
aVIf it is just your own code, then you can probably add more values to it without any side-effects, since you should ideally already be checking explicitly for the expected values
p52294
aVIt is generally pretty easy to track down any places that need editing
p52295
aVIt gets trickier if the enum has been released for other people to consume as part of an API; for example, if you add "MyNewValue" to an enum used in the return of a web-method, that could cause existing clients (that haven't yet been updated) to crash when you send them that value - either through the code not knowing what to do, or (more immediately) by the serialization layer panicking when it sees a string it didn't expect
p52296
aVThere is no such thing as a ; only ,  or
p52297
as(dp52298
g18
V23354
p52299
stp52300
a((dp52301
g2
(lp52302
VSounds like a good fit for an extension method:
p52303
aVThis will then work on all your existing dictionaries whenever you call , for example:
p52304
as(dp52305
g18
V23354
p52306
stp52307
a((dp52308
g2
(lp52309
VIt is very rare you need to use the enumerator directly; just use  on
p52310
aVHere's iterating it twice:
p52311
aVNo need for  - it simply uses  twice for you, which is the correct way of doing it
p52312
aVIf you can't run the query twice for whatever reason, or want random access rather than sequential, then you'll have to buffer it - perhaps into a list with
p52313
as(dp52314
g18
V23354
p52315
stp52316
a((dp52317
g2
(lp52318
V,  and  are not "global variables" - they are instance fields that are defined for that type
p52319
aVEach  instance has separate fields
p52320
aVYou could achieve what you want by using  fields, but that is asking for lots of trouble (especially if your code is threaded or running on a web-server, which is implied by ) - it would be much better to pass the configured  instance to the code that needs it
p52321
as(dp52322
g18
V23354
p52323
stp52324
a((dp52325
g2
(lp52326
VIt is hard to give a complete answer as your xml and C# don't match up; but from each "HeaderColumns" you can use:
p52327
aVIf you have multiple , then  maybe
p52328
as(dp52329
g18
V23354
p52330
stp52331
a((dp52332
g2
(lp52333
VThe attribute is named "score", and is in the namespace referenced by "ext", which is presumably an xml namespace alias
p52334
aVSo find what "ext" maps to (look for an xmlns), and add:
p52335
aVEdit; found it here; see
p52336
aVAlso note that the main objects seem to be in  which you may need to account for at the root/object level
p52337
as(dp52338
g18
V23354
p52339
stp52340
a((dp52341
g2
(lp52342
Vfor such migration activities, do we not bother running unit tests for the functions
p52343
aVI wouldn't trust freshly translated code (mechanical or otherwise) at all
p52344
aVAbsolutely it needs testing
p52345
aVthe functionality of the original VB6 application is unknown to us
p52346
aVThat will make regression testing quite
p52347
aVchallenging
p52348
aVIf you don't know how it is meant to behave, how do you know when you've finished it
p52349
aVOf course, you could decide not to unit test the translated code, then you won't know how the new code works either - not sure that "unknown = unknown" counts as a "pass", though
p52350
as(dp52351
g18
V23354
p52352
stp52353
a((dp52354
g2
(lp52355
VIt is pretty rare (for me at least) that there isn't an obvious relationship between such constants and some pre-existing class at the heart of the domain model - I'd just add them there
p52356
aVThen the constants are tightly scoped to the appropriate part of the model, rather than just being in a "Constants" class
p52357
aVOf course, I also find it pretty rare to find true "constants"; many interesting "constants" are described better through configuration options
p52358
as(dp52359
g18
V23354
p52360
stp52361
a((dp52362
g2
(lp52363
VHow exactly does the problem manifest
p52364
aVSince the C# expression compiler (used in the LINQ above) uses the memberinfo tokens directly (rather than relying on strings as reflection), I can't see that you could do any better
p52365
aVLikewise, assuming it is an IL obfuscator (not a source obfuscator), re-writing it as a query expression should achieve nothing, nix, zip, zero and nada
p52366
aVYou you can try
p52367
aVWhat exactly happens
p52368
aVEdit based on comment: if the problem is the "capture", you could try manually building the expression with a constant (instead of a captured value) - where  is your type:
p52369
aVthen use:
p52370
aVThe problem, of course, is convincing it that "FileName" and  must stay the same
p52371
aVAnd here's a version that doesn't need the string:
p52372
as(dp52373
g18
V23354
p52374
stp52375
a((dp52376
g2
(lp52377
VAs long as you only call lazy, un-buffered methods you should be fine
p52378
aVSo , , , etc are fine
p52379
aVHowever, , ,  etc would go crazy
p52380
aVIt can work, but you need to be cautious
p52381
aVOr inject a  as a safety measure (or some other custom extension method that throws an exception after too much data)
p52382
aVFor example:
p52383
as(dp52384
g18
V23354
p52385
stp52386
a((dp52387
g2
(lp52388
VIf it hasn't changed any data, then it won't itself do anything - but yes: it should have a , because there might be an outer transaction-scope around this one
p52389
aVIf yours rolls-back, you've doomed the whole outer transaction
p52390
aVBy completing your transaction you allow the outer transaction to continue unhindered
p52391
aVNote that  in this scenario is "free" anyway; in fact SQL Server always optimises towards , with rollback ( without ) being the expensive one
p52392
as(dp52393
g18
V23354
p52394
stp52395
a((dp52396
g2
(lp52397
VYou have accidentally re-declared  (method-hiding)
p52398
aVRemove this declaration and it might start working
p52399
aVWhen your derived classed , they are providing this version - they aren't overriding , which is what is required
p52400
aVIf you want an abstract , perhaps:
p52401
aVNow the derived types must provide , and they are all mapped to
p52402
as(dp52403
g18
V23354
p52404
stp52405
a((dp52406
g2
(lp52407
s(dp52408
g18
V23354
p52409
stp52410
a((dp52411
g2
(lp52412
VTo parse/validate against three expected formats, you can use something like below
p52413
aVGiven the pattern, once you know it is valid you could just use  to get the first part; if you need something more elegant you could use  for each pattern in turn and extract the desired portion (or re-format it)
p52414
as(dp52415
g18
V23354
p52416
stp52417
a((dp52418
g2
(lp52419
VI would guess that your type is explicitly setting the string to "" in the parameterless constructor
p52420
aVCould you check
p52421
aVThe way that protobuf-net handles this is:
p52422
aVfor a , nothing is sent (the protobuf wire-format has no way of explicitly expressing a , but we can treat it as optional and omit it)
p52423
aVfor a , a 0-length pattern is sent, which should be deserialized as
p52424
aVfor a non-empty string, the length and the string is sent, and is deserialized
p52425
aVDuring deserialization, in the  case it simply leaves your field/property alone, since it has no data to process
p52426
aVIf the type sets the default to  it will stay as
p52427
aVNote that in "v2" (I expect to release this in the next two weeks), you can optionally tell it to use the WCF approach of "don't run any constructor", which will have the effect of leaving it as  even if the default constructor assigns it
p52428
aVThere are also some tricks you can do (with "v1") to send a  flag (as a separate property) to mean ; let me know if you want an example of this
p52429
aVEdit: here's an example of a "v1" trick to get around this; the "v2" approach of "ignore the constructor" is probably a better option long-term, though:
p52430
as(dp52431
g18
V23354
p52432
stp52433
a((dp52434
g2
(lp52435
VReflector tells me that you might try:
p52436
aVNo guarantees, though
p52437
as(dp52438
g18
V23354
p52439
stp52440
a((dp52441
g2
(lp52442
VEven though it looks like an instance method, it operates like a static method - so  () is not  - it is passed-by-value, hence you are mutating a copy of the struct
p52443
aVSince you can't use  on the first argument of an extension method, you would have to  it instead:
p52444
aVand use:
p52445
aVSo possibly not worth it
p52446
as(dp52447
g18
V23354
p52448
stp52449
a((dp52450
g2
(lp52451
VThe closest you can get is a static field outside the method:
p52452
aVClosure example as requested:
p52453
as(dp52454
g18
V23354
p52455
stp52456
a((dp52457
g2
(lp52458
VThe version with a constant works fine with the code as posted
p52459
aVCan you illustrate an example expression where it doesn't work
p52460
aVWhen you see this, it means that your  is trying to use a parameter; there is only one parameter in a  (the first one, of type )
p52461
aVFor example, I would expect the following to break (and it does):
p52462
aVRe the complexity; there are a lot of cases that can be parsed without compile; I use a "try it and fallback to Compile" strategy
p52463
aVSee the  and  methods, here
p52464
as(dp52465
g18
V23354
p52466
stp52467
a((dp52468
g2
(lp52469
VAs a general rule, if you want to post data from an external source (other than aspx, which does some crazy stuff) you are much better with a simple "handler" (ashx) or an ASP
p52470
aVNET MVC route
p52471
aVIn the "handler" case you can access the request form/query-string etc directly
p52472
aVIn the MVC case it should mostly be done for you
p52473
aVaspx is not a friend to raw posts
p52474
aVIn the specific case,  suggests some kind of network error, but you would need a http trace to identify it for sure
p52475
as(dp52476
g18
V23354
p52477
stp52478
a((dp52479
g2
(lp52480
VIt depends on whether end-clients (browsers) are allowed to have access to the WCF data service, or just the app service
p52481
aVFor simple security modes, having json allows a lot of very simply jQuery etc scenarios
p52482
aVOf course, jQuery etc demands a compatible browser; these days that means "most", but by no means "all"
p52483
aVSo if you want to provide the same data to dumb browsers you'll need a way to get the data at the server
p52484
aVIf the intend is to provide server-to-server (B2B etc) access, json is generally a second choice; xml (SOAP etc) would be the de-facto standard, but it isn't the only option
p52485
aVFor example, if you have high bandwidth needs you might choose a more compact binary transmission format (there are many)
p52486
as(dp52487
g18
V23354
p52488
stp52489
a((dp52490
g2
(lp52491
VYou don't usually need XPath or XSD to use LINQ-to-XML, but it also won't do what you want
p52492
aVcomes close , but is a tree serializer, not a graph serializer
p52493
ag9246
aVNET 3
p52494
aV0) does offer graph support via one of the overloaded constructors, but doesn't offer full control over the xml
p52495
aVoffers graph support and metadata-/type-based workings, but is very brittle if you ever change your assembly, and is not portable between platforms
p52496
aVI suspect the thing to figure out is: is my data a tree or a graph
p52497
aVmay already do what you need
p52498
as(dp52499
g18
V23354
p52500
stp52501
a((dp52502
g2
(lp52503
VFor info, the main time you see that specific pattern is when (any one of):
p52504
aVthe non-explicit method is  or , for subclasses to
p52505
aVthe signature of the  method is not quite the same, for example the public API has a more specific return type (common for things like  or )
p52506
aVwe don't want it to be , but we want it to be easily callable within the type (without needing a nop-cast)
p52507
aVIn this case it does indeed look redundant
p52508
as(dp52509
g18
V23354
p52510
stp52511
a((dp52512
g2
(lp52513
VI tend to avoid it, but there are some times when it is very helpful:
p52514
aVfor performance working with raw buffers (graphics, etc)
p52515
aVneeded for some unmanaged APIs (also pretty rare for me)
p52516
aVfor cheating with data
p52517
aVFor example of the last, I maintain some serialization code
p52518
aVWriting a  to a stream without having to use  (which creates an array each time) is painful - but I can cheat:
p52519
aVNow I can use shift () etc to write  much more easily than writing  would be (the bytes will be identical to if I had called , plus I now control the endianness by how I choose to use shift)
p52520
as(dp52521
g18
V23354
p52522
stp52523
a((dp52524
g2
(lp52525
VI'm not sure there is much point doing that; what you have already boxes (since it returns ), you might as well let the CLR do that for you
p52526
aVSimply:
p52527
aVThere isn't much benefit adding generics here (since we don't use the )
p52528
aVYou certainly could add a generic method, but what does it add
p52529
as(dp52530
g18
V23354
p52531
stp52532
a((dp52533
g2
(lp52534
VWhat API is doing the [de]serialization
p52535
aVIf this is something inbuilt like asmx, then there probably isn't much you can do (short of implementing , which is horrible), but if you have direct control over the  /  creation (for example, from a file or network socket) you can get the reader/writer to do the validation for you, like so
p52536
as(dp52537
g18
V23354
p52538
stp52539
a((dp52540
g2
(lp52541
VNo real difference
p52542
aVIn a release / optimized build I would expect the compiler to remove the extra local, anyway
p52543
aVHaving the variable is useful if you want to put a breakpoint in and inspect the value prior to return, or if you want to apply additional conditional filtering, for example:
p52544
aVIn your example it doesn't add anything, but it also doesn't cost anything either
p52545
aVFeel free to keep it there; especially if you think it makes the code easier to read
p52546
as(dp52547
g18
V23354
p52548
stp52549
a((dp52550
g2
(lp52551
VWhile I don't love them, perhaps a  would serve
p52552
as(dp52553
g18
V23354
p52554
stp52555
a((dp52556
g2
(lp52557
VIf you mean asmx, then:
p52558
aVpretty much any of the inbuilt primitives and standard data types
p52559
ag23295
aVarrays, or lists / collections with obvious semantics
p52560
aVxml-serializable types:
p52561
aVpublic types with public parameterless constructors and public properties/fields (optionally attributed for more control)
p52562
aVpublic types that implement
p52563
aVFor WCF, add data-contracts to that list
p52564
as(dp52565
g18
V23354
p52566
stp52567
a((dp52568
g2
(lp52569
VThat will get a new  per ; you'll have new s whenever:
p52570
aVthe app-pool recycles
p52571
aVdifferent machines
p52572
aVyou reboot the server
p52573
aVyou edit a file such as web
p52574
aVconfig
p52575
aVIIS just feels like spawning another one
p52576
aVIn short, this isn't a very robust way of proving that one app is the same (although it indicate different applications clearly)
p52577
aVWhy not just something like the site path or IIS name as an identifier
p52578
as(dp52579
g18
V23354
p52580
stp52581
a((dp52582
g2
(lp52583
VTo know the "size" (in kb) of a string we need to know the encoding
p52584
aVIf we assume UTF8, then it is (not including BOM etc) like below (but swap the encoding if it isn't UTF8):
p52585
aVRe packing it; I would suggest GZIP via UTF8, optionally followed by base-64 if it has to be a string:
p52586
as(dp52587
g18
V23354
p52588
stp52589
a((dp52590
g2
(lp52591
VA , when given a  is inherently data-bound
p52592
aVYou can suspend notifications (for example, by going via a  and setting  to ), but this is just notifications - it is still looking at the same  /  etc
p52593
aVTo get truly isolated data, either:
p52594
aVdon't data-bind (set the cells manually), or
p52595
aVtake a snapshot / clone of the data
p52596
as(dp52597
g18
V23354
p52598
stp52599
a((dp52600
g2
(lp52601
VHere you go, sort a list against any property that implements  (which  does):
p52602
aVNow:
p52603
aVor
p52604
as(dp52605
g18
V23354
p52606
stp52607
a((dp52608
g2
(lp52609
VYou could avoid the issue:
p52610
aVSo they are the same, but using  avoids having to embed any assumption or nasty casts into the code
p52611
aVDisassembling the above, the only difference is signed / unsigned - both start with a 4-byte constant ( / ) then cast to native-int ( / ) (the  comments are mine) :
p52612
as(dp52613
g18
V23354
p52614
stp52615
a((dp52616
g2
(lp52617
VNo,  won't make a type pretend to implement an interface (even if it has, via , all the methods)
p52618
aVPassing it to  essentially takes away the
p52619
aVdepends on the calling code just as much as the implementing object
p52620
aVMore, even
p52621
aVYou could however make an interface wrapper that uses duck typing:
p52622
as(dp52623
g18
V23354
p52624
stp52625
a((dp52626
g2
(lp52627
VTwo thoughts occur:
p52628
aVif you are using  to have the service / interface parts of the type in separate files (since the code mentions  and doesn't seem to implement the interface itself) are the namespaces correct
p52629
aVWith  classes it is perilously easy to accidentally end up creating two types rather than one type
p52630
aVis  suffering from resolution issues (perhaps from having a referenced dll and a local copy)
p52631
ag412
ag50
aVis all the code talking about the same
p52632
as(dp52633
g18
V23354
p52634
stp52635
a((dp52636
g2
(lp52637
VHave you looked at
p52638
aVAlso, be sure to catch the return value;  (via any string mechanism) returns a new string - it doesn't do an in-place replace
p52639
as(dp52640
g18
V23354
p52641
stp52642
a((dp52643
g2
(lp52644
VWhat is
p52645
aVIs it a stream
p52646
aVa byte-array
p52647
aVWhat
p52648
aVThe reason I ask is that protobuf does not (by default) include length headers, so it reads to the end of the stream
p52649
aVIf the stream is left open (perhaps an open network socket) then it won't know to end and will hang (which is possibly what you are seeing)
p52650
aVThere are ways to get around this while leaving the stream open, of course
p52651
aVIf this isn't the issue, can you indicate (perhaps in hex) the buffer contents, and the values you are serializing
p52652
aVI'd like to figure out whether it is a serialization issue, or a parsing issue
p52653
as(dp52654
g18
V23354
p52655
stp52656
a((dp52657
g2
(lp52658
VIf that is LINQ-to-SQL or Entity Framework
p52659
aVYou'll need to break it into steps (as it can't execute that at the DB)
p52660
aVFor example:
p52661
aVthen use  to break "composition" against the back-end store:
p52662
as(dp52663
g18
V23354
p52664
stp52665
a((dp52666
g2
(lp52667
VThe approach used here, with the refinement here, should do what you need
p52668
aVBy necessity it uses reflection to do the guts in the middle, but it works
p52669
aVNote also that  and  can avoid some of the work in your approach
p52670
as(dp52671
g18
V23354
p52672
stp52673
a((dp52674
g2
(lp52675
VIf  is a static method outside of your control, then no; you can only add extension methods to instances
p52676
aVIf it is your type, you could add:
p52677
as(dp52678
g18
V23354
p52679
stp52680
a((dp52681
g2
(lp52682
VIs the  set to  for any of the parameters
p52683
aVIf so, they aren't sent
p52684
aVTry:
p52685
aV(note the null-coalescing with )
p52686
aVAlso, note that  may impact your query-plan re-use, as (for strings etc) it uses the length of the value
p52687
aVIf you need maximum performance it is better to setup the parameter manually with the defined sizes
p52688
aVAlso note that potentially some of the parameters in the incoming list could be input-output, output or result
p52689
aVI would be very tempted to substitute for something more like:
p52690
as(dp52691
g18
V23354
p52692
stp52693
a((dp52694
g2
(lp52695
Vbut i don't know how to create win services
p52696
aVIn Visual Studio Pro and above:
p52697
aVFile => New Project => Visual C# => Windows => Windows Service
p52698
aVand see the walkthrough here or howto here
p52699
aVThe most important thing is that during the service startup you only do things like spawn a worker thread
p52700
aVYou don't do the real processing in there (otherwise it will timeout when starting the service, and Windows will kill it)
p52701
aVOh, and check what working-folder the service starts with - you might find it is the system folder
p52702
as(dp52703
g18
V23354
p52704
stp52705
a((dp52706
g2
(lp52707
VTo do this you would need to create your own type, implement ,  (and ideally ), and optionally  and
p52708
aVYou'd also need either a public non-object indexer () or
p52709
aVFrom having done things similar to this, I strongly advise you; don't, unless this is really important
p52710
aVIt would be more pragmatic to copy the references into a new
p52711
aVAlso; with new items; which list would it go into
p52712
as(dp52713
g18
V23354
p52714
stp52715
a((dp52716
g2
(lp52717
VVariance only works for reference-types (or there is an identity conversion)
p52718
aVIt is not known that  is reference type, unless you add :
p52719
aVsince I could write a:
p52720
as(dp52721
g18
V23354
p52722
stp52723
a((dp52724
g2
(lp52725
VNo
p52726
aVin C# doesn't offer that
p52727
aVWith your two examples:
p52728
aVYou can write the same code that  offers, but it would be a lot harder than just using reflection
p52729
aVEither use reflection (as per your example), or if you need to optimise it you can optionally wrap it in a delegate, via either  or
p52730
as(dp52731
g18
V23354
p52732
stp52733
a((dp52734
g2
(lp52735
VRob has indicated how you might do this (although a more classic LINQ approach might take , and possbily return )
p52736
aVThe good news is that if you want to use the predicate with LINQ-to-Objects (for your xml scenario) you can then just use:
p52737
aVor (for the other signature):
p52738
aVand you have a delegate () to test your objects with
p52739
aVThe problem though, is that this is a nightmare to unit test - you can only really integration test it
p52740
aVThe problem is that you can't reliably mock (with LINQ-to-Objects) anything involving complex data-stores; for example, the following will work fine in your unit tests but won't work "for real" against a database:
p52741
aVThe problem is that only some operations can be translated to TSQL
p52742
aVYou get the same problem with  - for example, EF and LINQ-to-SQL support different operations on a query; even just  behaves differently (EF demands you explicitly order it first, LINQ-to-SQL doesn't)
p52743
aVSo in summary:
p52744
aVit can work
p52745
aVbut think carefully whether you want to do this; a more classic black box repository / service interface may be more testable
p52746
as(dp52747
g18
V23354
p52748
stp52749
a((dp52750
g2
(lp52751
VIf  does something non-trivial (anything except access a local field) then that is the most likely bet
p52752
aVAn interesting fact is that technically  requires the ordering to be transitive, and string comparison is not always transitive
p52753
aVBut this would rarely cause a stackoverflow (unless the  method uses some kind of FP approach); it might cause it to run forever, but I believe the inbuilt types even have this covered (they check for the theoretical max run-length and abort, IIRC)
p52754
aVI would be looking at ; if it does something "clever" (like lazy-load some value from a parent collection), odds are the bug is in the "clever"
p52755
as(dp52756
g18
V23354
p52757
stp52758
a((dp52759
g2
(lp52760
VThis should give you  and ; you'll need  directives for both  and :
p52761
aVor (less specific, but still works):
p52762
aVor if you want to do something more with the elements, :
p52763
aV(if you want the element, not the string, then just  or  - remove the )
p52764
as(dp52765
g18
V23354
p52766
stp52767
a((dp52768
g2
(lp52769
VI would suppose:
p52770
aVis queried, which causes the  static initializer to fire
p52771
aVThis accesses , causing the  static initializer to fire
p52772
aVis queried; the type initializer is already activated (but no assignment has yet occurred), so the field (not yet assigned) is read as
p52773
aV+  is , which is assigned to  <===========================
p52774
aVwe now exit the  cctor and go back to the  cctor
p52775
aV+  is , which is assigned to  <===========================
p52776
aVwe now exit the  cctor
p52777
aVis returned () for
p52778
aVwe query (on ) ; the cctor has already fired so we see
p52779
as(dp52780
g18
V23354
p52781
stp52782
a((dp52783
g2
(lp52784
VYou can create a reverse comparer quite easily:
p52785
aVNow pass that into the constructor for the dictionary:
p52786
as(dp52787
g18
V23354
p52788
stp52789
a((dp52790
g2
(lp52791
VAssuming that is something like winforms or WPF, that should work
p52792
aVAre you sure you aren't getting an exception or something
p52793
aVIf it is web, all bets are off ;-p You should perhaps clarify if this is ,  or , or something else
p52794
as(dp52795
g18
V23354
p52796
stp52797
a((dp52798
g2
(lp52799
VIt is a little unclear whether you want to define a type at runtime and define methods against it, or whether you want to create an instance of an already-written type, and call methods on it
p52800
aVFortunately both are possible
p52801
aVThe second scenario is more likely, so you'd want to look at reflection (below) - but note that there are performance penalties associate with this (and small things like "what arguments does the method take" become very important)
p52802
aVFor the first scenario, you'd need to look at , but that is much more complex
p52803
aVAnother option would be  and dynamic assembly loading, but again - not trivial by any stretch
p52804
aVTo include parameters (comments) you pass an  instead of the :
p52805
aVIf you are doing this lots (for the same method) there is a way to improve performance via a typed delegate, but this doesn't gain you much for occasional calls
p52806
as(dp52807
g18
V23354
p52808
stp52809
a((dp52810
g2
(lp52811
VA quick search for + +Silverlight suggests things like this or this
p52812
as(dp52813
g18
V23354
p52814
stp52815
a((dp52816
g2
(lp52817
VWith , if you expect begin/ends matches you need some wildcards such as , and I'm assuming that the user isn't adding those; but - important: don't concatenate user input
p52818
aVEver; you want something like:
p52819
aVWith  defined as a parameter, with value something like:
p52820
as(dp52821
g18
V23354
p52822
stp52823
a((dp52824
g2
(lp52825
VIt is available as C# source, so I don't think so
p52826
aVYou would have to check for s, but that is about it
p52827
as(dp52828
g18
V23354
p52829
stp52830
a((dp52831
g2
(lp52832
VI haven't looked at it /specifically/, but it is potentially something that extra tooling could help with
p52833
aVIf you are working with both java and
p52834
aVNET, then it is a bigger question than just protobuf-net; you'd need to be able to consume it as the java end as well
p52835
aVprotobuf (the wire format) is cross-platform, with protobuf-net being just one specific implementation
p52836
aVIf your preferred REST API allows efficient  handling (either as a base-64 string in a message, or as the raw response) you could just treat it as binary
p52837
aVIf you can point me at the tooling you want to use, I can take a look, but I can't guarantee anything immediate
p52838
as(dp52839
g18
V23354
p52840
stp52841
a((dp52842
g2
(lp52843
VIt sounds like we want to force it to be excluded; for a first thing to try, you could try using the "detectmissing" option in the code-generation
p52844
aVThis is possible from the IDE and command-line, but differently (let me know which you are using and I'll add more)
p52845
aVAnother similar option is to add (in a partial class) a
p52846
aVThere is an existing open report of an oddity involving default empty strings, that I am looking at
p52847
as(dp52848
g18
V23354
p52849
stp52850
a((dp52851
g2
(lp52852
V certainly is a "complex type"; C# may have a keyword for it, but it is not a CLI primitive
p52853
aVString you could argue either way - it is actually a type all to itself (indeterminate size, etc - the only things remotely comparable are arrays)
p52854
aVHowever; there is simply no way to determine what you are wanting here
p52855
aVThe best you can do is to check for known system assembles (or maybe signing keys)
p52856
aVAfter all, I can write an assembly called  or , with types in the  namespace (this also depends on how paranoid you want to be, of course)
p52857
aVIt may be easier to get devs to explicitly mark their own types that you want to treat in a speicial way - either via an attribute or an interface
p52858
as(dp52859
g18
V23354
p52860
stp52861
a((dp52862
g2
(lp52863
VThe wire format for protocol buffers wouldn't make this trivial; I'm not aware of something to do this, but one option would be to serialize it into a buffer with your own length header and pad with extra data as needed
p52864
aVYou need to add a length prefix because this is not added by default, and otherwise it would be reading garbage at the end of your buffer
p52865
aVEven trailing 0s would not be legal (it would be looking for a field number)
p52866
aVI can't comment on the C++ or Jon's C# version, but for my C# version (protobuf-net), you should be able to do something like (untested):
p52867
aVThis should deserialize fine if also using
p52868
aVRe the questions (comments);  is a protobuf-net-specific method; there may be something in the C++ version, but it is pretty simple
p52869
aVThe easiest way to implement this from scratch is:
p52870
aVassume we will leave a fixed-length (4 byte) header to indicate how much actual data we have
p52871
aVskip 4 bytes (or write 00-00-00-00)
p52872
aVnow serialize to the rest of the buffer
p52873
aVfind how many bytes you just wrote
p52874
aVwrite that value back at the start of the buffer
p52875
aVin reverse, obviously:
p52876
aVread 4 bytes and interpret as an int
p52877
aVdeserialize that much as data
p52878
aVIt is a little bit more complex in protobuf-net, as it offers a few more options (how the int should be encoded, and whether or not to wrap this so that the entire thing can still be treated as a 100% value protobuf stream - in particular I suspect I've just described the behaviour if I asked  to use fixed-width encoding and "field 0")
p52879
as(dp52880
g18
V23354
p52881
stp52882
a((dp52883
g2
(lp52884
VThis is wrong:
p52885
aVThat should be:
p52886
aVreturns the extra part of the buffer - not just the valid data
p52887
aVYou can usually omit xml headers with
p52888
aVIt is almost certainly to do the write more directly, but I'm about to run out of signal (on the train
p52889
as(dp52890
g18
V23354
p52891
stp52892
a((dp52893
g2
(lp52894
VIs this new work or existing work
p52895
aVis very touchy about things like this, but if you want binary output you might want to consider something like protobuf-net, which uses more predictable contracts-based output; meaning you can get the data back into your app no matter if you change the specific types
p52896
aVIf binary isn't important you might also consider xml; , , etc
p52897
aVIMO,  should not be used to persist data for anything other than the shortest time
p52898
aVYou stress that forward / backward compatibility is important; in that case I strongly urge you that  can bite hard with this
p52899
as(dp52900
g18
V23354
p52901
stp52902
a((dp52903
g2
(lp52904
VThe  API supports this in
p52905
aVNET 4
p52906
aV0, but sadly the C# compiler doesn't add any extra candy to support
p52907
aVBut the good news is that you can trivially take a "get" expression (which the C# compiler can write) and re-write it as a "set" expression
p52908
aVAnd even better; if you don't have
p52909
aVNET 4
p52910
aV0, there are still at least two other ways of performing a "set" via an expression written as a "get"
p52911
aVHere they all are, for info:
p52912
as(dp52913
g18
V23354
p52914
stp52915
a((dp52916
g2
(lp52917
VI didn't see this at the time (sorry, but I don't see every question, and while I watch the  tag, I don't keep quite as vigilent on
p52918
aVA very intersting question; In terms of comparison to a document database (rather than relational), I think this type of approach has great potential
p52919
aVIt seems a little overkill looking at relational if you are just dropping blobs, but it should work at least
p52920
aVI've certainly used similar setups a lot for data-loading into offline apps - not specifically mobile, but the same concepts apply
p52921
aVIn particular, this type of document-centric approach is useful when you want to rehydrate "the system"; i
p52922
ag50
aVthe state in full
p52923
aVThey aren't quite as simple/flexible to query ad-hoc than a relational database
p52924
aVOf course, one option is to rehydrate and they query in memory (for example, in C# the LINQ-to-Objects query over re-hydrated data would be almost indistinguishable from a LINQ-to-SQL query over the data in a relational database)
p52925
as(dp52926
g18
V23354
p52927
stp52928
a((dp52929
g2
(lp52930
VThere are a few subtle points here:
p52931
aVit doesn't just support  - it also supports the older (non-generic)  as a fallback
p52932
aVThis means that it can't be expressed just as (for example) a generic constraint
p52933
aVit supports  where  is comparable, even though  clearly isn't  or
p52934
aVit prevents explosion of generic type constraints by not demanding them - for examle, a  can provide a  even though it doesn't insist that all  are sortable; you'd be amazed how quickly the generic constraints would otherwise accumulate
p52935
aVit allows you to pass a comparer into any of the existing APIs that demand a comparer, when all you have is a type that may be comparable; most of the framework sorting APIs (including LINQ) will offer comparer support
p52936
as(dp52937
g18
V23354
p52938
stp52939
a((dp52940
g2
(lp52941
VFor this to work, the source must have either a  event () that is getting fired, or it must implement  (including for this property)
p52942
aVOr as an edge-case, must have a custom  implementation that supports notification (but that is very rare
p52943
aVDoes your code have a
p52944
aVDoes it get raised at the appropriate time
p52945
aV(the UI doesn't poll for changes; it only knows about changes via the notification events)
p52946
as(dp52947
g18
V23354
p52948
stp52949
a((dp52950
g2
(lp52951
VYou are calling  on the delegate, so it will be a pool thread
p52952
aVIf you called  on a control it would be the UI thread
p52953
aVIt is unfortunate that  means almost the exact opposite in these two scenarios
p52954
as(dp52955
g18
V23354
p52956
stp52957
a((dp52958
g2
(lp52959
VAs long as you are doing the calls from a background thread, that probably isn't a terrible way to do it
p52960
aVYou could also use a timer to call-back after an interval; more ecomplex (not much), but perhaps easier to cancel (of course, you can also simply handle a thread-interrupt to cancel a sleep)
p52961
as(dp52962
g18
V23354
p52963
stp52964
a((dp52965
g2
(lp52966
VReadability is the biggest concern, but often that isn't a problem at all
p52967
aVYou could also describe LINQ query syntax as (underneath it all) exactly such a setup
p52968
aVIt just makes it look prettier ;-p
p52969
aVOne possible issue is where you need to introduce things like  or ; with the fluent API you may be tempted to simply drop these components, but that might lead to oddities when an exception is thrown
p52970
aVThe other possible thought is that you might want to have more granular exception handling around some of the calls; but you can always just break the flow:
p52971
aVOr you could even do that in an extension method to keep the fluent appearance:
p52972
aVwhere  is the one you add with special handling (exceptions, locks, using, etc)
p52973
as(dp52974
g18
V23354
p52975
stp52976
a((dp52977
g2
(lp52978
VThe  is the entire match; you want the first group;
p52979
aV(from memory; may vary slightly)
p52980
as(dp52981
g18
V23354
p52982
stp52983
a((dp52984
g2
(lp52985
VOne very common error here is to declare the interface in two different assemblies, for example by including the same  file in two different dlls
p52986
aVSince types are defined by their assembly, this gives two conflicting interfaces, which happen to have the same name
p52987
aVThe same scenario is also common (with different namespaces), for example when importing web-services; the proxy/generated type is different to the originating type
p52988
as(dp52989
g18
V23354
p52990
stp52991
a((dp52992
g2
(lp52993
VNothing out of the box; there may be some 3rd-party tools that you can use to kludge some rules together, based perhaps on namespaces etc
p52994
aVSomething like a custom fx cop rule
p52995
as(dp52996
g18
V23354
p52997
stp52998
a((dp52999
g2
(lp53000
V should largely just work (in "v1" at least; I haven't written that yet for "v2")
p53001
aVI fully admit that the documentation is
p53002
aVsparse
p53003
aVThings that leap to mind:
p53004
aVGetting Started (and there are a few other pages in the wiki)
p53005
aVthere are a host of things in the trunk; the "Examples" project doubles as the unit-tests, so may help
p53006
aVmy blog
p53007
aVI have a lot happening at the moment (I've just changed jobs, etc), but my priorities are:
p53008
aVget a stable "v2" beta released, at least the core feature set
p53009
aVimprove the documentation
p53010
aVTime is my biggest enemy
p53011
aVBut if you have a specific scenario, feel free to ping me and I'll try to get back to you ASAP
p53012
aVRe "can I simply plug it in"; that depends on your code ;-p
p53013
aVIt needs some way of determining a unique number for each member that you want to serialize
p53014
aVThe simplest way to do this is via attributes; it supports any of ,  or
p53015
aVIf you already have at least one of these (LINQ-to-SQL includes , for example) then it may simply work
p53016
aVThere are options to automatically infer the numbers, but that is brittle and not recommended
p53017
aVOnly use this if you know you never need to add more members (it orders them alphabetically, so adding a new  will break everything)
p53018
aVIn "v2" (unreleased, but works), you can now handle the metadata independently of the types - i
p53019
ag50
aVyou can use protobuf-net with POCO, unattributed types
p53020
aVYou can also bypass the constructors etc (WCF-style)
p53021
aVMuch more flexible, if you want it
p53022
aVThe attribute approach is supported too, of course
p53023
as(dp53024
g18
V23354
p53025
stp53026
a((dp53027
g2
(lp53028
VWhat you are describing is
p53029
aVdoes not support serialization callback methods (at least, not in MS
p53030
aVNET; mono may be different)
p53031
aVDepending on your needs, you could try  which does support serialization callbacks (as do a number of other serializers)
p53032
aVOtherwise, your best approach may be to just have your own public method that you call manually
p53033
aVAnother option is to manually implement , but this is hard
p53034
as(dp53035
g18
V23354
p53036
stp53037
a((dp53038
g2
(lp53039
VThe only way you could do that in a graceful way is to manually implement , which is not fun
p53040
aVSimply;  doesn't support serialization callbacks
p53041
aVSometimes, though, you can switch to , which still offers xml capabilities but which does support serialization callbacks
p53042
aVUnfortunately the xml options are limited - it won't work for you xml structure, since that uses attributes ( only supports elements)
p53043
aVYou might also look at the comments on this answer, which discusses the points from this
p53044
as(dp53045
g18
V23354
p53046
stp53047
a((dp53048
g2
(lp53049
VCurrently the variable () is typed as , and  has a  method with a different signature
p53050
aVInstead, tell it which specific type of  it is - a  perhaps (your class name
p53051
aVOr use a different method name ( is going to cause confusion)
p53052
as(dp53053
g18
V23354
p53054
stp53055
a((dp53056
g2
(lp53057
VThe  class really only tells us about a single reference
p53058
aVThat doesn't by itself need synchronization, since it is atomic
p53059
aVHowever
p53060
aVIt really depends what callers are going to do with the dictionary
p53061
aVIf they only read, then it will work - but if any of them are going to add/remove/swap values then it will fall apart
p53062
aVI would be tempted to expose (rather than a dictionary) an immutable type with a similar indexer - so no caller can ruin the party by changing something
p53063
aVAfter the edit; the version with just  no longer makes it possible for callers to break it, so should be fine
p53064
as(dp53065
g18
V23354
p53066
stp53067
a((dp53068
g2
(lp53069
VWell,  isn't a variable (/field) - it is a ; it is always
p53070
aVIf it was a static property (or field), then
p53071
aVIf it was an instance property (or field) then  should work, since it is  - but I would rename it
p53072
aVI expect you mean it to be a  field; which can work, but you should at least be a little cautious that this doesn't necessarily play nicely if you start using multiple threads, etc
p53073
aVAnd public fields are generally best avoided (prefer private fields and public properties)
p53074
aVFor example:
p53075
aVwould be a public, static property easily accessible as
p53076
as(dp53077
g18
V23354
p53078
stp53079
a((dp53080
g2
(lp53081
VWhich version of
p53082
aVNET
p53083
aVIn 4
p53084
aV0 you can use
p53085
aVIn 3
p53086
aV5 I would be tempted to just use  (assuming it is an array)
p53087
aVOtherwise, either make it an array, or use
p53088
as(dp53089
g18
V23354
p53090
stp53091
a((dp53092
g2
(lp53093
VYour  is incorrect - that should define what it means for two things to be equal - and having the same hash-code does not mean equality (however; a different hash-code does mean non-equality)
p53094
aVIf "equality" means "both strings are pairwise equal", then test that
p53095
aVRe a better hash; xor is notorious for this, since it is trivial to get 0 by xor a value with itself
p53096
aVA better approach may be something like:
p53097
as(dp53098
g18
V23354
p53099
stp53100
a((dp53101
g2
(lp53102
VWell, the error seems pretty clear, and makes sense
p53103
aVSome thoughts:
p53104
aVare your users using your db, or is it installed locally
p53105
aVMaybe they're using SQL Server 2008 (or R2), and maybe something changed
p53106
aVare you sure your db setup is the same as theirs
p53107
aVmaybe you have your own copy of the tables ( instead of ), and your copy doesn't have the triggers
p53108
aVhave they got replication enabled
p53109
aV(which can work via triggers) Indexed views
p53110
aVPartitioning
p53111
aVetc
p53112
as(dp53113
g18
V23354
p53114
stp53115
a((dp53116
g2
(lp53117
VJust to add
p53118
aVserialization is a complex topic; if you are considering doing your own serialziation (and anything more than the most trivial examples), then I would strongly suggest that you look at pre-canned options - either in the framework itself, or 3rd-party libraries
p53119
aVFor framework; I would look at MSDN;  or
p53120
aVFor 3rd party libraries (not books) I would look at protobuf-net or Json
p53121
aVNET (bias: I'm the author of the first of these; but it is free etc)
p53122
aVAlso; if you search for C# and serialization you'll get a lot of hits for  - while this will work, there are a lot of issues with versioning, assembly partitioning, field refactoring, etc that don't make this an attractive version long term
p53123
as(dp53124
g18
V23354
p53125
stp53126
a((dp53127
g2
(lp53128
VIt all your repositories will be derived from , then have:
p53129
aVNow any reference to a  will know about the  members, without having to mention concrete types like the  class or  class
p53130
as(dp53131
g18
V23354
p53132
stp53133
a((dp53134
g2
(lp53135
VThis is a collection initializer, a C# 3
p53136
aV0 language feature
p53137
aVIt requires:
p53138
aVthe type must implement  (although this is never used for initialization)
p53139
aVthe type must have at least one  method
p53140
aVIt simply calls the  method for each term
p53141
aVYou can also use tuples if the  accepts multiple values, for example dictionaries
p53142
aVEach term is then :
p53143
aVFor an example of using this for a bespoke type:
p53144
as(dp53145
g18
V23354
p53146
stp53147
a((dp53148
g2
(lp53149
VIt is primarily for use at compile-time, but as a side note: some of the runtime handles ; for example, this will only write  -  is not written:
p53150
aV( is a runtime too - not part of the compiler)
p53151
aVSo: it depends what you are doing
p53152
aVIt might cause problems, even to existing code that is not rebuilt
p53153
aVSo we must conclude NO,  is not checked only at compile time
p53154
as(dp53155
g18
V23354
p53156
stp53157
a((dp53158
g2
(lp53159
VIf I had to guess - culture
p53160
aVWhat culture is IIS using, and what culture is your desktop app using
p53161
aVcommas vs periods etc
p53162
as(dp53163
g18
V23354
p53164
stp53165
a((dp53166
g2
(lp53167
VIn the original code,  etc are  - most code ( being the most likely) can handle this
p53168
aVIn the revised code, it is a regex , which is a complex object representing the full state of a match, not just the matched string
p53169
aVI expect you simply need to use  (the  of the matched text) in place of just  when adding it as a (sql) parameter:
p53170
aV(etc)
p53171
as(dp53172
g18
V23354
p53173
stp53174
a((dp53175
g2
(lp53176
Vcreates a new  instance against the supplied connection string
p53177
aVassigns it to the new local variable  (scoped to the  statement) that holds the constructed connection object
p53178
aVIs a  statement - it ensures that the connection is -d at the end, even if an exception is thrown (in this case  means closing it / releasing to the pool etc)
p53179
aVThe whole code is essentially:
p53180
as(dp53181
g18
V23354
p53182
stp53183
a((dp53184
g2
(lp53185
VIn that scenario, I would use  to insert into a staging table (i
p53186
ag50
aVone that looks like the data I want to import, but isn't part of the main transactional tables), and then at the DB to a / to move the data into the first real table
p53187
aVNow I have two choices depending on the server version; I could do a second / to the second real table, or I could use the / clause to do the second insert , using the identity rows from the table
p53188
aVFor example:
p53189
as(dp53190
g18
V23354
p53191
stp53192
a((dp53193
g2
(lp53194
VFrom MSDN:
p53195
aVThe exception that is thrown when there is an attempt to divide an integral or decimal value by zero
p53196
aVYou are dealing with  not any of the integral types ( etc) or
p53197
aVdoesn't throw an exception here, even in a  context
p53198
aVYou just get +INF
p53199
aVIf you want to evaluate as integral math (and get the exception), use:
p53200
as(dp53201
g18
V23354
p53202
stp53203
a((dp53204
g2
(lp53205
VDictionary is a pain, since it doesn't implement  (something I was moaning about just the other evening)
p53206
aVIt really comes down to what you have available
p53207
aVResolving the  method for / is easy enough, but if you are dealing with typical list reflection you'll need the  method from
p53208
aVFor standard usage:
p53209
as(dp53210
g18
V23354
p53211
stp53212
a((dp53213
g2
(lp53214
VSince they are compiler-generated, the sealed / public field issues are a bit moot - you shouldn't ever see it except via debug tools - how would you be subclassing it or mutating it, except by stepping around the compiler
p53215
aVIf you have that level of debug access you can mutate it anyway (via reflection)
p53216
aVFor C# it needs top be a field to allow certain  /  usage, and to allow correct usage with captured mutable structs (yes, evil, we know)
p53217
aVI assume F# is similar here (can you mutate a sub-[sub-[sub-]]member of the captured value
p53218
aVThe members could probably be internal, though
p53219
aVRe ; why would something that underpins a closure be serializable
p53220
aVDelegates make extremely poor serialization candidates
p53221
aVMaybe the nature of F# means that it is better suited to persisting an operation (mid-flow) to disk - but in general, I wouldn't recommend it
p53222
aVI would have no expectation of these objects (iterators and capture-classes) being serialzable
p53223
as(dp53224
g18
V23354
p53225
stp53226
a((dp53227
g2
(lp53228
VIf this is text data, then load it as text data (using the correct encoding), replace it as as a string, and re-encode it (using the correct encoding)
p53229
aVFor some encodings you might be able to do a swap at the file level (without decoding/encoding), but I wouldn't bet on it
p53230
aVIf this is any other binary representation, you will have to know the exact details
p53231
aVFor example, it is common (but not for certain) for strings embedded in part of a binary file to have a length prefix
p53232
aVIf you change the data without changing the length prefix, you've just corrupted the file
p53233
aVAnd to change the length prefix you need to know the format (it might be big-endian/little-endian, any fixed number of bytes, or the prefix itself could be variable length)
p53234
aVOr it might be delimited
p53235
aVOr there might be relative offsets scattered through the file that all need fixing
p53236
aVJust as likely; you could by chance have the same byte sequence in the binary that doesn't represent a newline; you could be completely trashing the data
p53237
as(dp53238
g18
V23354
p53239
stp53240
a((dp53241
g2
(lp53242
VYou should be able to use the "principal"; the ASP
p53243
aVNET login sets this up IIRC, and you can do it yourself for winforms, WCF, WPF, etc
p53244
aVYou can then use, for example:
p53245
aVYou can also get the system to execute the checks for you:
p53246
aVFrom 3
p53247
aV5 (SP1
p53248
aVonwards, you can use the ASP
p53249
aVNET login mechanism to perform your winform/wpf logins, including setting up a principal; in project properties enable "Enable client application services" (or see the "Learn more" link on that tab)
p53250
aVAlternatively, writing your own identity/principal is pretty simple - look at  and  ; you don't have to do a lot
p53251
as(dp53252
g18
V23354
p53253
stp53254
a((dp53255
g2
(lp53256
VIf the types in question don't have public parameterless constructors, you'll struggle
p53257
aVYou can get around the attributes issue by using the constructor overload that accepts  a  object, which you can use to fully configure the serializer including the default value (via ), but some things you can't do - and get around the constructor limitation is one of them
p53258
aVWhat is the scenario here
p53259
aVif you want xml, then I would introduce a DTO layer: some objects that look like the ones you're talking about, but are simple and under your control
p53260
aVIdeal for
p53261
aVYou then write code to map between the two
p53262
aVif you just want serialization (and xml is an implementation detail) then there are other serializers that may help
p53263
aVor protobuf-net, for example; either would be more versatile here
p53264
as(dp53265
g18
V23354
p53266
stp53267
a((dp53268
g2
(lp53269
VHow about:
p53270
aVActually, this isn't very specific about the delimiters - it'll pretty much assume that anything that isn't an integer is a delimiter, and it only supports ASCII (you use use a reader if you need other encodings)
p53271
as(dp53272
g18
V23354
p53273
stp53274
a((dp53275
g2
(lp53276
VGenerics and reflection make very poor friends
p53277
aVHowever, you can do this via MakeGenericMethod
p53278
aVHowever, that is going to be hard and ugly
p53279
aVSince  is based around  instance - I would reverse things: have the realy code  based, and call into that from the shallow generic version; example in C#:
p53280
as(dp53281
g18
V23354
p53282
stp53283
a((dp53284
g2
(lp53285
VNo, not every lambda-generated delegate is a static method
p53286
aVIf there are captured variables it can be an instance
p53287
aVBut ultimately there is very little difference between a lambda- based delegate, an anonymous-method- based delegate, and an explicit delegate
p53288
aVI wouldn't do any additional logic - just treat it as a delegate (I would remove the  code completely)
p53289
as(dp53290
g18
V23354
p53291
stp53292
a((dp53293
g2
(lp53294
VOn the light frameworks you have limited options; I wouldn't shy away from a little hard-coding, especially if you only need to support the core types
p53295
aVIt will also be simpler and faster than the full  option
p53296
aVSomething like:
p53297
as(dp53298
g18
V23354
p53299
stp53300
a((dp53301
g2
(lp53302
VI replied to your e-mail; I didn't realise you'd also posted it here
p53303
aVThe first question I have is: which version of protobuf-net
p53304
aVThe reason I ask is that the development trunk of "v2" deliberately has auto-compilation disabled, so that I can use my unit tests to test both the runtime and pre-compiled versions
p53305
aVSo if you are using "v2" (only available in source), you need to tell it to compile the model - otherwise it is running 100% reflection
p53306
aVIn either "v1" or "v2" you can do this with:
p53307
aVHaving done this, the numbers I get (from the code in your e-mail; I haven't checked if the above is the same sample):
p53308
aVThe other factor is the repeats; 3-10ms is frankly nothing; you can't compare numbers around this level
p53309
aVUpping it to repeat 5000 times (re-using the  /  instances; no false costs introduced) I get:
p53310
aVTaking this to sillier extremes (100000):
p53311
aVSo ultimately:
p53312
aVwhen you have virtually no data to serialize, most approaches will be very fast (including protobuf-net)
p53313
aVas you add data, the differences become more obvious; protobuf generally excels here, either for individual large graphs, or lots of small graphs
p53314
aVNote also that in "v2" the compiled model can be fully static-compiled (to a dll that you can deploy), removing even the (already small) spin-up costs
p53315
as(dp53316
g18
V23354
p53317
stp53318
a((dp53319
g2
(lp53320
VThere are a few (fairly pointless) ways involving lists and methods like  - or possibly , but you aren't solving a problem here
p53321
aVJust use the loop
p53322
aVIt expresses perfectly what you are doing
p53323
aVOne hacky way (I don't recommmend this here):
p53324
aVnot an improvement IMO
p53325
as(dp53326
g18
V23354
p53327
stp53328
a((dp53329
g2
(lp53330
VThoughts:
p53331
aVPushLINQ (me and Jon) - reverses  LINQ to a push model (rather than the  pull model)
p53332
aVReactive Framework / Reactive Extensions - another very different eventing model incorporating LINQ syntax
p53333
aVI wrote a threading API (ab)using the LINQ query syntax; I wasn't 100% convinced by it, so ditched it - but it was interesting; used  () etc to pick out branch/merge points completely unrelated to enumerables
p53334
as(dp53335
g18
V23354
p53336
stp53337
a((dp53338
g2
(lp53339
VFormatting is achieved (in winforms) via two primary approaches:
p53340
aVfor coarse-grained formatting, override
p53341
aVfor fine-grained formatting, define a  subclass, and use  on your custom type (or properties of a class, etc), to apply your formatting (when the target type is )
p53342
aVFor example:
p53343
as(dp53344
g18
V23354
p53345
stp53346
a((dp53347
g2
(lp53348
VThis is only a requirement for  (and the SOAP equivalent, but nobody uses that)
p53349
aVDiego is right; there are good reasons for this in terms of what it does, but it is far from the only option - indeed, personally I only recommend  for talking between  - it is not (IMO) a good way to persist data (to disk, in cache, to a database BLOB, etc)
p53350
aVIf this behaviour causes you trouble, consider using any of the alternatives:
p53351
aV, which works on public members (not just the fields), but demands a public parameterless constructor and public type
p53352
aV, which can work fully opt-in (using /), but which can also (in 3
p53353
aV5 and above) work against the fields instead
p53354
aVAlso - for a 3rd-party option (me being the 3rd party); protobuf-net may have options here; "v2" (not fully released yet, but available as source) allows the model (which members to serialize, etc) to be described independently of the type, so that it can be applied to types that you don't control
p53355
aVAnd unlike BinaryFormatter the output is version-tolerant, known public format, etc
p53356
as(dp53357
g18
V23354
p53358
stp53359
a((dp53360
g2
(lp53361
VSomething like:
p53362
aVwhich writes the spaces between asterisks (plus a spare one; you could remove that if it is important)
p53363
as(dp53364
g18
V23354
p53365
stp53366
a((dp53367
g2
(lp53368
V(you can also use , but this approach works on more framework versions, and gets the array size correct from the start, rather than resizing it)
p53369
as(dp53370
g18
V23354
p53371
stp53372
a((dp53373
g2
(lp53374
Vif b == -0
p53375
aV001219512195122, then a/b==41, and a+b==-0
p53376
aV051219512195122 - so something around those areas (rounding etc) sounds feasible
p53377
aVAlso; note that for some arithmetic, it is possible it is using values that are still in registers
p53378
aVRegisters may exhibit slightly different accuracy (and so give different results) than local variables
p53379
as(dp53380
g18
V23354
p53381
stp53382
a((dp53383
g2
(lp53384
VIt sounds like what you want is the "compiler as a service"
p53385
aVThat is not in MS
p53386
aVNET 4
p53387
aV0, but may be in a later release
p53388
aVIt is already in Mono, though
p53389
aVUntil then, the options available are:
p53390
aVuse , but you'll have to load it in as a method (and create a delegate to it) via reflection
p53391
aVuse
p53392
aVuse
p53393
aVuse
p53394
aVIn 4
p53395
aV0, the  API is far richer than it was in 3
p53396
aV5, allowing most common constructs without the pain of
p53397
aVBut don't discount  - it takes a little while to get your head around  and using the stack, but it isn't as bad as people tend to think
p53398
aVAs a side-note, don't use  from  unless you only want to execute it once
p53399
aVThe better approach is to use , then store (and re-use) that delegate:
p53400
aVOr with the  API:
p53401
as(dp53402
g18
V23354
p53403
stp53404
a((dp53405
g2
(lp53406
V created the stream -  has the responsibility unless some other code explicitly states it'll take that on
p53407
aVOne option here would be for the base-constructor to allow this via a protected overload, but the ordering means that it would be hard to know exactly when it is safe to dispose it
p53408
aVA  method would allow you to do this, but you shouldn't really call  methods in constructors
p53409
aVI wonder if refactoring so that there is an initialize () method (that you call separately to construction) would be better
p53410
aVPerhaps a  method, and expose it via a  method
p53411
as(dp53412
g18
V23354
p53413
stp53414
a((dp53415
g2
(lp53416
VWhile http does have some overhead, if this is becoming a significant part of your data usage, then I would suspect that your API is too "chatty", and maybe fewer messages (each carrying more payload) should be considered
p53417
aVThe next point would be; how can we reduce the bandwidth for a given amount of payload
p53418
aVCompression is an option, but can be a problem on some platforms
p53419
aVAnother is to use a serialization format that is inherently dense and efficient to process (in terms of CPU cycles, since you are using low-power devices)
p53420
aVFor that purpose, something like "protocol buffers" would be ideal
p53421
aVprotobuf-net is a CF-compatible implementation of protocol buffers for
p53422
aVNET; the CF build doesn't have all the nice WCF features (because CF doesn't support them), but it can work very effectively
p53423
aVAdditionally, if you do go http, then MTOM should be considered, as this reduces the encoding overhead of binary data (i
p53424
ag50
aVwhat protobuf-net would use)
p53425
aVMoving to UDP can be an option, but I would try something like http + protobuf-net + MTOM first (combined with a less "chatty" API), and see how it stacks up
p53426
aVI should also note that the current (downloadable) version of protobuf-net has some "kinks" with CF; it works, but it isn't as fast etc as it could be (due to limitations in meta-programming on CF)
p53427
aVThe "v2" product (not yet released) addresses all these points, allowing fully static (and fast) execution on CF
p53428
aVAnd best of all, it is free
p53429
as(dp53430
g18
V23354
p53431
stp53432
a((dp53433
g2
(lp53434
VIt is hard to know without them stating it, but one of the most common measures is cyclomatic complexity - a measure of the number of routes through code
p53435
aVA simple top-to-bottom procedural method has complexity 1, with all loops / branches / catches etc adding to this
p53436
aVThe idea is that if this grows too high, your method is doing too much and should be refactored into a few smaller, more targetted methods
p53437
aVEdit; from here:
p53438
aVA parser for C# has been added
p53439
aVMost of the metrics are similar to C++ and Java
p53440
aVThe primary difference is how the "biggest" method is determined
p53441
aVInstead of identifying the method with the most statements, for C# the most complex method is found for each file
p53442
aVThe complexity measurement is similar to Cyclomatic Complexity - a count of the possible pathways through the code
p53443
aV(emphasis mine) so it sounds like they have a slightly modified variant of regular CC
p53444
aVOnly they can tell you what they did different ;p
p53445
as(dp53446
g18
V23354
p53447
stp53448
a((dp53449
g2
(lp53450
VJava has signed bytes, so that part is correct in some ways (although unsigned bytes are more natural) - but it is vexing that it is returning a single array rather than a jagged array
p53451
aVI expect you're going to have to compare some data to see what you have received vs what you expected
p53452
aVBut changing between signed and unsigned can be as simple as:
p53453
aVor (faster) simply:
p53454
as(dp53455
g18
V23354
p53456
stp53457
a((dp53458
g2
(lp53459
Vprotobuf-net is a value serializer; it doesn't know anything about methods, except for properties
p53460
aVIf you use the same (or compatible) type, then the method will be present automatically, but this is nothing to do with protobuf-net (or any other serialization)
p53461
aVRe the topic of adding attributes; with the current release it generally needs something to know which properties to serialize (and more importantly: with what identifiers)
p53462
aVThere is an implicit mode, but I don't recommend it unless you know you aren't going to be ever changing the type again
p53463
aVEver
p53464
aVAt all
p53465
aVIn "v2", you can remove the attributes; you have the option of using an external model for this, so you might have:
p53466
aV(don't quote me on the exact API, but something like that)
p53467
aVYou can then use  etc
p53468
as(dp53469
g18
V23354
p53470
stp53471
a((dp53472
g2
(lp53473
VSince  is not , it isn't an issue of disposing it; and normally there would be little benefit in tidying up the references etc, since it is still subject to the same GC
p53474
aVIf sounds like you have accidentally kept a reference to the
p53475
aVBut if you are sure that you are done, you could try explicitly setting each  to , and calling  on the parameters list
p53476
aVBut that is really just masking the fact that you are clinging onto a dead command
p53477
as(dp53478
g18
V23354
p53479
stp53480
a((dp53481
g2
(lp53482
VThe  suggests that at least one of the columns of  is not actually a string (/), and you haven't given it any hints
p53483
aVThe simplest trick here is to simply hake that property an  (since that is what it clearly wants)
p53484
aVI'm also wondering if there is more to  that you haven't shown; interfaces, base-classes, a separate partial class etc (as those columns look like they should be strings)
p53485
aVThe main time this problem bites me is when I have (for example) a  in the DB, and forget to type an enum accordingly ( in that case)
p53486
as(dp53487
g18
V23354
p53488
stp53489
a((dp53490
g2
(lp53491
VLINQ-to-SQL allows you to capture the TSQL easily - just set
p53492
aVThe problem then is parsing that
p53493
aVI would be tempted to capture the TSQL, and play it back in SSMS with  - this gives easily parsed per-table results
p53494
as(dp53495
g18
V23354
p53496
stp53497
a((dp53498
g2
(lp53499
VThat appears to expect
p53500
aVTry instead:
p53501
aV(no array/array-item)
p53502
as(dp53503
g18
V23354
p53504
stp53505
a((dp53506
g2
(lp53507
VThere isn't really a better way
p53508
aVYou could do something like:
p53509
aVthen at least you only need:
p53510
aVThis approach should at least avoid any reallocations, and can use the JIT array/length optimisation
p53511
aVThe  is to avoid use with value-types, as with value-types already initialize in this way; just  would be better
p53512
as(dp53513
g18
V23354
p53514
stp53515
a((dp53516
g2
(lp53517
VThat is html-encoded; try HtmlDecode
p53518
aV(you'll need a reference to System
p53519
aVWeb
p53520
aVdll)
p53521
as(dp53522
g18
V23354
p53523
stp53524
a((dp53525
g2
(lp53526
VA transaction ensures a block of work operates in an ACID way - all or nothing
p53527
aVThe optional name is useful for DBAs when tracking long-running transactions
p53528
aVIn TSQL directly the names are more important, for save-points etc - but in the OO world you have an object for that
p53529
aVThe isolation level determines how ACID it is
p53530
aVSerializable is the most pure, but has more overhead costs in terms of additional locks (key-range locks, etc)
p53531
aVTypical usage would be:
p53532
aVIn many ways, it is simpler to use  - this creates an ambient transaction, into which commands enlist automatically
p53533
aVIt can also span multiple dbs etc courtesy of DTC:
p53534
as(dp53535
g18
V23354
p53536
stp53537
a((dp53538
g2
(lp53539
VWell, you shouldn't be using  for the objects anyway - they should be references, i
p53540
ag50
aVThat done, you can then use overloads, but this would be ungainly
p53541
aVA better approach would be to return something with the 3 objects - a custom type, or in
p53542
aVNET 4
p53543
aV0 maybe a tuple
p53544
aVSomething like:
p53545
aVRe-reading it, it looks like the caller is also passing data in (even if only null / not-null), so  was never the right option
p53546
aVMaybe a flags enum
p53547
aVand call:
p53548
as(dp53549
g18
V23354
p53550
stp53551
a((dp53552
g2
(lp53553
VIt sounds like you just want:
p53554
as(dp53555
g18
V23354
p53556
stp53557
a((dp53558
g2
(lp53559
VA web-service tier is pretty common for smart-clients as a layer between the user-client and the server
p53560
aVThis allows:
p53561
aVsimple networking (http only)
p53562
aVyou have an app-layer in which to put validation etc without upsetting the db
p53563
aVyou can have security that isn't tied to the db
p53564
aVthe db can run as fewer accounts (app accounts), allowing greater connection pooling
p53565
aVyou can "scale out" the app layer
p53566
aVyou can cache etc above the db
p53567
aVyou can have a richer app layer, with more services than sql server provides
p53568
aVthe client has a known API, and never knows about the db (which is an implementation detail)
p53569
aVYou can use WCF to talk to the app layer, but you shouldn't think in terms of "INSERT", "UPDATE" etc - you should think in terms of operations that make sense to your domain model - the "CreateOrder" operation, etc
p53570
aVADO
p53571
aVNET Data Services allows an API more similar to your "INSERT" etc, but it isn't necessarily as controlled as you might like for a secure service
p53572
aVPerformance is really a factor of "what queries am I running
p53573
aVand "how much data am I transferring
p53574
aVAs long as you keep the operations sane (i
p53575
ag50
aVdon't fetch the entire "Orders" data over the wire just to find the most recent order-date), then you should be OK
p53576
as(dp53577
g18
V23354
p53578
stp53579
a((dp53580
g2
(lp53581
VBy doing what it says
p53582
aVIt sounds like you're in some kind of callback, but (due to thread affinity) you can only talk to controls on their associated thread
p53583
aVSo:
p53584
as(dp53585
g18
V23354
p53586
stp53587
a((dp53588
g2
(lp53589
VJon's point is true, but as a side note there is one slight exception to the rule; generics
p53590
aVIf you have , then this is constrained, and uses a special opcode
p53591
aVThis means the interface can be used without boxing
p53592
aVFor example:
p53593
aVThis does not involve boxing, even for value-type
p53594
aVHowever, if (in the same ) you do:
p53595
aVthen that boxes as before
p53596
aVThe constrained only applies directly to
p53597
as(dp53598
g18
V23354
p53599
stp53600
a((dp53601
g2
(lp53602
VFor 1; I would exclude *
p53603
aVuser and *
p53604
aVsuo files as they are user-specific, and the bin/obj folders as they are build output
p53605
aVInclude most everything else;
p53606
aVcs,
p53607
aVcsproj,
p53608
aVresx, etc
p53609
aVFor 2, from here:
p53610
aVYou may use the software for
p53611
aVnon-commercial purposes including
p53612
aVinstructional use, research and/or
p53613
aVdesign, and development and testing of
p53614
aVprojects for class assignments, tests,
p53615
aVor personal projects
p53616
aVYou may not use
p53617
aVMSDNAA software for any for-profit
p53618
aVsoftware development
p53619
aVI'm not a lawyer, but as long as you aren't selling it you should be fine under the "personal projects" caveat
p53620
as(dp53621
g18
V23354
p53622
stp53623
a((dp53624
g2
(lp53625
VNot very easily, no
p53626
aVReflection doesn't work, since it assumes a regular type model, which is not the full range of
p53627
aVIf you are actually just talking to regular objects, then just use reflection here
p53628
aVOtherwise, I expect you may want to reverse-engineer the code that the compiler emits for a basic assignment, and tweak it to have a flexibly member-name
p53629
aVI'll be honest, though: this isn't an attractive option; a simple:
p53630
aVtranslates to:
p53631
aVIf you want an approach that works for both dynamic and non-dynamic objects: FastMember is handy for this, and works at either the type or object level:
p53632
aVavailable on Nuget, and heavily optimised for both dynamic and non-dynamic scenarios
p53633
as(dp53634
g18
V23354
p53635
stp53636
a((dp53637
g2
(lp53638
VI'm a bit confused; there is no such rule for fields
p53639
aVIn particular, fields are explicitly initialized anyway - either by your code, or to the type's default
p53640
aVThe only corner-case is explit struct field initialization, in which all fields must be assigned before the struct is considered complete
p53641
aVI wonder if you are talking about "definite assignment" of variables within methods; i
p53642
ag50
aVThis is so that for method variables the values never suffer from random values picked up from the stack
p53643
aVActually, there is an IL marked that means that locals are wiped - and IIRC the C# compiler includes this marker anyway
p53644
aVbut the language spec says method variables must be definitely assigned
p53645
aVIn the case of you example, that field-initialization essentially becomes part of the common constructor code
p53646
aVBut you'd never notice it
p53647
as(dp53648
g18
V23354
p53649
stp53650
a((dp53651
g2
(lp53652
VBefore C# 4
p53653
aV0 and  (and the improved COM interop and optional parameter handling), VB had a much easier time with COM code, especially things like the Office APIs
p53654
aVWith that fixed in 4
p53655
aV0, there is very little to pick between them
p53656
aVXml literals
p53657
aVmeh - I don't write that much xml that I care (and I've done plenty of xml)
p53658
aVDisclosure: I "cut my teeth" back in VB6, moving to C# in
p53659
aVNET 1
p53660
aV1 - haven't looked back
p53661
aVThese days, my VB is mainly read-only, but I don't have a problem with VB - simply I prefer C#
p53662
as(dp53663
g18
V23354
p53664
stp53665
a((dp53666
g2
(lp53667
VI can't change the runtime, but can't you just work around it
p53668
ag412
ag50
aVand
p53669
as(dp53670
g18
V23354
p53671
stp53672
a((dp53673
g2
(lp53674
VYou might not - but will any of your code, for example, use LINQ
p53675
aVThere are a number of unexpected places that might use a hashmap or dictionary on your data
p53676
aVIf you don't want unexpected
p53677
aV"fun", then if you change , override
p53678
aVLikewise, any  should match the  implementation
p53679
as(dp53680
g18
V23354
p53681
stp53682
a((dp53683
g2
(lp53684
VThere are two scenarios that leap to mind when talking about garbage at the end of a stream:
p53685
aVnot truncating when over-writing: if you overwrite a file but write less data, then you must truncate it
p53686
aVThere is an overload to do this when opening the file, or you can use
p53687
aVwriting buffer padding; in particular, the most common mistake is when using  - you must either use  (to get the correct number of bytes), or use  but only copy  bytes out of the buffer (anything past that is garbage)
p53688
aVI'm guessing "1" applies here
p53689
as(dp53690
g18
V23354
p53691
stp53692
a((dp53693
g2
(lp53694
VWhen writing a lambda, the act of capturing variables significantly alters the construction of the underlying code (moving variables into fields of compiler-generated classes, that could very easily themselves be chained closure-contexts)
p53695
aVNot even considering the general complexity of doing this, it would then have two choices:
p53696
aVcapture all the variable values as constants; feasible and pretty simple, but could easily mean that the result of executing in the immediate window is very different to the result of executing in the main body (very undesirable)
p53697
aVrewrite the entire code (for the reasons outlined above) on the fly (at a guess, impossible)
p53698
aVGiven a choice between "undesirable" and "impossible", I guess they simply chose not to implement a feature that would be inherently brittle, and very complex to write
p53699
as(dp53700
g18
V23354
p53701
stp53702
a((dp53703
g2
(lp53704
VHow about
p53705
as(dp53706
g18
V23354
p53707
stp53708
a((dp53709
g2
(lp53710
VVariables declared inside methods (with the possible exception of "captured" variables) are isolated, so you won't get any inherent problems; however, if your static method accesses any shared state, all bets are off
p53711
aVExamples of shared-state would be:
p53712
aVstatic fields
p53713
aVobjects accessed from a common cache (non-serialized)
p53714
aVdata obtained via the input parameters (and state on those objects), if it is possible that multiple threads are touching the same object(s)
p53715
aVIf you have shared state, you must either:
p53716
aVtake care not to mutate the state once it can be shared (better: use immutable objects to represent state, and take a snapshot of the state into a local variable - i
p53717
ag50
aVrather than reference  repeatedly, you read  once into a local variable, and then just use the variable - note that this only helps for immutable state
p53718
aVsynchronize access to the data (all threads must synchronize) - either mutually exclusive or (more granular) reader/writer
p53719
as(dp53720
g18
V23354
p53721
stp53722
a((dp53723
g2
(lp53724
VWith  (and protobuf-net, for a binary equivalent, since protobuf-net adopts most of 's patterns) you could do this by having a method:
p53725
aVfor each property  - but you'd need to maintain the "what is dirty" manually in your own code (perhaps in the )
p53726
aVLots of work; I've done a diffing serializer in the past - it was a real PITA, to be honest
p53727
aVI should also note that the  pattern does the same thing, but for what you want,  is more appropriate
p53728
as(dp53729
g18
V23354
p53730
stp53731
a((dp53732
g2
(lp53733
VYou say "type is number in database" - it sounds as though this might be , in which case the most appropriate match in
p53734
aVNET-land is
p53735
aVIf you know it is an int, you can simply cast it from  to  afterwards:
p53736
as(dp53737
g18
V23354
p53738
stp53739
a((dp53740
g2
(lp53741
VA  does indeed exit the loop (except for some edge-cases involving anon-methods
p53742
aVBut I'm more worried about the :
p53743
aVdid you mean to do something more like:
p53744
aVNote; if so you could tidy this to:
p53745
as(dp53746
g18
V23354
p53747
stp53748
a((dp53749
g2
(lp53750
VThere are three parts here; the server (sounds like C#), the client (sounds like C++) and the transport
p53751
aVTaking them separately, and starting with the most important:
p53752
aVthe transport: big decision here is what shape you want the data to be in
p53753
aVYou mention protocol buffers, so we're talking binary - but that could be:
p53754
aVa raw octet-stream (think: downloading an image from a web-server)
p53755
aVa SOAP web-service returning a stream or byte[]
p53756
aVthe same SOAP web-service returning MTOM
p53757
aVAny should work; which to choose depends on the tools available
p53758
aVThe important thing is : get a chunk of binary over the wire
p53759
aVYou also need to think about the data definition at this point; a
p53760
aVproto file can define your schema, and most protocol buffers implementations include a tool to generate matching classes
p53761
aVthe server: depending on the choice above, this is either going to be a handler () or a web-service class
p53762
aVEither way, their job is really to run some logic and return a byte stream
p53763
aVHow you get your data is up to you, then ultimately the job is to
p53764
aVpopulate the DTO types (generated from
p53765
aVproto in many cases, but not strictly necessary) and run it through the serialization API, writing the result to the stream
p53766
aVthe client: same in reverse; generate your DTOs from the
p53767
aVproto, and run it through the deserialization API
p53768
aVThe various protobuf implementations (C++, C#, etc) are listed here
p53769
as(dp53770
g18
V23354
p53771
stp53772
a((dp53773
g2
(lp53774
VThe real difference is that in the  case, you are talking about the definite assignment of a field ()
p53775
aVFields are always definitely assigned (even without the )
p53776
aVIn the  case, you are talking about the definite assignment of the local variable (); local variables do not start as definitely assigned
p53777
aVThat's all it is
p53778
aVint i=100;
p53779
aVif (i is long) //returns true, indicating that conversion  is possible
p53780
aV1: I don't think this returns  at all; for me it shows an IDE warning about never being true
p53781
aVLooking in reflector, the compiler completely removes this branch
p53782
aVI guess the compiler is obliged to at least compile on the grounds that it could (in theory) box and test
p53783
aVBut it already knows the answer, so it snips it
p53784
aV2: I still get the "unassigned variable" compiler error; due to "definite assignment"
p53785
as(dp53786
g18
V23354
p53787
stp53788
a((dp53789
g2
(lp53790
VParameters in C# are, by default passed by value
p53791
aVThere is no modifier to make this explicit, but if you add  /  the parameter is by-reference
p53792
aVThe usual confusion here is the difference between:
p53793
aVpassing a value-type by value (changes to the value-type are not visible to the caller, but value-types should ideally be immutable anyway)
p53794
aVpassing a value-type by reference (changes to the value-type are visible to the caller, but value-types should ideally be immutable anyway - so important I'll say it twice ;p)
p53795
aVpassing a reference by value (changes to fields/properties of the ref-type are visible to the caller, but reassigning the ref-type to a new/different object is not visible)
p53796
aVpassing a reference by reference (changes to fields/properties, and reassigning the reference are visible to the caller)
p53797
as(dp53798
g18
V23354
p53799
stp53800
a((dp53801
g2
(lp53802
VIf you are compressing data, then you might look at high-density serialization, rather than compression
p53803
aVSomething like protobuf
p53804
aVThere are a few C# implementations here
p53805
aVFor existing objects, protobuf-net is IMO the simplest to implement (disclosure: I'm the author - but it is free etc)
p53806
aVYou just serialize to the stream, or if you want a , a separate
p53807
aVFor continuous use over a socket (rather than the discreet request/response of HTTP), I would suggest looking at the  /  operations (protobuf doesn't itself include a terminator, so a length-prefix is necessary to handle separate messages)
p53808
as(dp53809
g18
V23354
p53810
stp53811
a((dp53812
g2
(lp53813
VThis functionality is actually built in, albeit not obviously
p53814
aVIn this scenario, it is anticipated that you would designate a unique number per message type
p53815
aVThe overload you are using passes them all in as "field 1", but there is an overload that lets you include this extra header information (it is still the job of the calling code to decide how to map numbers to types, though)
p53816
aVYou can then specify different types as different fields is the stream (note: this only works with the base-128 prefix style)
p53817
aVI'll need to double check, but the intention is that something like the following should work:
p53818
aVNote that this doesn't currently work in the v2 build (since the "WithLengthPrefix" code is incomplete), but I'll go and test it on v1
p53819
aVIf it works, I'll all the above scenario to the test suite to ensure it does work in v2
p53820
aVEdit:
p53821
aVyes, it does work fine on "v1", with output:
p53822
as(dp53823
g18
V23354
p53824
stp53825
a((dp53826
g2
(lp53827
VThe main problems I've had in this area are around maintenance; making a COM-callable dll isn't hard, but making it stay callable when you update it (i
p53828
ag50
aVre-deploying the changes) can be a real pain
p53829
aVOr maybe I just got used to robocopy deployment, which isn't going to be enough in this case - and it didn't help that I had COM+ to contend with as well
p53830
aVRe the data
p53831
aVyou really want to keep the API basic
p53832
aVI would be happy throwing strings over the boundary (xml perhaps, but not the only choice), but I would avoid recordsets etc
p53833
aVThat is just asking for pain
p53834
aVOf course, you might not have a choice
p53835
aVLast time I had to do this, I actually got fed up trying to fight the different layers, and I ended up using http for the interface instead; both VB6 and C# are more than capable of throwing http messages around, or under-pinning a basic http server (either ASP or ASP
p53836
aVNET)
p53837
aVMaybe a bit more overhead, but the separation was worth it
p53838
aVAnd it means I can swap either client or server at any time
p53839
as(dp53840
g18
V23354
p53841
stp53842
a((dp53843
g2
(lp53844
VIf you have the , you can check the ; if  is true, and if  is null, then it is a non-nullable value-type:
p53845
as(dp53846
g18
V23354
p53847
stp53848
a((dp53849
g2
(lp53850
VOne trick is to use  in the middle to force it:
p53851
aVor use :
p53852
as(dp53853
g18
V23354
p53854
stp53855
a((dp53856
g2
(lp53857
VI would advise simply not to
p53858
aVIt isn't necessarily what you want to hear, but especially when mixing with , save-points aren't a great idea
p53859
aVs can be nested, but the first rollback dooms everything, and the commit only happens at the outermost transaction
p53860
aVIn most scenarios I can think of, it is better to sanitise the data first
p53861
aVYou can (and should) also use contraints for a safety net, but if you hit that safety net, assume big problems and rollback everything
p53862
aVExample of nested transactions:
p53863
aVIn the above,  is atomic - we'll either add the account-transaction and update the estimated balance, or neither
p53864
aVIf this is the only transaction, then it is committed at the end of this method
p53865
aVHowever, in the  method, we create another outer transaction; we'll either perform both , or neither
p53866
aVHere, the inner  (in ) doesn't commit the db-transaction, as there is an outer transaction
p53867
aVIt simply says "I'm happy"
p53868
aVConversely, though, if either of the inner transactions is aborted ( called without ), then the outer transaction is rolled back immediately, and that transaction will refuse any additional work
p53869
aVThe outer transaction is committed only if no inner transaction was aborted, and  is called on the outer transaction
p53870
as(dp53871
g18
V23354
p53872
stp53873
a((dp53874
g2
(lp53875
VIf you hand the caller the , you can't control this; you can't even subclass , since the add/remove are not
p53876
aVInstead, then, I would expose the data as :
p53877
aV(the  prevents them just casting it)
p53878
aVThe caller can still use  on , and thanks to LINQ they can do all the other fun things too (, , etc)
p53879
as(dp53880
g18
V23354
p53881
stp53882
a((dp53883
g2
(lp53884
VThe constraints must apply to every type in the chain; hence you need:
p53885
aVWithout this, you can't satisfy the constraint for  in:
p53886
aVor
p53887
aVsince  is only usable when  has
p53888
as(dp53889
g18
V23354
p53890
stp53891
a((dp53892
g2
(lp53893
VThat is of definite interest
p53894
aVDo you have a specific demo that I can use to investigate
p53895
aV(I'm the author)
p53896
aVThe problem is simply a bug; during  it should cascade the model the see what other types are needed
p53897
aVIt doesn't do this at the moment (but will soon ;p)
p53898
aVIn regular
p53899
aVNET (with ) this isn't a problem - it can add in the extra type on the fly
p53900
aVBut on CF (or with any static-compiled dll) this is not possible
p53901
aVUntil  is fixed, the cheat here is to tell it what else it needs
p53902
aVThe easiest way is to touch the indexer for :
p53903
aVWe don't need the value returned by this indexer (into ) - we just need it to have executed to fill in some blanks before calling compile
p53904
as(dp53905
g18
V23354
p53906
stp53907
a((dp53908
g2
(lp53909
VIn the general sense,  can represent:
p53910
aVan inbuilt conversion (for example, between a float an an int), defined by the language
p53911
aVwhich might require an actual operation (float <===> int being a good example)
p53912
aVor might just be for the beefit of the compiler (int <===> an-int-enum, for example)
p53913
aVa reference cast (which never changes the reference or the object; it just types the local handle to it)
p53914
aVwhich might require a type check (for example, object ===> IDataReader)
p53915
aVbut might be already known to be true (for example, IDataReader ===> object)
p53916
aVa boxing / unboxing operation (which always initializes a value-type, or creates a new object on the heap [except for null-boxing a ]
p53917
aVa type-defined conversion operator (implicit or explicit), which runs whatever code is defined in the type
p53918
aVGiven an  value, the  will assume it is an unboxing operation, so will only work if the object is a boxed  (or a boxed int-enum)
p53919
aVIt will fail if the object value is actually a string or a boxed- etc
p53920
aVworks differently; it runs a number of tests, to attempt to bring together things like casting-from-a-float (covered above) and parsing a string (which maps to )
p53921
as(dp53922
g18
V23354
p53923
stp53924
a((dp53925
g2
(lp53926
V(requires a reference to )
p53927
aVAn advantage of using  is that you support RSS and Atom at the same time
p53928
as(dp53929
g18
V23354
p53930
stp53931
a((dp53932
g2
(lp53933
VIf you are using the LINQ-to-SQL, then:
p53934
aVshould do it, but only if you have all the required data
p53935
aVTo be honest, it works better starting from tables (perhaps in SSMS) and dragging them into LINQ-to-SQL
p53936
aVAlso; there are a lot of important database concepts (indexing, etc) that is not expressed in DBML
p53937
as(dp53938
g18
V23354
p53939
stp53940
a((dp53941
g2
(lp53942
V(assumes the parent-association between employee and department is defined in the DBML)
p53943
aVand if you expect exactly one such:
p53944
as(dp53945
g18
V23354
p53946
stp53947
a((dp53948
g2
(lp53949
VIf you mean that the resultant date should be the same distance from the end of the month, then you're into custom code - something like (not fully tested, especially re 28/30/31 months):
p53950
as(dp53951
g18
V23354
p53952
stp53953
a((dp53954
g2
(lp53955
VOK; this is insanely more effort than I would normally go to, but this might be a useful utility method
p53956
aVIt creates IL on the fly (cached) to do the work, handling value-type vs ref-type objects, inbuilt IL equality, equality operators (), and  for the rest:
p53957
as(dp53958
g18
V23354
p53959
stp53960
a((dp53961
g2
(lp53962
VThe wire-format defined by google is a tree serializer, not a graph serializer, so object-references are not preserved
p53963
aVHowever, once I get "v2" shipped, I have some nefarious plans to hack object-reference/graph support into the model - essentially by (in that mode) including additional object-id data
p53964
aVThis will make it somewhat tricky to use in interop scenarios, however - so ideally only good for protobuf-net <===> protobuf-net
p53965
aVBut nothing today - you'll get multiple copies, or if you get a circular reference it should explode
p53966
aVAs an update: this is now available in protobuf-net v2, but as an implementation-specific feature outside of the code spec
p53967
as(dp53968
g18
V23354
p53969
stp53970
a((dp53971
g2
(lp53972
VHere's something like the write:
p53973
as(dp53974
g18
V23354
p53975
stp53976
a((dp53977
g2
(lp53978
VThe problem starts here:
p53979
aVFields shouldn't be public, so to do this properly you would have a property, and you would therefore have to call the set accessor
p53980
aVI think what they are trying to highlight is the difference between:
p53981
aV(which does a field assignment inside the constructor)
p53982
aVvs
p53983
aVHowever
p53984
aVThis is all micro-optimisation
p53985
aVOften, trivial get/set accessors will be inlined - so there is very little difference in reality
p53986
aVI would happily just have:
p53987
as(dp53988
g18
V23354
p53989
stp53990
a((dp53991
g2
(lp53992
VAlso - it is not 100% perfect, but you can try :
p53993
aVgives:
p53994
aVFinally - if you need different output, the xslt is user-editable
p53995
as(dp53996
g18
V23354
p53997
stp53998
a((dp53999
g2
(lp54000
VThe "less complex middle tier" is what worries me
p54001
aVthe point of the ORM is to ensure that most of the complexity relates to your actual domain (whether that is order-processing, feed-reading, or whatever)
p54002
aVThat complexity has to go somewhere
p54003
aVAnd the last place you want that complexity is in the DB - your least scalable commodity (you generally scale the db server up (which is expensive), where-as you scale the app-servers out (much cheaper))
p54004
aVThere may be a case for using document databases instead of relational databases, but RDBMS are not going anywhere
p54005
aVGenerally I would suggest: limit your xml usage at the db to sensible amounts
p54006
aVIt can be a very effective tool - but be careful you aren't creating an inner-platform
p54007
aVThe relational database (by whichever vendor) is exceptional at its job, with sophisticated indexing, ACID, referential integrity etc
p54008
aVleverage that power
p54009
as(dp54010
g18
V23354
p54011
stp54012
a((dp54013
g2
(lp54014
VThe first thing I'd try changing is here:
p54015
aVIt doesn't check that  is +ve; now I would expect  to explode if it was negative, but
p54016
aVeither way; I would definitely check for an unexpected  condition there
p54017
as(dp54018
g18
V23354
p54019
stp54020
a((dp54021
g2
(lp54022
VIn most trivial cases, the compiler will remove it anyway
p54023
aVThere is an important point with value-types, which is that copying it into a variable clones the value, so can represent a significant change - but you shouldn't encourage mutable value-types anyway
p54024
aVWith floating-point, there are some edge-cases where when it uses a local you get different answers (the native types have greater width than  /  etc) - which also means you can get different results with debug/release (depending on whether the variable is removed by the compiler)
p54025
aVThere are also cases where the variable can do more than the value on the stack - i
p54026
ag50
aVbe "captured" into a lambda / anon-method, or be used for /, but that rarely applies
p54027
as(dp54028
g18
V23354
p54029
stp54030
a((dp54031
g2
(lp54032
VIt sounds to me like the thing to do here is to create an  per plugin / implementation, and use each plugins folder as the bin path
p54033
aVThat way, each plugin can run with its own set of completely isolated assemblies
p54034
aVThe other (even more isolated) approach is to create a  per call; that can be very effective and is simpler than handling s
p54035
aVThere is a vast range of info about working with s linked from here (see the table)
p54036
as(dp54037
g18
V23354
p54038
stp54039
a((dp54040
g2
(lp54041
VIt speaks the truth
p54042
aVSimply declare an , and tell it what uri "georss" refers to:
p54043
aVand pass  into the  call:
p54044
aVYou should be able to find the uri from the  alias declaration at the top of the xml (edit: @dtb found it already)
p54045
as(dp54046
g18
V23354
p54047
stp54048
a((dp54049
g2
(lp54050
VYou just want all the values in turn
p54051
aVThen  may help
p54052
aVIf you are on
p54053
aVNET 4, there is a  overload that can help here, too (taking a sequence rather than an array, so you don't need to create an additional single array, or mess with ):
p54054
aVwhich returns
p54055
as(dp54056
g18
V23354
p54057
stp54058
a((dp54059
g2
(lp54060
VThe most appropriate answer here is probably to expose an  somewhere on your business layer
p54061
aVYour UI code can subscribe to the event, and handle the event by switching to the UI thread (if necessary) and update itself
p54062
aVThen the business code doesn't need to know about the UI, and can work the same without any UI (but as with all delegates / callbacks, you need to check for  before attempting to invoke the delegate)
p54063
as(dp54064
g18
V23354
p54065
stp54066
a((dp54067
g2
(lp54068
VCan you include any more information about the contract types
p54069
aVI would expect, for example, that  is marked as a data-contract, with the member as a data-member, for example:
p54070
aVThat should then work
p54071
aVIf not, it would really help to see your types (or a cut-down version of them, that illustrates the problem)
p54072
as(dp54073
g18
V23354
p54074
stp54075
a((dp54076
g2
(lp54077
VThe use of  ensures (unlike LINQ /) that the array is initialized at the right size
p54078
aVYou can possible get a shade quicker by unrolling, but not much:
p54079
aVIf you need something faster still (perhaps bulk file/data handling), then writing your own parse might help; the inbuilt one handles a lot of edge-cases - if your data is simpler you really can cut this down a bit
p54080
aVFor an example of an alternative parser:
p54081
as(dp54082
g18
V23354
p54083
stp54084
a((dp54085
g2
(lp54086
VTwo problems; firstly,  should be ; secondly,  is only available on the generic type,
p54087
aVSo change to:
p54088
aVand you should be sorted
p54089
as(dp54090
g18
V23354
p54091
stp54092
a((dp54093
g2
(lp54094
VYou are talking about cross-platform serialization
p54095
aVA few options:
p54096
aVserialize it as text (xml, json); text is still binary, after all - and simple
p54097
aVserialize it manually
p54098
aVuse a third party cross-platform serializer
p54099
aVBut whatever you do, don't use
p54100
aVThe reason I stress this is that it is probably the first thing you'll see if you search for C# binary serialization, but is entirely inappropriate for your purposes
p54101
aVThe format is proprietary, and includes type information that only makes sense from
p54102
aVNET (not really from unmanaged C)
p54103
aVI'm quite attached to "protocol buffers" as a serialization API, and there are both C# and C versions here
p54104
as(dp54105
g18
V23354
p54106
stp54107
a((dp54108
g2
(lp54109
VI don't know if it is related, but I had a similar problem with some machines that were sat behind an F5/BigIP
p54110
aVUltimately, though, it turned out to be more related to the local IIS configuration, and WCF not being able to correctly resolve the site for http
p54111
aVIt worked for https, though
p54112
aVI never did get to the bottom of it; to get the service working I deployed a custom host-factory that snipped http out of the loop entirely - it then worked for https, and completely ignored http
p54113
as(dp54114
g18
V23354
p54115
stp54116
a((dp54117
g2
(lp54118
VYes - that will execute  10 times
p54119
aVThe intent in that example is to illustrate usage when you can estimate the overall workload, or report meaningful progress
p54120
aVThey are just trying to simulate "some work" with progress indication
p54121
aVIf you can't do that, then just run it async (via ) but show a scrolling infinite marquee or similar
p54122
aVDon't do it 10 times ;p Alternatively, run , then report progress when you process the data
p54123
aVAssuming that takes some time
p54124
aVIf all the time is in , then
p54125
as(dp54126
g18
V23354
p54127
stp54128
a((dp54129
g2
(lp54130
VDoes it have to be a
p54131
aVis simple:
p54132
aVFor a richer display,  would also do this, but you need an extra bit of indirection (since it supports multiple columns, it needs a wrapper object per row):
p54133
aVThis also gives you opportunity to add in extra data, for example the number:
p54134
as(dp54135
g18
V23354
p54136
stp54137
a((dp54138
g2
(lp54139
VThat is ultimately a runtime feature; in MS
p54140
aVNET,  is the closest you'll get at the moment, although they have mentioned possibly looking at the "compiler as a service" in the future
p54141
aVIf you're happy to use Mono, it already exists , with REPL example
p54142
aVUsage (from here):
p54143
as(dp54144
g18
V23354
p54145
stp54146
a((dp54147
g2
(lp54148
VEDIT: this is no longer required in v2 - you can specify this at runtime, or use
p54149
aVThe reason for this is that the protobuf wire format (devised by Google) does not include any type metadata, and so we need some way of knowing what type of object we are talking about
p54150
aVdoesn't provide this information, and there is no clear way of providing a robust key independently
p54151
aVActually, protobuf doesn't support inheritance either - protobuf-net shims around that by treating sub-types as nested messages
p54152
aVSo a  actually appears in transit as though  was a property of a sub-object, a bit like:
p54153
aVetc
p54154
aVRe omitting it; in "v2", you have the option of specifying this data outside of the type model, via your own code
p54155
aVThis means you don't need to decorate everything, but it still needs some mechanism to associate keys with types
p54156
as(dp54157
g18
V23354
p54158
stp54159
a((dp54160
g2
(lp54161
VThat is a common feature of contract-based serializers, including , etc (i
p54162
ag50
aVthose that don't include type metadata for every object)
p54163
aVThere are a few things that make this tricky:
p54164
aVduring deserialization, what type would it create for
p54165
aVduring serialization, the "what is the current object" bears little relationship to the contract
p54166
aVin particular it gets very messy if the type implements multiple interfaces
p54167
aVThis is a scenario I want to get something working for in "v2" though (but maybe not quite for release); I'm thinking:
p54168
aVeither  must be non-null to start with (i
p54169
ag50
aVdecides the type of ), or a default implementation must be specified somewhere
p54170
aVinterface-based is mutually exclusive vs
p54171
aVinheritance; when using interfaces there can be no inheritance support
p54172
aVall interface usage would be via properties, never fields (obviously)
p54173
aVAlternatively, and perhaps more suited to the scenario presented, we could use something like  to indicate the concrete types
p54174
aVBut within those limits I think something is possible
p54175
aVBut not today
p54176
as(dp54177
g18
V23354
p54178
stp54179
a((dp54180
g2
(lp54181
VSomething like:
p54182
as(dp54183
g18
V23354
p54184
stp54185
a((dp54186
g2
(lp54187
VLike so
p54188
aVChanges:
p54189
aVI used a tweaked  to find the  overload (otherwise it is an ambiguous match)
p54190
aVuse the , not the handle (since that is what  wants)
p54191
aVuse  (the other might have worked too, but I know this way works)
p54192
as(dp54193
g18
V23354
p54194
stp54195
a((dp54196
g2
(lp54197
VThreads should ideally never be aborted
p54198
aVIt simply isn't safe
p54199
aVConsider this as a way of putting down an already sick process
p54200
aVOtherwise, avoid like the plague
p54201
aVThe more correct way of doing this is to have something that the code can periodically check, and itself decide to exit
p54202
as(dp54203
g18
V23354
p54204
stp54205
a((dp54206
g2
(lp54207
VUse a variable
p54208
aVor a parameter:
p54209
as(dp54210
g18
V23354
p54211
stp54212
a((dp54213
g2
(lp54214
VThe winform  is an instance method of  - you just need an instance of a control (which can be  in many cases)
p54215
aVFor example:
p54216
aVIt can also be accessed via an interface, or sync-context if you want abstraction - but the easiest approach is to handle it at the UI via an event, in which case controls are conveniently available
p54217
as(dp54218
g18
V23354
p54219
stp54220
a((dp54221
g2
(lp54222
VStructs need to be fixed size
p54223
aVThink of a , for example
p54224
aVThe only way you could have  as a value-type would be to store just the pointer
p54225
aVWhich is essentially what we achieve by using a reference-type
p54226
aVOf course, it is also hugely beneficial that we don't copy the string every time we assign it
p54227
as(dp54228
g18
V23354
p54229
stp54230
a((dp54231
g2
(lp54232
VLike so
p54233
aVI haven't really changed much here, except the constructor usage
p54234
aVHowever
p54235
aVThe thing to watch here is that we don't introduce any conflicting LINQ operations
p54236
as(dp54237
g18
V23354
p54238
stp54239
a((dp54240
g2
(lp54241
VThe designer is generally going to get a bit upset when  is in script (and it sometimes gets snarly when it is in attribute values)
p54242
aVIf the output is correct, and you're happy with the way the html is constructed, then I wouldn't stress
p54243
aVUltimately, though; how does VS know that  is going to return something sensible
p54244
aVIt could return  which would really screw up the javascript
p54245
aVThat is why it is unhappy
p54246
as(dp54247
g18
V23354
p54248
stp54249
a((dp54250
g2
(lp54251
VVariance exists in C# 4
p54252
aV0 targetting
p54253
aVNET 4), but is limited to interfaces and usage of / (oh, and arrays of reference-types)
p54254
aVFor example, to make a covariant sequence:
p54255
aVBut other than that
p54256
aVno
p54257
aVStick to either non-generic lists (), or use the expected list type
p54258
as(dp54259
g18
V23354
p54260
stp54261
a((dp54262
g2
(lp54263
VThat looks like a job for AutoMapper, or (simpler) just add some interfaces
p54264
as(dp54265
g18
V23354
p54266
stp54267
a((dp54268
g2
(lp54269
VWhen adding parameters, there is a "return value" parameter direction:
p54270
aVInspect the  of this param after the call (), and you have the return value
p54271
aVOne note, though; when using this with  results, the return value is only available after all the data has been read from the results (return/output is at the end of the TDS stream)
p54272
as(dp54273
g18
V23354
p54274
stp54275
a((dp54276
g2
(lp54277
VIgnacio is right; that is base-64:
p54278
aVGives:
p54279
as(dp54280
g18
V23354
p54281
stp54282
a((dp54283
g2
(lp54284
V would be very very bad here
p54285
aVData-context does not play nicely with threading, plis you want to throw it away each time to avoid overuse
p54286
aVYou could use a static property that relates to the current http context
p54287
aVThat might make sense
p54288
aVThen it is just a public static property
p54289
aVMany people prefer things like IOC and instance-based contexts, however; or contexts that sit behind the storage interface
p54290
aVThe choice is yours
p54291
aVNote: another option is thread-static, but it should not be assumed that all of your request is serviced by the same thread
p54292
aVSo don't do that either
p54293
as(dp54294
g18
V23354
p54295
stp54296
a((dp54297
g2
(lp54298
VI doubt it applies here, but there is 1 edge-case wher  returns  (namely ), and one extreme corner-case (, discussed here) where a regular class can construct to
p54299
aVBut more likely:
p54300
aVit doesn't exist (name wrong, perhaps)
p54301
aVyou are using , and the interface isn't implemented (perhaps the interface is declared in two different assemblies; it counts separately as different interfaces in each, even if the name and namespace are identical)
p54302
aVFrom the edit, it sounds like the last point; you should have the interface defined once only, and a reference between assemblies so that other assemblies can see (and implement) that interface
p54303
as(dp54304
g18
V23354
p54305
stp54306
a((dp54307
g2
(lp54308
VThe most reliable way is to declare an outermost DTO class:
p54309
aVand serialize that (i
p54310
ag50
aVput your list into another object)
p54311
aVYou can avoid a wrapper class, but I wouldn't:
p54312
aVThe problem with this is that when you use custom attributes you need to be very careful to store and re-use the serializer, otherwise you get lots of dynamic assemblies loaded into memory
p54313
aVThis is avoided if you just use the  constructor, as it caches this internally automatically
p54314
as(dp54315
g18
V23354
p54316
stp54317
a((dp54318
g2
(lp54319
VFor runtime etc,
p54320
aVNET should be enough
p54321
aVOr with some tools (like as is used via MonoTouch and some others), not even that
p54322
aVFor the application, just the exe is necessary, but there can be lots of other required files - a config file perhaps, or maybe supporting non-CLR dlls (third party dlls perhaps)
p54323
aVFor deployment, you can just use the exe etc (xcopy deployment), or ClickOnce (), or an installer ( / )
p54324
as(dp54325
g18
V23354
p54326
stp54327
a((dp54328
g2
(lp54329
VWhile  pre-dates things like extension methods, your expected behaviour is exactly how  works:
p54330
aVvs
p54331
aVDifferences:
p54332
aV, while static, is an extension method - so appears to be an instance method
p54333
aVis static but isn't an extension method
p54334
aVreturns an , so you need  to get an array
p54335
aVreturns an array already, and additionally ensures it is the right size much more efficiently than  can
p54336
as(dp54337
g18
V23354
p54338
stp54339
a((dp54340
g2
(lp54341
Vor manually:
p54342
as(dp54343
g18
V23354
p54344
stp54345
a((dp54346
g2
(lp54347
VI might be tempted to add an extension property provider, so you can simply set a new pseudo-property that appears in the IDE property panel
p54348
aVA similar example (using the "principal" for roles-based checks) is shown here
p54349
aVNote, however, that it would be pretty easy for someone with programming knowledge to bypass anything simple
p54350
as(dp54351
g18
V23354
p54352
stp54353
a((dp54354
g2
(lp54355
VIt depends; you could use PostSharp to write such an attribute that is re-written by the weaver; however, I would be tempted to just do it manually - perhaps using a common method for handling the data updates, i
p54356
ag50
aVwith:
p54357
as(dp54358
g18
V23354
p54359
stp54360
a((dp54361
g2
(lp54362
VThat it is because the constructor accepts an  (interface), rather than a  (delegate)
p54363
aVAnon-methods / lambdas can support delegates, but not (directly) interfaces
p54364
aVIt is pretty easy to wrap, though - for example:
p54365
aVNow you can use:
p54366
as(dp54367
g18
V23354
p54368
stp54369
a((dp54370
g2
(lp54371
VSnippy (and reflector addin)
p54372
as(dp54373
g18
V23354
p54374
stp54375
a((dp54376
g2
(lp54377
VJust to give an alternative view-point, I wouldn't try to catch it
p54378
aVIf I am expecting this scenario, I would simply check for foreign-key data before I try to delete
p54379
aVThis avoids complications, especially if that  isn't the first thing that happens in the unit of work
p54380
aVAnd in the case where you have multiple foreign keys, a string-based message isn't very helpful to your code
p54381
aVI would keep the foreign key, of course - as a sanity check / fallback for the edge cases (for example, concurrency)
p54382
as(dp54383
g18
V23354
p54384
stp54385
a((dp54386
g2
(lp54387
VYou mention that this all happens on a new thread
p54388
aVHowever, you also mention
p54389
aVTo me, that suggests that you are updating the UI from the worker thread, which would be a problem (the other possibility is that you are running on a worker thread, but blocking the UI thread, which is also a problem)
p54390
aVYou should be asking the UI to update itself on the UI thread - then you don't need :
p54391
as(dp54392
g18
V23354
p54393
stp54394
a((dp54395
g2
(lp54396
VIt is a bit of a false optimisation; I'd rather use it to make sure that if I'm not expecting inheritance I don't get inheritance
p54397
aVThe compiler still emits all instance calls (to classes) as virtual calls, but potentially the JIT could optimize it differently, and just do a null check and static call, if not overridden
p54398
aVPossibly
p54399
aVThere are some more esoteric cases, for example when the presence of a particular interface would cause it to be treated differently at runtime - but to exploit those scenarios (depending on ) requires runtime code generation via  etc
p54400
as(dp54401
g18
V23354
p54402
stp54403
a((dp54404
g2
(lp54405
VYou are looking for the literal ; you mean:
p54406
aVso that the TSQL is:
p54407
aVOr simpler; put the  into the value in the calling code; then your code becomes:
p54408
aVand the TSQL becomes:
p54409
as(dp54410
g18
V23354
p54411
stp54412
a((dp54413
g2
(lp54414
V will elevate to DTC if necessary
p54415
aVIt sounds like DTC is not correctly configured, usually due to firewall restrictions
p54416
aVTry a dtcping between the servers (important: in both directions)
p54417
as(dp54418
g18
V23354
p54419
stp54420
a((dp54421
g2
(lp54422
VThe compiler is right; it could just as well be:
p54423
aVwhich limits the exceptions which enter that block, but does not declare a variable for it
p54424
aVThe variable is useful if you want to inspect the value, log it, or wrap it in another exception
p54425
aVJust for completeness (doesn't apply here) generally a re-throw should be , not  (to preserve the stack-trace)
p54426
as(dp54427
g18
V23354
p54428
stp54429
a((dp54430
g2
(lp54431
VIf it is a table-valued parameter, then AFAIK there is no direct support at the moment
p54432
aVADO
p54433
aVNET does though
p54434
aVAnother option is to build a delimited string, and split it (perhaps in a udf) at the db
p54435
aVThen it is just a  at the db, and  in your code - simply to handle
p54436
as(dp54437
g18
V23354
p54438
stp54439
a((dp54440
g2
(lp54441
VThe  should do it, but I'm guessing that it is hanging forever
p54442
aVThe reason here is that protobuf messages don't have an inbuilt terminator, so the default is that it reads until the end of the stream - which won't happen until you close the socket
p54443
aVTo get around this, a common trick is to prefix the message with the length, and limit yourself to that
p54444
aVThere may be an inbuilt way to handle that in the Java implementation, or you can handle it manually
p54445
aVOn the C# side, protobuf-net has , which accepts an enum to specify how you've encoded it
p54446
aVFor simplicity I would suggest a basic 32-bit little-endian encoding of the length (which maps to )
p54447
aVRe the edit / comment: the two must match
p54448
aVAt the moment you are serializing without a length prefix, but deserializing expecting a length prefix
p54449
aVDoes the Java API expose a mechanism to obtain the data-length before you write it
p54450
aVIf not, perhaps write first to a temp buffer, see how much you wrote, then write the length and finally the data
p54451
aVOr; if you are only sending a single message - just close the stream and use  (no length prefix)
p54452
aVI have a C#-to-C# multi-message sockets example available, but I can't comment much on the java side
p54453
as(dp54454
g18
V23354
p54455
stp54456
a((dp54457
g2
(lp54458
VLINQ-to-Objects generally is going to add some marginal overheads (multiple iterators, etc)
p54459
aVIt still has to do the loops, and has delegate invokes, and will generally have to do some extra dereferencing to get at captured variables etc
p54460
aVIn most code this will be virtually undetectable, and more than afforded by the simpler to understand code
p54461
aVWith other LINQ providers like LINQ-to-SQL, then since the query can filter at the server it should be much better than a flat , but most likely you wouldn't have done a blanket  anyway, so that isn't necessarily a fair comparison
p54462
aVRe PLINQ; parallelism may reduce the elapsed time, but the total CPU time will usually increase a little due to the overheads of thread management etc
p54463
as(dp54464
g18
V23354
p54465
stp54466
a((dp54467
g2
(lp54468
s(dp54469
g18
V23354
p54470
stp54471
a((dp54472
g2
(lp54473
Vand then try to run another query using the same SqlConnection then it will throw an error
p54474
aVof course, you could enable Multiple Active Result Sets - then it doesn't throw
p54475
aVThere are some limitations of course (aren't there always
p54476
aV, but it'll work
p54477
aVOf course, this is only intended for nesting operations
p54478
aVIf the problem is that you have accidentally left something open (that you should have closed already), then the answer is (as already stated)
p54479
as(dp54480
g18
V23354
p54481
stp54482
a((dp54483
g2
(lp54484
VRe the example code:
p54485
aVMaybe the way to do this is via reflection:
p54486
as(dp54487
g18
V23354
p54488
stp54489
a((dp54490
g2
(lp54491
VActually, in this scenario I would look into the  API
p54492
aVUnlike a delegate, an  can be deconstructed at runtime
p54493
aVYou can't serialize them by default, but a lot of work has been done in that space
p54494
aVIt is also a bit like what a lot of LINQ providers do in the background, for example WCF Data Services
p54495
aVOf course, another approach is simply to use a lambda expression as the hook for RPC, which is what I describe here
p54496
aVThe code that implements this is freely available in the protobuf-net tree
p54497
aVYou could customize this by using an attribute to associate your token with the method, and obtain the attribute from the
p54498
aVIMO, the problem with delegates is that they are too tightly coupled to the implementation, so you can't have different implementations at each end (which is a common requirement)
p54499
aVExpressions have the advantage that lambdas still support intellisense etc, so you can do things like:
p54500
aVand from that obtain  (the ), 123 and "abc" separately, including captured variables, /, etc
p54501
aVIt all works
p54502
as(dp54503
g18
V23354
p54504
stp54505
a((dp54506
g2
(lp54507
V30k is not what I would consider to be large
p54508
aVBefore getting excited, I would profile
p54509
aVThe indexer should be fine for the best balance of flexibility and safety
p54510
aVFor example, to create a 128k string (and a separate array of the same size), fill it with junk (including the time to handle ) and sum all the character code-points via the indexer takes
p54511
aV3ms:
p54512
aVFor files that are actually large, a reader approach should be used -  etc
p54513
as(dp54514
g18
V23354
p54515
stp54516
a((dp54517
g2
(lp54518
VMy guess is that your code is setting  to  for default  instances, perhaps:
p54519
aVor, in the constructor you have:
p54520
aVBasically, there is an implicit default (following the protobuf language guide) where-by bool is assumed to have a default of
p54521
aVIt doesn't send data that is believed to be the default
p54522
aVIf this default is incorrect, tell it:
p54523
aVor IIRC you can try setting  to  instead:
p54524
aVand there are a few other ways of telling it to always send the value:
p54525
aV(which uses the same pattern that is supported by core
p54526
aVNET for , , , etc - it isn't me inventing random patterns)
p54527
aVNote that in "v2" I have made two further changes to help remove this oddity:
p54528
aVyou can optionally bypass the constructor (WCF-style)
p54529
aVthe new meta-model provides another way of deciding whether or not to assume a default
p54530
as(dp54531
g18
V23354
p54532
stp54533
a((dp54534
g2
(lp54535
VIn any standard implementation there should be no difference
p54536
aVBut if you are paranoid, check the code
p54537
aVIt could have custom / implementations that do crazy stuff
p54538
aVBut that would be
p54539
aVcrazy
p54540
as(dp54541
g18
V23354
p54542
stp54543
a((dp54544
g2
(lp54545
VThere is an overload of  that does exactly that
p54546
aV(note that this actually sorts both arrays in parallel - i
p54547
ag50
aVit sorts the keys, and makes the same swaps to the target array)
p54548
as(dp54549
g18
V23354
p54550
stp54551
a((dp54552
g2
(lp54553
V is needed to tell it about subtypes
p54554
aVThe disadvantage of not using it is that the following won't work:
p54555
aVwith a method on the WCF interface that returns:
p54556
aVWithout the attribute, the serializer (especially for mex/proxy-generated types) won't know about , and it will fail
p54557
aVWith the attribute:
p54558
aVit will work
p54559
aVThis only applies to  - with  you get the type data in a different way
p54560
as(dp54561
g18
V23354
p54562
stp54563
a((dp54564
g2
(lp54565
VLook at MSDN; the indexer takes the mask, not the index
p54566
aVSo that is:
p54567
aVthen use
p54568
aVThis is odd though; if you are happy enough to use masks - why would one be using , rather than just an
p54569
aVI also assumed the indexer would take the index
p54570
aVVERY odd design decision
p54571
as(dp54572
g18
V23354
p54573
stp54574
a((dp54575
g2
(lp54576
Vsharpziplib allows for stream-based decompression - see this related question - the  provides similar stream-based  methods, so you can process each item like you would with any stream
p54577
as(dp54578
g18
V23354
p54579
stp54580
a((dp54581
g2
(lp54582
VWith sharpziplib:
p54583
as(dp54584
g18
V23354
p54585
stp54586
a((dp54587
g2
(lp54588
VIf all you know is , then the non-generic interfaces are your friend:
p54589
aVHowever
p54590
aVNot all enumerable items are lists, so not all can be added in this way
p54591
aVunderpins a lot of data-binding, so is a good bet
p54592
as(dp54593
g18
V23354
p54594
stp54595
a((dp54596
g2
(lp54597
VWhat are the fields at the moment
p54598
aVI wonder if you have some code in other types that is already touching the properties, and thus would break if they were just
p54599
aVI don't know how resharper feels about it, but it is not necessary (or even particularly common) to make things  - so  should be a reasonable option
p54600
as(dp54601
g18
V23354
p54602
stp54603
a((dp54604
g2
(lp54605
VIn short, no
p54606
aVRe optimising it, one option there might be a strategy based on a static initializer, that chooses an appropriate concrete implementation for the same-type case, but otherwise; i
p54607
ag50
aVbut you will almost certainly find yourself using  and reflection to create the instance (but once created it should be fine - and you only do that once)
p54608
as(dp54609
g18
V23354
p54610
stp54611
a((dp54612
g2
(lp54613
VWell, I'll first say that dynamic LINQ is usually overkill, but sometimes useful
p54614
aVBut you should just be able to reference the dll and away you go
p54615
aVIf no intellisense is appearing, but it compiles, then check where (physically) the dynamic linq dll is located
p54616
aVEnsure the "foo
p54617
aVdll
p54618
aVxml" file is located next to "foo
p54619
aVdll" (where "foo" is the assembly - perhaps
p54620
aVThis is key for intellisense when using assembly references
p54621
as(dp54622
g18
V23354
p54623
stp54624
a((dp54625
g2
(lp54626
VHard to answer without seeing the input data (or at least, a sample of it)
p54627
aVHowever, it is not correct to assume that a "comma" in CSV means "next field"; the data might be quoted, for example:
p54628
aVI would recommend the CSV Reader from here, which gets this right
p54629
as(dp54630
g18
V23354
p54631
stp54632
a((dp54633
g2
(lp54634
VI'd write a helper method:
p54635
aVand use  which will figure it out automatically via generic type inference
p54636
as(dp54637
g18
V23354
p54638
stp54639
a((dp54640
g2
(lp54641
VYes you can use LINQ , but you'll need to build the predicate yourself
p54642
aVIt isn't tricky
p54643
aVSomething like (from memory; no compiler to hand):
p54644
aVthen:
p54645
aVThis will cause the  to be executed at the server (for example, in TSQL), removing most of the network IO (asusming a sensible filter)
p54646
as(dp54647
g18
V23354
p54648
stp54649
a((dp54650
g2
(lp54651
VNot purely by html
p54652
aVThat is not a standard html input device
p54653
aVYou could perhaps use something like Silverlight or Flash, but that is more involved
p54654
aVI'm also not sure what you would do once the user has selected a folder, since there is no matching concept in terms of http form data
p54655
as(dp54656
g18
V23354
p54657
stp54658
a((dp54659
g2
(lp54660
VI strongly advocate against storing  or  data in the database; it is:
p54661
aVbrittle
p54662
aVnot version tolerant
p54663
aVnot platform independent
p54664
aVis OK for data transfer between
p54665
aVNET assemblies (at a push), but I would recommend a more predictable serializer
p54666
aVis an option (as is  or ), but I would not use  for all the same reasons above
p54667
aVI would be tempted to use protobuf-net, since that is efficient binary in a known efficient format, platform independent and version tolerant
p54668
aVFor example:
p54669
aVSerialization:
p54670
aVDeserialization:
p54671
as(dp54672
g18
V23354
p54673
stp54674
a((dp54675
g2
(lp54676
Vprotobuf-net primarily handles just the serialization aspects (the protobuf spec by Google doesn't define any further than this)
p54677
aVSo it really comes down to: how are you serializing it
p54678
aVI must admit that the WCF GET approach is not something I've looked at hugely, so there is no special handling there
p54679
aVOne simple approach may be to look at just returning a string, and handling the base-64 encoding yourself, but to be honest if you are doing HTTP GET, then WCF itself seems overkill
p54680
aVI blogged here about using ASP
p54681
aVNET MVC at the server for protobuf via HTTP GET
p54682
aVThe linked sample code also includes a wire-compatible ASP
p54683
aVNET implementation
p54684
aVIf there is something appropriate we can do to make WCF GET easier, I'm all ears
p54685
as(dp54686
g18
V23354
p54687
stp54688
a((dp54689
g2
(lp54690
VIf you mean "winforms", there isn't any property for that
p54691
aVYou would have to create your own modal message dialog
p54692
aVYou might be able to use P/Invoke, but I wouldn't bother, tbh
p54693
as(dp54694
g18
V23354
p54695
stp54696
a((dp54697
g2
(lp54698
VDoes it have to be
p54699
aVYou can elect to use  for WCF, and then you can use:
p54700
aVUltimately,  is simply not designed to give you the same level of xml control - which is why it doesn't support even attributes
p54701
aVIf you need specific xml,  is usually a better choice
p54702
as(dp54703
g18
V23354
p54704
stp54705
a((dp54706
g2
(lp54707
Vedit to cater for non-list inputs, now handles  and checks if this is an ; if not it buffers it via , which helps ensure we only read the data once (rather than  and  which may read the data multiple times)
p54708
aVSince this is a list, I'd be inclined to write an extension method that uses that to the full:
p54709
as(dp54710
g18
V23354
p54711
stp54712
a((dp54713
g2
(lp54714
VYou need to set the  to something non-null to avoid the downstream processing, otherwise MVC doesn't know that you have short-circuited
p54715
aVThe simplest approach would be just:
p54716
as(dp54717
g18
V23354
p54718
stp54719
a((dp54720
g2
(lp54721
VIf you mean winforms,  has  (each of ) built in, with each  having a
p54722
aVThis should make what you need easy in the code, and visually intuitive for the user
p54723
aVNote that groups are only displayed when the  is ,  is , and visual styling is enabled (, usually in )
p54724
as(dp54725
g18
V23354
p54726
stp54727
a((dp54728
g2
(lp54729
Vwhenever GC feels like it, frankly; the variable is never read, so it is always eligible
p54730
aVis the variable - that has a fixed position on the stack for the reference; however, each  is a different object, created somewhere in the available heap space; different each time
p54731
aVno difference whatsoever; strictly speaking there are some complexities involving the actual declaration point of the variable (in IL) and how  is actually implemented - but that would only show after exiting the loop
p54732
aVAnd since on each iteration you immediately allocate it, there is no tangible difference here
p54733
as(dp54734
g18
V23354
p54735
stp54736
a((dp54737
g2
(lp54738
VTo do that, you would need to swap the sp for a udf
p54739
aVThis is usually possible without impacting any existing code (that calls the SP) by simply forwarding the (existing) sp to the (new) udf, i
p54740
ag50
aVLINQ-to-SQL supports composability against udfs, but not SPs, so you should then be able to join to the UDF (via ) in your query
p54741
as(dp54742
g18
V23354
p54743
stp54744
a((dp54745
g2
(lp54746
VThis is quite cute:
p54747
as(dp54748
g18
V23354
p54749
stp54750
a((dp54751
g2
(lp54752
VCall , i
p54753
ag50
as(dp54754
g18
V23354
p54755
stp54756
a((dp54757
g2
(lp54758
VThis should be done automatically for any of the inbuilt code using an , such as  - just make sure that the encoder you pass in is configured to include a bom (the default  includes the bom)
p54759
aVIf you are handling your own  ->  logic, then you need to call  and write those bytes at the start of the stream
p54760
aVThe default  includes the preamble; but you can do it explicitly in the ctor:
p54761
as(dp54762
g18
V23354
p54763
stp54764
a((dp54765
g2
(lp54766
VThat is a predicate expression; something that indicates data to include
p54767
aVSo, to get a single record you could use:
p54768
aVOr to get all data matching some condition you could use:
p54769
aVNote that this should be composable, for more fun:
p54770
as(dp54771
g18
V23354
p54772
stp54773
a((dp54774
g2
(lp54775
VThat is just a basic example
p54776
aVprotobuf-net is the serialization layer, not the messaging layer
p54777
aVIf you have a specific way you want to handle the messaging: go for it
p54778
aVAll you need to do is, during your stream processing, buffer up an entire message (perhaps into a ), then process it via protobuf-net when the data is available
p54779
aVThe difference would be that instead of using the  methods directly, you might want to handle to payload-length separately, so that your code knows how much data to buffer before processing
p54780
as(dp54781
g18
V23354
p54782
stp54783
a((dp54784
g2
(lp54785
Vprotobuf (under any implementation) is not an RPC stack; it is a serialization stack
p54786
aVYou can, however, use WCF to provide the RPC, but hook protobuf-net as the serialization layer inside WCF
p54787
aVThat do
p54788
aVI have a bespoke RPC layer using http, but I haven't implemented one for TCP, and I haven't looked at callbacks
p54789
aVWCF provides these built in, so maybe that is worth looking at
p54790
as(dp54791
g18
V23354
p54792
stp54793
a((dp54794
g2
(lp54795
VIf you are doing enough reflection that this is genuinely a bottleneck, then dynamic code may be worth investigating
p54796
aVUntil then - maybe  will reduce the cost; very similar code, but much cheaper
p54797
aVIn
p54798
aVNET 4
p54799
aV0 and above, the  API allows you to set multiple properties, but this is only really viable if you cache the delegate
p54800
aVThe other interesting option (with the same constraint: you must cache and re-use the delegate) is
p54801
aVHowever, all of these options are fairly advanced topics
p54802
aVI'm happy to advise, but do you really need this
p54803
as(dp54804
g18
V23354
p54805
stp54806
a((dp54807
g2
(lp54808
VThere is no defined syntax to use array initializer syntax, except for in arrays
p54809
aVAs you hint, though, you can add an operator (or two) to your type:
p54810
aVThen you can use:
p54811
aVetc
p54812
aVHowever, personally I'd just leave it alone, as:
p54813
aVwhich involves less work (no array allocation / initialization, no operator call)
p54814
as(dp54815
g18
V23354
p54816
stp54817
a((dp54818
g2
(lp54819
VLINQ isn't the answer to everything
p54820
aVSure, you can query the data-context to get all this information, but you're going to be doing a lot of work (either reflection or mapping, plus building an ), simply for the sql generator to reverse everything to get back TSQL
p54821
aVIt would be a lot simpler to just build the TSQL (making sure to white-list the table/column names to prevent injection) and use
p54822
aVFor example:
p54823
aVAlso; if  is the , you might want to look at , which is much more efficient than
p54824
as(dp54825
g18
V23354
p54826
stp54827
a((dp54828
g2
(lp54829
VSomething like:
p54830
as(dp54831
g18
V23354
p54832
stp54833
a((dp54834
g2
(lp54835
VWe'd need to see the xml; @Lee gives the correct approach here, so something like:
p54836
aV(taking your edit/reply into account)
p54837
aVHowever
p54838
aVThere are lots of gotchas:
p54839
aVthe query will be case-sensitive
p54840
aVwhite-space will be significant (so  is different to  etc - ditto carriage return)
p54841
aVxml namespaces are significant, so you may need , where  is the namespace-manager
p54842
aVTo give a complete example, that matches your comment:
p54843
aVHere,  is not  after the  call
p54844
aVIt finds the node
p54845
as(dp54846
g18
V23354
p54847
stp54848
a((dp54849
g2
(lp54850
VI suspect that basic authentication is going to need the password, so I suspect you'll need a
p54851
aVThe default credential would work with integrated auth, but not (AFAIK) basic
p54852
aVSo in answer to:
p54853
aVThere is a way to make this work without pass a user and password again
p54854
aVNo, I don't think so
p54855
as(dp54856
g18
V23354
p54857
stp54858
a((dp54859
g2
(lp54860
VAssuming you have loaded that into an  named :
p54861
as(dp54862
g18
V23354
p54863
stp54864
a((dp54865
g2
(lp54866
VYou need to use  to get the delegate instance, rather than a method-info
p54867
aVFor non-static methods this also includes the target instance
p54868
aVIn this case:
p54869
as(dp54870
g18
V23354
p54871
stp54872
a((dp54873
g2
(lp54874
VWhat is the data
p54875
aVYou can transpose data on-the-fly (like so), but it is a bit clumsy, and only really works if the data is all of the same type (since it expects a "column" to map to a "property")
p54876
aVAnd it is also very hard to add "rows" (since that is then properties)
p54877
aVBut for array-like data, it can be done via data-binding and some smoke and mirrors
p54878
as(dp54879
g18
V23354
p54880
stp54881
a((dp54882
g2
(lp54883
Vprotobuf (under any implementation) is just the serialization API
p54884
aVWhen talking on the wire, the default is that both ends already agree what the data is
p54885
aVFor sending different types of messages, a few options present themselves:
p54886
aVhave a wrapper object that simply has child objects to represent different message types
p54887
aVWith protobuf-net specifically you can also map this directly to inheritance (since protobuf-net maps inheritance to encapsulation)
p54888
aVuse a message header - some kind of data before your message that identifies this
p54889
aVIn particular, if using the  prefix-style, you can include a field number that is sent with the message (it defaults to , but an overloaded method allows you to specify this)
p54890
aVYou would then deserialize this via  which includes a delegate parameter to perform type resolution from the field number
p54891
aVAfter the edit
p54892
aVyou mention  and , but the message is
p54893
aVIt will always be everything (except defaults) in that message
p54894
aVIt could be both
p54895
aVIt could be neither
p54896
aVSo in that scenario, you would just deserialize it and check  and
p54897
aVAnother common option here is to add a discriminator, perhaps simply an enum:
p54898
aVand include that on the message:
p54899
aVNow you have an explicit way of expressing your meaning of message-type
p54900
as(dp54901
g18
V23354
p54902
stp54903
a((dp54904
g2
(lp54905
VThe project name (in common with the solution name) doesn't really matter to the output, as long as the project's "Assembly name:" and "Default namespace:" options are set correctly
p54906
aVSo have fun, but I wouldn't take them too far from the namespace
p54907
aVIf your namespace is , then anyone with the project already knows they work for , and they probably already have the project named on disk as , so it probably isn't going to add much confusion to just have , especially if this is in the path "
p54908
aV\u005cFooCorp\u005cMegaProject\u005cDAL\u005cDAL
p54909
aVcsproj" or similar
p54910
aVI've certainly done this before (at my last job, where we had hundreds and hundreds of assemblies)
p54911
as(dp54912
g18
V23354
p54913
stp54914
a((dp54915
g2
(lp54916
VVery different
p54917
aVA  is a collection of related tabular records (with a strong focus on databases), including change tracking
p54918
aVAn  is a tree structure of arbitrary data
p54919
aVYou can convert between the two
p54920
aVFor "which is best"
p54921
aVwhat are you trying to do
p54922
aVPersonally I very rarely (if ever) use  / , but some people like them
p54923
aVI prefer an object () representation (perhaps via deserialization), but xml processing is fine in many cases
p54924
aVIt does, however, seem odd to write a  to xml and then query the xml
p54925
aVIn that scenario I would just access the original data directly
p54926
as(dp54927
g18
V23354
p54928
stp54929
a((dp54930
g2
(lp54931
VReflector shows this (and is free); just View => Search (or F3) to find the type, then Tools => Analyze (or Ctrl+r), and expand Exposed By in the Analyzer panel
p54932
as(dp54933
g18
V23354
p54934
stp54935
a((dp54936
g2
(lp54937
VWell, the  isn't the array object
p54938
aVYou can get the address of the data (using  etc), but an arbitrary  does not have to be the start of the data - it could be at offset 17, for example
p54939
aVSo I would recommend either:
p54940
aVpass the  around instead
p54941
aV(or) create a new  and copy over the data you want
p54942
as(dp54943
g18
V23354
p54944
stp54945
a((dp54946
g2
(lp54947
VWell, how are you uploading
p54948
aVis rarely a sensible choice - it can leave you  (or even ) in a completely messed-up state
p54949
aVIf you are uploading via http, you could try using the async methods, allowing you to call , which is a bit more friendly
p54950
as(dp54951
g18
V23354
p54952
stp54953
a((dp54954
g2
(lp54955
VThis may be simply a limitation in "v1"
p54956
aVI've added this as a test on "v2", and it passed (I had to invent  and  to get it to compile):
p54957
aVWith "v1", maybe simply don't make it
p54958
aV(workaround, not fix)
p54959
aVAlso; there should be no need for the  ctor; that is not used by protobuf-net (although you can implement protobuf-net inside  by providing this method and calling into )
p54960
as(dp54961
g18
V23354
p54962
stp54963
a((dp54964
g2
(lp54965
VPossibly the  - that isn't an xml entity unless you are in html, and also the  should be
p54966
aVBasically, that isn't xml
p54967
aVThis works:
p54968
as(dp54969
g18
V23354
p54970
stp54971
a((dp54972
g2
(lp54973
VNo, basically
p54974
aVWell, you could do something with compiler warnings via  and , but that would be excessive
p54975
aVYou could probably do it with tooling, but eventually you need to trust people not to do stupid things
p54976
aVAfter all, do you have special rules about:
p54977
aVor do you just put that down to "don't be stupid"
p54978
aV;p
p54979
as(dp54980
g18
V23354
p54981
stp54982
a((dp54983
g2
(lp54984
VYes, protobuf-net works without
p54985
aVproto files
p54986
aVIn fact, for protobuf-net the core was written long before the
p54987
aVproto support
p54988
aVAll you need is something that allows it to obtain a unique number for each member you want to serialize
p54989
aVIn "v2" (not released) you can do this externally, but in the available dll this means attributes
p54990
aVThis can be the bespoke protobuf-net attributes, or you can use (for example) the  attributes if that is more convenient:
p54991
aVThere is support for generating a
p54992
aVproto file () - however, there are some caveats:
p54993
aVprotobuf-net supports inheritance; there is no definition of inheritance in the Google protobuf spec
p54994
aVIf you think interop is a concern down the line, it may be best to avoid inheritance (although there is a way of interpreting it; probofuf-net always emits a valid protobuf stream)
p54995
aVother complex types may require interpretation; for example while  and  map directly to protobuf types (available in every implementation), that is not true of  and ; if you think interop is an issue, it may be worth simplifying this from the start - for example deciding that you are going to send a , perhaps send a  that represents the offset into an epoch instead
p54996
aVeasy to interpret in any implementation
p54997
as(dp54998
g18
V23354
p54999
stp55000
a((dp55001
g2
(lp55002
VThoughts:
p55003
aVare any of the strings shared
p55004
aVYou could use a custom interner when loading your data, to ensure that none of these are duplicated (note: don't use the inbuilt interner, as you will saturate it; even a  would do)
p55005
aVare there any other common elements that could sensibly be likely to be duplicates, and might be moved into objects
p55006
aVYou still have the cost of the reference field, but hopefully this (and the new object) is a net gain
p55007
aVif you have vast numbers of similar entities, could any of them be modelled as immutable value-types
p55008
aVThis isn't usually my preferred option, but an advantage then is that you can stick them in an array:
p55009
aVyou gain the price of an object-reference and object-header per entity
p55010
aVyou can use the offset in the array () rather than a reference; for 64-bit, this is a decent saving when added up
p55011
aVyou seem to be suggest a sparse object approach; and indeed you want to avoid the cartesian product, but at the same time for the low number of members you describe a property-bag would probably be more expensive in memory; plus since you mention you are doing this for performance, I suspect it'll hurt CPU too
p55012
aVthe s - are they (for example) always whole days
p55013
aVYou'd be surprised what you can gain by using just the  number of days into an epoch
p55014
as(dp55015
g18
V23354
p55016
stp55017
a((dp55018
g2
(lp55019
VExpression trees have a lot in common with (for example) an AST
p55020
aVIt doesn't map directly to code, but is very amenable to construction from algorithms
p55021
aVFor example, if you are parsing a formula:
p55022
aVthat is:
p55023
aVIn fact, I have done exactly this, using a parser that build an object tree, with objects generating the complete expresion via a "visitor" implementation
p55024
aVIn
p55025
aVNET 4
p55026
aV0, the richer expression-tree support makes it possible to support most scenarios, and compile it on demand
p55027
aVAnother key use of expressions is that you can deconstruct them at runtime, so in your code you might have:
p55028
aVand extract the  method-info,  and  etc
p55029
aVcodedom maps to code
p55030
aVIt is all about statements etc, very similar to how you would write regular code
p55031
aVThe most common use of codedom is for code generation, as part of tooling
p55032
aVYou can use it for dynamic compilation, but to be honest it is harder
p55033
aVI am not a fan
p55034
aVThe nice feature is that a codedom tree might work for multiple languages
p55035
aVAnother contender here should be  and/or
p55036
aVThis doesn't map to an AST (expression), and can't be used to generate source-code (codedom), but allows full access to the MSIL tools
p55037
aVOf course, it also requires that you think in terms of stacks etc, but it is very efficient and effective for meta-programming
p55038
aVIf  is too hard-core, and codedom is a PITA, then another option is runtime generation of code as a string
p55039
aVThen pass that through  to compile it
p55040
aVThere are parts of the core runtime that do this ( IIRC)
p55041
aVSo to summarise:
p55042
aVmeta-programming:  or ; also  in 4
p55043
aV0 (but this is quite limited in 3
p55044
aV5)
p55045
aVhandling AST:
p55046
aVparsing at runtime:
p55047
aVcode-generation in multiple languages: code-dom
p55048
as(dp55049
g18
V23354
p55050
stp55051
a((dp55052
g2
(lp55053
VPerhaps try it with the extra quotes
p55054
aVI would also be interested in checking if there is any whitespace adding around  or
p55055
aVBasically: what is the actual string query you pass in
p55056
aV(after concatenation etc)
p55057
as(dp55058
g18
V23354
p55059
stp55060
a((dp55061
g2
(lp55062
VThe easiest way to fix that is to pass in a wrapper object instead of the list itself, i
p55063
ag50
aVthat do
p55064
as(dp55065
g18
V23354
p55066
stp55067
a((dp55068
g2
(lp55069
VAnother way of implementing this is to write a scalar UDF in the database that implements this functionality
p55070
aVThen drag that UDF onto the LINQ-to-SQL designer, which will give you access to your UDF via the data-context
p55071
aVThen you can use things like:
p55072
aVand which will call the UDF after translation (i
p55073
ag50
ag38293
as(dp55074
g18
V23354
p55075
stp55076
a((dp55077
g2
(lp55078
VI don't know about the reflection problem without you providing more info (such as the error), but you could also try access the file itself:
p55079
aVThis accesses the file-system meta-data (like you would see in explorer), and has the advantage of working for both managed and unmanaged dlls; but it requires that meta-data to exist (it doesn't look at the attribute)
p55080
aVEdit: a quick check indicates that (as expected) the compiler does check for this attribute and populate the file meta-data correctly
p55081
as(dp55082
g18
V23354
p55083
stp55084
a((dp55085
g2
(lp55086
VThat is pretty vague, but  and  should handle the file part (for moderately sized files)
p55087
as(dp55088
g18
V23354
p55089
stp55090
a((dp55091
g2
(lp55092
VNot built in
p55093
aVYou could tell your code to (on every [n] loop iterations, etc) check something like a  to see if it should keep running (at the same time it checks for cancellation)
p55094
aVI don't recommend suspending the thread (), since you don't know what locks etc it may hold at the time
p55095
aVOn the other hand
p55096
aVwhy not let it run until you know it should be cancelled
p55097
aVThen you just need to check for cancellation (there is a flag for this) every [n] iterations
p55098
as(dp55099
g18
V23354
p55100
stp55101
a((dp55102
g2
(lp55103
VYou can always set the , so yes this is safe
p55104
aVThe "dynamic" you describe only influences the default : whether it hard-coded or comes from config
p55105
aVSo indeed, this is moot if you are supplying this yourself
p55106
aVThe awkward bit here is that it also sets  based on what it finds - so it would be worth setting this manually so you know the value
p55107
as(dp55108
g18
V23354
p55109
stp55110
a((dp55111
g2
(lp55112
V is implemented, IIRC, as a wrapper around an , of which the default implementation is
p55113
aVTherefore a  has at least one more abstraction than a , but in general this won't be a bottleneck
p55114
aVIn fact, you might consider returning
p55115
aVEdit: here is the constructor of , courtesy of reflector:
p55116
aVso indeed, this wraps a layer of abstraction
p55117
aVThe plus side of this is that you can add your own validation etc by subclassing  (which is not possible when using  directly or via subclassing, since there are no interesting  methods)
p55118
aVThe other thing to consider is that they will have the same overall performance in terms of "O" (assuming you use the default  implementation)
p55119
aVIndexer lookup will be , etc
p55120
as(dp55121
g18
V23354
p55122
stp55123
a((dp55124
g2
(lp55125
V and  have the same operator precedence, under 7
p55126
ag5115
aV1 so the two results should be the same (using  rules)
p55127
aVI, however, can't be bothered to learn precedence tables; I just use brackets
p55128
aVThen it works in any language without needing to remember it
p55129
aVAnother important question is the rounding in the final  cast: do you expect that to be "up", "down" or "bankers"
p55130
as(dp55131
g18
V23354
p55132
stp55133
a((dp55134
g2
(lp55135
VA pain, isn't it
p55136
aVThat is all you can do with , unless you implement  (which I do not recommend)
p55137
aVOptions:
p55138
aVstick with that, but also mark  as  - that will stop it appearing in most data-binding views, and in the code-editor when referencing your assembly as a dll
p55139
aVuse , which supports private properties (but which doesn't support xml attributes; you can't win
p55140
aVbtw, I'd have  as a property, not a field:
p55141
as(dp55142
g18
V23354
p55143
stp55144
a((dp55145
g2
(lp55146
VThe dynamic linq sample can do much of this, except you drop the lambda notation:
p55147
aVAnother example (from the blog):
p55148
as(dp55149
g18
V23354
p55150
stp55151
a((dp55152
g2
(lp55153
VHow about this, which displays the same text in the debugger and :
p55154
aVOr if you need to use  for something else:
p55155
as(dp55156
g18
V23354
p55157
stp55158
a((dp55159
g2
(lp55160
VI don't think you could drop a packet, as obviously any thread is going to dereference to either the old or new
p55161
aVThe edge-case is that you get more data arrive in  after you think you've swapped them, or you could also end up not noticing the reference change  in the  loop (but: with 2 threads, the only thread that changes the reference is this thread, so not necessarily a problem)
p55162
aVTBH, if you have 2 threads here, why not just  or use
p55163
aVIt will be a lot simpler to figure out what happens when
p55164
as(dp55165
g18
V23354
p55166
stp55167
a((dp55168
g2
(lp55169
V and  change the current working path, which is very annoying
p55170
aVYou can either reset this manually, or set  to get it to change back after selecting the file
p55171
aVIf you are using  you'll have to do it manually if you still get this issue
p55172
as(dp55173
g18
V23354
p55174
stp55175
a((dp55176
g2
(lp55177
VSince LINQ-to-SQL supports TSQL via ExecuteQuery - why re-write something that works
p55178
aVComplex queries may well deserve a bit of hand-cranking
p55179
aVI would just leave "as is", and simply substitute:
p55180
aVwhich will be injected when you call
p55181
as(dp55182
g18
V23354
p55183
stp55184
a((dp55185
g2
(lp55186
VUsually the problem in this scenario is an event holding a reference to another object
p55187
aVfollows the underlying field back to the object and boom
p55188
aVIf you can find the offending event you can use (for a "field-like" event):
p55189
aVor for an explicit implementation, add  to the backing field
p55190
aVAlternatively; use something other than  ;p Json or xml make simple formats that you can use via a string, or for larger / more complex objects there are other binary serialization formats
p55191
as(dp55192
g18
V23354
p55193
stp55194
a((dp55195
g2
(lp55196
VWell, how would he know the seed
p55197
aVUnless he knew the exact time you ran the code, that is very hard to do
p55198
aVBut if you need stronger, you can also create cryptographically strong random numbers via  - something like:
p55199
as(dp55200
g18
V23354
p55201
stp55202
a((dp55203
g2
(lp55204
VYou can use  to help here:
p55205
as(dp55206
g18
V23354
p55207
stp55208
a((dp55209
g2
(lp55210
VI suspect you mean  instead of  in the sub-query; the outermost  (i
p55211
ag50
aVthe second ) expects a predicate expression, but yours is currently a selector - try:
p55212
as(dp55213
g18
V23354
p55214
stp55215
a((dp55216
g2
(lp55217
VDo you get the value of you  in TSQL
p55218
aVI wonder if refactoring the TSQL would help (and using :
p55219
aVso change:
p55220
aVto:
p55221
aV(I would also change the other  to )
p55222
aVAs a minor optimisation, you could also use:
p55223
aVbut this side of things should have worked "as is" from what I can see (hence why I'm focusing on the TSQL)
p55224
as(dp55225
g18
V23354
p55226
stp55227
a((dp55228
g2
(lp55229
VFrom the comments and downvote, maybe I should highlight my main point here: something that can save me hours of work (per type) and horrible code complexity is very much not redundant, but very, very welcome
p55230
aVquite easy"
p55231
aVOK; I'm pretty experienced at serialization, but the implementation for that is not what I call easy
p55232
aVQuite the contrary, in fact
p55233
aVIf you don't want to use attributes, there is an overload for  that allows you to configure it at runtime
p55234
aVBut I shudder whenever I hear "implement "
p55235
aVThe attribute approach is very quick and easy:
p55236
aVI challenge you to write a robust implementation of  for that very simple example in under 2 hours
p55237
aVand remember that every line you write is a line you have to maintain
p55238
as(dp55239
g18
V23354
p55240
stp55241
a((dp55242
g2
(lp55243
VI use them in serialization, with things like  or protobuf-net which support this usage ( doesn't)
p55244
aVIt is useful if you need to simplify an object as part of serialization:
p55245
as(dp55246
g18
V23354
p55247
stp55248
a((dp55249
g2
(lp55250
VAs a simple example; it is a cheap way of making an "immutable enough" object (for use in threading, state, etc)
p55251
aVBut also anywhere where the client simply shouldn't need to assign it, or can't be trusted to assign it (correctly)
p55252
aVAnother example might be a list:
p55253
aVsince we might call  etc, but we would rarely assign
p55254
aVHowever, this example is marred by needing explicit initialization in the constructor, and  hates it - to be honest for lists I mainly use:
p55255
aVwhich solves both of these
p55256
aVAs another example, contrasting:
p55257
aVvs
p55258
aVthis pattern may be useful in serialization, for example with  (with the addition of some attributes), since many serializers will still look for private accessors
p55259
aVThis avoids us having to decorate our internal state (), but gives the veneer of privacy to the
p55260
aVUltimately anything can be bypasses and assigned via reflection, so private  is only intended to avoid accidental damage to data
p55261
as(dp55262
g18
V23354
p55263
stp55264
a((dp55265
g2
(lp55266
VThe garbage collector is non-deterministic, and responds to memory pressure
p55267
aVIf nothing requires the memory, it might not collect for a while
p55268
aVIt can't optimize away the , as that changes your code: the constructor could have side-effects
p55269
aVAlso, in debug it is even more likely to decide not to collect
p55270
aVIn a release/optimized build, I would expect this to collect at some point when there is a good reason to
p55271
aVThere is also , but that should generally be avoided except for extreme scenarios or certain profiling demands
p55272
aVAs a "why" - there is a difference in the GC behaviour between GC "generations"; and you have some big arrays on the "large object heap" (LOH)
p55273
aVThis LOH is pretty expensive to keep checking, which may explain further why it is so reluctant
p55274
as(dp55275
g18
V23354
p55276
stp55277
a((dp55278
g2
(lp55279
VAnonymous types, like any type, are scoped to their containing assembly
p55280
aVThe compiler can only treat as equal if the two adapters are in the same dll (actually, module IIRC)
p55281
aVBeyond that, I would check the types
p55282
as(dp55283
g18
V23354
p55284
stp55285
a((dp55286
g2
(lp55287
VCompiled code, or reflection
p55288
aVAs a delegate, you can just use:
p55289
aVor to track the specific object:
p55290
aVWith reflection you would need  and
p55291
as(dp55292
g18
V23354
p55293
stp55294
a((dp55295
g2
(lp55296
VNote that  is not a generic method - it is a non-generic method of a generic type
p55297
aVOtherwise  and  would help
p55298
aVYou could obtain the generic type definition () and work back up to , but I wonder if you are approaching this problem the hard way
p55299
aVUsually, if you are using reflection, it may be pragmatic to drop to non-generic  - unless you need the type data (for example, for meta-programming)
p55300
aVAnd in that case, I would consider looking closely to see if you can simplify the setup here
p55301
as(dp55302
g18
V23354
p55303
stp55304
a((dp55305
g2
(lp55306
VIn IL, this is possible
p55307
aVIn C#: no
p55308
aVYou can use  to run a method in a type before that type's ctor, but it is discouraged and risky
p55309
aVBut:
p55310
aVIt is a bad idea because you can't guarantee that the subclasses are ready for the method-call
p55311
as(dp55312
g18
V23354
p55313
stp55314
a((dp55315
g2
(lp55316
VIn the metadata (be is SOAP or MEX), they are just repeated elements
p55317
aVThe proxy-generation tool can choose to interpret that in a variety of ways, and generally provide options to control this (in the advanced page in VS, IIRC - or at the command line)
p55318
aVSerialization should still be fine
p55319
as(dp55320
g18
V23354
p55321
stp55322
a((dp55323
g2
(lp55324
VLambdaExpression and PropertyDescriptor site largely in different worlds (much to my initial frustration)
p55325
aVLambdaExpression is going to be interested in PropertyInfo, not PropertyDescriptor
p55326
aVIf you have the PropertyInfo, you can construct an Expression via:
p55327
aVYou can also attempt to resolve by name, but this is not necessarily the same, especially if you are using a custom type model ( etc):
p55328
as(dp55329
g18
V23354
p55330
stp55331
a((dp55332
g2
(lp55333
VHere's an implementation that assumes you are attempting serialization; no idea if this is what you want, though; it prefixes the dimensions, then each cell using basic encoding:
p55334
as(dp55335
g18
V23354
p55336
stp55337
a((dp55338
g2
(lp55339
s(dp55340
g18
V23354
p55341
stp55342
a((dp55343
g2
(lp55344
VWell, any code can throw an exception, so "never" is strong
p55345
aVfor example, , , or some other exception that indicates resource saturation (for example, it somehow can't start the async operation)
p55346
aVIt might (although I haven't tested) also throw immediately if that is a write-only stream
p55347
aVAnd it will certainly throw immediately if  turns out to be
p55348
aVHowever
p55349
aVIn all the cases I've mentioned, the correct behaviour is probably to let it bubble up; they all indicate pretty fundamental problems unrelated to the current logic
p55350
aVSo no: I wouldn't / here unless there was something specific I expected and wanted to handle somehow
p55351
as(dp55352
g18
V23354
p55353
stp55354
a((dp55355
g2
(lp55356
VIt'll certainly work, and that approach is used in a few places in the core framework - AssemblyResolve etc
p55357
aVAlternative approaches here:
p55358
aVif it is used by a method, pass it into the method as a callback delegate
p55359
aVSame approach, but simply not exposed as an
p55360
aVditto, but with an interface
p55361
aVbut it'll work that way
p55362
aVIt isn't unheard of
p55363
aVCode tweaks, though:
p55364
aVyou subscribe on the instance (unless it is static), and need , not
p55365
aVAlso: consider using  rather than declaring your own delegate type
p55366
as(dp55367
g18
V23354
p55368
stp55369
a((dp55370
g2
(lp55371
VYou can't change a type at runtime
p55372
aVExpando might be an option, but I am not clear how you want to interact with this object, as you would seem to be limited to reflection, and expando is not a huge friend of reflection
p55373
aVIt might help to clarify your requirement here, but IMO you might do better to consider loading (at runtime) a property-bag based on reflection from the two inputs; something like a  which would let you map named keys to values
p55374
aVOne other thing that might be what you are after here is  classes, but this is a single type spread over multiple source files:
p55375
aVA final option here is , but that is massive overkill in most scenarios
p55376
as(dp55377
g18
V23354
p55378
stp55379
a((dp55380
g2
(lp55381
V(repeat for all known subtypes)
p55382
aVIf the types are only known at runtime, you can supply them to the  constructor, but: then it is important to cache and reuse that serializer instance; otherwise you will haemorrhage dynamically created assemblies
p55383
aVIt does this automatically when you use the constructor that just takes a , but not for the other overloads
p55384
as(dp55385
g18
V23354
p55386
stp55387
a((dp55388
g2
(lp55389
Vsounds like what you want; returns , returning  as soon as a match is found, else
p55390
aVThere is also:
p55391
aVwhich behaves in a similar way, returning  as soon as a non-match is found, else
p55392
as(dp55393
g18
V23354
p55394
stp55395
a((dp55396
g2
(lp55397
VThe  will be used by , and won't work "as is"; try something like:
p55398
aVwhich should provide the necessary equality conditions for hash-codes
p55399
aVPersonally, I would also unroll the equality test for performance:
p55400
as(dp55401
g18
V23354
p55402
stp55403
a((dp55404
g2
(lp55405
VIt is hard to limit to just numerics, since there is nothing common like  to use as the filter
p55406
aVActually, I suspect the easiest approach here is to not insist on the constraint, and use  inside the method
p55407
aVThis inbuilt type supports both the generic  and the non-generic , and supports ref-types, value-types and lifted usage via
p55408
aVFor full operator usage, look at MiscUtil's  class and  etc, which may be useful if you really want to use the operator (rather than the interface)
p55409
aVIt also provides access to the other operators like  etc
p55410
as(dp55411
g18
V23354
p55412
stp55413
a((dp55414
g2
(lp55415
VAs has been mentioned, you cannot parameterise the fundamental query, so you will have to build the query itself at runtime
p55416
aVYou should white-list the input of this, to prevent injection attacks, but fundamentally:
p55417
aVThis way  is still parameterised etc
p55418
as(dp55419
g18
V23354
p55420
stp55421
a((dp55422
g2
(lp55423
s(dp55424
g18
V23354
p55425
stp55426
a((dp55427
g2
(lp55428
VIt is an unusual usage, for sure; it doesn't really use the , except for
p55429
aVI can see how it may be more useful if you were combining that with generic constraints, but "as is" I'd be tempted to pass a  instance in as the argument
p55430
aVBTW, the usage of  is incorrect here; you are testing whether the  type implements  etc, which will never be true (unless you are doing something very unusual); you probably mean to test whether the type represented implements the interface
p55431
aVPerhaps
p55432
as(dp55433
g18
V23354
p55434
stp55435
a((dp55436
g2
(lp55437
Vsomething like:
p55438
aVthat should then give you the data via  and
p55439
as(dp55440
g18
V23354
p55441
stp55442
a((dp55443
g2
(lp55444
VSomething like:
p55445
aVNote this will include other sub-sub-types too
p55446
as(dp55447
g18
V23354
p55448
stp55449
a((dp55450
g2
(lp55451
VAs long as you call  on the lambda and store (and re-use) the delegate, you only pay the reflection price once
p55452
aVHowever, to get a naked delegate to just that method, you can use:
p55453
aVof course, then you are forced to provide the constants at the caller
p55454
aVAnother option is , but as long as you are caching the final delegate, this won't be significantly faster
p55455
aVIt does offer more flexibility (at the price of complexity), but that doesn't seem to be the issue here
p55456
as(dp55457
g18
V23354
p55458
stp55459
a((dp55460
g2
(lp55461
VWhat exactly happens
p55462
aVUltimately you are just building a string here and storing into , so it should work fine, provided:
p55463
aVyou have correctly parametrized the input to the command
p55464
aVyou haven't overflown the width of the the column
p55465
aVWe can't really say more without seeing , which I assume talks to the database
p55466
aVI'm also not quite sure why a "list" method would be doing inserts in the first place, of course
p55467
aVPlus since everything is commented out at the moment, I would expect nothing to happen
p55468
as(dp55469
g18
V23354
p55470
stp55471
a((dp55472
g2
(lp55473
VYes, you can change the file templates (or simply provide secondary file templates), like so
p55474
aVHowever,  before you do that, I would ask myself: does it really take that much effort to add the desired accessibility
p55475
aVI tend to err on the side of the pragmatic when it comes to this
p55476
aVif I wanted significantly different templates, I might do it
p55477
aVOtherwise
p55478
aVmeh
p55479
as(dp55480
g18
V23354
p55481
stp55482
a((dp55483
g2
(lp55484
VIf duplicate keys is an issue, perhaps you mean
p55485
aVSame principal, but multiple values per key
p55486
aVThen you simply do something like:
p55487
aVor use  of course ()
p55488
as(dp55489
g18
V23354
p55490
stp55491
a((dp55492
g2
(lp55493
Vwith test:
p55494
aV(which works)
p55495
aVBut tbh, Just use  in place of ; this is largely a hangover from something that never really worked
p55496
aVOr better; a specific type of delegate (perhaps )
p55497
as(dp55498
g18
V23354
p55499
stp55500
a((dp55501
g2
(lp55502
VThere is a trick here, that I have used before; you do something like an , and embed the fetch-by-index and casting inside the expression
p55503
aVThen you have as many parameters as you could want, a single signature, and reasonable performance
p55504
aVIt does, however, make writing the lambda a bit tricker
p55505
aVI don't have my old code for this "to hand", but if I needed to reverse engineer it, I would simply write something typical like the following, and then look in reflector to see what it used:
p55506
aV(in particular, paying attention to the indexer usage, the casting from inputs, and the casting to output)
p55507
as(dp55508
g18
V23354
p55509
stp55510
a((dp55511
g2
(lp55512
VIf it was , you might choose to expose  as the :
p55513
aVFor non-generic data you might choose to use the non-generic ; however, in the core framework it is fairly routine to use  as a , as this allows use of both  and  (an abstraction around obtaining a list)
p55514
as(dp55515
g18
V23354
p55516
stp55517
a((dp55518
g2
(lp55519
VThe core WCF is designed to send data, not queries
p55520
aVStick to returning  etc; it'll save you much head-scratching
p55521
aVHowever, you might have more luck doing what you are after with WCF Data Services, which allows you to expose  sources
p55522
aVThe way this works is that the tooling builds a client that exposes similar looking  hooks; when you query data, it represents the expression on the wire, queries the data and brings it back to the client
p55523
aVBut it is still the results (not the query) that goes over the wire
p55524
as(dp55525
g18
V23354
p55526
stp55527
a((dp55528
g2
(lp55529
VCaspol "tweaks" are a bit of a pain to deploy robustly
p55530
aVIMO, the best way to run an exe off the network is in a way that the core framework isn't going to object to in the first place
p55531
aVSince you have 3
p55532
aV5 SP1, one simple way is to map the share to a drive
p55533
aVIIRC, with this service pack, "j:\u005ctest
p55534
aVexe" will be trusted, even though "j:" is mapped to "\u005chostname", and "\u005chostname\u005ctest
p55535
aVexe" might not be trusted
p55536
aVThe other approach is ClickOnce; you publish to the network share and run "test
p55537
aVapplication" instead
p55538
aVThis also gives you options like local-copy with auto-update, file extension handling, etc
p55539
as(dp55540
g18
V23354
p55541
stp55542
a((dp55543
g2
(lp55544
VI wonder if thinking in terms of  would help your processing here; then  is  (or at least, null-ish)
p55545
aVStill not quite , but closer than , and it extends naturally to all value types
p55546
as(dp55547
g18
V23354
p55548
stp55549
a((dp55550
g2
(lp55551
VFor , you will generally be OK as long as the severity is high enough; however, be careful if you are reading data; for example, if you have a stored procedure that returns multiple grids and throws an exception (for example) just before the penultimate result-set, then if you don't iterate over the data you may never see the error
p55552
aVThis is because the error is injected into the TDS stream (not out-of-band)
p55553
aVYou need to consume the TDS at least as far as the error for your code to become aware of it
p55554
aVSomething as simple as (in the case of ):
p55555
aVafter your consuming code will ensure you consume the entire inbound TDS stream
p55556
as(dp55557
g18
V23354
p55558
stp55559
a((dp55560
g2
(lp55561
VThey are usually interpreted broadly as:
p55562
aV(etc for your choice of operator)
p55563
aVhowever; some languages allow you to have a bespoke += operator*, or may interpret it differently in some scenarios; for example, in C# events, += and -= mean "subscribe via the add accessor" and "unsubscribe via the remove accessor" respectively
p55564
aVTypically they are just space savers, but there can be semantic differences in some cases
p55565
aV*=where I mean: very different to just the  operator and assignment
p55566
as(dp55567
g18
V23354
p55568
stp55569
a((dp55570
g2
(lp55571
VYou haven't rewound the , and you don't even know that the writer has flushed to the stream
p55572
aVI would have something more like:
p55573
aVActually, I might even serialize to a  instead; save some encoding/decoding overhead:
p55574
as(dp55575
g18
V23354
p55576
stp55577
a((dp55578
g2
(lp55579
VThat sounds more garbage collection, not
p55580
aVif  is disposable and needs to be disposed when the  instance is disposed (usually via ), you could have:
p55581
aVYou can do something related with finalizers, but that is not a good idea here
p55582
as(dp55583
g18
V23354
p55584
stp55585
a((dp55586
g2
(lp55587
VI can't help thinking that is simply the wrong way to do it
p55588
aVand it reaks of security abuse
p55589
aVIs there no better way you could do this
p55590
aVPerhaps hosting the page in a  control and using an  object (of your devising) so you can talk to the C# app from javascript
p55591
as(dp55592
g18
V23354
p55593
stp55594
a((dp55595
g2
(lp55596
VThat looks like jQuery autocomplete to me, with  set to  and  set to space ()
p55597
as(dp55598
g18
V23354
p55599
stp55600
a((dp55601
g2
(lp55602
VThat is impossible to answer without knowing how you are using it and what data you are storing
p55603
aVFor example, if you are using it as the  provider (if you are using ASP
p55604
aVNET), and you were previously using the in-process cache provider, then it will behave very differently; the in-process provider has no serialization or network costs, so you might be storing some insanely large objects in the cache
p55605
aVThat is fine when it is in-process, but for any other provider this is very very bad; you will have to transfer and deserialize for every usage (and serialize and transfer for every storage)
p55606
aVThere are ways to improve the serialization/deserialization/network times, but it sounds like you are simply storing too much data (or inappropriate data) in the cache at the moment
p55607
aVI'd address that first, and then look at tuning it
p55608
as(dp55609
g18
V23354
p55610
stp55611
a((dp55612
g2
(lp55613
VThe simplest is just
p55614
aVThe advantage(s) of this (over ) is that you can pass multiple parameters, and you get compile-time checking without needing to cast from  all the time
p55615
as(dp55616
g18
V23354
p55617
stp55618
a((dp55619
g2
(lp55620
VRe:
p55621
aVYou can't call static methods of the type-parameter, if that is what you mean
p55622
aVYou would do better to refactor that as an instance method of , perhaps with a generic constraint (, with  defining )
p55623
aVAnother alternative is , which allows duck-typing of instance methods (via signature)
p55624
aVIf you mean that the  is only known at runtime (as a ), then you would need:
p55625
as(dp55626
g18
V23354
p55627
stp55628
a((dp55629
g2
(lp55630
VThere is an overload (note that this is obsoleted in 4
p55631
aV0)
p55632
aVor in 4
p55633
aV0 this one
p55634
as(dp55635
g18
V23354
p55636
stp55637
a((dp55638
g2
(lp55639
VA bad idea IMO
p55640
aVThe biggest problem would be concurrency
p55641
aVThanks to connection-pooling, the costs aren't that much as long as you use the data-context as a pipe for data, not the data bucket itself
p55642
aVCache the data; throw away the data-context
p55643
aVAttempting to hold onto the data-context additionally doesn't scale out to multiple servers, or support any cache implementation except in-process
p55644
aVHave you measured the setup costs so that you know whether this is worth considering
p55645
aVI really don't believe that is your bottleneck
p55646
as(dp55647
g18
V23354
p55648
stp55649
a((dp55650
g2
(lp55651
VEven with LINQ-to-XML you should be querying by name, so I'm not sure why the absence of any particular tag should "jumble up the enumeration" - simply; you might have some nulls, i
p55652
ag50
aVYou can't cast an arbitrary  to an , but if you are sure it is an element, casting to  should provide what you need
p55653
aVNote also that when value nodes may be missing, you might find it easiest to use the conversion operators:
p55654
aVif  doesn't exist, this will return an empty  - same approach works for most common value-types, or for strings just convert to
p55655
as(dp55656
g18
V23354
p55657
stp55658
a((dp55659
g2
(lp55660
VCurrently, you do a ,  and  of the fixed value per item; (the  etc being relatively expensive); you can lift this out:
p55661
aVI'm assuming here that  is trivially cheap
p55662
aVIf this is actually an expensive property to query, you can use  to minimise the calls:
p55663
as(dp55664
g18
V23354
p55665
stp55666
a((dp55667
g2
(lp55668
VIf the main page is a POST (with data in the form), then the url won't contain the form fields
p55669
aVYou could choose to check for this and redirect if missing
p55670
aVThis is a bit hacky though, and you should aim to use GET for the idempotent requests, and POST for mutation requests
p55671
as(dp55672
g18
V23354
p55673
stp55674
a((dp55675
g2
(lp55676
VI would guess that it simply isn't setting the content type correctly
p55677
aVWhat does a network trace (fiddler, etc) show
p55678
aVPerhaps try using  instead of
p55679
aVAlso;  be careful - many of those  look unsafe, i
p55680
ag50
aVnot html-encoded
p55681
as(dp55682
g18
V23354
p55683
stp55684
a((dp55685
g2
(lp55686
VYet another reason that mutable structs are evil
p55687
aVOne workaround is to expose the dimensions as accessors for convenience:
p55688
aVBut other that this; yes you would need to do the  each time, since  is a struct
p55689
aVWhen you access it via a property you get a copy of it, so if you mutate the copy and then discard the copy, you simply lose the change
p55690
as(dp55691
g18
V23354
p55692
stp55693
a((dp55694
g2
(lp55695
VIt performs the actions until they are complete
p55696
aVIn your case, each action is to call  - and that has completed; however, there is no guarantee that each of thses tasks has been queued/processed yet
p55697
aVThe difference is the  (which you haven't called in your  example)
p55698
aVOne option here would be to reduce this to:
p55699
as(dp55700
g18
V23354
p55701
stp55702
a((dp55703
g2
(lp55704
VThe first thing I would try is (where  is ):
p55705
aVIf that fails, perhaps:
p55706
aVNote also that the behaviour may change slightly depending on whether  is specified
p55707
as(dp55708
g18
V23354
p55709
stp55710
a((dp55711
g2
(lp55712
VI believe the problem is here:
p55713
aVNeither  nor  is a valid name for an xml element
p55714
aVThen of course, if you use this (doomed) method to log the error
p55715
aVstack overflow
p55716
as(dp55717
g18
V23354
p55718
stp55719
a((dp55720
g2
(lp55721
VThe fact that:
p55722
aVIs defined after all the body should be the clue; essentially, you simply aren't even looking at the object you pass in; you are only looking at , which is (in your code) simply an unassigned variable
p55723
aVBasically, drop the final  declaration, and don't declare  as a variable:
p55724
as(dp55725
g18
V23354
p55726
stp55727
a((dp55728
g2
(lp55729
VYou should be able to use  to get an  of them
p55730
aVAssuming there is come commonality
p55731
aVOtherwise; perhaps just
p55732
aV(non-generic)
p55733
as(dp55734
g18
V23354
p55735
stp55736
a((dp55737
g2
(lp55738
VI think you just described CodeDOM
p55739
aVUnfortunately, it doesn't really (IMO) make it easier - it just makes it
p55740
aVdifferent
p55741
aVPersonally, I'd just use ,  and encapsulate the common functionality I need, i
p55742
ag50
aVMeta-programming is rarely simple, but from that detail you get a very good understanding of what is actually happening
p55743
as(dp55744
g18
V23354
p55745
stp55746
a((dp55747
g2
(lp55748
VIt is for neither - Silverlight is simply the branding for the runtime engine, library set, etc
p55749
aVThe only thing that "uses" Silverlight directly is (broadly speaking) the browser
p55750
aVThe important thing for developers is Visual Studio (regular or Express:Web), and for designers: the Expression suite
p55751
aVBoth can contribute to a Silverlight project
p55752
aVAlso consider that you may be targeting Moonlight, so even "Silverlight" becomes misleading
p55753
as(dp55754
g18
V23354
p55755
stp55756
a((dp55757
g2
(lp55758
VThe easiest way to do that is to take an  instead; this is then trivial to pull apart
p55759
aVIn fact, you can just lift my code from here which covers most scenarios
p55760
aVIn particular, look at
p55761
aVSome discussion/explanation for this is here
p55762
as(dp55763
g18
V23354
p55764
stp55765
a((dp55766
g2
(lp55767
s(dp55768
g18
V23354
p55769
stp55770
a((dp55771
g2
(lp55772
VIs that even legal
p55773
aVis not defined at that point
p55774
aVIIRC, this is a compiler bug -  already fixed in 4
p55775
ag190
aVHere it is in the 4
p55776
aV0 compiler:
p55777
aVError 1   Keyword 'this' is not available in the current context  C:\u005cUsers\u005cMarc\u005cAppData\u005cLocal\u005cTemporary Projects\u005cConsoleApplication1\u005cProgram
p55778
aVcs   22  40  ConsoleApplication1
p55779
aVTo quote 7
p55780
ag691
aV7:
p55781
aVA this-access is permitted only in the block of an instance constructor, an instance method, or an instance accessor
p55782
aVIt has one of the following meanings:
p55783
aV(emph mine)
p55784
aVUse of this in a primary-expression in a context other than the ones listed above is a compile-time error
p55785
aVIn particular, it is not possible to refer to this in a static method, a static property accessor, or in a variable-initializer of a field declaration
p55786
aVIn the example given, it it simply invalid
p55787
as(dp55788
g18
V23354
p55789
stp55790
a((dp55791
g2
(lp55792
V isn't , so that won't even compile
p55793
aVBut if it was disposable, yes  will do it, and  by itself won't
p55794
aVIt is an unusual usage, but I've seen similar
p55795
aVRarely
p55796
aVBased on your comment (main question), I suspect that you are confusing garbage collection and disposal
p55797
aVThere is no way to forcibly make something get collected, short of  (which you should not do)
p55798
aVUnless you have a really good reason to want it collected, just let it be - chances are it is "generation 0" and will be collected cheaply anyway
p55799
aVAlso, the "do whatever" suggests doing something in a constructor but not caring about the created object; a static method would be preferable:
p55800
as(dp55801
g18
V23354
p55802
stp55803
a((dp55804
g2
(lp55805
VFor testing
p55806
aVor real life
p55807
aVFor testing you can mock DateTime
p55808
aVNow (although it is easier to have an  interface)
p55809
aVFor real usage - I just wouldn't
p55810
aVOr do you just mean
p55811
as(dp55812
g18
V23354
p55813
stp55814
a((dp55815
g2
(lp55816
V is used to denote sub types, not base types (after all, the base-type is already known)
p55817
aVAlso, the  handling should largely be implicit; note that the "infer
p55818
aVetc do very little in the case of lists, since lists are just a sequence of the contained items
p55819
aVFor the following, I'm assuming that you are trying to serialize the list (as the top-most object):
p55820
aVI'm not on the right machine at the moment, but in the released dlls, I would expect that wrapping the list via an object would make it work:
p55821
aVIn "v2" I would hope that this scenario works from the outset
p55822
aVI'll try to test this tomorrow (when I'll have the right machine)
p55823
aVOne other thought; subclassing  isn't usually very useful, since none of the methods are virtual
p55824
aVUp to you, of course
p55825
aVAnd a final note - in "v2" we can describe the model externally if you want to have more control over the serialization but without impacting the types themselves
p55826
as(dp55827
g18
V23354
p55828
stp55829
a((dp55830
g2
(lp55831
VHow about:
p55832
aVThis uses generic type inference to handle the
p55833
as(dp55834
g18
V23354
p55835
stp55836
a((dp55837
g2
(lp55838
VIn normal usage,  and  are identical;  is simply an alias for
p55839
aVThere are some edge-cases, though:
p55840
aVyou need a  to use  - you don't for
p55841
aVif you define a local , then  refers to that (this would be a silly thing to do, of course)
p55842
aVYou can't define a class called  (although  is fine)
p55843
as(dp55844
g18
V23354
p55845
stp55846
a((dp55847
g2
(lp55848
VUltimately the case isn't going to make any difference (unless it collides with a type/keyword/etc)
p55849
aVSo really consistency is the main thing
p55850
aVThe Capitalization Conventions don't distinguish between constants and other members - but these are guidelines only
p55851
aVSo it would be pascal-case
p55852
as(dp55853
g18
V23354
p55854
stp55855
a((dp55856
g2
(lp55857
VThis is quite hard to look at in isolation, but the first thing that occurs is that  looks out of place for  - that will rarely work (LINQ-to-Objects being the exception)
p55858
aVAn equivalent to  is to use  to call a sub-expression, but even this is flakey: LINQ-to-SQL will support it, EF (in 3
p55859
aV5 at least) doesn't (maybe "didn't"; I haven't re-checked in 4
p55860
aV0)
p55861
aVUltimately, it would be more robust to create  as an  if possible:
p55862
aVThen pass this to :
p55863
as(dp55864
g18
V23354
p55865
stp55866
a((dp55867
g2
(lp55868
VLooking here, you need a reference to  - you mention a  directive, but it isn't clear whether you have a reference
p55869
aVTry adding that if missing
p55870
as(dp55871
g18
V23354
p55872
stp55873
a((dp55874
g2
(lp55875
V and  mean (respectively) the start and end of the input text (or line in multi-line mode) - generally used to check that the entire text (or line) matches the pattern
p55876
aVSo if you don't want that, take them away
p55877
as(dp55878
g18
V23354
p55879
stp55880
a((dp55881
g2
(lp55882
VJust for completeness beyond Jon's point, another point here is that in many (not all) scenarios the data-contract is generated from some kind of model (dbml, EF, wsdl, proto, etc)
p55883
aVAs such, there is no real additional cost to explicit properties, and explicit properties work on more language versions
p55884
aVAdditionally, the template code might include partial methods to allow pre/post operations, and other framework code
p55885
aVThat part of the template may have been omitted from the published example for brevity
p55886
aVFinally, data-contracts can optionally be specified against the field, allowing read-only properties etc:
p55887
as(dp55888
g18
V23354
p55889
stp55890
a((dp55891
g2
(lp55892
V is  deserialization operation (it is used to read a stream as a delta into an existing object)
p55893
aVFortunately, protobuf sequences are simply additive, so all you need to do is open the stream for append (or manually move to the end of the stream), and then call
p55894
as(dp55895
g18
V23354
p55896
stp55897
a((dp55898
g2
(lp55899
VWell, if your meaning of "version" is simply as a data-field, then sure; just add it as a serialized member
p55900
aVNote that this won't have any special meaning during serialization (running it through an alternative contract, for example) - although as an aside there might be options here in "v2" if you need to support radically different message structures (a bad idea anyway)
p55901
aVThe only caveat I might add is that any existing data that didn't already include this number will claim to be "version 1"
p55902
aVIn "v2" another option is to use the WCF approach of skipping the constructor (if you require)
p55903
aVThis will mean that these cases default instead to "version 0" - perhaps less confusing (or perhaps more confusing; I'll let you decide)
p55904
as(dp55905
g18
V23354
p55906
stp55907
a((dp55908
g2
(lp55909
VIt depends on the volume of data
p55910
aVThere are 2 options:
p55911
aVsend it to the client pre-emptively (perhaps as json or html) in the page source
p55912
aVlet the client query it based on their input
p55913
aVThe second is common if the data-volume is non-trivial, as you can query when (for example) they've entered 3 characters; very useful for names and other long lists
p55914
aVRe the web-service; this doesn't have to be a full/complex web-service; just a simple route or ashx (for example) that returns the filtered data
p55915
aVThe jquery autocomplete plugin supports both scenarios, although this is now partly obsoleted by jquery ui plugin
p55916
aVIs it possible to implement autocomplete by looking up values from database in code behind
p55917
aVWell, that is at the server - so you're essentially talking about the same "web service" that you say you can't do
p55918
aVI also think you should separate out the 2 functions (create page vs provide auto-complete results) into separate files (/pages/whatever)
p55919
as(dp55920
g18
V23354
p55921
stp55922
a((dp55923
g2
(lp55924
VThat won't even compile (definite assignment)
p55925
aVAs a method variable,  is local only to the declaring method(/scope) - i
p55926
ag50
aV, which explains why you can't retain values
p55927
aVIf  is meant to persist between calls, promote it to a field (per-instance variable):
p55928
as(dp55929
g18
V23354
p55930
stp55931
a((dp55932
g2
(lp55933
VIf I need to do this, I use resharper's "Replace Anonymous Type With Named Class" refactoring option
p55934
aVThen you have an appropriate named type to expose over the API, and you haven't had to do any work
p55935
aVThis also gives you options to create it immutable (like anonymous types) or mutable, nested vs top-level, etc
p55936
aVBTW, I don't recommend  here (from the question)
p55937
aVAnother option is to pass the behaviour into the method - i
p55938
ag50
aVan  - then do something like:
p55939
aVHowever, I don't like this as it is not obvious that there is a likely error in:
p55940
aV(the error being that it should probably be , if you see what I mean)
p55941
as(dp55942
g18
V23354
p55943
stp55944
a((dp55945
g2
(lp55946
VIt isn't implemented as an , so it doesn't count
p55947
aVHowever, implicit interface implementations do count, so this works:
p55948
as(dp55949
g18
V23354
p55950
stp55951
a((dp55952
g2
(lp55953
VWhy not just:
p55954
aVor even
p55955
as(dp55956
g18
V23354
p55957
stp55958
a((dp55959
g2
(lp55960
VI expect the inbuilt implementation simply uses  for simplicity
p55961
aVThe cleanest way I can think of cheating this is with a separate factory:
p55962
as(dp55963
g18
V23354
p55964
stp55965
a((dp55966
g2
(lp55967
Vprotobuf-net does what it can to adhere to the core protobuf spec, and then some (for example, it includes inheritance), however:
p55968
aVv1 is not very good at interface-based properties (i
p55969
ag50
aVetc); I'm working on getting this improved in v2
p55970
aVv1 likes there to be a parameterless constructor (this requirement is lifted in v2)
p55971
aVyou need to tell it how to map the model to fields; in v1 this needs to be decorated on the type (or there is an option to infer some things from the names etc); in v2 this can be done externally
p55972
aVin v1, flags enums are a pain; in v2 there is an option to pass-thru enums as raw integers, making it much more suitable for falgs
p55973
aVabstracts and inheritance are fine, but you must be able to determine all the concrete types ahead of time (to map them to integer keys)
p55974
aVgenerics should be fine
p55975
aVjagged arrays / nested lists without intermediate types aren't OK - you can shim this by introducing an intermediate type in the middle
p55976
aVnot all core types have inbuilt support (the new date/time offset types, for example); in "v2" you can introduce your own shims for this if necessary
p55977
aVit is a tree serializer, not a graph serializer; I have some thoughts there, but nothing implemented yet
p55978
aVIf there is some limited example of what you want to serialize, I'll happily take a look to see if it is likely to work (I'm the author)
p55979
as(dp55980
g18
V23354
p55981
stp55982
a((dp55983
g2
(lp55984
VA common issue here is the  options that are in play
p55985
aVThis is not obvious, since you rarely set them explicitly from either SSMS or ADO
p55986
aVNET, but they can be different
p55987
aVIn particular this can impact anything involving persisted indexed columns, sql xml, and a range of other behaviours; null-equality, concat-null, max-rows, schema-only (no data), interpretation of quotes, arith-abort, etc
p55988
aVSo: find what  options are in play
p55989
aVThis can be an even bigger problem is some misbehaving code (either in the DB or the calling client) sets an option for some purpose and doesn't set it back
p55990
aVEspecially if that code only runs occasionally
p55991
as(dp55992
g18
V23354
p55993
stp55994
a((dp55995
g2
(lp55996
VTips / warnings
p55997
aVIt can be a serious amount of code
p55998
aVI suggest it would be easier to write some simple code that transforms your existing model into a simple DTO that can be serialized trivially by your choice of existing serialization API
p55999
aVHaving a DTO layer (separate to the domain entities) also allows much simpler maintenance - you can refactor your domain entities without breaking the serialized data
p56000
aVThe options for doing it yourself (keeping in mind that you emphasised that the model is fairly complex, and you aren't bit-fiddlers):
p56001
aVwrite type-specific serialization manually; very easy to get wrong, very laborious
p56002
aVwrite a general purpose library; crazy amounts of work solving all the edge cases
p56003
aVAnd that is after you have figured out a serialization format that works robustly, extensibly, and supports the scenarios you need (inheritance, etc)
p56004
as(dp56005
g18
V23354
p56006
stp56007
a((dp56008
g2
(lp56009
VThis can be as simple as:
p56010
aVwhere  is the thing to find, however there is an ambiguity here over the definition of equality
p56011
aVBy default, classes will use reference-equality
p56012
aVI common mistake is creating two class instances that have identical fields, and expecting them to count as "equal"
p56013
aVTo do this, you should really override  (and ideally implement  for the same )
p56014
aVAnd if you override , you should also override , and ideally the / operators
p56015
aVAnother alternative is to find the match with a predicate or comparer, which can avoid all that work
p56016
as(dp56017
g18
V23354
p56018
stp56019
a((dp56020
g2
(lp56021
VUsually yes - reflection is just a runtime tool; however, it really depends on what you do with your release that is different to debug; for example:
p56022
aVdo you obfuscate
p56023
aVdo you merge (ilmerge etc)
p56024
aVdo you sign/strong-name them differently
p56025
aVdoes your release app run with the same privelege / security as in the debugger
p56026
aVany caspol differences: running from a network share, for eample
p56027
aVis the release framework version / platform the same
p56028
aVdoes your code have any intentional  /  or  sections
p56029
aVall of these can impact reflection
p56030
aVBut if all other variables are the same, then yes: reflection should be the same between debug and release
p56031
as(dp56032
g18
V23354
p56033
stp56034
a((dp56035
g2
(lp56036
VOne option here is to tell  to use the sync-context, like this - however, this is arguably not the best approach
p56037
aVI wonder if you could expose your data via an event or similar (rather than adding to the list directly) - then have your UI handle the event by sending to the right thread and adding to the UI model
p56038
as(dp56039
g18
V23354
p56040
stp56041
a((dp56042
g2
(lp56043
VWell,  is an option, but it is not a desirable one; it is pretty hard to write a robust implementation of anything non-trivial
p56044
aVIf having an immutable property is that important, then maybe consider having a separate DTO implementation - i
p56045
ag50
aVone set of simple, mutable classes for persistence, which you translate into your domain entities
p56046
aVAlternatively, some other serializers may help; for example,  will work on private fields:
p56047
as(dp56048
g18
V23354
p56049
stp56050
a((dp56051
g2
(lp56052
VIf there is a name abiguity - just use  /  (instance),  (static) or  (the type)
p56053
aVOr in really nasty cases,
p56054
aVThis works just fine and matches the question (I think):
p56055
as(dp56056
g18
V23354
p56057
stp56058
a((dp56059
g2
(lp56060
V is a list of anonymous types, each with a member () that is an enumerable set of  records
p56061
aVYou should be able to use SelectMany here:
p56062
aVor (identical):
p56063
as(dp56064
g18
V23354
p56065
stp56066
a((dp56067
g2
(lp56068
VDo you need the  flexible model
p56069
aVPretty easy with reflection:
p56070
aVOr to do the whole thing:
p56071
as(dp56072
g18
V23354
p56073
stp56074
a((dp56075
g2
(lp56076
VI would still be inclined to use serialization
p56077
aVBut rather than having to know the binary, just create an expected graph, serialize that
p56078
aVNow serialize the actual graph and compare bytes
p56079
aVThis is only useful to tell you that there is a difference; you'd need inspection to find what, which is a pain
p56080
as(dp56081
g18
V23354
p56082
stp56083
a((dp56084
g2
(lp56085
VTo go down this route, you would need to create a custom  per property
p56086
aVYou would then expose that via a custom , or (alternatively) /
p56087
aVExample:
p56088
as(dp56089
g18
V23354
p56090
stp56091
a((dp56092
g2
(lp56093
V does support , but it uses it during serialization
p56094
aVDuring deserialization, it simply runs the constructor, then takes incoming values and applies them
p56095
aVA common approach, then, is to use the constructor (or field-initializers):
p56096
aVHowever; 's interpretation of this is not "supply an empty element" - but rather "omit the element(/attribute)"
p56097
aVEven  doesn't map to "empty"
p56098
aVTo handle empty elements, you would have to handle it as a string
p56099
aVWhich is ugly
p56100
as(dp56101
g18
V23354
p56102
stp56103
a((dp56104
g2
(lp56105
VIt sounds like you have a local property called
p56106
aVTry using  instead
p56107
as(dp56108
g18
V23354
p56109
stp56110
a((dp56111
g2
(lp56112
VThe addition of the selector inside is a pain, but ultimately you could take a  , and pass in  or  as the delegate instance
p56113
aVTo do this without duplicating the  selector would require doing the selector first, i
p56114
ag50
as(dp56115
g18
V23354
p56116
stp56117
a((dp56118
g2
(lp56119
VThe key problem in this is that you are accessing a reference field during a finalizer
p56120
aVThe underlying problem is that the  itself has (or can be, unpredictably) already been collected (since collection order is non-deterministic)
p56121
aVSimply: the  no longer exists, and you are query  /  etc on a ghost object
p56122
aVSo accessing this object at all is unreliable and brittle
p56123
aVFinalizers should only talk to direct value-type state - handles, etc
p56124
aVAny reference (unless you know it will always out-live the object being destroyed) should be treated with distrust and avoided
p56125
aVIf instead, we pass in the  and ensure that the  is not collected, then everything works fine; the following should show one success (the one where we've passed in the ), and one fail (where we've created the  just for this object, thus it is eligible for collection at the same time as the object):
p56126
aVWhat makes you say it isn't collected
p56127
aVIt looks eligible
p56128
aVno field on a live object holds it, and the variable is never read past that point (and indeed that variable may well have been optimised away by the compiler, so no "local" in the IL)
p56129
aVYou might need a  at the bottom of  to stop it
p56130
as(dp56131
g18
V23354
p56132
stp56133
a((dp56134
g2
(lp56135
VEntity-models / data-contexts / etc are best handled as units of work
p56136
aVIf you need to cancel it, simply discard the context and start with a new one
p56137
aVAnd if you succeed, discard it anyway
p56138
aVEach request should really be using separate data-contexts, otherwise you can get a range of problems:
p56139
aVthreading (although it sounds you've avoided this by making it single-threaded)
p56140
aVdata growth (there is an identity manager; every row you touch stays around; multiple times, in fact)
p56141
aVgeneral isolation etc
p56142
aVconnection lifetime management (hogging an open connection)
p56143
aVetc
p56144
as(dp56145
g18
V23354
p56146
stp56147
a((dp56148
g2
(lp56149
VWell, you can cast to/from  (or the defined underlying type, which defaults to ), but this is brittle; it doesn't protect you when somebody removes an entry causing them to be re-numbered, or changes the meaning of  from  to
p56150
aVIf you want intellisense, all parties are going to need to know something about the numbers, so IMO you might just as well share the enum via some common assembly
p56151
as(dp56152
g18
V23354
p56153
stp56154
a((dp56155
g2
(lp56156
VThe main glitch I can see is that in terms of payload this moves the data into a sub-message
p56157
aVI have some similar designs around v2 that hopefully get around this, keeping most values in the primary message
p56158
aVFor sanity reasons, I mainly had just v2 in mind for this change (since the two implementations would be separate, and v2 has a much better type model)
p56159
aVHowever, it should be possible to support both modes of use
p56160
aVIf you want to send it as a patch for v1 (with the same license etc) I'd happily take a look :)
p56161
aVThis is available as a standard feature of v2
p56162
as(dp56163
g18
V23354
p56164
stp56165
a((dp56166
g2
(lp56167
VThe error here is that protobuf-net (in line with the protobuf-spec) deserializes list (etc) data by appending data
p56168
aVAnd in "v1" (the version you are using) it always runs the constructor
p56169
aVSo when deserializing, it runs the constructor (creates an array length 4000), then processes the data and appends another 4000 items
p56170
aVIf you check, you'll find the array is now 8000 long (you'll be glad to hear that it doesn't resize the array 4000 times
p56171
aVFixes:
p56172
aVin v2 (not really quite released, this is for info only) you can suppress the constructor completely
p56173
aVor just remove the array creation in the ctor, and assign via the set instead (perhaps add a static factory method that does this for you, to save you some code)
p56174
aVThe following test rig (translated to C# for my convenience, sorry) works fine:
p56175
as(dp56176
g18
V23354
p56177
stp56178
a((dp56179
g2
(lp56180
VI try to avoid it on public APIs, but it definitely has uses
p56181
aVMutable value-types is an important one, especially on things like CF (where mutable structs are more common, due to platform requirements)
p56182
aVHowever, perhaps the most common time I use it is when refactoring parts of a complex algorithm out into a few methods, where a state object is overkill and I need to pass multiple values around:
p56183
ag412
ag50
aVetc
p56184
aVWhere  is a private method, just moved out to keep method responsibility manageable
p56185
as(dp56186
g18
V23354
p56187
stp56188
a((dp56189
g2
(lp56190
VFor starters see my comment; I suspect the query is wrong anyway
p56191
aVI would simplifiy it, by simply enforcing separately that each tag exists:
p56192
aVThis should have the net effect of enforcing all the tags specified are present and accounted for
p56193
as(dp56194
g18
V23354
p56195
stp56196
a((dp56197
g2
(lp56198
VIf they accessed private state they would have to be methods in a partial class fragment
p56199
aVExtension methods are useful it it can support a range of objects, or the type can't be used as a partial class (an interface being the most likely example, or outside of your assembly)
p56200
aVLooking at those methods, they don't really seem to relate to any given object, so I would do neither, and just expose them as static methods on a utility class
p56201
aVFor example:
p56202
aVThe regex one is a different case; obtaining group 1 as an int seems such a specific scenario (unless there is something domain-specific in your project that makes this common-place), and the code is so trivial, that I would just let the calling code use the existing static
p56203
aVIn particular, I would want the caller think about whether a static pre-compiled regex might be appropriate, which your utility method doesn't allow
p56204
as(dp56205
g18
V23354
p56206
stp56207
a((dp56208
g2
(lp56209
VThat is going to involve some  - and a lot of reflection generally
p56210
aVPersonally, I would be tempted to just simplify by ditching the generics in this case:
p56211
aVYou can cast to the non-generic  trivially, even if fetching via reflection
p56212
as(dp56213
g18
V23354
p56214
stp56215
a((dp56216
g2
(lp56217
VDepending on the complexity of the xml, you might have some luck with
p56218
aVThis doesn't offer anything like the same level of xml control, but it bypasses the constructor completely
p56219
aVAnd works for private types
p56220
aVI might also ask: does it actually need to be xml
p56221
aVThere are other serializers for things like json or protobuf that don't have the  limitations
p56222
as(dp56223
g18
V23354
p56224
stp56225
a((dp56226
g2
(lp56227
VWell, ASP
p56228
aVNET itself isn't going to work (ditto many of the full libraries), but I'm assuming you just mean you local domain model etc
p56229
aVIIRC you can try to simply reference it, but it may well generate a warning message
p56230
aVOf course you need to be exceptionally careful not to use anything that the other platform doesn't support
p56231
aVIMO, the better option here is to create a second csproj that includes the same
p56232
aVcs files (or cheat with a wildcard/deep include)
p56233
aVAnd build both
p56234
aVSame C#, different dll/platform
p56235
aVIs isn't uncommon to find that you need a very small usage of  directives, too
p56236
as(dp56237
g18
V23354
p56238
stp56239
a((dp56240
g2
(lp56241
VThe key here is to introduce a tuple that encapsulates the combined state of the join operations and other s
p56242
aVI can't repro your environment just from that, but here's a limited example that should make it clear(ish);
p56243
as(dp56244
g18
V23354
p56245
stp56246
a((dp56247
g2
(lp56248
VIndividually they are thread-safe, as they use isolated data-contexts etc
p56249
aVHowever, they are not an atomic unit
p56250
aVSo it is not safe to check the count is > 0 and then assume that there is still something there to pop
p56251
aVAny other thread could be mutating the database
p56252
aVIf you need something like this, you can wrap in a  which will give you (by default) the serializable isolation level:
p56253
aVOf course, this introduces blocking
p56254
aVIt is better to simply check the
p56255
aVNote that  could still throw exceptions - if another thread/process deletes the data between you obtaining it and calling
p56256
aVThe good thing about it throwing here is that you shouldn't find that you return the same record twice
p56257
aVThe  is transactional, but the reads aren't, unless spanned by a transaction-scope or similar
p56258
aVTo make  atomic without throwing:
p56259
aVNow the  is covered by the serializable isolation-level, so doing the read will take a lock on the data
p56260
aVIt would be even better if we could explicitly issue an  here, but LINQ-to-SQL doesn't offer this
p56261
as(dp56262
g18
V23354
p56263
stp56264
a((dp56265
g2
(lp56266
VI've done something similar with an obscenely complex rules engine
p56267
aVUltimately, I set it up so that the data was serialized centrally (with a process to release new changes, causing a new copy to be serialized and the blob stored somewhere accessible)
p56268
aVDuring load, each app-server would check whether they have the up to date version of the blob, and if not fetch it (and store it locally)
p56269
aVThen all it has to do is deserialize the data into memory
p56270
aVNo db hit, except for occasionally grabbing the new blob
p56271
aVIt also means the app-server can work while the db server is offline (as long as it has a cached copy of the blob)
p56272
aVIt also polled periodically for new updates while running, of course - but only to the "is there a new blob" code (it still didn't need to hit the main tables)
p56273
as(dp56274
g18
V23354
p56275
stp56276
a((dp56277
g2
(lp56278
VProtobuf has no terminator - so either close the stream, or use your own length prefix etc
p56279
aVProtobuf-net exposes this easily via SerializeWithLenghtPrefix / DeserializeWithLengthPrefix
p56280
aVSimply: without this, it can't know where each message ends, so keeps trying to read to the end of the stream
p56281
as(dp56282
g18
V23354
p56283
stp56284
a((dp56285
g2
(lp56286
VOr in c#:
p56287
as(dp56288
g18
V23354
p56289
stp56290
a((dp56291
g2
(lp56292
VDidn't they do this for us when they called them 'in' and 'out' rather than covariant and contravariant
p56293
aVJust think: am I pushing values 'in', or getting them 'out'
p56294
aVIf unsure, try 'out' - it is far more common (and easier to understand)
p56295
as(dp56296
g18
V23354
p56297
stp56298
a((dp56299
g2
(lp56300
VApologies for the delay - holiday etc
p56301
aVIn protobuf-net,  should work fine - it is treated pretty much as a
p56302
aVTo confirm: do you mean protobuf-net (a specific implementation)
p56303
aVOr just protobuf generally (where it isn't a core type)
p56304
as(dp56305
g18
V23354
p56306
stp56307
a((dp56308
g2
(lp56309
VApologies for the delay - holiday etc
p56310
aVNo, I haven't seen a specific problem with that
p56311
aVThe fact that it calls out the "End element" suggests that it is in the xml layer at the time (which is before protobuf-net really gets involved)
p56312
aVDo you have any way that I could reliably reproduce this
p56313
aVAfter investigation, the problem here appears to be a WCF's reader-quotas; the exception appears to be swallowed by MSMQ, so wasn't immediately obvious
p56314
aVThis can be fixed in configuration, or in code (if you are setting up your bindings manually) by referencing System
p56315
aVRuntime
p56316
aVSerialization and increasing the binding's  appropriately
p56317
aVThe maximum allowed value is
p56318
as(dp56319
g18
V23354
p56320
stp56321
a((dp56322
g2
(lp56323
VSimply, you shouldn't have to, as long as you've told LINQ-to-SQL about the enum (rather than mapping it as an  and having a separate property in C# that does the translation)
p56324
aVFor example, the following works fine:
p56325
aVThe main point is that my  property is mapped in the dbml to the enum
p56326
aVSimply overtype the type name with the enum type (including namespace)
p56327
aVLikewise, you shouldn't be giving it a 1, but rather the typed enum; for example:
p56328
aV(if all you know is )
p56329
as(dp56330
g18
V23354
p56331
stp56332
a((dp56333
g2
(lp56334
VAs you indicate, doing this purely through inspection of the html is a royal pain (especially when CSS gets involved)
p56335
aVYou could try using the  control (which hosts IE), but I wonder if looking for an appropriate, supported API might be better (and less likely to get you blocked)
p56336
aVIf there isn't an API or similar, you probably shouldn't be doing this
p56337
aVSo don't
p56338
as(dp56339
g18
V23354
p56340
stp56341
a((dp56342
g2
(lp56343
VYou only have one data-set (from your code):
p56344
aVCopying the reference doesn't clone the data - it is just another reference to the same data-set
p56345
aVSo you have simply removed all the data
p56346
aVYou might look at the  method (but note that copies the structure, but not the data)
p56347
as(dp56348
g18
V23354
p56349
stp56350
a((dp56351
g2
(lp56352
VAssuming you want to build the tree, and don't get the data out of order, you should be able to maintain a lookup as you go, i
p56353
ag50
as(dp56354
g18
V23354
p56355
stp56356
a((dp56357
g2
(lp56358
VYou can't simply translate arbitrary unicode characters to ASCII
p56359
aVThe best it can do is discard the unsupportable characters, hence
p56360
aVObviously the basic 7-bit characters will work, but not much else
p56361
aVI'm curious as to what the expected result is
p56362
aVIf you need this for transfer (rather than representation) you might consider base-64 encoding of the underlying UTF8 bytes
p56363
as(dp56364
g18
V23354
p56365
stp56366
a((dp56367
g2
(lp56368
VFor excessively large streams, you shouldn't try dumping it in  - use things like  instead, and talk directly to disk
p56369
aVThe inbuilt buffering is usually sufficient, or you can tweak this with things like  (but I have rarely needed to - but then, I tend to include my own data-processing buffer)
p56370
aVYou might also consider things like compression or densely packed data, and serializers designed to work by streaming records rather than creating an entire graph at once (although since you mention , you may already be doing this highly manually, so this might not be an issue)
p56371
as(dp56372
g18
V23354
p56373
stp56374
a((dp56375
g2
(lp56376
VI hate to say it, but the ideal answer here is simply not to have the sproc cause errors, but rather to validate the inserts
p56377
aVOr better, for the code invoking the sproc to only ask it to process valid data
p56378
aVPapering over the cracks is only going to make things uglier - it raises an exception (above a certain error-level) quite deliberately
p56379
as(dp56380
g18
V23354
p56381
stp56382
a((dp56383
g2
(lp56384
VSince you are using
p56385
aVNET 1
p56386
aVx, you would need to either implement this from scratch (which isn't that hard really), or settle for
p56387
aVI know the position - for a utility library I ended up writing the list primitives from scratch, because:
p56388
ag733
aVx lacks the generic versions
p56389
aVSilverlight lacks the non-generic versions
p56390
aVso to work on all platforms, I rolled my own (I had other unique features too, which made hacking around with something like a  alias undesirable - such as thread-safe tail-iteration while appending items)
p56391
as(dp56392
g18
V23354
p56393
stp56394
a((dp56395
g2
(lp56396
VThere are some options to run
p56397
aVNET code in the database, but personally
p56398
aVI wouldn't
p56399
aVI want my database to worry about storing and fetching data, that is all
p56400
aVOptions:
p56401
aVuse a trigger (or any other approach) to populate an event queue, i
p56402
ag50
aVanother table; have your C# app poll this table for things to do
p56403
aVwrite the code in your app tier instead (i
p56404
ag50
aVrun the code as part of making the data-change command)
p56405
aVAlso consider the transactional nature of the database - it might be that even though you've done an INSERT/UPDATE, the transaction never gets committed (note that with the first approach, the insert to the second table will also be automatically rolled back at the same time, if done correctly)
p56406
as(dp56407
g18
V23354
p56408
stp56409
a((dp56410
g2
(lp56411
VI wasn't aware of a tight correlation between  and , but generally each form simply gets a new
p56412
aVIf you need to do something funky with separate binding-contexts between different controls, then you have that option by assigning your own  to some controls
p56413
aVLooking in reflector, it looks like the  is set for the first time diring the  in  - in fact, that is the only place in the BCL where it appears to be ed:
p56414
ag412
ag50
aVit is lazily instantiated when a  is first needed, and assigning to  causes the event (etc) to be invoked
p56415
aVNot sure why you think this ties into  - care to explain
p56416
as(dp56417
g18
V23354
p56418
stp56419
a((dp56420
g2
(lp56421
VFrom the  in the question, I assume you are actually after the type by name (not the assembly); so assuming the assembly is loaded and the type name is unique, LINQ may help:
p56422
aVHowever, it may be better to work with the assembly-qualified name instead of the type name
p56423
as(dp56424
g18
V23354
p56425
stp56426
a((dp56427
g2
(lp56428
V is only the first check, used to determine non-equality and possible equality
p56429
aVAfter that, Equals is checked
p56430
aVWhich for objects defaults to reference-equality, and for structs is a memberwise compare
p56431
aVOverride  to give an appropriate implementation (paired with the hash-code), and it should give the results you expect (duplicate key)
p56432
aVbtw, the IDE is probably already giving you a warning that  and  should always be treated together
p56433
as(dp56434
g18
V23354
p56435
stp56436
a((dp56437
g2
(lp56438
VNo
p56439
aVMost data-binding uses  / , which is intrinsically instance based
p56440
aVYou could, however, shim the static properties through a dummy object if you really wanted
p56441
aVNote that additional care should be taken re thread-safety of static properties, which may make them even less desirable for direct data-binding
p56442
aV(or better: the use of mutable static properties should be heavily limited)
p56443
as(dp56444
g18
V23354
p56445
stp56446
a((dp56447
g2
(lp56448
VLike @Dave, I'm assuming you mean the app configuration file
p56449
aVIn which case "not easily"
p56450
aVYou can do it, but it involves spawning a second  with a bespoke
p56451
aVTo be honest, I don't think it is worth the effort, but the following works (prints  the second time) - but first a warning: this will be a pain, especially getting things like resolution paths, evidence, etc straight
p56452
aVI really wouldn't bother
p56453
aVwith config file :
p56454
as(dp56455
g18
V23354
p56456
stp56457
a((dp56458
g2
(lp56459
VIt could work, but it depends whether it is going to be any different to passing an  /  in via the constructor
p56460
aVIn depends partly on convenience, and partly on whether you do anything interesting with the template parameters (for example,  them)
p56461
aVTo be honest, the example given does not leap to mind as a good fit for generics - you can't conveniently have a set of brushes, for example (unless you have some additional abstraction - perhaps  - not shown)
p56462
aVThe standard winforms (system
p56463
aVdrawing
p56464
aVdll) does this via static properties, like ,  (for a basic solid brush) - maybe take some inspiration from there
p56465
aVor maybe not
p56466
aVUp to you
p56467
as(dp56468
g18
V23354
p56469
stp56470
a((dp56471
g2
(lp56472
Vhow about (for )
p56473
aVwhich does substraction of the char value
p56474
aVRe the API question (comments), perhaps an extension method
p56475
aVthen use
p56476
as(dp56477
g18
V23354
p56478
stp56479
a((dp56480
g2
(lp56481
VNo, basically
p56482
aVExpression trees are immutable, and contain full member meta-data (i
p56483
ag50
aVthat  is )
p56484
aVTo do this, you would have to rebuild the expression tree from scratch (via a visitor), handling every node type you need to support
p56485
aVIf the expression tree is basic this should be OK, but if you need to support the entire gamut
p56486
aVa huge PITA (especially in
p56487
aVNET 4, which adds a lot more node-types)
p56488
aVA basic example that does just what is required for the example; you would need to add more node-types for more complex expressions:
p56489
as(dp56490
g18
V23354
p56491
stp56492
a((dp56493
g2
(lp56494
VIt turns out that despite my efforts, yes there was a breaking change in data format in one of the earlier builds
p56495
aVThis only impacts  data, which was omitted from the handling at one point
p56496
aVThis is regrettable, but the good news is that no data is lost - it is simply a bit inconvenient to access (it is essentially written via a string at the moment)
p56497
aVHere's my suggested workaround; for a member like:
p56498
aVReplace that with:
p56499
aVThis imports old-style data into  and merges it during (after) serialization, or writes new-style data from
p56500
aVFaster, smaller, and supports both old and new data
p56501
as(dp56502
g18
V23354
p56503
stp56504
a((dp56505
g2
(lp56506
VRe , Silverlight quite simply lacks the extension points that we can use to silently inject an alternative serializer into WCF, which is a pain
p56507
aVThe only ways of doing this currently with silverlight are to throw either a  or a  over the wire, and handle the serialization / deserialization at the two ends
p56508
aVRe , it would be worth checking the contents; if they are coming up with different numbers, there are ways to fix this via a  - an ugly hack, but IIRC there is  (or similar) that can be applied to the class, but which talks about an individual member (property/field)
p56509
aVYou can correct the number this way
p56510
aVThere is also an  (IIRC, sorry - no code to hand) on  which can also help if you have large numbers of fields
p56511
aVIn v2 (not released) you can take much better control of the ordering (/field numbers) without having to mess with attributes
p56512
as(dp56513
g18
V23354
p56514
stp56515
a((dp56516
g2
(lp56517
VProbably mainly for tools like code generators, where is it hugely convenient not to have to know if this is the first or last item
p56518
aVArguably this shouldn't be a determining factor, but (having written such tools) I am grateful for it
p56519
as(dp56520
g18
V23354
p56521
stp56522
a((dp56523
g2
(lp56524
VLINQ-to-SQL already supports inheritance, but only for types in the model
p56525
aVI imagine it is looking for your custom type in the model (to find the appropriate table or discriminator), and failing
p56526
aVIn short, I don't think you can use subtypes that aren't part of the model
p56527
aVHowever, the types are ; you should be able to do:
p56528
aVwhich adds your  override into the generated type
p56529
as(dp56530
g18
V23354
p56531
stp56532
a((dp56533
g2
(lp56534
VBecause  is intended to encode data such as user input
p56535
aVIn your case, that is self-generated (trusted) html, so you don't want to encode it;  is the correct usage
p56536
aVis for things like , which conveniently prevents issues for malicious text with xss etc in it
p56537
as(dp56538
g18
V23354
p56539
stp56540
a((dp56541
g2
(lp56542
V isn't flushed at the point you call ; try:
p56543
aVThis does the  after the  on , meaning it will flush any buffered data to the output ( in this case)
p56544
as(dp56545
g18
V23354
p56546
stp56547
a((dp56548
g2
(lp56549
VEither should be fine
p56550
aVMVC is probably easiest (in terms of getting a raw response), but you could do the same in regular ASP
p56551
aVNET just by using a handler (possibly
p56552
aVashx), or just by clearing the response
p56553
as(dp56554
g18
V23354
p56555
stp56556
a((dp56557
g2
(lp56558
Vfor all public + nonpublic instance fields:
p56559
aVor in VS2005 (comments):
p56560
as(dp56561
g18
V23354
p56562
stp56563
a((dp56564
g2
(lp56565
VIirc (from long back) the id handling works for xdr but not xsd
p56566
aVMaybe just use //*[@id='foo']
p56567
as(dp56568
g18
V23354
p56569
stp56570
a((dp56571
g2
(lp56572
VWell, that ties to BinaryFormatter which has a wide range of associated issues, IMO
p56573
aVNot least, it is quite verbose
p56574
aVpersonally, though - I try never to use viewstate
p56575
aVAt all
p56576
aVIt won't make your class slower etc, but I'm not convinced it is a great idea here either
p56577
as(dp56578
g18
V23354
p56579
stp56580
a((dp56581
g2
(lp56582
VThat sounds like maybe it is reacting to a different cookie
p56583
aVvalue or similar
p56584
aVWebBrowser is IE (to most purposes)
p56585
aVA 500 is at the server, but WebBrowser is the client
p56586
aVYou might be able to hook WebBrowser to supply a different user-agent, but by default it should appear the same
p56587
as(dp56588
g18
V23354
p56589
stp56590
a((dp56591
g2
(lp56592
VStrings never contain anything utf-* or anything else encoded; that isn't their job
p56593
aVThey are strings - groups of character/code-point data
p56594
aVThe  that you have is the encoded form
p56595
aVIn almost any scenario I can think of, the transport etc should be doing this for you already
p56596
aVIf isn't then that sounds like a bug in either the wsdl or the web-service stack itself
p56597
aVKeep in mind that wsdl itself just has  - if that isn't sufficient (i
p56598
ag50
aVthat in combination with the handshake isn't enough), then it simply isn't a web-service string
p56599
aVThe alternative is to throw it around as a , and encode manually via
p56600
as(dp56601
g18
V23354
p56602
stp56603
a((dp56604
g2
(lp56605
VWell, many are very bespoke to specific purposes
p56606
aVIf you listed all of them it would take a while
p56607
aVThe main ones I'd add to the above are / (sets/collections/lists), ,  (generic version of ), and  (plus generic twin, although in truth few people need to code against )
p56608
aVIf you want into any area, there would be many many more that you'll meet quickly - things like / for data-access, etc - but it isn't just interfaces that are important
p56609
aVThings like  is a class (albeit abstract), but hugely important
p56610
aVI think a better question/tactic might be "given that I'm doing [specific X], what are the important types to know about
p56611
aVSince we don't know the [specific X], we can't answer that much
p56612
as(dp56613
g18
V23354
p56614
stp56615
a((dp56616
g2
(lp56617
VI'm not sure why I don't declare that as , since that seems perfectly happy in C# 2
p56618
aV0; I'll get that changed when I get a second, but note that you can apply a manual change locally - simply by editing the csharp
p56619
aVxslt file
p56620
aVNow, xslt isn't everyone's cup of tea, but it should be a 1-line change (near to the word ) - in fact, it is probably the addition of  here:
p56621
aVSince the the xslt is tweakable, you should be able to apply any other changes you require
p56622
as(dp56623
g18
V23354
p56624
stp56625
a((dp56626
g2
(lp56627
VWhile  (as shipped with regular
p56628
aVNET) is intended for use with LINQ-to-SQL, there are other implementations, such as  (now used in Mono) which supports multiple databases
p56629
aVA SQLLite example is on the Mono page
p56630
as(dp56631
g18
V23354
p56632
stp56633
a((dp56634
g2
(lp56635
VIf you want best-practice, the current setup sounds pretty reasonable - you can manage versioning and other validation/mappings at the boundary pretty easily with a separate DTO layer
p56636
aVThis applies doubly if you have an entire DTO layer on the boundary (rather than exposing your regular/transactional domain entities on the boundary), which it sounds like you might
p56637
aVThe downside is increased maintenance, but it makes them very flexible, and avoids any unexpected issues
p56638
aVFor example, it doesn't apply to WCF usually, but a classic error with regular web-services is adding a non-default constructor (thus removing the compiler-generated default constructor)
p56639
aVOops
p56640
aVno more web-service
p56641
aVThere is a similar theme of bugs caused by innocent-looking changes that can be avoided by separating out the DTOs
p56642
as(dp56643
g18
V23354
p56644
stp56645
a((dp56646
g2
(lp56647
VThis is something that I have been looking at for "v2", but it is incomplete
p56648
aVI have been sent a patch for v1 that does this and which I can share, but I haven't rigorously tested this
p56649
aVLet me know if you want this patch file
p56650
as(dp56651
g18
V23354
p56652
stp56653
a((dp56654
g2
(lp56655
VI asked this exact question to the language team directly
p56656
aVI don't have the e-mail to hand, but basically the answer (from Mads, IIRC) was that it is:
p56657
aVto reduce the search-space / complexity - i
p56658
ag50
aVnot having to consider all available extension methods (and prune them) unless there is the expression first
p56659
aVto reduce the chance of an extension method "taking over" a regular method (i
p56660
ag50
aVbeing a better match) unexpectedly
p56661
aVPersonally, I'd have liked it to work consistently - the first doesn't seem a big problem (but then, I don't write compilers), and neither approaches the fact that normally  is an optional thing (that may have influences such as local code style guidelines, i
p56662
ag50
aV"thou shalt use ")
p56663
as(dp56664
g18
V23354
p56665
stp56666
a((dp56667
g2
(lp56668
VHow about:
p56669
as(dp56670
g18
V23354
p56671
stp56672
a((dp56673
g2
(lp56674
VIf you don't expect to further compose the data (at the db-server), then:
p56675
aValthough in that case I'd prefer to return  or  to make the non-composable nature obvious
p56676
aVWith the  approach, it'll still be composable, but it'll compose via LINQ-to-Objects (so after it has fetched the records from the database)
p56677
aVIf you do expect to further compose it, then you should pass the data-context (or, if possible, an upstream ) into the method, and let the caller handle the lifetime:
p56678
as(dp56679
g18
V23354
p56680
stp56681
a((dp56682
g2
(lp56683
VSince you are writing to file, why not just use:
p56684
as(dp56685
g18
V23354
p56686
stp56687
a((dp56688
g2
(lp56689
VSince inheritance is not part of the core spec, I basically represent this using encapsulation
p56690
aVSo your  maps to:
p56691
aVis undergoing an overhaul in v2, so it should support a few more of these scenarios
p56692
as(dp56693
g18
V23354
p56694
stp56695
a((dp56696
g2
(lp56697
VYes, that is a nuisance
p56698
aVThere are 2 options for fixing this; the first (and easiest) is to use WCF's ability to share a contract assembly between client and server
p56699
aVIf you can share the DTO layer, that'll keep things simple
p56700
aVThe second is to add additional markers at the client to give it a clue
p56701
aVYou can do this via a  class, for example in a separate code file (don't edit the generated file):
p56702
aVa more explicit alternative is:
p56703
as(dp56704
g18
V23354
p56705
stp56706
a((dp56707
g2
(lp56708
VUltimately, anything you do is going to do exactly that anyway
p56709
aVA simple  loop should be fine
p56710
aVThere are pretty solutions involving lambdas, such as  / , but tbh it isn't necessary:
p56711
aV(the  loop has the most efficient handling for arrays; and  isn't an option due to mutating the iterator variable)
p56712
as(dp56713
g18
V23354
p56714
stp56715
a((dp56716
g2
(lp56717
VThe main time they are unexpectedly different is when someone is stupid enough to call a type (or property /field/etc)  (for example), since  always refers to , where-as  could be
p56718
aVThe closest you can get to the C# alias is , which tends to stick out like a sore thumb
p56719
aVI prefer the C# aliases
p56720
aVbtw, here's a fun way to mess with anyone using  too much:
p56721
as(dp56722
g18
V23354
p56723
stp56724
a((dp56725
g2
(lp56726
V uses a specific database feature, that has no generic OLEDB counterpart
p56727
aVIndividual providers may have something similar, but you would have to use to provider-specific variant (or find a library that already wraps this, if one)
p56728
aVIn short: as far as I know, you can't
p56729
as(dp56730
g18
V23354
p56731
stp56732
a((dp56733
g2
(lp56734
VI don't know if it is what you are after, but you could consider the python version of protobuf (here)
p56735
aVI haven't tested it specifically on ironpython, mind
p56736
aVThis has the added advantage that there are also C# implementations that may help, while keeping it platform independent
p56737
aVWhen possible I want to get protobuf-net to support DLR types, but that is a big job
p56738
aVAs a side note, personally I'd recommend having a dedicated DTO type rather than trying to extend the inbuilt types
p56739
as(dp56740
g18
V23354
p56741
stp56742
a((dp56743
g2
(lp56744
VDo you only want to support the old ones for deserialization
p56745
aVif so, you could have:
p56746
aVThe bool method tells  never to write this, but it will still be read
p56747
aVtells it not to appear in things like , and  tells it not to appear in intellisense (only applies to code referencing the dll, not the project, nor code in the same project)
p56748
as(dp56749
g18
V23354
p56750
stp56751
a((dp56752
g2
(lp56753
VI can't think why not; the SSL stream will just be given bytes, but that is what it expected anyway
p56754
aVThe important thing is to close the  properly, as even  doesn't always really flush (due to having to keep a running buffer for compression)
p56755
aVSo:
p56756
aVI'm also assuming that you aren't reading and writing to the same SSL stream (i
p56757
ag50
aVthat is two separate examples, not one example), as that doesn't sound likely to work
p56758
as(dp56759
g18
V23354
p56760
stp56761
a((dp56762
g2
(lp56763
V= (bitwise/non-short-circuiting) "or"
p56764
aV= "xor"
p56765
aVand for info, "not" (bitwise negation) is
p56766
as(dp56767
g18
V23354
p56768
stp56769
a((dp56770
g2
(lp56771
VFrom what I can see in MSDN, the only appropriate sets of data for remove are the overload taking the instance, and the overload taking instance and index
p56772
aVYou could try the latter passing just the index; it might work
p56773
aVbut given the existence of the first overload, I'm not hopeful
p56774
aVIf you don't give it the object, downstream code may have no way of knowing which item changed
p56775
aVSo I think you're going to have to pass the object
p56776
aVThis shouldn't generally cause issues, as most code is simply going to use it for reference check; the object is still there (it hasn't been collected) - it has just been disposed, where "just" is used
p56777
aVsubjectively (as this could still cause issues)
p56778
aVAnother option, of course, is to wrap the object in a facade
p56779
aVThen it doesn't matter if the actual object is disposed, set to null and/or garbage-collected; the facade is still there (but it should be coded to handle the object being unavailable)
p56780
aVAs a final option; do you have to use their collection
p56781
aVCould you not just wrap that collection, so that you choose when to tell it about these things
p56782
aVTHen you retain complete control over lifetimes
p56783
as(dp56784
g18
V23354
p56785
stp56786
a((dp56787
g2
(lp56788
VSomething like (I'm not at a pc)
p56789
as(dp56790
g18
V23354
p56791
stp56792
a((dp56793
g2
(lp56794
VThat's an interesting one
p56795
aVI can't think of a convenient way of intercepting the equals without breaking everything, but: are the user-names unique
p56796
aVYou could just include the username condition in the LINQ, then check the hash in regular c#
p56797
aVIn terms of data transferred there is little difference between passing it in and fetching it out, especially if we optimise for the success case (in which case this reduces the IO requirements)
p56798
aVNote: return the same result for "not found" and "not a match" if you do this
p56799
aVBecause the byte[] compare no longer depends on special treatment by LINQ-to-SQL, it should work fine in your mock now
p56800
as(dp56801
g18
V23354
p56802
stp56803
a((dp56804
g2
(lp56805
VI suspect GZIP (via GZipStream, or simply via IIS, noting that you need to enable dynamic compression for the json mime-type) would be both simpler and smaller, but if you are using serializarion, simply adding some [XmlElement(
p56806
aV/ [XmlAttribute(
p56807
aVshould do it
p56808
aVOf course, if size is your concern, can I also suggest something like protobuf-net, which gives an extremely dense binary output
p56809
aVIf you aren't using serialisation, then this looks an ideal fit for some "xslt":
p56810
aV(with C#:)
p56811
as(dp56812
g18
V23354
p56813
stp56814
a((dp56815
g2
(lp56816
VLook at the root namespace; you'll have to include an xml-namespace manager and use queries like "//x:ItemGroup", where "x" is your designated alias for the root namespace
p56817
aVAnd pass the manager into the query
p56818
aVFor example:
p56819
as(dp56820
g18
V23354
p56821
stp56822
a((dp56823
g2
(lp56824
VA tab is just a logical separator
p56825
aVIt has no magic ability to force the data to align, and it depends on how your viewer interprets tabs; it might mean "indent 4 characters", it might mean "pad rounding to the nearest 8th character"
p56826
aVAs such, it is normally very dependent on the existing data lengths
p56827
aVIn Word it will usually be interpreted as "move to the next pre-defined tab", but that depends on a: what tabs are defined in Word, and b: how wide the data is already (i
p56828
ag50
aVwhat is "next")
p56829
aVIn Excel (or any spreadsheet) it will generally be interpreted as columns
p56830
aVFor this reason, a spreadsheet is probably your best option for browsing tabular delimited data (if you care about columns)
p56831
aVSo; what viewer are you using
p56832
as(dp56833
g18
V23354
p56834
stp56835
a((dp56836
g2
(lp56837
VFor quick-to-implement etc, I'd look at LINQ-to-SQL; the jury is still out on who considers it to be full ORM, but tbh I don't care; it lets me map my data quickly, simply, conveniently and safely, with decent IDE/language support
p56838
aVThe LINQ you generally need is pretty minimal
p56839
aV, , , etc
p56840
aVAnd setting it up is just a case of telling the designer about the tables/columns vs clases/properties
p56841
as(dp56842
g18
V23354
p56843
stp56844
a((dp56845
g2
(lp56846
VDoes anything else perhaps creep into the model
p56847
aVA classic example is events; BinaryFormatter includes event graphs, which causes all kinds of unexpected things to be included
p56848
aVIf you have events, mark the backing field as [NonSerialized], or for field- like events:
p56849
aVOr better, use a serializer that doesnt include event graphs
p56850
as(dp56851
g18
V23354
p56852
stp56853
a((dp56854
g2
(lp56855
VI would just not add it in the first place:
p56856
as(dp56857
g18
V23354
p56858
stp56859
a((dp56860
g2
(lp56861
VBased on the info Ben added, this should do what you require:
p56862
as(dp56863
g18
V23354
p56864
stp56865
a((dp56866
g2
(lp56867
VI wouldn't inherit from  - it introduces issues like these, and doesn't really help (since there are no  methods to override)
p56868
aVI would either use  (or the more abstract ), or to introduce polymorphism  has virtual methods
p56869
aVAs a note; re things like , you may also find the LINQ options (like ) useful counterparts; most notably, they will work for any  (or ), not just  and subclasses
p56870
as(dp56871
g18
V23354
p56872
stp56873
a((dp56874
g2
(lp56875
VThe simplest option is to simply rebuild and redeploy
p56876
aVThere are things you can do in config (runtime/assemblyBinding/dependentAssembly/bindingRedirect), but that seems overkill here, since I'm not sure how you would go about changing the version numbers of the assemblies without rebuilding them, especially if they are signed/strong-named (the runtime will detect evil-doers)
p56877
aVIt sounds like making work to me
p56878
aVIf the dlls are yours, just rebuild them with the right version meta
p56879
aVIf they aren't yours, perhaps don't monkey with them
p56880
as(dp56881
g18
V23354
p56882
stp56883
a((dp56884
g2
(lp56885
VSimply , you haven't caught the result of  (it returns a different  representing the closed method)
p56886
aVHowever, might I suggest that in most cases it is easier to use the non-generic , falling back to non-generic  (reflection and generics are not good friends):
p56887
aV(note, you won't have to use the fallback code, since you are always using  which implements )
p56888
as(dp56889
g18
V23354
p56890
stp56891
a((dp56892
g2
(lp56893
VYou can do that with reflection, for example:
p56894
aVbut reflection soon begats more reflection - as you'd then need to talk about  via reflection
p56895
aVThere are ways of minimising this impact, though:
p56896
aVnon-generic interfaces (the simplest approach)
p56897
aVcalling a generic method once via reflection that does all the additional work via regular static generic code
p56898
aVFor the first, I might have an  interface (non-generic), then it is just:
p56899
as(dp56900
g18
V23354
p56901
stp56902
a((dp56903
g2
(lp56904
VIt depends on the binding and configuration (for more details see here)
p56905
aVAnd even then, the reliability is non-durable
p56906
aVIf you want something reliable and durable, you might want to look at transactional queues, for example via MSMQ (although numerous queue technologies are available)
p56907
aVYou might even want to post synchronously to the queue, since you expect it to be available
p56908
as(dp56909
g18
V23354
p56910
stp56911
a((dp56912
g2
(lp56913
VRegular Word automation is not supported when running as a service (including things like ASP
p56914
aVNET)
p56915
aVIt is a desktop client application with an API to automate that application, not an API to the Word subsystem
p56916
aVYou might try looking at Word Automation Services, but note that this is a SharePoint Server 2010 component
p56917
aVI would strongly recommend looking at alternatives, such as the various tools (some free, some not) for writing Word documents, or other file formats
p56918
aVIt seems moot, but I also doubt that Word will work on server-core
p56919
aVIt is heavily stripped down for scoped server usage, and will be missing many things that a desktop client application will want to use
p56920
as(dp56921
g18
V23354
p56922
stp56923
a((dp56924
g2
(lp56925
VMy guess is that the FP representation means it isn't actually a trailing 5; the dangers of FP
p56926
aVThis works fine, though:
p56927
as(dp56928
g18
V23354
p56929
stp56930
a((dp56931
g2
(lp56932
VIt isn't the most orthodox approach, but it looks like it should work
p56933
aVNote that you should ensure that the iterator is disposed at some point, for example:
p56934
aV(and ideally in the form's Dispose too)
p56935
aVBut I wonder if keeping an index in an array is simpler
p56936
as(dp56937
g18
V23354
p56938
stp56939
a((dp56940
g2
(lp56941
VRather than fight it; maybe approach the problem from another angle
p56942
aVcould you (instead, either of):
p56943
aVdelimit the data (with ) and pass a single string, and split it () in the C#
p56944
aVcall Save multiple times, accepting a single string each time (), then call a final method to actually commit the changes
p56945
as(dp56946
g18
V23354
p56947
stp56948
a((dp56949
g2
(lp56950
Verm, because you told it to be
p56951
aVNow you have your , you should be able to remove this
p56952
aVAny failure during a test (not including exceptions that you intentionally handle) is generally terminal, but any assert that passes (like the  here) just keeps on running
p56953
aVSo the first test passes, then the last line flags it as inconclusive
p56954
as(dp56955
g18
V23354
p56956
stp56957
a((dp56958
g2
(lp56959
VMetrics are only meaningful in context
p56960
aVYou first need to define what exactly you want to measure
p56961
aVBasic network sniffer usage should be a good start (bandwidth) but CPU etc is important too
p56962
aVActually, even "binary" is horribly ambiguous - it has (this afternoon) come to my attention that I might be able to swap the serializer out from SL WCF
p56963
aVFrom experience protobuf usually does far better than the unbuilt offerings, so if we can silently add that into SL
p56964
as(dp56965
g18
V23354
p56966
stp56967
a((dp56968
g2
(lp56969
VI wonder if converting to vanilla asp
p56970
aVnet (aka webforms) is a bad idea here
p56971
aVPersonally I'd go to MVC instead - allows multiple forms etc, and the views are much closer to he HTML, a lot like ASP
p56972
aVI guess I'm saying there are some glitches vanilla asp
p56973
aVnet introduces that you don't have to suffer
p56974
as(dp56975
g18
V23354
p56976
stp56977
a((dp56978
g2
(lp56979
VIn the current official versions I don't include interface serialization support
p56980
aVHowever, I do have a patch contributed (from another user) that seems to enable this
p56981
aVI haven't applied this patch to the core yet, simply because I need to focus on finishing "v2" first before adding more features (especially as the feature would need to be completely re-implemented for v2), but I'm happy to share the patch with you if you would like
p56982
aVAlternatively: use a base-class instead of an interface
p56983
aVThat is supported (via ) - however, the fact that your  already has a parent class complicates matters somewhat
p56984
aVEdit: this is now supported in v2
p56985
aVThe code must know about the expected concrete implementations, obviously - but includes can now be attached to interfaces (or optionally  specified in code for vanilla POCO models)
p56986
as(dp56987
g18
V23354
p56988
stp56989
a((dp56990
g2
(lp56991
VAt the simplest level; simply serialize a shed-load of data, time it, and measure the bandwidth
p56992
aVAnd shed-load should include both large and small (but lots-of) payloads
p56993
aVYou should also consider with/without MTOM
p56994
aVAnd although I am perhaps biased I suggest you should include alternative WCF serializers such as protobuf-net (let me know if you need help hooking that in)
p56995
aVFrom lots of work in the area it usually defeats all the ones you've mentioned by a decent margin on every measure
p56996
aVMuch of what is involved here can be investigated at the serializer level without even touching WCF, however that bypases base-64/MTOM so isn't a 100 percent image
p56997
aVWe can't, however, define your measures for you; only you can decide what is key
p56998
aVI do have a number of measure though - it is usually simply:
p56999
aVserialize once to MemorySteam (and deserialize); this gets you the size and primes the JIT
p57000
aVnow keep that memory-stream (as a handy buffer) and (inside stopwatch) serialize many thousands if times
p57001
aVDivide
p57002
aVRewind each time so you are overwriting (not extending)
p57003
aVrepeat but deserializibg many thousands of times
p57004
aVDivide
p57005
as(dp57006
g18
V23354
p57007
stp57008
a((dp57009
g2
(lp57010
VDynamic proxies only exist on-demand, so are poor choices for serialisation
p57011
aVWhat us the error with XML
p57012
aVUltimately I expect your best option here is to use a DTO layer, but that might also serialize with some other serializers
p57013
aVFor example have you tried DataConttactSerializer, which may be able to cope
p57014
aVI've been adding proxy support to my own serializer but I haven't tried with ef4 yet
p57015
as(dp57016
g18
V23354
p57017
stp57018
a((dp57019
g2
(lp57020
VSerialization is a common way to clone an object (if you don't want to code it manually) - is is serializable
p57021
aV(or: could it be
p57022
aVThis has the advantage of being a deep clone and maintenance-free, but is slower (how much slower depends on the serializer chosen)
p57023
aVNote: if you choose to use , make sure you mark any events as
p57024
aVisn't my preferred serializer, but it is acceptable for in-memory cloning purposes (and is simple to get working - just mark your types as )
p57025
as(dp57026
g18
V23354
p57027
stp57028
a((dp57029
g2
(lp57030
VAgreed - not there, but you might try some of the reimplementations, for example Silverlight MD5 implementation on MSDN Code Gallery
p57031
as(dp57032
g18
V23354
p57033
stp57034
a((dp57035
g2
(lp57036
VI'm guessing this is due to the unpredictable IDs of ASP
p57037
aVNET elements; there is fixed naming available in 4
p57038
aV0 () - try using that with your  selectors
p57039
aV(where  is set to )
p57040
as(dp57041
g18
V23354
p57042
stp57043
a((dp57044
g2
(lp57045
VXML is not well suited to such a task; it isn't very dense (but density is desirable with high volumes), expensive to process, and non-appendable
p57046
aVAs has already been suggested a database may be appropriate, but there are also file formats that could help here (storing the simple directly; no db abstraction)
p57047
aVThe biggest stumbling block, however, is the "last n" requirement
p57048
aVUnless you store that offset separately this is very tricky (assuming each record isn't fixed size)
p57049
aVLet me know if you want me to suggest something more specific
p57050
as(dp57051
g18
V23354
p57052
stp57053
a((dp57054
g2
(lp57055
VThis is a very common question
p57056
aVIt relates to how "captured variables" work; short version, you need this:
p57057
aVThe problem here is that  (from the ) is technically declared outside the scope of the loop, and thus is captured at that outer scope; you capture the same variable each time (C# captures variables, not *values)
p57058
aVAdding  inside the loop-scope changes this; because of the scope,  is captured separately per iteration
p57059
as(dp57060
g18
V23354
p57061
stp57062
a((dp57063
g2
(lp57064
VLINQ tries to be roughly familiar to people knowing SQL, where projection is select, etc
p57065
aVYou could write your own extension methods with names to suit, of course
p57066
as(dp57067
g18
V23354
p57068
stp57069
a((dp57070
g2
(lp57071
VWell, the obvious difference when working with strings is that you have the option of meta-programming, by constructing the string at runtime (the same as you could with )
p57072
aVHowever, this is double edged, and arguably leads into a range of other problems with literal concatenation (injection), and perhaps simply complexity
p57073
aVIf you don't need the string version, I wouldn't use it to be honest
p57074
aVA side benefit of the regular (non-string) version is that most javascript minifiers (or obfuscators) will know what to do with it
p57075
aVThis seems unlikely for the string, i
p57076
ag50
aVthey'll leave it "as is" (not minified or obfuscated)
p57077
as(dp57078
g18
V23354
p57079
stp57080
a((dp57081
g2
(lp57082
V is pretty much the closest you'll get here, but this still only tells you what is available locally, rather than what the socket is going to deliver
p57083
aVIMO, the most reliable approach here is to implement your network code so that you know how much data is expected (in advance, perhaps simply with a length marker), and then use (for example) async stream-reading to pull that data from the socket until either you have consumed exactly that much data, or you timeout
p57084
aVThen the answer to "how much more do I expect" is simply "how much did I expect originally" - "how much have I read so far"
p57085
as(dp57086
g18
V23354
p57087
stp57088
a((dp57089
g2
(lp57090
VWhen using , you need to give it the stream that represents the contents of the file, which will be consumed and sent to the client
p57091
aVCurrently you've instead given it the ASP
p57092
aVNET response stream instead
p57093
aVIt can't possibly read from that (it is an output-only stream)
p57094
aVSo; where is the contents
p57095
aVOpen up a stream to that and pass it in
p57096
aVDepending on your implementation, this could mean the local file-system, a network file-system, a database, a remote http (etc) server, or something generated in-memory (typically via )
p57097
aVEqually, it is for you to tell MVC what the content-type is; you shouldn't use the value from , since that is what you are constructing
p57098
as(dp57099
g18
V23354
p57100
stp57101
a((dp57102
g2
(lp57103
VResharper will offer this via alt+enter, enter
p57104
as(dp57105
g18
V23354
p57106
stp57107
a((dp57108
g2
(lp57109
VI would refactor that middle code out to a single method that accepts , and does a switch on the member type
p57110
aVUntested, but:
p57111
as(dp57112
g18
V23354
p57113
stp57114
a((dp57115
g2
(lp57116
VLeaving aside the recursion, you should perhaps just  use  and test for null
p57117
aVActually, you probably don't need the full employee object - you can probably suffice with just returning the id (throughout), i
p57118
ag50
aVActually, the biggest concern I have with the original form is that it isn't specific to the type of exception; it could be "thread abort", "zombie connection", "deadlock", etc
p57119
as(dp57120
g18
V23354
p57121
stp57122
a((dp57123
g2
(lp57124
VTypically you would handle that as a POST (not a GET), and read the xml from the request-stream (or there are helpers to let you do this)
p57125
aVOtherwise URL encoding and length restrictions are going to make this extremely painful
p57126
as(dp57127
g18
V23354
p57128
stp57129
a((dp57130
g2
(lp57131
Vfrom memory, something like:
p57132
as(dp57133
g18
V23354
p57134
stp57135
a((dp57136
g2
(lp57137
VParameter values are returned at the end of the TDS stream (since you could change it at the end of your query, after selecting data)
p57138
aVYou must be sure to consume all the TDS data (or at least, cause the buffers to be flushed, which  does for you) in order to get the updated parameter values, for example:
p57139
aVThe same goes for SQL errors raised late in the query
p57140
aVYou could also try adding a ; this may also be sufficient:
p57141
as(dp57142
g18
V23354
p57143
stp57144
a((dp57145
g2
(lp57146
VThere is no magic  for a delegate instance, short of deconstructing the IL (perhaps with mono
p57147
aVcecil)
p57148
aVIf you want an expression tree, you'll have to start with an expression tree, so have  througout
p57149
aVAs an edge case, you can get basic method delegate information from the delegate's  (the ) and  (the ) - however, for most scenarios involving a lambda or anonymous method this will point at the compiler-generate method on the capture class, so won't really help you much
p57150
aVIt is pretty much limited to scenarios like:
p57151
as(dp57152
g18
V23354
p57153
stp57154
a((dp57155
g2
(lp57156
VIf the purpose of the properties is for data-binding, then you can add runtime properties to types outside your control using , which is a factory for an
p57157
aVYou would then chain the original provider and create a custom  that obtained the additional data
p57158
aVThis is reasonably easy for read-only extra properties that are calculated based on the existing properties (and by "reasonably easy" I mean "only slightly insane"), but for read-write properties (or properties that are independent to the existing members) it is very hard, as you need to figure out where to put those values (in a way that still gets garbage collected etc)
p57159
aVNon-trivial
p57160
as(dp57161
g18
V23354
p57162
stp57163
a((dp57164
g2
(lp57165
V simply means that subclasses are able to see that member, but the member is not part of the public API to the object
p57166
aVRe the question; it depends what you mean by "data members"
p57167
aVIf you mean fields, then IMO they shouldn't be
p57168
aVIt is fairly common to make some state (properties) , if subclasses would need that info (in particular methods), but it isn't necessary for the outside world
p57169
aVA better example, however, is , where the inheritor is able to change the implementation of an otherwise private (to the outside world) member
p57170
aVThe classic example being:
p57171
aVwhere the inheritor can now react (or even block) changes to key values by using  to change the implementation (commonly but not always calling  at some point to invoke the original implementation as well)
p57172
as(dp57173
g18
V23354
p57174
stp57175
a((dp57176
g2
(lp57177
V(C# example)
p57178
as(dp57179
g18
V23354
p57180
stp57181
a((dp57182
g2
(lp57183
VYou are compiling against an interop assembly - a managed/
p57184
aVNET assembly designed to mimic the underlying COM API
p57185
aVThe most likely problem here is versioning; maybe that property is present in the managed PIA, but missing in the COM version you have
p57186
as(dp57187
g18
V23354
p57188
stp57189
a((dp57190
g2
(lp57191
VNo
p57192
aVThe only sensible way to do this would be to have a unit test check use reflection to find  all concrete implementations, and then verify this condition
p57193
aVYou could also perhaps do something at runtime re the same via a static constructor, but then the question is which static constructor
p57194
aVAnother approach is to drop the operators and use an interface-based approach; for example , if you need  to have  then instead of operators have an interface with an  method
p57195
aVAnother advantage here is that interfaces are usable from generics (typically via constraints), where-as using operators from generic code takes some effort
p57196
as(dp57197
g18
V23354
p57198
stp57199
a((dp57200
g2
(lp57201
VSince VB
p57202
aVNET doesn't provide iterator blocks, you will have to write the iterator class by hand, which is extremely painful
p57203
aVI'll try to write it (manually) in C# for you, so you can see what I mean
p57204
aVlike so:
p57205
as(dp57206
g18
V23354
p57207
stp57208
a((dp57209
g2
(lp57210
VIt will either be in  (which is ), or via , where  is some property on the (generated)
p57211
aVIf the former, note that  is , so you may need  to do the casts and conversions correctly
p57212
as(dp57213
g18
V23354
p57214
stp57215
a((dp57216
g2
(lp57217
VNever abort a thread unless your process is terminally sick and is going to die anyway
p57218
aVVery bad things happen (for example, irretrievable locks)
p57219
aVThe code is fine as is
p57220
aVWhen the  method ends, so will the thread
p57221
aVIf the  method is brief, perhaps consider , but otherwise; leave it
p57222
aVYou might want to consider adding some exception handling, so that if  throws it doesn't kill the entire , and you should understand that most of the time here is going to be spent updating the UI on the UI thread (unless your table is being populated from an external source, and the procedural  is just illustrative)
p57223
as(dp57224
g18
V23354
p57225
stp57226
a((dp57227
g2
(lp57228
V(re C# only)
p57229
aVIt depends largely on what that library itself does
p57230
aVA lot of C# libraries can simply be referenced; the AOT then just deals with it
p57231
aVHowever, if the library does a lot of reflection (which is fairly limited), or relies on external services (P/Invoke etc), or deals with  code (etc), then it isn't going to run well (or possibly at all) on iPhone
p57232
aVA better answer may be to enquire with the 3rd party whether this works now or in the future (perhaps with a specific targetted dll)
p57233
as(dp57234
g18
V23354
p57235
stp57236
a((dp57237
g2
(lp57238
VSince the type is public, this sounds as simple as a missing project reference between the two
p57239
aVRight click references and add a new reference, but watch that references shouldn't become circular (i
p57240
ag50
aVA <===> B, or A ===> B ===> C ===> A)
p57241
aVActually, the VS IDE doesn't let you do this, but it can be done (accidentally or purposefully) via the command-line tools
p57242
as(dp57243
g18
V23354
p57244
stp57245
a((dp57246
g2
(lp57247
V is the default axis, so if  is the , then  should work, assuming that  is in the default namespace
p57248
aVIf you have xml-namespaces you'll need to qualify it by creating a namespace manager:
p57249
as(dp57250
g18
V23354
p57251
stp57252
a((dp57253
g2
(lp57254
VIf I wanted to multiply a number by 4, I would write
p57255
aVIf my intent is to left-shift some bits 2 places, I would write
p57256
aVRe the question:
p57257
aVWhy do Java and C# have bitshifts operators
p57258
aVI do a lot of work on binary data, where I'm not thinking about integers etc - just binary - and in that area it is entirely logical to use shift operators constantly
p57259
aVSure, I could type  etc, but what I actually want to do is shift the bits
p57260
aVThis is common in a range of areas where bytes matter (for example graphics programming, serialization, etc)
p57261
aVAdditionally, there are some subtleties of shift operations where you don't want it to behave like an integer, in particular when dealing with the edges
p57262
aVthe rules for what happens when you left-shift a bit off the map, or right-shift bits into the map (-ve vs +ve etc) are well understood but critical
p57263
aVLikewise, the / behaviour of integer multiplication is sometimes very important
p57264
as(dp57265
g18
V23354
p57266
stp57267
a((dp57268
g2
(lp57269
Vwhich with your -based approach is probably (untested) mappable to:
p57270
aVI should also advise not to use  here, but to apply the Uri trick to some code using a DOM, perhaps  (if xhtml) or the HTML Agility Pack (otherwise), looking at all  or  attributes
p57271
as(dp57272
g18
V23354
p57273
stp57274
a((dp57275
g2
(lp57276
VPoints to note: 24-hour  hour is HH; 2-digit month is MM
p57277
as(dp57278
g18
V23354
p57279
stp57280
a((dp57281
g2
(lp57282
VAt the point of re-presentation, that is a UI concern, as only the UI knows what the target is (and thus the appropriate encoding)
p57283
aVSo I'm not sure how you could do this at the language level -or at LINQ (being a data-access component)
p57284
aVHowever; in ASP
p57285
aVNET MVC2 the  (which is intended to represent a safe html string) goes some way to providing this, along with the new  syntax, which automatically encodes as necessary, but without double-encoding
p57286
as(dp57287
g18
V23354
p57288
stp57289
a((dp57290
g2
(lp57291
VTo be honest, I'd just use
p57292
aVThat way:
p57293
aVno need to declare a delegate type
p57294
aVstatic type checking
p57295
aVMethodInvoker has special detection/handling, so is slightly faster ( not much)
p57296
aVIt also isn't clear what the async method will do; adding two numbers is overkill, fir example
p57297
aVYou may need to consider thread safety and thread affinity
p57298
as(dp57299
g18
V23354
p57300
stp57301
a((dp57302
g2
(lp57303
VYou could simply serialize it to a known layout and take a known hash (md5
p57304
aVof the serialised form
p57305
aVThis requires a predictable serialization though - so XML attributes would be a pain as would whitespace
p57306
aVBut not insurmountable
p57307
aVAlternatively, a reflection / md5 based approach
p57308
as(dp57309
g18
V23354
p57310
stp57311
a((dp57312
g2
(lp57313
VIt had already been noted that you must cache and re-use the delegate, ideally ignoring the first run
p57314
aVTo give a complete answer we would need to see a specific example
p57315
aVI've actually seen examples where it was faster   (due to different IL flags being set)
p57316
aVSo: it will depend on the code
p57317
aVMy guess is that your example does some conversion or operator that the c# compiler handles differently (optimised), but Expression must handle in a generic way (since it is language independent)
p57318
aVAnother factor is how things like literals and captures are handled
p57319
as(dp57320
g18
V23354
p57321
stp57322
a((dp57323
g2
(lp57324
VIf you look at it as xml, you are always going to have the descendants - otherwise you are corrupting the xml
p57325
aVBut as long as you only look at the  of the immediate child that should be fine
p57326
aVIf you map it to an object model you would have a similar approach, but you'd ignore the  (or whatever you call the child member)
p57327
aVThere is no "the correct way", but yes, that should suffice
p57328
aVIn some cases you might want to consider a flat model, but hierarchical seems to suit this data OK
p57329
aVBy a "flat" model I mean that you'd simply have:
p57330
aVNote you can still use the existing  value to infer the association without having it part of the actual layout
p57331
aVI'm not saying either is correct - merely that both are legal
p57332
aVIndeed, at the moment you have redundancy in that you express this relationship both through the structure and through the values; which is fine until you make a mistake and update one but not the other
p57333
as(dp57334
g18
V23354
p57335
stp57336
a((dp57337
g2
(lp57338
VMy guess would be a standard thread-safety / synchronization bug, most likely due to some static resource such as a static connection
p57339
aVObviously this is pure speculation without some more code, but it (=web-sites being highly threaded) is a surprisingly common oversight
p57340
aVIf it is a static resource, then
p57341
aVwell, it probably shouldn't be static
p57342
aVEither per-request, or (specifically in the case of connections) scoped to the local code (and let the connection-pooling worry about re-use)
p57343
as(dp57344
g18
V23354
p57345
stp57346
a((dp57347
g2
(lp57348
VTaking the "first only" into account, perhaps:
p57349
aVOr more generally:
p57350
aVThen:
p57351
as(dp57352
g18
V23354
p57353
stp57354
a((dp57355
g2
(lp57356
VIn
p57357
aVNET 4
p57358
aV0, you get a lot more - up to 16 parameters
p57359
aVAlthough using such routinely might be taking it a bit far in terms of readability
p57360
as(dp57361
g18
V23354
p57362
stp57363
a((dp57364
g2
(lp57365
VIs  perhaps data-bound at this point
p57366
aVSince  issues change notifications, adding lots of data while bound will cause a performance bottleneck
p57367
aVIn many cases you can simply suspend the data-binding while you do this
p57368
aVOr alternatively, populate it first, and then give it to the data-binding
p57369
aV(the difference here is whether it redraws and refreshes the UI once per row, or once overall)
p57370
as(dp57371
g18
V23354
p57372
stp57373
a((dp57374
g2
(lp57375
VNote you could also use  to do the aggregate, with the advantage that it will short-circuit sooner:
p57376
as(dp57377
g18
V23354
p57378
stp57379
a((dp57380
g2
(lp57381
VSimple
p57382
aVdon't use Regex
p57383
aVUse a DOM parser - so  for xhtml or the HTML Agility Pack for (non-x)html
p57384
aVThen just query  and look at the "src" and "alt" attributes on each  element (i
p57385
ag50
aV, etc)
p57386
aVRegex is NOT a good tool for parsing html (since it is not a regular language)
p57387
as(dp57388
g18
V23354
p57389
stp57390
a((dp57391
g2
(lp57392
VPer developer (usually named)
p57393
aVThere is also volume licensing if you have a lot of dev heads
p57394
as(dp57395
g18
V23354
p57396
stp57397
a((dp57398
g2
(lp57399
VIn logic tilde can mean "not", which may be confusing as in math tilde can be "equivalence" or "approx"
p57400
aVHowever, it is found on more keyboards than the less ambiguous 
p57401
aVWatch out, as tilde can also mean bitwise not :)
p57402
as(dp57403
g18
V23354
p57404
stp57405
a((dp57406
g2
(lp57407
VShould do
p57408
aV(untested)
p57409
as(dp57410
g18
V23354
p57411
stp57412
a((dp57413
g2
(lp57414
VIf you can map this to a udf you can drag the udf into the data-contex
p57415
aVWhen accessed via the data-context LINQ-to-SQL can do the translation
p57416
aVIf you are just filtering an iqueryable, you can write a method that just uses Where (returning a new iqueryable) which can work well
p57417
aVIf you need mug more, you might have to mess with expression trees manually
p57418
as(dp57419
g18
V23354
p57420
stp57421
a((dp57422
g2
(lp57423
VIf that is part if the current user's identity, a cookie of some kind would seem the normal approach, but cookies are trivial to spoof unless you make their content either a cryptographically signed value, or an opaque unpredictable lookup (Guid) to some value
p57424
aVIn either case you would also want to make it time-bound to prevent replay
p57425
aVIf you just don't want data on the URL a POST may help, but you can't redirect to a POST
p57426
as(dp57427
g18
V23354
p57428
stp57429
a((dp57430
g2
(lp57431
VHaving two enumerators at the same level that do different things is (IMO) a bad idea
p57432
aVYou can probably force it, but as soon as someone casts your type (especially if casting to the non-generic interface) it is largely guesswork which they will get
p57433
aVI would recommend (instead) making this available via a property, for example , where  offers this enumeration
p57434
aVThen no ambiguity of intent, and no compiler unhappiness
p57435
aVSo I could use:
p57436
aVYou might also consider , which may have some relevence here, especially if you want to data-bind to your list (this isn't necessary if  by itself defines everything cleanly)
p57437
aVIn short:
p57438
as(dp57439
g18
V23354
p57440
stp57441
a((dp57442
g2
(lp57443
V is presumably a delegate-type that accepts a single parameter, or a type that itself takes such a delegate-type in the constructor
p57444
aVYou are declaring an anonymous method, saying simply "when invoked, we'll take the incoming value (but then not use it), and call
p57445
aVYou could also have (maybe clearer):
p57446
aVIt is probably clearer in other uses where it is used, for example:
p57447
aVwhere the lambda is "given an , obtain the 's "
p57448
aVIn your case the lambda is "given , ignore  and call "
p57449
as(dp57450
g18
V23354
p57451
stp57452
a((dp57453
g2
(lp57454
VYou might consider using less to describe the image-path in a variable (pre-generating this as part of the build)
p57455
aVThen you only have one thing to update
p57456
as(dp57457
g18
V23354
p57458
stp57459
a((dp57460
g2
(lp57461
VI can check later (I'm on iPod at the moment) but I believe is it simply a "repeated" set of a dummy type with members key=1 value=2 (using the default types for each - so c# string maps to proto string etc)
p57462
aVI am in the process of re-implementing GetProto for v2, so I'll try to ensure these dummy types are included in the output
p57463
as(dp57464
g18
V23354
p57465
stp57466
a((dp57467
g2
(lp57468
VIMO the fastest way to do this would be with protobuf-net via a DTO (instead of data-table)
p57469
aVProtobuf-net can plug into WCF with just config file changes and had demonstrably the smallest output and fastest processing of any general purpose serializer I know of
p57470
aVI may be biased (I wrote that version) but it is free, so worth a try
p57471
aVBut no data-tables
p57472
aVAnd yea, MTOM helps when passing binary (which protobuf is), but not XML (so MTOM with standard DataTable is pointless)
p57473
as(dp57474
g18
V23354
p57475
stp57476
a((dp57477
g2
(lp57478
VYour  workaround is the closest you'll get
p57479
aVEven if there were a syntax for what you want, method signatures aren't allowed to differ only by generic constraints
p57480
as(dp57481
g18
V23354
p57482
stp57483
a((dp57484
g2
(lp57485
VWow; I see what you mean; that really surprises me
p57486
aVHowever, if you can't think of a good reason to use properties here (and I can't), then stick to s; they avoid a range of problems (accidental unsubscription and inappropriate invocation being the biggest)
p57487
aVThe only thing I can think of is that maybe they needed this for serialization purposes, but I can think of other ways to crack that nut
p57488
aVAlternatively, maybe regular events don't make sense in the crazy "dependency property" / "attached property" / "routed event" world of WF
p57489
as(dp57490
g18
V23354
p57491
stp57492
a((dp57493
g2
(lp57494
VUntested, but something like:
p57495
as(dp57496
g18
V23354
p57497
stp57498
a((dp57499
g2
(lp57500
VIn C# there is (and always been) covariance of arrays of reference-types
p57501
aVIt still is a , but you can legally cast it to an  (and access values as you would expect)
p57502
aVBut try putting in an  (or any other non-string value) and you'll see that it still behaves appropriately (i
p57503
ag50
aVdoesn't let you)
p57504
as(dp57505
g18
V23354
p57506
stp57507
a((dp57508
g2
(lp57509
VI suspect you simply lack;
p57510
aVAt the top of the code file
p57511
aVAnd no, switching to
p57512
aVnet 2 won't help here
p57513
as(dp57514
g18
V23354
p57515
stp57516
a((dp57517
g2
(lp57518
VIn your actual code, is the member:
p57519
aVpublic
p57520
aVread+write (for fields: not readonly; for properties: public get+set)
p57521
aVof a public type
p57522
aVAll 3 must be true
p57523
aVFor nested types, every parent type in the nesting must be public
p57524
aVAdditional things that would exclude it:
p57525
aVnullable and null
p57526
aVis if DefaultValue
p57527
aVa ShouldSerialize or Specified returned false
p57528
aVit is IxmlSerializable
p57529
as(dp57530
g18
V23354
p57531
stp57532
a((dp57533
g2
(lp57534
VData-contract-serializer is
p57535
aVFussy
p57536
aVIn particular, I wonder if simply element order is the problem here
p57537
aVHowever, it is also not necessarily the best tool for working with XML
p57538
aVXmlSerializer is probably a more robust here - it can handle a much better range of XML
p57539
aVDCS simply isn't intended with that as it's primary goal
p57540
aVWith simple XML you often don't even need any attributes etc
p57541
aVYou can even use xsd
p57542
aVexe on your existing XML to generate the matching c# classes (in two steps; XML-to-xsd; xsd-to-c#)
p57543
as(dp57544
g18
V23354
p57545
stp57546
a((dp57547
g2
(lp57548
VActually, there's more; in addition you need to consider buffered vs non-buffered
p57549
aVOrderBy can be deferred, but when iterated must consume the entire stream
p57550
aVIn general, anything in LINQ that returns IEnumerable tends to be deferred - while Min etc (which return values) are not deferred
p57551
aVThe buffering (vs not) can usually be reasoned, but frankly reflector is a pretty quick way of finding out for sure
p57552
aVBut note that often this is an implementation detail anyway
p57553
as(dp57554
g18
V23354
p57555
stp57556
a((dp57557
g2
(lp57558
VLINQ-to-SQL can't translate arbitrary code methods, as they are IL (it expects "expression trees", which is what lambdas and LINQ query syntax a generate)
p57559
aVIf you only need this logic in your
p57560
aVNET code, switch to LINQ-to-Objects before calling, I
p57561
ag50
aVThe AsEnumerable() breaks the LINQ composition in two, allowing your managed code to run as normal
p57562
aVIf you need to do something similar at the database, then write the code in TSQL as a UDF, then map the UDF into LINQ-to-SQL by dragging it onto the designer
p57563
aVYou can then access it as a new method on the data-context, I
p57564
ag50
as(dp57565
g18
V23354
p57566
stp57567
a((dp57568
g2
(lp57569
VHave you tried the "VisualHint" property grid replacement
p57570
aVFor info, for flexible property binding DataTable can be quite handy if you don't want to learn the guts of system
p57571
aVcomponentmodel
p57572
as(dp57573
g18
V23354
p57574
stp57575
a((dp57576
g2
(lp57577
VRather than the row, use the DataRowView that you obtain from a DataView
p57578
aVIirc this is configured for flexible (custom) binding, via ICustomTypeDescriptor
p57579
as(dp57580
g18
V23354
p57581
stp57582
a((dp57583
g2
(lp57584
VCoould you try:
p57585
aVIf not, the same in TSQL using CASE WHEN
p57586
aVTHEN 1 ELSE 0 END
p57587
as(dp57588
g18
V23354
p57589
stp57590
a((dp57591
g2
(lp57592
s(dp57593
g18
V23354
p57594
stp57595
a((dp57596
g2
(lp57597
VStrings and HTML should be fine
p57598
aVThe only complication is escaping, which is made easier using verbatim string literals (@"
p57599
aVThen you just double any double-quotes:
p57600
as(dp57601
g18
V23354
p57602
stp57603
a((dp57604
g2
(lp57605
VActually, like all things - it depends on the data, and the serializer
p57606
aVCommonly (although perhaps unwisely) people mean  for "binary", but this has a number of foibles:
p57607
aVin adds lots of type metadata (which all takes space)
p57608
aVby default it includes field names (which can be verbose, especially for automatically implemented properties)
p57609
aVConversely, xml generally has overheads such as:
p57610
aVtags adding space and IO
p57611
aVthe need to parse tags (which is remarkably expensive)
p57612
aVlots of text encoding/decoding
p57613
aVOf course, xml is easily compressed, adding CPU but hugely reducing bandwidth
p57614
aVBut that doesn't mean one is faster; I would refer you to some sample stats from here (with full source included), to which I've annotated the serializer base (binary, xml, text, etc)
p57615
aVLook in particular at the first two results; it looks like  trumped  on every value, while retaining the cross-platform advantages
p57616
aVOf course, protobuf then trumps  ;p
p57617
aVThese numbers tie in quite well to ServiceStack's benchmarks, here
p57618
as(dp57619
g18
V23354
p57620
stp57621
a((dp57622
g2
(lp57623
VIndeed, that particular arrangement (explicit implementation of a get-only interface property by an automatically implemented property) isn't supported by the language
p57624
aVSo either do it manually (with a field), or write a private auto-implemented prop, and proxy to it
p57625
aVBut to be honest, by the time you've done that you might as well have used a field
p57626
aVor:
p57627
as(dp57628
g18
V23354
p57629
stp57630
a((dp57631
g2
(lp57632
VSure; dotnet-protobufs is a port of the java version, so shares a very similar API and approach to the core google implementation; code-gem, immutability, etc
p57633
aVProtobuf-net is byte compatible, but is a complete from-scratch re-implementation, following standard
p57634
aVNET idioms - so is familiar to users of XmlSerializer etc
p57635
aVIt also works against mutable objects (and immutable depending on the setup, and structs in v2), and has optional hooks for WCF, remoting, etc
p57636
aVBoth can work from
p57637
aVproto (arguably dotnet-protobufs is better at this than protobuf-net); but protobuf-net can work against existing
p57638
aVnet poco/DTO etc without
p57639
aVproto or any codegen
p57640
aVAdditionally, protobuf-net offers things like inheritance support, but you might not choose to use that in your scenario as it doesn't map as easily to
p57641
aVproto definitions
p57642
as(dp57643
g18
V23354
p57644
stp57645
a((dp57646
g2
(lp57647
VWeb data-binding isn't against  (and hence , , etc), but rather
p57648
aVThat would still be fine (the list is ), however  works on a per-object level via  - meaning  doesn't get a look-in
p57649
aVSo, to do this you will need to either implement  on the items, or write a
p57650
aVBoth are tricky
p57651
aVAnd because it is talking about a single , it isn't even going to notice  - you'll need to do this for the concrete implementation(s)
p57652
aVOr easier; just map to a simple class (view-model) to represent your data - it'll save you a lot of time
p57653
as(dp57654
g18
V23354
p57655
stp57656
a((dp57657
g2
(lp57658
VWell, what happens
p57659
aVActually, you should generally be OK, but you'll need to ensure that you configure the web-server (typically IIS) to start from ASP
p57660
aVNET 4
p57661
aVx, not ASP
p57662
aVNET 2
p57663
aVx (this is one of the settings - "where" depends on the version of IIS)
p57664
aVIf in doubt, marking  and  to copy-local (properties against the reference) might help
p57665
aVAlso; there are some tweaks and twiddles you might need when changing to ASP
p57666
aVNET 4
p57667
aVx in IIS 7
p57668
aVx, for example:
p57669
aVchanges to how handlers are configures
p57670
aVchanges to request validation (xss)
p57671
aVetc; we got some YSOD initially until we fixed the config files
p57672
aVRe the update, it sounds like
p57673
aVNET 4
p57674
aVx is installed, and IIS is correctly running ASP
p57675
aVNET 4
p57676
aVx, but MVC 2 does not seem to be installed
p57677
aVGrab it from MSDN or the Web Platform Installer and install on the server
p57678
aVNote that MVC is on a very different release cycle to core
p57679
aVNET
p57680
as(dp57681
g18
V23354
p57682
stp57683
a((dp57684
g2
(lp57685
VBecause there is a real risk of conflicts
p57686
aVHash-codes are not unique
p57687
aVThey can (when different) prove inequality, but never equality
p57688
aVWhen looking for an item:
p57689
aVget the hash-code(s)
p57690
aVif the hash-code is different, the object is different; discard it
p57691
aVif the hash-code is the same, check Equals:
p57692
aVif Equals reports  they are the same
p57693
aVelse discard
p57694
aVConsider
p57695
aVsince hash-code is , it is easy to see that there are lots and lots of conflicts
p57696
as(dp57697
g18
V23354
p57698
stp57699
a((dp57700
g2
(lp57701
VNot sure sqlbulkcopy is the best tool for that
p57702
aVI would look at he BLOB writing TSQL commands via regular SqlCommand (usually in a loop)
p57703
aVHowever I also wonder at the wisdom of storing a huge BLOB in the db when an external file may be preferable an simpler
p57704
as(dp57705
g18
V23354
p57706
stp57707
a((dp57708
g2
(lp57709
VCould you cryptograhpically sign the data (perhaps salted per client)
p57710
aVThe client can have the public key, and you can use that (safely) to prove that the data came from your server
p57711
as(dp57712
g18
V23354
p57713
stp57714
a((dp57715
g2
(lp57716
VAssuming you just want the low bytes:
p57717
aVHowever, since 'int' is 'Int32' that leaves 2 more bytes uncaptured
p57718
as(dp57719
g18
V23354
p57720
stp57721
a((dp57722
g2
(lp57723
VOutside of the declaring class it is deliberately tricky to see what is subscribed, since that is generally not something you need to know
p57724
aVDepending on the scenario, either get very good at tracking when you subscribe, or simply unsubscribe first (which does nothing if you aren't subscribed):
p57725
aVAs long as the handler and target-instance (for non-static handlers) is the same this will:
p57726
aVif subscribed, the net result is that you are still subscribed afterwards
p57727
aVif not subscribed, the net result is that you end up subscribed
p57728
as(dp57729
g18
V23354
p57730
stp57731
a((dp57732
g2
(lp57733
VSomething like:
p57734
aV(I've used  here, but it is easily adjusted to suit any other similar interface)
p57735
as(dp57736
g18
V23354
p57737
stp57738
a((dp57739
g2
(lp57740
VPersonally, I'd wrap it like so:
p57741
aV(the "via a column object" is the most direct (= fastest) indexer)
p57742
as(dp57743
g18
V23354
p57744
stp57745
a((dp57746
g2
(lp57747
VThere are many platform-specific types that can be used easily as long as both endpoints are homogeneous, but which don't map cleanly to xsd or to other platforms
p57748
aVFor example  in
p57749
aVNET is a royal PITA from anywhere else; and anything implementing  in
p57750
aVNET is most-likely completely lying in the schema
p57751
aVIn the interop scenario, it would usually be worth starting from xsd, as that gives a common standard that all reasonable clients should expect
p57752
as(dp57753
g18
V23354
p57754
stp57755
a((dp57756
g2
(lp57757
VYou would use  with the , ,  etc methods
p57758
aVIt is for the consuming code to translate it back to TSQL
p57759
aVNote that for LINQ-to-SQL there are also some additional helper functions here, but not with EF
p57760
as(dp57761
g18
V23354
p57762
stp57763
a((dp57764
g2
(lp57765
VAs a slight variation:
p57766
aVThis takes the set of , and (where  is set) concatenates the combined set of
p57767
aVThe  ensures distinct
p57768
as(dp57769
g18
V23354
p57770
stp57771
a((dp57772
g2
(lp57773
VI suspect you would have to navigate to the parent domain, have it remove the cookie, and then maybe redirect back to the child site (perhaps passing the return url encoded on the query-string)
p57774
as(dp57775
g18
V23354
p57776
stp57777
a((dp57778
g2
(lp57779
s(dp57780
g18
V23354
p57781
stp57782
a((dp57783
g2
(lp57784
VI'm confused; you can get an item out of an  by index simply by:
p57785
aVHowever,  is pretty rare in anything >=
p57786
aVNET 2
p57787
aV0, a  would make this much easier
p57788
aVAlso,  looks to me very much like it should be a  (it is very rare to write a  in
p57789
aVNET, and usually to denote "values" - a customer isn't a "value")
p57790
aVAnd public fields are also very much discouraged
p57791
aVNote that currently you are (because it is a ) actually copying the  whenever you fetch it from (or place it in) the list; that isn't necessarily what you intend
p57792
as(dp57793
g18
V23354
p57794
stp57795
a((dp57796
g2
(lp57797
VAs an aside, it is much quicker to check for an interface, as the CLI is designed for that and has opcodes for it (as does c#: is/as)
p57798
aVChecking attributes requires reflection; much slower
p57799
aVLooking though the other answers most points are covered, but also: attributes are much more limited in terms of what values you can pass into them; mainly primitives and string
p57800
as(dp57801
g18
V23354
p57802
stp57803
a((dp57804
g2
(lp57805
VFor that to work, you need to let the form paint when necessary
p57806
aVThe correct / preferred way is to use a worker thread (perhaps BackgroundWorker) for the long running tasks, calling back to the UI thread periodically to ask it to update the progress
p57807
aVThere is also DoEvents, but that is (frankly) a hack
p57808
as(dp57809
g18
V23354
p57810
stp57811
a((dp57812
g2
(lp57813
VYou can either pass an instance of a UI control to the method (then fall Invoke on that), else wrap up what you want as a delegate; for example:
p57814
aVWith:
p57815
as(dp57816
g18
V23354
p57817
stp57818
a((dp57819
g2
(lp57820
VSimple:
p57821
aVI haven't exhaustively tested it specifically for
p57822
aVNET 4 (since I've been busy hacking v2 into shape), and
p57823
aVI haven't updated the home-page in a while
p57824
aVI am, however, not aware of any reason why this wouldn't work
p57825
aVI can spin up my VM and run the test-suite over
p57826
aVNET 4 if you really want
p57827
as(dp57828
g18
V23354
p57829
stp57830
a((dp57831
g2
(lp57832
VIf you can write it to a temp file (), you can create a new , and use ; however, to do this manually from a , I expect you would need to load it manually with , look at the , and use reflection to invoke it
p57833
aVThe  approach is far easier
p57834
aVOf course, if you can write it to a file, you could also just use  which is even more easy ;p
p57835
aVYou might also want to double-check redist/deployment rights re
p57836
as(dp57837
g18
V23354
p57838
stp57839
a((dp57840
g2
(lp57841
VIn
p57842
aVNET (and unlike things like C++), it is the runtime that provides generics
p57843
aVThe IL is structured to retain all the generic information (contrasting to Java, which uses type erasure)
p57844
aVIn fact, you can create a new  on the fly (via ), and use reflecton:
p57845
aVOT, but re your specific example, I actually recommend a change:
p57846
aVThis will work even if  is null, and supports "lifted" comparisons (against )
p57847
aVYou can also then remove the generic constraint
p57848
aVBut if we look at your original function, the IL is:
p57849
aVYou can see the  (for generics) is there, in full
p57850
aVThe JIT (in most CLI implementations, not all) is responsible for figuring out what is necessary; typically all reference-type implementations share an implementation (since all references look the same under the hood), but each value-type implementation gets a separate JIT (as they have different memory layouts)
p57851
as(dp57852
g18
V23354
p57853
stp57854
a((dp57855
g2
(lp57856
VI would use an interface, like:
p57857
aVwith explicit implementation:
p57858
aVThen I can write a generic extension method to handle this for any :
p57859
aVAnd finally, proxy those methods:
p57860
aVIf you want to avoid an interface, you can use a selector instead:
p57861
as(dp57862
g18
V23354
p57863
stp57864
a((dp57865
g2
(lp57866
VIsn't it just:
p57867
aVElements need names, note
p57868
as(dp57869
g18
V23354
p57870
stp57871
a((dp57872
g2
(lp57873
VJust the (managed) heap
p57874
aVThe stack may have references to objects, but not the objects themselves
p57875
as(dp57876
g18
V23354
p57877
stp57878
a((dp57879
g2
(lp57880
VFor 2, it needs to be:
p57881
aVOtherwise you could attempt to add any ISomeInterface instance to a more-specific list
p57882
as(dp57883
g18
V23354
p57884
stp57885
a((dp57886
g2
(lp57887
VA bit like so
p57888
aVthen:
p57889
as(dp57890
g18
V23354
p57891
stp57892
a((dp57893
g2
(lp57894
VThe sorting support of data-bindings actually depends entirely on the underlying data implementation, and whether it supports , , neither, or both
p57895
aVPersonally: just sort the data separately (via LINQ, perhaps), and then data-bind it
p57896
aVAvoids the entire issue and works for any data source
p57897
as(dp57898
g18
V23354
p57899
stp57900
a((dp57901
g2
(lp57902
VReset is redundant; so much so that it is a requirement in the language spec for iterator blocks to throw an exception on Reset
p57903
aVThe correct thing to do is simply dispose and release the old iterator, and call GetEnumerator again
p57904
aVOr better: avoid having to read it twice, since not all data is repeatable
p57905
as(dp57906
g18
V23354
p57907
stp57908
a((dp57909
g2
(lp57910
VTry "//MyNode" , or "descendant::MyNode"
p57911
as(dp57912
g18
V23354
p57913
stp57914
a((dp57915
g2
(lp57916
VIt is ok to reuse for different parts of the same logical operation (perhaps by passing the data-context in as an argument), hut you shouldnt reuse much beyond that:
p57917
aVit caches objects; this will grow too big very quickly
p57918
aVyou shouldnt sharebit between threads
p57919
aVonce you've hit an exception, it gets very unwise to reuse
p57920
aVEtc
p57921
aVSo: atomic operations fine; a long-life app context; bad
p57922
as(dp57923
g18
V23354
p57924
stp57925
a((dp57926
g2
(lp57927
VMy limited understanding is that you don't usually need to pass the member information; the arguments are taken (by position) from the  parameter
p57928
aVThe member info is (I suspect) intended to help some internal APIs when dealing with things like anonymous-types, which look (in C#) like they are initialized by member (like an object-initializer), but which are actually initialized by constructor
p57929
aVThis means things like LINQ-to-SQL will see a constcutor use, and then (in the next part of the query) access to  - it needs a way to understand that this means "the 3rd parameter to the constructor (which never actually gets called)
p57930
aVIn particular for things like groupings
p57931
aVSo this is fine:
p57932
aVIf you do need them, I would expect them to be positional relative to the "arguments" expressions - so you would pass in (in an array) the member for id and name
p57933
aVNote that there is also a separate expression for intialzer-style binding
p57934
as(dp57935
g18
V23354
p57936
stp57937
a((dp57938
g2
(lp57939
VPushing the domain entities into the dal is an option that would remove the crcular dependency, but may not match your intent
p57940
aVThis isn't unheard of, though; for example LINQ-to-SQL gnerated entities would live in the DAL
p57941
aVOther options:
p57942
aVput them into a common lower assembly (but that may leave your BL rather empty)
p57943
aVuse IOC to remove / reverse the reference between BL/DAL
p57944
aVThere are no single right answers here
p57945
aVRe DataTable; personally I agree - I'm not a fan ;) However, they can be used successfully and reasonably
p57946
aVBut if I had to use them, I'd be keeping them in the DAL as an implementation detail - and not exposing them above that
p57947
as(dp57948
g18
V23354
p57949
stp57950
a((dp57951
g2
(lp57952
VHow about something starting:
p57953
aVRe re question of using the attributes; that introduces reflection which is comparatively slow
p57954
aVI would a avoid it if possible
p57955
as(dp57956
g18
V23354
p57957
stp57958
a((dp57959
g2
(lp57960
VYou could try:
p57961
aVJust to make the compiler happy
p57962
aVWhile arrays implement the generic Enumerable interface, this isn't present on the public GetEnumerator()
p57963
aVWith the above we simply cast to the preferred API
p57964
aVThis is a trivial cast; no check should happen at runtime (since the compiler and CLI know it is valid)
p57965
as(dp57966
g18
V23354
p57967
stp57968
a((dp57969
g2
(lp57970
VAdd :this() to the ctor:
p57971
as(dp57972
g18
V23354
p57973
stp57974
a((dp57975
g2
(lp57976
VSecurity 101 - the client is considered hostile
p57977
aVAny client, in any architecture
p57978
aVThere is nothing particularly insecure about Silverlight, so if that meets your other needs then use it
p57979
aVAnd validate everything at the server; which you need to do anyway
p57980
as(dp57981
g18
V23354
p57982
stp57983
a((dp57984
g2
(lp57985
VLack of attributes isn't a show-stopper; XmlSerializer has a constructor to pass in this model at runtime ( but to be honest, most times the defaults are fine) - as so several other serializers
p57986
aVXML via XmlSerializer is obviously desirable if readability is a concern though
p57987
aVSee XmlAttributeOverrides
p57988
aVI can also suggest some binary serializers that would work here
p57989
as(dp57990
g18
V23354
p57991
stp57992
a((dp57993
g2
(lp57994
VIt looks like the main aim here is to allow you to have a convenient method to ensure that you have a block of data locally; for example, when reading a "double" you would (typically) want 8 bytes
p57995
aVThis method wraps up:
p57996
aVchecking if the internal buffer already has enough
p57997
aVlooping over 'Read' as necessary
p57998
aVchecking for EOF (and erroring)
p57999
aVguarding for overrun
p58000
aVhandling buffer-management, such as either block-copying the data backwards periodically, or handling the various indices for a cyclic buffer
p58001
aVHowever, it seems unlikely you would need to call it externally, unless you were reading a small 'byte[]'
p58002
aVAs for the internal buffer; simply, when deserializing you:
p58003
aVwant to minimise calls to "Read"
p58004
aVoften need to peek-ahead more than 1 byte (tricky without a buffer)
p58005
aVregularly want operations on small 'byte[]' (via BitConverter, for example)
p58006
aVSo just work
p58007
as(dp58008
g18
V23354
p58009
stp58010
a((dp58011
g2
(lp58012
VSimply: profile
p58013
aVEvery app is different
p58014
aVTaking time to reduce some code to make it "more efficient" is meaningless if that is not a bottleneck in you app
p58015
aVAlso - you may even be making things worse if you don't have numbers to support changes
p58016
aVIn most cases IO is the pinch-point, so thinking about IO is a no-brainer
p58017
aVDitto DB access
p58018
aVBut beyond that: measure it
p58019
as(dp58020
g18
V23354
p58021
stp58022
a((dp58023
g2
(lp58024
VI am not at all clear (from the code) what you are trying to do, but to give a classic example of  (for comparison):
p58025
aVHere, an  of length 3 is allocated, then (for each string)  is used to transform from a string to an int; the output should be the  with values ,,
p58026
aVA more complex example (using lambda syntax):
p58027
aVHere the lambda body (which is our converter) reverses each string (by reversing the characters); the result should be the  with values ,,
p58028
as(dp58029
g18
V23354
p58030
stp58031
a((dp58032
g2
(lp58033
VThat is a pain with XmlSerializer, bur fine with DataContractSerialzer (which can also work without the parameterless ctor that XmlSerializer needs)
p58034
aVJust mark the type as [DataContract], and the field (not property) as [DataMember]
p58035
as(dp58036
g18
V23354
p58037
stp58038
a((dp58039
g2
(lp58040
VI assume that 15s is when used in a loop; reflection isn't that slow
p58041
aVYou can speed up reflection (and invoke in particular) by obtaining the MethodInfo and using Delegate
p58042
aVCreateDelegate once
p58043
aVYou then cache and re-use the resulting typed delegate (matching the expected call signature)
p58044
aVThen use the typed delegate Invoke
p58045
aVNote untyped delegate invoke is slow; it must be typed
p58046
aVAlso; you can be sneaky and use a delegate with an extra (leading) parameter to invoke an instance method against a range of different objects, if you need the target object to change per-call
p58047
aVFor more complex scenarios, Expression or DynamicMethod are useful
p58048
as(dp58049
g18
V23354
p58050
stp58051
a((dp58052
g2
(lp58053
VI wonder if adding an UPDLOCK hint to the earlier SELECT(s) would fix this; it should avoid sone deadlock scenarios be preventing another spud getting a read-lock on the data you are about to mutate
p58054
as(dp58055
g18
V23354
p58056
stp58057
a((dp58058
g2
(lp58059
VThat is the default generic error message in ASP
p58060
aVNET
p58061
aVRe the more specific "what kind of error"; impossible for us to say; it could be a configuration error in web
p58062
aVconfig, it could be problems talking to the database, it could simply need a hug and some quiet time
p58063
aVLike the message says, either enable remote debug output, or look at the site from the server, and it'll tell you what is actually happening
p58064
aVOr look in the error log (event-viewer by default), which is perhaps more useful
p58065
aVNote you can replace the error page with something more
p58066
aVuser friendly if you like
p58067
aVLike the lolcatz on stackoverflow
p58068
aVcom
p58069
as(dp58070
g18
V23354
p58071
stp58072
a((dp58073
g2
(lp58074
VIt depends on how often you are doing it
p58075
aVIf this is intermittent (or in fact pretty-much anything except a tight loop), then forget it; what you have is fine
p58076
aVSure an extra string is generated occasionally (the combined substring/space), but it will be collected at generation 0; very cheap
p58077
aVIf you are doing this aggressively (in a loop etc), then use a  instead:
p58078
aVA final (unrelated) point - re "globally" - if you mean , you might want to synchronize access if you have multiple threads
p58079
as(dp58080
g18
V23354
p58081
stp58082
a((dp58083
g2
(lp58084
VNET defines (from your article):
p58085
aVThe primitive types are Boolean, Byte, SByte, Int16, UInt16, Int32, UInt32, Int64, UInt64, Char, Double, and Single
p58086
aVSo no
p58087
aVInbuilt and very important: yes,  but not a primitive
p58088
aVVB uses a slightly different definition to the CLI and C# it seems
p58089
as(dp58090
g18
V23354
p58091
stp58092
a((dp58093
g2
(lp58094
VI'm largely guessing, but it sounds like you are talking about a "protocol handler", i
p58095
ag50
aVto handle hyperlinks to "yourapp:some-stuff-here"
p58096
aVIf so, try looking at Registering an Application to a URL Protocol on MSDN, which gives a C# example of this
p58097
as(dp58098
g18
V23354
p58099
stp58100
a((dp58101
g2
(lp58102
VPerhaps the first thing to try is:
p58103
aVHowever, this doesn't support extensibility via custom types; if you need that, how about:
p58104
aVOr:
p58105
aVwith
p58106
as(dp58107
g18
V23354
p58108
stp58109
a((dp58110
g2
(lp58111
VOh, that is complex
p58112
aVIt depends on whether the  flag is set, which in turn (in C#) depends on whether there is a static constructor
p58113
aVAnd worse; in
p58114
aVNET 4 I believe the behaviour changed to make it more "lazy" than it used to be
p58115
aVFrankly, I wouldn't code to any specific behaviour here; simply: static fields will be initialized before you try to use them, as long as you use regular code to access them
p58116
aVJon Skeet has a good write-up on this here and here
p58117
as(dp58118
g18
V23354
p58119
stp58120
a((dp58121
g2
(lp58122
VExactly the same as you would any other parameter
p58123
aVof course it depends on how you are doing your data-access, but if we assume a  you'd just refer to a named parameter ( / ) in the TSQL, and add named s (with ) to the command:
p58124
aVWith LINQ etc you'd just use it in the query, i
p58125
ag50
aVI'm using a simple count in the examples just to keep it simple; obviously you can  from a  etc too
p58126
as(dp58127
g18
V23354
p58128
stp58129
a((dp58130
g2
(lp58131
VIf the schema is the same (like it sounds), you should be able to use the same model, but just use different connection-strings / connections to initialize two data-context instances
p58132
aVThe problem however, is likely to be detaching objects from one model to pass to the other, and all the primary key goodness
p58133
aVIn essence, I would recommend copying the objects and passing different objects with different keys to the second model
p58134
aVAlso, if the volume is very high, you might find  coupled to  useful; but that doesn't use LINQ-to-SQL at all
p58135
as(dp58136
g18
V23354
p58137
stp58138
a((dp58139
g2
(lp58140
VSince (in comments on the question) you are aware of the pitfalls of the "inner platform effect", it is also true that this is a very common requirement - in particular to store custom user-defined columns
p58141
aVAnd indeed, most teams have needed this
p58142
aVHaving tried various approaches, the one which I have found most successful is to keep the extra data in-line with the record - in particular, this makes it simple to obtain the data without requiring extra steps like a second complex query on an external table, and it means that all the values share things like timestamp/rowversion for concurrency
p58143
aVIn particular, I've found a  column (for example text or binary; typically json / xml, but could be more exotic) a very effective way to work, acting as a property-bag for the additional data
p58144
aVAnd you don't have to parse it (or indeed,  it) until you know you need the extra data
p58145
aVAll you then need is a way to tie named keys to expected types, but you need that metadata anyway
p58146
aVI will, however, stress the importance of making the data portable; don't (for example) store any specific platform-bespoke serialization (for example,  for
p58147
aVNET) - things like xml / json are fine
p58148
aVFinally, your RDBMS may also work with this column; for example, SQL Server has the xml data type that allows you to run specific queries and other operations on xml data
p58149
aVYou must make your own decision whether that is a help or a hindrance ;p
p58150
aVIf you also need to add tables, I wonder if you are truly using the RDBMS as an RDBMS; at that point I would consider switching from an RDBMS to a document-database such as CouchDB or Raven DB
p58151
as(dp58152
g18
V23354
p58153
stp58154
a((dp58155
g2
(lp58156
VHow about:
p58157
aVHere:
p58158
aVis a non-buffering filter that restricts us to
p58159
aVis short-circuiting, so returns true as soon as a match is found
p58160
as(dp58161
g18
V23354
p58162
stp58163
a((dp58164
g2
(lp58165
VIt seems odd to assemble each output file in memory; I suspect you should be running an inner buffer (maybe 20k or something) and calling  more frequently
p58166
aVUltimately, if you need IO, you need IO
p58167
aVIf you want to be courteous to a shared hosting environment you could add deliberate pauses - maybe short pauses within the inner loop, and a longer pause (maybe 1s) in the outer loop
p58168
aVThis won't affect your overall timing much, but may help other processes get some IO
p58169
aVExample of a buffer for the inner-loop:
p58170
as(dp58171
g18
V23354
p58172
stp58173
a((dp58174
g2
(lp58175
Vwhat is
p58176
aVIf you mean "parse as a decimal, then cast to int":
p58177
aVIf it is known to be an integer, just:
p58178
aVActually, since you are only interested in the last digit, you could cheat:
p58179
as(dp58180
g18
V23354
p58181
stp58182
a((dp58183
g2
(lp58184
VIt does its job, which is to allow you to safely round-trip unexpected data without loss
p58185
aVAllowing old clients to talk to new servers, and new clients to talk to old servers
p58186
aVRe "changes to old member types"; if you mean you've changed the definition of an existing member, then frankly all bets are off
p58187
aVMost serializers work on a contract (implicit or explicit) about the data
p58188
aVIf you change a member, you have broken the contract
p58189
aVIt is generally better to replace a member rather than change it; or better - version the entire DTO (i
p58190
ag50
aVrelease a new contract, that is independent to the original)
p58191
aVActually, my biggest gripe about this interface is that it deals with a concrete implementation ()
p58192
aVBut that is more related to my specific whims, from the perspective of someone who maintains a serialization utility library
p58193
as(dp58194
g18
V23354
p58195
stp58196
a((dp58197
g2
(lp58198
VA dictionary only has one value per key, so there is no need to foreach
p58199
aVyou might just check whether it is there ( or ):
p58200
aVIf  is actually a list, then you could of course do:
p58201
aVA lookup () has multiple values per key, and is just:
p58202
as(dp58203
g18
V23354
p58204
stp58205
a((dp58206
g2
(lp58207
VAs always, the first thing to do is to look at what similar code in c# generates as IL, for example via reflector
p58208
aVI'm not at a PC but that "ceq" looks suspect; that only works for some primitives and references; a "lifted" equals would check HasValue of each, get the values of each, and use the appropriate equality test - possibly by "ceq", but possibly via static-call to the equality operator (op_*)
p58209
as(dp58210
g18
V23354
p58211
stp58212
a((dp58213
g2
(lp58214
VUntested, but you could try:
p58215
aVas in TSQL it doesn't make sense to filter just part of a query
p58216
aVIf you need the first set first, perhaps introduce a dummy value:
p58217
as(dp58218
g18
V23354
p58219
stp58220
a((dp58221
g2
(lp58222
VHmm - an excellent question; I've done lots of data-binding to objects, and I would have sworn that what you are doing should work; but indeed it is very reluctant to notice the change to the inner object
p58223
aVI've managed to get it working by:
p58224
aVNot ideal, but it works
p58225
aVBtw; you might find the following utility methods useful:
p58226
aVThen you can have:
p58227
aVAnd in the bargain it fixes the (slim) chance of a null-exception (race-condition)
p58228
aVFull test rig, to iron out kinks (from comments):
p58229
as(dp58230
g18
V23354
p58231
stp58232
a((dp58233
g2
(lp58234
VAny and all can work; for simple objects, the approach I've used most commonly (in that scenario) is serialization to create a deep-clone without needing to maintain any code
p58235
aVIf you need to undo, just deserialize the snapshot
p58236
aVHowever, this works best if the object you want to undo isn't already in 27 properties and collections scattered over the model; in that scenario you might have to do a lot more work
p58237
as(dp58238
g18
V23354
p58239
stp58240
a((dp58241
g2
(lp58242
VWell,  would apply to  - in which case  or  - but you seem to mean  - in which case just:
p58243
aVHowever, I would advise doing this as a UI concern rather than in the database
p58244
aVYou may also want to think about how close to 0 it needs to be (floating point rounding etc)
p58245
as(dp58246
g18
V23354
p58247
stp58248
a((dp58249
g2
(lp58250
VIt sounds to me like  (or one of the properties) exposes this dependency on the public API - perhaps it is a base-class for the type
p58251
aVSimply: add the missing reference as it instructs
p58252
as(dp58253
g18
V23354
p58254
stp58255
a((dp58256
g2
(lp58257
VThe  is easy enough - you could have:
p58258
aVthen:
p58259
aVThe  is trickier - does it really need this value
p58260
aVA public property would be easier:
p58261
aVetc
p58262
aVThere isn't any inbuilt (language) support for parameterised generic constructors
p58263
aVYou can hack around it, but in many cases the parameterised forms of  are fast enough (when compared to data-access over a network, reflection is negligible)
p58264
aVIf you need a parameterised version it can be done with  etc (let me know if you want an example)
p58265
as(dp58266
g18
V23354
p58267
stp58268
a((dp58269
g2
(lp58270
VThe normal way of doing this is with a callback, I
p58271
ag50
aVYour "getDBaseData" would have an extra parameter, for example:
p58272
aVNote that due to async operations, the "when loaded" itself is probably inside a callback to $
p58273
aVpost or similar
p58274
aVYou could (optionally) also pass data directly to the callback
p58275
as(dp58276
g18
V23354
p58277
stp58278
a((dp58279
g2
(lp58280
VIf the
p58281
aVxml/
p58282
aVpdb are marked as build-action "Content" (etc), you can change them to "None"
p58283
aVYou should also ensure they copy-to-build-output is false
p58284
aVAre both of those set
p58285
as(dp58286
g18
V23354
p58287
stp58288
a((dp58289
g2
(lp58290
VIf we're talking regular LINQ, then we're focusing on  (LINQ-to-Objects) and  (LINQ-to-most-other-stuff)
p58291
aVSince , it is automatic that you can use  - but what this means is very query-specific, since LINQ is generally lazily spooling data from an underlying source
p58292
aVIndeed, that source can be infinite:
p58293
aVHowever, a  loop requires the length and an indexer
p58294
aVWhich in real terms, typically means calling  or :
p58295
aVThis is interesting in various ways: firstly, it will die for infinite sequences ;p
p58296
aVHowever, it also moves the spooling earlier
p58297
aVSo if we are reading from an external data source, the / loop over the list will be quicker, but simply because we've moved a lot of work to  (or , etc)
p58298
aVAnother important feature of performing the  earlier is that you have closed the reader
p58299
aVYou might need to operate on data inside the list, and that isn't always possible while a reader is open; iterators break while enumerating, for example - or perhaps more notably, unless you use "MARS" SQL Server only allows one reader per connection
p58300
aVAs a counterpoint, that reeks of "n+1", so watch for that too
p58301
aVOver a local list/array/etc, is is largely redundant which loop strategy you use
p58302
as(dp58303
g18
V23354
p58304
stp58305
a((dp58306
g2
(lp58307
VCopying between streams is pretty basic:
p58308
aVSo just plug that in, and you should be sorted:
p58309
as(dp58310
g18
V23354
p58311
stp58312
a((dp58313
g2
(lp58314
VBy keeping a counter rather than looking at the index
p58315
aVFor example:
p58316
aV(the  usage is essential to avoid getting race-conditions on accessing )
p58317
as(dp58318
g18
V23354
p58319
stp58320
a((dp58321
g2
(lp58322
VThat kit is historically famously full of errors, with errata here
p58323
aVIf it helps, the first edition had not 1, not 2, not 3 but 4 erratas
p58324
aVYou did well to spot it, but you should be very cautious here, and indeed try to verify anything you are not 100% sure of
p58325
as(dp58326
g18
V23354
p58327
stp58328
a((dp58329
g2
(lp58330
VAssuming you mean "in the process"
p58331
aVan  is such a significant item that you should really know when you are creating one, and track/manage the lifetime
p58332
aVThere isn't an easy way to find all the s in the process, AFAIK
p58333
as(dp58334
g18
V23354
p58335
stp58336
a((dp58337
g2
(lp58338
VYou can (for example) use a container object to make it trivial to control "books"
p58339
aVAnother option (for two levels) is XmlArray/XmlArrayItem
p58340
as(dp58341
g18
V23354
p58342
stp58343
a((dp58344
g2
(lp58345
VA lot of answers here indicate that c# is windows mobile / CE only; that is incorrect
p58346
aVIn addition to targetting windows mobile and phone 7, c# can be uses to target iPhone via MonoTouch, and Android via MonoDroid
p58347
aVSo that is the main contenders really
p58348
as(dp58349
g18
V23354
p58350
stp58351
a((dp58352
g2
(lp58353
VThe obly way to answer "faster" is to time it for your typical data
p58354
aVHowever the dictionary is more convenient (no need to cast) and efficient (no boxing)
p58355
aVIf the data keys are contiguous, however, it would be better just to use a List-of-double, and use the key as the index (with offset if your data doesn't start at 0)
p58356
as(dp58357
g18
V23354
p58358
stp58359
a((dp58360
g2
(lp58361
VAdding  doesn't impact performance; simply most classes don't need to be serializable, and the ability to store internal state doesn't always make sense - it only really makes sense for "entity"or "DTO" objects
p58362
aVSome things to watch: make sure events aren't serialized; mark then  - otherwise you might grow more data than you expect ;p
p58363
aVAlso;  can be
p58364
aVrather voluminous
p58365
aVIf you want smaller data, I would suggest looking at (for example) protobuf-net (100% free), which you can hook via  - it is generally significantly more efficient than
p58366
aVLet me know if you are interested in more details
p58367
as(dp58368
g18
V23354
p58369
stp58370
a((dp58371
g2
(lp58372
VOr an alternative:
p58373
as(dp58374
g18
V23354
p58375
stp58376
a((dp58377
g2
(lp58378
VUltimately the database doesn't know about data-contexts, so simply: the rules of transactions apply
p58379
aVBeing a serializable transaction, things like read locks and key-range-locks will be issued and honoured
p58380
aVAs always, there is a risk of complication from deadlocks, but ultimately it should work
p58381
aVNote that all the contexts involved should enlist as required
p58382
as(dp58383
g18
V23354
p58384
stp58385
a((dp58386
g2
(lp58387
VHow threadsafe is Protobuf
p58388
aVnet for that kind of thing
p58389
aVWell, it noticed something odd happening :)
p58390
aVJust add a call to Serializer
p58391
aVPrepareSerializer at some point before the theading (app startup being the obvious point) and it should forgive you
p58392
aVEdit: thinking about it, there is a fairly simple change I can make to help that specific scenario; I'll tweak that when I get a chance
p58393
aVAlso, this should only affect the unreleased "v2" code (from sorce code) - the pre-built dll is not affected by this AFAIK
p58394
as(dp58395
g18
V23354
p58396
stp58397
a((dp58398
g2
(lp58399
VUnless I read the question wrong, you could have:
p58400
aVWith T=A and U=B, both constraints are happy, but the cast from T to U is clearly invalid
p58401
aVIf U is just another class, then the same still applies; the T is not known to be in the same chain as U unless you state it in the constraints (generic constraints can involve other generic type arguments, if it helps)
p58402
as(dp58403
g18
V23354
p58404
stp58405
a((dp58406
g2
(lp58407
VRe 3 connections; you might want to make those methods aware of a data-context, either by passing it is as an argument, or using partial classes or extension methods to add your method to the data-context (assuming it is the same type of data-context each time)
p58408
aVThat will maximise connection reuse and object-identity re-use
p58409
aVRe the transaction; the submit should already be transactional
p58410
aVThe question, then, is do I need my reads in the same transaction
p58411
aVAnd that depends :) Often it is ok not to, but you can get issues with phantom reads etc
p58412
aVDoing the reads inside a Serializable transaction (as you are) ensures that the read data will not change until the transaction commits
p58413
aVThis can negatively impact throughput (especially if a distributed transaction gets involved, hence the desire to maximise connection reuse), however, and (in some cases, unless UPDLOCK is issued) introduce extra deadlocks
p58414
aVSo it is a trade-off
p58415
aVAnd it depends on your specific scenario
p58416
aVAs an example of re-writing those as to pass in the context:
p58417
aVAnd now you can pass in your context; you could perhaps overload the method if you want to still offer this as an option without passing in the context explicitly:
p58418
as(dp58419
g18
V23354
p58420
stp58421
a((dp58422
g2
(lp58423
VI'll check the project files for a problem (that _fixed looks highly suspicious) but unless you need the "v2" features it may be easier to use the pre-built dll that can be downloaded
p58424
aVSince this appears to relate to pre-release software it may be easier to e-mail me (as the author) directly
p58425
aVFor info, there are some bat files in the repo that should cleanly build the core project for common
p58426
aVnet versions
p58427
aVI can't check right now (away from PC)
p58428
as(dp58429
g18
V23354
p58430
stp58431
a((dp58432
g2
(lp58433
VVarious options:
p58434
aVremove the cyclic dependencies from your model; this might be tricky for a generated model that has lots of existing code built against it, but is worth a try; however, you typically want to not serialize the parent, which is exactly what LINQ-to-SQL wants you to keep (it'll let you drop the children property, but that is what you usually want to serialize)
p58435
aVenable cyclic references; it looks like you've tried this without success; did you enable it at both ends, though
p58436
aVActually I wouldn't be surprised if Silverlight doesn't like this extension (it has limited extension support)
p58437
aVuse a separate (flat) DTO model for data transfer purposes
p58438
aVtry using NetDataContractSerializer; I can't remember if this is supported in Silverlight, and I must admit I'm not its biggest fan, but it might be a pragmatic fix here
p58439
aVI'd vote firmly in the "DTO model" category; simply, having a separate model means you are less likely to run into tangles whenever you tweak the DB - and you are in complete control over it
p58440
as(dp58441
g18
V23354
p58442
stp58443
a((dp58444
g2
(lp58445
VI'd say it is primarily the responsibility of the requirements
p58446
aVOnly when you have a stated security requirement/policy can you implement and test it
p58447
aVWhether it is the database layer depends on a few factors; security inside the database is possible, but tends to be expensive - by which I mean:
p58448
aVless connection pooling if you use connection identity
p58449
aVoverheads if you have to encrypt the data/connection
p58450
aVBut it is an option (albeit it one generally reserved for the most security-critical applications, where even DBAs aren't allowed to read the data); other than that
p58451
aVsecurity is largely a cross-cutting concern
p58452
aVYou'll certainly need a security implementation specific to the UI layer (since it is handling the cookies etc), but most of the work tends to be part of business logic
p58453
as(dp58454
g18
V23354
p58455
stp58456
a((dp58457
g2
(lp58458
VYou came very close:
p58459
aVHowever, you may find it a lot easier to use either serialization or LINQ-to-XML
p58460
as(dp58461
g18
V23354
p58462
stp58463
a((dp58464
g2
(lp58465
VYou could try:
p58466
aVwhich for me, gives:
p58467
as(dp58468
g18
V23354
p58469
stp58470
a((dp58471
g2
(lp58472
VPerhaps something like:
p58473
aVNote this doesn't do anything re encryption; that is a separate concern
p58474
aVYou might also find that adding deflate into the mix reduces file IO and increases performance:
p58475
as(dp58476
g18
V23354
p58477
stp58478
a((dp58479
g2
(lp58480
VI would guess:
p58481
aV(now verified; that works fine) - note that you may need to use  to switch between relative site paths and physical disk paths, and that the results of  are full paths
p58482
as(dp58483
g18
V23354
p58484
stp58485
a((dp58486
g2
(lp58487
VAnything beyond standard inheritance
p58488
as(dp58489
g18
V23354
p58490
stp58491
a((dp58492
g2
(lp58493
VYou should be able to use:
p58494
aVAs a side note,  has the advantage of special handling - it can invoke that one with typed-invoke, rather than reflection-invoke - and perhaps more importantly offers checking of the args ahead of time; personally I would just use:
p58495
as(dp58496
g18
V23354
p58497
stp58498
a((dp58499
g2
(lp58500
VThreading is tricky - which is "best" depends on the very specific scenario
p58501
aVFor example, on a web server "best" may be not to use threading at all, and let other threads handle other requests
p58502
aVOne thing you should avoid is saturating the , as other core parts of the system depend on that
p58503
aVIt sounds like a multiple-reader worker queue would serve your purposes; note also that
p58504
aVNET 4
p58505
aV0 introduces a range of controlls (around "Parallel" and "Tasks") that make threaded code easier to handle
p58506
aVA reasonable overview is here
p58507
as(dp58508
g18
V23354
p58509
stp58510
a((dp58511
g2
(lp58512
VHow does it have the same name
p58513
aVThat shouldnt (AFAIK) be commonly possible
p58514
aVIf the problem is with a base-class, maybe:
p58515
aVIf you mean method vs variable, then:
p58516
aVOther than that, the only way I see a problem is it you have "foo" and "Foo", and are calling from a case-insensitive language like VB
p58517
as(dp58518
g18
V23354
p58519
stp58520
a((dp58521
g2
(lp58522
V8 bits (unsigned) is 0 thru 255, or (2^8)-1
p58523
aVIt sounds like you are confusing integer vs text representations of data
p58524
as(dp58525
g18
V23354
p58526
stp58527
a((dp58528
g2
(lp58529
VThat is indeed the only way to add (the appearance of) a method to an enum
p58530
aVNote that in C# the extension method would be defined on a static class, but that is a trivial difference, largely one of nomenclature
p58531
as(dp58532
g18
V23354
p58533
stp58534
a((dp58535
g2
(lp58536
VUltimately they are surprisingly similar; simply, the compiler creates the hidden method internally for the anonymous case
p58537
aVThere is no specific performance difference, although there are cases when it might choose to create a static method (if it doesn't use  or any captured variables) - that may help marginally (but not enough to get excited about)
p58538
aVI would use an anonymous method when:
p58539
aVit is short and is logically related to the code that inits the anonymous method
p58540
aVit perhaps uses additional context (captured variables) that are tricky to pass into
p58541
aVThe main thing to watch is the notorious  (typically) captured variable gotcha, but in some cases it is also possible to bleed a reference into the anonymous method, extending the life-time of a big object unexpectedly
p58542
aVFor longer work, I would use the  apprach
p58543
as(dp58544
g18
V23354
p58545
stp58546
a((dp58547
g2
(lp58548
VI'm pretty sure (haven't checked) that it supports the  axis, so you could either find the node  and then find  - or (simpler) just use  if you are sure that the  always immediately follows the
p58549
aVFor example:
p58550
as(dp58551
g18
V23354
p58552
stp58553
a((dp58554
g2
(lp58555
VIf  and  don't have anything in common (except they look the same), the compiler is out of luck
p58556
aVOptions:
p58557
aVinheritance (sometimes)
p58558
aVadd a conversion operator to either of the types
p58559
aVadd a  etc extension method if the types are outside of your control
p58560
aVtry automapper
p58561
aVuse serialization (there are ways of making some serializers work with different names etc)
p58562
aVI would go for the first 2 options first
p58563
aVNote that with  you can use convert all, i
p58564
ag50
ag6864
aVFor other types, the LINQ  method is equivalent to
p58565
as(dp58566
g18
V23354
p58567
stp58568
a((dp58569
g2
(lp58570
VIs Covariance and contravariance only applicables for delegates in c#
p58571
aVNot quite; the language-level variance can also apply to interfaces, for example
p58572
aV(likewise  is fine too)
p58573
aVI should also note that arrays of reference-types are also covariant:
p58574
aVCan we have Covariance and contravariance in normal class hierarchies
p58575
aVNo; it does not apply to classes / structs (although you can of course implement a covariant interface, and coerce to that interface)
p58576
as(dp58577
g18
V23354
p58578
stp58579
a((dp58580
g2
(lp58581
VYou mention not wanting to use SSIS - but have you considered SqlBulkCopy
p58582
aVThen there is no need for anything except
p58583
aVNET yet you can still use the fastest/most-direct import
p58584
aVThis will accept a DataTable, so you can prepare your data in a DataTable and then pull the trigger
p58585
aVTransactions are optionally supported IIRC
p58586
aVFor larger data you can also implement IDataReader to provide fully streaming upload (while still processing each row in transit)
p58587
as(dp58588
g18
V23354
p58589
stp58590
a((dp58591
g2
(lp58592
VThat pretty much sounds like the stream has closed
p58593
aVOtherwise yes: it would block
p58594
aVMy guess: network #fail
p58595
as(dp58596
g18
V23354
p58597
stp58598
a((dp58599
g2
(lp58600
V is declared as being , but it you look at the second query, you aren't actually returning students - you are returning a compiler-generated type composed of ,  and
p58601
aVTry changing the second query to end with:
p58602
aVEdit:
p58603
aVRe needing data other than , then you might try a trick to give  a type; I'll use C# for my illustration, as my VB is read-only:
p58604
as(dp58605
g18
V23354
p58606
stp58607
a((dp58608
g2
(lp58609
VOh, that is an excellent question
p58610
aVThat isn't currently exposed, but if desired I could add an overload with an  (to include both the overhead of the lentgh-prefix and the object itself, since both have been consumed)
p58611
aVI'm trying to avoid too many changes to "v1", but I could certainly add that into "v2" without too much bother
p58612
as(dp58613
g18
V23354
p58614
stp58615
a((dp58616
g2
(lp58617
VI don't know off the top of my head; I can investigate, but not right at this moment
p58618
aVAs a pragmatic workaround (until I can find why), perhaps return something like a  class that contains a  as a member
p58619
as(dp58620
g18
V23354
p58621
stp58622
a((dp58623
g2
(lp58624
VIn general you should - however, there are times (especially when writing library code) when it is not possible (or certainly not convenient) to know about the calling type (even in terms of ), so non-generic types (mainly interfaces such as , ) are very useful
p58625
aVData-binding is a good example of this
p58626
aVIndeed, anything that involves reflection is generally made much harder by using generics, and since (via the nature of reflection) you've already lost those benefits, you may as well just drop to non-generic code
p58627
aVReflection and generics are not very good friends at all
p58628
as(dp58629
g18
V23354
p58630
stp58631
a((dp58632
g2
(lp58633
VHowever, note that personally I'd be looking for a way to do this at the DB, rather than fetching all that data over the network just to get a single number
p58634
aVA good option would be to push the code into a UDF, and change the SP so simply  - the reason being that UDFs are composable, so you could map the UDF into the data-context and have:
p58635
aV(i
p58636
ag50
aVthe same code), and it would do the work at the server, just bringing back a single number over the network
p58637
as(dp58638
g18
V23354
p58639
stp58640
a((dp58641
g2
(lp58642
VAnd it is fixed
p58643
aVThis also works for things like ,  via a range of conversion operators defined on the nodes, so it is easier to write and safer re missing data
p58644
as(dp58645
g18
V23354
p58646
stp58647
a((dp58648
g2
(lp58649
VYou could just re-write it as a static method:
p58650
aV(note: the above is just for illustration; there are real problems associated with a static data-context () - don't do that
p58651
aVIt should really use a  method or similar, that worries about that)
p58652
as(dp58653
g18
V23354
p58654
stp58655
a((dp58656
g2
(lp58657
VYou would need at least two interfaces; and rather than return  for , trust the creating code to know what it created:
p58658
as(dp58659
g18
V23354
p58660
stp58661
a((dp58662
g2
(lp58663
VYou pretty much can't
p58664
aVFirstly,
p58665
aVNET/C# don't have checked-exceptions like Java, and secondly there are a number of general exceptions that could happen for any freaky reason
p58666
aVOn a method-by-method basis, you can decorate methods with the exceptions they raise, but this is not guaranteed to be present, accurate or complete
p58667
aVIn general, though, any unexpected* exception should be treated as terminal; just unwind, cleaning up () etc as you go and propagate the exception - or at least log it if the operation isn't critical
p58668
aV*=I'll leave aside the philosophical discussion of whether an exception should every truly be expected as such
p58669
as(dp58670
g18
V23354
p58671
stp58672
a((dp58673
g2
(lp58674
VIs that the actual code
p58675
aVThe only unclear thing there is: what does Find() return
p58676
aVIt sounds like the ToList is helping here by breaking composition and using LINQ-to-Objects, in which case AsEnumerable() should work just as well
p58677
aVAfter that you just do a Select (which for L2O just takes each item in turn and applies the map)
p58678
aVIf Find() is something more exotic, it sounds like a bug in that LINQ provider (or perhaps more fairly: that provider struggling to cope with an atypical construct)
p58679
aVHard to say more without a fully reproducible example
p58680
as(dp58681
g18
V23354
p58682
stp58683
a((dp58684
g2
(lp58685
Vor in 2
p58686
aV0:
p58687
as(dp58688
g18
V23354
p58689
stp58690
a((dp58691
g2
(lp58692
VRe the "imagine I had 3" comment: then you have 3 ;) (or 3 pairs)
p58693
aVOne alternative there (as the params increases) is to create a class that represents the query parameters, then there is only 1 formal parameter
p58694
aVPlus you can add options painlessly
p58695
aVFor example:
p58696
as(dp58697
g18
V23354
p58698
stp58699
a((dp58700
g2
(lp58701
VI am very sure of the cross-over between this and the other question - however, it sounds to me like you are approaching this from the wrong end
p58702
aVI would write this as a TSQL script, making use of  to avoid problems with the checker, for example:
p58703
aVThen you can gradually extend this script as your schema changes, and all you need to do is re-run the script for it to update the database
p58704
as(dp58705
g18
V23354
p58706
stp58707
a((dp58708
g2
(lp58709
VThe problem is that it is noticing that the associated  supports enumerated values
p58710
aVWe need to disable that; note we can also inherit from the default implementations to get things like the color preview painting (examples in C#, but should be easy to translate):
p58711
aVIf you want this to apply to all  properties, there is also a way to do it such that you don't need to decorate every property; somewhere during your app's initialization code, execute:
p58712
as(dp58713
g18
V23354
p58714
stp58715
a((dp58716
g2
(lp58717
VPrior to
p58718
aVNET 3
p58719
aV5, it was fairly common to declare your own
p58720
aVNow,  is a good candidate, but  was commonly used (fairly confusingly), or  if you were already referencing winforms
p58721
aVA quick test (note, running in
p58722
aVNET 4
p58723
aV0, using just some libraries - so not exhaustive):
p58724
aVshows some more candidates:
p58725
as(dp58726
g18
V23354
p58727
stp58728
a((dp58729
g2
(lp58730
V would be the first thing to look at
p58731
aVIt combines multiple assemblies into a single assembly (note that the core runtime is still required, etc; it isn't a full linker)
p58732
as(dp58733
g18
V23354
p58734
stp58735
a((dp58736
g2
(lp58737
VIn terms of compiler, the largest difference I can think of (except the obvious "inputs" and "outputs") is the generics implementation, since both have generics, but very different (type erasure vs runtime-assisted)
p58738
aVThe boxing model is obviously different, but I'm not sure that is huge for the compiler
p58739
aVThe are obvious difference in features in terms of anonymous methods, anonymous inner classes, lambdas, delegates, etc but that is hard to compare 1:1
p58740
aVUltimately, though, only your professor knows the answer he is looking for (and all due respect to professors, but don't necessarily be surprised if his answer is a year-or-more out of date with the bleeding edge)
p58741
as(dp58742
g18
V23354
p58743
stp58744
a((dp58745
g2
(lp58746
VFirstly, DTOs make lousy structs; structs should be values (not entities), immutable, and small
p58747
aVYour Woah is none of these
p58748
aVIt should be a class
p58749
aVOne approach here might be a recursive function, which for small bits of logic you can (if you choose) re-write as an anonymous method:
p58750
aVHowever, personally I think  would be simpler here
p58751
aVwith types:
p58752
as(dp58753
g18
V23354
p58754
stp58755
a((dp58756
g2
(lp58757
VYou probably want to map that to a file path (example using C# syntax):
p58758
aVhowever - the naked file system isn't necessarily the best option for this data - or at least, you would need to sanitize it before allowing upload of some file types
p58759
aVAlso, you might (depending on scale) need to think about multiple servers, etc
p58760
as(dp58761
g18
V23354
p58762
stp58763
a((dp58764
g2
(lp58765
VPersonally, I'd be tempted to do something like:
p58766
aVAnd actually then you probabaly don't need those bools:
p58767
aVOr you could replace with properties:
p58768
aVIf you need the bools, perhaps:
p58769
as(dp58770
g18
V23354
p58771
stp58772
a((dp58773
g2
(lp58774
VStrings are immutable; to change an individual character you might use:
p58775
as(dp58776
g18
V23354
p58777
stp58778
a((dp58779
g2
(lp58780
VWhen you execute the console from PsExec, check whether the process actually does finish
p58781
aVMy suspicion is that it has either hung waiting on input (for example, is it trying to read from stdin, and blocking
p58782
aV, or has thrown an exception and is currently (for example) in a "oops: {0} happened; press any key to exit"
p58783
aVClassic reasons for an exe to fail when executed like this:
p58784
aVthe working directory is not what you expected it to be (i
p58785
ag50
aVit is in the PsExec folder, not your app's folder)
p58786
aVthe user (who is no longer the interactive user - it could even be a guest account) lacks a necessary permission, or something ins't installed for that user
p58787
aVit might even be trying to show you the UAC dialog somewhere
p58788
as(dp58789
g18
V23354
p58790
stp58791
a((dp58792
g2
(lp58793
VThe fact that you are loading the data via a web-service makes me wonder whether you should perhaps load this data async, via either an ajax-loaded , or an ; i
p58794
ag50
aVthe widget(s) is(/are) downloaded in separate requests
p58795
aVThis gets you two advantages:
p58796
aVthe core page is not delayed at all by obtaining the data - that should load briefly after the main page does
p58797
aVif the panel fails to load
p58798
aVmeh (assuming it is nice-to-have-but-not-critical)
p58799
aVThe disadvantage is an additional round-trip, but by comparison to everything else happening, this doesn't necessarily pose a problem
p58800
as(dp58801
g18
V23354
p58802
stp58803
a((dp58804
g2
(lp58805
V(tested successfully)
p58806
aVThere are two issues this addresses:
p58807
aVthe  helps it handle the issue of passing an  as a single parameter of method that takes a  argument
p58808
aVthe  helps resolve the non-public constructor
p58809
aV(the two s relate to the binder; the default binder behaviour is fine for what we want)
p58810
as(dp58811
g18
V23354
p58812
stp58813
a((dp58814
g2
(lp58815
VIf you are using click-once deployment (i
p58816
ag50
aV"publish" in VS for a windows exe), you can specify file associations there, and it will do everything for you
p58817
aVI can't guarantee that it'll take precedence over notepad, though
p58818
aVFor that you might need a proper installer
p58819
aVMSDN shows how
p58820
as(dp58821
g18
V23354
p58822
stp58823
a((dp58824
g2
(lp58825
VRe the thread index; note that the degree of parallelism is (IIRC) only the maximum number of threads to use; it doesn't have to use that number
p58826
aVRelying on  in the way you describe would seem to mean that you might actually only access
p58827
aVSo in short, no: I don't think so
p58828
aVYou can, however, get the item index; so if that is what you mean, simply:
p58829
aVIt sounds (comments) like the intent is for obtaining a working buffer; in which case, I would (and indeed, do) keep a few convenient buffers in a container (with synchronized access etc), i
p58830
ag50
aVattempt to obtain an existing buffer from a container (synchronized)
p58831
aVif not found, create a new buffer
p58832
aV(do work)
p58833
aVreturn/add buffer to the container (synchronized)
p58834
aVThis will generally be very fast (much faster than buffer-allocation per iteration)
p58835
as(dp58836
g18
V23354
p58837
stp58838
a((dp58839
g2
(lp58840
VThe two things are separate; the response cache is primarily looking at what the client sees - what they will use without hitting the server, or what modified-date they will send up to the server
p58841
aVOutputCache, however, is focused at the server; the request will still happen (unlike something cached at the client), but it is possible (hopefully likely) that your method won't be called: instead, the cached version will be returned
p58842
aVSo: it is not cached at the client; a HTTP request is made, and (for requests within 5 minutes, for the same , memory permitting) the cached version is returned from the server (typically reducing IO and CPU load at the server)
p58843
aVMake sense
p58844
as(dp58845
g18
V23354
p58846
stp58847
a((dp58848
g2
(lp58849
VDo you just mean:
p58850
aVwhen the key is there the second match is tested
p58851
aVNote however, that this will only (as written) do a reference test on the lists - it won't compare individual elements
p58852
aVIt is hard to tell if that is what you mean since the code example in the linked post is
p58853
aV"unclear" (in that it attempts to add  as value for )
p58854
aVIf you need to test the individual values:
p58855
aV(which assumes a sensible  implementation on
p58856
as(dp58857
g18
V23354
p58858
stp58859
a((dp58860
g2
(lp58861
Vis there any way to do this using LINQ
p58862
aVPossibly, if you torture it beyond breaking point
p58863
aVHowever, that isn't really where LINQ excels
p58864
aVIf your current approach with a loop works, stick with that
p58865
aVAs some asides:
p58866
aVthe ordering of keys in a dictionary is not defied; you should note that (unless you sort explicitly) {"C","A","D","B"} is a perfectly valid key order (regardless of what order you added them)
p58867
aVyou might want to consider , which describes a multi-map between a each key and multiple values; the default () is immutable, but it is easy enough to write a mutable variant
p58868
as(dp58869
g18
V23354
p58870
stp58871
a((dp58872
g2
(lp58873
VGenerally
p58874
aVthe DB and UI are at such opposite ends that I would recommend don't store the actual winform name, but store some string token / enumeration instead, and just use a switch:
p58875
aVin all seriousness, the above is not usually much of a maintenance overhead, and the static typing makes it hard to get much wrong
p58876
aVAnd it will still work when you refactor or switch to a different UI implementation
p58877
aVHowever, you can use reflection
p58878
aVIf you have an assembly-qualified name, then:
p58879
aVotherwise, if just namespace-qualified, you should ideally obtain the  first:
p58880
aVThen simply:
p58881
as(dp58882
g18
V23354
p58883
stp58884
a((dp58885
g2
(lp58886
VWithout a full xsd / xml, or (alternatively) your C# classes, we can't reproduce
p58887
aVBut working from the xml upwards, this works fine for me; meaning: the error is not (as far as I can see) in the code/data you posted
p58888
aVCan you post a more complete (reproducible) example
p58889
aValso works fine with:
p58890
aVand:
p58891
aVand
p58892
as(dp58893
g18
V23354
p58894
stp58895
a((dp58896
g2
(lp58897
V will not make a performant setter
p58898
aVReflection against a generic inner type is your better option here, as this will allow you to use typed delegates
p58899
aVAnother option is , but then you need to worry about a few IL details
p58900
aVYou might want to look at , which wraps up the IL work into a  implementation
p58901
aVAnother option is the  API (if you are using
p58902
aVNET 3
p58903
aV5 or above):
p58904
aVOr alternatively with a generic type:
p58905
as(dp58906
g18
V23354
p58907
stp58908
a((dp58909
g2
(lp58910
VCannot reproduce; it seems fine here:
p58911
aVCan you give a reproducible example where it doesn't update
p58912
aVRe the comments: the code is using something comparable to:
p58913
aVNow, if we add to , we indeed won't notice any difference
p58914
aVA slight peculiarity of  is that if you pass a list into the constructor, that list does become the actual backing list, but:
p58915
aVa: it can't raise any events unless it knows about it; the only way it can know is if it sees the addition, i
p58916
ag50
aVthe addition goes through , not the backing list's
p58917
aVThis can cause the odd effect that reloading or rebinding the data can make items magically appear (in some cases, not this one)
p58918
aVb: in this case, the backing list is not , but a separate list generated by LINQ (), so even adding something to  will never cause the binding-lists backing list to see the new item
p58919
aVIn short: you need to treat the binding-list as the "master" if you expect data changes to propagate
p58920
aVElse; re-bind the data
p58921
as(dp58922
g18
V23354
p58923
stp58924
a((dp58925
g2
(lp58926
V accepts a string of the path
p58927
aVreturns the string contents
p58928
aVI suspect you simply want:
p58929
aVAlternatively, use the constructor that accepts a  and the name/content-type
p58930
aVNote that there are some things to consider if you let people upload arbitrary files into the root of your web-server; I would try to avoid the need to write them to disk (unless you want them for archive), and I wouldn't be writing them to my web-root
p58931
as(dp58932
g18
V23354
p58933
stp58934
a((dp58935
g2
(lp58936
VAll it is passing is a reference
p58937
aVThere will be no significant cost to this whatsoever
p58938
aVIf the method is small and linear, the JIT may even choose to inline it - but ultimately, this is not going to make any difference
p58939
aVStick with the method approach - then you only have one place to maintain
p58940
as(dp58941
g18
V23354
p58942
stp58943
a((dp58944
g2
(lp58945
V"It depends"
p58946
aVIf there are a lot of images, then all that BLOB weight may make backups increasingly painful (and indeed, may preclude some database implementations that only support limited sizes)
p58947
aVBut it works, and works well
p58948
aVThe file system is fine as long as you only store the path relative to some unknown root, i
p58949
ag50
aVyou store "foo/blah/blip
p58950
aVpng", which is combined with configuration data to get the full path - then you can relocate the path easily
p58951
aVFile systems have simpler backup options in some cases, but you need to marry the file-system and database backups
p58952
as(dp58953
g18
V23354
p58954
stp58955
a((dp58956
g2
(lp58957
VMost standard types with a public property (that is read+write) should be editable
p58958
aVIf  is fairly simple, and you just want it to expand in the , then:
p58959
aVIf  is your own code, then you can also decorate  itself and it will apply to all properties:
p58960
aVThere is also a trick to do this for types outside of your control; at app startup, run:
p58961
as(dp58962
g18
V23354
p58963
stp58964
a((dp58965
g2
(lp58966
VYou can create types without this ctor, and simpy use the selector to project into them
p58967
aVSince you obviously aren't using updates etc it shouldn't matter that they aren't part of the generate model:
p58968
aV(where ImmutableCust isn't part of the L2S model)
p58969
as(dp58970
g18
V23354
p58971
stp58972
a((dp58973
g2
(lp58974
VMy understanding is that objects memory is cleared to zero with a simple and very fast memory wipe
p58975
aVthese explicit assignments, however, will take additional IL
p58976
aVIndeed, some tools will spot you assigning the default value (in a field initialiser) and advise against it
p58977
aVSo I would say: don't do this - it is potentially marginally slower
p58978
aVBut not by much
p58979
aVIn short I think your friend is correct
p58980
aVUnfortunately I'm on a mobile device right now, without the right tools to prove it
p58981
as(dp58982
g18
V23354
p58983
stp58984
a((dp58985
g2
(lp58986
VHow do you currently handle login
p58987
aVI did one example of this where a login web-service returned the most appropriate connection strings
p58988
aVObviously this might need some tweaks for the mobile users, but 1 (or maybe 1/branch) service URL may be easier to manage than your cutter scenario, plus you only have to update the centre and all clients see the change
p58989
aVOf course a central web-service for the data is an option too
p58990
as(dp58991
g18
V23354
p58992
stp58993
a((dp58994
g2
(lp58995
VThis is essentially a limitation of the underlying protobuf wire format; it only supports single-dimension arrays
p58996
aVTwo options leap to mind; firstly, send it as a linear array, and send the dimensions separately
p58997
aVYou could also represent it as a list of objects that each has an array - essentially a jagged array, but with an intermediate step
p58998
aVOf the two, the first is both simpler and more efficient
p58999
aVEither way, if you are sending something like intergers, you should look at "packed" encoding (available via the options property) - this can further reduce the payload for arrays etc
p59000
as(dp59001
g18
V23354
p59002
stp59003
a((dp59004
g2
(lp59005
V can be influenced via ,  and/or
p59006
aVOf these,  is the simplest, by overriding  (and mark it as supported)
p59007
aVIn any event, you will also need to write a  implementation that knows how to take a field and an object, and get/set the value, i
p59008
ag50
aVHere's a basic property bag that exposes everything as ; obviously as you extend this (different property types, change-notification, etc) it gets more complex very quickly
p59009
aVNote also that this  approach only works for ; for  etc you'll need either  or
p59010
aVFor collections you'll need
p59011
aVAnd there are about 20 other interfaces around the edges for specific scenarios
p59012
aVBut you get the point ;p The key thing is that our  acts as the translation between your actual model (the dictionary in my case), and the model you expose to  (the fake properties per key)
p59013
as(dp59014
g18
V23354
p59015
stp59016
a((dp59017
g2
(lp59018
VCan you just serialize to a , then once that is done add the  from the , followed by the data (use  and copy  bytes from the array)
p59019
aVReverse at the receiver; read the length (typically 4 bytes), then pack that much data into a ; rewind the  () and deserialize
p59020
aVOf course, you need to agree endianness etc
p59021
aV(see, and I didn't even mention prot
p59022
aVoh, that other thing)
p59023
as(dp59024
g18
V23354
p59025
stp59026
a((dp59027
g2
(lp59028
VAh, you want to evaluate it for a single entity
p59029
aVAnother approach might be:
p59030
aVbut this is probably still going to do the  somewhere in the chain, so you may as well use the more direct code (at the top)
p59031
aVEdit re comments:
p59032
aVTo evaluate that at the database, you would need a restriction, for example:
p59033
aVwhich limits us to the single row, then adds your extra filter
p59034
as(dp59035
g18
V23354
p59036
stp59037
a((dp59038
g2
(lp59039
VIf the requirement is to work with multiple messages of different types:
p59040
aVJust associate a unique number with each different type of message, and use as a prefix to the message; you can do this trivially with the optional integer parameter to the overloaded  method
p59041
aVThe client would have to pre-process this prefix (or it can be handled within protobuf-net by , which has a deserialization method that provides a callback for obtaining the type from this prefix number)
p59042
aVIf the requirement is to work with completely unknown data:
p59043
aVGiven you requirements, I suspect Jon's port would be a better fit; since your emphasis is on platform independence and
p59044
aVproto, and not on inference (where protobuf-net excels) or other
p59045
aVNET specific extensions / utilities
p59046
aVNote that while a
p59047
aVproto can be compiled (via protoc) to a regular protobuf stream, working with entirely foreign data at the receiver is
p59048
aVirregular
p59049
aVIt can probably be done by treating everything as extensions or by working with the coded streams, but
p59050
aVEdit following discussion in comments:
p59051
aVA simple schema here could be simply:
p59052
aV(you could optionally add a discriminator, if that helps)
p59053
aVThis is actually essentially how protobuf-net treats inheritance, but is easily represented from other clients, and handles everything like lengths of sub-messages automatically
p59054
as(dp59055
g18
V23354
p59056
stp59057
a((dp59058
g2
(lp59059
VIn the case where you are having to work with  and reflection, you should probably simply use the non-generic  /  interfaces rather than the generic  /  / ; you will still have indexer, iterate, add, etc
p59060
as(dp59061
g18
V23354
p59062
stp59063
a((dp59064
g2
(lp59065
VNot inbuilt; but maybe something like:
p59066
as(dp59067
g18
V23354
p59068
stp59069
a((dp59070
g2
(lp59071
VThe "why" would be to perform those database operations as part of a wider transactional unit, so that you can commit that and other things in an atomic (all-or-nothing) way, or ensure that your reads and writes happen in the same transaction (to avoid phantom/non-repeatable reads)
p59072
aVActually I'm not a huge fan of the adapter model, but
p59073
aVFor how;  would be simpler, since ADO
p59074
aVNET connections should auto-enlist:
p59075
aVjob done
p59076
as(dp59077
g18
V23354
p59078
stp59079
a((dp59080
g2
(lp59081
VIn short, no: not at the SQL server end; it will of course load the data into memory if possible, and cache the execution plan - so subsequent calls may be faster, but it can't cache the results
p59082
aVOptions:
p59083
aVtune the plan; the sort sounds aggressive - could you perhaps denormalize some data or add an index (perhaps even a clustered index); there may be other things we can do with the query if you show it (but tuning without a fully working DB is guestimation at best)
p59084
aVcache the results at the web-server if it is sensible to do so
p59085
as(dp59086
g18
V23354
p59087
stp59088
a((dp59089
g2
(lp59090
VYou could encode to base-36, but for everyone's sanity (not least your users, dealing with I vs 1, O vs 0 etc), I suggest just sticking to hex; plus it is built in:
p59091
as(dp59092
g18
V23354
p59093
stp59094
a((dp59095
g2
(lp59096
VJava normally uses a completely different runtime (inside the JVM)
p59097
aVThere are tools intending to help bridge the gap (IKVM leaps to mind), but in general: no, you can't do this
p59098
aVOf course, you can use IPC etc to talk between them, but they are not best friends
p59099
as(dp59100
g18
V23354
p59101
stp59102
a((dp59103
g2
(lp59104
VYou need to look at the  header, via:
p59105
aVa typical example would be:
p59106
as(dp59107
g18
V23354
p59108
stp59109
a((dp59110
g2
(lp59111
s(dp59112
g18
V23354
p59113
stp59114
a((dp59115
g2
(lp59116
VOnly if you use a lambda, I
p59117
ag50
aV(an having the method take a typed expression tree instead of just a value)
p59118
aVHowever this still takes quite a bit of processing to resolve and involves both reflection and Expression
p59119
aVI would avoid this unless absolutely necessary
p59120
aVIt isn't worth learning Expression just for this
p59121
as(dp59122
g18
V23354
p59123
stp59124
a((dp59125
g2
(lp59126
VYou could look at using the ASP
p59127
aVNET Routing (which can be done without MVC) - then you can have a path with data but without a query-string; like the paths here (which are actually MVC, but the same logic applies)
p59128
aVRe not being able to use forms - you could simply use jQuery or similar to create the forms on the fly
p59129
as(dp59130
g18
V23354
p59131
stp59132
a((dp59133
g2
(lp59134
VYou could try IKVM
p59135
aVIKVM
p59136
aVNET is useful for several different software development scenarios
p59137
aVHere is a sampling of some of the possibilities
p59138
aVDrop-in JVM
p59139
aVUse Java libraries in your
p59140
aVNET applications
p59141
aVDevelop
p59142
aVNET applications in Java
p59143
as(dp59144
g18
V23354
p59145
stp59146
a((dp59147
g2
(lp59148
VNot very accurate, but a lazy apprach would be to replace  with  and  with
p59149
aVA more accurate result would be to parse it in a DOM:
p59150
aVNote, however, that removing the link tags may change the styling, for example if there is a css style of the form  or
p59151
aVNote on the code above; you could also try the more direct:
p59152
aVbut I wasn't sure if this might cause issues with mutation/iteration for some nesting constructs
p59153
as(dp59154
g18
V23354
p59155
stp59156
a((dp59157
g2
(lp59158
Vuser32
p59159
aVdll etc are not COM dlls
p59160
aVYou will need to use P/Invoke via , for example (from msdn):
p59161
as(dp59162
g18
V23354
p59163
stp59164
a((dp59165
g2
(lp59166
VAs I read it, the problem here is with the inner loop, and there being things in  that are not s
p59167
aVIf LINQ is available:
p59168
aVotherwise:
p59169
as(dp59170
g18
V23354
p59171
stp59172
a((dp59173
g2
(lp59174
VI've never seen that usage, but something like:
p59175
as(dp59176
g18
V23354
p59177
stp59178
a((dp59179
g2
(lp59180
V"fell out of context" is unclear; you would have to be doing:
p59181
aVWithout , there is no special handling
p59182
aVThis then gets translated by the compiler into something like:
p59183
aVand it is this that causes the deterministic cleanup
p59184
as(dp59185
g18
V23354
p59186
stp59187
a((dp59188
g2
(lp59189
VA quick test:
p59190
aVthen:
p59191
aVgives:
p59192
aVand:
p59193
aVSo I'm going to vote "not very reliably, if at all"
p59194
as(dp59195
g18
V23354
p59196
stp59197
a((dp59198
g2
(lp59199
VOperators apply through static analysis (and overloads), not virtual methods (overrides)
p59200
aVWith the cast, it is doing a reference equality check
p59201
aVWithout the cast, it can run the  operator
p59202
aVI guess this is to avoid problems when an operator is added
p59203
aVPersonally, though, I'd do a reference check explicitly with
p59204
as(dp59205
g18
V23354
p59206
stp59207
a((dp59208
g2
(lp59209
VIn many serializers (and data-binding, in fact), an object is either an entity or (exclusive) a list; having properties on a list is not commonly supported
p59210
aVI would refactor to encapsulate the list:
p59211
aVAlso; how would you plan on representing that in JSON
p59212
aVIIRC the JSON array syntax doesn't allow for extra properties either
p59213
as(dp59214
g18
V23354
p59215
stp59216
a((dp59217
g2
(lp59218
VWithout the protocol etc it isn't an absolute uri, so the browser (correctly) treats it as relative to the current URL
p59219
aVSo yes: check for a protocol
p59220
aVPerhaps just StartsWith is enough here, else a regex or maybe Uri
p59221
aVTryCreate (or whatever it is) specifying absolute-only
p59222
aVPersonally I would do this check at the point of data-entry, not at display
p59223
as(dp59224
g18
V23354
p59225
stp59226
a((dp59227
g2
(lp59228
VAt a guess, the  is only held in a method variable; it sounds to me like the  is getting garbage collected and finalized, hence terminated
p59229
aVI suspect you should hold onto that reference in a field to prevent collection
p59230
aVAs an aside - I doubt it is the cause here, but when dealing with threading you should be religiously aware of access to shared state from multiple threads; for example:
p59231
aVusing  (aka )
p59232
aVappropriate use of
p59233
aVwhen it fits
p59234
aVYour current access to the  will probably work OK, but
p59235
as(dp59236
g18
V23354
p59237
stp59238
a((dp59239
g2
(lp59240
VI would have all the setters call into the same inner code:
p59241
aVetc - and that inner  method only talks to the fields (not the properties), including any HSB fields you need; so no recursion
p59242
aVYou might also want a , obviously - again, setting all the fields (not calling into any of the property setters)
p59243
as(dp59244
g18
V23354
p59245
stp59246
a((dp59247
g2
(lp59248
VThis issue generally relates (since
p59249
aVNET strings are UTF-16) only to reading and writing text files
p59250
aVIn which case, just use  to choose the appropriate encoding, and use this when access any text files
p59251
aVAll standard inbuilt text/file utility operations will take an encoding, for example:
p59252
as(dp59253
g18
V23354
p59254
stp59255
a((dp59256
g2
(lp59257
VSimply; dont use BitConverter if there is a remote chance of Endianness being an issue (which for
p59258
aVNET mainly means "mono on some hardware" AFAIK)
p59259
aVJon Skeet has an EndianBitConverter in "MiscUtil" that may help; otherwise just do the encoding via bit-shifting etc
p59260
as(dp59261
g18
V23354
p59262
stp59263
a((dp59264
g2
(lp59265
VFrom memory (not tested) SqlBulkCopy works with SDF, so then all you need is an IDataReader
p59266
aVIf you search for "fast CsvReader" you should find one on codeproject; this works with any delimiter and should work perfectly with SqlBulkCopy (I've used it this way multiple times, although not with sdf)
p59267
aVhttp://msdn
p59268
aVmicrosoft
p59269
aVcom/en-us/library/system
p59270
aVdata
p59271
aVsqlclient
p59272
aVsqlbulkcopy
p59273
aVaspx
p59274
aVhttp://www
p59275
aVcodeproject
p59276
aVcom/KB/database/CsvReader
p59277
aVaspx
p59278
as(dp59279
g18
V23354
p59280
stp59281
a((dp59282
g2
(lp59283
VNot the answer you are hoping for, bit not AFAIK (unless you handle all the xsd ect manually, which is a lot of work)
p59284
aVThe most pragmatic option (to expose such an enum) is probably to introduce a dummy method that includes the enum, but which you never expect to be called in reality (just throw an Exception)
p59285
as(dp59286
g18
V23354
p59287
stp59288
a((dp59289
g2
(lp59290
VWithout changing the query, something like below, where  is the opaque identifier:
p59291
aVHowever, you might also consider a few re-writes; maybe a join, or moving the company-name check earlier; and removing the double-select
p59292
as(dp59293
g18
V23354
p59294
stp59295
a((dp59296
g2
(lp59297
VIn my experience, if you are doing that much with jquery you'll do much better trying MVC, as this allows you to work much closer to the HTML (important when marrying to jquery) and avoids all the cruft that is meaningless with a jquery-centric app
p59298
aVIt is also much easier to write the ajax routes
p59299
aVBut to answer the question: I'm sure that would be possible, but it will be easier without webforms adding work for you to undo
p59300
as(dp59301
g18
V23354
p59302
stp59303
a((dp59304
g2
(lp59305
VWell, strictly speaking LINQ is not necessarily going to read everything; Take will stop as soon as it can
p59306
aVThe problem is that in the related question you look at Count, and it is hard to get a Count without consuming all the data
p59307
aVLikewise, string
p59308
aVSplit will look at everything
p59309
aVBut if you wrote a lazy non-buffering Split function (using yield return) and you wanted the first 1000 unique words, then
p59310
aVwould work
p59311
as(dp59312
g18
V23354
p59313
stp59314
a((dp59315
g2
(lp59316
VWith LINQ:
p59317
aVnote that this will error if there aren't any elements; check the  first (or alternatively, project to , but that adds overhead)
p59318
aVIf you don't have LINQ available, then perhaps:
p59319
as(dp59320
g18
V23354
p59321
stp59322
a((dp59323
g2
(lp59324
VLike so
p59325
aVOriginal answer from when the question referred to a "2 dimensional array":
p59326
aVHow about (note - you may need to reverse  and  depending on how you choose to orient your data):
p59327
aVOr if you just want the averages (not the anon-type):
p59328
as(dp59329
g18
V23354
p59330
stp59331
a((dp59332
g2
(lp59333
VIt isn't a case of being "smart enough" - the compiler does what it is told; you are telling it to create multiple lists: it will create multiple lists
p59334
aVHowever, since you release them promptly they should get collected fairly cleanly, hopefully gen-0
p59335
aVSo unless you are doing this in a tight loop, I wouldn't get too excited about it
p59336
aVIf you want to avoid the lists, you might consider LINQ , which allows you to append sequences without any extra lists / collections / etc
p59337
as(dp59338
g18
V23354
p59339
stp59340
a((dp59341
g2
(lp59342
VWell, I'm not sure I'd entirely agree with the line - after all, you can still put a bug in the implementation - but the point is abstraction; if all you know about is that  has a  method, you don't need to know about , , etc; and you don't need to know when somebody swaps  for , , etc
p59343
aVAs long as the thing they give you is an , you'll be happy - and won't need to change the downstream code
p59344
aV(and if the  class wants to expose a  method instead, then that is fine; it can have  as an explicit implementation of )
p59345
as(dp59346
g18
V23354
p59347
stp59348
a((dp59349
g2
(lp59350
VAnd the end of the file,  returns null - and you then call  on it without checking (in the scenario where the item isn't there and you read the file all the way through) - hence you need to add a null-check (note also I've moved the  so it happens consistently):
p59351
aVNote that the above code (based on yours) will end on the first empty line; personally I'd probably skip empty lines:
p59352
as(dp59353
g18
V23354
p59354
stp59355
a((dp59356
g2
(lp59357
Vrun the timer event less frequently
p59358
aVdo the work on a worker thread (so the UI is at least responsive)
p59359
aVdo less work in the timer (or do it more efficiently)
p59360
aVget more CPU
p59361
aVI'm guessing you really mean the third bullet, but we can't answer that without knowing what the code is doing; but (random suggestions without any context):
p59362
aVlook at any collection access to see if there is a place for a dictionary, hash-set, or similar
p59363
aVcheck if you are doing vast amounts of IO (in particular to a DB) which could be reduced
p59364
aVcheck if you are going lots of thread-switches via  (or the UI's equivalent)
p59365
as(dp59366
g18
V23354
p59367
stp59368
a((dp59369
g2
(lp59370
V is another event, not a method; you can't treat it like a method and have the first event call into the second
p59371
aVPerhaps you mean the (non-public)
p59372
aV(you would need to specify )
p59373
as(dp59374
g18
V23354
p59375
stp59376
a((dp59377
g2
(lp59378
VFor paths - firstly (or rather: lastly) gzip or deflate it
p59379
aVIf large numbers of things are going to have common roots, nest that data perhaps
p59380
ag412
ag50
aVso
p59381
aVbecomes
p59382
aVBeyond that - the payload is going to far exceed any protocol overheads etc, so use whichever protocols etc make life simple for you
p59383
as(dp59384
g18
V23354
p59385
stp59386
a((dp59387
g2
(lp59388
VIn most cases involving a  (currency etc), it isn't useful to take a root; and the root won't have anything like the expected precision that you might expect a  to have
p59389
aVYou can of course force it by casting (assuming we aren't dealing with extreme ends of the  range):
p59390
aVwhich forces you to at least acknowledge the inherent rounding issues
p59391
as(dp59392
g18
V23354
p59393
stp59394
a((dp59395
g2
(lp59396
VConversion operators aren't checked by is/as
p59397
aVYou would needyo use reflection both to check for, and to invoke, said operators
p59398
aVI would write a generic static class
p59399
aVAnd in the static constructor check for the method, an use Delegate
p59400
aVCreateDelegate to create a
p59401
aVAnd store that in a static field
p59402
aVThen you have fast access to the typed method:
p59403
as(dp59404
g18
V23354
p59405
stp59406
a((dp59407
g2
(lp59408
g13333
aVdll is used by the compiler, in combination with any using directives and aliases, to perform type resolution
p59409
aVWhen those types are found, a marker to the type in A
p59410
aVdll is included in the IL
p59411
aVIf A
p59412
aVdll is not used at all the reference is silently dropped
p59413
aVNo code is copied - only qualified names etc - hence you still need to deploy A
p59414
aVdll alongside your B
p59415
aVdll (or in the GAC)
p59416
aVAt runtime, when the marker to a type in A
p59417
aVdll is found, "fusion" attempts to load and verify A
p59418
aVdll (there are complex rules and optional indirections here) - once loaded it resolves the type specified and continues (using the type from A
p59419
aVdll)
p59420
as(dp59421
g18
V23354
p59422
stp59423
a((dp59424
g2
(lp59425
VQuick test:
p59426
aVthrows an :
p59427
aVThe file 'foo
p59428
aVhtm' already exists
p59429
aVTrying with overwrite:
p59430
aVthrows an :
p59431
aVThe process cannot access the file 'foo
p59432
aVhtm' because it is being used by another process
p59433
aVSo generally it looks to be covered
p59434
aVAre you doing something specific
p59435
aVI added some additional double-checking, and it still seems fine:
p59436
as(dp59437
g18
V23354
p59438
stp59439
a((dp59440
g2
(lp59441
VYou would do well to look at LINQ expression trees (), and note that this (in the expression -> TSQL direction) is exactly what LINQ-to-SQL and similar tools do
p59442
aVExpression trees are designed to be parsed in this manner; However for TSQL -> expression
p59443
aVthat is going to be trickier since it is not a simple language, and was not designed for this deconstruction
p59444
as(dp59445
g18
V23354
p59446
stp59447
a((dp59448
g2
(lp59449
VYou have:
p59450
aVDo you mean  here (on the right hand side)
p59451
aVIt isn't entirely clear which data you want, but you don't currently keep any of the items from  beyond the setter
p59452
aVAlso,  is largely redundant here; it could be a  perhaps
p59453
aVOf course, even simpler:
p59454
aV(and let the calling code worry about how many items to keep in there)
p59455
as(dp59456
g18
V23354
p59457
stp59458
a((dp59459
g2
(lp59460
VI suggest:
p59461
as(dp59462
g18
V23354
p59463
stp59464
a((dp59465
g2
(lp59466
VOperators are a pain
p59467
aVHowever, if you look at MiscUtil, I have implemented a generic  that does respect custom operators
p59468
aVThe usage is (intentionally) identical - so your line:
p59469
aVshould work, with the expected result - except that you don't currently handle  for addition purposes
p59470
aVAlternatively, if this is just for , just write an extension method:
p59471
aVActually, to avoid 2 enumerations, I might tweak this to:
p59472
as(dp59473
g18
V23354
p59474
stp59475
a((dp59476
g2
(lp59477
VI suspect they are actually 2 different scenarios, but with regard to the code sample added by Andrew, this is because it can't figure out (in advance) what it is going to do with regards to default values (by default, data is treated as optional at the receiver)
p59478
aVThere are 3 ways of fixing this:
p59479
aV1: add an enum with value 0 (since 0 is always the CLI default value for zeros), for example
p59480
aV2: tell it which value to use by default:
p59481
aV3: tell the engine that it really doesn't need to worry about it, i
p59482
ag50
aVthat it is going to have a value:
p59483
as(dp59484
g18
V23354
p59485
stp59486
a((dp59487
g2
(lp59488
VI'm on iPod, so can't give a full example at the moment: but:
p59489
aVdeclare a param of type object[] () and store that in a variable
p59490
aVfor each term from the array, use the array indexer to obtain an expression to the indexer, and "" or "cast" (iPod again
p59491
aVto cast it
p59492
aVuse , passing the inner expression plus the indexer+cast you generated above
p59493
aVI'll be happy to do a complete example later if you need (when I'm at a PC)
p59494
aVFull example:
p59495
aVOr as a single expression:
p59496
as(dp59497
g18
V23354
p59498
stp59499
a((dp59500
g2
(lp59501
VFor piped output you may need ShellExecute to be true
p59502
aVIf that doesnt work, you may had to pipe it yourself (i
p59503
ag50
aVeither handle the data events, or have an async read/write loop), but the size shouldn't matter since you should only be reading small chunks of it at any time
p59504
as(dp59505
g18
V23354
p59506
stp59507
a((dp59508
g2
(lp59509
VIn AsDelegate, we are capturing the the argument "value"
p59510
aVthe value of this argement is taken as a copy of the value of the variable at the time the method is invoked, and never changes - so we see the original object
p59511
aVThe direct lambda captures the variable foo (not the value of the variable - the variable itself) - thus we do see changes to this
p59512
aVBasically adding a method call changed the thigh being captured
p59513
as(dp59514
g18
V23354
p59515
stp59516
a((dp59517
g2
(lp59518
VGenerally things like column names (or table names) can not be parameterised - and the fact that there are different indices means that it will have to be a different plan internally
p59519
aVSo you will have to use concatenation - but be careful to white-list the known column names to prevent sql injection:
p59520
as(dp59521
g18
V23354
p59522
stp59523
a((dp59524
g2
(lp59525
Vparameters have always been named; in the context of supplying values for a method, they are arguments - however, then name that you are specifying is the parameter name
p59526
aVSo I can see how it would become mixed up ;p But in the context, we are supplying to name for the compiler to use to resolve the argument, so "named arguments" ftw
p59527
aVMore specifically:
p59528
ag8441
ag691
aV1  Argument lists
p59529
aVAn argument with an argument-name is referred to as a named argument, whereas an argument without an argument-name is a positional argument
p59530
aVIt is an error for a positional argument to appear after a named argument in an argument-list
p59531
as(dp59532
g18
V23354
p59533
stp59534
a((dp59535
g2
(lp59536
VYou are adding "A1001" twice as a key in a dictionary
p59537
aVThat simply isn't allowed
p59538
aVHowever, more urgently - why is that dictionary static
p59539
aVThat means that everything, anywhere, shares that error collection
p59540
aVSuggestions:
p59541
aVmake that not static (that is a bad idea - also, it isn't synchronized)
p59542
aVcheck for existence of the key, and react accordingly:
p59543
aVAs an aside, you might also consider implementing , which is a built-in standard wrapper for this type of functionality, and will provide support for your error collection to work with a few standard APIs
p59544
aVBut don't rush into this until you need it ;p
p59545
as(dp59546
g18
V23354
p59547
stp59548
a((dp59549
g2
(lp59550
VPerformance of what
p59551
aVInsertion
p59552
aVRemoval
p59553
aVAdding (at end)
p59554
aVQuery
p59555
aVThe performance of each depends on the operation
p59556
aVHowever, for 10-30 you'll be lucky to see any difference, so go with whichever describes your situation most clearly and is most convenience
p59557
aVIf you need the best performance: profile
p59558
aVAt those numbers you might find that simply looping over an array/list checking for a match is the quickest approach
p59559
aVBut this is the least friendly approach - so only even consider that if this is used in the middle of a tight loop that doesn't already have more significant overheads
p59560
as(dp59561
g18
V23354
p59562
stp59563
a((dp59564
g2
(lp59565
V can return the number of rows affected; you can catch that and react accordingly; you would generally expect it to be  (unless you have triggers etc):
p59566
aVFor UPDATE, INSERT, and DELETE statements, the return value is the number of rows affected by the command
p59567
aVWhen a trigger exists on a table being inserted or updated, the return value includes the number of rows affected by both the insert or update operation and the number of rows affected by the trigger or triggers
p59568
aVFor all other types of statements, the return value is -1
p59569
aVIf a rollback occurs, the return value is also -1
p59570
aVFor more complex queries, returning a value related to  (captured at some point in the query) may be useful, along with
p59571
aVIn some cases you may need to check the data manually for existence
p59572
as(dp59573
g18
V23354
p59574
stp59575
a((dp59576
g2
(lp59577
VJust an interesting alternative syntax, to show that you don't always need lambdas or anonymous methods to use LINQ:
p59578
as(dp59579
g18
V23354
p59580
stp59581
a((dp59582
g2
(lp59583
VHere's your model (with invented  and ) using protobuf-net (yet retaining the ability to use , which can be useful - in particular for migration); I humbly submit (with lots of evidence if you need it) that this is the fastest (or certainly one of the fastest) general purpose serializer in
p59584
aVNET
p59585
aVIf you need strings, just base-64 encode the binary
p59586
as(dp59587
g18
V23354
p59588
stp59589
a((dp59590
g2
(lp59591
VTo do that without changing the model is exceptionally tricky (but possible), requiring  or , and a custom
p59592
aVTo be honest: not worth it
p59593
aVJust add pass-thru properties:
p59594
as(dp59595
g18
V23354
p59596
stp59597
a((dp59598
g2
(lp59599
VAs long as nothing else can see the object it is already eligible for collection; nothing more is required
p59600
aVThe key point here is to ensure that nothing else is watching it (or at least, nothing with a longer lifetime):
p59601
aVis it in a field somewhere
p59602
aVis it in a variable in a method that is incomplete
p59603
aV(an infinite loop or iterator block, perhaps)
p59604
aVis it in a collection somewhere
p59605
aVhas it subscribed to some event
p59606
aVit is captured in a closure (lambda / anon-method) that is still alive
p59607
aVI genuinely doubt that  is the answer here; if it was eligible it would have already been collected
p59608
aVIf it isn't elgible, calling  certainly won't help and quite possibly will make things worse (by tying up CPU when nothing useful can be collected)
p59609
as(dp59610
g18
V23354
p59611
stp59612
a((dp59613
g2
(lp59614
VThe C# compiler doesn't inline anything - the JIT might do that, but isn't obliged to
p59615
aVIt should still be plenty fast though
p59616
aVI would probably remove the implicit conversion in the  though (see the constructor usage below) - one more operator to look through:
p59617
aVJIT inlining is limited to specific scenarios
p59618
aVWill this code satisfy them
p59619
aVHard to tell - but it should work and work fast enough for most scenarios
p59620
aVThe problem with  is that there is an IL opcode for adding doubles; it does almost no work - where-as your code is calling a few static methods and a constructor; there is always going to be some overhead, even when inlined
p59621
as(dp59622
g18
V23354
p59623
stp59624
a((dp59625
g2
(lp59626
VAs long as the type has a public parameterless constructor it should just work:
p59627
as(dp59628
g18
V23354
p59629
stp59630
a((dp59631
g2
(lp59632
VIn regular
p59633
aVNET attributes don't cause magic invocation, except for a very limited set of system attributes (security etc)
p59634
aVThe rest are applied only by inspection through reflection, which has to be done explicitly
p59635
aVYou might look at PostSharp (now renamed into a commercial product)
p59636
as(dp59637
g18
V23354
p59638
stp59639
a((dp59640
g2
(lp59641
VYou need to add
p59642
aVSingle()
p59643
aVToString();
p59644
aVOtherwise you haven't actually executed the query - you ate reporting the query itself
p59645
as(dp59646
g18
V23354
p59647
stp59648
a((dp59649
g2
(lp59650
VThis is an XmlSerializer limitation; if something looks like a list of data, it will want to Add items to it via the Add method
p59651
aVIf you have access to those objects, consider adding such a method
p59652
aVI can't recall whether it wants Add(object) vs Add(SomeType) so try both
p59653
aVIf you don't have control over those objects
p59654
aVit will be hard
p59655
aVIt would be quicker to write a new DTO layer for the objects than to try to patch it somehow
p59656
as(dp59657
g18
V23354
p59658
stp59659
a((dp59660
g2
(lp59661
VLINQ-to-SQL isn't going to do anything quite as bespoke as that query
p59662
aVWhich isn't a criticism of either LINQ-to-SQL or the query: simply, there are limits
p59663
aVThere are two ways I would approach that:
p59664
aV1: as a parameterized TSQL query via  - i
p59665
ag50
aV2: write that TSQL a udf mapped into the data-context:
p59666
aVBoth are valid and will work with LINQ-to-SQL; personally I prefer the first approach, but the UDF approach allows greater re-use within the DB layer, at the expense of having more complex deployment (i
p59667
ag50
aVapp tier and db tier all at the same time)
p59668
as(dp59669
g18
V23354
p59670
stp59671
a((dp59672
g2
(lp59673
VI would just use:
p59674
aV(note the use of the )
p59675
aVAnother likely issue is permissions; does the app have access to user acbd's desktop
p59676
aVYou might also look at:
p59677
aVand
p59678
as(dp59679
g18
V23354
p59680
stp59681
a((dp59682
g2
(lp59683
V has a habit of propagating in DB servers; many operations (in particular concatenation)  will return a  if one if the inputs is , requiring  or
p59684
aVSo
p59685
aVwhat is the value of  - and what is the db collation (is it case-sensitive
p59686
aVa  wouldn't match in a case-sensitive collation)
p59687
aVwhat does  do (ideally: the code)
p59688
aVwhat are the values of , , , , etc
p59689
as(dp59690
g18
V23354
p59691
stp59692
a((dp59693
g2
(lp59694
VAdd some :
p59695
aVmeans:
p59696
aVSpecifies that only members declared at the level of the supplied type's hierarchy should be considered
p59697
aVInherited members are not considered
p59698
aVOr an alternative using LINQ (which makes it easy to add any unusual checks, for example checking ):
p59699
as(dp59700
g18
V23354
p59701
stp59702
a((dp59703
g2
(lp59704
VFor the most flexibility (since you mention names as well), the ideal thing is to call  on the  object,  registering one or more  implementations (perhaps in an array or iterator block)
p59705
aVYou can then implement  to add (or not) and values under any names, by adding key/value pairs to the dictionary that you return
p59706
aVIf the data is bidirectional you will also need a matching , but often (for ajax servers) this is not required
p59707
aVFull example:
p59708
as(dp59709
g18
V23354
p59710
stp59711
a((dp59712
g2
(lp59713
VOn the Build tab (and when in the "Release" configuration), you can click Advanced
p59714
aVto change the Debug Info to "full", but note that this may make some compiler optimizations impossible
p59715
as(dp59716
g18
V23354
p59717
stp59718
a((dp59719
g2
(lp59720
VBy adding a  like so
p59721
aVNote that we don't need any special access to the entities being serialized to do this, but it might be a huge pain if you have lots of entities that are affected by this issue
p59722
aVIf that is a likely problem, it will probably be less work to just write a DTO class (that twins with your model) that you can control more directly
p59723
aVYou are right not to edit the generated classes, and (frustratingly) you can't use a  to add attributes to members declared in another part of the
p59724
as(dp59725
g18
V23354
p59726
stp59727
a((dp59728
g2
(lp59729
VYou can't do that with  - it will expect additional meta-data/padding around object
p59730
aVYou would have to read manually either from a  or similarly via a binary reader
p59731
aVHaving done some very similar code, I would write my own reader that sits on top of a stream, with methods like: ,  (etc for everything you need) - and use shift ( / ) to assemble the bytes
p59732
aVBut importantly I would use a backing buffer to reduce the amount of calls to the underlying stream (even with a buffer, this can be unacceptably slow)
p59733
aVLet me refer you to some code from protobuf-net that does this
p59734
aVin particular , taking an example:
p59735
aV(here  broadly acts as an indicater of endianness etc, but that isn't important)
p59736
aVLooking at the  implementation:
p59737
aVThe  makes sure that we have at least 4 more bytes in our backing buffer (fetching more if we desire)
p59738
aVwe increment some counters so we can track our position in the logical buffer
p59739
aVwe read the data from the buffer
p59740
aVOne you have a reader for your format, deserialization should be much easier
p59741
as(dp59742
g18
V23354
p59743
stp59744
a((dp59745
g2
(lp59746
VIt depends on how pretty you want it ;p a  or  provide basic clientside functionality for notifying/asking the user:
p59747
aVFor more complex scenarios you'll want to look at DHTML (usually via a library like jQuery) to create a popup window, masking the background to give the illusion of modality
p59748
aVNote that handling exit is slightly different; you can subscribe to the  event in the browser, and return a string that is the message; for example (here using jQuery):
p59749
as(dp59750
g18
V23354
p59751
stp59752
a((dp59753
g2
(lp59754
s(dp59755
g18
V23354
p59756
stp59757
a((dp59758
g2
(lp59759
Vwhat is going on
p59760
aVdoes the lambda function somehow store a 'reference' to the variable or something
p59761
aVYes exactly that; c# captured variables are to the variable, not the value of the variable
p59762
aVYou can usually get around this by introducing a temp variable and binding to that:
p59763
aVespecially in  where this is notorious
p59764
as(dp59765
g18
V23354
p59766
stp59767
a((dp59768
g2
(lp59769
VOverflow is harmless in c# - you won't overflow memory - you simply obly get the last 8 bits of the result
p59770
aVIf you want this to this an exception, use the 'checked' keyword
p59771
aVNote also that you may find byte+byte gives int, so you may need to cast back to byte
p59772
as(dp59773
g18
V23354
p59774
stp59775
a((dp59776
g2
(lp59777
VThere is WP7 support in v2, which is the trunk
p59778
aVThis is not yet fully released (I have a few bits to do), but it does work
p59779
as(dp59780
g18
V23354
p59781
stp59782
a((dp59783
g2
(lp59784
VThat may happen if a node lacks the attribute
p59785
aVTry:
p59786
as(dp59787
g18
V23354
p59788
stp59789
a((dp59790
g2
(lp59791
VThis will do things like:
p59792
aVupdate parameter values (out/return)
p59793
aVcheck for exceptions (error codes in the TDS stream - constraint violation etc)
p59794
aVrelease any objects/data buffered as part of the above etc
p59795
aVSo yes: do it
p59796
as(dp59797
g18
V23354
p59798
stp59799
a((dp59800
g2
(lp59801
VThe simplest approach would be to let XmlSerializer do it for you
p59802
aVJust decorate it (if necessary) so that it knows how to map the xml, and call Deserialize
p59803
as(dp59804
g18
V23354
p59805
stp59806
a((dp59807
g2
(lp59808
VYou can tell it to use binary-mode instead of the legacy xml mode:
p59809
aVYou can also try running the serializer through  or , but this would probably require sending it as a BLOB rather than direct remoting
p59810
aVI've also done some recent work looking at pushing  through protobuf-net, here, including comparison metrics - even if you don't want the protobuf-tweaks, the data of numbers should help you choose between xml/binary and vanilla/gzip/deflate
p59811
as(dp59812
g18
V23354
p59813
stp59814
a((dp59815
g2
(lp59816
VIn web
p59817
aVconfig, try adding to the system
p59818
aVweb/pages/namespaces node
p59819
aVYou will also need to ensure that the ASP
p59820
aVNET compiler is in 3
p59821
aV5 mode:
p59822
as(dp59823
g18
V23354
p59824
stp59825
a((dp59826
g2
(lp59827
VThe first problem I see is that you're going to have problems with the  column; I expect it is trying to offset your data by one column at the moment - it doesn't know that you are omitting it
p59828
aVYou can either mess with the mappings, or (in your data-table) add a  column (at index 0) - but note that SQL Server will ignore the values unless you enable identity-insert
p59829
aVPerhaps try a more explicit datetime conversion:
p59830
aVNote that I can't tell from the data if that is dd/MM or MM/dd, so you may need to tweak that
p59831
as(dp59832
g18
V23354
p59833
stp59834
a((dp59835
g2
(lp59836
VIn short, no there are no quick wins here
p59837
aVPersonally I would not make  (as a DTO) a  (which is presumably the problem), as those round trips are going to cripple you
p59838
aVI would keep it as a regular class, and just move a few key methods to pump them around (i
p59839
ag50
aVhave a  manager/repository/etc class)
p59840
aVThat should reduce round-trips; if you still have problems then it will probably be bandwidth related; this is easier to fix; for example by changing the serializer
p59841
aVprotobuf-net allows you to do this easily by simply implementing  and forwarding the two methods (one from the interface, plus the ctor) to  - it then does all the work for you, and works with remoting
p59842
aVI can provide examples of this if you like
p59843
aVActually, protobuf-net may help with CPU usage too, as it is a much more CPU-efficient serializer
p59844
as(dp59845
g18
V23354
p59846
stp59847
a((dp59848
g2
(lp59849
VWell, that isn't reliable anyway - the size of the session in memory as objects is not the same as the size of the objects serialized - and note that the choice of serialization is actually up to the session implementation you have selected
p59850
aVWhen using , no: there is no way of automatically skipping non-serializable fields, unless you do a lot of work with" serialization surrogates"
p59851
aVYou could just edit the objects that you are storing
p59852
aVOr store simple (pre-serialized) data such as xml, json,  etc
p59853
as(dp59854
g18
V23354
p59855
stp59856
a((dp59857
g2
(lp59858
VIf it is calling back to the same server, perhaps use the  object:
p59859
aVOtherwise, store the other server's details in a config file or the database, and just give it the right value
p59860
aVBut a better question would be: why would you talk via http to yourself
p59861
aVWhy not just call a class method
p59862
aVPersonally I'd be using an external scheduled job to do this
p59863
as(dp59864
g18
V23354
p59865
stp59866
a((dp59867
g2
(lp59868
VIf possible, the non-generic  interface would be the simplest approach:
p59869
aVOtherwise, you will have to:
p59870
aVfind the appropriate  (using reflection)
p59871
aVresolve the  method from  (using reflection)
p59872
aVinvoke the  method (using reflection)
p59873
aVthat reflection, especially on generics, is not nice
p59874
aVAs an alternative - if you have 4
p59875
aV0 you could try using , but note this only sees the public API
p59876
aVWorth a try though (only if  fails):
p59877
as(dp59878
g18
V23354
p59879
stp59880
a((dp59881
g2
(lp59882
VIn the general case, that is a tricky one ;p It depends on the exact scenari:
p59883
aV(when the target is a value-type) if the source value is only known as , it is an unbox operation, which reverses the special way in which value-types can be stored in an object reference ( / )
p59884
aVif the source type is a , then the  property is evaluated (which can cause an exception if the value is empty)
p59885
aVif the source type is one of a few built-in types documented in the spec (, , etc), then the specific opcode (which may be nothing at all) is emitted to perform the conversion directly in IL ()
p59886
aVif the source type has a custom implicit or explicit conversion operator defined (matching the target type), then that operator is invoked as a static method ()
p59887
aV(in the case of reference types) if it isn't obviously always untrue (different hierarchies), then a reference cast/check is performed ()
p59888
aVotherwise the compiler treats it as an error
p59889
aVI think that is fairly complete
p59890
as(dp59891
g18
V23354
p59892
stp59893
a((dp59894
g2
(lp59895
VThere I nothing wrong with binary data as long as it is interoperable
p59896
aVBinaryFormatter would be silly, but there are others
p59897
aVFor example google designed "protobuf" / "protocol buffers" for exactly this purpose
p59898
aVThere are protobuf implementations in many many platforms including several in
p59899
aVNET
p59900
aVMost of google's apps, from what I gather, work this way
p59901
aVThe only downside (the same as with XML) is that it isn't very convenient from JavaScript
p59902
aVBut from a web service is is ideal; both CPU and bandwidth efficient, and version-tolerant
p59903
as(dp59904
g18
V23354
p59905
stp59906
a((dp59907
g2
(lp59908
Vdownload the HTML Agility Pack (free)
p59909
aVcreate a new HtmlDocument
p59910
aVloadhtml
p59911
aVuse DOM navigation or an xpath query (SelectSingleNode etc) to find the elements
p59912
aVaccess InerHtml of the elements you want
p59913
aVThe API is similar to XmlDocument, but it works on html that isn't xhtml
p59914
as(dp59915
g18
V23354
p59916
stp59917
a((dp59918
g2
(lp59919
VYou are reading the BOM from the stream
p59920
aVIf you are reading text, try using a  which will handle this automatically
p59921
as(dp59922
g18
V23354
p59923
stp59924
a((dp59925
g2
(lp59926
V does not provide serialization callbacks, I'm afraid
p59927
aVOne way to do this is for the parent to handle this when adding - but you will need a custom collection (perhaps inherited from ) that during / calls some method on the child to add (or remove, if removing from the collection) the parent
p59928
aVAlternatively - consider simply making it a one-way only tree - i
p59929
ag50
aVthe child doesn't have a parent property
p59930
aVAnother option is simply to walk the model through code after deserialization, and fixup any parent values
p59931
aVThe final option is to implement , but that is very hard get right
p59932
as(dp59933
g18
V23354
p59934
stp59935
a((dp59936
g2
(lp59937
VI can't see much from what is there
p59938
aVBu if you have a static field-initialiser, why does the property need to check for null
p59939
aVActually I suspect this is due to the field initialiser running before other code in the static constructor etc
p59940
aVI would try removing the field initialiser - but note that without this there is an edge case (timing/thread-race) that could result in more than one object being created
p59941
aVIf that isn't acceptable there are lots of ways of avoiding this thread race
p59942
as(dp59943
g18
V23354
p59944
stp59945
a((dp59946
g2
(lp59947
VA lazy way would be to switch "object" for "dynamic"
p59948
aVOr use A Tuple generic type
p59949
aVBut IMO you should simply write a class with hear two properties:
p59950
aVAnd use a List-of-Testimonial
p59951
aVAnother way would be to use something like:
p59952
aVThis is an array of your anon-type, and;
p59953
aVWould work fine
p59954
as(dp59955
g18
V23354
p59956
stp59957
a((dp59958
g2
(lp59959
s(dp59960
g18
V23354
p59961
stp59962
a((dp59963
g2
(lp59964
VI would have:
p59965
aVAnd then use the listings variable in the model creation:
p59966
aV( or listings
p59967
aVToList() )
p59968
as(dp59969
g18
V23354
p59970
stp59971
a((dp59972
g2
(lp59973
VYou could just use:
p59974
aVAnd reverse the array (assuming the CPU is little-endian, which you an check), or simply just access the array in the order you need
p59975
aVThere is also a way to do this with unsafe code, treating the float* as a byte* so you can get the bytes in the order you want
p59976
as(dp59977
g18
V23354
p59978
stp59979
a((dp59980
g2
(lp59981
VI have done this is deserialization/materialization code when there is a good chance of repeated values (almost an enum, but not quite)
p59982
aVWhen deserializing thousands of records this can give a significant memory benefit
p59983
aVHowever, in such cases you might prefer to use a separate intern cache, to avoid saturatig the shared one (or maybe the shared one is fine; it depends on the scenario)
p59984
aVBut the key point there is: a scenario where you are likely to have lots and lots of different string instances with the same value
p59985
aVDeserialization is a big candidate there
p59986
aVIt should also be note that there is some CPU overhead in checking the interned cache (progressively more overhead as you add data), so this should obly be done if there is a chance that the constucted objects are goin to live more than gen-0; if they are always going to be collected quickly anyway then it isn't worth swapping them for interned versions
p59987
as(dp59988
g18
V23354
p59989
stp59990
a((dp59991
g2
(lp59992
VStrictly speaking it isn't the only option; you could put an argument that "remoting" meets the meaning inthe text; here a fake object is created at the receiver that contains no state
p59993
aVAll calls (methods, properties etc) are intercepted and only the call and result are transferred
p59994
aVThis avoids the need to transfer the object itself, but can get very expensive if overly "chatty" usage is involved (I
p59995
ag50
aVLots of calls)as each has the latency of the speed of light (which adds up)
p59996
aVHowever, "remoting" is now rather out of fashion
p59997
aVMost often, yes: the object will need to be serialised and deserialized in some way (there are lots of options here)
p59998
aVThe paragraph is then pretty-much correct
p59999
as(dp60000
g18
V23354
p60001
stp60002
a((dp60003
g2
(lp60004
VThere are a myriad of pre-rolled serialization libraries that will help here
p60005
aVBinaryFormatter has some (IMO) undesirable features here - in particular it will only work with the exact same (well, pretty much) dll at both ends
p60006
aVXmlSerializer, DataContractSerializer and JavaScriptSerializer are good text-based implementations, and will work fine with a compatible contract at both ends (same properties etc - not necessarily the same type/version)
p60007
aVIf you have moderate bandwidth needs, or need better CPU performance I would recommend protobuf-net (caveat: I wrote it) which is a fast binary serializer that may help
p60008
as(dp60009
g18
V23354
p60010
stp60011
a((dp60012
g2
(lp60013
VWell, try/catch by itself doesn't really do much, and it would certainly be bad practice to present a UI dialog from your DAL/DB/repo layer
p60014
aVI would:
p60015
aVin the DAL catch the expected SQL exception and throw a documented exception that the UI can expect
p60016
aVin the UI layer, catch the exception you threw and present a suitable dialog to the user
p60017
aVOf course, your UI should really expect to catch any exception in this scenario; simply it might put a friendlier face on an expected (predictable) exception - and be more cautious in the case of something it didn't expect
p60018
aVAn even better answer would be: verify your scenario up-front, so that you don't expect an exception at all - then any exception is exactly that: exceptional
p60019
aVAs a general point though: never be afraid to ask the interview what they had in mind; you might then be able to discuss the merits (and not) of each approach
p60020
aVAlso, never assume that the interviewer knows everything
p60021
aVI would have absolutely no qualms telling an interviewer (nicely, mind) that they are mistaken about a technical point
p60022
aVIt might be sneaky, but the interviewer might actually be looking for someone who isn't afraid to speak up when someone makes a technical error, and is therefore injecting subtle gibberish into technical discussions
p60023
as(dp60024
g18
V23354
p60025
stp60026
a((dp60027
g2
(lp60028
Valthough note also that you might want to check  to see which way around that is going to appear
p60029
aVNote that if you are doing this repeatedly you might want to avoid all those short-lived array allocations by writing it yourself via either shift operations ( / ), or by using  code
p60030
aVShift operations also have the advantage that they aren't affected by your platform's endianness; you always get the bytes in the order you expect them
p60031
as(dp60032
g18
V23354
p60033
stp60034
a((dp60035
g2
(lp60036
VI would make your  method a utility method that returns the value, for example:
p60037
aVThen both blocks of code can call this method, for example
p60038
aVAs a side-benefit, it also reduces coupling between your UI and DB, which is generally considered a good thing
p60039
aVIf the query requires values currently from the form, make those parameters in the method
p60040
aVNote also that for returning a single value you might want to look at ; it isn't going to make a massive difference, but it is more direct than populating a  and looping over the single row
p60041
as(dp60042
g18
V23354
p60043
stp60044
a((dp60045
g2
(lp60046
VTo handle issues with unexpected shutdowns, I would typically give each logical lock an expiry; this might mean (for example) you need a  and a  column, but that isn't usually an issue
p60047
aVYour app can always extend the lock if the user is still in a screen, but it means that if the machine simply drops off the network the record will implicitly become available in a few minutes
p60048
aVThe other option is to allow key users to smash locks
p60049
aVRe user termination of the app; just track what locks you have and remove them ;p
p60050
as(dp60051
g18
V23354
p60052
stp60053
a((dp60054
g2
(lp60055
VYou shouldn't need to work with the strings; you should be able to use  on the subtree:
p60056
aVAnd note that this isn't really a "new" xml-reader - it is heavily tied to the outer reader (but constrained to a set of nodes)
p60057
as(dp60058
g18
V23354
p60059
stp60060
a((dp60061
g2
(lp60062
VThe query goes down to the server with the parameters as parameters (which helps security and query plan re-use)
p60063
aVSo there is no need for what you ask to exist - and thus it doesn't
p60064
aVPersonally I wouldn't replace them, even when logging; I would simply append the name/value pairs when logging it, i
p60065
ag50
aVlog something like:
p60066
aVUPDATE Persons SET Active=@act, Abbreviation=@abbr, FirstName=@first, LastName=@last, Birthday=@bday, Email=@email,Tel=@tel, Fax=@fax, Registered=@reg, Admin=@adm WHERE ID=2 || @act=1 @abbr=mjg @first=Fred
p60067
as(dp60068
g18
V23354
p60069
stp60070
a((dp60071
g2
(lp60072
VThere is already , but you should ideally support both  and
p60073
aVUsing the inbuilt  is generally an easier option
p60074
aV, for example, will accept such a comparer
p60075
as(dp60076
g18
V23354
p60077
stp60078
a((dp60079
g2
(lp60080
VIIRC, this will use  to do the comparison
p60081
aVThis first tests to see if your type  implements  - if so it will use that interface and the  method
p60082
aVOtherwise it will just use  (note that it also takes into account s and , so you don't have to)
p60083
aVBy default, this means that classes will be treated as equal only if they are the same instance (structs are compared at the field level)
p60084
aVIf you override  you should get the behaviour you expect, but note that if you override  you should also override  to have a similar implementation
p60085
as(dp60086
g18
V23354
p60087
stp60088
a((dp60089
g2
(lp60090
VIIRC, you can use  on both of those sections (here - note that it works on the levels below )
p60091
aVThis gives you more files, but you should be able to share some data between client and server
p60092
aVHowever, it may not be necessary or desirable to share some of the config down to the client - personally I would be tempted to just leave it as-is
p60093
as(dp60094
g18
V23354
p60095
stp60096
a((dp60097
g2
(lp60098
VYou can use pretty much any integer type for that(, , etc); the important part is how you format it
p60099
aVIn this case:
p60100
aVThe integer data type is just the value - leading zeros don't exist or not exist - simply that isn't the job of an integer
p60101
aVYou could always create a custom  of course, taking the integer value in the constuctor (and maybe a custom conversion operator), overriding the  method (and probably , , etc)
p60102
aVJust for kicks:
p60103
as(dp60104
g18
V23354
p60105
stp60106
a((dp60107
g2
(lp60108
V is really a fancy word for  as far as the core CLI is concerned, so you are mutating a boxed copy
p60109
aVThis is prone to craziness
p60110
aVMutating a struct in the first place is really, really prone to error
p60111
aVI would simply make the struct immutable - otherwise you are going to get this over and over
p60112
as(dp60113
g18
V23354
p60114
stp60115
a((dp60116
g2
(lp60117
VYou should be able to use  to resolve the types (you might need to prefix with the namespace) - after that you have two choices:
p60118
aV1 use  to instantiate and reflection over the properties - presumably hard-coding a few  approaches for parsing , , etc
p60119
aVbut that sounds like work
p60120
aV2 change the format of the config file such that the inner xml block is compatible with  - then you can just grab the inner xml and run it through
p60121
aV(using either the subtree () reader if you already have an , or  if you have the xml as a string
p60122
aVFor example xml (thinking of ) maybe:
p60123
as(dp60124
g18
V23354
p60125
stp60126
a((dp60127
g2
(lp60128
VSimply:
p60129
aVTo quote the spec sections from ECMA 334 v4
p60130
aV14
p60131
ag691
aV10
p60132
aV1 Object creation expressions
p60133
aVThe type of an
p60134
aVobject-creation-expression shall be a
p60135
aVclass-type, a value-type, or a
p60136
aVtype-parameter having the
p60137
aVconstructor-constraint or the value
p60138
aVtype constraint (25
p60139
aV7)
p60140
aVOtherwise, if T is a type-parameter:
p60141
aVIf A is present, a compile-time error
p60142
aVoccurs
p60143
aVOtherwise, if T has the
p60144
aVconstructor-constraint or the value
p60145
aVtype constraint, the result of the
p60146
aVobjectcreation- expression is a value
p60147
aVof type T
p60148
aVOtherwise, the
p60149
aVobject-creation-expression is invalid,
p60150
aVand a compile-time error occurs
p60151
as(dp60152
g18
V23354
p60153
stp60154
a((dp60155
g2
(lp60156
VThere is no inbuilt  method, so you could either write a  extension method, or just
p60157
aVA  would be  so would be more efficient - but more code to write ;p
p60158
aVFor example, you could use:
p60159
aVwith:
p60160
as(dp60161
g18
V23354
p60162
stp60163
a((dp60164
g2
(lp60165
VMost of the problems are from the data layer with inline-dynamic SQL
p60166
aVAs long as there is some distinction between UI and data, this isn't necessarily a problem
p60167
aVDon't prejudice inline SQL - as long as it is parameterized, it is a perfectly workable approach
p60168
aVRe the question; I would question what the technical reason for scrapping it is
p60169
aVIf you can justify it in real terms (ideally in $\u20ac), then great
p60170
aVBut don't do it just because you don't like the look of it
p60171
aVI've scrapped code before, but trying to do it in a regression-free way can be tortuous
p60172
aVAs for the users; done right, they don't really need to know that there is a change, but even if you want to change the UI - most people are pretty flexible and are happy to adapt to a new UI
p60173
as(dp60174
g18
V23354
p60175
stp60176
a((dp60177
g2
(lp60178
VHow are you trying to access it
p60179
aVTo access a static method you use the type name:
p60180
aVvs
p60181
aVNote also that there are simpler ways of implementing singletons that acheive the same effect with less locking etc
p60182
aVRe the difference between singleton and static; a singleton might implement an interface, allowing you to pass it into existing code
p60183
aVYou can also (as indeed you are doing) defer construction of a singleton (yet still allow access to the static methods that don't involve the singleton instance)
p60184
aVBut yes: there is a lot of crossover between static and singleton
p60185
as(dp60186
g18
V23354
p60187
stp60188
a((dp60189
g2
(lp60190
VIt sounds like you have some lazily loaded relationship properties that have not yet loaded (which has an associated "n+1" performance concern)
p60191
aVYou can try eager loading to see if this helps; otherwise, explicitly load the data for each item in the list, before you close the object-context
p60192
as(dp60193
g18
V23354
p60194
stp60195
a((dp60196
g2
(lp60197
VAs a minor thing,  would probably be more efficient:
p60198
aVas a second thought, I don't like the fact that if  you will get  for a null; I'd want an error
p60199
aVI'd be tempted to use:
p60200
aVwhich should work for reference types and  correctly, and raise an error for  etc
p60201
aVIn , the  is redundant, since you are actually returning ; you may as well just:
p60202
aV(in both cases)
p60203
aVSo:
p60204
as(dp60205
g18
V23354
p60206
stp60207
a((dp60208
g2
(lp60209
VThis gets complex depending on whether the arguments are literals, captured variables, etc - and whether they are , , etc
p60210
aVYou might want to look at the implementation in protobuf-net
p60211
aVExtensions, here, which has code to all of this - in particular the  method
p60212
aVThe  is simple - just cast  to  and obtain the  - but for the parameters it recursively calls into  - this allows expressions like  to work, where  is a literal,  is a captured variable, and  is something hanging off a captured variable
p60213
as(dp60214
g18
V23354
p60215
stp60216
a((dp60217
g2
(lp60218
VThe assembly doesn't contain the source code
p60219
aVYou might be able to extract the IL, but without tools like reflector or ildasm that isn't especially helpful
p60220
aVTo obtain the method names, just something like:
p60221
as(dp60222
g18
V23354
p60223
stp60224
a((dp60225
g2
(lp60226
V is IMO more than a little awkward to get right
p60227
aVNote that if you are handling the  code yourself you can override everything at runtime by using the constructor that accepts  (but if you use this you should cache and re-use the  instance, or it will leak like a sieve)
p60228
aVYou briefly mention ; note that  (even in v1) allows you to add member-level serialization data at the type level, so you can include that information in a partial class alongside a generated type:
p60229
as(dp60230
g18
V23354
p60231
stp60232
a((dp60233
g2
(lp60234
VThe CLI doesn't care about properties, as long as all the methods (which is all an interface really defines) have implementations:
p60235
as(dp60236
g18
V23354
p60237
stp60238
a((dp60239
g2
(lp60240
V isn't responsible for that -  is, so the key here is to create a  object with  set to true, and pass that in when constructing the :
p60241
as(dp60242
g18
V23354
p60243
stp60244
a((dp60245
g2
(lp60246
VYes,  here will apply to all code that access it, regardless of thread or user
p60247
aVIt is very rare that you want a  field in a highly threaded environment like ASP
p60248
aVNET
p60249
aVYou are also artificially extending the lifetime of the label instance long beyond what was intended
p60250
aVThere are alternatives like the user's session or the application level - but store the string (if anything), not the label object
p60251
as(dp60252
g18
V23354
p60253
stp60254
a((dp60255
g2
(lp60256
VI may be wrong, but I would expect the following to work:
p60257
aV(assuming you want to populate the zeroth table)
p60258
as(dp60259
g18
V23354
p60260
stp60261
a((dp60262
g2
(lp60263
VPresumably your app is running with full-trust
p60264
aVIn full trust granular CAS permissions are not checked
p60265
as(dp60266
g18
V23354
p60267
stp60268
a((dp60269
g2
(lp60270
Vprotobuf-net generally has a significant space-saving (as in: order-of-magnitude) on most data, and can attach to WCF
p60271
aVUnfortunately at the moment it doesn't support full graphs, only trees
p60272
aVHowever, I have plans there that I simply haven't had time to implement
p60273
aVI can't promise anything, but I could try to bump that work a bit sooner
p60274
aVOtherwise; there may be ways to tweak your existing code to work with a tree instead of a graph
p60275
as(dp60276
g18
V23354
p60277
stp60278
a((dp60279
g2
(lp60280
VRe being the "only"; that is just not the case; tools like MonoTouch allow you to develop for iPhone in C# / MonoDevelop, using the device-native widgets
p60281
as(dp60282
g18
V23354
p60283
stp60284
a((dp60285
g2
(lp60286
VSometimes, TSQL is the way to go
p60287
aVI would use  here:
p60288
aVYou could also swap out the :
p60289
as(dp60290
g18
V23354
p60291
stp60292
a((dp60293
g2
(lp60294
VA subtle variation that defers the lists construction - useful for some scenarios involving WCF (which skips both the constructor and field initializers) without needing deserialization callbacks:
p60295
as(dp60296
g18
V23354
p60297
stp60298
a((dp60299
g2
(lp60300
VAlso note that your approach using  as a captured variable is not safe; someone could call  first, for example - of use
p60301
as(dp60302
g18
V23354
p60303
stp60304
a((dp60305
g2
(lp60306
VFor inserting into the middle, a  would be the fastest option - anything else involves copying data
p60307
aVAt 14 elements, don't stress over binary search etc - just walk forwards to the item you want:
p60308
as(dp60309
g18
V23354
p60310
stp60311
a((dp60312
g2
(lp60313
V is a member of  (property or field), not a parameter:
p60314
as(dp60315
g18
V23354
p60316
stp60317
a((dp60318
g2
(lp60319
VMy understanding is that (both for modal and non-modal editors) it is completely up to the whim of the control being shown
p60320
aVIf the  involved chooses a big form, it will be big
p60321
aVThe only way to change that would be to define your own  and associate it with the types involved (sometimes possible with , that creates the same form as the runtime wanted to show, but resizes it before showing
p60322
as(dp60323
g18
V23354
p60324
stp60325
a((dp60326
g2
(lp60327
V already does some things to short-circuit here, but it would be trivial to make it complete:
p60328
aVThe choice of  is since this has specific handling inside  to avoid having to use  (reflection)
p60329
as(dp60330
g18
V23354
p60331
stp60332
a((dp60333
g2
(lp60334
VThat observation is indeed correct; this is an extension method, as noted by the  modifier before the parameter-type:
p60335
aVThe compiler will then resolve calls to the method looking like an instance method of , but note that it is still actually a static call - so:
p60336
aVis actually compiled as:
p60337
aVwhich can result in oddities such as  can be  and the call will still work
p60338
as(dp60339
g18
V23354
p60340
stp60341
a((dp60342
g2
(lp60343
VUI controls have thread affinity
p60344
aVYou shouldn't touch the controls (for read or write) from any thread except the UI thread
p60345
aVIf the  is talking primarily to the UI, you would probably be better off with just a  control, avoiding the need to call  or  lots of times
p60346
aVHowever, generally I would prefer a more "observer" based design here, with change-notification events (either  or ) and event-handlers that cause the UI to reflect changes
p60347
as(dp60348
g18
V23354
p60349
stp60350
a((dp60351
g2
(lp60352
VSomething like:
p60353
aVhowever - this reflection can be slow in a tight loop; if you are doing this lots, I would be tempted to reverse the dependency, so the generic code calls into the non-generic code:
p60354
aV(with the implementation in the non-generic version)
p60355
as(dp60356
g18
V23354
p60357
stp60358
a((dp60359
g2
(lp60360
VCaptured variables:
p60361
aVOr (C# 2
p60362
aV0 alternative):
p60363
as(dp60364
g18
V23354
p60365
stp60366
a((dp60367
g2
(lp60368
VLambda expressions have various syntax options:
p60369
aVThe subtlety here is that  has an overload that accepts a , representing the value and index respectively (and returning the  for the match)
p60370
aVSo it is the  implementation that supplies the index - something like:
p60371
as(dp60372
g18
V23354
p60373
stp60374
a((dp60375
g2
(lp60376
VThat information is not inside the assembly, but is obtained from the matching
p60377
aVxml file - i
p60378
ag50
aVcan optionally have
p60379
aVYou would need to query the data from there, but note that in many cases this data is not deployed with 3rd-party dlls
p60380
as(dp60381
g18
V23354
p60382
stp60383
a((dp60384
g2
(lp60385
VInteresting; I've never noticed that in the past, but it is definitely reproducible
p60386
aVSince  doesn't support serialization callbacks (to help you know that it is running for serialization) this is hard to influence; arguably the simplest answer is "don't put default data into the objects in the constructor" (although maybe offer a factory method that does that)
p60387
aVYou could try implementing , but that is overly hard to get right, even for a simple example
p60388
aVI have checked, though, and  does not behave this way - so you could perhaps switch to ; here's my test code with DCS:
p60389
aVand here is what I mean by a the factory method:
p60390
as(dp60391
g18
V23354
p60392
stp60393
a((dp60394
g2
(lp60395
VIn your example, the sleeps mean that generally there is no contention
p60396
aVAn uncontended lock is very fast
p60397
aVFor this to matter, you would need a contended lock; if there are writes in that contention, they should be about the same ( may even be quicker) - but if it is mostly reads (with a write contention rarely), I would expect the  lock to out-perform the
p60398
aVPersonally, I prefer another strategy here, using reference-swapping - so reads can always read without ever checking / locking / etc
p60399
aVWrites make their change to a cloned copy, then use  to swap the reference (re-applying their change if another thread mutated the reference in the interim)
p60400
as(dp60401
g18
V23354
p60402
stp60403
a((dp60404
g2
(lp60405
VInside xml (as a text value) it is correct for  to be encoded as
p60406
aVThe internal representation of xml doesn't affect the value, so let it get encoded
p60407
aVYou can get around this by forcing a CDATA section, but in all honesty - it isn't worth it
p60408
aVBut here is an example using CDATA:
p60409
as(dp60410
g18
V23354
p60411
stp60412
a((dp60413
g2
(lp60414
VVery simply: the parsing engine, when looking at the expression-tree, is hard-coded to spot those methods and interpret them in a specific way in TSQL
p60415
aVIt never actually calls the method - which is why your  fails - it isn't programmed to spot
p60416
aVYou can do this to a small degree in your own code by using the  code that normally encapsulates UDFs for L2S - for example, here is a cheeky way of wrapping up the  inbuilt SQL-Server function:
p60417
as(dp60418
g18
V23354
p60419
stp60420
a((dp60421
g2
(lp60422
V uses the public API
p60423
aVIf you are using  it is possible that you have just provided a method and marked it as implementing that method, in which case it is (essentially) an explicit interface implementation, and undiscoverable by
p60424
aVTo use  it would probably need  and a public property, with the property implementation method also marked as the interface implementation
p60425
aVFor comparison,  would also fail with:
p60426
as(dp60427
g18
V23354
p60428
stp60429
a((dp60430
g2
(lp60431
VGenerally, the optional/conditional compilation symbols will be provided by the build script
p60432
aVIt is pretty rare to see , except for very debug code (if you see what I mean)
p60433
aVRe using a variable; I often use such conditions to handle code that must run on different runtimes (mono, cf, silverlight, etc)
p60434
aVA variable cannot suffice because the code cannot be compiled against the wrong platform (missing types/methods etc)
p60435
aVIn the example presented I would probably just have used ; since this is decorated with , all calls to it are automatically removed if  is not defined at build
p60436
as(dp60437
g18
V23354
p60438
stp60439
a((dp60440
g2
(lp60441
VIf the web server is the same as the SQL server, just use  as the server name; much simpler
p60442
aVIf the web server us not the same as the SQL server, ensure that there is line-of-sight between these servers through any firewalls etc
p60443
aVAlso ensure that the server name resolves (in many ways, it is simpler to use the IP address in the connection string if name resolution cannot be guaranteed)
p60444
as(dp60445
g18
V23354
p60446
stp60447
a((dp60448
g2
(lp60449
VTry:
p60450
aVNote also tat the type returned from 's deserialize method is going to be a  record
p60451
as(dp60452
g18
V23354
p60453
stp60454
a((dp60455
g2
(lp60456
VC# does not have template specialization
p60457
aVYou nave simply declared a new method with the type-parameter named , which has nothing to do with the class named
p60458
aVYou can cast, or there are generic constraints you use to declare that  is at least a
p60459
aVAnother option would be to make the base-type itself generic in  (and remove the generic from the method), and have the concrete type
p60460
as(dp60461
g18
V23354
p60462
stp60463
a((dp60464
g2
(lp60465
VRole-based security is intended as a way for library code to consume the client's chosen security model without needing to know the implementation; the key here being that you are already at a point where it is reasonably to trust the client's security model, and you just want to offer appropriate options based on decisions made by the client (for example as part of a login process)
p60466
aVIf you don't trust the client, all bets are off anyway, as they could just use reflection to rip your internals to shreds
p60467
aVIn that scenario, it would be better to keep that implementation code private, for example via a web-service that accepts the user's credentials in some fashion
p60468
aVThen they can only be accounts that they have the credentials for
p60469
as(dp60470
g18
V23354
p60471
stp60472
a((dp60473
g2
(lp60474
VWhat is the easiest way to convert a SqlDataReader to IDatareader
p60475
aVSince  implements , this is just an implicit cast:
p60476
as(dp60477
g18
V23354
p60478
stp60479
a((dp60480
g2
(lp60481
VGenerally I've had a pretty positive experience working from xsd
p60482
aVOn the few occasions it has failed, I've found a pragmatic approach (if you have sample xml available) is to use the xsd
p60483
aVexe tool to generate something that even if not ideally typed, at least matches the xml
p60484
aVOf course, you might need to live with a few more  members that you like, or tweak them manually
p60485
aVTweaking the xsd (to account for any changes not in your copy, or to hack away xsd options not supported by your tooling) might be a sensible option, but it is hard to gauge how long you might need to spend on that route
p60486
aVRe the value: well, when it works it is a pretty fair way of getting an object-model that can serve as a DTO layer
p60487
aVAnd usually it does work
p60488
aVBut not quite always
p60489
aVIt sounds like your scenario has large/complex/multiple xsd, so doing all that translation code by hand (either via xml querying, or writing your own DTO model from scratch) can be a lot of work
p60490
aVXsd can (and should) also be used as a tool to validate that the xml you are passing around continues to adhere to a published definition
p60491
aVWhen dealing with xml data-imports I have, on multiple occasions, made the first step a scan through an xsd validator (fortunately  will do that in
p60492
aVNET)
p60493
as(dp60494
g18
V23354
p60495
stp60496
a((dp60497
g2
(lp60498
VOptimistic concurrency is very common here, often using the  (aka  in SQL server) data type
p60499
aVMost ORMs will handle this automatically (detecting the presence of a /) - otherwise you will need to handle this in your code
p60500
aVAt the simplest level; you keep hold of the  you fetched when you fetched the record for editing, and check it when you attempt to save
p60501
aVIf it matches, the save is committed; otherwise you throw an exception (the second edit loses)
p60502
aVNote you can (as an alternative) check each column during the update; this is more granular, but more costly (and it doesn't fully cope with some scenarios with inter-dependent properties)
p60503
as(dp60504
g18
V23354
p60505
stp60506
a((dp60507
g2
(lp60508
VIt is unclear what edit mechanism you are using, but if multiple  are involved, yes: you must tell the submitting data-context about the delete (via )
p60509
aVOf course, it needs to know about every change - otherwise it won't know to change the database
p60510
as(dp60511
g18
V23354
p60512
stp60513
a((dp60514
g2
(lp60515
VFirstly,  is documented as only being able to perform a single async request at a time (raising ), so you would need two such requests
p60516
aVIf you raised two such requests at the same time I would fully expect both to go to the server - there would be no reason not to
p60517
aVIn particular:
p60518
aVA copy of a resource is only added to the cache if the response stream for the resource is retrieved and read to the end of the stream
p60519
aVSo another request for the same resource could use a cached copy, depending on the cache policy level for this request
p60520
aVSo at the point of making the request, we should assume (from the question) that the data has not yet been read - so nothing will be cached locally yet
p60521
aVDepending on whether both requests are routed to the same server, the server might queue the requests, and might be configured to cache the result, but in all likelihood the server(s) will just process everything here twice
p60522
as(dp60523
g18
V23354
p60524
stp60525
a((dp60526
g2
(lp60527
VThe bit that concerns me is:
p60528
aVthe fact that you needed to add  suggests to me that it is currently , meaning you could be doing the paging at the wrong end of the query (bringing back way too much data over the network)
p60529
aVWithout  and the custom  it is hard to be sure - but as always, the first thing to do is to profile the query via a trace
p60530
aVSee what query is executed and what data is returned
p60531
aVEFProf might make this easy, but a SQL trace is probably sufficient
p60532
as(dp60533
g18
V23354
p60534
stp60535
a((dp60536
g2
(lp60537
VThis is a bit guesswork, but do you mean:
p60538
as(dp60539
g18
V23354
p60540
stp60541
a((dp60542
g2
(lp60543
VThis is due to interning - the CLI automatically re-uses strings obtained as literals (i
p60544
ag50
aVstrings that have come directly from your source code)
p60545
aVNote that if you did:
p60546
aVthey would not be the same string instance, as they have not come from literals
p60547
aVThis is documented against the  IL instruction:
p60548
aVThe Common Language Infrastructure (CLI) guarantees that the result of two ldstr instructions referring to two metadata tokens that have the same sequence of characters return precisely the same string object (a process known as "string interning")
p60549
as(dp60550
g18
V23354
p60551
stp60552
a((dp60553
g2
(lp60554
VAllow me to tidy; important points:
p60555
aVto ensure proper disposal
p60556
aVsetting the command's
p60557
aVexecuting the command with
p60558
aVCode:
p60559
as(dp60560
g18
V23354
p60561
stp60562
a((dp60563
g2
(lp60564
VI've tested on
p60565
aVNET 2
p60566
aV0 and
p60567
aVNET 4
p60568
aV0, and I get  as , as expected
p60569
aVAre you sure you don't perhaps have the break-point too high
p60570
as(dp60571
g18
V23354
p60572
stp60573
a((dp60574
g2
(lp60575
Vbtw, never never use  on a server ;p
p60576
aVThe core query using LINQ-to-SQL is something like:
p60577
aVassuming a hand-crafted DBML (since the designer filters these tables), along the lines of:
p60578
as(dp60579
g18
V23354
p60580
stp60581
a((dp60582
g2
(lp60583
V(edit: this answer relates to when the question referred to tabs)
p60584
aVUnless I have misunderstood the question, a couple of options:
p60585
aVhave two separate instances of the  and associated image
p60586
aVsneakily re-position the  when the tab index changes (small saving on resources)
p60587
as(dp60588
g18
V23354
p60589
stp60590
a((dp60591
g2
(lp60592
s(dp60593
g18
V23354
p60594
stp60595
a((dp60596
g2
(lp60597
VIf there is no return type, you want :
p60598
aVor just:
p60599
as(dp60600
g18
V23354
p60601
stp60602
a((dp60603
g2
(lp60604
VTry using  here:
p60605
as(dp60606
g18
V23354
p60607
stp60608
a((dp60609
g2
(lp60610
VI can reproduce this (in both debug and release), when executed via the IDE with the "Debug" => "Enable the Visual Studio hosting process" option enabled, via the below
p60611
aVAt the command-line it will print "hello", where-as via the IDE it will print "world"
p60612
aVIt looks like the IDE is doing some different reflection on the attributes
p60613
aVThis is not expected behaviour, and you should not rely on this behaviour
p60614
aVIf you want some particular code to execute: invoke the desired code explicitly
p60615
aVTo get predictable behaviour, disable the Debug" => "Enable the Visual Studio hosting process" option
p60616
as(dp60617
g18
V23354
p60618
stp60619
a((dp60620
g2
(lp60621
VI assume that  does something that talks to one or more UI controls
p60622
aVMaybe to read/write values
p60623
aVThat won't work, due to thread affinity
p60624
aVIf you are talking to the UI controls, use  to get onto the UI thread earlier
p60625
aVYou can of course query external data while on the background thread
p60626
as(dp60627
g18
V23354
p60628
stp60629
a((dp60630
g2
(lp60631
VWhy would Paraview display 1 through 4
p60632
aVis a complex beast that includes lots of additional metadata about
p60633
aVNET types
p60634
aVIf you can clarify how you want this encoded, it can perhaps help
p60635
aVFor example, if your 1-4 are bytes you should be able to base-64 encode them directly
p60636
aVIf they are to be treated as integers, you'd need to encode them to bytes first
p60637
aVUltimately, without a detailed encoding rule (including endianness etc) it is hard to give a definitive answer, but  almost certainly isn't it
p60638
aVI'm very familiar with custom binary encoding, and I'm happy to offer more help/guidance, but I really need more info in terms of what the protocol is expecting
p60639
aVFor example, using C# (sorry, my F#-foo is limited), and assuming little-endian fixed-length 32-bit integer encoding throughout:
p60640
as(dp60641
g18
V23354
p60642
stp60643
a((dp60644
g2
(lp60645
VYou are calling  - this overwrites the file; perhaps you should
p60646
aVOr, more efficiently, use a  in the first place - i
p60647
ag50
aVReducing the code in the question to something like the minimal key code, something like:
p60648
as(dp60649
g18
V23354
p60650
stp60651
a((dp60652
g2
(lp60653
VQuicker to type
p60654
aVPerhaps:
p60655
aVBut that will execute slower than a single  loop:
p60656
as(dp60657
g18
V23354
p60658
stp60659
a((dp60660
g2
(lp60661
V1: For small, File
p60662
aVReadAllBytes
p60663
aV2: For big, Stream (FileStream) or a BinaryReader on a Stream - the purpose being to remove the need to allocate a massive buffer, by changing the code to read small chunks consecutively
p60664
aV3: Go back and find the expected size; default to worst-case (#2)
p60665
aVAlso note that I'd try to minimise the siE in the first place, perhaps via the choice of data-format, or compression
p60666
as(dp60667
g18
V23354
p60668
stp60669
a((dp60670
g2
(lp60671
VIn the general case that will be hard
p60672
aVObviously looking for the right character range helps spot things like base-64, but beyond that you'd need a lot of per-type logic
p60673
aVAnything text-based could itself use any Unicode/code-page encoding, for example
p60674
aVXml and json are probably ratively easy to infer (guess based on the start chars, then try running it through a parser/validator)
p60675
aVOf course non-x-HTML complicates matters
p60676
aVBinary forms are trickier and more numerous; could it be an image,
p60677
aVSound
p60678
aVZip
p60679
aVOr a binary data format; protobuf perhaps
p60680
aVOr bespoke
p60681
aVAnd what Endianness are we in
p60682
aVThen; is the entire payload gzip
p60683
aVDeflate
p60684
aVEncrypted
p60685
aVSo yes; it can probably be done - wireshark tries, for example
p60686
aVBut it is a lot of work, with no magic short-cuts
p60687
as(dp60688
g18
V23354
p60689
stp60690
a((dp60691
g2
(lp60692
VAt the moment you only open the connection () inside the
p60693
aVOf course, the most likely place that an exception will throw is this line
p60694
aVEither way, it makes sense that the connection may not necessarily be open in the
p60695
aVAnd if the underlying problem is that the call to  failed, there isn't much that it can do
p60696
as(dp60697
g18
V23354
p60698
stp60699
a((dp60700
g2
(lp60701
VI'm all for simple; I'd just have one class here
p60702
aVIn C# maybe use :
p60703
aVIn Java  (which obviously lacks ), maybe just expose the score along with an  flag (or a count of the number of exams evaluated) - if this is  (or ) you just ignore the score
p60704
as(dp60705
g18
V23354
p60706
stp60707
a((dp60708
g2
(lp60709
VYou need to handle the  event to actually provide the contents; MSDN has a full example
p60710
aVThe  is purely something to show to the user - it is not the path of an existing file to magically print
p60711
aVFor printing an existing PDF, maybe look at this question
p60712
as(dp60713
g18
V23354
p60714
stp60715
a((dp60716
g2
(lp60717
VLINQ to SQL can't magically translate arbitrary C# to TSQL; a limited selection of commonly needed syntax is available inside LINQ, but a C# method is not going to work
p60718
aVOptions:
p60719
aVrewrite the function as a UDF (in TSQL) and map the UDF to your data-context (i
p60720
ag50
aVdrag the UDF onto the designer surface); use  in LINQ
p60721
aVapply your function only once the data is back in
p60722
aVNET-land
p60723
aVre-write the function as a LINQ-projection
p60724
aVI expect the middle option is the easiest in your scenario
p60725
aVFor example:
p60726
aVThe  breaks "composition" - i
p60727
ag50
aVit stops LINQ-to-SQL from trying to understand  in terms of TSQL; only the  and  are retrieved from SQL; then as it processes each row it applies the second projection to calculate the tax
p60728
as(dp60729
g18
V23354
p60730
stp60731
a((dp60732
g2
(lp60733
VI'm guessing the problem is largely here:
p60734
aVIf anything goes wrong, you are swallowing it (returning )
p60735
aVYou don't show what the  is in , but I'm guessing it is similar
p60736
as(dp60737
g18
V23354
p60738
stp60739
a((dp60740
g2
(lp60741
VLINQ (presumably meaning LINQ-to-SQL or EF) doesn't currently have any special treatment of the XML data-type
p60742
aVYou'll need to fetch it back as normal, then load it into a DOM and handle from there
p60743
aVPerhaps looking at the question: how to load xml file into dropdownlist in asp
p60744
aVnet
p60745
as(dp60746
g18
V23354
p60747
stp60748
a((dp60749
g2
(lp60750
VThat shouldn't affect anything - the following works fine:
p60751
as(dp60752
g18
V23354
p60753
stp60754
a((dp60755
g2
(lp60756
VIt sounds like you want some form of binary serialization; here is a working version using protobuf-net (note I changed  to ):
p60757
as(dp60758
g18
V23354
p60759
stp60760
a((dp60761
g2
(lp60762
V is very much a useful construct, in particular in patterns like , where you want to know the "if" and the "what" separately (and nullable isn't necessarily an option)
p60763
aVHowever - in this case, why not just make it:
p60764
aVand use the return value to signal this
p60765
as(dp60766
g18
V23354
p60767
stp60768
a((dp60769
g2
(lp60770
VIn the dbml designer, set the serialization mode to unidirectional
p60771
aVJob done
p60772
aVIf you need a slightly different DTO layer, maybe AutoMapper is a good option
p60773
as(dp60774
g18
V23354
p60775
stp60776
a((dp60777
g2
(lp60778
VBecause you are using  on the collection property, the corresponding xml is going to be something like:
p60779
aVthere isn't really anywhere it can get a better name for a collection property, other than
p60780
aVI wonder if it might be better to use:
p60781
aVin order to build:
p60782
aVthen you would have a  property
p60783
as(dp60784
g18
V23354
p60785
stp60786
a((dp60787
g2
(lp60788
VYou are using  - this is pretty-much limited to processing the data locally, once materialized by your single  on the ; query composition demands
p60789
aVWhich in turn will demand  for each predicate
p60790
aVTry:
p60791
aVYou should still be able to call this with lambdas, but if you are explicitly handling  delegates those will need to be updated to expression-trees, via
p60792
as(dp60793
g18
V23354
p60794
stp60795
a((dp60796
g2
(lp60797
VThat doesn't look thread-safe to me; the inside of the dictionary could already be in the process of being re-written
p60798
aVAt a minimum it probably needs a reader/writer lock:
p60799
aVand if you only want  to execute once, move it inside the write-lock and add a double-check:
p60800
as(dp60801
g18
V23354
p60802
stp60803
a((dp60804
g2
(lp60805
VI don't have VB 2008 handy, but to the best of my knowledge there has never been any automatic conversion (implicit or explicit) between  and  - LINQ-to-XML is largely a parallel implementation of a DOM, with only a few things (like  as a source) in common
p60806
aVHowever; in terms of addressing the issue, the best I can suggest is to work with the xml; a C# example (using  to avoid having to go via a ):
p60807
aVand to convert it back again (to match the question title):
p60808
as(dp60809
g18
V23354
p60810
stp60811
a((dp60812
g2
(lp60813
VRunning a form in a form's constructor is generally going to end badly
p60814
aVI would separate these out, i
p60815
ag50
aVin your  method
p60816
aVYou would also change the login form to set the  appropriately
p60817
as(dp60818
g18
V23354
p60819
stp60820
a((dp60821
g2
(lp60822
VYou could perhaps pre-group the shorter list; this should give you better performance - I can't find citations to the exact big-O ratings since MSDN doesn't cite them, but it could be O(n + m) instead of O(n * m)
p60823
aVthen you can use:
p60824
aVOr without LINQ (from comments):
p60825
as(dp60826
g18
V23354
p60827
stp60828
a((dp60829
g2
(lp60830
VI would switch to  - this is inherently local-only, but also avoids a few additional layers, and doesn't require access to any ports (which non-admins don't have by default)
p60831
aVThis can be done in config using the  element
p60832
as(dp60833
g18
V23354
p60834
stp60835
a((dp60836
g2
(lp60837
VIt indeed appears so
p60838
aVThe fact that it works suggests that only the last overload is currently being invoked
p60839
aVSince there are different parameters involved, perhaps it would be better to lose the static method (that isn't helping):
p60840
as(dp60841
g18
V23354
p60842
stp60843
a((dp60844
g2
(lp60845
VI can't comment on Android, but you just need to:
p60846
aVreverse the base-64
p60847
aVreverse the gzip
p60848
aVdecode the string (presumably as UTF8)
p60849
aVIn C#, this would be something like:
p60850
as(dp60851
g18
V23354
p60852
stp60853
a((dp60854
g2
(lp60855
VYou can do:
p60856
aVor
p60857
as(dp60858
g18
V23354
p60859
stp60860
a((dp60861
g2
(lp60862
VI wouldn't even write it as recursion:
p60863
aVRecursion is generally bad if too deep
p60864
aVThen:
p60865
aVYou could also just loop and print in a single method
p60866
aVBut where would be the fun in that
p60867
aV(this approach chosen deliberately to show a useful technique while not directy being usable as a homework answer)
p60868
as(dp60869
g18
V23354
p60870
stp60871
a((dp60872
g2
(lp60873
VThe startup page can be set via project properties => web
p60874
aVTypically I find the best option is "do nothing" (I'll invoke the page I want in the browser I want manually)
p60875
as(dp60876
g18
V23354
p60877
stp60878
a((dp60879
g2
(lp60880
VI advise against the separate (debug) vs combined (release); this creates additional variables to fight and you will eventually get bitten by this - but only in production
p60881
aVMinified vs original is less clear-cut, but we have seen occasions when the js minifier simply gets it wrong; the minifier version behaves differently
p60882
aVLikewise some CSS minifiers will fail (emitting an empty CSS, typically) if it doesn't like the input (even if that same CSS works in your browser)
p60883
aVFor these reasons I'd say develop on the minified version to spot this sooner
p60884
aVOther thoughts:
p60885
aVensure you support gzip/deflate
p60886
aVensure you support expiration headers
p60887
aVimage spriting
p60888
aVa CDN or similar for static content (no cookies; expiry headers enabled; web server in static file mode - no CPU overhead)
p60889
aV(and yes, you will want to combine that with a cache-breaker)
p60890
as(dp60891
g18
V23354
p60892
stp60893
a((dp60894
g2
(lp60895
VAnother (more
p60896
aVNET) option here would be to write it in IL and compile either with ilasm, or something like MonoDevelop which has support for IL projects
p60897
as(dp60898
g18
V23354
p60899
stp60900
a((dp60901
g2
(lp60902
VIt is not mutable; check again
p60903
aVThe boxing is different too; an empty "boxes" to null
p60904
aVBut; it is small (barely bigger than T), immutable, and encapsulates only structs - ideal as a struct
p60905
aVPerhaps more importantly, so long as T is truly a "value", then so is T
p60906
aVa logical "value"
p60907
as(dp60908
g18
V23354
p60909
stp60910
a((dp60911
g2
(lp60912
VI'm actually pretty surprised that works with L2S;  is a curious beast, after all
p60913
aVYou could try ensuring you are using the EF 4 POCO support, rather than the 3
p60914
aV5SP1-style common-base-class approach, but to be honest I'm not sure this is the way to go
p60915
aVdatabase objects shouldn't really have dynamic properties, IMO
p60916
aVYour intent isn't clear, but if this is for data-binding purposes, you might want to look at custom object models, via  or
p60917
aVThis is an older technology for seeming to extend objects at runtime (without needing )
p60918
as(dp60919
g18
V23354
p60920
stp60921
a((dp60922
g2
(lp60923
VTo invoke generics from a  instance, you would have to use:
p60924
aVwhich is
p60925
aVawkward - as you then need to do lots of additional work with reflection
p60926
aVAlternatively, you can call into a generic method that does the code:
p60927
as(dp60928
g18
V23354
p60929
stp60930
a((dp60931
g2
(lp60932
VGenerally the most convenient way of doing this is going to be with a plain old-fashioned HTTP request to the associated url; so then the question becomes "how do I make an HTTP request from c++
p60933
aVLuckily: How do you make a HTTP request with C++
p60934
as(dp60935
g18
V23354
p60936
stp60937
a((dp60938
g2
(lp60939
VIt sounds like you're writing way too much data there; generally raw  might be the best option for this volume
p60940
aVHowever, if you can  successfully you could perhaps try:
p60941
aVor maybe:
p60942
aVBut either (or both) of these might still explode in a shower of sparks
p60943
aVYou might also want to investigate  which is designed for this type of scenario
p60944
aVbut still, that is a lot of xml - especially for a web-service
p60945
aVWould you be open to suggestions of alternative (much denser) serializiation formats
p60946
as(dp60947
g18
V23354
p60948
stp60949
a((dp60950
g2
(lp60951
VSure; you can do that in many ways; starting with reflection (note, this is slowish - OK for moderate amounts of data though):
p60952
aVHowever; for larger volumes of data it would be worth making this more efficient; for example here I use the  API to pre-compile a delegate that looks writes each property - the advantage here is that no reflection is done on a per-row basis (this should be significantly faster for large volumes of data):
p60953
as(dp60954
g18
V23354
p60955
stp60956
a((dp60957
g2
(lp60958
VIt sounds like you want the C++ world of being able to override but not call; then no: you can't do that in C#
p60959
aVThe other way around is fine, though - either don't mark it  in the first place, or mark it  if it is already
p60960
as(dp60961
g18
V23354
p60962
stp60963
a((dp60964
g2
(lp60965
VSince you need to process that data into a  anyway (unless you are writing a custom ), you should merge the records before giving them to ; for example (in pseudo code):
p60966
aVthen pass the  to  once you have the desired data
p60967
aVRe the edit; in that scenario, I would upload to a staging table (just a regular table that has a schema like the uploaded data, but typically no foreign keys etc), then use regular TSQL to move the data into the transactional tables
p60968
aVIn addition to full TSQL support this also allows better logging of operations
p60969
aVIn particular, perhaps look at the  clause of  which can help complex bulk operations
p60970
as(dp60971
g18
V23354
p60972
stp60973
a((dp60974
g2
(lp60975
VThis is something I hope to strengthen in v2, basically be injecting an exception into the logic that decides not to write a specific field
p60976
aVFor now you would need to verify externally
p60977
aVI'll go and log a work-item for this
p60978
as(dp60979
g18
V23354
p60980
stp60981
a((dp60982
g2
(lp60983
VNo, basically
p60984
aVLINQ-to-SQL itself supports multiple grids, but typically when calling a stored-proc, and not via
p60985
aVAnd since you don't want to change the schema you can't use a cheeky  with a dummy column
p60986
aVSo no
p60987
aVYou could, however, do something like the following (which will of course mandate 2 round-trips to the server):
p60988
as(dp60989
g18
V23354
p60990
stp60991
a((dp60992
g2
(lp60993
VI'm not sure if that is meant to be ironic, but it is a
p60994
aVNET plugin providing rich media support and full vector graphics (with GPU acceleration) for use in the web
p60995
aVA "Mono" version (Moonlight) is also available for Unix
p60996
aVIt certainly has some similarities to Flash, etc
p60997
aV, but it is a different implementation, based more on the
p60998
aVNET stack
p60999
aVOf course it is also now at competition with JavaScript and jQuery which get faster and richer at a pace
p61000
aVThe same technology (but a different core) also powers much of Windows Phone 7 development, and similar approaches are used in WPF
p61001
as(dp61002
g18
V23354
p61003
stp61004
a((dp61005
g2
(lp61006
VRemoting; it means that between AppDomains or machines, rather than serialize and transfer the object, the object stays at one end and a proxy is created at the other
p61007
aVAll method calls to the proxy are intercepted and the call is transmitted as RPC wiki, msdn, causing the method to execute on the other machine (typically serialising the arguments and return value)
p61008
aVNote: this can lead to unexpectedly "chatty" interfaces
p61009
aVThe object/proxy/RPC approach is now less preferable to approaches with an explicit service boundary; Microsoft now recommends WCF wiki, msdn instead of remoting
p61010
as(dp61011
g18
V23354
p61012
stp61013
a((dp61014
g2
(lp61015
VYou don't state he problem, but I expect you mean:
p61016
aV(base-class)
p61017
aV(sub-class)
p61018
aVAlso; your page is a product; you shouldn't need to create an additional product in the constructor
p61019
aVSo Page_Load should probably be invoking virtual mehods on the current instance ("this")
p61020
as(dp61021
g18
V23354
p61022
stp61023
a((dp61024
g2
(lp61025
VThere is an unfortunate duplicity between ParentId and Parent; having them disagree is a pain, so it doesn't let you do that
p61026
aVYou can set just the id though - especially when inserting
p61027
aVYou could try:
p61028
aVThen they can't be in conflict
p61029
as(dp61030
g18
V23354
p61031
stp61032
a((dp61033
g2
(lp61034
VCasing doesn't excite me; especially with any decent IDE you'll have intellisense, auto-complete, auto-correct, etc
p61035
aVWorst case: the compiler finds it for you
p61036
aVAnd I really don't buy that being forced into a specific line-space pattern is a good thing (and yes, I used VB for years)
p61037
aVIt is true that c# and VB
p61038
aVnet have a lot of convergence, especially now with dynamic (which helps plug the only real gap in c# bs VB
p61039
aVnet)
p61040
aVFor a powerful c# feature: iterator blocks (aka yield return)
p61041
aVAlso; the lambda syntax is more complete/versatile
p61042
aVBut a less-specific argument: having used both extensively, I find c# more expressive, simpler to read/maintain, and cleaner
p61043
aVIn short: I like it lots ;)
p61044
aVThere is also the case that starting witha syntax familiar to java/c/c++/JavaScript makes transfer easier
p61045
as(dp61046
g18
V23354
p61047
stp61048
a((dp61049
g2
(lp61050
VIt does indeed only flush upon close
p61051
aVYou will need to use a different DeflateStream instance each time, passing true to the overloaded constructor telling it not to close the underlying stream when you close the DeflateStream
p61052
as(dp61053
g18
V23354
p61054
stp61055
a((dp61056
g2
(lp61057
VIf that is for corporate / domain use, then group-policy might be a better option
p61058
aVTrying to do this in a browser is going to be tricky; since it is IE you could perhaps do something awful with an activex control, but that is opening one security hole to check that a different security hole is closed
p61059
aVAnd the activex one is (IMO) of more immediate concern
p61060
aVAlso consider that by default, or by choice, most options will be locked down
p61061
aVAnd even if you get it working for IE; for virtually any other browser you don't have such options - and designing just for IE is
p61062
aV(chooses words carefully) against best practice
p61063
aVBut also; for a web-site, how is it necessary to know this
p61064
aVEspecially if it is your web-site: simply, don't put malware on there, and don't leave XSS holes
p61065
aVMy bank doesn't demand any specific anti-virus, after all
p61066
as(dp61067
g18
V23354
p61068
stp61069
a((dp61070
g2
(lp61071
VThe trick to making a self-unsubscribing event-handler is to capture the handler itself so you can use it in a
p61072
aVThere is a problem of declaration and definite assignment, though; so we can't do something like:
p61073
aVSo instead we initialize to  first, so the declaration is before the usage, and it has a known value () before first used:
p61074
as(dp61075
g18
V23354
p61076
stp61077
a((dp61078
g2
(lp61079
VThe  operator in C# is short-circuiting, just like in Java
p61080
aVAs is
p61081
aVThe  and  operators are not short-circuiting, just like in Java
p61082
aVIf your results are different, there is a bug in the code
p61083
aVCan you show us the offending C# please
p61084
aVThis works fine:
p61085
as(dp61086
g18
V23354
p61087
stp61088
a((dp61089
g2
(lp61090
VResx is handy if you anticipate needing to swap them out - for example internationalization or per-instance customization
p61091
aVBut it isn't hugely hard to move them manually between them
p61092
aVSo: is it likely to need to change
p61093
aVI would say: if you do keep them in code, try to keep the constants as tightly scoped as possible; if a constant only relates to  instances, for example, put it in
p61094
aVLikewise, things that won't change shouldn't be cluttering up a resx; for example, some internal well-known string that relates to the meaning of a value in a database
p61095
aVprobably doesn't belong in resx even if you are using resx
p61096
as(dp61097
g18
V23354
p61098
stp61099
a((dp61100
g2
(lp61101
VCorrect; there is no such device
p61102
aVPresumably you are trying to protect against reading the field while another thread has changed half of it (atomicity)
p61103
aVNote that many (small) primitives are inherently safe from this type of threading issue:
p61104
ag691
aV5 Atomicity of variable references
p61105
aVReads and writes of the following data
p61106
aVtypes are atomic: , , ,
p61107
aV, , , , ,
p61108
aV, and reference types
p61109
aVIn
p61110
aVaddition, reads and writes of enum
p61111
aVtypes with an underlying type in the
p61112
aVprevious list are also atomic
p61113
aVBut in all honesty this is just the tip of the threading ice-berg; by itself it usually isn't enough to just have a thread-safe property; most times the scope of a synchronized block must be more than just one read/write
p61114
aVThere are also so many different ways of making something thread-safe, depending on the access profile;
p61115
aVreference-swapping to some class (essentially a , so a  in this case)
p61116
aV(in all the guises)
p61117
aV(in some scenarios; it isn't a magic wand
p61118
aVetc
p61119
aV(not to mention making it immutable (either through code, or by just choosing not to mutate it, which is often the simplest way of making it thread-safe)
p61120
as(dp61121
g18
V23354
p61122
stp61123
a((dp61124
g2
(lp61125
VDid you perhaps intend to use
p61126
aVThis is more data-contract oriented;  doesn't really care at all about data-contracts - it just looks at the type meta
p61127
aVonly has private fields;  only looks at public members
p61128
aVAdd a public property for , perhaps
p61129
aVNote that  does nothing here, and those types don't implement  etc, despite claiming to
p61130
aVEdit: confirmed the following seems to work OK:
p61131
aVand the following seems to work after adding a property:
p61132
as(dp61133
g18
V23354
p61134
stp61135
a((dp61136
g2
(lp61137
VImpossible to tell without code, but:
p61138
aVthe properties (or less commonly, fields) you want to serialize must be public
p61139
aVthe properties (blah) must be mutable, i
p61140
ag50
aVnot -only or
p61141
aVanything marked  is ignored, and a few other rules like ,  etc are observed
p61142
aVThose are the rules that would stop anything showing; other errors that would cause exceptions (check the inner-exceptions etc):
p61143
aVnot public (including any containing types)
p61144
aVno public parameterless constructor (including: must be concrete)
p61145
aVunexpected sub-types (i
p61146
ag50
aVnot previously advertised with )
p61147
aVsome member-types; , dictionaries, lists without an obvious , etc
p61148
as(dp61149
g18
V23354
p61150
stp61151
a((dp61152
g2
(lp61153
VTry using  as the format string
p61154
aVHowever, that will only fix the
p61155
aVTo fix the  rounding to always round down, you might want to use:
p61156
as(dp61157
g18
V23354
p61158
stp61159
a((dp61160
g2
(lp61161
VYou are passing a reference to the list, but your aren't passing the list variable by reference - so when you call  the value of the variable (i
p61162
ag50
aVthe reference - think "pointer") is copied - and changes to the value of the parameter inside  aren't seen by
p61163
aVtry:
p61164
aVThis then passes a reference to the local-variable  (as declared in ); now, if you reassign the parameter inside  you are also reassigning the variable inside
p61165
as(dp61166
g18
V23354
p61167
stp61168
a((dp61169
g2
(lp61170
VUntested, but maybe (from MSDN)
p61171
as(dp61172
g18
V23354
p61173
stp61174
a((dp61175
g2
(lp61176
VIt is a typo in the book
p61177
aVThere is no current version of C# in which that is valid (it should raise a "Type expected" compiler error)
p61178
aVWithout context it is impossible to know what it should be
p61179
as(dp61180
g18
V23354
p61181
stp61182
a((dp61183
g2
(lp61184
VFirstly; don't concatenate user input; that should be parameterized:
p61185
aVThe error means that the text in one of the boxes is longer than the declared column
p61186
aVEither expand the column in the database, or validate the length of the text in the boxes before sending to the server
p61187
aVObligatory XKCD reference
p61188
as(dp61189
g18
V23354
p61190
stp61191
a((dp61192
g2
(lp61193
VWhat serializer ate you currently using
p61194
aVAlmost all should work with that
p61195
aVBut public fields *is*a bad idea
p61196
aVXmlSerializer and JavaScriptSerializer will ignore private members
p61197
aVDataContractSerializer and protobuf-net can deal with private members
p61198
aVBinaryFormatter handles fields (public or private), but is not a good idea IMO for numerous reasons
p61199
as(dp61200
g18
V23354
p61201
stp61202
a((dp61203
g2
(lp61204
VProfile the two queries, comparing stats-IO and the actual execution plan
p61205
aVIt is entirely possible that it makes zero difference to the SQL server
p61206
aVIf you really want known TSQL, use ExecuteQuery-of-T and pass in the TSQL yourself
p61207
aVMaybe include some lock hints too (most commonly: NOLOCK)
p61208
as(dp61209
g18
V23354
p61210
stp61211
a((dp61212
g2
(lp61213
VThe anon-type is actually the compiler-generated type it is using to perform capture of the variables
p61214
aVWith delegates you can hack around this by implementing the capture by hand, but not with lambda expressions compiled to expression-trees
p61215
aVTwo choices:
p61216
aVbuild the expression tree explicitely on code via Expression
p61217
aVConstant etc
p61218
aVlearn how to handle the anon types
p61219
aVThe latter isn't too bad actually; they are just MemberExpression typically, although I have some code kicking around that covers this in full detail
p61220
aVI can also provide examples of buildin the expression tree, but I'm not at a PC at the moment and it doesn't lend itself well to iPod typing
p61221
aVFrom a brief read of the question I'd look at the first option more than the second
p61222
aVOh, and watch out; the first foreach code in the question looks susceptible to the notorious l-value capture issue ;)
p61223
aVEdit: I found a PC ;p
p61224
as(dp61225
g18
V23354
p61226
stp61227
a((dp61228
g2
(lp61229
VIt depends how frequently you call into it
p61230
aVIf rarely, a process should be fine
p61231
aVIf you call it a lot, then a lot of time is going to be spent on process-creation, reloading the dlls etc
p61232
aVYou might improve this a bit by running NGEN on the console app, but I suspect a better option might be some basic IPC comms to a long-running exe or service
p61233
aVBut keep the comms lightweight
p61234
aVAnother question is: have you profiled the process-based approach to see if this is actually an issue
p61235
as(dp61236
g18
V23354
p61237
stp61238
a((dp61239
g2
(lp61240
VWithout code we can only guess, but there is a big clue in the  - which suggests your query is taking too long
p61241
aVYou can increase the timeout on a command (but try to keep it sane
p61242
aVvia , but writing the query to be more efficient, or not pulling as much data in one query, would usually be preferable
p61243
as(dp61244
g18
V23354
p61245
stp61246
a((dp61247
g2
(lp61248
Vdo you mean:
p61249
aVor:
p61250
as(dp61251
g18
V23354
p61252
stp61253
a((dp61254
g2
(lp61255
VTry:
p61256
aV(note the square brackets)
p61257
aVAlso; it would be far preferable to use  for , , etc - everything that implements  - this will ensure you don't haemorrhage connections
p61258
ag412
ag50
as(dp61259
g18
V23354
p61260
stp61261
a((dp61262
g2
(lp61263
VIf you keep doing that (paraphrasing) "DataSource = DataSource
p61264
aVWhere(
p61265
aVyou are going to be filtering inside the filtered data repeatedly; but in this case I would:
p61266
aVa: store the list in a field for re-use, and
p61267
aVb: not us an anonymous type
p61268
as(dp61269
g18
V23354
p61270
stp61271
a((dp61272
g2
(lp61273
s(dp61274
g18
V23354
p61275
stp61276
a((dp61277
g2
(lp61278
VIt isn't as simple as introducing an interface, as the operators available are different per type, and are not always even homogeneous (i
p61279
ag50
aVDateTime + TimeSpan => DateTime, DateTime - DateTime => TimeSpan)
p61280
aVAt the techincal level, there may be lot of boxing etc involved here, plus regular operators are
p61281
aVActually, for  / ,  does pretty much everything you would hope
p61282
aVFor other operators: in
p61283
aVNET 4
p61284
aV0  is of great help here:
p61285
aVbut otherwise "MiscUtil" has generic support for operators via the  class, i
p61286
ag50
as(dp61287
g18
V23354
p61288
stp61289
a((dp61290
g2
(lp61291
VCode to the interface
p61292
as(dp61293
g18
V23354
p61294
stp61295
a((dp61296
g2
(lp61297
VThat is "code access security"; a random network share has very little trust from the core engine by default
p61298
aVWith 2
p61299
aV0, your options are:
p61300
aVuse a ClickOnce instead (execute the , not the )
p61301
aVuse  (on every client) to tell it to trust the share
p61302
aVdon't deploy that way (i
p61303
ag50
aVuse an installer)
p61304
aVWith some of the later service packs (it might be SP 2, I can't remember), mapped shares get more trust, i
p61305
ag50
aVwon't have enough trust by default, but  (which is mapped to ) will run
p61306
aVMy preference would be the ClickOnce deployment since it works on all versions
p61307
as(dp61308
g18
V23354
p61309
stp61310
a((dp61311
g2
(lp61312
Vnote the Terms and Conditions:
p61313
aVThe following are prohibited [
p61314
aVsnip
p61315
aVUse of any automated system, software
p61316
aVor process to extract content and/or
p61317
aVdata, including trawling, data mining
p61318
aVand screen scraping
p61319
aVis for basic/etc http security - not forms-based security
p61320
aVIt would be better to use an API if one exists
p61321
aVHTML forms are meant for humans, not computers
p61322
aVIt looks like there is a beta TfL API here
p61323
as(dp61324
g18
V23354
p61325
stp61326
a((dp61327
g2
(lp61328
VNo, basically
p61329
aVWell, you could do the work at runtime using , inspecting your types in code and setting the attributes appropriately, then making sure you cache the serializer (if you don't cache when using  you leak memory, as the generated assemblies aren't collected)
p61330
aVBut that sounds like more work
p61331
aVRe making the output shorter; xml compresses with GZip or Deflate very nicely
p61332
aVOf course, if you don't need xml, but just need the data serialized somehow, there are other options
p61333
as(dp61334
g18
V23354
p61335
stp61336
a((dp61337
g2
(lp61338
VIt sounds like you need:
p61339
as(dp61340
g18
V23354
p61341
stp61342
a((dp61343
g2
(lp61344
VSince this is ASP
p61345
aVNET, unless you have low site activity (which would be contrary to "that will scale considerably") I would suggest against that idea
p61346
aVYour other local CPUs are already doing plenty, as is the database
p61347
aVI would keep it sequential, but I would look for ways to fetch all the data I need in one hit to the database
p61348
as(dp61349
g18
V23354
p61350
stp61351
a((dp61352
g2
(lp61353
VOne easy option is to write a base-controller; override the methods you want (whether that is before the call () or upon exception ()), and just add  to each controller
p61354
aVAnother option would be to decorate each controller with a filter-attribute that does the same work
p61355
as(dp61356
g18
V23354
p61357
stp61358
a((dp61359
g2
(lp61360
VThe direct alternative to serialization is remoting, but that also requires changes to the types, so isn't going to work
p61361
aVRather than trying to serialize the TFS objects, I would write a object model that resembles the TFS objects (or better: the requests etc that you want to perform), and send that
p61362
aVThen reconstruct as needed
p61363
aVEssentially a shallow DTO layer on top of the actual objects
p61364
aVObviously you'll need to reconstruct the TFS model as needed (based on the DTO state), but that is life
p61365
as(dp61366
g18
V23354
p61367
stp61368
a((dp61369
g2
(lp61370
Vfirstly, that probably shouldn't be a  at all
p61371
aVThe syntax will be:
p61372
aVHowever, in addition you have the issue of public fields, and the fact that this is a mutable struct - both of which are dangerous
p61373
aVNo, really
p61374
aVI would add a constructor:
p61375
aVwith:
p61376
as(dp61377
g18
V23354
p61378
stp61379
a((dp61380
g2
(lp61381
VIIRC that implementation uses unsafe code (treating a byte* as an int*) so will be hard to beat, but the other alternative is shifting
p61382
aVHowever, from lots of work in this area; this is so unlikely to be a genuine bottleneck as to be irrelevent
p61383
aVIO is the main issue, typically
p61384
aVGetBytes(int), however, is more expensive (in high volume) due to array / heap allocation
p61385
as(dp61386
g18
V23354
p61387
stp61388
a((dp61389
g2
(lp61390
VHow about letting the compiler worry about it, i
p61391
ag50
aVThen bind instead to "SomeHelper"
p61392
aVThis could also be a generic method of needed, where it will use the magic "constrained" opcode
p61393
aVThis is also similar to
p61394
aVIf you are usig reflection to get the method you might try DynamicMethod
p61395
as(dp61396
g18
V23354
p61397
stp61398
a((dp61399
g2
(lp61400
VIt doesn't look between methods; not least, the method could be in a different assembly and could change without rebuilds, or could be virtual, extern, abstract or partial - it would be confusing to spot only a small number of cases
p61401
aVYou could have the ThrowEx return "int", and then:
p61402
aVwhich would make the compiler happy
p61403
aVOr use generics:
p61404
as(dp61405
g18
V23354
p61406
stp61407
a((dp61408
g2
(lp61409
VThat depends on whether  is ever going to have a nasty value such as
p61410
aVBut for simple values that should work OK
p61411
aVOtherwise, LINQ-to-XML is quite nice:
p61412
aV(replace the  with other types as necessary)
p61413
aVHere's something similar using LINQ over an XmlElement:
p61414
aVThe other option (without any LINQ) is simply looping manually with a foreach
p61415
as(dp61416
g18
V23354
p61417
stp61418
a((dp61419
g2
(lp61420
VA reasonable option is is to work with generics, i
p61421
ag50
aVYou won't need to specify the  in your code, as the compiler will usually be able to figure it out (i
p61422
ag50
aVyour existing samples would work "as-is")
p61423
aVFor the implementation:
p61424
aV(for generic type )
p61425
aVbut actually I would avoid the word , as that is used elsewhere to mean  /  /  - so I might have:
p61426
aVThis:
p61427
aVavoids boxing when T is a struct
p61428
aVhandles nulls /  correctly
p61429
aVsupports
p61430
aVor falls back to regular
p61431
aVit does not use the  operator, but MiscUtil has an  class that will, via
p61432
aV(note this latter will fail if  doesn't have an  operator, although thinking about it, it could use  as a fallback; it just doesn't)
p61433
aVFor completeness, note that  handles comparison operations
p61434
as(dp61435
g18
V23354
p61436
stp61437
a((dp61438
g2
(lp61439
VThe value
p61440
aVAssuming you mean "of the first table of the data-set", then:
p61441
aVbut more specifically:
p61442
as(dp61443
g18
V23354
p61444
stp61445
a((dp61446
g2
(lp61447
VThe "ALID/@alid" seems to be your key, so the first thing I would do (before ) is build a dictionary (assuming this is unique) over the  @alid values - then you can do most of the work without O(n*m) performance - it'll be more O(n+m) (which is a big difference)
p61448
aVthen you can use:
p61449
as(dp61450
g18
V23354
p61451
stp61452
a((dp61453
g2
(lp61454
VNote the explicit , which allows us to specify the
p61455
aVI also moved the list into a property for you (which is the norm)
p61456
as(dp61457
g18
V23354
p61458
stp61459
a((dp61460
g2
(lp61461
VIt depends on the context; for some scenarios, attributes actually can be added at runtime - but they only show under  (which is what most UI data-binding uses), and not raw reflection
p61462
aVFor example, for annotating a type:
p61463
aVto replace the type-converter for a type at runtime
p61464
aVYou can also do some tricks with properties, but it is a lot mode
p61465
aVfiddly
p61466
aVFor the general case; just use code attributes
p61467
aVThere is nothing inherently unreadable about attributes, and their location serves to highligh that they are metadata - about the type/method, but not really part of the type/method itself
p61468
aVThe following is for discussion only; I wouldn't do this just because you don't like the look of it (although I have done something like this to help annotate machine-generated code):
p61469
aVfile 1
p61470
aVfile 2
p61471
as(dp61472
g18
V23354
p61473
stp61474
a((dp61475
g2
(lp61476
VNot hugely loving it, but maybe some LINQ
p61477
as(dp61478
g18
V23354
p61479
stp61480
a((dp61481
g2
(lp61482
VA  is a  / value-type, and can be  (depending on your definition of ; but certainly it can box to )
p61483
aVAnd not all  are value-type ( being perhaps the most common )
p61484
aVThere is a requirement here that the key isn't null; so it does need to verify that
p61485
aVIn reality, boxing isn't as bad as people think; even boxed, it will be gen-0 collected
p61486
aVIt could special-case via generics (like  does - via a few different sub-classes), but that seems overkill
p61487
aVThe JIT may also be able to remove the null-check
p61488
aVI say may here, as although this is often cited, I have seen cases where the null-check was beyond the JIT's ability to remove
p61489
as(dp61490
g18
V23354
p61491
stp61492
a((dp61493
g2
(lp61494
VWell, "the one you can do effectively now" would be a good start, which for you sounds like C++; I'm pretty sure both have extensive support for talking to SQL Server
p61495
aVPersonally I'd use C#, but that is simply because I know the libraries and tools pretty well, and could whack out a SQL call in a few seconds
p61496
aVI might even go so far as to suggest that the
p61497
aVNET libraries have seen more love lately - so maybe managed C++/CLI might help
p61498
aVMaybe
p61499
aVIt also depends on whether you can assume the client has
p61500
aVNET, of course
p61501
aVRegardless, a simple db call should be fairly trivial - it is all those nasty corner cases that is the problem; for any platform/language, they can take experience to predict properly
p61502
aVFor example, in C# with a reference to :
p61503
as(dp61504
g18
V23354
p61505
stp61506
a((dp61507
g2
(lp61508
VIf you can't predict what the data is, then IMO you shouldn't be serializing that element
p61509
aVSince it appears you are using , perhaps add some :
p61510
aVAlso, events are the usual cause of confusion on this; I would annotate any events, too:
p61511
aVor if you are doing explicit event implementations, set  on whatever backing field is holding the  or
p61512
aV(well, strictly speaking I just wouldn't be using  in the first place - using a serialize that isn't so tied to the internal class structure can only be a good thing; but that is a rant for another day
p61513
as(dp61514
g18
V23354
p61515
stp61516
a((dp61517
g2
(lp61518
VBest on your related recent post, this relates to a , yes
p61519
aVIn this case, I wouldn't use  - I'd use a common base-class:
p61520
aV(and use a  instead of )
p61521
aVNote that this doesn't enforce the  - no compiler check can do that; but it does keep it to sane values - i
p61522
ag50
aVnot (ranadomly) a
p61523
aVAdditionally, multiple serializers will work happily with a base-class model, that won't work with random s - for example , , etc
p61524
aVNormally I prefer encapsulation over inheritance, but for serialization / DTO, a base-class is usually the simplest option
p61525
as(dp61526
g18
V23354
p61527
stp61528
a((dp61529
g2
(lp61530
VProbably the closest is:
p61531
aVsince this will handle multiple protocols etc
p61532
aVBut if you are meaning http - I'd use ; it is much simpler than  (one of the  implementations)
p61533
aVIf all you want is to download a page:
p61534
as(dp61535
g18
V23354
p61536
stp61537
a((dp61538
g2
(lp61539
VThe string-based version looks only in the root namespace (since no namespace is included) of the current assembly (since no assembly name is included), plus a few system assemblies
p61540
aVThe Type-based version already knows the type to use, so no search is necessary
p61541
aVIt could be in any namespace or assembly,  but the implication of typeof is that you could also have used "new"
p61542
aVThe Type approach makes more sense when you will have a Type supplied at runtime, but not usually that close to the object creation
p61543
as(dp61544
g18
V23354
p61545
stp61546
a((dp61547
g2
(lp61548
VExpand it first:
p61549
aVhttp://msdn
p61550
aVmicrosoft
p61551
aVcom/en-us/library/system
p61552
aVenvironment
p61553
aVexpandenvironmentvariables
p61554
aVaspx
p61555
as(dp61556
g18
V23354
p61557
stp61558
a((dp61559
g2
(lp61560
VYou might did that just putting the data into a dictionary is enough for JaveScripySerializer:
p61561
aV(and serialize dict)
p61562
aVIf not:
p61563
aVI don't have a PC handy for an example, but you should be able to:
p61564
aVwrite a wrapper class that encapsulated the list/array
p61565
aVuse the JavaScriptSerializer class
p61566
aVafter creating the serializer, associate the wrapper-type with a custom serializer
p61567
aVin the custom serializer, iterate over the data, adding a key to the dictionary per-item, i
p61568
ag50
aVdata
p61569
aVAdd("item"+i,list[i]);
p61570
aVYou associate custom maps via RegisterConverters: http://msdn
p61571
aVmicrosoft
p61572
aVcom/en-us/library/system
p61573
aVweb
p61574
aVscript
p61575
aVserialization
p61576
aVjavascriptserializer
p61577
aVregisterconverters
p61578
aVaspx
p61579
aVNote you don't need to write a deserialize unless you need that too
p61580
aVIf you get stuck, I'll try to ad an example later
p61581
as(dp61582
g18
V23354
p61583
stp61584
a((dp61585
g2
(lp61586
VNo, TransactionScope will not usually do a table lock; it may do row, page, key-range, table etc as the db sees fit
p61587
aVFor specific locking mechanisms I would expect to have to use vendor-specific mechanisms, such as different SQL hints
p61588
as(dp61589
g18
V23354
p61590
stp61591
a((dp61592
g2
(lp61593
VOne approach there is to make the property virtual, and at runtime create a subclass via reflection-emit that override the properties, adding your code
p61594
aVHowever, this is advanced, and requires you always make sure to create the subclass (so no "new" in code)
p61595
aVHowever; I wonder if simply implementing INotifyPropertyChanged and handling the event is simpler
p61596
aVThe other option is to just build the handling into the regular class in the first place
p61597
aVThere are some ways of making this less repetitive, especially if you have a common base-class where you could add a
p61598
aVWith
p61599
as(dp61600
g18
V23354
p61601
stp61602
a((dp61603
g2
(lp61604
VNo, I wouldn't use a view for that, an I wouldn't  copy any code
p61605
aVIt sounds like this is just a conditional filter on your queries
p61606
aVYou don't make it clear how you are doing the data-access, but this might mean aasdij an extra line of TSQL, adding adding a so parameter, adding an extra LINQ
p61607
aVWhere clause, etc
p61608
as(dp61609
g18
V23354
p61610
stp61611
a((dp61612
g2
(lp61613
VIn addition to the older code that doesn't know about generics, there are also a lot of cases where you know you have a list of data, but you can't know of what ahead of time
p61614
aVData-binding is a classic example here; a DataSource property usually checks for IList (and IListSource, typically) and then looks at the objects to see what properties are available
p61615
aVIt can't use generics in this case
p61616
aVIn fact, any time you are using reflection IList is more convenient than IList-of-T, since generics and reflection don't play nicely together
p61617
aVIt can be done, but it is a pain
p61618
aVUnfortunately since IList-of-T doesn't derive from IList there are cases where this can fail - but it is a good 95% rule
p61619
aVIn particular, IList lets you use the indexer, and add/remove items; things that IEnumerable don't let you do
p61620
aVMost app-level code (i
p61621
ag50
aVthe everyday code that ou write for your application) should probably focus on the generic versions; however there is also a lot of infrastructure code around that must use reflection
p61622
as(dp61623
g18
V23354
p61624
stp61625
a((dp61626
g2
(lp61627
VAre you sure there isn't an exception happening somewhere
p61628
aVTry handling the completion event, and check the exception exposed on the event-arg object
p61629
aVAlso; a loop with a single Invoke in each step is probably going to slow things down; maybe do the data-fetch on the backround, then do the entire clear/add-loop in a single Invoke
p61630
aVIf that is too much, at least batch it into small sets; or consider virtual mode (which is much more efficient for large data volumes)
p61631
as(dp61632
g18
V23354
p61633
stp61634
a((dp61635
g2
(lp61636
VAn annoyig quirk of the original implementation was that after you made your selection the current directory of your app changed to that folder, meaning that if you expected File operations to be relative to your app folder, it now failed
p61637
aVThis meant it was common practice to add code to capture the current folder before using he dialog, and restore it afterwards
p61638
aVThis was fixed, so it can do this for you, but changing the default behaviour might have broken code tha relied on the quirk
p61639
aVSo you need to enable it manually via this property
p61640
as(dp61641
g18
V23354
p61642
stp61643
a((dp61644
g2
(lp61645
VNo to both questions
p61646
aVYou could code something (like how app
p61647
aVconfig allows sections to be imported, or how xslt handles includes/imports), but this is not inbuilt onto any XML spec and would not match the existing schema
p61648
aVYou'd have to do everything yourself, basically
p61649
aVIf you really wanted to go this route, writing a custom XmlReader that recognised a specific element (in a specific xmlns) and silently merging at that point - would perhaps be the beat choice
p61650
as(dp61651
g18
V23354
p61652
stp61653
a((dp61654
g2
(lp61655
VIt is common for loop iterations to add more work; just pass the queue into the method as an argument and adding to it should work fine
p61656
aVThe problem is that ou should be using Dequeue:
p61657
as(dp61658
g18
V23354
p61659
stp61660
a((dp61661
g2
(lp61662
V(which will throw an exception if there isn't exactly one unique value, otherwise it will return that value)
p61663
aVIf you don't want exceptions:
p61664
as(dp61665
g18
V23354
p61666
stp61667
a((dp61668
g2
(lp61669
VEach item in a unit-of-work has overhead, as it must check (and update) the identity manager, add to various collections, etc
p61670
aVThe first thing I would try is batching into, say, groups of 500 (change that number to suit), starting with a fresh (new) object-context each time - as otherwise you can reasonably expect telescoping performance
p61671
aVBreaking it into batches also prevents a megalithic transaction bringing everything to a stop
p61672
aVBeyond that; SqlBulkCopy
p61673
aVIt is designed for large imports with minimal overhead
p61674
aVIt isn't EF though
p61675
as(dp61676
g18
V23354
p61677
stp61678
a((dp61679
g2
(lp61680
VSSD
p61681
aVNo question
p61682
aVWhack in plenty of RAM; depending in you needs, 8GB on x64 should be OK
p61683
aVCPU is nice, but unless you're doing lots of CPU-intensive work, IO is the pinch, not CPU
p61684
aVAnd a good GPU if you are doing graphics, especially if in an emu (the WP7 emu is particularly demanding)
p61685
as(dp61686
g18
V23354
p61687
stp61688
a((dp61689
g2
(lp61690
VSince it is an array (addressed separately):
p61691
as(dp61692
g18
V23354
p61693
stp61694
a((dp61695
g2
(lp61696
VIt won't disinguish the key-strokes, but you may be able to detect the RDP session via:
p61697
as(dp61698
g18
V23354
p61699
stp61700
a((dp61701
g2
(lp61702
VIs is an actuall http request, or is it spoofed inside the IIS process
p61703
aVI would recommend using HttpWebRequest (or simpler: WebClieny) so that your request is fully valid
p61704
aVYou can still set headers etc
p61705
aVAt the simplest level:
p61706
as(dp61707
g18
V23354
p61708
stp61709
a((dp61710
g2
(lp61711
VA SQL Server "timestamp" has nothing to do with time (in fact the name "timestamp" is now marked deprecated; "rowversion" is identical and should be used instead)
p61712
aVIf you truly have a "timestamp" this is not possible
p61713
aVIf you have a datetime set to the insertion time, it should be trivial:
p61714
aVAlso, if you are mainly doing date-range searches, log_time may be a fair candidate for the clustered index
p61715
aVOr if you are doing day-based queries a non-clustered index on an integer that is the days-into-epoch would work too
p61716
as(dp61717
g18
V23354
p61718
stp61719
a((dp61720
g2
(lp61721
VHow about an entire blog entry
p61722
aVhttp://marcgravell
p61723
aVblogspot
p61724
aVcom/2010/10/datatable-life-in-old-beast
p61725
aVhtml
p61726
aVNotes:
p61727
aVthis requires v2 (available in the trunk, but still a work-in-progress)
p61728
aVthis requires an additional utility dll (again, in the trunk)
p61729
aVAll the code to show how to get this working is in the project in the trunk
p61730
aVhttp://code
p61731
aVgoogle
p61732
aVcom/p/protobuf-net/source/browse/trunk/DataTableSerializer
p61733
as(dp61734
g18
V23354
p61735
stp61736
a((dp61737
g2
(lp61738
VIt isn't simple
p61739
aVAs variables in a method, they are pretty much the same as , so 4-byte; inside an array they are single-byte
p61740
aVAs a field
p61741
aVI'd need to check; I guess padding means they may be treated as 4-byte
p61742
aVA  with  should reveal
p61743
aVHere  shows 3, so they are single-byte as fields, but (see comments by codymanix) additional padding may be needed when other types get involved - for example:
p61744
aVis 8 bytes, due to the need of  to be aligned
p61745
aVFun fun fun
p61746
as(dp61747
g18
V23354
p61748
stp61749
a((dp61750
g2
(lp61751
VFrom painful memory, working with multiple forms in ASP
p61752
aVNET-webforms is a real pain
p61753
aVMaybe consider looking at ASP
p61754
aVNET-MVC which is much closer to the HTML; consequetly you can do anything you like re forms; just use a foreach in the view, writing a form for each item
p61755
as(dp61756
g18
V23354
p61757
stp61758
a((dp61759
g2
(lp61760
VHow about:
p61761
aV(untested, from memory)
p61762
as(dp61763
g18
V23354
p61764
stp61765
a((dp61766
g2
(lp61767
VLINQ is not SQL; the LINQ keywords are defined per-language, and do not include "connect" or "start"
p61768
aVIs "connect" synonymous with "join"
p61769
aVThat is a LINQ keyword; "start" looks closest to "Skip" (not a keyword, but an extension method)
p61770
aVYour specific LINQ implementation may (or may not) included methods for writing such queries
p61771
as(dp61772
g18
V23354
p61773
stp61774
a((dp61775
g2
(lp61776
VThe object you are adding must come from the same data-context, otherwise it will count as an implicit insert
p61777
aVI'm guessing this object has come from elsewhere; a previous data-context perhaps
p61778
aVThis is tricky if you are caching the object between queries
p61779
aVMaybe just set the id instead
p61780
aV:p
p61781
aVYou might have some joy detaching and attaching as necessary, but it probably isn't worth it
p61782
as(dp61783
g18
V23354
p61784
stp61785
a((dp61786
g2
(lp61787
VPerhaps something like:
p61788
as(dp61789
g18
V23354
p61790
stp61791
a((dp61792
g2
(lp61793
VIt is fine; the only subtle point is if you need to unsubscribe it; then you need to store the delegate locally too:
p61794
aVNote that if I'm not using either parameter (sender/args) I prefer the anon method syntax:
p61795
aVAs this doesn't introduce any extra (unnecessary) variables into scope
p61796
as(dp61797
g18
V23354
p61798
stp61799
a((dp61800
g2
(lp61801
VHuman readable
p61802
aVI'd go for JavaScriptSerializer; just:
p61803
as(dp61804
g18
V23354
p61805
stp61806
a((dp61807
g2
(lp61808
VThey are identical, unless you are in c# 1
p61809
aV2 where only the first compiles
p61810
as(dp61811
g18
V23354
p61812
stp61813
a((dp61814
g2
(lp61815
VTo do that, it should actually be an
p61816
aVThen it is a case of decomposing the expression
p61817
aVFortunately I have all the code for that over in protobuf-net, here - in particular , which returns the values in the  array (after walking any captured variables, etc)
p61818
aVAfter making  public (and removing everything above ), the code is just:
p61819
as(dp61820
g18
V23354
p61821
stp61822
a((dp61823
g2
(lp61824
VSerializers like  and  work against the public members, so they should (crosses fingers) work acceptably in terms of trust
p61825
aVYou could also try protobuf-net if you want binary - but I haven't aggressively tested this scenario (it works in things like Silverlight, though, which has a fairly picky trust model)
p61826
aVIf you want to stick with  but don't want it touching your fields directly you could implement , but doing it all manually is
p61827
aVpainful
p61828
as(dp61829
g18
V23354
p61830
stp61831
a((dp61832
g2
(lp61833
VHow is the data on the grid
p61834
aVIf it is data-bound to a collection, you can implement  and provide your own  method that accounts for  however you choose
p61835
aVYou also need to provide suitable implementations of ,  and
p61836
aVBut personally, I would just remove the s for now; so yes, a  is a reasonable alternative to  in a string column; trickier for some other cases
p61837
as(dp61838
g18
V23354
p61839
stp61840
a((dp61841
g2
(lp61842
VReflection is a very powerful tool; I fully expect that was very, very deliberate
p61843
aVI don't have a quote to support that, though; however - yes, a strong reflection API is also necessary for things like  and the "remoting" stack that was in from day-0 (but which is less popular now)
p61844
aVIn fact, a vast amount of library code uses reflection; data binding or serialization, for example
p61845
aVWithout reflection you would need to write lots of code manually in order to do some very simple things that the libraries handle automatically via reflection
p61846
aVAnother big use is meta-programming; writing code at runtime to augment the compiled code; useful in things like IoC / DI, etc
p61847
aVOr just when you need reflection but faster ;p
p61848
aVRe things like ; there are trust levels in
p61849
aVNET; not all code can access your internals, unless you run at full trust (admittedly, most code does run at full trust)
p61850
aVAnd beyond a certain level of paranoia it is a false aim anyway, as there are ways external to
p61851
aVNET of poking into a process
p61852
as(dp61853
g18
V23354
p61854
stp61855
a((dp61856
g2
(lp61857
VAFAIK, the only way to do this is to load it into a separate  and kill the entire
p61858
aVI imagine this means moving much of the code related to compiling it to the second , too
p61859
aVThen the question becomes how to talk cross-; there, implicit remoting is IMO the easiest option
p61860
as(dp61861
g18
V23354
p61862
stp61863
a((dp61864
g2
(lp61865
VThe trick is to keep hold of the last known index (i
p61866
ag50
aVthe last value you got for ) - perhaps in a form-level field, then you can use:
p61867
aV(where a  of -1 will cause it to start at the beginning)
p61868
as(dp61869
g18
V23354
p61870
stp61871
a((dp61872
g2
(lp61873
V(edit)
p61874
aVFrom the comments, it sounds like the question relates to the production versions from the home page, here
p61875
aVIn which case, it simply sounds like the _fixed is the directory I did the build from
p61876
aVYou could try including the pdb (from the zip) alongside the dll; that is the debugging symbols, and will probably help the trace tool you are using
p61877
aVBut more important is: what does the exception say
p61878
aVSome psychic debugging
p61879
aVis it simply that it sits there doing nothing
p61880
aVThat is the expected behaviour if the input stream is not yielding data, and hasn't formally closed itself - for example reading from an open socket that isn't sending data
p61881
aVWhere are you reading from in this scenario
p61882
as(dp61883
g18
V23354
p61884
stp61885
a((dp61886
g2
(lp61887
VPersonally I wouldn't be scared of a little boxing; unless you've profiled and proven that it is an issue, this is probably the least of your issues
p61888
aVBut how about an anon-type:
p61889
aVThe only problem is that outside of this method the only way to get these values back out is via reflection
p61890
aVWhich isn't necessarily a problem
p61891
aVBut in many ways the  is (while more overweight) much simpler
p61892
as(dp61893
g18
V23354
p61894
stp61895
a((dp61896
g2
(lp61897
VThe other answers deal with why, but an aside: in C# you can simulate return-type based overloading by using (abusing
p61898
aVimplicit conversion operators (and deferring the operation):
p61899
as(dp61900
g18
V23354
p61901
stp61902
a((dp61903
g2
(lp61904
VIMO part of the problem here is the schema; the system is always going to struggle if it hasn't got the start and end explicitly; not only will the query be hard to write, but it will have to do the computations per row
p61905
aVI would address at the table level, for example with a persisted calculated column:
p61906
aVNow you can just query:
p61907
aV(as an example) - which should map very cleanly in TSQL
p61908
aVBecause it is a calculated column, you can't ever have an inconsistent  value; and because it is marked as , it will not need to do the calculations per-row (unless you make a mess of the  options
p61909
aVYou can even index  columns, if you so choose
p61910
as(dp61911
g18
V23354
p61912
stp61913
a((dp61914
g2
(lp61915
VSince the concat is a pain in TSQL, I would query the 3 values "as is", and format from there:
p61916
aVfor example, if I wanted the names by tag-id, I could do:
p61917
aV(or whatever else you choose)
p61918
as(dp61919
g18
V23354
p61920
stp61921
a((dp61922
g2
(lp61923
VIt isn't clear what the issue/question is, but you could try making sure you pass in the parent-form, i
p61924
ag50
as(dp61925
g18
V23354
p61926
stp61927
a((dp61928
g2
(lp61929
VFor the purpose you cite, just pass  - that should be fine, and covers any number of dimensions
p61930
aVFor a vector (a 1-dimensional, 0-based array), you can use generics () - but that seems pointless when for a vector  is more convenient
p61931
aVBut for an unknown number of dimensions (or for a non-vector single-dimensional array), you are limited to
p61932
as(dp61933
g18
V23354
p61934
stp61935
a((dp61936
g2
(lp61937
VSince we don't know what  is, it isn't clear what  returns, but if this is actually returning a  (but typed as ) it sounds like you just want:
p61938
aVbut then, I also expect  to return an
p61939
aVAlso; minor point: the line  is both unnecessary and potentially a cause of a  bug (but not in this case) - you should be able to just use:
p61940
aV(and remove the  variable completely)
p61941
as(dp61942
g18
V23354
p61943
stp61944
a((dp61945
g2
(lp61946
VMSDN says:
p61947
aVThe Translate method enables you to
p61948
aVexecute a standard ADO
p61949
aVNET query
p61950
aVagainst a data source and translate
p61951
aVthe returned data rows into entity
p61952
aVobjects
p61953
aVThe supplied DbDataReader must contain
p61954
aVdata that maps to the requested entity
p61955
aVtype
p61956
aVIt isn't explicit whether it maps by name or via the map, but since  this ADO
p61957
aVNET query isn't an entity query (and therefore isn't strictly tied to the abstraction layers), it seems reasonable that it might ignore it and opt for property-name matches
p61958
aVI wonder if you should be writing an ESQL store query, rather than a TSQL database query
p61959
aVI would hope that an ESQL query is mapped via the model
p61960
aVThis should be fairly simple; it could be just
p61961
as(dp61962
g18
V23354
p61963
stp61964
a((dp61965
g2
(lp61966
VI made some changes:
p61967
aVto , change  to :
p61968
aVand to , use the  generic type:
p61969
aVand changed the main search:
p61970
aVand it compiles; obviously I can't test it since I had to invent a lot of code
p61971
as(dp61972
g18
V23354
p61973
stp61974
a((dp61975
g2
(lp61976
VWhat type is the operator defined in
p61977
aVThat operator can only be defined in the  class (since , the other option, is outside your control)
p61978
as(dp61979
g18
V23354
p61980
stp61981
a((dp61982
g2
(lp61983
VI think in this case you should simply create a separate  class (that doesn't inherit from ) for the purposes of serialization, and map between them
p61984
aVAutoMapper may help remove some mapping code, but it shouldn't be tricky either way
p61985
as(dp61986
g18
V23354
p61987
stp61988
a((dp61989
g2
(lp61990
VThe performance varies; a  can have less overhead than a , especially if the  decides it needs to get entangled with DTC
p61991
aVBut I wouldn't expect a vast difference between  and a , except for the extra round trip
p61992
aVHowever,  is still fast, and is the most convenient option for encapsulating multiple operations in a transaction, as the ambient transaction does not need to be manually associated with the command each time
p61993
aVPerhaps a better (and more significant) factor is the isolation-level
p61994
aVdefaults to the highest (serializable)
p61995
aVLower isolation levels allow morefor less blocking (but at the risk of non-repeatable reads, etc)
p61996
aVIIRC a TSQL transaction defaults to one of the lower levels
p61997
aVBut the isolation level can be tweaked for all 3 options
p61998
as(dp61999
g18
V23354
p62000
stp62001
a((dp62002
g2
(lp62003
VThe FastCsvReader on code-project does this very nicely; IIRC it should just be:
p62004
aV(but that is from memory)
p62005
as(dp62006
g18
V23354
p62007
stp62008
a((dp62009
g2
(lp62010
VPerhaps like this: Hows to quick check if data transfer two objects have equal properties in C#
p62011
as(dp62012
g18
V23354
p62013
stp62014
a((dp62015
g2
(lp62016
VIn Initialize you are declaring it as a method variable
p62017
aVThis only exists inside the method, and takes precedence over the field (aka this
p62018
aV_secretNumber)
p62019
aVRather than
p62020
aVJust use
p62021
as(dp62022
g18
V23354
p62023
stp62024
a((dp62025
g2
(lp62026
VWith the code as presented, the only way I can think of causing that is if the backig field (in ) was declared ""
p62027
aVIf so, remove the ""
p62028
aVOtherwise; does the actual code do a "" for the two objects
p62029
aVOr does it overwrite an object after adding it to the array
p62030
aV(which means you have the same object twice in the array)
p62031
aVI would expect  to be false in a sane world - can you test this and let us know
p62032
aVFinal thought; is there a "" in the real code
p62033
aVIt could be the infamous captured variable problem
p62034
as(dp62035
g18
V23354
p62036
stp62037
a((dp62038
g2
(lp62039
VTwo options;
p62040
aV1: find month start and compare:
p62041
aV2: compare the month and year
p62042
aVeither would be suitable for an extension method on
p62043
as(dp62044
g18
V23354
p62045
stp62046
a((dp62047
g2
(lp62048
Vit sounds like you just need a reference to
p62049
aVRe whether this is a bug in VS; well, I suppose the templates could add that reference - I can reproduce it, so it may be worth logging on connect
p62050
as(dp62051
g18
V23354
p62052
stp62053
a((dp62054
g2
(lp62055
VThey are caught in the order as-written, so put the most specific (in terms of inheritance between exception types) first
p62056
aVSince it is the type that matters (and the inheritance hierarchy); if the two don't have an inheritance relationship (i
p62057
ag50
aVit is not the case that  inherits from  directly or indirectly), then it won't matter
p62058
aVDesign Guidelines for Exceptions" at http://msdn
p62059
aVmicrosoft
p62060
aVcom/en-us/library/ms229014
p62061
aVaspx
p62062
aVHandling and Throwing Exceptions" at http://msdn
p62063
aVmicrosoft
p62064
aVcom/en-us/library/5b2yeyab
p62065
aVaspx
p62066
as(dp62067
g18
V23354
p62068
stp62069
a((dp62070
g2
(lp62071
Vor in C# 2
p62072
aV0 (where the generic type inference is weaker):
p62073
as(dp62074
g18
V23354
p62075
stp62076
a((dp62077
g2
(lp62078
VThis has nothing to do with inheritance; it looks like you are catching and logging exceptions:
p62079
aVI would start by looking there; most likely something is throwing, and telling you why
p62080
aVIf I had to guess, it looks like maybe you are missing:
p62081
aVThe fact that anything is returned tells me it is just an exception
p62082
aVPersonally I would have just let an unanticipated exception bubble to the UI, and let the UI react by logging it and showing the appropriate #fail page
p62083
aVAlso, when possible, cast the plugin to the interface:
p62084
as(dp62085
g18
V23354
p62086
stp62087
a((dp62088
g2
(lp62089
VDbLinq is probably the closest to LINQ-to-SQL, and has some support inside MonoDevelop; however, I expect it mainly means editing dbml (xml) files
p62090
as(dp62091
g18
V23354
p62092
stp62093
a((dp62094
g2
(lp62095
VI would simply always quote it; since "test" is valid too
p62096
aVI don't know if there is inbuilt file escaping anywhere, but
p62097
aVshould do
p62098
aVIf you wanted you could get fancy with checking the input string ( above), but it probably isn't worth checking the edge-cases
p62099
aVFor the same reason that if I'm writing TSQL over an unknown table, I'd always add explicit  /  (without bothering to check if it needs it)
p62100
as(dp62101
g18
V23354
p62102
stp62103
a((dp62104
g2
(lp62105
VThere's a bug; you are ignoring the user's args, and you should probably guard for -ve :
p62106
aVshould probably be:
p62107
aV(otherwise you are writing into the wrong part of the buffer)
p62108
aVBut generally looks good
p62109
as(dp62110
g18
V23354
p62111
stp62112
a((dp62113
g2
(lp62114
VOK, this is pure evil:
p62115
as(dp62116
g18
V23354
p62117
stp62118
a((dp62119
g2
(lp62120
VThe only difference seems to be the use of a separate class
p62121
aVSo no: as long as the methods and types are accessible there is very little functional difference
p62122
aVAs a side note, you may want to consider  for a delegate that takes a  and returns , but also note that events should generally follow the  pattern (where , perhaps also using )
p62123
as(dp62124
g18
V23354
p62125
stp62126
a((dp62127
g2
(lp62128
VVia
p62129
aVNET it is neither - that is just the SSMS display
p62130
aVBased on the previous questions, it sounds like you are just having difficulties reading this column into strings;
p62131
aVPerhaps just something like:
p62132
aV(tested locally; works fine)
p62133
aVIf you want something delimited, then perhaps:
p62134
aVOr something involving a  (newlines in this example):
p62135
as(dp62136
g18
V23354
p62137
stp62138
a((dp62139
g2
(lp62140
V is a local  - the only way to update that would be to query it again
p62141
aVTry replacing  with:
p62142
aV(actually,  is probably cheaper)
p62143
aVHowever
p62144
aVYou don't want to do this in a tight loop; maybe add a , or (better) use
p62145
aVEven better still; check for a specific file so you don't hit  aggressively
p62146
as(dp62147
g18
V23354
p62148
stp62149
a((dp62150
g2
(lp62151
VHow about:
p62152
aVThe regex is a word char, followed by the same (back-ref) at least twice; the lamba takes the length of the match () and appends the first character ()
p62153
as(dp62154
g18
V23354
p62155
stp62156
a((dp62157
g2
(lp62158
V runs the constructor / field-initialisers; the code as-written should be fine
p62159
aVAre you perhaps usig  (i
p62160
ag50
aVWCF) instead
p62161
aV(DCS doesn't run constructors)
p62162
aVA handy hack for WCF is:
p62163
as(dp62164
g18
V23354
p62165
stp62166
a((dp62167
g2
(lp62168
VYou my be able to override the properties you don't want and add
p62169
aVOther options:
p62170
aVset the  (http://msdn
p62171
aVmicrosoft
p62172
aVcom/en-us/library/system
p62173
aVwindows
p62174
aVforms
p62175
aVpropertygrid
p62176
aVbrowsableattributes
p62177
aVaspx) and decorate the members you do want with your own attribute
p62178
aVwrite a  and override ; associate this converter with your type (or Te same via ICustomTypeConverter or TypeDescriptionProvider)
p62179
aVThe BrowsableAttributes would be my first stab
p62180
as(dp62181
g18
V23354
p62182
stp62183
a((dp62184
g2
(lp62185
Vproto enums are named integers, but note that the last few names will barf
p62186
aVYou would need to tweak the names in your
p62187
aVproto / DTO layer, but it would a pain to have to disambiguate between  and ,  and
p62188
aVBut you could map something similar in
p62189
aVproto, sure
p62190
aVIf you store a string that would work, but will be more bytes
p62191
aVNot many more (1 byte for the string length plus 1-4 bytes for the char-data, versus 1 byte for the enums)
p62192
as(dp62193
g18
V23354
p62194
stp62195
a((dp62196
g2
(lp62197
VIMO [Serializable] is confusing, largely because it is not actually required by most serialization
p62198
aVBy that I mean: there is more code using XmlSerializer (includes asmx), DataContractSerializer (includes WCF), JavaScriptSerializer (includes MVC's JsonResult), or things like protobuf-net etc
p62199
aV[Serializable] is mainly BinaryFormatter, which is (from what I see) in definite decline
p62200
aVand with many good reasons
p62201
aVAs for why: other answers address this, but it doesn't always make sense to serialize something
p62202
aVSure entity objects can act as DTO, but that is hard to detect in a robust way
p62203
aVSo IMO there is negligible impact on whether I is [Serializable] or not, but I do agree with the default: you should know that you are planning to serialize something
p62204
aVIn some cases this serialization means extra work (particularly as some serializers don't run the ctor/init code, so you need to know to prepare fields appropriately)
p62205
as(dp62206
g18
V23354
p62207
stp62208
a((dp62209
g2
(lp62210
VYes, that is a limitation; there is no language construct for that
p62211
aVMy recommendation in this case would be to create a typed delegate to the constructor per-type; cache that delegate (usually in a static field of a generic type, for convenience) and re-use it
p62212
aVI can provide an example later - but I can't do it from iPod ;)
p62213
aVI believe I committed some code for this into Jon Skeet's MiscUtil library; so you could look there too
p62214
aVAs requested (comments), here is a way of doing this - in this case using the  API
p62215
aVNote in particular the use of the nested generic classes that ensure we do the reflection / compilation at most once per type-combination:
p62216
as(dp62217
g18
V23354
p62218
stp62219
a((dp62220
g2
(lp62221
VEdit: the problem in the example code is that it is a field initialiser
p62222
aVMove this code to an explicit constructor:
p62223
aVAny method can act as a ThreadStart as log ad it takes no args and returns void
p62224
aVIMO the easiest option is a lambda or anon method as this allows closures:
p62225
aVBut for an instance method that returns void and takes no args:
p62226
aVThen
p62227
as(dp62228
g18
V23354
p62229
stp62230
a((dp62231
g2
(lp62232
VFor simple schema you can just call dataContext
p62233
aVCreateDatabase() - however it would be ambitious to hope for this to handle everything
p62234
aVI suspect you may have to accept the loss and (sadly) learn about the value of backups
p62235
aVSee MSDN for more on CreateDatabase:
p62236
aVhttp://msdn
p62237
aVmicrosoft
p62238
aVcom/en-us/library/system
p62239
aVdata
p62240
aVlinq
p62241
aVdatacontext
p62242
aVcreatedatabase
p62243
aVaspx
p62244
as(dp62245
g18
V23354
p62246
stp62247
a((dp62248
g2
(lp62249
VA  doesn't have a string indexer; you could add one to the  class, but the usage will be:
p62250
aV(no
p62251
aVChildren)
p62252
aVFor the indexer itself: Try (in the indexer):
p62253
aVTo get an indexer on the list itself, you would have to create a custom list type and add the indexer there
p62254
aVIMO, a method may be clearer (on Father):
p62255
as(dp62256
g18
V23354
p62257
stp62258
a((dp62259
g2
(lp62260
VIf you don't capture the variables into a lambda / anon method it won't make any difference
p62261
aVInside is arguably cleaner
p62262
aVAs a side note; even if you declare them outside; you don't need to initialize it there; the following is valid:
p62263
aVI would still declare inside though :)
p62264
as(dp62265
g18
V23354
p62266
stp62267
a((dp62268
g2
(lp62269
VThere is nothing inherently slow about
p62270
aVNET web requests; that code should be fine
p62271
aVI regularly use  and it works very quickly
p62272
aVHow big is the payload in each direction
p62273
aVSilly question maybe, but is it simply bandwidth limitations
p62274
aVIMO the most likely thing is that your web-site has spun down, and when you hit the URL the web-site is slow to respond
p62275
aVThis is then not the fault of the client
p62276
aVIt is also possible that DNS is slow for some reason (in which case you could hard-code the IP into your "hosts" file), or that some proxy server in the middle is slow
p62277
aVIf the web-site isn't yours, it is also possible that they are detecting atypical usage and deliberately injecting a delay to annoy scrapers
p62278
aVI would grab Fiddler (a free, simple web inspector) and look at the timings
p62279
as(dp62280
g18
V23354
p62281
stp62282
a((dp62283
g2
(lp62284
VSince we can't know what the implementation is, the only safe answer is "yes"
p62285
aVHowever, it is very rare to use  directly -  being more common
p62286
aVFor the generic  you can use a using statement:
p62287
aVEven without the generic version, you can cheat:
p62288
aVWhich will dispose iter if it is IDisposable
p62289
as(dp62290
g18
V23354
p62291
stp62292
a((dp62293
g2
(lp62294
VYour end tags should omit the attribute - it is just
p62295
aVAlso; building XML via concatenation is prone to escaping bugs; I would use LINQ-to-XMl here:
p62296
as(dp62297
g18
V23354
p62298
stp62299
a((dp62300
g2
(lp62301
VI'd be pretty comfortable with that
p62302
aVThe only change I'd make would be to enforce it as once-only:
p62303
aVoh -I guess  should also be immutable to avoid people changing the config unexpectedly
p62304
as(dp62305
g18
V23354
p62306
stp62307
a((dp62308
g2
(lp62309
VIf you mean the difference between:
p62310
aVand
p62311
aVthen there are merits of both
p62312
aVThe latter is much more convenient when using reflecting to load the types (maybe your  types come from plugins
p62313
aV- generics and reflection don't mix very conveniently
p62314
aVThe generic version is handy when everything is known at compile-time; you can add additional validation via constraints etc, which are enforced by the compiler
p62315
aVIt can also be handy if you specifically want to use the , for example to use generic comparisons via  or  (emphasis: these are just examples) - which accesses many common patterns, while avoiding things like boxing where appropriate
p62316
aVIn your case, since the , boxing isn't an issue (I'm assuming  is a class, not an interface)
p62317
aVYou could go either way; a  will work almost as well as the slightly more specific  (where ), so it is unlikely to cause problems
p62318
aVIf reflection is involved at all, I'd use the second form, perhaps offering both:
p62319
aVMost generic features can be emulated - for example  in place of  - or a cast to a known interface in place of
p62320
aVYou don't get the use of the "constrained" opcode, but in your case that doesn't apply anyway
p62321
as(dp62322
g18
V23354
p62323
stp62324
a((dp62325
g2
(lp62326
VThis has nothing to do with the strict array; simply, the library method you are using is returning
p62327
aVThere are various possibilities here:
p62328
aVmaybe returning  is an expected return value for some scenarios; check the documentation
p62329
aVmaybe you need some additional configuration, or maybe you need to call some additional method ( would be too hopeful ;p), or wait for some other event before this data is available - check the documentation
p62330
aVmaybe it is simply a library bug; contact the vendor
p62331
aVIf all 3 routes fail, personally I'd just open it reflector and look for a scenario that might return
p62332
aVThen tell the vendor to fix the bug or clarify the documentation as appropriate
p62333
as(dp62334
g18
V23354
p62335
stp62336
a((dp62337
g2
(lp62338
VThat is fine, and as long as you ensure you don't eat all the memory should be fine
p62339
aVI've done this for complex systems with larger numbers
p62340
aVIf your data is regularly accessed by something other than the index in the list, you might want to use a dictionary to index the item, for example:
p62341
aVThen you can access with:
p62342
aVAlso; if many of the string values ate repeated you can save some apace by writing your own interner;
p62343
aVWhich will reduce memory use by only keeping and re-using unique strings
p62344
as(dp62345
g18
V23354
p62346
stp62347
a((dp62348
g2
(lp62349
VIf the calling process has exited it can no longer do anything; it doesn't exist
p62350
aVOne option would be to create another thread that is not a background thread (set  to false)  and call WaitForExit on that thread; that will keep the process alive during normal exit from Main
p62351
aVHowever, this cannot do anything if the process terminates abnormally (task manager kill, or simply pulling out the power)
p62352
as(dp62353
g18
V23354
p62354
stp62355
a((dp62356
g2
(lp62357
VThe UI cannot pump windows messages (so will appear unresponsive) if the UI thread is blocked
p62358
aVInstead, look at , which allows to to easily push longer-running tasks onto a worker thread (but still push updates to the UI)
p62359
as(dp62360
g18
V23354
p62361
stp62362
a((dp62363
g2
(lp62364
VFor classes (at least, those that are mutable) this should be as simple as:
p62365
aVFor structs (which should be immutable; or also for immutable classes), you will need to fetch, re-create, and overwrite:
p62366
aV(obviously the re-create line needs tweaking to your particular objects)
p62367
aVIn the evil evil world of mutable structs (see comments), you can mutate once it is in a variable:
p62368
as(dp62369
g18
V23354
p62370
stp62371
a((dp62372
g2
(lp62373
VYou have 3 options:
p62374
aVprocess the items after fetching them - i
p62375
ag50
aVcreate an unrelated type (outside of the model) to project into; even an anon type:
p62376
aVpretty much the same as the above, but breaking composition (via , which means we revert back to LINQ-to-Objects for whatever follows) and creating a changed version outside of the data-context
p62377
aVEdit re comments; another option is an iterator block; iterator blocks are streaming devices; the compiler weaves a lot of magic to ensure that your code only processes one item ("yield return") at a time - it doesnt read all the data before returning anything:
p62378
aVNow pass the sequence of products through that method
p62379
as(dp62380
g18
V23354
p62381
stp62382
a((dp62383
g2
(lp62384
VI rarely do anything special for classes; for most regular objects referential equality works fine
p62385
aVI even more rarely write a ; but since structs represent values it is usually appropriate to provide equality etc
p62386
aVThis would usually involve everything; Equals, ==,
p62387
aV= and  (since this avoids boxing in scenarios using
p62388
aVThe boilerplate isn't usually too problematic, but IIRC tools like resharper can help here
p62389
aVYes, it is advisable to keep Equals and == in sync, and this needs to be done explicitely
p62390
as(dp62391
g18
V23354
p62392
stp62393
a((dp62394
g2
(lp62395
VTransaction scopes that are nested (and on the same thread) become part of the same transaction (the outer transaction being the defining scope for completion) - escalating to DTC if needed
p62396
aVIn your case the transactions don't seem nested, so they are unrelated
p62397
aVThat should also mean that the LTM rather than DTC is the owner, which has less overhead
p62398
aVAs a result, of course, you may need to watch for blocking etc between these if they touch the same data
p62399
aVEspecially since transaction scope defaults to serializable isolation
p62400
as(dp62401
g18
V23354
p62402
stp62403
a((dp62404
g2
(lp62405
VI wouldn't add 1 & 2 unless I had some specific reason; for example to alter (wrap) the message; there is no need since exceptions will raise upwards anyway
p62406
aVAnd done incorrectly you can accidentally remove the all-important stack-trace ( vs  - the first being preferred)
p62407
as(dp62408
g18
V23354
p62409
stp62410
a((dp62411
g2
(lp62412
VIt is often necessary to give it a hint about the specific pattern that you expect:
p62413
aVEdit: the double-space is a pain, as  doesn't handle that;
p62414
as(dp62415
g18
V23354
p62416
stp62417
a((dp62418
g2
(lp62419
VTo get the name/value pairs:
p62420
aVThen just iterate and add to whatever table you indend:
p62421
as(dp62422
g18
V23354
p62423
stp62424
a((dp62425
g2
(lp62426
VHow about:
p62427
as(dp62428
g18
V23354
p62429
stp62430
a((dp62431
g2
(lp62432
VIt calls another constructor on the same type, passing in the  that was passed to this constructor, and a new  object
p62433
aVI assume there is also something like:
p62434
aVThis approach is useful by allowing you to have multiple constructors, but only put the code in the most complex one
p62435
aVAll the other constructors just pass the arguments (or defaults, as necessary) to the chosen constructor
p62436
aVThe chained constructor gets invoked before the body of the constructor that has the
p62437
as(dp62438
g18
V23354
p62439
stp62440
a((dp62441
g2
(lp62442
VThis an expected behaviour when comparing different references, where that type doesn't override  or implement
p62443
aVYou could write a custom comparer (perhaps simply comparing the ) and pass that into the dictionary - but IMO an  is not a good choice of key
p62444
aVThe following is not necessarily a robust usage via ToString() ; use at own discretion:
p62445
as(dp62446
g18
V23354
p62447
stp62448
a((dp62449
g2
(lp62450
VYou are leaving it to infer a type based on a string and a numeric
p62451
aVGive it a hint:
p62452
aVThen it has the choices of varchar and varchar, so it knows this is varchar from the outset, and can't make any mistakes
p62453
as(dp62454
g18
V23354
p62455
stp62456
a((dp62457
g2
(lp62458
Vor in LINQ syntax:
p62459
as(dp62460
g18
V23354
p62461
stp62462
a((dp62463
g2
(lp62464
VSomething like:
p62465
aVThen:
p62466
as(dp62467
g18
V23354
p62468
stp62469
a((dp62470
g2
(lp62471
VA Guid is just a set of bytes; it isn't a string
p62472
aVThe same as an integer 123 isn't the string "123"
p62473
aVThere are various ways of displaying it as a human readable string
p62474
aVYou can use the format specifier with  to choose a format: http://msdn
p62475
aVmicrosoft
p62476
aVcom/en-us/library/97af8hh4
p62477
aVaspx
p62478
aVSimply: they chose to use different formats
p62479
aVThe Guid is the same
p62480
as(dp62481
g18
V23354
p62482
stp62483
a((dp62484
g2
(lp62485
VIn pure TSQL the only similar thing I can think is a scalar UDF that returns the vale wanted
p62486
aVIn LINQ to SQL you can map members as c#/
p62487
aVNET enums, and it handles it for you
p62488
aVBut to be honest; in most pure TSQL I'd mainly just use the literals
p62489
as(dp62490
g18
V23354
p62491
stp62492
a((dp62493
g2
(lp62494
VBecause it isn't C and thus isn't tied to it's conventions
p62495
aVNeeding the exe name is pretty much an edge case; the small number of times I've needed this (compared to the other args) IMO justifies the decision to omit it
p62496
aVThis is additionally demanded in the spec (ECMA334v4, 10
p62497
aV1); (snipping to relevant parts):
p62498
aV10
p62499
aVBasic concepts
p62500
aV10
p62501
aV1 Application startup
p62502
aVThis entry point method is always named , and shall have one of the
p62503
aVfollowing signatures:
p62504
aV\u2022 Let  be the name of the parameter
p62505
aVIf the length of the array designated by  is greater than
p62506
aVzero, the array members  through , inclusive, shall refer to strings,
p62507
aVcalled application parameters, which are given implementation-defined values by the host environment
p62508
aVprior to application startup
p62509
aVThe intent is to supply to the application information determined prior to
p62510
aVapplication startup from elsewhere in the hosted environment
p62511
aVIf the host environment is not capable of
p62512
aVsupplying strings with letters in both uppercase and lowercase, the implementation shall ensure that the
p62513
aVstrings are received in lowercase
p62514
aV[Note: On systems supporting a command line, application, application parameters
p62515
aVcorrespond to what are generally known as command-line arguments
p62516
aVend note]
p62517
as(dp62518
g18
V23354
p62519
stp62520
a((dp62521
g2
(lp62522
VYou can concatenate without the loop via something like below; just add in your own query / joins etc as necessary:
p62523
aV(you must make sure there are no s in there)
p62524
aVbut do not do this
p62525
aVThe database is not the place to build html; not least, it opens you up hugely to XSRF vulnerabilities
p62526
aVI would do this in the UI layer, making appropriate use of the html-encoding functions provided by whichever platform you are using
p62527
aVBlindly concatenating strings as html is pretty much on a par with blindly concatenating user strings into TSQL (instead of using parameters); at best the formatting will be borked (no correct handling of , etc) - at worst you place your users at direct risk of attack
p62528
as(dp62529
g18
V23354
p62530
stp62531
a((dp62532
g2
(lp62533
V is less restrictive; it is protected or internal (not and) - which therefore additionally allows subclasses from other assemblies to access it
p62534
aVYou would need to invert:
p62535
aVThis will allow code in your assembly, plus subclasses from other assemblies, get it (read) - but only code in your assembly can set it (write)
p62536
as(dp62537
g18
V23354
p62538
stp62539
a((dp62540
g2
(lp62541
VThe  handling should (IIRC) be OK if you simply set
p62542
aVHowever, if you really want to avoid the shell exec,  is an input - you should be writing the file to
p62543
aVI'l probably leave  alone (set  if you don't actively want the output)
p62544
aVUntested, but maybe:
p62545
aV(which should pipe in the file line by line)
p62546
as(dp62547
g18
V23354
p62548
stp62549
a((dp62550
g2
(lp62551
VTrying to do this with column-per-column is IMO a mistake; just do it in two columns and pick out the column at the caller:
p62552
aVwhich is more-or-less identical to:
p62553
aVThis is then one round-trip, etc
p62554
aVI'd probably use an integer (maybe even ) for the first column (with the client expected to know that 1 maps to WORKSTATION etc) rather than a varchar, but the above is given for flavor only
p62555
aVEdit re comments; the following takes into account:
p62556
aVincluding different data types in the union (converting to a common type)
p62557
aVusing ordinal sorts on the original data, so integers are still sorted 1,2,10 (integer sort), not 1,10,2 (string-sort)
p62558
aVTSQL:
p62559
as(dp62560
g18
V23354
p62561
stp62562
a((dp62563
g2
(lp62564
s(dp62565
g18
V23354
p62566
stp62567
a((dp62568
g2
(lp62569
VAn  should map nicely to  (or )
p62570
aVHowever, personally I'd just use shifts ( etc) and keep it as an
p62571
aVThe  would be much bigger
p62572
as(dp62573
g18
V23354
p62574
stp62575
a((dp62576
g2
(lp62577
VFor xml, I would go with the id approach (changing the DTO model such that it isn't cyclic)
p62578
aVNote that  can support cyclic object graphs automatically by passing in  for the  option in the overloaded constructors; it won't be quite as simple as  output, but it will still be readable
p62579
as(dp62580
g18
V23354
p62581
stp62582
a((dp62583
g2
(lp62584
VNormally the way to do that is to include a non-generic API in there (perhaps with explicit implementation)
p62585
aVThen you just cast to the non-generic interface
p62586
aVNot quite the same, but a bit like:
p62587
as(dp62588
g18
V23354
p62589
stp62590
a((dp62591
g2
(lp62592
VAh
p62593
aVYes
p62594
aVYou're using VS2008, right
p62595
aVThis is a known bug, and it actually matters where your  directives are in your half of the  class
p62596
aVis bad, and trashes the designer file
p62597
aVis fine
p62598
aVThis only applies when you have  and , so another fix is to rename the file
p62599
aVThis is fixed in VS2010
p62600
aVCrazy, huh
p62601
as(dp62602
g18
V23354
p62603
stp62604
a((dp62605
g2
(lp62606
VSomething like:
p62607
aVor for just a single (the first) match on the line:
p62608
aVTo get the full ; the same code, but with , looking at
p62609
as(dp62610
g18
V23354
p62611
stp62612
a((dp62613
g2
(lp62614
Vas long as you are strict about disposing your connections, the default (for sql-server at least) is that it will just work automatically
p62615
aVIn your example you could well only have 3 underlying connections (one per connection string)
p62616
aVBut always ensure your connections are disposed, ideally with :
p62617
aVthen it is released back to the pool (for re-use when the same connection-string is seen next) even when an exception is thrown
p62618
aVTo disable pooling (if you choose), include  in the connection-string
p62619
as(dp62620
g18
V23354
p62621
stp62622
a((dp62623
g2
(lp62624
VAnyone can sniff the traffic, and spoof pretty much every aspect of it
p62625
aVSo you can't block that, although encrypting the traffic will help somewhat
p62626
aVWhat you might do is restrict access to registered users, but that may not play well if your app allows unregistered usage
p62627
as(dp62628
g18
V23354
p62629
stp62630
a((dp62631
g2
(lp62632
Vor to why it didn't work; you aren't accessing the value of the attribute; this works too:
p62633
aVor
p62634
as(dp62635
g18
V23354
p62636
stp62637
a((dp62638
g2
(lp62639
VIt has to be an exact match between the interface's method and the concrete method that implements the interface's method
p62640
aVOne option is explicit interface implementation, which allows you to satisfy the interface while keeping your more-specific public API on the type
p62641
aVAnd usually just proxy the methods, so there is no code duplication:
p62642
as(dp62643
g18
V23354
p62644
stp62645
a((dp62646
g2
(lp62647
VIf it returns MvcHtmlString it won't matter; the  will know it is pre-escaped
p62648
aVI would therefore use  as then the reviewer doesn't need to think "is this escaped
p62649
aVor is this a raw field
p62650
aVOf course, that does depend on the code that creates the MvcHtmlString being sane
p62651
as(dp62652
g18
V23354
p62653
stp62654
a((dp62655
g2
(lp62656
VYour best bet may be to re-write it as a regex an use
p62657
aVOr if it is just starts-with queries:
p62658
as(dp62659
g18
V23354
p62660
stp62661
a((dp62662
g2
(lp62663
VI profiled it via , with the result:
p62664
aVLooking at this, I imagine the problem is that the param is  rather than  - so taking the hash (a binary operation) is different
p62665
aVIf you hashed it as , you should probably cast the string to  before the
p62666
aVThe following works, for example:
p62667
aVA simpler illustration of this is:
p62668
as(dp62669
g18
V23354
p62670
stp62671
a((dp62672
g2
(lp62673
VNo, basically
p62674
aVUnless you expose a regular property that provides them, or implement
p62675
aVThe intent of serialization is to serialize an individual object's properties; attributes are metadata annotations, that are not really associated with any specific instance
p62676
aVAs such, they don't naturally fit into object serialization, except perhaps (as metadata) to guide it (for example , , etc)
p62677
as(dp62678
g18
V23354
p62679
stp62680
a((dp62681
g2
(lp62682
VIf you are looking for the server to seem to push, you may want to look at long-polling technologies such as "Comet"
p62683
aVBut in my recent experience with chat
p62684
aVstackoverflow
p62685
aVcom / chat
p62686
aVstackexchange
p62687
aVcom - client polling can work reasonably well too, as long as you keep things sane
p62688
as(dp62689
g18
V23354
p62690
stp62691
a((dp62692
g2
(lp62693
VIf you don't explicitly include an order-by clause, you only really have a set - any ordering is purely convenience and will usually happen to be on the clustered index - but IIRC this is not guaranteed (and I imagine things like the server choosing to use parallelism would throw this out)
p62694
aVInclude an order-by; either at the DB, or at the client
p62695
aVAlternatively, throw the results into a dictionary:
p62696
aVthen you can pull out the one you need at will, ignoring order
p62697
as(dp62698
g18
V23354
p62699
stp62700
a((dp62701
g2
(lp62702
V won't believe you that an element is xml unless you convince it, for example by exposing that property as an
p62703
aVOtherwise, it (correctly, IMO) always encodes such values
p62704
aVFor example:
p62705
as(dp62706
g18
V23354
p62707
stp62708
a((dp62709
g2
(lp62710
VSo you have an arbitrary block of XML
p62711
aVThen yes, XmlDocument should make that available
p62712
aVThe problem with just using a string is that it would get further encoded by WCF
p62713
aVIf the layout of the XML is known, another option is deserializing it into an object model and returning that, which might make it easier to consume at the client
p62714
aVBut XmlDocument should work
p62715
aVXElement etc may also be worth a try if that is more convenient
p62716
as(dp62717
g18
V23354
p62718
stp62719
a((dp62720
g2
(lp62721
VThe tricky bit is a parse when you don't know the types, but this can be done with :
p62722
aVGenerics is an option (especially with ), but generics doesn't mix well with  values only known at runtime
p62723
aVIt can be done (/), but it is ugly and a bit slow
p62724
aVTo be honest, though: if it was me I would assume there is a small number of types that need handling here, and  special-case them
p62725
as(dp62726
g18
V23354
p62727
stp62728
a((dp62729
g2
(lp62730
V1: with BinaryFormatter, yes - you need NonSerialized for events (unless you implement ISerializable, but that adds lots of work); however I'm pretty much on-record as saying that I simply wouldn't use BinaryFormatter here
p62731
aVIt is not very forgivig for a range of changes to your type
p62732
aVI would use something less tied to the internals of your code; XmlSerializer; DataContractSerializer, JavaScriptSerializer
p62733
aVI can suggest binary alternatives too; NetDataContractSerializer, protobuf-net (my own), etc
p62734
aV2: yes, with almost any implementation that doesnt involve proper encryption, if anyone cares they can reverse engineer and obtain the strings
p62735
aVSo it depends how hidden it needs to be
p62736
aVSimply running your existing serialization through GZipStream may be enough obfuscation for your needs, BUT this is just a mask against casual inspection
p62737
aVIt will not deter anyone with a reason to look for the data
p62738
aVIf the data needs to be secure, you'll need proper encryption using either a key the user enters at app startup, or something like a certificate securely stores against their user-profile
p62739
as(dp62740
g18
V23354
p62741
stp62742
a((dp62743
g2
(lp62744
VYou can use  and  (passing 0 as the start-index), but internally IIRC these use unsafe code, plus have the overhead of an array
p62745
aVPick your poison
p62746
as(dp62747
g18
V23354
p62748
stp62749
a((dp62750
g2
(lp62751
VEditors routinely have to deal with malformed, incomplete, mangled and otherwise borked input
p62752
aVis designed to work (only) with valid xml
p62753
aVIn short, that isn't going to work so well
p62754
aVI fully expect you're going to have to either find or write a fault-tolerant parser
p62755
as(dp62756
g18
V23354
p62757
stp62758
a((dp62759
g2
(lp62760
VI prefer  (System
p62761
aVWeb
p62762
aVExtensions
p62763
aVdll) for this; the following works:
p62764
aVwith:
p62765
as(dp62766
g18
V23354
p62767
stp62768
a((dp62769
g2
(lp62770
VInference doesn't consider the return type; you can, however, try splitting the generics; for example, you could write code to allow:
p62771
aVby having  (untested; indicative only)
p62772
as(dp62773
g18
V23354
p62774
stp62775
a((dp62776
g2
(lp62777
VWhat do you expect a  to mean here
p62778
aVNote that you can serialize delegates with , but that is also serialinh the delegate's target instance etc
p62779
aVBut something like:
p62780
aVNote that how useful this is depends on your specific scenario
p62781
as(dp62782
g18
V23354
p62783
stp62784
a((dp62785
g2
(lp62786
VThen keep the keys separately in a
p62787
aVThat original order no longer exists on the dictionary
p62788
aVThe list will repeat insertion order
p62789
as(dp62790
g18
V23354
p62791
stp62792
a((dp62793
g2
(lp62794
VAttributes are (with some very few exceptions such as  which is spotted by the runtime itself) metadata only; so do not cause additional  code to magically get invoked
p62795
aVThe exception to this is via tools like PostSharp, which at build time locates such attributes and weaves in extra code
p62796
aVIn all other cases you would have to check for this attribute yourself via reflection, and write code to invoke the extra methods from the attributes
p62797
aVThis is what ASP
p62798
aVNET MVC does; it identifies an expected family of attributes and calls base-class methods to cause your filters to fire
p62799
aVIf you are writing a plugin framework, this might make sense
p62800
aVIf it is for ad-hoc method instrumentation - this isnt going to work without you adding the extra code yourself
p62801
aVWhat might be easier is writing an  type that writes the elapsed time when it is disposed; then you could do:
p62802
aVPerhaps a slight abuse of  but it should work
p62803
as(dp62804
g18
V23354
p62805
stp62806
a((dp62807
g2
(lp62808
VIt looks like you are just missing the enctype; on the for
p62809
aV, add an attribute:
p62810
as(dp62811
g18
V23354
p62812
stp62813
a((dp62814
g2
(lp62815
VAs a pragmatic workaround - don't mark the nesting type :
p62816
as(dp62817
g18
V23354
p62818
stp62819
a((dp62820
g2
(lp62821
VIf you handling the comms yourself, since Silverlight supports , this should still be pretty easy; just use Deserialize
p62822
aVHowever, the easier option is probably to use a web-service reference (or perhaps a web-reference) - since this will handle transferring the type-model (or rather: a shallow interpretation of the type=model) for you - in both directions
p62823
as(dp62824
g18
V23354
p62825
stp62826
a((dp62827
g2
(lp62828
V"All VALUE Types will get allocated to Stack" is very, very wrong; struct variables can live on the stack, as method variables
p62829
aVHowever, fields on a type live with that type
p62830
aVIf a field's declaring type is a class, the values are on the heap as part of that object
p62831
aVIf a field's declaring type is a struct, the fields are part of that struct where-ever that struct lives
p62832
aVEven method variables can be on the heap, if they are captured (lambda/anon-method), or part of (for example) an iterator block
p62833
as(dp62834
g18
V23354
p62835
stp62836
a((dp62837
g2
(lp62838
VIn addition to  (already mentioned), in
p62839
aVNET 4
p62840
aV0 there is  - which is broadly similar, but is a read-only thread-specific store that uses  delegate-based initialization
p62841
aVWhile the value itself is read-only, this could be a reference to a mutable object, providing thread-specific object models
p62842
aVAn advantage of  is that it doesn't have to be bound to a static field - it could be used (for example) in the middle of a lambda body
p62843
aVBut if you don't need this,  is simpler
p62844
as(dp62845
g18
V23354
p62846
stp62847
a((dp62848
g2
(lp62849
VWell, what is actually in the
p62850
aVIf it is just a boxed , then simply cast to unbox:
p62851
aVFor less predetermined content you might also try:
p62852
aVwhich will handle a number of scenarios and doesn't add an extra  in the mix
p62853
as(dp62854
g18
V23354
p62855
stp62856
a((dp62857
g2
(lp62858
VIt may be better to whitelist against things inside your ability to control, such as enums or local constants (or a local whitelist from configuration data if the list isn't fixed ahead of time)
p62859
aVAs a rough check, you could check whether it is interned, since all literals will be interned automatically via ; but note you can explicitly intern too, so this isn't 100% safe
p62860
aVAnd of course, in any event with the question as asked, if that string happens somewhere else as a literal (unconnected to this code) it would still be trusted
p62861
aVI suggest a whitelist is safer
p62862
aVA whitelist could be as simple as:
p62863
aVbut note that this is still mutable at runtime (via reflection if necessary)
p62864
as(dp62865
g18
V23354
p62866
stp62867
a((dp62868
g2
(lp62869
VIf you use:
p62870
aVyou should get the 2 values you expect, although something more selective might be desirable, especially if the right-hand-side might contain a space in the middle
p62871
as(dp62872
g18
V23354
p62873
stp62874
a((dp62875
g2
(lp62876
VStarting in the right ball-park will save a few reallocations/copies, but note that since it is a doubling algorithm it will approach the size pretty quickly
p62877
aVIf it is within 100% that is only one more reallocation/copy for the worst case, so yes - starting with that approach will help some
p62878
aVBut in many ways this is a micro-optimisation; you're already doing it the right way, so unless our profiling shows this is still a bottleneck (ad you therefore need to squeeze the last few cycles out), forget it and move on to the next thing
p62879
as(dp62880
g18
V23354
p62881
stp62882
a((dp62883
g2
(lp62884
Vimportant - it isn't entirely clear what you want to match; I've answered on the premise that only the  is being a problem - but see also Mike Caron's answer which assumes everything is escaped incorrectly
p62885
aVWith a verbatim string literal (i
p62886
ag50
aV),  is escaped to  - so your string becomes:
p62887
aVWith a regular string literal (without the leading ), you would need a lot worse:
p62888
as(dp62889
g18
V23354
p62890
stp62891
a((dp62892
g2
(lp62893
V is trying to do a  (by default, at least; some other verbs are allowed, but they essentially still treat it as a body payload)
p62894
aVIt sounds like you just want a  query like http://www
p62895
aVgoogle
p62896
aVcom/search
p62897
aVq=afnan - so just url-encode
p62898
aVNote, however, that you should always observe the target site's Terms and Conditions - in particular section 5:
p62899
aVYou specifically agree not to access (or attempt to access) any of the Services through any automated means (including use of scripts or web crawlers)
p62900
aVIf you do this, expect to get black-listed
p62901
as(dp62902
g18
V23354
p62903
stp62904
a((dp62905
g2
(lp62906
Vis never valid - even inside a method; you need immediate initialization to infer the type:
p62907
aVAs for why this isn't available for fields with a field-initializer: simply, the spec says so
p62908
aVNow why the spec says so is another debate
p62909
aVI could check the annotated spec, but my suspicion would be simply that they are more necessary for method variables, where the logic is more complex (re LINQ etc)
p62910
aVAlso, they are often used with anon types (that being the necessity for their existence); but anon types can't be exposed on a public api
p62911
aVso you could have the very confusing:
p62912
aVSo all in all I'm happy with the current logic
p62913
as(dp62914
g18
V23354
p62915
stp62916
a((dp62917
g2
(lp62918
VWith an explicit event, you need to provide your own backing store - either a delegate field or something like
p62919
aVThe current code is recursive
p62920
aVTry:
p62921
aVThen (and noting I'm being a little cautious about the "about to turn " edge-case re threading):
p62922
as(dp62923
g18
V23354
p62924
stp62925
a((dp62926
g2
(lp62927
VIf one usage is WCF and another usage is internal to your app, then you can annotate the class appropriately with  such that only the desired properties are exposed
p62928
aVIf you have two different WCF scenarios, then I would introduce a new class (or classes) to represent each set of return data, probably adding an implicit conversion operator (from the entity to the DTO), so that you can do:
p62929
as(dp62930
g18
V23354
p62931
stp62932
a((dp62933
g2
(lp62934
VBecause  implies the cast could fail and return null
p62935
aVWithout a ,  could be  etc - which can't be
p62936
aVWith  it will simply explode in a shower of sparks; no need to handle a
p62937
aVAs an aside (re ), note you can use  if it is known you are casting to a  - for example:
p62938
as(dp62939
g18
V23354
p62940
stp62941
a((dp62942
g2
(lp62943
VNo you can't overload it; a static constructor is useful for initializing any static fields associated with a type (or any other per-type operations) - useful in particular for reading required configuration data into readonly fields, etc
p62944
aVIt is run automatically by the runtime the first time it is needed (the exact rules there are complicated (see "beforefieldinit"), and changed subtly between CLR2 and CLR4)
p62945
aVUnless you abuse reflection, it is guaranteed to run at most once (even if two threads arrive at the same time)
p62946
as(dp62947
g18
V23354
p62948
stp62949
a((dp62950
g2
(lp62951
VBecause of how LINQ works, you are actually creating 8 different versions of  - one set of 4 per
p62952
aVEssentially the same as if you had:
p62953
aVThe first set (discarded) have the property set
p62954
aVBy calling  at the end of , you force it to store and re-use the same 4  instances, hence it passes
p62955
as(dp62956
g18
V23354
p62957
stp62958
a((dp62959
g2
(lp62960
VFrom memory, this uses the existing proto syntax
p62961
as(dp62962
g18
V23354
p62963
stp62964
a((dp62965
g2
(lp62966
V isn't actually an enum
p62967
aVconfusing
p62968
aVIt is a boxed copy of an enum; still, the following should work:
p62969
aV(this  cast doesn't add a box, since it is already boxed)
p62970
aVNote also that not all enums are based on ; this unboxing trick may fail for non- enums
p62971
as(dp62972
g18
V23354
p62973
stp62974
a((dp62975
g2
(lp62976
VWell,  would be simpler, and will use the new  overloads in
p62977
aVNET 4 when availble
p62978
aVIn
p62979
aVNET 4, the following is preferred (emph:  will do this for you):
p62980
aVFor why, see Eric Lippert's blog
p62981
aVBut otherwise: the second; otherwise if the  call fails (any method call can fail), you then try and  a lock that you don't have
p62982
as(dp62983
g18
V23354
p62984
stp62985
a((dp62986
g2
(lp62987
VIf you are targeting
p62988
aVNET 3
p62989
aV5 or above, LINQ:
p62990
aVAlthough it there is a lot of data, a line-reader may be better, to avoid having to hold all the lines in memory:
p62991
aVthen:
p62992
as(dp62993
g18
V23354
p62994
stp62995
a((dp62996
g2
(lp62997
VIn the general sense (not limiting to http/https), an (absolute) uri is always a scheme followed by a colon, followed by scheme-specific data
p62998
aVSo the only safe thing to do is cut at the scheme:
p62999
aVIn the case of http and a few others you may also want to , but this is not part of the scheme, and is not guaranteed to exist
p63000
aVTrivial example:
p63001
as(dp63002
g18
V23354
p63003
stp63004
a((dp63005
g2
(lp63006
VTo be included in the mex/wsdl, the enum needs to be used somewhere in the graph, for example there should be a property somewhere of type
p63007
aVTypes not actively used in the graph are omitted
p63008
aVNote also that you don't actually need to annotate enums at all - they will work just fine
p63009
aVYou only need attributes on enums if you want to customize how they act on the wire
p63010
as(dp63011
g18
V23354
p63012
stp63013
a((dp63014
g2
(lp63015
VThe argument to  is a mask, not a bit offset
p63016
aVis probably closer to what you want
p63017
aV(edit) hmmm - maybe the easiest thing is to use shift operators; in C#:
p63018
aVAlso note that index 0 refers to the LSB - so you need to reverse the loop
p63019
aVOr easier:
p63020
as(dp63021
g18
V23354
p63022
stp63023
a((dp63024
g2
(lp63025
VThe only typed way you can do that is if the other method is generic, and you let generic type inference do the work:
p63026
aVYou can also pass it without any type information via  , ,  or , of course
p63027
as(dp63028
g18
V23354
p63029
stp63030
a((dp63031
g2
(lp63032
VNot a LINQ answer, but a perfectly valid LINQ-to-SQL one:
p63033
aVYou don't have to hand over control of every query to LINQ; indeed, in many cases a well-written custom TSQL query can be far more efficient that one generated from LINQ-to-SQL
p63034
aVWhich isn't a criticism of LINQ-to-SQL (it does a great job for the majority of queries that are simple etc)
p63035
as(dp63036
g18
V23354
p63037
stp63038
a((dp63039
g2
(lp63040
VThis example is a bit confused, because:
p63041
aVcreates a  like you expect; however:
p63042
aVis a call to a non-virtual method on , which isn't (and can't be) overridden - therefore this is a boxing operation; and  has special boxing rules:
p63043
aVif it is empty, it boxes to
p63044
aVif it has a value, the value is boxed and returned
p63045
ag412
ag50
aVbox to exactly the same thing
p63046
aVTherefore, you are passing  to
p63047
aVA more illustrative example of when this helps is when using reflection:
p63048
as(dp63049
g18
V23354
p63050
stp63051
a((dp63052
g2
(lp63053
VThis is simply not possible
p63054
aVAttributes are limited to very basic types that don't include what you would need for this
p63055
aVOne possible static-safe way of doing it would be to subclass the attribute per property but that is an insane amount of work
p63056
aVPersonally, I'd just write a unit test that finds all occurrences of the attribute and checks they are sensible via reflection
p63057
aVYou could also do this in the main code inside a  block (or similar)
p63058
as(dp63059
g18
V23354
p63060
stp63061
a((dp63062
g2
(lp63063
VThe tricky thing is making sure that they get disposed
p63064
aVBut (to make it harder) only if they aren't the inbuilt system brushes etc - since they don't really belong to your form
p63065
aVIf they are diaposed in Dispose() then this is fine
p63066
aVOtherwise it can slowly leak handles
p63067
aVGC might catch them, but this is not deterministic
p63068
as(dp63069
g18
V23354
p63070
stp63071
a((dp63072
g2
(lp63073
VThe mention of  /  means this is a "v2" question, in which case you don't have to use the attributes at all - you can define the model at runtime via
p63074
aVRe the question of custom serializers - at the moment, not exactly - but I expect I'll add an interface for this before long
p63075
aVThe only problem is that the caller is then responsible You might also want to look at the experimental  serializer, which does something similar
p63076
aVThere are some technical considerations too, though; in particular inheritance; the obvious pattern would be for your class to implement an interface, but this means that once the object is created it is too late to create a subclass
p63077
aVUnless the type that implements the interface isn't the entity itself, but a separate type that juts handles serialization/deserialization
p63078
as(dp63079
g18
V23354
p63080
stp63081
a((dp63082
g2
(lp63083
VAs long as you treat it as an , yes it is platform agnostic
p63084
aVThis includes all arithmetic and bitwise ( ,  etc) operations
p63085
aVThe opcodes always make sure that it does what you expect
p63086
aVHowever
p63087
aVIf you peek below the covers, it might matter; for example  and  care about the endianness
p63088
aVYou can check this with ; it is usually  on "regular"
p63089
aVNET, but could be  perhaps on IA64, or XNA or Mono on some architectures
p63090
aVThe same logic applies to any unsafe code that coerces (for example) between  and , or any unions constructed via
p63091
aVBut in regular code, you should be fine
p63092
as(dp63093
g18
V23354
p63094
stp63095
a((dp63096
g2
(lp63097
VIf you use the standard service boilerplate, but then edit , to either:
p63098
aVcheck , or
p63099
aVcheck the command line arguments, for example a "" switch
p63100
aVand change the code to run your code directly instead of running the standard service startup code, it should work fine
p63101
aVFor a full example (including self install/uninstall), see my answer here
p63102
aVThe biggest issue is allowing for the fact that your debugging runs in a different security context (the interactive user's) rather than a service account
p63103
as(dp63104
g18
V23354
p63105
stp63106
a((dp63107
g2
(lp63108
VI would probably just loop:
p63109
as(dp63110
g18
V23354
p63111
stp63112
a((dp63113
g2
(lp63114
VOpen the assembly in Reflector (the free version is fine); find the type (F3), then bring up the anaylyzer (Ctrl+R) and expand the "Instantiated By" node
p63115
aVThen right-click on the "Instantiated By" node itself and click copy; for example:
p63116
as(dp63117
g18
V23354
p63118
stp63119
a((dp63120
g2
(lp63121
VThere are two options here:
p63122
aVYou could have two different interfaces (or ) - where one interface allows the simple scenarios, and the second interface has extra methods for obtaining the options
p63123
aVOr: you can have methods like (to copy from )  - if this returns  it is reasonable to call the  method; if this returns false the caller should not call  (and it will probably throw a , but a well-written caller should never see them because they are observing  )
p63124
as(dp63125
g18
V23354
p63126
stp63127
a((dp63128
g2
(lp63129
VThere are a few places where an empty (self-closing) element gets treated as significantly different to an element that has an empty text content
p63130
aVAssuming you don't control the source, I wonder if in this case you should be pragmatic and change it to a string member:
p63131
as(dp63132
g18
V23354
p63133
stp63134
a((dp63135
g2
(lp63136
VWell, firstly I wouldnt let a number rule my code :)
p63137
aVHowever, using  may simplify things quite a bit - less code to be counted
p63138
aVI'm not at a PC but that looks like a single  call, plus a few request headers
p63139
aVhttp://msdn
p63140
aVmicrosoft
p63141
aVcom/en-us/library/fhd1f0sw(v=VS
p63142
aV100)
p63143
aVaspx
p63144
aVOh, and add some  statements around all the  objects you create
p63145
as(dp63146
g18
V23354
p63147
stp63148
a((dp63149
g2
(lp63150
VIm not a NHibernate expert, but in v2 there are a few things designed to cater for this scenario; foremost there is code built in intended to recognise NH proxies and treat appropriately (in particular, not complain about unknown types)
p63151
aVI will read the linked article, though; without more NH experience I can't be sure that the current approach is sufficient
p63152
aVI would also be more than happy to receive any test cases I could use to prove that it meets the need
p63153
as(dp63154
g18
V23354
p63155
stp63156
a((dp63157
g2
(lp63158
VA class library doesn't get its own config; for an app named Foo
p63159
aVexe you need your configuration to be in Foo
p63160
aVexe
p63161
aVconfig
p63162
aVThe exception here is web apps, where web
p63163
aVconfig is the naming convention
p63164
as(dp63165
g18
V23354
p63166
stp63167
a((dp63168
g2
(lp63169
VI would simply use the async methods on  - much easier to work with:
p63170
aVBut to answer the question; assuming it is text, something like (noting you may need to specify the encoding):
p63171
as(dp63172
g18
V23354
p63173
stp63174
a((dp63175
g2
(lp63176
VI usually approach this by having separate dlls per playform, so I can use available platform features when possible (often neither is a strict subset/superset, and aiming for the intersection is overly limiting if you want the beat performance etc)
p63177
aVMost features are common though, so the amount of #if code (with feature-specific build symbols) is often minimal
p63178
aVTo avoid issues with forgetting to add project files, I use a recursive wildcard in the csproj, so all
p63179
aVcs files are included automatically
p63180
as(dp63181
g18
V23354
p63182
stp63183
a((dp63184
g2
(lp63185
VThe (cast) syntax is very overloaded, and can perform:
p63186
aVboxing/unboxing
p63187
aVreference-preserving type casts
p63188
aVconversion operators defined on the types
p63189
aVinbuilt primitive conversions
p63190
aVNullable-of-T wrapping/unwrapping
p63191
aVas" performs a subset of these
p63192
aVreference-preserving type casts
p63193
aVsome limited boxing of nullable-of-T
p63194
aVBut the important feature here is that it doubles as an exception-free test of a type relationship - more efficient than having an exception or testing with reflection
p63195
aVIn particular, for example:
p63196
aVIf you strongly believe that an object is something, a (cast) is preferred as this acts as an assertion of your belief
p63197
aVAn exception (in that case) would be desirable
p63198
aVThe Convert methods handle a different range of scenarios including string conversions (otherwise available via things like static
p63199
aVParse methods)
p63200
aVIf anything, it is Convert that I use least
p63201
aVThe (cast) and "as" syntax is in very regular use
p63202
as(dp63203
g18
V23354
p63204
stp63205
a((dp63206
g2
(lp63207
VTry
p63208
aVYou are otherwise using integer arithmetic, where 5/9 is zero
p63209
as(dp63210
g18
V23354
p63211
stp63212
a((dp63213
g2
(lp63214
VThe simplest way is to annotate the class so that the serializer anticipates the subclass:
p63215
aVOtherwise (if using the more complex constructors for ) you need to be very careful to cache and re-use the serializer instance - otherwise it will haemorrhage memory (it creates an assembly each time that cannot be garbage-collected; the simplest constructor taking just a  handles this caching for you)
p63216
as(dp63217
g18
V23354
p63218
stp63219
a((dp63220
g2
(lp63221
VYou'd have to fire up something like Fiddler to see what is happening at the transport layer, but IMO it sounds like maybe you've been hitting them too much and the server has cut you off for a while (yes: many sites will do this if you hit them aggressively i
p63222
ag50
aVvia a script)
p63223
aVIn particular, since you mention google: see the terms of service (emphasis is mine):
p63224
ag691
aV3   You agree not to access (or attempt to access) any of the Services by any means other than through the interface that is provided by Google, unless you have been specifically allowed to do so in a separate agreement with Google
p63225
aVYou specifically agree not to access (or attempt to access) any of the Services through any automated means (including use of scripts or web crawlers) and shall ensure that you comply with the instructions set out in any robots
p63226
aVtxt file present on the Services
p63227
aVIt is also fairly common for sites to block access to images based on the referer http header, to discourage cross-site embedding of their image in your site
p63228
as(dp63229
g18
V23354
p63230
stp63231
a((dp63232
g2
(lp63233
VLINQ-to-SQL only supports basic queries; CTE and recursion are not included in this
p63234
aVTherefore, here's my high-tech translation to LINQ-to-SQL:
p63235
aVwith
p63236
as(dp63237
g18
V23354
p63238
stp63239
a((dp63240
g2
(lp63241
VThat sounds more like a server-fault question; I wonder if "group policy" is the way to do that on a per-machine basis;
p63242
aVHowever - for a programming answer - why not get the time from a central server when your app starts
p63243
aVCalculate the offset from the local time and apply that throughout your app
p63244
aVIf security needs to be tight you may need to sign the response from the server to prevent spoofing (in particular via "hosts" etc)
p63245
as(dp63246
g18
V23354
p63247
stp63248
a((dp63249
g2
(lp63250
VIt sounds simply as though you are trying to do two different operations on the same stream at the same time from different threads
p63251
aVAdding a  () or  should help synchronise access to the stream
p63252
as(dp63253
g18
V23354
p63254
stp63255
a((dp63256
g2
(lp63257
VJust check ; if that is true use  - otherwise it is null
p63258
aVIt also helps that you can pass null to SetValue on a PropertyInfo or FieldInfo and it will work for value-types with even for int, float etc
p63259
as(dp63260
g18
V23354
p63261
stp63262
a((dp63263
g2
(lp63264
VNo, there is no construct for that
p63265
aVStatic methods in particular have no way of enforcing any commonality
p63266
aVIf is was an interface you could have something like  or  (for some T defined on a generic interface) and take a single parameter to represent te state
p63267
as(dp63268
g18
V23354
p63269
stp63270
a((dp63271
g2
(lp63272
VPersonally, until you have measures that you need things like comet, I would use basic JSON polling with things like throttling (so you slow down the polling on quiet rooms)
p63273
aVAnd a very basic "nothing had changed" message
p63274
aVFor an example, click the "chat" link above
p63275
aVIt is simple and pragmatic
p63276
aVRe keeping between pages; trickier especially if you don't want Silverlight
p63277
aVWe use a few HTML 5 tricks there to avoid hammering the connections
p63278
as(dp63279
g18
V23354
p63280
stp63281
a((dp63282
g2
(lp63283
VMost likely this is tied into the VS2010 usage of WPF, combined with WPFs ability to hook into hardware GPU if it wants
p63284
aVAnd presumably your screen capture tool isn't loving the way your video driver handles that
p63285
as(dp63286
g18
V23354
p63287
stp63288
a((dp63289
g2
(lp63290
VWhen it comes to object construction, current C# demands that you be very specific
p63291
aVThis seems like an unlikely thing to create very often, though, so you could just create a  type from the current type's type-parameters:
p63292
aVIf the type-parameters are for the method you'll have to supply them for the constructor, but you can still use  on the variable declaration
p63293
aVYou may also find that in many cases too much generics is actually a bad thing
p63294
aVIf it starts to get too gnarly, there are times when things like  (non-generic) are genuinely desirable
p63295
as(dp63296
g18
V23354
p63297
stp63298
a((dp63299
g2
(lp63300
VSomething like:
p63301
aVNote that with the content in the origianl question, this will return true for:
p63302
aVwhich is to say, a string with the internal value
p63303
as(dp63304
g18
V23354
p63305
stp63306
a((dp63307
g2
(lp63308
VIf you are using the surface SDK, the surface simulator handles this
p63309
aVIn addition to controlling multiple touches with one mouse, you can also plug in multiple mice to represent different touches
p63310
as(dp63311
g18
V23354
p63312
stp63313
a((dp63314
g2
(lp63315
V may well get a 0 if the stream is closed and all data has been consumed
p63316
aVHowever, for most other purposes there is no logical break in a stream - and even  only tells you what is available at the client - not what was sent by the server
p63317
aVHence: if you are sending multiple messages / etc on the same stream it is usually necessary to either prefix each block with the number of bytes expected, or to use some delimiter sequence that would not normally be expected in the middle of content
p63318
aVThe former is often easier if the content could be arbitrary binary content (i
p63319
ag50
aVit is tricky to predict a sequence that isn't expected), but the latter allows streaming without knowing the lengths ahead of time (useful if you are computing the content on-the-fly, as otherwise you may need to buffer the content first to know the length (or do a dry run discarding the data)
p63320
aVAlso note that  is not guaranteed to return all the available data - it would be entirely legitimate to send , and have  return just 1 (the )
p63321
aVHence you should expect to have to combine multiple  calls into a single message (again, using the length-prefix or the expected delimiter sequence)
p63322
aVIn this scenario, I'd be tempted to send  (where  is a zero-byte)
p63323
aVThen I would consume via  until either it returns , or a  is found
p63324
aVIn the  case, anything buffered before the terminator represents a single message; anything after the delimiter should be stored and processed as part of the next message-or-messages
p63325
aVAs a test case, imagine you get  return 13, with sequence , which which should , , , , , ,  (noting that the  should not be processed - it might be part of a longer sequences that isn't yet received - buffer until you get a )
p63326
as(dp63327
g18
V23354
p63328
stp63329
a((dp63330
g2
(lp63331
VAssuming there are no static conversion operators defined, the cast should take the same time, roughly
p63332
aVThere are potentially some "inlining" optimisations possible when invoking a method on a class rather than an interface, but that won't be noticed unless calling a method an insane number of times
p63333
aVOver all; there is no significant performance issue with either
p63334
aVOr to put it another way: until I've profiled and shown this to matter, I'd look elsewhere first
p63335
as(dp63336
g18
V23354
p63337
stp63338
a((dp63339
g2
(lp63340
VCircular references are possible (via the command-line and some tricks; not via the IDE) but are a major pain; don't do it
p63341
aVEither add an extra assembly for the common types, or merge the two libraries
p63342
aVIn many ways, fewer is simpler
p63343
aVA myriad of dlls doesn't mean that you have achieved purity - it is just a mess
p63344
as(dp63345
g18
V23354
p63346
stp63347
a((dp63348
g2
(lp63349
VFor a field, just set it
p63350
aVFor a property, it could be more complex, depending on whether the  or  is disproportionately expensive, and/or whether the  checks this internally (bypassing events etc)
p63351
aVAs a general rule for properties, just set it, until you know this to be an issue due to profiling
p63352
aVFor fields; don't worry excessively about it; default to just set
p63353
as(dp63354
g18
V23354
p63355
stp63356
a((dp63357
g2
(lp63358
VThere is an overload of Areay
p63359
aVBinarySearch that takes a comparer ( http://msdn
p63360
aVmicrosoft
p63361
aVcom/en-us/library/4ba2bttb
p63362
aVaspx ), but in this case I would simply switch to a , which sounds far more appropriate:
p63363
aVfaster fetch: O(1)
p63364
aVno dependency on the data being sorted (in fact, no notion of sorting at all)
p63365
aVstrongly typed
p63366
as(dp63367
g18
V23354
p63368
stp63369
a((dp63370
g2
(lp63371
VThe trick is deciding whether the code shows the form with  vs  - so it is the code that displays the form that needs tweaking
p63372
as(dp63373
g18
V23354
p63374
stp63375
a((dp63376
g2
(lp63377
VThat is not a simple request; you would have to write a wrapper class (for an ) that has a custom  (alternatively:  or , but  is simplest)
p63378
aVThen write a custom  (or several) to represent the fake properties
p63379
aVAssuming , override  to return the artificial properties (for values or sub-nodes)
p63380
aVIt would be easier to build it upwards from a
p63381
aVOK; this is not easy; this is a very untested start point - crude and barely functional, but here it is anyway
p63382
aVFor more reference on what is happening here, look in particular at  which simulates properties, and  which provides the properties (although there are other options for this)
p63383
aVSome other articles that may help:
p63384
aVData binding dynamic data
p63385
aVProperties generated at runtime (PropertyGrid
p63386
aVSelectedObject)
p63387
aVHow to display a dynamic object in property grid
p63388
aVCode:
p63389
as(dp63390
g18
V23354
p63391
stp63392
a((dp63393
g2
(lp63394
VIf you are talking directly to a SqlCommand (rather than an abstraction like a data-adapter) it should be identical - it is just TSQL sent to te server
p63395
aVThe only differences may be the SET options in effect, perhaps the account you are using, the default schema etc
p63396
as(dp63397
g18
V23354
p63398
stp63399
a((dp63400
g2
(lp63401
VPointers only I'm afraid (I'm not at a pc) - but;
p63402
aVthe lambda's
p63403
aVBody will most likely be MemberExpression
p63404
aVdo a safe cast ( etc) and access the
p63405
aVsince you belive this a property, this should be a PropertyInfo, so test/cast etc
p63406
aVfrom a PropertyInfo, call GetSetMethod() to get the corresponding MethodInfo
p63407
aVuse Delegate
p63408
aVCreateDelegate to get that as a delegate (passing the action type)
p63409
aVfinally, cast the Delegate returned onto the expected delegate type
p63410
as(dp63411
g18
V23354
p63412
stp63413
a((dp63414
g2
(lp63415
VIn
p63416
aVproto there is no such specification; you must simply document it (and presumably cast it appropriately at the consuming code)
p63417
aVAside: if you happen to be using the C# protobuf-net implementation, then you can do this by working outside a
p63418
aVproto definition (protobuf-net allows code-first):
p63419
aVThis is then obviously constrained to 0-255, but is encoded on the wire as you expect (like a )
p63420
aVIt also does a  conversion when deserializing, to sanity-check the values
p63421
aVIn
p63422
aVproto, the above is closest to:
p63423
as(dp63424
g18
V23354
p63425
stp63426
a((dp63427
g2
(lp63428
VYou shouldn't really attempt to edit the program itself - it'll break signatures/strong-naming, the exe/dll file will almost certainly be locked, and even if you shadow-copy: many users won't have permission to edit it in program-files (or as click-once)
p63429
aVSomething external such as a  license file or registry setting seems appropriate (unless you want to build the app at your server per-client)
p63430
as(dp63431
g18
V23354
p63432
stp63433
a((dp63434
g2
(lp63435
VYou could create a static (synchronised)  - or if you are caching all lengths up to a known size, just a  (faster and simpler; no need to synchronise either)
p63436
aVFor example:
p63437
as(dp63438
g18
V23354
p63439
stp63440
a((dp63441
g2
(lp63442
VIt certainly isn't great practice
p63443
aVIt does makes some examples easier, like "hello world" - maybe the C# designers were going for code-golf ;p
p63444
aVBut yes, it is an oddity
p63445
aVI'm not aware of any resounding reason that we need to be able to directly use the global namespace
p63446
aVEven for extension methods I'd rather add a  directive to bring them in
p63447
aVInterestingly - there seem to be 40-odd such in  and 20-odd in
p63448
aV(but all private / compiler-generated)
p63449
as(dp63450
g18
V23354
p63451
stp63452
a((dp63453
g2
(lp63454
VHttp handlers are an essential part of ASP
p63455
aVNET - they are what handles the request and generates the response
p63456
aVIn webforms it is typical for a page (aspx, or maybe ashx) to interpret a request, but this is itself a type of handler (just mapped by default in the main web
p63457
aVconfig file)
p63458
aVIn the case of adding handlers to the config file, this is typically because the application is generating content dynamically for urls that don't magically map to existing files, or to add some logic for files that do exist but which are beyond regular asp
p63459
aVnet
p63460
aVIf you are using ASP
p63461
aVNET MVC, you tend to need this much less (if at all) as it is the norm for requests not to map directly to an aspx/ashx in the source tree
p63462
aVThinking back to ASP
p63463
aVNET webforms, the main time I've used handlers is when doing things like binary downloads, file exports, etc - where I don't really want it running through the webforms aspx pipeline
p63464
as(dp63465
g18
V23354
p63466
stp63467
a((dp63468
g2
(lp63469
VYou can change the type name in the dbml/designer
p63470
aVIt doesn't have to be an exact match to the table name
p63471
aVRe the constructor; to chain to another existing constructor you can use the  syntax after your constructors declaration (nut before the body)
p63472
aVNo: you don't need to modify the data-context if you are just adding a partial class fragment
p63473
aVYo create a new instance just use  - it is the same type as it was before (a partial class just splits a type over several physical files that the compiler must merge)
p63474
aVRe the DB name in the data-context; it is common to pick up the connection details from config at runtime, in which case this is ignored
p63475
as(dp63476
g18
V23354
p63477
stp63478
a((dp63479
g2
(lp63480
VNothing built in, unless you count interop to ODBC or legacy ADO
p63481
aVI recommend the "fast CSV reader" on codeproject; robust and fast
p63482
aVI've use it countless times
p63483
aVIt sounds tempting to think "just split on comma", but it is a or more subtle than that; multiline, escaped, the infamous comma/period swapping in some EU
p63484
aVUsing a library is a good call here
p63485
as(dp63486
g18
V23354
p63487
stp63488
a((dp63489
g2
(lp63490
VIt depends entirely on what te implementation is, of course
p63491
aVAn incorrect dispose on a SqlTransaction could lead to excessive long blocking, for example - impacting multiple machines and users
p63492
aVAn incorrect dispose on a SqlConnection could cause connection saturation and inability to connect
p63493
aVThese are not just memory (etc) issues
p63494
aVIIRC a missing graphic (pen/brush/whatever) dispose was responsible for a VS crash bug - GC didn't happen because there was no memory pressure, so instead it simply saturated the GDI handles and broke
p63495
aVAn incorrect file/stream dispose could cause exceptions due to a file bring unavailable for reading/writing - potentially losing data
p63496
aVWith unmanaged resources not properly handled, anything is possible
p63497
as(dp63498
g18
V23354
p63499
stp63500
a((dp63501
g2
(lp63502
VThe lock translates to try/finally (normal c#)
p63503
aVIn Iterator blocks (aka yield), "finally" becomes part of the IDisposable
p63504
aVDispose() implementation of the enumerator
p63505
aVThis code is also invoked internally when you consume the last of the data
p63506
aVforeach" automatically calls Dispose(), so if you consume with "foreach" (or regualar LINQ etc) it will get unlocked
p63507
aVHowever, if the caller uses GetEnumerator() directly (very rare) and doesnt read all the data and doesn't call Dispose() then the lock will not be released
p63508
aVI would have to check to see if or gets a finaliser; it might get released by GC, but I wouldn't bet money on it
p63509
as(dp63510
g18
V23354
p63511
stp63512
a((dp63513
g2
(lp63514
VRegex is not the way to do this
p63515
aVIf it is HTML: the "HTML agility pack"
p63516
aVIf it is XHTML, then XmlDocument or XDocument
p63517
aVBut not regex
p63518
as(dp63519
g18
V23354
p63520
stp63521
a((dp63522
g2
(lp63523
VThe first thing you should try is casting to , as this has a very cheap :
p63524
aVThe  for dictionary should work though - I've tested this with  and it works fine - but note that even if something implements , the concrete type (returned via ) doesn't  have to have a  on the public API - it could use explicit interface implementation to satisfy the interface while not having a
p63525
aVLike I say: it works for  - but not necessarily for every type
p63526
aVAs a last ditch effort if everything else fails:
p63527
aVEdit to look into the  question raised in comments:
p63528
as(dp63529
g18
V23354
p63530
stp63531
a((dp63532
g2
(lp63533
VWith LINQ:
p63534
aVshould work
p63535
aVIf the order is unimportant you could also use:
p63536
aV(and then use  /  whatever you need)
p63537
as(dp63538
g18
V23354
p63539
stp63540
a((dp63541
g2
(lp63542
VIf you mean moving between assemblies:
p63543
aVFor existing built code you should add:
p63544
aVto the original assembly (that no longer contains )
p63545
aVThen the CLR will sort everything out for you for existing built code without having to update the references
p63546
aVHowever, for building code you will still need to update the references; I don't think vanilla VS has that built in
p63547
as(dp63548
g18
V23354
p63549
stp63550
a((dp63551
g2
(lp63552
VLoad all the dlls into "reflector" (the free version is fine)
p63553
aVnavigate to the method you are interested in
p63554
aVbring up the analyser (ctrl+r I believe)
p63555
aVjob done
p63556
as(dp63557
g18
V23354
p63558
stp63559
a((dp63560
g2
(lp63561
VSince SQL-server 2005 lacks the time-only data-types, I would use an integer type, of appropriate size to hold the count of "some time interval" - seconds, milliseconds, etc
p63562
aVI would do all the translations (except comparisons) in the app tier; no reason for the DB to worry about them except as an int/bigint/etc
p63563
as(dp63564
g18
V23354
p63565
stp63566
a((dp63567
g2
(lp63568
VChanging _List is simply changing the field (not the actual list) to a completely unrelated list
p63569
aVIn short inheritance isn't going to work well for what you want here; you can't reassign "this" (at least, not for a class)
p63570
aVI suspect encapsulating the list would work better for you
p63571
as(dp63572
g18
V23354
p63573
stp63574
a((dp63575
g2
(lp63576
VI'm not at a PC so I can't explain the first, but I'd sidestep it:
p63577
aVLess string creations, no parsing overheads, etc ;)
p63578
as(dp63579
g18
V23354
p63580
stp63581
a((dp63582
g2
(lp63583
VThere are multiple problems there:
p63584
aVhaving a mutable struct - just evil
p63585
aVhaving public fields
p63586
aVusing
p63587
aVnone of these is helping you
p63588
aVwith a  the initializer would work fine
p63589
aVwith a property you could do lazy init:
p63590
aVI would refactor to:
p63591
as(dp63592
g18
V23354
p63593
stp63594
a((dp63595
g2
(lp63596
VI suspect that  returns  - is that right
p63597
aVIf so there is no way of projecting that to a  - only to an  - and  wants the
p63598
aVis not the same as an indirect `foreach
p63599
as(dp63600
g18
V23354
p63601
stp63602
a((dp63603
g2
(lp63604
VIn this case I wouldn't store it as an enum - it sounds more like range markers than discreet values
p63605
aVI might have some constants and a method that checks
p63606
aVEtc
p63607
aVBut to answer the question about incrementing an enum: you can cast it to the base-type (usually ):
p63608
as(dp63609
g18
V23354
p63610
stp63611
a((dp63612
g2
(lp63613
VIf the problem was "not getting a row" the error would be different
p63614
aVThe problem here is in the materialiser - i
p63615
ag50
aVturning a retrieved row of data from an  into an object
p63616
aVI strongly suspect that one of the int columns on the row is , but in the DBML is is marked as non-nullable
p63617
aVFind which column this is, and either make it nullable in the DBML or remove the null from the database
p63618
as(dp63619
g18
V23354
p63620
stp63621
a((dp63622
g2
(lp63623
VYou could try using the index from Add in case it is doing something hokey with ordering:
p63624
aVOr better:
p63625
as(dp63626
g18
V23354
p63627
stp63628
a((dp63629
g2
(lp63630
VIn the following I'm assuming you don't have any other needs like validation / side-effects
p63631
aVOnly the first works on earlier versions of c#
p63632
aVOnly the first allows a simple field-initialiser (rather than constructor)
p63633
aVOnly the first allows adding attributes to the field such, as
p63634
aVSwitching between the two can break some serializers ( for example) and reflection-based code
p63635
aVBut the  is more concise, and preferred in most cases
p63636
as(dp63637
g18
V23354
p63638
stp63639
a((dp63640
g2
(lp63641
s(dp63642
g18
V23354
p63643
stp63644
a((dp63645
g2
(lp63646
VThat isn't the same array - it is a different array with the same contents
p63647
aVAn array GetHashCode() doesnt hash the contents
p63648
aVThat hash is simple a hash of the reference
p63649
aVYou could write a custom  if needed for a dictionary etc
p63650
as(dp63651
g18
V23354
p63652
stp63653
a((dp63654
g2
(lp63655
VTo answer the question; yes structs are copied whenever needed: writing to a field/variable, or passing into a method
p63656
aVThis is not optimised away and doesn't need to be
p63657
aVIf it is a struct, it should be immutable - then the issue of another method changing the fields is moot: it shouldnt be changing them, and they should be readonly
p63658
aVRe the issue of being over-sized; if it is over-size it shouldn't be a struct; it should be a class - but if it represents a discreet value you may also want to keep it immutable even in class form
p63659
aVAnother answer to both problems is to pass it "ref" to methods, or to encapsulate it as a field, not property on a class, but IMO either of these usually means they are using a struct incorrectly in the first place
p63660
aVThe real change I would make here is to assess whether this really is a "value"
p63661
aVValues never change; structs therefore shouldn't need to mutate
p63662
aVIf you can't say this about your type, it probably shouldn't be a struct
p63663
as(dp63664
g18
V23354
p63665
stp63666
a((dp63667
g2
(lp63668
VI expect this type metadata is being stored as a string, perhaps in explicit code, but perhaps via a "typeof" in an attribute
p63669
aVYou might try handling the AppDomain's TypeResolve event, detecting the type string that is failing and returning the Type you intend - this should work around the fact that it is now in a different assembly
p63670
aVhttp://msdn
p63671
aVmicrosoft
p63672
aVcom/en-us/library/system
p63673
aVappdomain
p63674
aVtyperesolve
p63675
aVaspx
p63676
as(dp63677
g18
V23354
p63678
stp63679
a((dp63680
g2
(lp63681
VThe   could be encoded as an integer via shift operations etc
p63682
aVThe  - you might try using a union to swap for , and then encode the  with shift operations:
p63683
aVThen if you have an existing  or  you can encode (depending on your chosen endianness) something like:
p63684
as(dp63685
g18
V23354
p63686
stp63687
a((dp63688
g2
(lp63689
VTo be treated as a struct the compiler must know at compile time what the concrete type is, to reserve the right space on the stack
p63690
aVThis means that even if a struct implements , then with:
p63691
aVthen the assignment to  is a boxing operation
p63692
aVYou could say "the compiler should spot that it is only ever a foo and use the 'constained' opcode", but in the general case (with multiple assignments to  etc) this isn't possible (I would hazard a guess that it will hit the "halting problem")
p63693
aVThere is also an issue of virtual vs static call, but the "constrained" opcode works around that
p63694
aVBasically, any usage of the interface must always be treated as a reference
p63695
aVThere is one exception to this: generic constraints
p63696
aVIf you have
p63697
aVhere the method is JITted once per value-type, so the stack-space needed for  is known; the call to  is "constrained" and can be virtual or static automatically as needed
p63698
as(dp63699
g18
V23354
p63700
stp63701
a((dp63702
g2
(lp63703
VIt depends on what all the use-cases are :)
p63704
aVIf your DB code could use LINQ, then I might consider returning an , as this can be applied via  to both DB-based LINQ and LINQ-to-Objects - in the latter case simply by calling:
p63705
aV(DB code is typically already queryable, so no AsQueryable is needed)
p63706
aVOne bad thing about this is that there is no guarantee that a particular query expression will work on every LINQ provider
p63707
aVAlternatively, you would have to write either your own basic query language, or a basic tree-structure
p63708
aVAnd then write code to translate to both property-reflection and SQL
p63709
aVLots of work
p63710
aVOne final thought is to just have two different query results, and keep the two thigs separate
p63711
aVSo one SQL, one  or similar
p63712
aVThere is a risk of them being out of sync, though
p63713
as(dp63714
g18
V23354
p63715
stp63716
a((dp63717
g2
(lp63718
VYes, having a constructor just for this is bad design
p63719
aVA static  method that can only be called once (else throws an exception) would seem better
p63720
aVYou would set the path during app-startup, etc
p63721
aVThen you can either make it a , or a singleton if it is required to satisfy some interface-based scenario
p63722
aVNext: you must add synchronisation here
p63723
aVThat is not thread safe
p63724
aVIf two threads attempt to log at the same time, I would expect this to collapse horribly
p63725
aVIt doesn't need to be complex; at the simplest:
p63726
aV(but note that this may incur some blocking costs; which can be improved with more sophisticated code - see below)
p63727
aVThere are existing logging libraries that will think of lots more issues - file partitioning, async (to stop your code being blocked by IO), batching, etc; why not just use one of them
p63728
aVIn particular, at te moment your file will not be cleanly closed at app-exit, doesn't flush regularly, and will keep the file locked most of the time
p63729
aVNot good
p63730
as(dp63731
g18
V23354
p63732
stp63733
a((dp63734
g2
(lp63735
VYour code looks fine
p63736
aVThe problem here is that StringBuilder has a confusing set of Equals that are contradictory
p63737
aVIn particular, Equals(StringBuilder) disagrees with Equals(object), even when the object is a StringBuilder
p63738
aVAll that  needs is a sane Equals(object) implementation
p63739
aVThe interface () is optional
p63740
aVUnfortunately StringBuilder doesn't have this (at least, by comparison to Equals(StringBuilder), which your third test is using)
p63741
aVBut in general, the advice is: use ; this supports:
p63742
aVnullable-of-T with standard "lifted" rules
p63743
aVIEquatable-of-T
p63744
aVobject
p63745
aVEquals
p63746
as(dp63747
g18
V23354
p63748
stp63749
a((dp63750
g2
(lp63751
VThe coalesce can be done simply with the c#  coalescing operator, I
p63752
ag50
aVJoins are single condition in LINQ, but in most cases (at least, for inner joins) you can add an extra "where" for the same result
p63753
aVThis unfortunately is harder for outer joins :(
p63754
aVAlso keep in mind that when the translation becomes suboptimal or just confusing, you can use:
p63755
aVusing  etc to represent parameters (like  specifiers), and where ResultType can be any type with property names that match the returned column names (I often use a query-specific local type for this purpose)
p63756
as(dp63757
g18
V23354
p63758
stp63759
a((dp63760
g2
(lp63761
VIf I had to guess, I'd say that the debugger ran it once to show the members of a local variable in the IDE
p63762
aVIf you have side effects in properties (which you shouldn't), don't run it in the IDE :)
p63763
aVTry it at the console; it should behave itself there
p63764
as(dp63765
g18
V23354
p63766
stp63767
a((dp63768
g2
(lp63769
VThe key here is the table in "1
p63770
aV4 Expressions", and "7
p63771
ag9575
aV1 Operator precedence and associativity"
p63772
aVI won't duplicate the table from 1
p63773
aV4, but to quote 7
p63774
ag9575
aV1:
p63775
aVExcept for the assignment operators,
p63776
aVall binary operators are
p63777
aVleft-associative, meaning that
p63778
aVoperations are performed from left to
p63779
aVright
p63780
aVFor example, x + y + z is
p63781
aVevaluated as (x + y) + z
p63782
aVThe
p63783
aVassignment operators and the
p63784
aVconditional operator (
p63785
aV:) are
p63786
aVright-associative, meaning that
p63787
aVoperations are performed from right to
p63788
aVleft
p63789
aVFor example, x = y = z is
p63790
aVevaluated as x = (y = z)
p63791
aVThe first is logically expanded (or: use the associativity rules) as:
p63792
aVhere, the order (from the table) is pre-increment, then additive, then assignment - so we should expect i to double plus one
p63793
aVAnd indeed, with , we get 13 as expected
p63794
aVagain from the table, order should be array access, pre-increment, assignment - so I would expect the i+1'th value to be i+1
p63795
aVAnd indeed, checking:
p63796
aVwe do indeed get
p63797
aVWith the last, method invocation takes priority over subtraction, then it is left-to-right; so it should be , , , assignment
p63798
as(dp63799
g18
V23354
p63800
stp63801
a((dp63802
g2
(lp63803
VIf you have the modified binary contents you can use
p63804
aVHowever, you can't modify a loaded assembly - you'd have to handle the modifications separately
p63805
aVYou might also want to look at running this in a separate  if you are doing it repeatedly (if doing it just once, you probably don't need to)
p63806
as(dp63807
g18
V23354
p63808
stp63809
a((dp63810
g2
(lp63811
VThe problem is the first argument in  - it simply isn't defined
p63812
aVIf this is meant to be the value the user has entered, then you need to add a parameter to the command and use that parameter in the SQL; for example:
p63813
aVAn then use
p63814
aVin the TSQL
p63815
aVAlso, generally you might want to have the system generate the unique id
p63816
aVA the simplest level this could have an  defined (an automatic sequence)
p63817
as(dp63818
g18
V23354
p63819
stp63820
a((dp63821
g2
(lp63822
VThe rules here are very complex, and between CLR 2
p63823
aV0 and CLR 4
p63824
aV0 they actually changed in subtle and interesting ways, that IMO make most "clever" approaches brittle between CLR versions
p63825
aVAn  method also might not do the job in CLR 4
p63826
aV0 if it doesn't touch the fields
p63827
aVI would look for an alternative design, or perhaps use regular lazy initialization in your type (i
p63828
ag50
aVcheck a bit or a reference (against ) to see if it has been done)
p63829
as(dp63830
g18
V23354
p63831
stp63832
a((dp63833
g2
(lp63834
Vany of:
p63835
aVor
p63836
aVor:
p63837
as(dp63838
g18
V23354
p63839
stp63840
a((dp63841
g2
(lp63842
VThis sounds simply like a bug in "DotNetZip" - have you tried SharpZipLib or ZipPackage (in the BCL)
p63843
aVEncoding typically relates to the file contents, not the name; so this shouldn't be a factor
p63844
aVYou should report this (with an example) to the author
p63845
as(dp63846
g18
V23354
p63847
stp63848
a((dp63849
g2
(lp63850
VNear the
p63851
aVwell,  is a SQL reserved word, so try simply:
p63852
aVto tell it that  is an object name, not the SQL keyword
p63853
as(dp63854
g18
V23354
p63855
stp63856
a((dp63857
g2
(lp63858
VIf multiple threads try to access (simultaneously) the file at  - isn't that doomed from the start
p63859
aVYou might want to read the contents into memory first and write from there
p63860
aVEqually, you are going to hammer the IO; I wonder if a more practical answer (that solves the issue above and below) is to simply do the copies sequentially on the worker
p63861
aVIt also looks like you might actually be pushing all the work here back to the UI thread anyway
p63862
aVsurely you should do something like:
p63863
aVwhich:
p63864
aVavoids the foreach/capture issue ( is not captured)
p63865
aVreads the path from the UI thread and uses it (captured) on the worker
p63866
aVprocess each file sequentially to avoid hammering IO
p63867
aVYou also have the foreach/capture issue; change it to:
p63868
aVThe problem is that most likely all the threads are trying to access the last file
p63869
aVNo, really
p63870
aVThis is because  technically declares the variable ( above) outside the loop; and the variable capture rules (used by lambdas / anon-methods) say that therefore this is the same variable (important: lambdas / anon-methods are full lexical closures, and capture the variable, not the value)
p63871
aVRe-declaring a variable inside the loop changes the scope, and now the lambda / anon-method treats the variable as different per loop iteration
p63872
aVIf you really want, I could write it out in something that shows the underlying objects involved, but it depends whether you want that level of detail ;p
p63873
as(dp63874
g18
V23354
p63875
stp63876
a((dp63877
g2
(lp63878
VInstance methods always take precedence over extension methods, so no
p63879
aVThe correct thing to do here would appear to be polymorphism - but note that  doesn't provide  methods
p63880
aVdoes, though:
p63881
as(dp63882
g18
V23354
p63883
stp63884
a((dp63885
g2
(lp63886
VAdding  in the subclass is re-declaring the method (method-hiding; you probably get a warning about that)
p63887
aVIt will behave the same if you access it as:
p63888
aVbut now add:
p63889
aVWith polymorphism (via ) they should do the same thing
p63890
aVBut via method-hiding they won't
p63891
aVTo explicitly hide a method, use :
p63892
aVor to stop something being overridden any further, use :
p63893
as(dp63894
g18
V23354
p63895
stp63896
a((dp63897
g2
(lp63898
VYou can look at MonoDroid which runs inside Visual Studio (it should also be available inside MonoDevelop when it is released)
p63899
aVIt is currently in limited preview, but it is pretty stable now
p63900
as(dp63901
g18
V23354
p63902
stp63903
a((dp63904
g2
(lp63905
VWhy regex
p63906
as(dp63907
g18
V23354
p63908
stp63909
a((dp63910
g2
(lp63911
VYou should be able to use a nullable type just normally as long as the values aren't null - but you can't use  (or an empty ) as a key - it simply can't work
p63912
aVIt would make more sense to ensure (in the calling code) that  always returns something non-null; in the case of  perhaps by calling  (if you see what I mean)
p63913
aVAnother approach would be to declaratively preclude  here, by adding  - but since  is a common key (and is a reference-type) this may be an undesirable approach
p63914
as(dp63915
g18
V23354
p63916
stp63917
a((dp63918
g2
(lp63919
VYour  currently returns the same string for each (the property name); and since LINQ is typically a stable sort, this results in no overall change
p63920
aVSince you have already projected to the string values, you can simply use a trivial  mapping here:
p63921
aVto order by the items themselves
p63922
as(dp63923
g18
V23354
p63924
stp63925
a((dp63926
g2
(lp63927
VNo,  doesn't need /, because you should already be using it via , and the last step (as per the example) should be to mark it completed
p63928
aVIf it hits  without being completed, then it rolls back
p63929
aVRe your bullets:
p63930
aVyou don't, unless you have a very specific reason to handle that exception; I have never had to handle that scenario in a specific way - it is so unexpected that I'm happy for it to bubble up as a genuine exceptional event
p63931
aVstoring your own open connection is not a great idea here - in addition to the potential threading issues, and having unnecessary open connections: you're ignoring the fact that there is already connection pooling built in by default (at least, with SQL Server)
p63932
aVMeaning : you create/open a new  as you need it (tightly scoped) and the pool worries about actual connections - you are potentially adding overhead here, but gaining very little (it is very quick to find an existing connection in the pool)
p63933
aVIf you check carefully, you'll probably notice that even when you  your connection, the db-server reports it in use; that is because your  merely put it back into the pool for re-use
p63934
aVnothing much; the transaction should be ACID
p63935
as(dp63936
g18
V23354
p63937
stp63938
a((dp63939
g2
(lp63940
VFor WCF, the normal process is to annotate the class with , an each property with , which has an optional  property
p63941
aVNote that by adding the class-level attribute you are saying "I will explicitly tell you which members to serialize; you can't then just annotate the one you want to rename
p63942
as(dp63943
g18
V23354
p63944
stp63945
a((dp63946
g2
(lp63947
VCollection initialisers allow much of that;
p63948
aVAnother way to approach this is to pass just  an use reflection, passing (for example):
p63949
aVA nice feature of the last option is that you can also pass in your domain entities, and you can perhaps use richer metadata (attributes etc) - but when used in high volume reflection by itself can be slow unless you take steps to optimise for it
p63950
aVIf you aren't using it in a tight loop it should be ok even with reflection (and without optimisation)
p63951
as(dp63952
g18
V23354
p63953
stp63954
a((dp63955
g2
(lp63956
VRight; the problem is that this isn't just protobuf - it is a hybrid file format (defined here that includes protobuf among various formats internally
p63957
aVIt also incorporates compression (although that looks to be optional)
p63958
aVI've pulled apart what I can from the spec, and I've got a C# reader here that uses protobuf-net to handle the chunks - it happily reads through that file to the end - I can tell you there are 4515 blocks ()
p63959
aVWhen it gets to the  I'm a bit confused as to how the spec demarks  and  - I'm open to suggestions here
p63960
aVI've also used ZLIB
p63961
aVNET to handle the zlib compression that is being used
p63962
aVIn the absence of getting my head around this, I've settled for processing the ZLIB data and validating it against the claimed size, to check it is at least sane
p63963
aVIf you can figure out (or ask the author) how they are separating  and  I'll happily crank something else in
p63964
aVI hope you don't mind that I've stopped here - but it has been a few hours ;p
p63965
as(dp63966
g18
V23354
p63967
stp63968
a((dp63969
g2
(lp63970
VEDIT: See the answers by Leppie and Gabe; the only reason I'm keeping this (rather than deleting it) is that it may be necessary if you suspect the length is > 4GB
p63971
aVFor gzip, that data doesn't seem to be directly available - I've looked at  and the SharpZipLib equivalent - neither works
p63972
aVThe best I can suggest is to run it locally:
p63973
aVIf it was a zip, then SharpZipLib:
p63974
as(dp63975
g18
V23354
p63976
stp63977
a((dp63978
g2
(lp63979
VTo do this you need to use reflection:
p63980
aV(assuming that  is a static method on the type )
p63981
aVIf  is actually an object, you'll need to know where the  method is actually declared, and pass in  as an argument:
p63982
as(dp63983
g18
V23354
p63984
stp63985
a((dp63986
g2
(lp63987
VTo try to force it to load in CLR 2
p63988
aVx, you may need to have (in your app
p63989
aVconfig file):
p63990
aVThis is generally only required when you have mixed-mode, and forces the hand of the loader
p63991
as(dp63992
g18
V23354
p63993
stp63994
a((dp63995
g2
(lp63996
VThere is a default xml namespace; you can fix this by adding  to tell it the namespace to expect:
p63997
as(dp63998
g18
V23354
p63999
stp64000
a((dp64001
g2
(lp64002
VYou should see a compiler message:
p64003
aVThe name 'Add' does not exist in the current context
p64004
aVwhich tells you that it has no clue which  method you are talking about;  is a static method in  - so you need:
p64005
aVstatic methods aren't globally available; you can access static methods from the current type (and from base-types) via just their name, but if it is an unrelated type you need to qualify it with the declaring-type
p64006
aVAt this point it will give you a compiler error:
p64007
aVDelegatePrac
p64008
aVSome
p64009
aVAdd(int, int)' is inaccessible due to its protection level
p64010
aVwhich hints that it is a private method; so add  (or ) to them:
p64011
as(dp64012
g18
V23354
p64013
stp64014
a((dp64015
g2
(lp64016
VYou can't override and re-declare (to add the set) at the same time - but you can do:
p64017
aVBase class:
p64018
aVDerived class:
p64019
aVNow you can also override FooImpl as needed
p64020
as(dp64021
g18
V23354
p64022
stp64023
a((dp64024
g2
(lp64025
VA captured variable (the first case with ) is typically a  representing the capture class instance, with a  to a  for the "variable" - as if you had:
p64026
aVHere,  is the constant inside the expression
p64027
aVSo: if you see a  (of a field) to a , it is probably a captured variable
p64028
aVYou could also check for  on the capture-class
p64029
aVA literal constant will typically just be a ; in fact, it would be hard to think of a scenario where you use a constant's member, unless you could something like:
p64030
aVbut here  is a property (not a field), and the string probably doesn't have
p64031
as(dp64032
g18
V23354
p64033
stp64034
a((dp64035
g2
(lp64036
Vgzip won't directly help with serialization - it will just (attempt to) shrink a stream
p64037
aVThis may help, or not, depending on the amount of duplicated data in the stream
p64038
aVFor dense data with little text, I've seen gzip increase the size of the payload
p64039
aVPersonally I would look at protocol buffers here (but I'm biased, as I'm one of the authors of the many extensions)
p64040
aVYou typically (but not always) define the messages in a basic language (a
p64041
aVproto file), and run language-specific tools to generate the classes
p64042
aVPerformance is very good - focusing on
p64043
aVNET it can far exceed the inbuilt serializers (1 2 3 )
p64044
as(dp64045
g18
V23354
p64046
stp64047
a((dp64048
g2
(lp64049
VNo, there's no such thing as a destructor for a static class, but you can do something like:
p64050
aVRe "Why is this memory not getting released when the program ends" - if you mean exiting the browser, the server won't even notice that
p64051
aVIt will get cleaned when the app-pool (in IIS) dies
p64052
as(dp64053
g18
V23354
p64054
stp64055
a((dp64056
g2
(lp64057
VThere is an important step to save space:
p64058
aVOtherwise it internally uses xml, even via
p64059
aVWith this in place, you can also include gzip, but the gain isn't quite as significant
p64060
aVAs it happens I have some stats to compare this here; to copy that data in:
p64061
aVBut:  is not a very WCF way of doing things
p64062
aVI would add standard OO classes, and swap the serializer for something like protobuf-net, which is significantly smaller than either  or
p64063
as(dp64064
g18
V23354
p64065
stp64066
a((dp64067
g2
(lp64068
VData-binding and observing change relies on change-notification events; either  (for property ) or  typically (although custom implementations are possible)
p64069
aVdoes not provide such; you may be better off using a  instead, to update the UI every so often
p64070
aVJust store the  when you start, and whenever the timer fires calculate the offset from then to now
p64071
as(dp64072
g18
V23354
p64073
stp64074
a((dp64075
g2
(lp64076
VYou can check
p64077
aVOtherwise, maybe  and look  for it
p64078
aV(where )
p64079
as(dp64080
g18
V23354
p64081
stp64082
a((dp64083
g2
(lp64084
VYes, VS 2010 (and VS2008) are multi-targetting, and can target any of those (and ideally stop you doing something stupid like include a reference that doesn't exist in your target platform)
p64085
aVHowever
p64086
aVThere are some internal bug-fixes / changes / etc, which mean that somebody running 2
p64087
aV0 sees a different result to someone running 2
p64088
aV0 SP2 (because they've got later runtimes installed)
p64089
aVThere are even some types that exist in SP2 and not earlier
p64090
aVSo you may want to test on a vanilla 2
p64091
aV0 machine if you need to support that
p64092
aVIt may not be enough (in some edge cases) to just target 2
p64093
aV0 but test on a fully-up-to-date machine
p64094
as(dp64095
g18
V23354
p64096
stp64097
a((dp64098
g2
(lp64099
VTo sort inside an existing array, call
p64100
aVRe your comment on interfaces: you don't need to add any interfaces here, since  is well supported; but for custom types (of your own) you can implement  /  to enable sorting
p64101
aVYou can also do the same passing in an  / , if you want (or need) the code that provides the ordering to be separate to the type itself
p64102
as(dp64103
g18
V23354
p64104
stp64105
a((dp64106
g2
(lp64107
VThe difference is that in the related question it is talking about an untyped value (i
p64108
ag50
aV) via an indexer
p64109
aVWhen you go via , the type is already included - so this could be  etc
p64110
aVAnd it wouldn't make sense to try  on an , as an  can never be
p64111
aVEssentially the  is a wrapper for (excuse the C# accent
p64112
aVI'm not a huge  person, but you could try checking it by name/index/column; or marking the column as nullable so that it is  (in the example above)
p64113
as(dp64114
g18
V23354
p64115
stp64116
a((dp64117
g2
(lp64118
s(dp64119
g18
V23354
p64120
stp64121
a((dp64122
g2
(lp64123
VIt depends entirely on the data;
p64124
aVif the data is immutable (or mutable but you don't actually mutate it), then chuck all the threads at it - great
p64125
aVif you need to mutate it, but no two threads will ever depend on the data mutated by another - great
p64126
aVif you need to mutate it, and there are conflicts but you can sensibly synchronize access to the data such that there is no risk of two threads deadlocking etc - great, but not always trivial
p64127
aVif it is not safe to make any assumptions, then a true clone of the data is the safest approach, but has the most overhead in terms of data duplication; if the data is cheap to copy, this may be fine - and indeed may outperform synchronization
p64128
aVif the threads do co-depend on each other, then you have no option other than to figure out some kind of sensibly locking strategy; again - to stress: deadlocks are a problem here - some ideas:
p64129
aValways provide a timeout when obtaining a lock
p64130
aVif you need to lock two items, it may help to try locking both eagerly (rather than locking one at the start, and the other after you've done lots of changes) - then you can simply release and re-take the locks, without having to either undo changes, or put the changes back into a particular state
p64131
as(dp64132
g18
V23354
p64133
stp64134
a((dp64135
g2
(lp64136
VThere is no way of generating a compile-time error for this
p64137
aVHowever, you could do something with reflection, in either your unit tests or the  build - simply iterate over the properties, checking
p64138
as(dp64139
g18
V23354
p64140
stp64141
a((dp64142
g2
(lp64143
VYou can do this by providing a custom type-model; at the simplest level, you can provide a custom  for your type derived from , and simply include/exclude the given property at whim - but this only works with  - used by the properties page
p64144
aVA more complex approach is to use  /  - this can then work inside things like
p64145
as(dp64146
g18
V23354
p64147
stp64148
a((dp64149
g2
(lp64150
VHard to tell without seeing , but by default to be useful, each member:
p64151
aVmust be public
p64152
aVmust be a property (not a field)
p64153
aVmust not be marked
p64154
aVThe issue here is usually one of the first two
p64155
aVFor example, none of these will work by default:
p64156
aVbut this will:
p64157
aVNote that it doesn't have to be an automatically implemented property, nor does it need to be writeable:
p64158
as(dp64159
g18
V23354
p64160
stp64161
a((dp64162
g2
(lp64163
VRuntime property models are an advanced topic
p64164
aVFor PropertyGrid the easiest route would be to write a TypeConverter, inheriting from ExpandableObjectConverter
p64165
aVOverride GetProperties, and swap the property in question for a custom one
p64166
aVWriting a PropertyDescriptor from scratch is a chore; but in this case you mainly just need to chain ("decorator") all the methods to the original (reflective) descriptor
p64167
aVAnd just override IsReadOnly to return the bool you want
p64168
aVBy no means trivial, but achievable
p64169
as(dp64170
g18
V23354
p64171
stp64172
a((dp64173
g2
(lp64174
VI you have used BinaryFormatter, then note that this is a field serializer, not a property serializer; you can hack around it by not changing the field names
p64175
aVUnless it is an auto implemented property, in which case you can't
p64176
aVTo be honest, BinaryFormatter is a poor choice if you want the flexibility to mutate the types
p64177
aVA contract-based serializer is much more flexible here
p64178
aVFor example, XmlSerializer and DataContractSerializer allow ou to control the names via an attribute
p64179
aVIf you want binary, I would go with protobuf-net (perhaps because I wrote it
p64180
aV- here there are no names - just numeric identifiers
p64181
aVBut the protobuf format was designed by Google specifically to allow painless upgrade of APIs
p64182
aVOf course, you might also look at a DTO as permenant contract; in which case consider having a v1 DTO, a v2 DTO etc
p64183
aVNot the way I tend to do it myself, but definitely an option
p64184
as(dp64185
g18
V23354
p64186
stp64187
a((dp64188
g2
(lp64189
VYou have two variables ( and ) which, at the time when you call , point at the same object
p64190
aVThus a change to the object pointed to by  is also a change to the object pointed to by
p64191
aVThe table you create with  is simply discarded onto the heap (waiting to be garbage-collected) when you assign
p64192
as(dp64193
g18
V23354
p64194
stp64195
a((dp64196
g2
(lp64197
VPersonally I doubt that this is XDocument
p64198
aVThe first thing I would do is attach a network tool such as Fiddler to see what came over the wire
p64199
aVIn particular I wonder if you are being throttled by a NLB or similar
p64200
aVIf nothing obvious in there, I would split it into step steps; download as XML (maybe WebClient DownloadString) and then parse the XML locally
p64201
aVThe advantage here is that you can add some try/catch so that if/when it fails you log the response string you got, for analysis
p64202
aVIf you do this, and it starts behaving, then that might suggest a bug in XDocument
p64203
aVLoad; likewise if you do this and it fails but all responses were well-formed XML, then similar - a bug in Parse
p64204
aVBut it should also rule out (or identify) a network-related cause
p64205
as(dp64206
g18
V23354
p64207
stp64208
a((dp64209
g2
(lp64210
VThe threads will be independent
p64211
aVTo push work between them you need either a basic synchronised queue, or something like the Control
p64212
aVInvoke method
p64213
aVTo wait until anothe thread has exited, you can use:
p64214
aVBut in many ways the event approach is cleaner
p64215
aVBut the ever will be on the other thread, so you may well need to switch back (for example) to a UI thread as mentioned above
p64216
as(dp64217
g18
V23354
p64218
stp64219
a((dp64220
g2
(lp64221
VIf the object that you have (as ) also implements  then you may be in luck, but in the general-case: no
p64222
aVExcept perhaps for that corner-case it is then too late, and you can no-longer "compose" the query (i
p64223
ag50
aVadd a "where" condition that will be handled by the DB)
p64224
aVInstead, what you have is LINQ-to-Objects doing what it can to look queryable
p64225
aVBut th data will be consumed linearly from the underlying enumerable
p64226
as(dp64227
g18
V23354
p64228
stp64229
a((dp64230
g2
(lp64231
VIn addition to the other answers,  is probably the closest thing to
p64232
as(dp64233
g18
V23354
p64234
stp64235
a((dp64236
g2
(lp64237
VVariance doesn't work that way around; you would need
p64238
aVAs even in 4
p64239
aV0 it won't believe that every object is a string
p64240
aVNote that if it was  and  (i
p64241
ag50
aVthe other way around) it probably would work (in 4
p64242
aV0), since every string is an object
p64243
as(dp64244
g18
V23354
p64245
stp64246
a((dp64247
g2
(lp64248
VI'll wager this is not a data-reader issue
p64249
aVMy guess would be that one or more user accounts is using a more-specific (and older) copy of the sproc (etc) - for example Fred
p64250
aVMyProc instead of dbo
p64251
aVMyProc, or there is conditional branching logic in the sproc that returns different columns in some cases - maybe a branch of code you forgot to update
p64252
aVAnother potential issue is perhaps different case-sensitivity in the DB causin different objects to be used; i
p64253
ag50
aVMyproc vs MyProc - which can be different if the DB is case-sensitive
p64254
aVTo find out for sure, attach a SQL trace to log exactly what (and by whom) is sent for the failing cases; then repro that in something like SSMS, comparing dev to prod
p64255
as(dp64256
g18
V23354
p64257
stp64258
a((dp64259
g2
(lp64260
VYou could capture it outside:
p64261
aVOther than that; no
p64262
as(dp64263
g18
V23354
p64264
stp64265
a((dp64266
g2
(lp64267
V is best avoided - there is an edge case that some other unrelated code could also lock it, perhaps causing even a deadlock
p64268
aVA better approach is:
p64269
aVAnd then  - since this is private you avoid this edge-case
p64270
aVAnother strategy is to load all the data into an immutable encapsulated object; then you can swap everything by updating a single reference; and a reference assignment is guaranteed to be atomic
p64271
aVThis allows:
p64272
aVThis works best if you always take a snapshot, i
p64273
ag50
aVInstead of
p64274
aVYou use:
p64275
aVSince now we know that Foo and Bar are from the same model
p64276
as(dp64277
g18
V23354
p64278
stp64279
a((dp64280
g2
(lp64281
VCalling Dispose() doesn't clear the references to the object
p64282
aVIf dc is a field, then a simple way to handle this that works for all diaposable classes would be to manually assign  immediately after you call Dispose()
p64283
aVThis also means that the data-context can be eligible for garbage-collection even if your class lives for much longer
p64284
aVIf dc is a local variable, just use:
p64285
as(dp64286
g18
V23354
p64287
stp64288
a((dp64289
g2
(lp64290
VThis might need slights tweaks (I'm not at a PC) - but something like:
p64291
as(dp64292
g18
V23354
p64293
stp64294
a((dp64295
g2
(lp64296
VI would do it the other way around - treating the first as the exception is simpler:
p64297
aVor in
p64298
aVNET 4
p64299
aV0 just use:
p64300
aVor even better, if this is SQL - switch to
p64301
as(dp64302
g18
V23354
p64303
stp64304
a((dp64305
g2
(lp64306
VEdit; if the properties are actually , i
p64307
ag50
aVnot , then:
p64308
aV(this now copes with all of ,  and
p64309
as(dp64310
g18
V23354
p64311
stp64312
a((dp64313
g2
(lp64314
VYou can associate  s to existing types like:
p64315
aV(somewhere during startup)
p64316
aVThen to get the converter, the standard code should work:
p64317
aVor:
p64318
as(dp64319
g18
V23354
p64320
stp64321
a((dp64322
g2
(lp64323
VLike this
p64324
as(dp64325
g18
V23354
p64326
stp64327
a((dp64328
g2
(lp64329
VIt depends on what the intent is
p64330
aVThe get/set of the list is atomic (even without volatile) and non-cached (volatile), but callers can mutate the list, which is not guaranteed thread-safe
p64331
aVThere is also a race condition that could lose data:
p64332
aVHere value could easily be discarded
p64333
aVI would use an immutable (read-only) collection
p64334
as(dp64335
g18
V23354
p64336
stp64337
a((dp64338
g2
(lp64339
VThe normal way is to simply shim it with a property that behaves as you expect:
p64340
aValso, you would need:
p64341
aVHere's a complete example with your xml:
p64342
as(dp64343
g18
V23354
p64344
stp64345
a((dp64346
g2
(lp64347
VThis is baked directly into :
p64348
aVor in C# 2
p64349
aV0:
p64350
aVIn the non- case (your edit to the question), you could wrap this something like below (untested):
p64351
aVSince  implements the (non-generic)  this should work
p64352
aVAnd quite conveniently, with C# 3
p64353
aV0 you can add a  before  /  and have it as an extension method
p64354
aVThe only subtlety is that the parameter to the anon-method will be , so you'll need to cast it away
p64355
as(dp64356
g18
V23354
p64357
stp64358
a((dp64359
g2
(lp64360
VNo, there isn't
p64361
aVStick with what you have
p64362
aVWell, you could write a  (maybe with overloads for 2/3/4/5 operands to avoid the array creation), but I'm not sure it is worth it most times
p64363
as(dp64364
g18
V23354
p64365
stp64366
a((dp64367
g2
(lp64368
VSomething like:
p64369
as(dp64370
g18
V23354
p64371
stp64372
a((dp64373
g2
(lp64374
VThe issue with a single  is that you might be passing it (directly, or indirectly via async code / callbacks) to multiple threads
p64375
aVAnd since  isn't thread-safe you would need to trust that code to synchronize
p64376
aVIf you can't trust the code, write a wrapper around the  that does the synchronization for you, or maybe use a  /  instance
p64377
aVNote also that random isn't quite the same thing as unique
p64378
aVHowever, if you declare it in a method - then any tight loop is virtually guaranteed to generate the same value for each loop iteration - i
p64379
ag50
aVif  spins up a , you will most likely see duplicate values
p64380
as(dp64381
g18
V23354
p64382
stp64383
a((dp64384
g2
(lp64385
VJon's version is largely a port of the Java version, so has a very similar API and design approach
p64386
aVIt is also AFAIK entirely contract-first, i
p64387
ag50
aVfrom
p64388
aVproto
p64389
aVMy version comes at it more from a
p64390
aVNET perspective, looking at what is common in
p64391
aVNET serializers - so mutable objects, retrofit to existing types, code-first (although it can still do code-gen from a
p64392
aVproto if you want), etc
p64393
aVIt can even infer data from the attributes used by  and  to work side-by-side with existing code, and can plug into both remoting (via ) and WCF (via attributes or configuration)
p64394
aVSo it is deeply rooted in the
p64395
aVNET ecosystem
p64396
aVI also include inheritance support (since that is so common in the other
p64397
aVNET serializers), but this is a bit fiddly to map to other platforms since it has no direct representation in
p64398
aVproto
p64399
aVThe binary data should be identical; that is largely the point of the format ;p It is largely a choice of which API might be more appropriate to you
p64400
aVFor your needs, working side-by-side with C++ and Java code in the same system, and with existing
p64401
aVproto definitions, I suggest Jon's version may be the most appropriate option for you
p64402
aVIf, however, you are doing
p64403
aVNET only, or are doing
p64404
aVNET with interop with external code (i
p64405
ag50
aVyou don't care what language the "other side" uses, since you only have to worry about your own code), then IMO protobuf-net can be a pretty pain free way to consume the data; especially if you have an existing system that you now find you want to serialize (or: serialize faster / smaller)
p64406
as(dp64407
g18
V23354
p64408
stp64409
a((dp64410
g2
(lp64411
VBecause it is  - i
p64412
ag50
aVbitwise / non-short-circuiting "and"
p64413
aVFor  you want
p64414
aVSee also  () vs  ()
p64415
aVAlso, note that
p64416
aV= C# - it is language independent, so you might also see some cases where you don't get back (visually) what you would expect from C#
p64417
as(dp64418
g18
V23354
p64419
stp64420
a((dp64421
g2
(lp64422
VLINQ-to-SQL sits in that nether-world between data in the database and objects held locally
p64423
aVAt that point, you haven't submitted the changes to the database () - they only exist locally
p64424
aVis executed at the database (i
p64425
ag50
aV) - and so the answer is 0
p64426
aVIt would be insanely hard (in the general case) to attempt to marry up the local deltas against the database world, so in short: don't do that
p64427
aVIt won't work
p64428
as(dp64429
g18
V23354
p64430
stp64431
a((dp64432
g2
(lp64433
VThe C# spec talks about this, and the same truths essentially apply to CIL too; basically, all the integer types up to 4 bytes are guaranteed atomic, and any reference reads/writes are guaranteed atomic
p64434
aVHowever, outside that no guarantees are made;  is not guaranteed atomic, for example - here  may be helpful
p64435
aVTo quote from ECMA 335 (Common Language  Infrastructure (CLI) Partitions I to VI)
p64436
aV12
p64437
ag29307
aV6 Atomic  reads  and writes
p64438
aVA conforming CLI shall guarantee that
p64439
aVread and write access to properly
p64440
aValigned memory locations no larger
p64441
aVthan the native word size (the size of
p64442
aVtype native int) is atomic (see
p64443
aV12
p64444
ag29307
aV2) when all the write accesses
p64445
aVto a  location are the same size
p64446
aVAtomic writes shall alter no bits
p64447
aVother than those written
p64448
aVUnless
p64449
aVexplicit layout  control (see
p64450
aVPartition II (Controlling Instance
p64451
aVLayout)) is used to alter the default
p64452
aVbehavior, data elements no  larger
p64453
aVthan the natural word size (the size
p64454
aVof a native int) shall be properly
p64455
aValigned
p64456
aVObject references shall  be
p64457
aVtreated as though they are stored in
p64458
aVthe native word size
p64459
aV[Note: There is
p64460
aVno guarantee about atomic update
p64461
aV(read-modify-write) of memory, except
p64462
aVfor methods provided  for that purpose
p64463
aVas part of the class library (see
p64464
aVPartition IV)
p64465
aVAn atomic write of a
p64466
aV\u2015small data item\u2016 (an item  no larger
p64467
aVthan the native word size) is required
p64468
aVto do an atomic read/modify/write on
p64469
aVhardware that does not  support direct
p64470
aVwrites to small data items
p64471
aVend note]
p64472
aV[Note: There is no guaranteed atomic
p64473
aVaccess to 8-byte data when the size of
p64474
aVa native int is 32 bits even  though
p64475
aVsome implementations might perform
p64476
aVatomic operations when the data is
p64477
aValigned on an 8-byte  boundary
p64478
aVend
p64479
aVnote]
p64480
aVSince  must be at least 32 bits, that is the most guarantee it can offer
p64481
as(dp64482
g18
V23354
p64483
stp64484
a((dp64485
g2
(lp64486
VThat interface was added to System
p64487
aVdll in a service pack; 2
p64488
aV0 SP 1 (also shipped with
p64489
aVNet 3
p64490
aV5); http://msdn
p64491
aVmicrosoft
p64492
aVcom/en-us/library/system
p64493
aVcomponentmodel
p64494
aVinotifypropertychanging(v=VS
p64495
aV90)
p64496
aVaspx
p64497
aVIt cannot work on vanilla 2
p64498
ag190
aVEither install the 2
p64499
aV0 SP 1 service pack (or 3
p64500
aV5), or live without it
p64501
as(dp64502
g18
V23354
p64503
stp64504
a((dp64505
g2
(lp64506
VWhy do you say no data loss
p64507
aVNot all enums are ints, after all
p64508
aVThey must be integer-typed, but that can mean byte, ulong, etc
p64509
aVAs a corner-case the literal 0 is implicit, but; what would be your use-case here
p64510
aVIt is pretty rare I need to do this - usually data import etc
p64511
aVAn occasional no-op cast makes perfect sense to me, and avoids accidental mistakes
p64512
as(dp64513
g18
V23354
p64514
stp64515
a((dp64516
g2
(lp64517
VI'm willing to bet (OK, I also have the advantage of having the source code
p64518
aVthat in most cases this code is called as per you your examples in your reply
p64519
aVor
p64520
aVIn which case you are using generic type inference
p64521
aVBut there is another, simpler, thing that would compile there
p64522
aVdon't use generics
p64523
aVI expect there are only a few scenarios here; so write a few classes / method-overloads - one for , one for , etc
p64524
aVSure, there will be a little duplication, but the compiler will be able to optimise for each individual scenario - no boxing
p64525
aVYou could even (if you choose) replace the  with something like  (for the  case)
p64526
aVAnother option (given your examples) is to make the memoized object generic:
p64527
aVand push the  code up a level, so that is done in a cast
p64528
as(dp64529
g18
V23354
p64530
stp64531
a((dp64532
g2
(lp64533
VI see what you are getting at, but in my experience it is a much better idea to concentrate on serializing data, and handle the durability by rolling back/forward to a known state, perhaps using something like a local CQRS queue, or some other way of storing "how you got there"
p64534
aVRe the specific question, within the tight scope of the question (only working on the same build etc) I guess that should be OK, but it depends a lot on whether anything that is captured in those variables has no sensible serialization - i
p64535
ag50
aVsomething like a UI element (easily accidentally captured with an invisible ) that cannot be reconstructed (os handles, etc)
p64536
aVIf it is isolated data (by which I mean: the graph is just data from within your own code - no unmanaged dependencies), then I guess it should be OK
p64537
aVThe other issue is that CF lacks much of the stronger reflection available in the full framework, that might make this a bit more awkward than it might be on regular framework ( for example)
p64538
aVProbably doable, but a bit more work
p64539
as(dp64540
g18
V23354
p64541
stp64542
a((dp64543
g2
(lp64544
VIn short, no
p64545
aVAt least, not with anonymous types
p64546
aVThere are two approaches here;  might give you what you want, but is fiddly for combining
p64547
aVOther than that, a basic property bag - even simply  would do
p64548
aVThe only difference being that:
p64549
aVbecomes
p64550
aVThere is a more fundamental problem, though, in trying to combine a list (each of which is largely anonymous) with properties in a single step
p64551
aVYou can do this for data-binding purpose via custom property models, but it is
p64552
aVtricky
p64553
as(dp64554
g18
V23354
p64555
stp64556
a((dp64557
g2
(lp64558
VThe first line is a boxing operation that creates a boxed copy of the integer 5
p64559
aVThe reference to this new object is stored in X
p64560
aVIn the second line, the value of the reference (which is broadly the address, but addresses and references are logically different) is copied into A, as this is just a "ldloc,stloc" copy
p64561
aVThere is only a single object in this scenario; the boxed object created in the first line
p64562
as(dp64563
g18
V23354
p64564
stp64565
a((dp64566
g2
(lp64567
VIt is performing a bitwise flag test -  could return a number of flags (in different bits) indicating different properties
p64568
aVThe  restricts the s to just those that are present in  (I would expect this to be a single bit)
p64569
aVAs it happens, this is , i
p64570
ag50
aV(binary)
p64571
aVif the  has  (=1),  (=2) and  (=16) it would be:
p64572
aVwe & with 16
p64573
aVleaving
p64574
aVhence the directory test passes
p64575
aVIf instead the source has  (=4) and  (=1) (and not directory) it will be:
p64576
aVwe & with 16
p64577
aVleaving
p64578
aVhence the directory test fails
p64579
aVAs a side note; an  in such a test verifies that all the required flags were set (if multiple bits were in the second operand)
p64580
aVAnother common test is , which tests whether any bits were present
p64581
as(dp64582
g18
V23354
p64583
stp64584
a((dp64585
g2
(lp64586
V is not really a data-contract, and there is no supported implementation in "v1" (the code available as pre-built dll)
p64587
aVI have, however, done some playing in "v2" here that may be of interest, including a range of metrics for comparison / decision-making
p64588
as(dp64589
g18
V23354
p64590
stp64591
a((dp64592
g2
(lp64593
VBoth of the existing answers focus on "cross platform", but that is an unrelated issue
p64594
aVThe point they are making there is "don't use  if you are doing cross-platform" - which I entirely support
p64595
aVHowever there are a range of binary serialization formats that are very much cross-platform - protobuf / ASN
p64596
aV1 being prime examples
p64597
aVSo, let's look instead at what each has to offer;
p64598
aVBinary is typically smaller, typically faster to process (at both ends), and not easily human readable / editable
p64599
aVText formats (xml / json) tend to be more verbose than binary (although often compresses well), but are pretty easy to work with by hand; but all that text processing an mapping tends to make them slower
p64600
aVxml is very common is web-services, and benefits from gooling support such as xsd, xslt and robust xml editors
p64601
aVjson is the main player in browser-based comms (although it is also used in web-services) - tends to be less formal but still very effective
p64602
aVNotice how interoperability is neither a strength nor weakness of either, as long as you choose an appropriate binary format
p64603
aVHere's an answer that compares the serialization time, deserialization and space metrics of most of the
p64604
aVNET serializers, for your reference
p64605
as(dp64606
g18
V23354
p64607
stp64608
a((dp64609
g2
(lp64610
V should work inside the  type (but that isn't what you have here)
p64611
aVIn the "method hiding" scenario (what you have), it also largely depends on what a variable is typed as, so casting to  should work:
p64612
aVor more succinctly:
p64613
as(dp64614
g18
V23354
p64615
stp64616
a((dp64617
g2
(lp64618
VTo see the code in reflector, you must navigate to a method
p64619
aVIf you are looking at a type, then yes - it will only show you definitions, even when disassembled (although there is sometimes an "Expand Methods" button that can be helpful)
p64620
aVIf it still doesn't work, even when looking at a method, then the dll is most likely obfuscated or not compiled from code (direct IL can do things that are hard to map back to most languages)
p64621
as(dp64622
g18
V23354
p64623
stp64624
a((dp64625
g2
(lp64626
VTo do that fully you would need to emulate an entire browser model - never going to happen
p64627
aVSince you state "my page", the usual trick here is to do something like:
p64628
aVand (later) attach javascript to the  that returns false, suppressing the original link
p64629
aVYour crawler navigates via
p64630
aVFor example (using jQuery):
p64631
aVThis way you don't need to handle the js
p64632
as(dp64633
g18
V23354
p64634
stp64635
a((dp64636
g2
(lp64637
VAlthough personally I'd just read from the stream w/o
p64638
aVActually, strictly speaking, if it was me I would use my own serializer, and just:
p64639
aVsince this will have known endianness, handle buffering, and will use variable-length encoding to help reduce bloat if most of the numbers aren't enormous
p64640
as(dp64641
g18
V23354
p64642
stp64643
a((dp64644
g2
(lp64645
VCalling  does not clear the references (nor does it perform garbage collection)
p64646
aVIt simply calls the  method, which can (for example) close connections, files, etc - depending on the implementation
p64647
aVAn object can be non-null and still disposed
p64648
aVSome objects allow you to see if an object is disposed; most don't
p64649
aVGenerally, if you are  something, you wouldn't write that variable somewhere else (i
p64650
ag50
aVyou wouldn't write it as a field somewhere)
p64651
as(dp64652
g18
V23354
p64653
stp64654
a((dp64655
g2
(lp64656
VYes:
p64657
aVThen serialize with:
p64658
aVHOWEVER
p64659
aVand I can't caution this strongly enough; you must cache and re-use the  objects created in this way, as each one creates a dynamic serialization assembly that cannot be unloaded
p64660
aVIf you don't cache and re-use, you will swamp the memory
p64661
as(dp64662
g18
V23354
p64663
stp64664
a((dp64665
g2
(lp64666
VYes there is a trivial cost converting from  to , but I'm very sure that a: it won't matter in any sane code and b: it is unavoidable (arrays are accessed via  index; period)
p64667
aVTo show the won't matter:
p64668
aVI get:
p64669
aV162ms vs 215ms over 50000000 iterations
p64670
aVSo unless your code does nothing except array access, this just isn't going to matter
p64671
aVAt all
p64672
aVIn any significant way
p64673
as(dp64674
g18
V23354
p64675
stp64676
a((dp64677
g2
(lp64678
VNot in the core implementation - you would want to use encapsulation instead
p64679
aVHowever if you are using just protobuf-net, as code-first, I hack around it:
p64680
aVOf course, I'm assuming there is some additional detail in the classes - "as is" you could just use an enum (which is well-supported)
p64681
as(dp64682
g18
V23354
p64683
stp64684
a((dp64685
g2
(lp64686
VYes, but it doesn't generate them by default if you are doing codegen from
p64687
aVproto
p64688
aVIf this is just C#, of course, you don't need a
p64689
aVproto - just:
p64690
aVIf you are working from
p64691
aVproto, you could consider copying and editing  to suit your preferred layout
p64692
as(dp64693
g18
V23354
p64694
stp64695
a((dp64696
g2
(lp64697
VI would really approach this the other way around; while you can (as per Mike P's excellent answer) wrap an enumerator to pretend to be enumerable, there are some things that you can't really do - for example, it is hoped (although, to be fair, not insisted) that you can obtain multiple enumerators from an enumerable, ideally isolated and repeatable
p64698
aVSo if I do:
p64699
aVbut if you "spoof" the enumerator into an enumerable, the second sequence will be empty
p64700
aVOr if you do them in parallel - just bizarre
p64701
aVAnd there are methods that process them in parallel - consider:
p64702
aVthis works both enumerators forward at the same time, so if you only have one enumerator, you are fairly scuppered
p64703
aVThere is a reset on enumerators, but this is largely a design mistake and shouldn't be used (it is even a formal requirement in the spec that iterator blocks throw an exception if you call it)
p64704
aVA better (IMO) question is "how do I get an enumerator from an enumerable", in which case the answer is "call GetEnumerator(), and remember to check to dispose to iterator" - or in simpler terms "use "
p64705
as(dp64706
g18
V23354
p64707
stp64708
a((dp64709
g2
(lp64710
VNot if you want it to use the inbuilt IL operators - you would have to do it per-file
p64711
aVHowever, if you don't need that (I suspect you do) you could encapsulate it in a :
p64712
aV(where REAL_TYPE is a  alias in the single file that declares )
p64713
aVFor my money, not worth it
p64714
aVAnd the use if the static operators will be relatively slower that direct IL operations that you would get if it was in-situ
p64715
as(dp64716
g18
V23354
p64717
stp64718
a((dp64719
g2
(lp64720
VWith regards to the exception; implement a / region, and take appropriate action (perhaps logging the error and queuing it for a retry in a few moments)
p64721
aVI'm not entirely sure of what the first question is since we don't know what the data/system is - but some thoughts:
p64722
aVto reduce bandwidth, if the server supports compression, make sure you are telling it - set the accept-header accordingly ( on your request, if using ); or maybe  a denser serialization format if you control both ends of the pipe
p64723
aVmake sure you are making appropriate use of things like  when processing the data; I can't tell you what "appropriate" is without knowing what "processing" or "the data" means in your specific context ;p
p64724
as(dp64725
g18
V23354
p64726
stp64727
a((dp64728
g2
(lp64729
VI think that particular compiler warning in the general case is garbage; you should always look at the specific case
p64730
aVHaving written a few such frameworks, I would agree that it is important to include a  based API, since there are many scenarios for such libraries where generics are a nuisance
p64731
aVBy optimising for the non-generic case (rather than using MakeGenericMethod) you can do the other very simply:
p64732
aVThis coming from someone currently re-writing a library to move the optimised case to Type rather than
p64733
aVThis is especially important for compact framework etc, where otherwise you can start getting missing-method exceptions when it runs out of space
p64734
aVRe the interfaces; looks messy and complex - tl;dr; on that
p64735
aVBut as long as you're happy
p64736
as(dp64737
g18
V23354
p64738
stp64739
a((dp64740
g2
(lp64741
VYou open  with only the "write" flag, then try to read from it
p64742
aVPersonally I always use , , etc - much easier and clearer
p64743
as(dp64744
g18
V23354
p64745
stp64746
a((dp64747
g2
(lp64748
VBased on the comments, you actually mean "does not allow static classes"
p64749
aVSo
p64750
aVDon't SE static class
p64751
aVI would suggest moving those static properties into a default instance:
p64752
aVAnd treat the  object's properties like the existing static ones
p64753
aVNote that with XmlSerializer you need a public ctor, hence I haven't called this a singleton, as strictly speaking it won't be
p64754
as(dp64755
g18
V23354
p64756
stp64757
a((dp64758
g2
(lp64759
VThis is something you can only do at the client, typically by having a working site with script disabled, but enhancing the UI with script when available (perhaps replacing an anchor's click event with an AJAX call and cancel the default navigation)
p64760
aVYou can also use  to remind the user that some features may be unavailable with their settings
p64761
as(dp64762
g18
V23354
p64763
stp64764
a((dp64765
g2
(lp64766
VTo encode arbitrary byte data as a string you should use base-64, hex, etc
p64767
aVYou cannot assume that random set of bytes makes a valid UTF* (or other encoding) string
p64768
aVhttp://marcgravell
p64769
aVblogspot
p64770
aVcom/2010/03/binary-data-and-strings
p64771
aVhtml
p64772
as(dp64773
g18
V23354
p64774
stp64775
a((dp64776
g2
(lp64777
VSimply, they chose to call it , and implement  via explicit interface implementation -something like:
p64778
as(dp64779
g18
V23354
p64780
stp64781
a((dp64782
g2
(lp64783
VNote that fields are implicitly initialized to , so this only affects variables
p64784
aVIn pure c# you can't query the value of an uninitialized field (you need "definite assignment"), so it is a non-question
p64785
aVYou can do this by abusing IL though - by declaring an  parameter, and using  to write a method that doesn't assign it (valid in IL, but not in C#)
p64786
aVAnd then you find that you will see s
p64787
aVThis in turn is due to an IL flag () that says "clear the stack for me before entering this method" on the calling (C#) code
p64788
aVThe C# compiler always sets this flag
p64789
aVIf you again abuse IL to write a method that doesn't set this flag, you can probably see garbage
p64790
aVIt could be anything
p64791
aVBut by this point, you deserve the exceptions you get :)
p64792
aVHere's an example of the first (not the second, which is more complex):
p64793
aVFor clarification, the  code is simply writing the equivalent of this code, not legal in C#:
p64794
aVThis works because as far as the CLR is concerned  doesn't exist - there is only
p64795
aVSo this isn't invalid IL - it is only the language (C#) that puts meaning to  and demands that it be assigned a value
p64796
aVThe problem is that  still has the  flag; so behind the scenes  is cleared to  (well, the entire stack space is simply wiped)
p64797
aVIf I compiled from IL without that flag (and had some other code in place to make the stack space dirty) I could see garbage
p64798
aVYou can see more about  on Liran Chen's blog
p64799
aVBut to answer the question:
p64800
aVfor fields: uninitialized reference-type fields are  - guaranteed by the spec
p64801
aVfor variables: you can't ask, but as an implementation detail (that should not be depended on): yes, it will be  even though you can't ask ;p
p64802
as(dp64803
g18
V23354
p64804
stp64805
a((dp64806
g2
(lp64807
VYou do not need to build it as a dll
p64808
aVVS 2010 (and IIRC 2008) allow referencing exe assemblies
p64809
aVAll you need is for they relevant types to be declared  - top-level classes defualt to  if you don't add a specifier
p64810
as(dp64811
g18
V23354
p64812
stp64813
a((dp64814
g2
(lp64815
VThe options available inside generics are
p64816
aVLimited
p64817
aVOne workaround is to use reflection (typically in a static ctor on a generic type) to check with reflection, but tbh this may be overkill
p64818
aVCould you perhaps add  which may go a long way to limit it to "entity"/DTO types
p64819
as(dp64820
g18
V23354
p64821
stp64822
a((dp64823
g2
(lp64824
VIf you don't need the list - just the items, I would use a projection outside the method:
p64825
aVIf you need the list - a projection inside the method via a selector:
p64826
as(dp64827
g18
V23354
p64828
stp64829
a((dp64830
g2
(lp64831
VIirc from a previos project, ILOG have a component for this
p64832
aVI didn't use that one, so I can't comment on it - but the one I did use (Gantt) was exceptionally good
p64833
aVI was a very happy customer
p64834
as(dp64835
g18
V23354
p64836
stp64837
a((dp64838
g2
(lp64839
VUnless I am msitaken, it depends largely on whether you are using core generated proxies at the client, or using assembly sharing (using the same code at server and client)
p64840
aVWith proxies - simply: you can't - they are just shallow objects representing the public state
p64841
aVAll you have in the mex/wsdl is "a set of items of type X", which the code-gen layer interprets (depending on your condiguration) as , , etc
p64842
aVIf you are using assembly sharing, you should already have the correct types at the client, so it should just work - but this is less pure in terms of abstraction
p64843
aVBest avoided on a public API, but fine for internal apps that share a platform
p64844
as(dp64845
g18
V23354
p64846
stp64847
a((dp64848
g2
(lp64849
VNo, that is not possible without making things complex
p64850
aVOne option is to implement , which is hard to get 100% right
p64851
aVYou might also be able to so it by creating two subtypes, using the type-based versions of , and hacking the model to pieces
p64852
aVFrankly I don't think that is worth it either
p64853
aVMy personal preference here would be to either choose a different layout, or use LINQ-to-XML
p64854
aVThis is not a good it for
p64855
as(dp64856
g18
V23354
p64857
stp64858
a((dp64859
g2
(lp64860
VIf using csc, add /unsafe; or in a vs project, go to project properties and there is a checkbox
p64861
aVSimply it can't find a better match; I'd have to check the spec for the exact order rules, but just treat it as the compiler saying "no suitable match, I'm guessing at this but this doesn't work either"
p64862
as(dp64863
g18
V23354
p64864
stp64865
a((dp64866
g2
(lp64867
VUltimately perhaps they are just not ideal fits; if you want a list or collection - use a  or  ;p
p64868
aVRe  - there is an implicit assumption that  adds to the end of the collection, which is not true of a stack (although it is for a queue)
p64869
aVIn some ways, it actually confuses me that the enumerator for stack/queue does not dequeue/pop, since I largely expect items in a queue/stack to be fetched once each (and once only)
p64870
aVMaybe also (again, using my enumerator as just an example) people simply couldn't agree on exactly how it should behave in some of those scenarios, and lacking complete agreement, simply not implementing them was a better choice
p64871
as(dp64872
g18
V23354
p64873
stp64874
a((dp64875
g2
(lp64876
V is (frankly) very fussy, but version tolerant serialization was added - the idea was simply to add  to those fields that you expected to be null
p64877
aVHowever, if you are saying it deserialized as null, maybe even this was proving too painful, and they dimply made "optional" the default behaviour
p64878
aVNote that the many foibles of  (plus the fact that it is not platform-independent) are why I just don't use it ;p
p64879
as(dp64880
g18
V23354
p64881
stp64882
a((dp64883
g2
(lp64884
VSince you are using multiple controls, you will indeed need to recreate the controls
p64885
aVCreating a new array will help your code, but won't change at all the controls in the form's  collection
p64886
aVThe simplest process is either to recreate the form completely, else empty out the controls (remembering to  each), and re-create from scratch, adding each  to both the array () and to the UI )
p64887
as(dp64888
g18
V23354
p64889
stp64890
a((dp64891
g2
(lp64892
VSimply - that is a field, not an event
p64893
aVAn event is actually a pair of methods (like how a property works) - but field like events make that trivial (you can even include your default non-null value, which is (I assume) your intent:
p64894
aVThat translates almost like:
p64895
aVI say "almost" because field-like events also include some thread-safety code, which is rarely needed but tricky to explain (and varies depending on which version of the compiler you are using)
p64896
aVOf course, in my opinion it is better to not use this at all, and just check the event for null:
p64897
aVExample of implementing this interface:
p64898
as(dp64899
g18
V23354
p64900
stp64901
a((dp64902
g2
(lp64903
VIn the general case, it isn't ideal -  has some gotchas if you expect threads to be independent, or if you expect garbage collection to collect the window - but arguably you can probably get away with it for you main window, since that is probably essentially singleton and lasts the lifetime of the app
p64904
aVPersonally I probably wouldn't - I'd pass it in via a property or constructor argument - but I'm a bit fussy
p64905
as(dp64906
g18
V23354
p64907
stp64908
a((dp64909
g2
(lp64910
VLINQ
p64911
aV= TSQL; each  should be C#, ; each  should specify the left and right parts (with ) immediately, i
p64912
ag50
aVIf you want to write TSQL, that is fine - just use
p64913
as(dp64914
g18
V23354
p64915
stp64916
a((dp64917
g2
(lp64918
VAssuming the  there means "bitwise complement"
p64919
as(dp64920
g18
V23354
p64921
stp64922
a((dp64923
g2
(lp64924
VThe Google Earth API is JavaScript based, so it doesn't matter what your server is written in; just write the JavaScript you want in your client web-pages
p64925
aVIf you are not writing a web page, this is probably the wrong API
p64926
aVFor rich clients, consider things like MapPoint
p64927
as(dp64928
g18
V23354
p64929
stp64930
a((dp64931
g2
(lp64932
V is indeed not thread safe, so  is dropping data in unpredictable ways
p64933
aVReplace that line with:
p64934
aVand it will all work
p64935
aVNote that  is unordered, but that is fine because you have no way of predicting the order from the threads anyway ;p
p64936
as(dp64937
g18
V23354
p64938
stp64939
a((dp64940
g2
(lp64941
V2 changes:
p64942
aVadd a  generic constraint
p64943
aVsee the  usage (the control can be a , but  returns , which is never a )
p64944
aVAlso, note that this doesn't really recurse; this could just be:
p64945
as(dp64946
g18
V23354
p64947
stp64948
a((dp64949
g2
(lp64950
VTop-level classes default to "internal" access, so are only available to types in the same assembly (dll)
p64951
aVMost like some of your types include "public" (and are thus available), and some do not (so aren't available)
p64952
aVYou should also check you have all necessary "using" directives in the files that want to consume the types
p64953
as(dp64954
g18
V23354
p64955
stp64956
a((dp64957
g2
(lp64958
VFor Silverlight, that class is in , according to MSDN - so add a reference to
p64959
aVYou will also need a  directive at the top of your code file:
p64960
aV(these are exactly the same two suggestions that the compiler itself makes: "are you missing a using directive or an assembly reference
p64961
as(dp64962
g18
V23354
p64963
stp64964
a((dp64965
g2
(lp64966
VNot as an extension method, no; mapped functions must be called as instance functions from the data-context, i
p64967
ag50
aVand used in some form such as:
p64968
as(dp64969
g18
V23354
p64970
stp64971
a((dp64972
g2
(lp64973
VIt all depends on what the number looks like ;p That is typically the offset in some interval, into some epoch - for example seconds since 1 Jan 1970
p64974
aVSo try, for example:
p64975
aVand then try ,  etc until the date matches
p64976
as(dp64977
g18
V23354
p64978
stp64979
a((dp64980
g2
(lp64981
VThis isn't related to reflection; you get a very similar result with just:
p64982
aVIt actually writes "happy"; the unhandled exception seems to be coming from GC, presumably with it trying to collect a partially constructed object (it never calls the instance constructor), and this is then falling over
p64983
aVin particular note that they are on different threads (I'm pretty sure the unhandled is on the GC thread)
p64984
aVBeing GC/threaded it can be a pain to repro; I added  locally, just to force GC to happen so I see it more often
p64985
aVFascinating
p64986
aVSince neither an instance constructor () nor finalizer () get invoked, you have no possible way (that I can tell) of fixing this
p64987
aVThe main thing I can suggest here, sadly, is: don't have type initializers fail :(
p64988
aVThe one thing I can get working is to cheat the runtime:
p64989
aVThis still hits the type initializer and fails, but the object doesn't seem to be quite as lost
p64990
aVMaybe this route doesn't mark it for finalization
p64991
aVAnd thus GC doesn't hate it quite as much
p64992
aVYou are still going to have major problems ever using this object if the type initializer is borked
p64993
aVSo in your code, you might have:
p64994
aVnow:
p64995
aVwhen the type initializer fails, nothing is finalized (it doesn't need to be - the object can't possibly have anything to do at this point, since it never ran a constructor)
p64996
aVwhen the type initializer works, the ctor is executed and it is registered with GC - all hunky dory
p64997
as(dp64998
g18
V23354
p64999
stp65000
a((dp65001
g2
(lp65002
VIn that scenario, breaking the shared types / interfaces out into a separate assembly is fairly normal
p65003
aVAnother approach, not unheard of, is to simply say "all these assemblies aren't doing anything extra", and just use the namespaces to compartmentalise the code
p65004
aVIf you don't need to be able to run with only a subset of the dlls, why not just have one dll
p65005
aVThe classic counterpoint to this is where you have multiple different UIs / services all consuming the same dll (or different subsets of the dlls)
p65006
as(dp65007
g18
V23354
p65008
stp65009
a((dp65010
g2
(lp65011
VI'm interpreting that as "I need to consume a web-service", in which case either use wsdl
p65012
aVexe, or use the "Add Web Reference
p65013
aV/ "Add Service Reference
p65014
aVoption in Visual Studio
p65015
aVEither approach results in appropriate proxy classes being created that represent the target service's WSDL
p65016
aVThis is data/protocol interoperability; note that the dll itself won't be directly usable from java / php
p65017
as(dp65018
g18
V23354
p65019
stp65020
a((dp65021
g2
(lp65022
VChange:
p65023
aVto:
p65024
aVwell
p65025
aVstrictly speaking I'd be inclined (I don't like settable lists) to use:
p65026
aVYou also need a different root object:
p65027
aVThen this works:
p65028
as(dp65029
g18
V23354
p65030
stp65031
a((dp65032
g2
(lp65033
VIt looks like with  you will have to add a private pass-thru, just to make it happy (below)
p65034
aVYou could also try using the IKVM builder - almost identical API, but it might not have this limitation
p65035
as(dp65036
g18
V23354
p65037
stp65038
a((dp65039
g2
(lp65040
VNo
p65041
aVYou could of course write a wrapper class that represents a slice, and has an indexer internally - but nothing inbuilt
p65042
aVThe other approach would be to write a method that makes a copy of a slice and hands back a vector - it depends whether you want a copy or not
p65043
as(dp65044
g18
V23354
p65045
stp65046
a((dp65047
g2
(lp65048
VIf returning null is a sensible and sane thing to do as a default behaviour (with supporting documentation), then perhaps  is fine
p65049
aVLikewise, if you can create a sensible default but just want to offer extensibility:
p65050
aVIf the (concrete) class cannot function without a non-default implementation, then make it
p65051
aVThe casebook scenario here is  : without a sane implementation where would the bytes come from
p65052
aV(/go to)
p65053
as(dp65054
g18
V23354
p65055
stp65056
a((dp65057
g2
(lp65058
VThe group implements  - In the general case, just call  over the
p65059
aVIn this case, since you need a :
p65060
as(dp65061
g18
V23354
p65062
stp65063
a((dp65064
g2
(lp65065
VI would guess that  is the culprit here; with reference here, you might want to try adding  to your handler (the code-behind for the ashx)
p65066
aVSo you should have something like:
p65067
aVNote also that it is easier to talk to the  passed in, but  should work too
p65068
as(dp65069
g18
V23354
p65070
stp65071
a((dp65072
g2
(lp65073
VThis was discussed in chat, with the following conclusions:
p65074
aVthe objective is to write a file response from a web form, as covered here
p65075
aVthe translation of the input xml to the target csv is pretty much covered, via xslt (as it happens, pretty much like here)
p65076
aVand to write csv, we want to set the "content-type" and "content-dispositon" headers, as discussed here
p65077
as(dp65078
g18
V23354
p65079
stp65080
a((dp65081
g2
(lp65082
VI keep meaning to write my own parser, but for now I just use "protoc" to parse the
p65083
aVproto to a protobuf binary
p65084
aVI then deserialize that using my own protobuf library, giving me a populated object model to work with
p65085
aVI don't know how far along you are, but you might also be interested in some of the runtime support in protobuf-net v2, which allows on-the-fly mapping of protobuf data to types
p65086
aVAlternatively there's also a fairly re-usable reader implementation that might suit your needs
p65087
aVIf you could work from XML, I include a tool in protobuf-net, "protogen", which does code-gen; but pass in a  and it should transform a
p65088
aVproto into XML for you
p65089
aVIirc, "protoc" outputs a protobuf using "descriptor
p65090
aVproto" from the google package
p65091
as(dp65092
g18
V23354
p65093
stp65094
a((dp65095
g2
(lp65096
VStatic members are accessed via the type name, i
p65097
ag50
aVOf course since it is private you would have to so this from inside the type, in which case you can just use:
p65098
aVHowever, I would also question whether static is an appropriate option here, especially if you are doing any threading (or web code)
p65099
aVStatic is often overused (and used inappropriately)
p65100
as(dp65101
g18
V23354
p65102
stp65103
a((dp65104
g2
(lp65105
V1 - usually not; most times you will be blocked on IO, so unless you have enough IO bandwidth to satisfy all the threads, it won't help; WP7 is going to have a slightly different profile here, but IO is still always a premium
p65106
aV2/3 - we'd need to see some code to understand what is happening
p65107
as(dp65108
g18
V23354
p65109
stp65110
a((dp65111
g2
(lp65112
VRewind your stream - it is at the end, so  will return no data:
p65113
aValternatively, use the overloaded constructor to prepare the stream:
p65114
as(dp65115
g18
V23354
p65116
stp65117
a((dp65118
g2
(lp65119
VThe fastest (for a large set) would be to have them keyed against a  and use that
p65120
aVand  do different things;  always iterates the entire set, even if it finds it at the start of the list, so  would usually be quicker than  since it short-circuits
p65121
as(dp65122
g18
V23354
p65123
stp65124
a((dp65125
g2
(lp65126
VI probably would use it for 1000 rows, but you can do something similar with command-batching
p65127
aVNote that with 1000 rows, the simplest approach is probably to throw the data you want into a  of the correct shape, which is pretty trivial
p65128
aVFor larger sets, writing a bespoke  (to stream the records, rather than buffer them all in memory first) is my preferred option
p65129
aVThe other thing to watch is transactions, durability, etc; when using  I tend to use this to push into a staging table, and then call a sproc (or just a simple TSQL command) to push the data over to the real table
p65130
aVThis keeps the real table clean except for a single set-based (and fully logged)
p65131
aVBut if you just want to measure the performance, throwing it into the real table should do to get a ballpark estimate
p65132
as(dp65133
g18
V23354
p65134
stp65135
a((dp65136
g2
(lp65137
VYou can see how to construct the lambda here, but it really is pretty simple in your case:
p65138
aVThe tricky thing is invoking the  - using  may be the way, as shown in the link above
p65139
as(dp65140
g18
V23354
p65141
stp65142
a((dp65143
g2
(lp65144
VIf you use reflection, then not quite like this - reflection attributes can't be substituted - only the component-model view is impacted by
p65145
aVHowever, you can subclass  to your purposes
p65146
aVEspecially useful for i18n
p65147
as(dp65148
g18
V23354
p65149
stp65150
a((dp65151
g2
(lp65152
VThe problem is - the action doesn't directly point at  - it points at a compiler-generated method of the form:
p65153
aVOne option here would be to change it to an , then you can dissect the expression tree afterwards and extract the attributes:
p65154
as(dp65155
g18
V23354
p65156
stp65157
a((dp65158
g2
(lp65159
V(jump right to the last example if you want to see it fixed etc)
p65160
aVThreads and "observer" patterns (such as the data-binding on winforms) are rarely good friends
p65161
aVYou could try replacing your  usage with the  code I used on a previous answer - but this combination of threads and UI is not an intentional use-case of winforms data-binding
p65162
aVThe listbox itself should support binding via list notification events ( / ), as long as they arrive form the right thread
p65163
aVattempts to fix this by thread-switching on your behalf
p65164
aVNote that for this to work you must create the  from the UI thread, after it has a sync-context, i
p65165
ag50
aVafter it has started displaying forms
p65166
aVTo illustrate the point that listbox does respect list-change notifications (when dealing with a single thread):
p65167
aVand now with added threading /  (it doesn't work with the regular ):
p65168
as(dp65169
g18
V23354
p65170
stp65171
a((dp65172
g2
(lp65173
VThis seems to be an odd issue with thread affinity
p65174
aVUltimately, the code is trying to do the update from a non-UI thread - I'm unclear why it isn't just displaying the cross-thread exception, though - I wonder whether this is actually a catch-all exception handler
p65175
aVIf I remove the  (and bind directly to the object, which is valid) you do get a cross-thread exception (which I expected)
p65176
aVPersonally, I would be inclined to handle this manually, i
p65177
ag50
aVsubscribe to the event with a method that does an  to the UI thread and updates the  manually
p65178
aVHowever, I'm just checking if some previous cross-threaded binding code might help
p65179
aVHere's an example using :
p65180
aVHere's an example using a (modified) version of some old threading code of mine:
p65181
as(dp65182
g18
V23354
p65183
stp65184
a((dp65185
g2
(lp65186
VIs this a , a , or what
p65187
aVeither way, you want a  - the question is simply  vs
p65188
aVOnce you have that, I would do something like:
p65189
aVthen with whichever reader, I can either user:
p65190
aVor:
p65191
ag412
ag50
aVif it is a  you are reading from:
p65192
as(dp65193
g18
V23354
p65194
stp65195
a((dp65196
g2
(lp65197
V (in this context) takes here requires a  - a delegate to a method that takes a  and returns a
p65198
aVThe static  satisfies that perfectly - exactly the same  as if we had written , or written:
p65199
aVThe lambda version adds a level of indirection via an anonymous method:
p65200
aVso the direct call to  is actually marginally more efficient
p65201
as(dp65202
g18
V23354
p65203
stp65204
a((dp65205
g2
(lp65206
VI happen agree with the behaviour; if I don't have an "id" attribute / element, then I'm happy to count that as null, but if it exists but doesn't parse, that is different - and an empty string works for very few types
p65207
aVYou would have to do it manually, or you could add an extension method on  etc:
p65208
aVNote I'm using the cast internally as while it is simple for , a  would be a bad example for  etc, which uses a different format in xml, which the cast handles internally
p65209
as(dp65210
g18
V23354
p65211
stp65212
a((dp65213
g2
(lp65214
VThe  creates a mask of everything except the last 4 bits;  takes the last 4 bits away, then  puts the bits from the new data in their place
p65215
as(dp65216
g18
V23354
p65217
stp65218
a((dp65219
g2
(lp65220
VThe  here impacts the nearest loop - your second
p65221
aVThere are two ways of jumping directly to the :
p65222
aV, although sometimes "considered harmful", this is arguably the main reason why it still exists
p65223
aVTo illustrate the latter:
p65224
aVand the former:
p65225
as(dp65226
g18
V23354
p65227
stp65228
a((dp65229
g2
(lp65230
Vprotobuf-net will (in the lack of something more explicit) use the Order from any [DataMember] attributes; so - are there any marked 9
p65231
aVHow many
p65232
aVEach identifier must be unique per-type in protobuf-net
p65233
aVCan you add a [ProtoMember] to give it a new identifier
p65234
aVIf the file is code-generated, you can also have a partial class with [ProtoPartialMember] against the type (not the member), to achieve the same thing
p65235
as(dp65236
g18
V23354
p65237
stp65238
a((dp65239
g2
(lp65240
VWell, a SqlTransaction spanning three ExecuteNonQuery is the simplest, but some alternatives:
p65241
aVuse the XML datatype to pass all three in as XML; parse the XML (SQL server has functions for this) in the sproc into 3 records
p65242
aVuse a "table valued parameter" to pass them in a single call - note this needs additional definition at the DB to represent the structured data
p65243
aVif the data volume is huge (3000 rather than 3), SqlBulkCopy into a staging table, then run a sproc to move the data into the real table in one set-based operation
p65244
aVFinally, watch out for the "inner platform effect" - it sounds a bit like a DB inside a DB
p65245
as(dp65246
g18
V23354
p65247
stp65248
a((dp65249
g2
(lp65250
VThe "A Fast CSV Reader" article on Code Project
p65251
aVI've used it happily many times
p65252
as(dp65253
g18
V23354
p65254
stp65255
a((dp65256
g2
(lp65257
VNo need for union there; one field+property for the data, 8 properties that do bitwise "shift" operations, for example:
p65258
aVetc
p65259
aVI would also have thought you want bool here
p65260
aVNormally I'd say: don't make mutable structs
p65261
aVPInvoke may (I'm not sure) be a valid scenario for that, so I'll ignore it :)
p65262
aVIf the value is genuinely using more than 32 bits, consider switching the backing field to ulong
p65263
as(dp65264
g18
V23354
p65265
stp65266
a((dp65267
g2
(lp65268
VThe first example on the home page does something very similar, but consider:
p65269
aVSo you can imagine that for img@src, just replace each  with , and  with
p65270
aVYou might even be able to simplify to:
p65271
aVFor relative url handling, look at the  class
p65272
as(dp65273
g18
V23354
p65274
stp65275
a((dp65276
g2
(lp65277
VUsually the trick here is to have one  (usually the one with most parameters), and this is the only one you call vertically
p65278
aVThe others might be non-virtual and just call the "main" one with appropriate defaults
p65279
as(dp65280
g18
V23354
p65281
stp65282
a((dp65283
g2
(lp65284
Vactually (for completeness only), you can also do this by two other name-based patterns - you just wouldn't in this scenario - they are designed for conditionally including data during serialization, and (in the second example) disambiguating between "explicitly deserialized to the default" vs "not in the deserialization source":
p65285
aVor
p65286
as(dp65287
g18
V23354
p65288
stp65289
a((dp65290
g2
(lp65291
VIf you are hitting OOM, then you may be being overly aggressive with the data, but to answer the question:
p65292
aVYes, this may help some - as if it has to keep growing the collections by doubling, it could end up allocating and copying twice as much memory for the underlying array (or more precicely, for the earlier smaller copies that are discarded)
p65293
aVMost of these intermediate arrays will be collected promptly, but when they get big you are using the "large object heap", which is harder to compact
p65294
aVStarting with the correct size prevents all the intermediate copies of the array
p65295
aVHowever, it also depends what is in the array matters
p65296
aVTypically, for classes, there is more data in each object (plus overheads for references etc) - meaning the list is not necessarily the biggest culprit for memory use; you might be burning up most of the memory on objects
p65297
aVNote that x64 will allow more overall space, but arrays are limited to 2GB - and if each reference doubles in size this halves the maximum effective length of the array
p65298
aVPersonally I would look at breaking the huge sets into smaller chains of lists; jagged lists, for example
p65299
as(dp65300
g18
V23354
p65301
stp65302
a((dp65303
g2
(lp65304
VCannot reproduce - it seems fine:
p65305
aVoutputs:
p65306
aVand
p65307
aVIt might help to be more specific about how you are trying to view it, such that it "looks like it's removing the white space"
p65308
as(dp65309
g18
V23354
p65310
stp65311
a((dp65312
g2
(lp65313
VThat is an 800MB array, which you are trying to load into a win32 process space (2GB)
p65314
aVIt needs to be contiguous, too, which makes it even harder
p65315
aVSimply - it cannot find a big enough contiguous block in the LOH to fit all this in one big lump
p65316
aVThree options:
p65317
aVdon't allocate such a huge array - do you really need that
p65318
aVswitch to a jagged array; it is easier to allocate multiple mid-size arrays; for example a  with 10000 inner arrays each of length 10000 - just do some  and  code to get into the right block
p65319
aVswitch to x64 (note the array is still hard-limited to 2GB)
p65320
as(dp65321
g18
V23354
p65322
stp65323
a((dp65324
g2
(lp65325
VI assume you have inherited from something other than  - in which case add  to your  call:
p65326
aVDeclaredOnly
p65327
aVSpecifies that only members declared at the level of the supplied type's
p65328
aVhierarchy should be considered
p65329
aVInherited members are not considered
p65330
aVSo you would have:
p65331
as(dp65332
g18
V23354
p65333
stp65334
a((dp65335
g2
(lp65336
Valthough actually I prefer:
p65337
aVas this has:
p65338
aVdeferred list creation, for when you don't need any people
p65339
aVno "set" on the list property (it isn't needed)
p65340
as(dp65341
g18
V23354
p65342
stp65343
a((dp65344
g2
(lp65345
VThere are three likely factors here:
p65346
aVencoding: in most encodings, bytes
p65347
aV= characters
p65348
aVbuffers: if you  a base stream, you must tell the reader to drop any buffers it may have, or it will get badly confused; to do this call
p65349
aVbyte order marks at the start of the file
p65350
as(dp65351
g18
V23354
p65352
stp65353
a((dp65354
g2
(lp65355
VThere is no way to do this automatically; array initialization is essentially "wipe this block of memory to 0s"
p65356
aVYou would have to do something like:
p65357
as(dp65358
g18
V23354
p65359
stp65360
a((dp65361
g2
(lp65362
VYes, that is an appropriate "decorator" implementation
p65363
aVThe only thing I'd question is whether you actually need to inherit from , or whether implementing  is sufficient
p65364
aVWhich can only be answered with more context
p65365
aVAlso, the hard-coded (dimensions
p65366
aVvalues look like there may be a better way if some existing values are available somewhere
p65367
aVThe example itself is unusual, though - you've had to introduce the interface, which is pretty much as much of a change as you are trying to avoid; and the type handles an event on itself, which is bad practice
p65368
aVI almost wonder if they want you to hook into the event pipeline, but that wouldn't really be a decorator
p65369
aVI suspect they want you to code against Form rather than the IPhoto you have introduced, which would allow you to decorate lots of things
p65370
aVBut you would need to have a known method on Form to call, for example Paint() - except that is an event here, not a method so the name will be different
p65371
aVAnd again we could hook the event, but that isn't classic decorator usage
p65372
as(dp65373
g18
V23354
p65374
stp65375
a((dp65376
g2
(lp65377
VYou have called , hence consumed all the data (into a string)
p65378
aVThis means the reader has nothing more to give
p65379
aVJust: don't do that
p65380
aVOr, do that and use
p65381
as(dp65382
g18
V23354
p65383
stp65384
a((dp65385
g2
(lp65386
VDataContractSerializer doesn't do attributes, so forget that
p65387
aVYou really want XmlSerializer
p65388
aVI'm very unclear what issue you are describing with the ids
p65389
aVI would be very surprised if it deserialized it incorrectly
p65390
aVPerhaps post a repeatable example if you believe that is the case, but it sounds like you simply have data you weren't expecting
p65391
aVThe data is the data, but I wonder if this is because you are expecting a full "graph" deserialize (preserving object references)
p65392
aVXmlSerializer is a "tree" serializer, so it will not matter if the same object was serialized 6 times - it will deserialize into 6 different object
p65393
aVThere is nothing special / unique that will identify them
p65394
aVYour only option would be to fix them up manually afterwards, by checking for duplicates and replacing them with a single common instance
p65395
aVTo put that in pictures; if you serialize the tree
p65396
ag13333
aVB
p65397
aVC
p65398
ag34912
ag65398
aV(same instance under B and D) it will deserialize as:
p65399
ag13333
ag65397
ag65398
ag34912
ag34914
aVBut simply C and E will be different objects with the same values
p65400
as(dp65401
g18
V23354
p65402
stp65403
a((dp65404
g2
(lp65405
VLocks in
p65406
aVNET are reentrant
p65407
aVOnly acquisitions from other threads are blocked
p65408
aVWhen the same thread locks the same object multiple times, it simply increments a counter, and decrements it when released
p65409
aVWhen the counter hits zero, the lock is actually released for access from other threads
p65410
as(dp65411
g18
V23354
p65412
stp65413
a((dp65414
g2
(lp65415
VIndeed, suspending a thread is bad practice since you very rarely know exactly what a thread is doing at the time
p65416
aVIt is more predictable to have the thread run past a , calling  each time
p65417
aVThis will act as a gate - the controlling thread can call  to shut the gate (pausing the thread, but safely), and  to open the gate (resuming the thread)
p65418
aVFor example, you could call  at the start of each loop iteration (or once every  iterations if the loop is too tight)
p65419
as(dp65420
g18
V23354
p65421
stp65422
a((dp65423
g2
(lp65424
VThe payload is typically buffered in memory before transmission starts, in order to allow for the correct content-length headers to be sent, the entire payload to be validated, the payload encrypted (if message encryption is enabled it is applied before the payload is sent; contrast with transport encryption which can be streamed), to apply transformations such as MTOM (which happens after the payload has been constructed), and to enforce quotas
p65425
aVYou might be able to time this better with a WCF inspector
p65426
as(dp65427
g18
V23354
p65428
stp65429
a((dp65430
g2
(lp65431
VI think you step back to the "why" rather than jumping right to the "how"
p65432
aVIt sounds like maybe you are doing some huge insert/update, in which case a more appropriate solution would be table-valued-parameters
p65433
aVOther options include:
p65434
aVpassing in xml and using SQL server to parse the xml (it is quite good at this)
p65435
aVloading data first with something like  into a staging table, then executing a command (raw TSQL or a SPROC) to push the data from the staging table into the transactional tables
p65436
aVif it is just a list of ids, write a "split" function (udf) at the server and pass in a
p65437
aVbatch the operations into a number of more sane commands
p65438
aVYou really don't want to do something with 10k parameters on one command; that way madness lies
p65439
as(dp65440
g18
V23354
p65441
stp65442
a((dp65443
g2
(lp65444
V is captured as a variable, not a value
p65445
aVI don't really like the overall approach you're using here (it seems convoluted), but you should be able to fix the stackoverflow by changing the capture:
p65446
aVOn a side note:  is already kinda repeatable, you simply call  another time - is is  that (despite the ) isn't - but also, I think it is worth doing trying to do this without needing to ever repeat the enumeration, since in the general case that simply cannot be guaranteed to work
p65447
aVHere's a simpler (IMO) implementation with the same result:
p65448
as(dp65449
g18
V23354
p65450
stp65451
a((dp65452
g2
(lp65453
VNo there is nothing built in, but if you have a clearly defined use-case it is something I could of course look at (I'm the author)
p65454
aVFor now, I would suggest using some variant of:
p65455
aVwhich will short-circuit when a match is found, and will release the objects for collection promptly (hopefully in gen-0)
p65456
aVOr for multiple items, perhaps:
p65457
aV(which again releases the non-matching items promptly)
p65458
aVTo do this in the general case (especially for more complex queries) I can't think of a sane way to do it without materializing the object, so this is probably as close as you can get unless there is a very specific (and simple) scenario that happens to align nicely with the underlying data storage (for example, the filter is always on "tag 1")
p65459
as(dp65460
g18
V23354
p65461
stp65462
a((dp65463
g2
(lp65464
VThe query as presented will do exactly one select statement
p65465
aVI wonder if the problem here is hidden in moving the question to a simple example
p65466
aVMost likely in the actual code it doesn't push the data into a list
p65467
aVMethods like  only compose a query - it doesn't load the data into a list, so the following is 2 queries:
p65468
aVAdding a  will force it to buffer in memory in a single TSQL query; subsequent enumeration over the list will be done in memory (LINQ-to-Objects)
p65469
aVOf course, you can profile what LINQ-to-SQL is executing pretty simply:
p65470
as(dp65471
g18
V23354
p65472
stp65473
a((dp65474
g2
(lp65475
VYes, you can allocate as much memory as your system will allow before crumpling under the weight - however, arrays (which includes most lists) and strings etc are still limited to 2GB
p65476
aVNote also that since the size of a reference doubles, this means you can only have half as many references in a list
p65477
aVBut that is still a lot of references
p65478
aVThe sizes of  etc don't change, since they are fixed regardless of the platform
p65479
aVYou may also see other oddities - x64 and x86 have some different optimisations in the engine
p65480
aVSo please do test - don't just change it to x64 and blindly deploy
p65481
aVExamples here would be tail call and various things surrounding complex cases like
p65482
as(dp65483
g18
V23354
p65484
stp65485
a((dp65486
g2
(lp65487
VThat isn't an inbuilt option
p65488
aVSo either do string work to swap the characters around, or so some bit-shifting, I
p65489
ag50
as(dp65490
g18
V23354
p65491
stp65492
a((dp65493
g2
(lp65494
VSince it is your server code that gives the object an @id, the server should already know it at the point of creation
p65495
aVBut no, you can't interleave client and server like that - they run disjoint in time and geography
p65496
as(dp65497
g18
V23354
p65498
stp65499
a((dp65500
g2
(lp65501
VIt sounds to me like the main problem here is not checking the result of EndReceive which is the number of bytes read
p65502
aVIf the socket is open, this can be anything  and  the max you specified
p65503
aVIt is not safe to assume that because you asked for 2 bytes, 2 bytes were read
p65504
aVDitto when reading the actual data
p65505
aVYou must always loop, accumulating the amount of data you expect (and decreasing the remaining count, and increasing the offset, accordingly)
p65506
aVThe mix of sync/async won't help make it easy, either :
p65507
as(dp65508
g18
V23354
p65509
stp65510
a((dp65511
g2
(lp65512
VIt depends in part on the queries
p65513
aVFor simple queries (select, where, orderby) you should be fine, but there are a lot of implementation-specific details
p65514
aVFor example:
p65515
aVtaking a  on a set you haven't explicity ordered : LINQ-to-SQL is fine with that, LINQ-to-Entities will fail
p65516
aVusing an  to build a gnarly custom expression : again, LINQ-to-SQL is fine, LINQ-to-Entities will fail
p65517
aVusing things like UDFs - in addition to LINQ-to-Entities not supporting it, your RDBMS might not support it
p65518
aVwith "Astoria" (LINQ to data services), there were some scenarios around  vs  - which are semantically identical, but IIRC only one works (in Astoria)
p65519
aVMy point is; it might work, but you do need to test against the specific implementation
p65520
as(dp65521
g18
V23354
p65522
stp65523
a((dp65524
g2
(lp65525
VIf you are running something like:
p65526
aVin SSMS, that is an entirely different scenario, where all of that is a single batch
p65527
aVWith ADO
p65528
aVNET you are paying a round-trip per  - I'm actually impressed it managed 1000/s
p65529
aVRe the logical reads, that could just be looking at the query-plan cache, but without knowing more about  it is impossible to comment on whether something query-specific is afoot
p65530
aVBut I suspect you have some different  conditions between SSMS and ADO
p65531
aVNET that is forcing it to use a different plan - this is in particular a problem with things like persisted calculated indexed columns, and columns "promoted" out of a sql-xml field
p65532
aVRe making it faster - in this case it sounds like a table-valued parameters is exactly the thing, but you should also review the other options here
p65533
as(dp65534
g18
V23354
p65535
stp65536
a((dp65537
g2
(lp65538
VWith the edited question, it looks like you have a loop
p65539
aVNote that  is a tree serializer, not a graph serializer, so it will fail
p65540
aVThe usual fix here is to disable upwards traversal:
p65541
aVNote you will have to manually fixup the parents after deserialization, of course
p65542
aVRe the exception - you need to look at the  - it probably tells you exactly this, for example in your :
p65543
aVI'm guessing it is actually:
p65544
aVA circular reference was detected while serializing an object of type ItemInfoA
p65545
aVMore generally on the design, honestly that (public fields, , settable lists) is bad practice; here's a more typical re-write that behaves identically:
p65546
aVas requested, here's a general (not question-specific) illustration of recursively setting the parents in a hive (for kicks I'm using depth-first on the heap; for bredth-first just swap  for ; I try to avoid stack-based recursion in these scenarios):
p65547
as(dp65548
g18
V23354
p65549
stp65550
a((dp65551
g2
(lp65552
VWhen passing a control, you are almost universally talking about a  / object-instance, so all you are passing is the reference to the control - the control itself is identical
p65553
aVOne possible cause of this is an incorrect check:
p65554
aVwhich should be:
p65555
aVor just:
p65556
aVbut the compiler would tell you that in a warning
p65557
aVAssignment in conditional expression is always constant; did you mean to use == instead of =
p65558
aVThis leaves only a few options:
p65559
aVthe  has genuinely changed, perhaps due to a state-change such as moving it in a control tree
p65560
aVthe  property defies all sanity and changes upon inspection
p65561
aVthe  property is thread-specific and you are talking to it from multiple threads
p65562
aVor, there is something else going on in your code that your question doesn't tell us, but the source might
p65563
aVI rather expect it to be the last option
p65564
as(dp65565
g18
V23354
p65566
stp65567
a((dp65568
g2
(lp65569
VIf the data-volume is sane enough to exist as a , you might as well just construct a  and push the data in that way
p65570
aVI don't like , but it does this job nicely
p65571
aVThe alternative would be to write a custom  implementation like this, but which iterates over the items in the list each time
p65572
aVI'm not sure it is worth the effort
p65573
as(dp65574
g18
V23354
p65575
stp65576
a((dp65577
g2
(lp65578
V is, as noted at the bottom of the question, a constant  (right up at the compiler)
p65579
aVYou have a few choices here - the simplest of course is to do something like:
p65580
aVand call with
p65581
aVthen here, there is nothing left to do; we already have the expression
p65582
aVSo I assume you mean "MyField" is a string only known at runtime, in which case:
p65583
aVand call with  (with an implicit  in there, courtesy of the compiler), or  if the prop is an  (implicit ),
p65584
aVThe final scenario is where  is also a string only known at runtime (emph: ) - in which case we'll need to parse it:
p65585
aVHere the call is always 2 strings - so  even when
p65586
as(dp65587
g18
V23354
p65588
stp65589
a((dp65590
g2
(lp65591
Vcss doesn't support parameters
p65592
aVYou can do some level of parameterisation with "less" (a dialect of css that requires pre-processing), but even then the question is vague
p65593
aVOther options would include:
p65594
aVcoding the image directly per element
p65595
aVusing something in the structure to choose, i
p65596
ag50
aVyou could have a css class on something higher and use the css with patterns like
p65597
aVbut without a more specific example, we're shooting pretty blind
p65598
as(dp65599
g18
V23354
p65600
stp65601
a((dp65602
g2
(lp65603
VTry:
p65604
aVusing  from this answer
p65605
as(dp65606
g18
V23354
p65607
stp65608
a((dp65609
g2
(lp65610
VI don't think it is a great idea to walk the entire cache anyway, but you could do it non-LINQ with something like:
p65611
aVto do it with LINQ you could do something like:
p65612
aVand use like:
p65613
as(dp65614
g18
V23354
p65615
stp65616
a((dp65617
g2
(lp65618
VI don't think this has anything to do with , unless you are seeing something else
p65619
aVprotobuf-net serializes objects in accordance with the protobuf spec defined by google, which is a portable format that requires the receiever to know the layout of the specific data in advance - by which I mean that (unlike ) it doesn't include anything to say "this object is a  from "
p65620
aVThis "don't store what the object was" approach is also common to json (), xml (), , etc
p65621
aVSo why does this matter
p65622
aVIt matters because session state is storing arbitrary objects that can't be predicted
p65623
aVIndeed, there is no guarantee (especially if the state has always been stored in memory) that the objects are even remotely serializable under any scheme
p65624
aVBut it depends on what your aim is; if you want to implement a session-state provider, then that should be possible - but you would just need to include this extra metadata in your provider, like I did when writing a cache provider
p65625
aVSo it would be:
p65626
aVserialization:
p65627
aVencode the  metadata in some way
p65628
aVuse  to encode the object (assuming it is serializable by protobuf-net)
p65629
aVdeserialization
p65630
aVdecode the type metadata and resolve your
p65631
aVuse  to decode the object
p65632
aVAnother alternative approach would be to simply use  which handles the type metadata internally, but hook  for your special types and forward that to protobuf-net
p65633
aVThis allows your objects to be handled side-by-side with objects that aren't protobuf-net compatible, but get the enhanced serialization for your objects
p65634
aVA brief example of proxying  would be simply:
p65635
as(dp65636
g18
V23354
p65637
stp65638
a((dp65639
g2
(lp65640
VThere's plenty of options
p65641
as(dp65642
g18
V23354
p65643
stp65644
a((dp65645
g2
(lp65646
s(dp65647
g18
V23354
p65648
stp65649
a((dp65650
g2
(lp65651
VThat is a very bizarre scenario - IMO you should just have two different , and write to them when you need to
p65652
aVLeave the console alone
p65653
aVIf the caller wants to pipe stdout, let them worry about that via the command shell
p65654
aVand if that means changing some existing code to pass in a , then that is purely a good thing
p65655
as(dp65656
g18
V23354
p65657
stp65658
a((dp65659
g2
(lp65660
V is not serializable via protobuf-net, and neither is
p65661
aVI understand what you are trying to do, and if you honestly cannot know the types in advance
p65662
aVI suspect you should consider serialising the  of the type (a ) and a  for the object (via )
p65663
aVI can whip up an example later if you like (let me know)
p65664
aVHowever, if it is possible to state a finite lost of types you need to support (for example "string or int or Customer or Guid only") then there is a much more efficient and convenient approach - again I can whip up an example if this is your scenario - let me know
p65665
as(dp65666
g18
V23354
p65667
stp65668
a((dp65669
g2
(lp65670
VYou can't do:
p65671
aVBecause an  simply isn't a
p65672
aVThe assignment is invalid
p65673
aVI'm not sure I'd even call this variance - it is simply inheritance
p65674
aVIn the general case where B had members that A doesn't, you can see that it makes no sense to do (if  actually holds a reference to an  object):
p65675
aVwhere SomeMethod is defined only in B, but this logic extends to the assignment to the variable itself
p65676
aVEven if you added a cast, the cast has an implicit type check that would fail
p65677
as(dp65678
g18
V23354
p65679
stp65680
a((dp65681
g2
(lp65682
VI've had a look at this, and the only way I can see to shape the data like that is to model it with that extra level in your model:
p65683
as(dp65684
g18
V23354
p65685
stp65686
a((dp65687
g2
(lp65688
s(dp65689
g18
V23354
p65690
stp65691
a((dp65692
g2
(lp65693
VYou can't, basically
p65694
aVYou can set the default in the constructor, though
p65695
aVAs it happens I did implement something that did this very recently, but that was using factory-based construction; the factory checked for  and set the value via reflection
p65696
aVBut attributes can't cause arbitrary code execution unless you use a re-writer like PostSharp
p65697
aVIf the constructor is too far away for your liking, you will have to use a field-initializer and write the / against the field
p65698
as(dp65699
g18
V23354
p65700
stp65701
a((dp65702
g2
(lp65703
VPure linq (i
p65704
ag50
aVquery syntax)
p65705
aVNot that I know of
p65706
aVLinq-to-SQL
p65707
aVSure - thanks to TSQL support:
p65708
aVAs with any non-trivial query, the table's index strategy may be important here
p65709
aVYou may want to try an index spanning  and  (measure the stats-IO), then remove that and try an index spanning  and  (other way around; again, measure the stats-IO)
p65710
as(dp65711
g18
V23354
p65712
stp65713
a((dp65714
g2
(lp65715
VYou just need:
p65716
aVThe  clause limits  to value types excluding , which allows  or  to work fine
p65717
as(dp65718
g18
V23354
p65719
stp65720
a((dp65721
g2
(lp65722
VProtocol buffers directly handles an intentionally small number of constructs; vectors map nicely to the "repeated" element type, but how this is presented in C++ is via "add" methods - you don't (AFAIK) just hand it a vector
p65723
aVSee "Repeated Embedded Message Fields" here for more info
p65724
aVRe maps; there is no inbuilt mechanism for that, but a key/value pair is easily represented in
p65725
aVproto (typically key = 1, value = 2) and then handled via "repeated"
p65726
aVA shared_ptr itself would seem to have little meaning in a serialized file
p65727
aVBut the object may be handled (presumably) as a message
p65728
aVNote that in the google C++ version the DTO layer is generated, so you may need to map between them and any existing object model
p65729
aVThis is usually pretty trivial
p65730
aVFor some languages/platforms there are protobuf variants that work against existing object models
p65731
aV(sorry, I can't comment on thrift - I'm not familiar with it)
p65732
as(dp65733
g18
V23354
p65734
stp65735
a((dp65736
g2
(lp65737
VSimply take off the :
p65738
aVsince your xml doesn't seem to be in an xml-namespace
p65739
aVAlso,  isn't used by
p65740
aVIf your xml was using a namespace it would have an  at the root
p65741
aVAlso, to help with callers you could add  (the  being the addition) to your  method, since  demands a public parameterless constructor
p65742
as(dp65743
g18
V23354
p65744
stp65745
a((dp65746
g2
(lp65747
VHttp
p65748
aVsys (which underpins HttpListener) dies not allow access by default unless you are running as an admin
p65749
aVYou can enable this using httpcfg (xp) or netsh (vista, win7 etc)
p65750
aVSee also this question
p65751
aVThis is separate to the firewall; for external connections you will also need to open a small hole in the firewall
p65752
as(dp65753
g18
V23354
p65754
stp65755
a((dp65756
g2
(lp65757
VLINQ isn't really intended for mutation anyway; however, you could use something like the  overload that includes the index
p65758
aVBut to be honest
p65759
aVJust loop and keep a counter
p65760
aVMuch easier to understand, and that matters
p65761
as(dp65762
g18
V23354
p65763
stp65764
a((dp65765
g2
(lp65766
VWith the alias approach attributes are preserved, but you state that is too much overhead (per-file etc)
p65767
aVType-level attributes are genercally preserved - but it depends on the attribute - for , note that it has:
p65768
aVthe  being significant - i
p65769
ag50
aVit is not inherited
p65770
aVPersonally I probably would have focused on getting the serialization ctor/callbacks working in the first example - I doubt it would have needed much more effort
p65771
aVThe following seems fine:
p65772
aVHowever, here's an alternative via encapsulation:
p65773
as(dp65774
g18
V23354
p65775
stp65776
a((dp65777
g2
(lp65778
VA "derivative" might mean "inherits from" or "subclasses", but either way that terminology would be wrong;  is an interface, so a type might implement this interface
p65779
aVEqually, the book is wrong - it doesn't:
p65780
aVThe  are enumerable, however;  gets that from it's base-class:
p65781
aVMSDN is indeed your friend, or just "show definition" in visual studio
p65782
as(dp65783
g18
V23354
p65784
stp65785
a((dp65786
g2
(lp65787
V is always an , but not every  is a ; or in class terms:
p65788
aVThe method in the first is actually inherited from  - it is really calling:
p65789
aV, and you need to assert that it is a  to push it into a  variable
p65790
aVAfter all, it could be another supported type of  - not just a bitmap
p65791
aVPresumably your  points to a bitmap-type image
p65792
aVIf you had:
p65793
aVthen life would be clearer
p65794
aVIn the second case, it just wants an  - any  will do;  is fine
p65795
as(dp65796
g18
V23354
p65797
stp65798
a((dp65799
g2
(lp65800
VExplicit pre-load in your init is probably still your best option
p65801
aVa  should be enough - along with some opaque method that can't be optimised away; perhaps:
p65802
aVThis avoids the
p65803
aVNote that this will be loaded, but not JITted etc
p65804
aVIf you wanted, you could do it on a BG thread:
p65805
as(dp65806
g18
V23354
p65807
stp65808
a((dp65809
g2
(lp65810
VClient proxies are based on WSDL or MEX; neither includes type metadata other than that defined in WSDL / MEX - after all, what would it mean to a Java / unmanaged C++ client
p65811
aVIf the client is
p65812
aVNET, then WCF also allows assembly-sharing  - i
p65813
ag50
aVuse the same DTO library at both client and server
p65814
aVThis is best done using a shallow DTO layer that is separate to your ORM etc, and is mainly only used on internal applications (where you own both ends of the pipe), but attributes will be preserved (as a consequence of it being the same dll)
p65815
aVFor class-level attributes, another option is to use a  to add the missing attributes; however, this doesn't work for members such as  /  (you cannot use a  to add attributes to existing members)
p65816
as(dp65817
g18
V23354
p65818
stp65819
a((dp65820
g2
(lp65821
VIt would only return 0 if the stream is closed, and hence no more data will ever come
p65822
aVOtherwise a positive number if data could be read, which may involve blocking if no data is yet available
p65823
aVIf  is true, the operation will throw after  has passed with no data available
p65824
aVIt sounds like maybe the socket has been left open and/or you are trying to read too much of you have an protocol that sends multiple chunks of data in a conversation
p65825
aVhttp://msdn
p65826
aVmicrosoft
p65827
aVcom/en-us/library/system
p65828
aVio
p65829
aVstream
p65830
aVreadtimeout
p65831
aVaspx
p65832
as(dp65833
g18
V23354
p65834
stp65835
a((dp65836
g2
(lp65837
VBinaryFormatter and NetDataContractSerializer include a lot of type metadata and field info, and it adds up
p65838
aVFor generating much smaller binary, I would recommend protobuf-net (disclosure: in the author), but note that I don't have a direct serializer swap-in for WCF on Silverlight so you would has to send byte[] as the args and handle manually, but it is small and fast
p65839
aVI want to improve that area
p65840
aVActually, with that setup regular http binding is then better, especially if you can enable MTOM
p65841
aVI hope to improve the Silverlight usage in time
p65842
as(dp65843
g18
V23354
p65844
stp65845
a((dp65846
g2
(lp65847
VUse  instead; this provides lid change notifications (add, remove, etc)
p65848
aVIt also provides row-level notifications (for property changes), but only if your type correctly implements ; so implement that
p65849
aVRe your "list is static" if you mean a  field, note that if you are
p65850
aVUsing multiple threads you might run into trouble with that; I wouldn't do it that way, personally - but that is unrelated to the question
p65851
aVExample:
p65852
as(dp65853
g18
V23354
p65854
stp65855
a((dp65856
g2
(lp65857
VYou can, with TypeBuilder - but this is not trivial stuff; you are essentially writing low-level things like IL at runtime
p65858
aVI do this occasionally, but I'm a bit crazy
p65859
aVThe two may be related
p65860
aVFor what you want (PropertyGrid) a simpler option is to provide runtime properties via PropertyDescriptor; I have several such "property bag" examples here on stackoverflow
p65861
aVHere's one such example:
p65862
aVNet Property Grid
p65863
aVIs there a way to let the Grid manipulate object in different way
p65864
aVBut even that is work compared to the simplest option: use a DataTable; add the columns you want and a single row, and pass the row's twin from the table's DefaultView to the PropertyGrid
p65865
as(dp65866
g18
V23354
p65867
stp65868
a((dp65869
g2
(lp65870
VBy passing the parent object you should have access to the property to change it; however, you may want to switch back to the UI thread (Dispatcher
p65871
aVInvoke) before doing this, as cross-threaded mutation of "observer" models rarely ends well
p65872
aVAnother approach is for your code to simply raise an event (nothing to do with this property), and have your UI code switch to the UI tread and update the view-model
p65873
aVThis approach separates the UI code cleanly from the "doing" code (since the "doing" code knows nothing of the view-model or threading), and is particularly useful if you need to support arbitrary UI models
p65874
as(dp65875
g18
V23354
p65876
stp65877
a((dp65878
g2
(lp65879
VHow about:
p65880
aVwhich should handle the common line-endings
p65881
aVAlternatively, if you have that string hard-coded or are assembling it at runtime - just don't add the newlines in the first place
p65882
as(dp65883
g18
V23354
p65884
stp65885
a((dp65886
g2
(lp65887
VYou claim small items are slower than BinaryFormatter, but every time I'e measured it I've found the exact opposite, for example:
p65888
aVPerformance Tests of Serializations used by WCF Bindings
p65889
aVI conclude, especially with the v2 code, that this may well be your fastest option
p65890
aVIf you can post your specific benchmark scenario  I'll happily help see what is "up"
p65891
aVIf you can't post it here, if you want to email it to me directly (see profile) that would be OK too
p65892
aVI don't know if your stated timings are possible under any scheme, but I'm very sure I can get you a lot faster than whatever you are seeing
p65893
aVWith the v2 code, the  gives the fastest result - it allows some IL tricks that it can't use if compiling to a physical dll
p65894
as(dp65895
g18
V23354
p65896
stp65897
a((dp65898
g2
(lp65899
VUI notifications are done typically via events
p65900
aVThis means, in this case, IBindingList and the  event; but also some side interfaces like IBindingListView, and a few other optional things for improved list adding etc
p65901
aVsupports pretty much everything you need, but as a consequence has some small overheads
p65902
aVBy contrast,  deliberately provides none of this; it is a general purpose (and fast) dynamic list device, not an "observer" device
p65903
aVNote you also typically need your type  to implement INotifyPropertyChanged if you want cell-by-cell updates; without this you can only get row-level updates (add, remove,  etc)
p65904
aVFor example:
p65905
as(dp65906
g18
V23354
p65907
stp65908
a((dp65909
g2
(lp65910
VIf the scenario demands it, adding an  attribute (specifying the details of the test assembly) can allow your test code to access normally private methods etc; however, this is best avoided when possible
p65911
aVMSDN has an example
p65912
as(dp65913
g18
V23354
p65914
stp65915
a((dp65916
g2
(lp65917
VThreads will not help you here; you are going to be blocked on IO
p65918
aVRather than 1 thread blocked on IO, you will now have multiple threads blocked on IO
p65919
aVIn fact, in many cases talking to the same resource (or parallel but related resources) on multiple threads will decrease IO throughput, plus the threading overheads
p65920
aVLose : lose
p65921
aVAlso - most streams are not designed for threading; you would need some very complex co-ordination code to make sure you reassemble the stream in the right order and don't mess up the internal state; frankly, it isn't worth it
p65922
as(dp65923
g18
V23354
p65924
stp65925
a((dp65926
g2
(lp65927
VActually in some cases you can tweak attributes at runtime - for example via  - but this only affects ComponentModel usage, not reflection usage
p65928
aVYou can also write the attribute itself to do things like resx lookup for i18n purposes
p65929
aVBut other options:
p65930
aVmaybe a static property, perhaps following a naming convention
p65931
aVa separate object model that talks about the types - a meta-model, so to speak
p65932
aVa configuration file or similar
p65933
aVAny will work; which is best depends on exactly what you have in mind
p65934
as(dp65935
g18
V23354
p65936
stp65937
a((dp65938
g2
(lp65939
VThere isn't anythig terrible about DataMember etc; they translate nicely to standard SOAP concepts
p65940
aVBut exceptions: less so
p65941
aVFor pure WCF, you should consider faults rather than raw exceptions, but in the general case I would instead return (as my result from the operation) an object that optionally includes information about expected failures
p65942
aVUnexpected failures should be left at the server, and a generic "oops" result returned
p65943
aVFor example, you could simply have something like:
p65944
aVwhere the caller should expect an  XOR a
p65945
aVAlso note that without DataContract / DataMember attributes there is a chance that the serializer is acting as a field serializer, which is something you really don't want
p65946
as(dp65947
g18
V23354
p65948
stp65949
a((dp65950
g2
(lp65951
VString literals need to surrounded in quotes and correctly escaped when used directly in a query, but that would be the wrong option here; because you can't trust the input, you should use a parameter in the assignment
p65952
aVDepending on the provider this may mean  or  etc - and adding the value into the  collection on your command object
p65953
aVUsing a parameter here will save you from SQL injection - a ridiculously easy way to kill or abuse a badly written app
p65954
as(dp65955
g18
V23354
p65956
stp65957
a((dp65958
g2
(lp65959
VFields should not really be directy exposed; instead add a property on the form:
p65960
aVThen access from your form instance:
p65961
aVAlso - make sure that  is disposed with the form; in pact personally I wouldnt keep it as a field at all - I'd have a strong field that I assign in a small block that creates, uses and disposes the dialog:
p65962
as(dp65963
g18
V23354
p65964
stp65965
a((dp65966
g2
(lp65967
VInheritance is an OO concept, that varies very little in
p65968
aVNET than in any other OO language, save that
p65969
aVNET allows single-inheritance (for classes) only; which is also pretty common
p65970
aVThe author is right that inheritance generally is easy to use incorrectly, and that generally encapsulation is a better option, but this is not specific to
p65971
aVNET in any way
p65972
aVThere are many times when it makes perfect sense to use inheritance, and you shouldn't shy away from it; polymorphism etc being a prime example
p65973
aVBut most standard "data in data out" code doesn't need polymorphism
p65974
aVIt is there, valuable - nay, essential (at least, to preserve sanity; you can of course avoid it if you like doing things the hard way)
p65975
aVFeel free to ignore it or use it
p65976
aVBut make your own decision
p65977
aVPersonally I think the author is being confusing and perhaps a bit short-sighted
p65978
as(dp65979
g18
V23354
p65980
stp65981
a((dp65982
g2
(lp65983
VAssuming that is a custom format, I would (and have) look to the XmlReader API; I would write a SomeFormatReader that rides a stream, and has a method for reading the next header
p65984
aVOnce the caller has seen this return true (false meaning EOF), the caller should be able to access a property to check the data format that follows, and be able to call any of ReadInt32, ReadString, ReadSingle etc to handle each (following the rules of the binary format)
p65985
aVIn my case, my reader class also handles additional data buffering, etc
p65986
aVYou may then choose to wrap that with a secondary layer that uses type metadata and the newly-written reader to populate your object model (any of reflection, code-generation, meta-programming, etc)
p65987
aVBut creating a good standalone reader is he first hurdle
p65988
as(dp65989
g18
V23354
p65990
stp65991
a((dp65992
g2
(lp65993
VIirc this is because it likes the stream to be seekable, and network streams aren't
p65994
aVTry copying the stream into a MemoryStream first (or a temp FileStream if huge), and work from that (remembering to set the position back to 0 before reading from it)
p65995
aVIn the case of a FileStream, you may find WebClient
p65996
aVDownloadFile more convenient
p65997
aVDitto WebClient
p65998
aVDownloadData for the in-memory approach
p65999
as(dp66000
g18
V23354
p66001
stp66002
a((dp66003
g2
(lp66004
VIn the %windir%\u005cMicrosoft
p66005
aVNET\u005cFramework\u005cv4
p66006
ag190
aV30319\u005cConfig folder are a number of  files; these are vanilla "as shipped" 4
p66007
aV0 files, so it should be OK to drop those over the non-
p66008
aVdefault ones
p66009
aVBut take a copy of the ones you replace as well, in case you're not on the right track - as this will essentially uninstall any changes you have made to your main configs
p66010
aVAlso; are you sure that your "webrelated" code is running 4
p66011
ag190
aVit might still be ASP
p66012
aVNET 2
p66013
aV0 with
p66014
aVNET 3
p66015
aV5SP1 (which includes a 3
p66016
aV0 service pack) - maybe you've only reverted to the vanilla 3
p66017
aV0 / 3
p66018
aV5 code
p66019
aVHard to tell from here
p66020
as(dp66021
g18
V23354
p66022
stp66023
a((dp66024
g2
(lp66025
VAs an alternative
p66026
aVJust don't; consider the non-generic IList interface:
p66027
aVWhile it isn't obligatory for all generic collections to implement IList, they pretty much all do, since it underpins such a lot of core framework code
p66028
as(dp66029
g18
V23354
p66030
stp66031
a((dp66032
g2
(lp66033
VYes, but only by invoking it:
p66034
aVAnd of course, the following is a lot simpler
p66035
aVIn the comments, cross-thread exceptions are mentioned; this can be fixed as follows:
p66036
aVIf the delegate is the thing we want to run back on the UI thread from a BG thread:
p66037
aVOr the other way around (to run the delegate on a BG):
p66038
as(dp66039
g18
V23354
p66040
stp66041
a((dp66042
g2
(lp66043
VRebuild the library as a sliverlight library; this will mean a new csproj, with mostly the same files
p66044
aVYou may (not always) find you also need to tweak the code to avoid any operations not available in the slimmer Silverlight BCL
p66045
as(dp66046
g18
V23354
p66047
stp66048
a((dp66049
g2
(lp66050
VIt all depends on what you define as "success"
p66051
aVIf it is a counter, that could still be the right result
p66052
aVIf you only want to update it if it is what you thought it was, then take a snapshot inside the first lock, and likewise compare to the snapshot in the final lock
p66053
aVIn that scenario you can replace much of the code with some  Interlocked
p66054
aVCompareExchange
p66055
aVLikewise in the "counter" scenario, Interlocked
p66056
aVIncrement is your friend
p66057
aVIf the code must match, then you have a few options:
p66058
aVif the compare fails, run the entire million lines again; repeat until you win the race (by matching)
p66059
aVif the compare fails, throw an exception
p66060
aVblock for the million lines; it might still be a fast million lines
p66061
aVthink of some other resolution strategy that makes sense for your scenario
p66062
aVIn the first two you should watch for polluting things by leaving any related data in an intermediate state
p66063
aVAnd btw; the final assignment to 0 should probably also be part of the same locking strategy
p66064
aVLocks only work if all access respects them
p66065
aVBut only your scenario can tell us what the "right" behaviour in a conflict is
p66066
as(dp66067
g18
V23354
p66068
stp66069
a((dp66070
g2
(lp66071
V has an implicit transaction
p66072
aVThe problem here that your transaction is timing out - you are simply doing too much
p66073
aVFor 200k rows I would use  into a staging table, and then run a command or SPROC to move that 200k into the actual table; perhaps with that command/SPROC in a transaction
p66074
aVis designed for this scenario - it is one continuous stream or raw TDS data, rather than however-may round-trips - and at the server end it is optimised too (but as a consequence, you must use a staging table, or you risk the inserts being non-logged)
p66075
as(dp66076
g18
V23354
p66077
stp66078
a((dp66079
g2
(lp66080
VConvenience is a biggie, especially since C# doesn't have the inner classes of Java; since it would be a single-method interface, this allows trivial subscription - perhaps via a method on the type, but perhaps even inline:
p66081
aVThe above also allows for full lexical capture of any variables etc (contrast with Java, which captures the values of any variables - not the variables themselves - so 2-way communication is possible)
p66082
aVTo do this with an interface I would need to declare a new class, implement the interface, provide a method to provied the implementation, and handle any variable/capture transfer
p66083
aVEvents also allow broadcast to multiple subscribers in a very convenient way
p66084
aVDelegates are also easier to create at runtime (for meta-programming etc) than classes are - for example I can create a delegate (from scratch) at runtime and subscribe it pretty easily, using either  (if I fancy IL) or  (if I fancy AST)
p66085
aVTo create a type and implement an interface is a bit more work (, , ,  and at least 2 s and s)
p66086
as(dp66087
g18
V23354
p66088
stp66089
a((dp66090
g2
(lp66091
VMy VB is very rusty, and I don't have a compiler in front of me
p66092
aVBut isn't it just
p66093
aVLet me know if I've dreamt this, and I'll delete
p66094
as(dp66095
g18
V23354
p66096
stp66097
a((dp66098
g2
(lp66099
VIn v1, the base will have to be decorated to know about the children
p66100
aVIn v2 this restriction is removed; you can create a model at runtime and define everything you want
p66101
aVIt can still read attributes too, this is all side-by-side (you can use different approaches on different types if you like)
p66102
aVYou might, however, choose to hide the RuntimeTypeModel details away behind your own API if the caller doesn't want to know any gory details
p66103
aVv2 is available to build from the trunk, and pretty much stable - there are some TODO items, though - mainly edge cases that need completing for full compatibility
p66104
aVMost people will not see these cases
p66105
as(dp66106
g18
V23354
p66107
stp66108
a((dp66109
g2
(lp66110
VLooking at this:
p66111
aVyou are treating arbitrary binary data as encoded text; that cannot work
p66112
aVAn  is intended to turn text data into binary (of a given text format, i
p66113
ag50
aVthe encoding), and to turn binary (of a given text format) back into text; it cannot treat arbitrary binary (that isn't in the expected format) as text
p66114
aVAs a trivial example, ASCII only uses 7 bits of each octet; any octet with the MSB set is guaranteed to get corrupted at some point during this cycle
p66115
aVIf you want to represent binary data as a string, use base-64:
p66116
aVto convert back:
p66117
as(dp66118
g18
V23354
p66119
stp66120
a((dp66121
g2
(lp66122
V is not thread safe; using it directly from multiple threads would cause #fail; having a global static data-context would cause #fail and would cause uncontrolled memory growth (the data-context includes an identity manager and change tracker for every object fetched; this only grows over time, as more objects are touched)
p66123
aVData context should ideally be used for a unit of work; spin one up; do something (that is bound in scope - i
p66124
ag50
aVnot the entire app lifetime), and dispose it
p66125
aVSo IMO the real answer here is "tie it to that unit of work"
p66126
aVOnly you can know what that is in your application; it could be a single method, it could a page request on a web page, it could be a timer "tick" in a service
p66127
aVWho knows
p66128
as(dp66129
g18
V23354
p66130
stp66131
a((dp66132
g2
(lp66133
VIt is used:
p66134
aVwhen coding an invoke, to provide sensible intellisense and to help the developer know which of 4 strings to pass in which position to a method(string,string,string,string) (for example)
p66135
aVin other tooling - for example implementing an event (or other delegate) and pressing tab to have the tooling generate a method stub (the parameter names from the delegate become the parameter names of the method-stub)
p66136
aVIn both cases this name adds meaning that aids the developer
p66137
aVFor example, I have no idea what your  represents - but name it something better and I'll have a clue
p66138
aVAs an alternative, use  and forget about it
p66139
as(dp66140
g18
V23354
p66141
stp66142
a((dp66143
g2
(lp66144
VHave you tried switching the column to the  data type
p66145
aVThis does everything you describe, pushing the data out of the database (onto the file-system)
p66146
aVOf course, access still needs to go though the server as TDS, but you may find the impact is less, and you can progressively change code to access the file more directly (for improved performance) - this last step would involve altering queries, however
p66147
as(dp66148
g18
V23354
p66149
stp66150
a((dp66151
g2
(lp66152
Vthen you can do (for example):
p66153
ag412
ag50
aVthe  of each group is the composite , and each group is also
p66154
aVNote that for database queries you should tell it your entire intent up front, for example:
p66155
aVso that it has the best possible chance to do a sensible query (not n+1)
p66156
as(dp66157
g18
V23354
p66158
stp66159
a((dp66160
g2
(lp66161
VI assume in the first case it can't choose between  and
p66162
aVOperations on  always result in an , so  is  and there is no ambiguity - it has to choose
p66163
as(dp66164
g18
V23354
p66165
stp66166
a((dp66167
g2
(lp66168
VI believe the correct answer here is going to involve code changes
p66169
aVYou can change the app's culture, but IMO that is incorrect since it overrides the user's preferences for display etc
p66170
aVNormally, you would throw the required culture the code uses into a static field somewhere, and pass that culture in for every bit of your code that interprets a system string literal
p66171
aVIn your cases, since the code literals are in an english format, you can pass in  each time and save some effort
p66172
aVYes, it'll be 100 code changes; frankly: tough
p66173
as(dp66174
g18
V23354
p66175
stp66176
a((dp66177
g2
(lp66178
VYou are blocking the UI thread, which means it isn't processing events such as "paint"
p66179
aVTo do this properly, you should be using something like , and just updating the UI from the progress event
p66180
as(dp66181
g18
V23354
p66182
stp66183
a((dp66184
g2
(lp66185
VUntested, but using zlib
p66186
aVnet I would have expected something like below to work; note that I'm using a  here to avoid having to seek (since that can't be universally supported - since the block length is a maximum of 4k, I am not concerned about this at all), but if you know you can seek you could write a dummy 0 for the compressed length, then write the data, then seek backwards to update the compressed length, and seek forwards to the end again:
p66187
as(dp66188
g18
V23354
p66189
stp66190
a((dp66191
g2
(lp66192
VYou need to give it more information; the simplest it to give it the typed array - for example, with a string array:
p66193
aVIt may (unsure) be possible to send untyped single-dimenstion arrays using  and  to specify the type - but by the time you've done that a typed array would have been easier
p66194
aVI doubt that multi-dimensional arrays are supported
p66195
as(dp66196
g18
V23354
p66197
stp66198
a((dp66199
g2
(lp66200
VIf the y values are unique, then maybe:
p66201
aVThis is then both keyed and sorted by the y values, but the keys must be unique
p66202
aVTo make things more complicated,  is also keyed and sorted; some minor differences in the O though - whether add or fetch is cheapest etc
p66203
as(dp66204
g18
V23354
p66205
stp66206
a((dp66207
g2
(lp66208
VEvents are really just an API with add/remove (technically there is an optional "invoke" available in the CLI, but the c# compiler doesn't provide it)
p66209
aVWhat you have there is a field-like event; field-like events act as the add/remove API from outside the declaring type, and act like the field only inside the declaring type, and only when it is necessary to treat as a delegate - most commonly: invoking the subscribers (this is a subtle change here in c# 4; before c# 4 all access from inside the type acts against the field, including +=/-=)
p66210
aVAn extension method by definition cannot be inside the declaring type - only top-level (non-nested) static classes can provide extension methods; so no extension method can ever have the direct ability to invoke a field-like event
p66211
as(dp66212
g18
V23354
p66213
stp66214
a((dp66215
g2
(lp66216
V(this line relates to a question that was merged) You should never use  - that will never work (and the compiler won't let you)
p66217
aVHowever,  and  (and their various overloads) are fair game
p66218
aVPersonally, I mainly only use  when I'm dealing with reflection, so for me the choice is  and
p66219
aVThe first is when I expect the value to be a valid integer, and want it to throw an exception otherwise
p66220
aVThe second is when I want to check if it is a valid integer - I can then decide what to do when it is/isn't
p66221
as(dp66222
g18
V23354
p66223
stp66224
a((dp66225
g2
(lp66226
VThe WCF model is vastly more flexible, essentially - if you only use it to present a basic http model using basic-profile and xml, with proxy objects - it'll appear very similar
p66227
aVA brief list of differences though:
p66228
aVmuch better support for emerging standards (although WSE2 and WSE3 are available for asmx, it is all much simpler in WCF)
p66229
aVMTOM inbuilt (and fixes a known bug that I remember finding in WSE3 with MTOM)
p66230
aVmuch wider range of supported transports/protocols etc, and the behaviours are fully configurable/extensible; for example allowing you to use a custom serializer/protocol/transport/etc seemlessly, just by changing the config
p66231
aVmuch richer configuration, both at config and runtime
p66232
aVfull support for inspectors and custom principals
p66233
aVability to share object-models if you want
p66234
aVyou can host it outside of a web-server; a console exe or service, for example
p66235
as(dp66236
g18
V23354
p66237
stp66238
a((dp66239
g2
(lp66240
VThat shouldn't be a database concern in the first place; the database's job is to store (wait for it) data
p66241
aVSo the appropriate query is just:
p66242
aVthen it is a UI concern to do something like (for example)
p66243
aVHowever, if you must do it at the database, :
p66244
as(dp66245
g18
V23354
p66246
stp66247
a((dp66248
g2
(lp66249
VFirstly, note that that isn't going to run at the db server, so this isn't really related to EF
p66250
aVI suspect it is in part because your  doesn't agree with ; you should ideally have something like:
p66251
aVsince that is what your  cares about
p66252
aVAlso, however, note that the entire query could be re-written (and will probably work at the db server if you use  (and remove the ), rather than ) with:
p66253
as(dp66254
g18
V23354
p66255
stp66256
a((dp66257
g2
(lp66258
VYou need to know the appropriate  that the device uses; it could be UTF-16, for example, in which case
p66259
aVor UTF-8:
p66260
aVbut for regional encodings / code-pages you'll have to use:
p66261
as(dp66262
g18
V23354
p66263
stp66264
a((dp66265
g2
(lp66266
Va: that should not be a struct, at all
p66267
aVb: the "value" of a struct is never null; even 's  is a bit of a magic-trick with smoke, mirrors and misdirection
p66268
aVRe the problem;
p66269
aV1: yes, that is because structs have copy semantics; you have altered a copy - not the same one
p66270
aV2: probably the same thing
p66271
aVHere's a more appropriate implementation; I imagine it'll fix most of your problems:
p66272
aVI'm unclear what the intent of the last 2 is, but personally I would prefer a list if it is a dynamic collection, for example:
p66273
as(dp66274
g18
V23354
p66275
stp66276
a((dp66277
g2
(lp66278
VWhat makes you think this is impacting you
p66279
aVIn particular, gen-0 collections are very, very cheap - and to be encouraged
p66280
aVI would look more at ""What might cause some of these requests to escape gen-0 into gen-1; am I clinging onto any object unnecessarily, for example via an event
p66281
aVOf course, another thing to look at is: are there any places you can avoid creating unnecessary objects, for example:
p66282
aVare you doing string concatenation in a loop that could be  instead
p66283
aVany moderate-to-large collections that could be initialized with the correct length to avoid reallocations
p66284
aVany scratch-buffers that could be reused
p66285
aVfor example, do you do a lot of encoding work that uses a  briefly in a method, where that  could be passed in as a scratch area, or grabbed from a pool
p66286
aVany other things that could be cached and re-used - for example, a  created inside a method, that could be made into a static field, plus compiled for performance
p66287
aVany intensive string parsing that could use interning
p66288
aV(not necessarily the inbuilt interner though)
p66289
as(dp66290
g18
V23354
p66291
stp66292
a((dp66293
g2
(lp66294
VOnly inside generics, i
p66295
ag50
aVOtherwise, you are going to have to pick between them, or have 2 variables
p66296
as(dp66297
g18
V23354
p66298
stp66299
a((dp66300
g2
(lp66301
VYou'll need a reference to the current assembly, i
p66302
ag50
aVsomething like:
p66303
aVhowever - the following will still fail:
p66304
aVbecause  is an instance method, not a  method
p66305
as(dp66306
g18
V23354
p66307
stp66308
a((dp66309
g2
(lp66310
VAliostad has posted a perfect answer for the specific case; but in the general case (of having an xml fragement):
p66311
aVsave the sample somewhere as
p66312
aVat the vs command prompt, run  (this generates an xsd from the xml)
p66313
aVat the vs command prompt, run  (this generates C# from the xsd)
p66314
aVcopy from
p66315
aVIn this case (using all the default options etc):
p66316
as(dp66317
g18
V23354
p66318
stp66319
a((dp66320
g2
(lp66321
VAs a reflection/Type- friendly alternative to TryParse:
p66322
as(dp66323
g18
V23354
p66324
stp66325
a((dp66326
g2
(lp66327
VChange the line  to remove the default, i
p66328
ag50
aVNow the compiler will tell you if there is a branch that doesn't assign it (of course, it can't tell you if you assign to  somehow)
p66329
aVNote also that there are at least 2 ways of getting  from a  (etc), but these are edge cases - I doubt they are contributing (mentioned for completeness only)
p66330
as(dp66331
g18
V23354
p66332
stp66333
a((dp66334
g2
(lp66335
VSet  to  on
p66336
as(dp66337
g18
V23354
p66338
stp66339
a((dp66340
g2
(lp66341
VI'm thinking using "Redis" as a backend here would allow most of what you want - although your requirements for "ranged searches" would need to be clearer to answer if fully
p66342
aVFor windows specifically, AppFabric is the Microsoft option
p66343
as(dp66344
g18
V23354
p66345
stp66346
a((dp66347
g2
(lp66348
VDo you mean  instead of
p66349
aVis a projection where for each item in the list it returns the string  - you now have a sequence of n-times-; you then try to force this into a list of
p66350
aVYou then further attempt to cast a  to , but there is no relationship between them other than
p66351
aVI expect you mean:
p66352
as(dp66353
g18
V23354
p66354
stp66355
a((dp66356
g2
(lp66357
V must know in advance, i
p66358
ag50
aVNow a   can serialize an  or a
p66359
aVYou can also do this without attributes by passing in a  parameter to the overloaded  constructor, but again - the root should be ; i
p66360
ag50
as(dp66361
g18
V23354
p66362
stp66363
a((dp66364
g2
(lp66365
VYou can use an anonymous method to capture them:
p66366
aVthis could be inline for small blocks, or for longer code - just pass to a method:
p66367
aVor if you need the sender/args:
p66368
aVor in C# 3
p66369
aV0:
p66370
as(dp66371
g18
V23354
p66372
stp66373
a((dp66374
g2
(lp66375
VUI controls have "thread affinity"; they do not want to be touched by anything except the UI thread; that includes reading and writing properties
p66376
aVThe assignment to  should be done from the UI thread, either by using , or
p66377
aVFor example:
p66378
aVBut note that this type of thread switching has overhead
p66379
aVYou should not call back every iteration - you should (for example) update the UI every [n] iterations - in the above, every 10000 for example
p66380
as(dp66381
g18
V23354
p66382
stp66383
a((dp66384
g2
(lp66385
VYou want  and also - not that if the time is in  you don't have to parse it - you can just sort it alphabetically, i
p66386
ag50
aVor via LINQ:
p66387
as(dp66388
g18
V23354
p66389
stp66390
a((dp66391
g2
(lp66392
VThe infamous captured-variable/foreach glitch; try:
p66393
aVand btw; static s are really dangerous - those event subscriptions won't unsubscribe themselves, so you could be keeping lots of things in memory unnecessarily
p66394
aVYou can make them self-unsubscribing, of course:
p66395
as(dp66396
g18
V23354
p66397
stp66398
a((dp66399
g2
(lp66400
VI'm not actually a fan of introducing extra dlls just "because"
p66401
aVBeen there; ot the t-shirt with the dependency graph on it
p66402
aVIf you can't clearly define the benefit in your environment/context, then do the simplest thing - which may well be reference from the web app
p66403
aVI've heard the argument of allowing re-use, but to counter: soap/mex is already pretty-much defining this
p66404
aVAnother argument is testability, isolation, separation etc; and it all depends on how much benefit these give you (or rather: your team) in your usage
p66405
aVOne very valid case for a separate dll here is when (mainly for internal apps) you are sharing a DTO library between the WCF server and client, so that both have rich objects rather than simple shadows
p66406
aVBit I gather (from the tone) that this doesnt apply in this case
p66407
as(dp66408
g18
V23354
p66409
stp66410
a((dp66411
g2
(lp66412
VI can see a problem; you are asking the MemoryStream for GetBuffer and using the buffer's length
p66413
aVA likely problem here is that GetBuffer returns the oversized backing buffer; you should either call
p66414
aVToArray() on the MemoryStream to get a correctly sized buffer, or if you don't want to allocate an extra array you can call GetBuffer() but you must only store the first memStream
p66415
aVLength bytes from that buffer; the rest should be considered garbage (it is most likely all zeros, but a leading zero is not valid in a protobuf field header)
p66416
aVNow, this could just be part of the issue, but we should eliminate it first
p66417
as(dp66418
g18
V23354
p66419
stp66420
a((dp66421
g2
(lp66422
VIt is spotting "order by {object}" and panicking; it knows how to order by , , , , etc - but  is a bit too vague
p66423
aVYou're going to need the actual lambda to be typed correctly; the simplest approach would be to make  generic, i
p66424
ag50
aVand then:
p66425
aVshould (without you changing the code at the caller) automatically make that a  in this case via generic type inference
p66426
aVThe other option is to leave it as , but re-write the expression tree at the receiver
p66427
aVMore work
p66428
as(dp66429
g18
V23354
p66430
stp66431
a((dp66432
g2
(lp66433
VThere is no specific limit - you are only constrained by memory here, and at this point the array already exists, so this isn't a limitation of
p66434
aVFor example:
p66435
aVI suspect you might (for example) have an  implementation that is throwing an error internally
p66436
aVOr alternatively, perhaps this error has nothing at all to do with , and you have simply considered the wrong line as the cause
p66437
aVThe exception's  should reveal everything, of course
p66438
aVAnd no: you shouldn't use  here
p66439
aVOr pretty much anywhere else
p66440
as(dp66441
g18
V23354
p66442
stp66443
a((dp66444
g2
(lp66445
VWriting it all in pure C# is possible but not very convenient when you are trying to achieve a specific html layout - it is painful to maintain, and very hard to work alongside a developer if you want to take their html and just tweak it to add the data
p66446
aVPersonally I'd look at MVC here; for example, I've been playing with razor recently which allows very elegant integration between C# and html in the same file:
p66447
aVThere I can:
p66448
aVclearly see at a glance how the code maps to the source I can see at the client
p66449
aVmake changes with confidence, both from visual inspection and the IDE telling me if I do something obviously wrong
p66450
aVcompare to the designer's draft easily
p66451
as(dp66452
g18
V23354
p66453
stp66454
a((dp66455
g2
(lp66456
VYou don't put the quotes into the parameter (those are to signify a literal); it should be:
p66457
aVIt is failing currently because if the text is "abc", it is looking for a string that starts and ends with a single quote and includes "abc"
p66458
aVIn SQL terms, you were asking it for:
p66459
as(dp66460
g18
V23354
p66461
stp66462
a((dp66463
g2
(lp66464
VBy taking this to a different thread, you are running outside of the http-context, which may well finish long before your zip operation does (tearing down all the things like inbound stream buffers) - yet you are talking to
p66465
aVYou have a few options; thinking off the top of my head
p66466
aVrun it on the request thread; it'll take a while, but meh
p66467
aVbuffer all the data you need in memory, and pass that to the zip operation
p66468
aVwrite the file to disk in a temp area (not the main app folder) from the request thread, then spawn a separate thread to process it from the temp area
p66469
aVbut to re-iterate: you can't access the request from another thread - or at least, you shouldn't
p66470
aVAlso, consider:
p66471
aVa request starts
p66472
aVyou spin up a thread to do the zip
p66473
aVyou return from the original request
p66474
aV(worker thread keeps on going)
p66475
aVyou need to think about what you are going to do with the zip filename; you can't just give it to the client - they are no longer listening to you
p66476
as(dp66477
g18
V23354
p66478
stp66479
a((dp66480
g2
(lp66481
VAt the point of validation, it is relying on a particular state, and it obviously isn't happy for you to start changing the rows when it only asked you to validate something
p66482
aVI can't say I blame it; having to re-validate the scenario after every event would get
p66483
aVconfusing; better to prevent the change
p66484
aVYou could instead queue the item for removal, on a timer of another callback, or maybe there is a mechanism for saying "no" during validation
p66485
as(dp66486
g18
V23354
p66487
stp66488
a((dp66489
g2
(lp66490
VIt depends what you need to do with it :)
p66491
aVOptions include:
p66492
aVpath (string)
p66493
aVcontents (string or byte[])
p66494
aVsome complex object model (od your own choosing) of the contents
p66495
aVFileInfo
p66496
aVFileStream (or just Stream)
p66497
aVsome kind of reader/writer; TextReader, XmlWriter etc
p66498
as(dp66499
g18
V23354
p66500
stp66501
a((dp66502
g2
(lp66503
VI'd this is LINQ-to-objects:
p66504
aVThen in the query:
p66505
as(dp66506
g18
V23354
p66507
stp66508
a((dp66509
g2
(lp66510
VUnfortunately,  is an all-or-nothing affair
p66511
aVIn order to do anything yourself, you have to do everything for that type, which is not ideal
p66512
aVTo make it harder, the processor isn't able to handle much by way of generics, making it hard to use encapsulation of some type you control as a workaround
p66513
as(dp66514
g18
V23354
p66515
stp66516
a((dp66517
g2
(lp66518
VIIRC, "yes" (just have a  parameter), but also "you shouldn't";  while
p66519
aVNET may know how to process it, web-services are meant to be interoperable based on xml entities; a  (even when serialized as xml) is about as far away from that as you can get
p66520
aVIMO it would be a better idea to write some basic classes that represent your model, and expose those to the web service, as they can be properly represented in xsd for SOAP purposes
p66521
as(dp66522
g18
V23354
p66523
stp66524
a((dp66525
g2
(lp66526
VIt isn't - the problem is that it needs to call some base constructor, in order to initialise the base type, and the default is to call
p66527
aVYou can tweak that by specifying the specific constructor (and arguments) yourself in the derived-types constructor:
p66528
aVFor parameters to  (or alternatively, ) constructors, you can use:
p66529
aVparameters to the current constructor
p66530
aVliterals / constants
p66531
aVstatic method calls (also involving the above)
p66532
aVFor example, the following is also valid, using all three bullets above:
p66533
as(dp66534
g18
V23354
p66535
stp66536
a((dp66537
g2
(lp66538
VYou want Web Developer, also part of the Express suite
p66539
aVAlso, I'm pretty sure Web Developer works fine with MVC - you might want to look at the MVC over web-forms, but both technologies have supporters (bother are ASP
p66540
aVNET; a lot of old texts incorrectly confuses "ASP
p66541
aVNET" and "webforms"; ASP
p66542
aVNET is the platform - webforms / MVC are specific methodologies within the platform)
p66543
as(dp66544
g18
V23354
p66545
stp66546
a((dp66547
g2
(lp66548
VNo, it isn't
p66549
aVYou must explicitly add them; the only default is the parameterless constructor calling , which you get if you don't add any constructors
p66550
aVIt might be nice in a few cases (especially when there are lots of constructors on the base), and I imagine there are some tools (maybe R#
p66551
aVI haven't checked) that might help automate it - but nothing built in
p66552
as(dp66553
g18
V23354
p66554
stp66555
a((dp66556
g2
(lp66557
VC# will treat them the same either way, but C# isn't the only consumer:
p66558
aVwill render it differently to allow combinations
p66559
aVwill accept / reject delimited combinations based on this flag
p66560
aVlikewise (from string), and the enum's  will behave differently
p66561
aVlots of other code that displays or processes the value will treat them differently
p66562
aVMore importantly, though, it is an expression of intent to other developers (and code); this is meant to be treated as combinations, not exclusive values
p66563
as(dp66564
g18
V23354
p66565
stp66566
a((dp66567
g2
(lp66568
VYes; in your  you need to tell it to associate itself with ; then the access problem goes away
p66569
aVUse the overload that sets  to , and  to
p66570
aVHowever, in most cases you should be able to go the the properties virtually as  quickly as the fields
p66571
aVSo prefer the properties unless there is a good reason to choose fields
p66572
aVOf course, if using attributes you can let the user decide, by decorating the most appropriate
p66573
as(dp66574
g18
V23354
p66575
stp66576
a((dp66577
g2
(lp66578
VWith reference to the link that Ani added, in this case it would be something like:
p66579
aVor maybe (to allow a -style usage)
p66580
as(dp66581
g18
V23354
p66582
stp66583
a((dp66584
g2
(lp66585
VIf the data is sized such that you can bring it all into memory, then you can do the join in LINQ-to-Objects; just add some  or  to the original queries - the LINQ to join them remains the same
p66586
aVHowever; this cannot be used to join at the server
p66587
aVFor that, either throw the tables you need into a single data-context, or cheat and use TSQL for that query
p66588
aVLINQ-to-SQL's  method is pretty handy for such purposes
p66589
as(dp66590
g18
V23354
p66591
stp66592
a((dp66593
g2
(lp66594
VThe example on MSDN gives part of the answer here; it seems to be useful for heterogeneous equality, rather than homogeneous equality - i
p66595
ag50
aVfor testing whether two objects (/values) of potentially different types should be considered equal
p66596
aVIn such scenarios, it is extremely likely that the calling code is dealing with  (to represent heterogeneous data)
p66597
aVAnd generic methods don't play nicely then
p66598
as(dp66599
g18
V23354
p66600
stp66601
a((dp66602
g2
(lp66603
VNo; with  it is the  operation that loads the data
p66604
aVAfter that, any LINQ you are doing is LINQ-to-Objects against the data already in memory
p66605
aVAnd I expect you are actually working against , not
p66606
aVEven if you called , that is still only a smoke-and-mirrors trick to expose LINQ-to-Objects as  (useful for code re-use) - it is still LINQ-to-Objects, and still operates only on the in-memory data ( offers the possibility of composed execution - not the promise of it)
p66607
as(dp66608
g18
V23354
p66609
stp66610
a((dp66611
g2
(lp66612
Vexplicit interface implementation:
p66613
aVNote that if the interface has a setter, you'll need to cast:
p66614
as(dp66615
g18
V23354
p66616
stp66617
a((dp66618
g2
(lp66619
VTypes in the root namespace can have a null namespace, so it is calling  on a null; just eliminate those first:
p66620
as(dp66621
g18
V23354
p66622
stp66623
a((dp66624
g2
(lp66625
VI might expect something like this if you have a cycle in the graph, but which is somehow not detected as an object identity failure
p66626
aVBy cyclic, I mean:
p66627
aVwhich throws the error:
p66628
aVObject graph for type 'Foo' contains cycles and cannot be serialized if reference tracking is disabled
p66629
aVThis is because it is trying to walk the tree (not a graph), and noticing a repeat (identical object reference), and stopping
p66630
aVHowever, by testing the above (and seeing when the  is called), it looks like DCS actually does this by spotting pain - the depth before it aborts is very high
p66631
aVLocally, I get 528 calls to  before it dies
p66632
aVIf you already have complex code above this in the stack, it could account for a stack overflow, for sure
p66633
as(dp66634
g18
V23354
p66635
stp66636
a((dp66637
g2
(lp66638
VThe method call can do everything; no need for a comparer:
p66639
aVNote the second is descending, by swapping x/y in the compare
p66640
as(dp66641
g18
V23354
p66642
stp66643
a((dp66644
g2
(lp66645
VI will have to investigate - presumably some nuance of attributes and overrides - I don't know of a specific change, but that is
p66646
aVunexpected
p66647
aVAs a trial, you could add  on the  - but please verify that it still serializes it (from the base-type)
p66648
ag412
ag50
aVFor info, I've tested your code against v2, and it worked perfectly in VS2010 targeting
p66649
aVNET 4
p66650
aV0; I don't have v1 handy on this machine
p66651
as(dp66652
g18
V23354
p66653
stp66654
a((dp66655
g2
(lp66656
VIf the existing session-state code uses , then you can cheat by getting protobuf-net to act as an internal proxy for , by implementing  on your root object only:
p66657
aVNotes:
p66658
aVonly the root object needs to do this; the any encapsulated objects will be handled automatically by protobuf-net
p66659
aVit will still ad d a little type metadata for the outermost object, but not much
p66660
aVyou will need to decorate the members (and encapsulated types) accordingly (this is best done explicit per member; there is an implicit "figure it out yourself" mode, but this is brittle if you add new members)
p66661
aVthis will break existing state; changing the serialization mechanism is fundamentally a breaking change
p66662
aVIf you want to ditch the type metadata from the root object, you would have to implement your own state provider (I think there is an example on MSDN);
p66663
aVadvantage: smaller output
p66664
aVadvantage: no need to implement  on the root object
p66665
aVdisadvantage: you need to maintain your own state provider ;p
p66666
aV(all the other points raised above still apply)
p66667
aVNote also that the effectiveness of protobuf-net here will depend a bit on what the data is that you are storing
p66668
aVIt should be smaller, but if you have a lot of overwhelmingly large strings it won't be much smaller, as protobuf still uses UTF-8 for strings
p66669
aVIf you do have lots of strings, you might consider additionally using gzip - I wrote a state provider for my last employer that tried gzip, and stored whichever (original or gzip) was the smallest - obviously with a few checks, for example:
p66670
aVdon't gzip if it is smaller than [some value]
p66671
aVshort-circuit the gzip compression early if the gzip ever exceeds the original
p66672
aVThe above can be used in combination with protobuf-net quite happily - and if you are writing a state-provider anyway you can drop the  etc for maximum performance
p66673
aVA final option, if you really want would be fore me to add a "compression mode" property to ; which:
p66674
aVwould only apply for the  usage (for technical reasons, it doesn't make sense to change the primary layout, but this scenario would be fine)
p66675
aVautomatically applies gzip during serialization/deserialization of the above [perhaps with the same checks I mention above]
p66676
aVwould mean you don't need to add your own state provider
p66677
aVHowever, this is something I'd only really want to apply for "v2" (I'm being pretty brutal about bugfix only in v1, so that I can keep things sane)
p66678
aVLet me know if that would be of interest
p66679
as(dp66680
g18
V23354
p66681
stp66682
a((dp66683
g2
(lp66684
VIf you only have the  as a string, you may as well just use your existing code
p66685
aVProblems:
p66686
aVyou could pass your existing TQL code to , but you'd need to know what type to expect
p66687
aVto pull it a part and handle properly from LINQ you would have to parse the , which is not a trivial exercise
p66688
aVHowever, in LINQ terms what you describe is essentially the same as:
p66689
aVwith usage for example:
p66690
aVIf you want to work from strings, it is also possible to build expression trees at runtime based on property names / values
p66691
aVNot sure if that is what you want though
p66692
as(dp66693
g18
V23354
p66694
stp66695
a((dp66696
g2
(lp66697
VFor simple cases, the advantage is mainly convenience
p66698
aVObviously you have more options (working path, choosing between shell-exec, etc) with the ProcessStartInfo route, but there is also a Process
p66699
aVStart(ProcessStartInfo) static method
p66700
aVRe checking for errors; Process
p66701
aVStart returns the Process object, so you can wait for exit and check the error code if you need
p66702
aVIf you want to capture stderr, you probably want either of the ProcessStartInfo approaches
p66703
as(dp66704
g18
V23354
p66705
stp66706
a((dp66707
g2
(lp66708
VYou need to redirect stdout when spawning the child process; MSDN has a complete example: http://msdn
p66709
aVmicrosoft
p66710
aVcom/en-us/library/system
p66711
aVdiagnostics
p66712
aVprocessstartinfo
p66713
aVredirectstandardoutput
p66714
aVaspx
p66715
aV(from MSDN):
p66716
as(dp66717
g18
V23354
p66718
stp66719
a((dp66720
g2
(lp66721
VFixed32 always uses 4 bytes for the length prefix - this seems to be not uncommon for people packing messages manually (indeed, I even had to add different-endian versions at some point, due to repeat requests)
p66722
aVThe preference though should be Base128, which uses "varint" encoding, so small numbers take less space to encode
p66723
aVAdditionally, this prefix style can be used to make a sequence of objects wire-compatible with a single object with a  field, which has some useful applications
p66724
aVRe getting the length; if you are using  or  you shouldnt need to - it handles it internally
p66725
aVBut if you need this, look at
p66726
aVTo clarify: the purpose of the  methods is to allow separation of different objects/messages in a single stream - most commonly: network sockets
p66727
aVThis is necessary because the protocol itself otherwise assumes an entire stream is a single message, so would keep trying to read until the stream/socket was closed
p66728
aVRe the 22 vs 21 bytes; that is because the length prefix itself takes some length :) actually if the array is 22 I'm a little surprised the payload isn't 20 - I byte field headed (to make the composed stream itself a valid protobuf stream), 1 byte length, and 20 bytes payload
p66729
aVI'm on a mobile at the moment, so I can't run the sample to investigate; it is possible to omit the field-header (optionally), though - so it could be 1 byte length, 21 bytes payload
p66730
aVI'll look later
p66731
as(dp66732
g18
V23354
p66733
stp66734
a((dp66735
g2
(lp66736
VI sounds simply like a missing assembly reference to assembly: System
p66737
aVRuntime
p66738
aVSerialization (in System
p66739
aVRuntime
p66740
aVSerialization
p66741
aVdll)
p66742
as(dp66743
g18
V23354
p66744
stp66745
a((dp66746
g2
(lp66747
VIIRC dblinq does why you need, and I believe it is now included in mono by default
p66748
as(dp66749
g18
V23354
p66750
stp66751
a((dp66752
g2
(lp66753
VBoth json (via the gson library) and protobuf are portable between platorms; but
p66754
aVprotobuf is smaller (bandwidth) and cheaper (CPU) to read/write
p66755
aVjson is human readable / editable (protobuf is binary; hard to parse without library support)
p66756
aVprotobuf is trivial to merge fragments - just concatenate
p66757
aVjson is easily passed to web page clients
p66758
aVthe main java version of protobuf needs contract-definition (
p66759
aVproto) and code-generation; gson seems to allow arbitrary pojo usage (there are protobuf implementations that work on such objects, but not for java afaik)
p66760
aVIf performance is key : protubuf
p66761
aVFor use with a web page (JavaScript), or human readable: json (perhaps via gson)
p66762
as(dp66763
g18
V23354
p66764
stp66765
a((dp66766
g2
(lp66767
VA common problem here is to use the types before you have chance to register the assembly-resolve event
p66768
aVIn particular, note that the system must be able to JIT a method before it can start running a method - including
p66769
aVSo if your entry-point () does the event hooking and also talks to the types in question, it will attempt to resolve the types (for JIT) before or has chance to subscribe
p66770
aVDo the minimum in main; move the "real" code to another method, that is only invoked once the event is definitely subscribed
p66771
aVFor example:
p66772
aVIn extreme cases you may even need to use MethodImplAttribute to disable inlining of the methods above
p66773
as(dp66774
g18
V23354
p66775
stp66776
a((dp66777
g2
(lp66778
VYou have a  - so if you want them concatenated, something like
p66779
aVwould work (in
p66780
aVNET 4
p66781
aV0 at least)
p66782
aVThe first parameter is the delimiter
p66783
aVSo you could also comma-delimit etc
p66784
aVYou might also want to look at using StringBuilder to do running concatenations, rather than forming a list
p66785
as(dp66786
g18
V23354
p66787
stp66788
a((dp66789
g2
(lp66790
VRe assasins creed - probably a typo
p66791
aVLook very carefully at the value in the cell and in your query - for example, is it assassin vs assassins
p66792
aVRe the others (not in the query); you need to add a "where" clause, otherwise it applies to every row in the table; that is how SQL works
p66793
aVI'm guessing an IN filter would be best here
p66794
aVFr example
p66795
as(dp66796
g18
V23354
p66797
stp66798
a((dp66799
g2
(lp66800
VWhen you use the IDE you are just providing the template (and other configuration metadata); you must still provide the actual data-source at runtime, for example by populating an object model or DataTable and assigning that as the DataSource of either the DataGridView or (more commonly when using the IDE) the BindingSource object that the designer added
p66801
as(dp66802
g18
V23354
p66803
stp66804
a((dp66805
g2
(lp66806
VIn the updates you are mutating every object; so it can't be better than O(n), which it is already
p66807
aVNo optimisation is necessary
p66808
aVAs a refactor, I'd take away the  - you aren't using it
p66809
aVYou might also consider a common base-class or interface, then all 3 could share a single generic method
p66810
aVIn c# terms:
p66811
as(dp66812
g18
V23354
p66813
stp66814
a((dp66815
g2
(lp66816
VIf you want to continue with the next folder after a fail, then yea; you'll have to do it yourself
p66817
aVI would recommend a  (depth first) or  (bredth first) rather than recursion, and an iterator block (); then you avoid both stack-overflow and memory usage issues
p66818
aVExample:
p66819
as(dp66820
g18
V23354
p66821
stp66822
a((dp66823
g2
(lp66824
VThe database cache is different to most caches - it can if course load used data into memory and re-use query plans, but that isn't really a cache as such
p66825
aVAppFabric is definitely not just azure; after all, I it was you wouldnt be able to install it (and use it) locally :) but in truth there is little between AppFabroc, redis and memcached (the latter lacks persistance, of course)
p66826
aVBut I think you should initially look at using the inbuilt asp
p66827
aVnet caching; both data caching via HttpContext
p66828
aVCache, and caching of entire responses (or, in MVC 3, partials)
p66829
aVObviously you should have a broad idea of what data is used heavily by lots of requests, and is safe to re-use : cache that
p66830
aVJust make sure you treat all cached FAA as immutable (if you need to update the cache, re-add a modified value; don't modify the existing objects) - reason: it won't work the same if you start needing to use distributed caching, as that uses serialization, and any changes you make won't be seen by the next request
p66831
as(dp66832
g18
V23354
p66833
stp66834
a((dp66835
g2
(lp66836
VFull trust is more than "everything"; it is "disable checks" - so no, you can't have "full trust except {foo}", because there would still be nothing checked
p66837
aVYou will have to have an inclusive, albeit large, set
p66838
aVAnd I'm sure there are some pretty nasty things I can do that aren't writing files
p66839
as(dp66840
g18
V23354
p66841
stp66842
a((dp66843
g2
(lp66844
VSince you are working from an object model, there seems to be no need to use  here all - just set the  to a  (or better: ) and away you go
p66845
aVis perfectly happy binding to objects, and the underlying object is just  on each row
p66846
aVNote - for two-way data-binding (i
p66847
ag50
aVIf you want the grid to update when you edit an object directly through code) you might want to use  and implement  - but this isn't necessary if you just want to display a list and edit items via the grid
p66848
as(dp66849
g18
V23354
p66850
stp66851
a((dp66852
g2
(lp66853
VFor the first:
p66854
aVFor the second, you'd need to be explicit about what  should return, but I expect it involves  or
p66855
as(dp66856
g18
V23354
p66857
stp66858
a((dp66859
g2
(lp66860
VDon't edit the designer file; the beauty of partial classes is that you can create a separate file with just
p66861
aV(assuming that we are using implicit interface implementaion by virtue of having properties that match the required interface)
p66862
aVSmall word of caution though: if you are using VS2008 and you have  and , do not call this file  - there is a bug in VS2008 that makes this a nuisance (you have to keep moving the  directives inside the namespace, or the code-generator breaks) - fixed in VS2010 though
p66863
aVAlso, if it was a single interface, that every type in your model implemented, you can cheat by specifying that at the object base-type in the DBML
p66864
aVThe designer doesn't show this option, but if you edit the DBML manually it works fine
p66865
as(dp66866
g18
V23354
p66867
stp66868
a((dp66869
g2
(lp66870
VIn xml, case and namespace are fundamentally important, and whitespace and attribute-order aren't (making direct string compares incorrect)
p66871
aVSo IMO you should parse it; perhaps with , but (as you note) both are trivially parsed with LINQ-to-XML:
p66872
aVThen it is just a case of comparing the values
p66873
aVAn alternative is to use something like xslt to pre-process one of the files to match the expected layout of the other, so you can share parsing code
p66874
aVIt depends whether you are already familiar with xslt, I guess
p66875
as(dp66876
g18
V23354
p66877
stp66878
a((dp66879
g2
(lp66880
VYou can't pluck a reference out of the air in IL, unless you code the reference as a literal which a: don't do it, b: you'd need to pin, and c: don't do it
p66881
aVThe best approach depends on the signature of the method you are writing
p66882
aVIf it is static and takes no arguments
p66883
aVwell, that is a bit tricky
p66884
aVPersonally I'd be inclined to pass an object into the generated method, and have the delegate fetch any external data it needs from there; but another approach is to generate instead a class, and write the method as an instance method that accesses fields on the types
p66885
aVThe difference (hence my preference) is that the first requires (at most) an  parameter on the method - and you can use ; the second requires , , , , etc ;p More work
p66886
aVThe reason I mention  is that generally you want a common signature over the generated methods, even if they require different inputs
p66887
aVThis lets you bind to a fixed delegate type and use the faster  execution ( is slow)
p66888
aVFor example:
p66889
aVIf you can't have an input argument, then you'll have to use fields on a type you create - which is actually exactly what the compiler does if you write (for example)
p66890
aVThis is created as:
p66891
as(dp66892
g18
V23354
p66893
stp66894
a((dp66895
g2
(lp66896
VWith the error message from the comments, that sounds like an IIS setting
p66897
aVIn IIS, look at the site properties - in particular any "security" tabs etc - you should find there is a checkbox for requiring SSL
p66898
aVIf you are sure that it is valid for the entire site to be available without SSL (presumably it was checked for a reason
p66899
aV, consider unchecking it
p66900
aVBut emphasis: this is for the entire site
p66901
aVRe the certificate error, that probably means your certificate is either expired or has the wrong host - in the same area there should be an option to change the certificate
p66902
aVTo use SSL you will need to obtain a valid certificate
p66903
as(dp66904
g18
V23354
p66905
stp66906
a((dp66907
g2
(lp66908
Vwhen iam using the class object cleave below the for loop
p66909
aVyou don't show anything below the  loop, and  isn't declared in the method - so we infer that it is a field
p66910
aVWe can therefore assume one of two things:
p66911
aVthe date selected wasn't a valid date, so  was never assigned
p66912
aVthe event hasn't fired,  has never been invoked - so again,  hasn't been assigned
p66913
as(dp66914
g18
V23354
p66915
stp66916
a((dp66917
g2
(lp66918
VThe protobuf format is a linear sequence of items; any indexing etc you way can only be applies separately
p66919
aVHowever,  is available; you might find that:
p66920
aVdoes the job nicely; this:
p66921
aVis lazily spooled; each item is yielded individually, so you don't need a glut of memory
p66922
aVis short-circuited; if the item is found near the start, it'll exit promptly
p66923
aVOr for multiple items:
p66924
aV(add a ToList to te end of the above if you want to buffer the matching items in memory, or use without a ToList if you just want to parse it once in a forwards-only way)
p66925
as(dp66926
g18
V23354
p66927
stp66928
a((dp66929
g2
(lp66930
VYes, this is pretty much expected http behaviour
p66931
aVOptions:
p66932
aVhave a large timeout (you've already done this), and accept that it could take a long time to legitimately time out (as opposed to taking a while because of bandwidth)
p66933
aVmaybe you can apply gzip on the request (and tell the server you're sending it compressed); I honestly don't know if this is supported automatically, but it could certainly be done by the api explicitly checking for a particular header and applying gzip decompression on the payload
p66934
aVchange the api to perform a number of small uploads, and a completion message
p66935
aVlive with it
p66936
as(dp66937
g18
V23354
p66938
stp66939
a((dp66940
g2
(lp66941
VIf it is part of the message, then at the moment: no
p66942
aVSince it is field 1, I could potentially pre-screen them, but even that is a hack (there is no guarantee that field 1 is first - the spec makes it clear that you must allow for any ordering)
p66943
aVHowever
p66944
aVthere may be an option, if you are open to a little refactoring
p66945
aVIf this is a linear heterogenous sequence of messages, then another way to encode it is to use the  implementation, passing a different tag for each message type - then you have a sequence like (being a bit liberal with the representation)
p66946
aVof course it depends a bit on the other end matching, but unless I am mistaken this ties in pretty well with the SAX-like processing discussed here (as a proposal), which incidentally is also entirely compatible with how the NonGeneric deserialize works
p66947
aVHere's an example, that only deserializes the  objects, showing "2" and "4" on the console:
p66948
aVOn the wire, this is actually compatible with a parent object:
p66949
aVIf the proposed  gets implemented you should be able to consume the same type of heterogenous data stream from any client
p66950
aVThe obvious mapping would be something like an optional property on  to help with this - but I don't want to add that until the new protobuf feature is clear, as so far it looks like an exact match to my implementation
p66951
aVWhich is nice
p66952
as(dp66953
g18
V23354
p66954
stp66955
a((dp66956
g2
(lp66957
VAny time you do a  you are failing to check the result code
p66958
aVIt would be rare to always have enough data to fill the 4 bytes
p66959
aVRefactor that into a "read me 4 bytes" method that does it properly, checking (loop) that 4 bytes have been read
p66960
aVActually, I find it odd that you do this correctly when filling the buffer, but not when reading the ints / single
p66961
aVFor example you could have (in C# terms)
p66962
aVthen
p66963
aVetc
p66964
as(dp66965
g18
V23354
p66966
stp66967
a((dp66968
g2
(lp66969
VA circular buffer should do the job; easy enough to wrap a list or array, but nothing built in AFAIK
p66970
as(dp66971
g18
V23354
p66972
stp66973
a((dp66974
g2
(lp66975
V is a method variable  (in ) - it only makes sense in the context of that method
p66976
aVIf you want it to be an object level variable (field), then relocate it:
p66977
aVand don't declare it in  - just assign it:
p66978
as(dp66979
g18
V23354
p66980
stp66981
a((dp66982
g2
(lp66983
VThis sounds like a web-server configuration issue;
p66984
aVis the application marked as an application in IIS (does it have a cog)
p66985
aV- it should
p66986
aVis the application configured to use the correct version of ASP
p66987
aVNET (i
p66988
ag50
aVnot 1
p66989
aVx)
p66990
aVis
p66991
aVNET 3
p66992
aV0 or above installed on the server
p66993
aVdoes the framework master web
p66994
aVconfig contain the
p66995
aVsvc mappings
p66996
aVre the last, I've seen a glitch here where the install doesn't touch the config at all if it isn't quite how it expected to find it; so if you have manually changed the master web
p66997
aVconfig on the server you may need to apply the 3
p66998
aV0 changes manually
p66999
aVfor example, in  you should have something like (for 3
p67000
aV0):
p67001
aVin  you should have something like (for 3
p67002
aV0):
p67003
aVand there should be a host of extra things in , such as:
p67004
aVthis is just from a quick scan - there may be others, and the exact values may change per environment
p67005
as(dp67006
g18
V23354
p67007
stp67008
a((dp67009
g2
(lp67010
VThere isn't an F# specific one listed here, but there is an OCaml one, or there is a
p67011
aVNET "general" one (protobuf-net)
p67012
aVIn all honesty, I simply haven't gotten around to trying protobuf-net with F# objects, in part because I simply don't know enough F#, but if you can create POCOs they should work
p67013
aVThey would need to have some kind of mutability (perhaps even just private mutability) to work with protobuf-net, though
p67014
aVIf you are happy to generate a C# DTO and just consume that from F#, then protobuf-net or Jon's port should work just fine
p67015
as(dp67016
g18
V23354
p67017
stp67018
a((dp67019
g2
(lp67020
VThe enums are implemented as public static readonly fields (probably also const); your current code should work
p67021
aVYou just need to get the name from the FieldInfo
p67022
aVAnd call GetValue if you want the value
p67023
aVHowever, Enum
p67024
aVGetValues(type) is easier
p67025
as(dp67026
g18
V23354
p67027
stp67028
a((dp67029
g2
(lp67030
VOption 1 - you get all the advantages and none of the pain
p67031
aVJust use something factory-oriented (i
p67032
ag50
aVDon't do , but instead stick that code somewhere central like a static  method, or consider an IoC/DI container)
p67033
aVHow to consume WCF web service through URL at run time
p67034
as(dp67035
g18
V23354
p67036
stp67037
a((dp67038
g2
(lp67039
V(btw, it doesn't tie to the question, but you should aim to avoid public fields, for lots of reasons covered in many stackoverflow questions)
p67040
aVQ3: Simply:
p67041
aVQ2 re the top level name; you can use
p67042
aVQ2 re member names:
p67043
aV(see also )
p67044
aVQ1 Removing the xsi etc can be done with :
p67045
as(dp67046
g18
V23354
p67047
stp67048
a((dp67049
g2
(lp67050
Vin many data-in/data-out cases, no
p67051
aVin some cases, yes
p67052
aVIf all you need to work with is a simple navigation hierarchy (mainly focusing on parent, sibling, child, etc), then LINQ and it's friends are excellent choices - they reduce the pain (and effort and risk) from the majority of queries
p67053
aVBut there are a number of scenarios where it doesn't work so well:
p67054
aVlarge-scale set-based operations: I can do a wide-ranging query in TSQL without the need to drag that data over the network in one large query, and then (even worse) update each record individually (since in many cases the ORM tools will choose individual UPDATE/INSERT/DELETE operations etc)
p67055
aVNot only is this slow, it increases the chances of data drift
p67056
aVSo to counter that you might add a transaction - but a long-lived transaction (while you suck a glut of data over the network) is bad
p67057
aVsimply: there are a lot of queries where hand-tuning it achieves things that the ORMs simply can't; I had a scenario recently where a relatively basic LINQ query was performing badly
p67058
aVI hand tuned it (using some  etc) and the IO stats went down to only 5% of what they were with the generated query
p67059
aVthere are some queries that are exceptionally difficult to express in some query syntax options, and even if you do - would lead to bad queries
p67060
aVYet which can be expressed very elegantly in TSQL: example: Linq to Sql: select query with a custom order by
p67061
as(dp67062
g18
V23354
p67063
stp67064
a((dp67065
g2
(lp67066
V is a flat list (so no huge increase in memory footprint), that uses binary-search for access - so  - so not as fast as  at  - but much better than a  (or other linear search) at
p67067
aVIf you want fastest access, you need to use extra memory for a hash-table
p67068
aVAs a side-note,  also allows efficient access by int index, which is hard for , and virtually meaningless for
p67069
aVObviously in your scenario you may need to combine  with either nesting or a composite key - but IMO that is going to be your best route for getting a balance of memory and accessor-performance
p67070
aVYou could use a dedicated composite key, i
p67071
ag50
aVan iummutable  with the composite key members, overriding  and , implementing , and for sorting: implementing  and
p67072
as(dp67073
g18
V23354
p67074
stp67075
a((dp67076
g2
(lp67077
VIf each first-level element in the xml is a record, i
p67078
ag50
aVThen you could create an  implemention that reads the xml (via ) and presents each as a record, to be imported using
p67079
aVPretty much like my old answer here
p67080
aVAdvantages:
p67081
aVis the fastest way to get data into a database
p67082
aVstripping it into records makes appropriate use of a database, allowing indexing and proper typing
p67083
aVit doesn't rely on a huge BLOB going over the wire in an atomic way (necessary for the xml data type)
p67084
as(dp67085
g18
V23354
p67086
stp67087
a((dp67088
g2
(lp67089
VFrom a , if you  you'll get a non-positive result, and if you  you'll get a negative result
p67090
aVWith a , the documentation suggests that  should return negative:
p67091
aVReturn Value
p67092
aVType: System
p67093
aVInt32
p67094
aVThe next available character, or -1 if no more characters are available or the stream does not support seeking
p67095
aVare you sure this isn't a corrupt stream
p67096
ag412
ag50
aVthe remaining data cannot form a complete  from the given encoding
p67097
as(dp67098
g18
V23354
p67099
stp67100
a((dp67101
g2
(lp67102
VI suspect you just need to provide a deserialization constructor to , since dictionary implements :
p67103
aVchecked (passes):
p67104
as(dp67105
g18
V23354
p67106
stp67107
a((dp67108
g2
(lp67109
VEven unsigned integers aren't compliant (at least, on the public API), yet they are very important to people who do bit-shifting, in particular when right-shifting (signed and unsigned have different right-shift behaviours)
p67110
aVThey are ultimately there to give you the freedom to use them when appropriate
p67111
aVThe case-sensitivity one I could get less religious about - despite the convenience of having a field and property differ only by case, I think I could live happily with being forced to use a different name
p67112
aVEspecially now we have automatically implemented properties
p67113
aVThis is similar to how it lets you use  - the difference here being that a few unsigned integers aren't going to destabilise the entire runtime, so they don't need quite as strong molly-guards
p67114
aVYou can add:
p67115
aVif you like, and the compiler will tell you when you get it wrong
p67116
aVAnd finally: most code (by volume) is not consumed as a component
p67117
aVIt is written to do a job, and maybe consumed by other code in-house
p67118
aVIt is mainly library writers / vendors that need to worry about things like CLS compliance
p67119
aVThat is (by the numbers) the minority
p67120
as(dp67121
g18
V23354
p67122
stp67123
a((dp67124
g2
(lp67125
VIf large data volume is your main concern,  may be ideal
p67126
aVThe API is perhaps not as elegant as  etc, but it is the most direct and efficient mechanism, and is designed for firehosing a one-way stream of data
p67127
aVIt has a twin, , but that is much harder to get right - due to the complexities of processing incoming xml and accounting for child trees appropriately
p67128
as(dp67129
g18
V23354
p67130
stp67131
a((dp67132
g2
(lp67133
VThe mapping is done by inspecting the  and using reflection - and  is really just a fancy word for  in this context
p67134
aVFor now, you may have to just create the type that matches the expected layout
p67135
aVYou could try passing in , but I haven't tried this, and I'm not sure it will realise to map ctor arg 0 to col 0, etc
p67136
aVI use code like in the question quite a bit, and creating a meaningful stub class usually isn't a problem, especially with automatically implemented properties
p67137
as(dp67138
g18
V23354
p67139
stp67140
a((dp67141
g2
(lp67142
VHow about:
p67143
as(dp67144
g18
V23354
p67145
stp67146
a((dp67147
g2
(lp67148
VGenerally with encryption there isn't a 1:1 mapping between input bytes and output bytes, so in order to seek backwards (in particular) it would have to do a lot of work - perhaps even going right back to the start and moving forwards processing the data to consume [n] bytes from the decrypted stream
p67149
aVEven if it knew where each byte mapped to, the state of the encryption is dependent on the data that came before it (it isn't a decoder ring ;p), so again - it would either have to read from the start (and reset back to the initialisation-vector), or it would have to track snapshots of positions and crypto-states, and go back to the nearest snapshot, then walk forwards
p67150
aVLots of work and storage
p67151
aVThis would apply to seeking relative to either end, too
p67152
aVMoving forwards from the current position wouldn't be too bad, but again you'd have to process the data - not just jump the base-stream's position
p67153
aVThere isn't a good way to implement this that most consumers could use - normally if you get a  from  that means "random access", but that is not efficient in this case
p67154
aVAs a workaround - consider copying the decrypted data into a  or a file; then you can access the fully decrypted data in a random-access fashion
p67155
as(dp67156
g18
V23354
p67157
stp67158
a((dp67159
g2
(lp67160
VSince the path is explicit, it sounds like a permissions issue - simply: the account that the application / app-pool is running as (in IIS) doesn't have access to that folder
p67161
aVHowever, unless it has changed recently, you should note that Excel is not supported for use on a server - it is desktop software, and you may run into a multitude of issues using it on a server
p67162
aVAnd I have no idea whether this would be a licensed scenario ;p
p67163
as(dp67164
g18
V23354
p67165
stp67166
a((dp67167
g2
(lp67168
VThere are two ways to dodge this:
p67169
aVuse the ColumnMappings to formally define the column relationship (you note you don't want this)
p67170
aVpush the data into a staging table - a basic table, not part of your core transactional tables, whose entire purpose is to look exactly like this data import; then use a TSQL command to transfer the data from the staging table to the real table
p67171
aVI always favor the second option, for various reasons:
p67172
aVI never have to mess with mappings - this is actually important to me ;p
p67173
aVthe insert to the real table will be fully logged ( is not necessarily logged)
p67174
aVI have the fastest possible insert - no constraint checking, no indexing, etc
p67175
aVI don't tie up a transactional table during the import, and there is no risk of non-repeatable queries running against a partially imported table
p67176
aVI have a safe abort option if the import fails half way through, without having to use transactions (nothing has touched the transactional system at this point)
p67177
aVit allows some level of data-processing when pushing it into the real tables, without the need to either buffer everything in a  at the app tier, or implement a custom
p67178
as(dp67179
g18
V23354
p67180
stp67181
a((dp67182
g2
(lp67183
VWhile Stefan has the answer than addresses the question, I have to advise you not to use a mutable struct - it will bite you
p67184
aVMutable structs are evil
p67185
aVIMO, the "correct" fix here is simply:
p67186
as(dp67187
g18
V23354
p67188
stp67189
a((dp67190
g2
(lp67191
Vx++ is post increment; the current value (0) is used as the result, then the ++ happens
p67192
aVA bit like:
p67193
aVThe pre-increment (++x) would behave as you expected
p67194
as(dp67195
g18
V23354
p67196
stp67197
a((dp67198
g2
(lp67199
VThis is due to ; the compiler ignores calls to methods marked as conditional unless that symbol is defined
p67200
aVYou can have your own:
p67201
aVwhich will only be called when BLUE is defined
p67202
aVNote that there are some restrictions, to make "definite assignment" work:
p67203
aVno return value
p67204
aVno out parameters
p67205
aV(the same restrictions apply to  methods for similar reasons)
p67206
as(dp67207
g18
V23354
p67208
stp67209
a((dp67210
g2
(lp67211
VYour test compares expressions
p67212
aVExpressions themselves offer only reference equality; your test will probably show "false"
p67213
aVTo cheek for semantic equality you would need to do a lot of work, for example - are:
p67214
aVAnd
p67215
aVEquivalent
p67216
aVAs a crude test you can compare ToString(), but this will be exceptionally brittle
p67217
as(dp67218
g18
V23354
p67219
stp67220
a((dp67221
g2
(lp67222
VUltimately,  here is the string  - you have essentially done:
p67223
ag412
ag50
aVtried to evaluate a template on a string
p67224
aVThat can't work
p67225
aVYou can, however, test for values of , for example
p67226
aVOf course, since xslt is xml, another way to approach this would be to load the xslt into a DOM and replace the xpath expression prior to execution
p67227
as(dp67228
g18
V23354
p67229
stp67230
a((dp67231
g2
(lp67232
VEven if you weren't using  (comment), the fact that  isn't declared as a data-contract means that it will mainly be acting as a field-serializer
p67233
aVWhich is a pain in particular because automatically-implemented properties are a royal pain re field serializers - they become insanely brittle
p67234
aVI would declare as a contract:
p67235
aVand switch to , but note that this is a breaking change - you would have to update all clients and servers at the same time
p67236
aVYou would then be able to have alternative implementations as long as they shared the full contract signature
p67237
aVRe the current use of  - if this is for performance, there are alternatives - there are contract based binary serializers that are faster (CPU) and smaller (bandwidth) than : Performance Tests of Serializations used by WCF Bindings
p67238
as(dp67239
g18
V23354
p67240
stp67241
a((dp67242
g2
(lp67243
V100 items in a dictionary isn't really very big - in fact, that is barely getting into the size where hashing is faster than linear search
p67244
aVIf it will never change once initialized, then static may work - personally I try to have some other abstraction between  and instance - for example a "context" or "configuration" class that I can pass into all the instances that need it
p67245
aVThen I can have multiple parallel configurations (if I need), but all the related instances can share a context/configuration - so no duplication
p67246
as(dp67247
g18
V23354
p67248
stp67249
a((dp67250
g2
(lp67251
VPre-compiling it usually helps:
p67252
aVhowever, I wonder if in this specific case it is tied to the regex - maybe some expensive back-reference
p67253
aVRegex isn't always the tool to use, for example
p67254
aVEdit now that this appears to be delimited data:
p67255
aVInstead of regex, delimited data can use a parsing approach much more effectively
p67256
aVYou might even get away with just  (and access  by index), but if that fails - this csv reader has options to control the delimiters etc
p67257
as(dp67258
g18
V23354
p67259
stp67260
a((dp67261
g2
(lp67262
VNote that the compiler will automatically drop any unused references from the assembly, so at the assembly metadata level this is redundant
p67263
aVIt then just becomes an IDE/tooling issue
p67264
aVWould it be impossible
p67265
aVno (although obviously it would need to keep any that are marked for copy-local, to ensure it gets deployed)
p67266
aVWe can probably assume, therefore, that it is simply a "time to implement vs utility" (compared to other more useful things that could be done)
p67267
aVI'm sure you could write an IDE extension for it if you wanted ;p
p67268
as(dp67269
g18
V23354
p67270
stp67271
a((dp67272
g2
(lp67273
VI can't see anything in the s that would through, since  should always be non-null
p67274
aVAnd outside the s the only time you use it is in  - so you have two choices:
p67275
aVfilter out the ones that won't work (will remove data):
p67276
aVcheck before using  (will default some fields to blank):
p67277
as(dp67278
g18
V23354
p67279
stp67280
a((dp67281
g2
(lp67282
VThat is an , so you could have:
p67283
aVor
p67284
aVhowever, note that the syntax  refers to a static property; if you want an instance property you might need something more like an  - for example:
p67285
aVAs for implementation; in this simple case, we can expect the  to be a , so:
p67286
aVHowever, it is more complex in the general case
p67287
aVThis will also work if we use the static member:
p67288
as(dp67289
g18
V23354
p67290
stp67291
a((dp67292
g2
(lp67293
VWith the edit, it sounds like the data is pretty simple flat records
p67294
aVSince the volume is high, I would probably look at file-based storage - so it then becomes a matter of format
p67295
aVCSV/TSV is pretty easy to write, and with suitable streaming readers (like this one) you won't have to buffer all the data in memory first
p67296
aVOf course, if your displays need all the data in memory, that goes out the window
p67297
aVFor large volume, sheer bandwidth becomes the main bottleneck, plus processing time
p67298
aVCSV and friends typically compress (gzip etc) very nicely, but take CPU
p67299
aVPersonally, I'm a long-time fan of "protocol buffers", and it would seem a nice fit here - it is well-suited to streaming access, is low bandwidth, and is binary  - you get the benefits of smaller IO costs without the CPU overhead of compression
p67300
aVPlus it is more object-based, so it is easier to apply to your existing data without any extra interpretation steps
p67301
aVI'm not entirely sure if I'm answering the same question you're asking - so I'll stop there - but please feel free to clarify anything I've got horribly wrong
p67302
aVHere's a basic test rig to show some typical usages of the two methods discussed above:
p67303
as(dp67304
g18
V23354
p67305
stp67306
a((dp67307
g2
(lp67308
VYou can do this at runtime simply by passing the required connection string (or a connection) into the data-context as a constructor argument
p67309
aVYou can also configure this in configuration - typically in the  section, but it depends a bit on how the DBML is configured
p67310
as(dp67311
g18
V23354
p67312
stp67313
a((dp67314
g2
(lp67315
VIf you mean "to run on the user's machine", then not "as is" - you might want to look at Silverlight for that
p67316
aVIf you mean "to use at the server", then it will of course depend on how it operates (whether it prompts for input etc), and how it works (does it use GDI+, for example
p67317
aVthat isn't recommended for use on web servers)
p67318
aVBut sure; you can shell an exe with , or if it is a
p67319
aVNET exe you can either add a reference directly to the exe and use it as a library (if it has appropriate code)
p67320
aVThere is also a way to run it in-process via   - not sure this latter is a good idea on a web-server, though
p67321
aVespecially if the exe talks to
p67322
aVFor getting the image back to the client, you would want this processing to happen (perhaps with caching) in a route that uses  from MVC to simulate the image stream
p67323
as(dp67324
g18
V23354
p67325
stp67326
a((dp67327
g2
(lp67328
VWhen you've saved it, you have (for reasons best known to you) applied base-64 - but you haven't applied base-64 when reading it
p67329
aVIMO, just drop the base-64 completely - and write directly to the
p67330
aVThis also saves having to buffer it in memory
p67331
aVFor example:
p67332
aVand
p67333
aVas a side note, you may find that  makes a better serializer for EF than
p67334
as(dp67335
g18
V23354
p67336
stp67337
a((dp67338
g2
(lp67339
VIf you round to 2dp, IMO the "right" way would be store an integer that is the multiple - i
p67340
ag50
aVfor 12
p67341
aV34 you store the integer 1234
p67342
aVNo more double rounding woe
p67343
aVIf you must use double, this still works; all integers are guaranteed to be stored exactly in double - so still use the same trick
p67344
as(dp67345
g18
V23354
p67346
stp67347
a((dp67348
g2
(lp67349
VYou are unlikely to notice any negative side-effects from enabling MTOM here; actually, leaving aside reservations about using  on a web-service, another option here is to send the  as binary (with MTOM) -by:
p67350
aVchange the API to take a
p67351
aVset the 's RemotingFormat to binary before serializing
p67352
aVuse  to serialize it to a
p67353
aVuse  to get the
p67354
aVMuch smaller than the XML version, and MTOM can exploit it
p67355
aVWhen I looked at this recently, the binary remoting format took about 20% of the space that the xml version took, for exactly the same data
p67356
as(dp67357
g18
V23354
p67358
stp67359
a((dp67360
g2
(lp67361
VI'm guessing your locale has  /  (or similar confusing characters) in the date format
p67362
aVYou should specify an explicit format -  for example:
p67363
as(dp67364
g18
V23354
p67365
stp67366
a((dp67367
g2
(lp67368
VSure you could write that:
p67369
aVhowever, be cautious that not all sequences are repeatable; generally I prefer to only walk them once, just in case
p67370
as(dp67371
g18
V23354
p67372
stp67373
a((dp67374
g2
(lp67375
VI might use:
p67376
aVwhich covers anything implementing
p67377
aVThe reason that  never evaluates true is that this is asking "does my  object implement
p67378
aV, rather than "does the type represented by this  object implement
p67379
as(dp67380
g18
V23354
p67381
stp67382
a((dp67383
g2
(lp67384
VChanging the pattern to
p67385
aVShould do it
p67386
as(dp67387
g18
V23354
p67388
stp67389
a((dp67390
g2
(lp67391
VNot all sequences are repeatable, so it generally has to count them
p67392
aVTo help it, you could call  on the sequence - even if typed as , LINQ-to-Objects will still short-cut and use the  - so very cheap, and repeatable
p67393
aVFor an example of a non-repeatable sequence:
p67394
aVwith demo:
p67395
as(dp67396
g18
V23354
p67397
stp67398
a((dp67399
g2
(lp67400
VYou really don't want a million threads
p67401
aVIt isn't clear what you are doing, but it looks like maybe a  will do everything you want here, with little work and plenty of sanity
p67402
aVIf you want to enforce only 3 threads:
p67403
aVwith:
p67404
aVIf you really want to use the semaphore, use the  to the loop:
p67405
as(dp67406
g18
V23354
p67407
stp67408
a((dp67409
g2
(lp67410
V"forwards only" is:
p67411
aVthe most common use for most consumers
p67412
aVsimple to implement, so the most likely to be implemented by most producers
p67413
aVthe only thing we can guaranteed if we assume we don't want to buffer all the data in memory
p67414
aVeasily buffered to allow random access (for moderate sized data)
p67415
aVfor example, if you are reading data from a database, a network stream, etc, you can only guarantee "forwards"
p67416
aVWe certainly don't want to arbitrarily buffer all that data - it could be huge potentially
p67417
aVIf the client thinks they have a sane amount of data, they can always call  etc to buffer it in memory and allow random access
p67418
aVFor example, consider this perfectly valid sequence:
p67419
aVit can't be reversed without buffering
p67420
aVit is infinite in length, so can't be buffered
p67421
aVobviously that example is a little unlikely, but reading from a socket, database, or even a large file - can be essentially the same scenario
p67422
as(dp67423
g18
V23354
p67424
stp67425
a((dp67426
g2
(lp67427
VIt sounds like you mean something like a wizard
p67428
aVIn asp
p67429
aVnet webforms has a wizard control buy afaik the closest in windows forms is TabControl
p67430
aVBut no matter; it is trivial to simply hide and show some Panel controls
p67431
aVIt can be trickier to use the designer, of course - but you can lay them out next to each other and move then at runtime as needed
p67432
as(dp67433
g18
V23354
p67434
stp67435
a((dp67436
g2
(lp67437
VFor data volumes like 300k rows, I would forget EF
p67438
aVI would do this by having a table such as:
p67439
aVWhere RowId is the PK of the row we want to update, and BatchId just refers to this "run" of 300k rows (to allow multiple at once etc)
p67440
aVI would generate a new BatchId (this could be anything unique -Guid leaps to mind), and use SqlBulkCopy to insert te records onto this table, i
p67441
ag50
aVI would then use a simgle sproc to do the join and update (and delete the batch from the table)
p67442
aVSqlBulkCopy is the fastest way of getting this volume of data to the server; you won't drown in round-trips
p67443
aVEF is object-oriented : nice for lots of scenarios - but not this one
p67444
as(dp67445
g18
V23354
p67446
stp67447
a((dp67448
g2
(lp67449
VUltimately, no
p67450
aVIt sounds like you are deploying a dll, but you want to retain sole control over how it is used
p67451
aVThat is just an arms race; ultimately if somebody really, really wants to (ab)use it, they can
p67452
aVEven if that means disassembling, de-obfuscating, and disarming any preventative code you have added
p67453
aVThe only way to block that: don't give it to them
p67454
aVConsider using a web-service for some functions
p67455
aVThen they don't have the assembly
p67456
as(dp67457
g18
V23354
p67458
stp67459
a((dp67460
g2
(lp67461
VIt isn't "very common to use a private static readonly object for locking in multi threading" - rather, it is common to use a lock at the appropriate / chosen granularity
p67462
aVSometimes that is
p67463
aVMore often, IMO, it isn't - but is instance based
p67464
aVThe main time you see a  lock is for a global cache, or for deferred loading of global data / singletons
p67465
aVAnd in the latter, there are better ways of doing it anyway
p67466
aVSo it really depends: how is  used in your scenario
p67467
aVIs it protecting something that is itself static
p67468
aVIf so, the lock should be static
p67469
aVIf it is protecting something that is instance based, then IMO the lock should also be instance based
p67470
as(dp67471
g18
V23354
p67472
stp67473
a((dp67474
g2
(lp67475
VThe  check should do it; actually, a cheeky route can be:
p67476
aVThe  casts are essentially NOPs, and just force it to perform a reference check instead of recursively hitting , but also without an extra static call to
p67477
as(dp67478
g18
V23354
p67479
stp67480
a((dp67481
g2
(lp67482
VActually, I did some profiling on this a while ago, and the truth is: you won't notice this at all
p67483
aVEven in tight loops over millions of iterations the difference was small
p67484
aVFor info though you might want to look at razor, where the engine takes over and split it in advance (razor views can be pre-compiled) - in which case it would be something like (not accounting for js encoding):
p67485
aVOr (alternative):
p67486
aVOne final option is to just code against a class, and only add the class (at the server) to the button you want - then it is a constant:
p67487
as(dp67488
g18
V23354
p67489
stp67490
a((dp67491
g2
(lp67492
VWhat you are seeing there is  on the value - and in the case of a  the "value" is the enum
p67493
aVAnd the type-code of an enum is simply the enum's underlying type:  in this case
p67494
aVIt will report  for every  - even those that don't exist:
p67495
aVWhat you are trying to do has nothing to do with the 's
p67496
aVThe problem here is the "apparently"
p67497
aVIf you really want to map an enum to something else, a  is ideal
p67498
aVIt is entirely possible that you will need to provide the mapping yourself
p67499
as(dp67500
g18
V23354
p67501
stp67502
a((dp67503
g2
(lp67504
VIt isn't clear to me what Ext
p67505
aVNet is here, or why you are using it, but the FromStream usage suggests you are confusing is with ; however, event that is moot as you shouldn't use System
p67506
aVDrawing from a web app
p67507
aVIf you are just trying to return an image to the client, you shouldn't have to process it at all in many cases - just throw the BLOB down the wire to the client
p67508
aVUnrelated, but as Jon notes you're also trying to read from the end of a MemoryStream
p67509
as(dp67510
g18
V23354
p67511
stp67512
a((dp67513
g2
(lp67514
VI suspect this is implemented as part of the engine itself, so it is entirely possible that the "source code" for this is c++ and not published (except perhaps for mono etc)
p67515
aVEither way: I can't think of a scenario where you would need this
p67516
aVIf you want to know how the type metadata is associated with the object, look at the CLI spec - ECMA335
p67517
as(dp67518
g18
V23354
p67519
stp67520
a((dp67521
g2
(lp67522
VNames are tricky
p67523
aVThe simple rules of First Letters do not apply
p67524
aVThe only senator approach here is to ask your users how they want it
p67525
aVAnything else can cause offence
p67526
aVIf my name is MacPhearson, ODowel, or just simply marc, Marc or even mArC - then frankly: leave it alone
p67527
aVTrust the user to get it right
p67528
aVThis gets even more tricky as you go between cultures
p67529
as(dp67530
g18
V23354
p67531
stp67532
a((dp67533
g2
(lp67534
VThere are various types that will subscribe to this - most notably thing like  (winforms, but similar in WPF etc) but only when data-bound (set ), and only if the list also supports binding - for example
p67535
aVTo test, simply subscribe to if yourself with
p67536
as(dp67537
g18
V23354
p67538
stp67539
a((dp67540
g2
(lp67541
VThe core of what you want is:
p67542
aVhowever, you'll notice that this is reflection, and pretty much ties you to
p67543
aVThe usual workaround to this is to have access to a non-generic version of the API, so that you can work with  - for example (with the addition of a non-generic ):
p67544
aVYou can of course move the runtime/generics hit higher up - perhaps into a generic method; then everything in the generic method can use , and you can use  to execute that method in the context of a particular  known only at runtime
p67545
as(dp67546
g18
V23354
p67547
stp67548
a((dp67549
g2
(lp67550
VIt seems odd to critique the performance of LINQ when the original is clearly (worst case) O(n*m); the LINQ approach would I expect use a  on a list, and then use a streaming iterator block - so the performance should be O(n+m) - i
p67551
ag50
aVbetter
p67552
as(dp67553
g18
V23354
p67554
stp67555
a((dp67556
g2
(lp67557
VYou can't to that with  - it won't let you unless the base type(s) is(/are) serializable
p67558
aVYou could, however, serialize to xml and just pass a string or byte[] -  is less particular:
p67559
aVThe difference here obviously being that  sends the public members, not the fields
p67560
aVI also know my own serializer could do this for you if you want binary
p67561
as(dp67562
g18
V23354
p67563
stp67564
a((dp67565
g2
(lp67566
V in that context is used to give an alias to a column or table; there is no sense in an  here, since that isn't a select
p67567
aVYou have already specified a format via , but this also seems odd; dates are not strings
p67568
aVIf you are matching on a  - keep everything as a
p67569
aVIf you are actually trying to remove the time portion (leaving just a date), either a: don't send the time (cut it at the caller), or b: do something like:
p67570
as(dp67571
g18
V23354
p67572
stp67573
a((dp67574
g2
(lp67575
VActually it is completely removed from Silverlight - so the intention is there
p67576
aVPresumably there is simply too much old existing code for regular
p67577
aVNET that uses  to obsolete it, especially since a lot of people run with warnings-as-errors
p67578
aVYou shouldn't use it in new code without good reason
p67579
as(dp67580
g18
V23354
p67581
stp67582
a((dp67583
g2
(lp67584
VNot unless you count
p67585
aVOne way or another, you'll need to loop
p67586
aVIf you use the  version, the fastest approach is to use the  accessor, i
p67587
ag50
aVAs an alternative : since this presumably relates to a database, write the TSQL manually to set all the values appropriately (i
p67588
ag50
aVwith a suitable  clause in the TSQL)
p67589
as(dp67590
g18
V23354
p67591
stp67592
a((dp67593
g2
(lp67594
VA useful trick here is to just have the worker as a queue of delegates; for example,
p67595
aVThen the caller can enqueue the appropriate method and (via captured varialbes) any necessary state
p67596
aVSay, for example, you have a  method; the caller could do:
p67597
aV(where  is a ), or can do something like:
p67598
aV(where  and  are local to the code that wants the work done)
p67599
aVso we've passed lots of state at once, and not once had to think about types - just operations
p67600
as(dp67601
g18
V23354
p67602
stp67603
a((dp67604
g2
(lp67605
VClarification: this question was originally tagged C#; since it wasn't the OP that re-tagged it, I'll leave this here until the OP's intentions are clearer
p67606
aVC# is a high-level programming language, which compiles down to IL, not machine code
p67607
aVAs such: no, there is absolutely no supported mechanism for performing specific machine code operations (and even if there were, it couldn't possibly port between langauges)
p67608
aVYou can do high level bit operations, using the operators on the integer-based types; and if you really want you can write IL, either building it manually (ilasm), or at runtime via  /  - but these still only deal with CIL opcodes, not machine codes
p67609
as(dp67610
g18
V23354
p67611
stp67612
a((dp67613
g2
(lp67614
VWhile the socket is open, there is no way of doing this without causing it to block when it reaches the end (expecting more data)
p67615
aVThere are several ways of doing it:
p67616
aVclose the socket after sending
p67617
aVhave some marker that means "end of message" (easy enough with encoded text -  being a common choice; tricky when sending arbitrary binary data, though)
p67618
aVsend a length prefix before the data (100,000 in this case), and stop reading when you get that much
p67619
aVIf it was a , for example, using a length prefix:
p67620
as(dp67621
g18
V23354
p67622
stp67623
a((dp67624
g2
(lp67625
VIf it is that simple, then  over the stream, or  directly on the buffer should suffice; and  for strings
p67626
aVBut agree endianness first ;)
p67627
aVIf it is more complex and object-based, then I suggest using a pre-canned serializer
p67628
aVWriting a full serializer is not trivial
p67629
aVYou might also want to look at a streaming API rather than loading it all into memory - that tends to get expensive for large messages
p67630
as(dp67631
g18
V23354
p67632
stp67633
a((dp67634
g2
(lp67635
VNothing built-in, no
p67636
aVIn fact I can't think of any 3rd party libs for this either
p67637
aVI haven't tried, but it occurs that C# 5 may offer some language-level shiny here
p67638
aVThe other option is to use a separate thread that reads synchronously, but that then uses a thread instead of IO completion ports
p67639
as(dp67640
g18
V23354
p67641
stp67642
a((dp67643
g2
(lp67644
VThe parameter would be an
p67645
aVReading it can be via flat compile:
p67646
aVthen you can access
p67647
aVAssigning is trickier; for simple selectors your could hope that you can simply decompose to:
p67648
aVBut more complex expressions would either need a manual tree walk, or some of the 4
p67649
aV0 expression node-types:
p67650
as(dp67651
g18
V23354
p67652
stp67653
a((dp67654
g2
(lp67655
VIn C#,  never directly calls  (except perhaps if you include ):
p67656
aVfor some inbuilt types, a direct compare is performed (s etc have an opcode)
p67657
aVif an explicit  operator is defined, that is called
p67658
aVfor , "lifted" rules are applied, then  is applied to the values if both are non-null
p67659
aVfor classes, the default is reference equality
p67660
aVfor structs, there is no default  implementation
p67661
as(dp67662
g18
V23354
p67663
stp67664
a((dp67665
g2
(lp67666
VI guess it just uses  for the implementation, so:
p67667
aVA full list is on MSDN: Attributes That Control XML Serialization
p67668
aVRe your example, I would actually expect:
p67669
as(dp67670
g18
V23354
p67671
stp67672
a((dp67673
g2
(lp67674
VYou would need to add a change event for it to know that something is different
p67675
aVIMO it would be easier to forget binding here, and just handle the ListChanged event directly
p67676
as(dp67677
g18
V23354
p67678
stp67679
a((dp67680
g2
(lp67681
V is restricted to primitives that the compiler can directly write as IL directly
p67682
aVshould suffice here if  is treated as immutable, i
p67683
ag50
aVNote that if  is a mutable , bad things can happen; I would recommend a property rather than a field to prevent a number of confusing side-effects
p67684
as(dp67685
g18
V23354
p67686
stp67687
a((dp67688
g2
(lp67689
VMy guess would be small difference (seconds, millis,etc) between  and
p67690
aVTry rounding them off to some pre-determined precision
p67691
as(dp67692
g18
V23354
p67693
stp67694
a((dp67695
g2
(lp67696
VNot at the moment; however you can edit  to suit your own needs
p67697
aVThis doesn't seem a common case, but it could be added as an option easily enough
p67698
as(dp67699
g18
V23354
p67700
stp67701
a((dp67702
g2
(lp67703
VA guid is just a 128 bit number, so sure you could interpret it as a guid, just with a lot of 0 padding
p67704
aVThey are more commonly expressed as a 32 character hex string though
p67705
aV(which is your seemingly-decimal number expressed in a 32-bit hex string)
p67706
as(dp67707
g18
V23354
p67708
stp67709
a((dp67710
g2
(lp67711
VReference writes are guaranteed atomic, so there are only really two things to check:
p67712
aVusage in a tight loop - might need to add  if you need to notice the change
p67713
aVdouble updates; if you are (for example) doing add/remove via reference swap, you should use  to make sure you don't lose data; keep reapplying your change until you win the swap
p67714
ag412
ag50
as(dp67715
g18
V23354
p67716
stp67717
a((dp67718
g2
(lp67719
Vbecause  is an object serializer, and works from the type definition
p67720
aVsure, that'll work
p67721
aVstrictly speaking you don't, but the current version looks fine;  works for public properties or fields; you could simplify to an automatically-implemented property though:
p67722
aVBut if you only want to save a single string value - is xml overfkill
p67723
aV/  may be simpler
p67724
as(dp67725
g18
V23354
p67726
stp67727
a((dp67728
g2
(lp67729
VThis is thread-affinity
p67730
aVUI controls don't like to be touched by anything except the thread that created them, but the  thread happens from a different thread
p67731
aVAdding a call to pushes an item of work back to the UI thread, so the  updated can succeed
p67732
as(dp67733
g18
V23354
p67734
stp67735
a((dp67736
g2
(lp67737
VMy thoughts:
p67738
aVdon't fetch all the data then process it; but process it as it arrives - via  or LINQ
p67739
aVuse equally streaming approach for the file; perhaps  directly, or maybe  - in either case reading from the source above
p67740
aVthis vastly reduces the amount of memory you need, and allows your machine to do something useful while waiting on the network IO
p67741
as(dp67742
g18
V23354
p67743
stp67744
a((dp67745
g2
(lp67746
VThe lambda is because you want to evaluate the conditional expression per item
p67747
aVThe version you added () can't work -  isn't defined anywhere (the compiler message should be "The name 'n' does not exist in the current context")
p67748
aVThe lambda can be read as:
p67749
aVgiven a term , if  is greater than  return , else return
p67750
aVand then sum over that logic
p67751
aVRe the advantage - firstly, convenience - but also composition
p67752
aVFor example, with LINQ-to-SQL I would absolutely expect that to issue something like:
p67753
aVof course, it might be better to use:
p67754
aVwhich would map to
p67755
aVwhich might hit an index more accurately
p67756
as(dp67757
g18
V23354
p67758
stp67759
a((dp67760
g2
(lp67761
VTo do that you'd need to add another class:
p67762
aVand have:
p67763
as(dp67764
g18
V23354
p67765
stp67766
a((dp67767
g2
(lp67768
V implements (indirectly*) , which always takes precedence over the reflection type model
p67769
aVAs a consequence, any properties you add are largely irrelevant for data-binding purposes, since the property definitions don't involve reflection at any point, but instead look at the columns defined on the
p67770
aVOr less verbose: that won't work, and can't work
p67771
aV*= via  which returns the , which is a  which implements
p67772
as(dp67773
g18
V23354
p67774
stp67775
a((dp67776
g2
(lp67777
Vnote that this is just an anonymous tuple; we can't show code to reconstruct an / etc without more info on how your code is structured, what props there are, etc
p67778
as(dp67779
g18
V23354
p67780
stp67781
a((dp67782
g2
(lp67783
VDo you just want a  in that
p67784
as(dp67785
g18
V23354
p67786
stp67787
a((dp67788
g2
(lp67789
VThe underlying storage here is in a typed array (in this case in the  class), but all access goes via , since there is no generic API
p67790
aVYou cannot avoid the boxing unless you switch to a class-based model without
p67791
as(dp67792
g18
V23354
p67793
stp67794
a((dp67795
g2
(lp67796
VYour best option here: don't use the dev server for this; use IIS
p67797
aVFighting tooling issues in something unrelated to what you are trying to do is a waste of time, so try to mimic your deployment environment as closely as possible
p67798
aVYou might also be able to use IISExpress for this, but since you know you already have nuances, I'd just go the whole-hog and use IIS
p67799
aVThis also lets you hone the deployment process, which is a dev task
p67800
aVOnce setup, just create an app-pool and associate it with new account (not your account, unless it is going to be your account in production)
p67801
as(dp67802
g18
V23354
p67803
stp67804
a((dp67805
g2
(lp67806
VFor your scenario, you might consider switching protobuf-net; this is not the same format as , so both client and server would need tweaks, but is a binary serialization API that works on both platforms, and is typically much smaller as an added extra
p67807
aVThe format is actually google's "protocol buffers" encoding; very fast, platform-independent, and designed to be flexible as you add properties etc
p67808
aVAnd it is free
p67809
aVSome fool just gives it away
p67810
as(dp67811
g18
V23354
p67812
stp67813
a((dp67814
g2
(lp67815
VThere are a number of issues in v1 that make it a bit of a pain to pre-JIT; v2, although incomplete, is intended to resolve many/all of these issues, not least by offering a pre-compile to dll option - but even the runtime-only version should be much more device friendly
p67816
aVI should also mention that Jon's port of the Java version should work well here, since it is compiler-heavy rather than runtime-heavy
p67817
as(dp67818
g18
V23354
p67819
stp67820
a((dp67821
g2
(lp67822
V doesn't provide operator support - you need to use
p67823
aVOr better, use  - then you can drop the constraint and it'll handle nulls etc automatically, and it'll avoid boxing
p67824
as(dp67825
g18
V23354
p67826
stp67827
a((dp67828
g2
(lp67829
VIf all else fails, send it in fragments of 16Kb, followed by an "all done" message that commits it (reassembling if necessary)
p67830
as(dp67831
g18
V23354
p67832
stp67833
a((dp67834
g2
(lp67835
VMSDTC still lives on, and is available in managed code via
p67836
aVSo - use that
p67837
aVThere are some COM+ things that don't really have direct counterparts; having a COM+ dll that runs in a different identity, or all the vastly over-complicated COM+ permissions/roles/groups/etc, but in truth you are usually better off writing a proper service (trivial in managed code) that accepts requests via any IPC method of your choosing
p67838
as(dp67839
g18
V23354
p67840
stp67841
a((dp67842
g2
(lp67843
VAs long as there is no shared state or external resources, then: no risk whatsoever
p67844
aVYou've mentioned "no fields" etc, which is good - so as long as they aren't indirectly talking shared state (perhaps via some common argument that isn't thread-safe in this scenario, or via some other utility methods that it calls, which share state in messy ways), you should be fine
p67845
as(dp67846
g18
V23354
p67847
stp67848
a((dp67849
g2
(lp67850
VTo customise the element names is a pain; I would forget about  here, as you'd have to use  which is a royal pain
p67851
aVI'd use XElement instead:
p67852
as(dp67853
g18
V23354
p67854
stp67855
a((dp67856
g2
(lp67857
VI randomly hacked together a fairly arbitrary format for protobuf-net, that maps to the
p67858
aVNET  type - the layout is here
p67859
aVThis works well for
p67860
aVNET-to-
p67861
aVNET, but I do't know enough about Cocoa decimals to know how that fits
p67862
as(dp67863
g18
V23354
p67864
stp67865
a((dp67866
g2
(lp67867
VYes-ish
p67868
aVAt the tooling level, see MonoDroid, MonoTouch or the WP7 tools
p67869
aVHowever, in each case you are using the language to target a specific mobile platform
p67870
aVYou may need different UI code for each, even if the core code is shared
p67871
as(dp67872
g18
V23354
p67873
stp67874
a((dp67875
g2
(lp67876
Vat a minimum it just needs
p67877
aVSince you are inheriting  you get that for free, but note that inheritance
p67878
aV= decorator, and note that  doesn't have virtual methods (though  does) - so you can't customise
p67879
aVanything much by inheriting
p67880
aVFortunately, you can do a simple pseudo-decorator by implementing  (but manually implementing  would be preferred), as  gets used first
p67881
aVFor type metadata, you need either a typed (non-object) indexer, or  (harder) - so:
p67882
aVother optional interesting interfaces include ,  and a range of others for side functions;  and  for example
p67883
as(dp67884
g18
V23354
p67885
stp67886
a((dp67887
g2
(lp67888
VFor 50-100 users, I would just cache something per-active-user in the app
p67889
aVThis avoids any small overhead from a db fetch, except for when it expires
p67890
aVSo just have some small object that you can cache cheaply, but which includes all the user information you need to run the app's core functions
p67891
aVTher's nothing stopping you using this to implement an  to use the inbuilt  stuff, but doing it yourself works too
p67892
as(dp67893
g18
V23354
p67894
stp67895
a((dp67896
g2
(lp67897
VA proper recursive graph is not really possible with structs; you would need to change to a :
p67898
aVThe problem is that otherwise virtually every time you try to mutate them to create the cycle, you get a copy, not the same instance
p67899
aVSince this is a mutable entity type, it should be a class anyway
p67900
aVThen even something as simple as:
p67901
aVis a recursive graph
p67902
as(dp67903
g18
V23354
p67904
stp67905
a((dp67906
g2
(lp67907
VThey do different things; I would do  and remove the (unused) field
p67908
aVIn an automatically implemented property, the compiler creates it's own field (with a horrible name that you can't see in C#) - you don't need to provide your own field
p67909
aVSo:
p67910
aVOther points: changed  to  to be clearer to the caller, and also you don't need  since it isn't ambiguous (field vs parameter, etc)
p67911
as(dp67912
g18
V23354
p67913
stp67914
a((dp67915
g2
(lp67916
VIt sounds like this is simply a race condition between two connections doing the read/insert
p67917
aVOne fix might be to create a serializable transaction around the two operations:
p67918
aVThis forces a key-range lock during the select, so any second thread doing the read will be blocked until the transaction has completed; so you won't get two SPIDs seeing "no row" then trying to do the insert; instead the first SPID will block the second for a few critical milliseconds while it does the work; only when the first SPID has decided whether (or not) to insert the data (and call  or rollback) does the second SPID get to know
p67919
aVAlso, note that you don't need to change the primary key to make it unique - just add a unique constraint
p67920
aVThen you don't have to change anything referencing that table
p67921
as(dp67922
g18
V23354
p67923
stp67924
a((dp67925
g2
(lp67926
VThe first thing to look for is /favicon
p67927
aVico in the site root; something like WebClient
p67928
aVDownloadFile() should do fine
p67929
aVHowever, you can also set the icon in metadata - for SO this is:
p67930
aVand note that alternative icons might be available; the "touch" one tends to be bigger and higher res, for example:
p67931
aVso you would parse that in either the HTML Agility Pack or XmlDocument (if xhtml) and use WebClient
p67932
aVDownloadFile()
p67933
aVHere's some code I've used to obtain this via the agility pack:
p67934
aVNote the icon is theirs, not yours
p67935
as(dp67936
g18
V23354
p67937
stp67938
a((dp67939
g2
(lp67940
VThe usual problem here is an event
p67941
aVBinaryFormatter includes events, which many people don't expect
p67942
aVThe event field must be marked, for example:
p67943
aVIt is painfully easy to get an event subscription that you didn't anticipate break the serializer (a capture class, perhaps)
p67944
aVHowever, I also encourage you:
p67945
aVdon't use public fields; use properties
p67946
aVdon't use BinaryFormatter - it bites most people eventually; and bites hard
p67947
aVIf you want a binary serializer that works with XNA, consider protobuf-net; it is faster, has smaller output, adapts to change more gracefully
p67948
aVand is free
p67949
aVCaveat: I wrote it
p67950
as(dp67951
g18
V23354
p67952
stp67953
a((dp67954
g2
(lp67955
Vnote this assumes you want to use your CPUs endianness
p67956
as(dp67957
g18
V23354
p67958
stp67959
a((dp67960
g2
(lp67961
VIf you are using Visual Studio: (with that file active) File, Advanced Save Options
p67962
as(dp67963
g18
V23354
p67964
stp67965
a((dp67966
g2
(lp67967
VYou need to include  in the call to , and supply an argument in the final invoke ( in your example)
p67968
aVOr if it is meant to be fixed at {2,3,5}, replace  with an
p67969
aVNote that if you want to get the performance, you need to use typed invoke, not
p67970
as(dp67971
g18
V23354
p67972
stp67973
a((dp67974
g2
(lp67975
VEach  in  has a  that includes the extension; to get just the extension, use
p67976
aVNote that using the content-type may be more reliable in many cases
p67977
as(dp67978
g18
V23354
p67979
stp67980
a((dp67981
g2
(lp67982
VAssuming you mean database connections, the main points are:
p67983
aVthey must all use exactly the same connection string
p67984
aVit is per-AppDomain
p67985
aVfor SSPI etc, the implicit user account must be common (i
p67986
ag50
aVthe same domain user is being represented, or it will form multiple pools)
p67987
aVit must be enabled and supported by the provider; in the case of  it is on by default
p67988
aVyou must have not explicitly disabled the pool
p67989
aVFor most common cases using , this just means "will be pooled per unique connection-string" - the rest is automatic and just works
p67990
aValso; remember to use  statements around your connection usage, so you release things back to the pool even in exception - otherwise you'll exhaust it
p67991
as(dp67992
g18
V23354
p67993
stp67994
a((dp67995
g2
(lp67996
VOne option would be use  instead of , then you simply walk the tree (from  etc) and validate what objects and methods are used - but you would have to limit to your objects, as obviously even  could be malign
p67997
aVThe advantage here is that to the caller it looks and feels the same as passing a delegate as a lambda
p67998
aVAn easier way may be for them to pass you a string (name) or enum that you use for the sort / filter / etc
p67999
as(dp68000
g18
V23354
p68001
stp68002
a((dp68003
g2
(lp68004
VUsing a c# example:
p68005
as(dp68006
g18
V23354
p68007
stp68008
a((dp68009
g2
(lp68010
VUltimately, you need to choose a strategy per type, and then just switch to each; BinaryWriter has methods to write Int32, String, etc - so a basic approach is to use lots of reflection and a switch on GetTypeCode of te FieldInfo/PropertyInfo's effective type
p68011
aVPersonally, having done this, I would actually avoid BinaryReader / Writer, though - and go straight for the Stream (with a floating byte[] buffer for working in)
p68012
aVGetting advanced, you might reduce the amount of reflection by using meta-programming to pre-compile something per member or per-type
p68013
aVOther things to consider:
p68014
aVWhat header data do you need (if any) to mark each data field
p68015
aVHow are you going to pack sub-objects/inheritance/lists
p68016
aVBoth are fairly easy to solve, of course
p68017
as(dp68018
g18
V23354
p68019
stp68020
a((dp68021
g2
(lp68022
VReflection is useful for library code, that cannot possibly know about the actual types
p68023
aVA good example is the WPF you mention; how do you think it resolved strings in xaml to properties
p68024
aVAnd the data-binding strigs inside the xaml
p68025
aVClassic examples:
p68026
aVdata-binding
p68027
aVserialization
p68028
aVORM - database <===> classes
p68029
aVIDE / design tooling / editors
p68030
aVmetaprogramming
p68031
aVYour WPF use uses at least 3 of those; probably 4 if you were using a database
p68032
aVYou should generally avoid too much reflection in application code; working to interfaces for your domain entities would be preferred
p68033
as(dp68034
g18
V23354
p68035
stp68036
a((dp68037
g2
(lp68038
VYou haven't told us the error details, but I suspect the first request has not yet completed
p68039
aVIMO, unless you are doing something particularly subtle, it is often a good idea to use , which is a wrapper around  (etc) that greatly simplifies the API - for example you can just call the  method, or , etc
p68040
aVThese are easy to call successively
p68041
as(dp68042
g18
V23354
p68043
stp68044
a((dp68045
g2
(lp68046
VFrom the comments, the  is a , so I'm assuming that you have bound to a typed data-set, and  is your specialized
p68047
aVIn that case, the object you want is the row-view's , i
p68048
ag50
as(dp68049
g18
V23354
p68050
stp68051
a((dp68052
g2
(lp68053
VYou can't add events to a type outside of your control, and events on structs is usually a very bad idea; but: the best approach here would be to use a property:
p68054
as(dp68055
g18
V23354
p68056
stp68057
a((dp68058
g2
(lp68059
VIf you want to inspect it but not execute it, this is a prime example for an
p68060
aVJust change the signature from  to
p68061
aVThis will give you an expression tree that you can analyse
p68062
aVFor a basic example:
p68063
aVTo support a richer set of nodes and scenarios, see this richer version
p68064
as(dp68065
g18
V23354
p68066
stp68067
a((dp68068
g2
(lp68069
VExpression trees are immutable, so to do this ou would need to walk the entire tree, rebuilding it and substiting any uses of the type with the equivalent - usually by writing a "visitor"
p68070
aVWhen encountering a MemberExpression or MethodCallExpression, you would check the member's declaring type - if it is the one ou don't want, recreate it (Expression
p68071
aVPropertyOrField is useful here)
p68072
aVNote that you can't do this just at the places it is used; the entire tree must be regenerated
p68073
aVI'm not at a PC at the moment, but if you want I can do an example later; leave a comment if you need this example
p68074
aVNote that this is somewhat complicated by the int/long and char/string mismatch
p68075
as(dp68076
g18
V23354
p68077
stp68078
a((dp68079
g2
(lp68080
VWith WCF you need to associate custom principals via a very specific mechanism, which works fine
p68081
aVNote also that attributes generally do not cause code execution, and only get invoked when done explicitly done via reflection (unless you are using PostSharp)
p68082
aVYou can't just add an attribute and have it do things automatically
p68083
aVMVC etc gives that impression, but there is code in MVC checking for attributes and executing them manually
p68084
as(dp68085
g18
V23354
p68086
stp68087
a((dp68088
g2
(lp68089
VIf you are using IIS in integrated mode, perhaps block at the server level:
p68090
as(dp68091
g18
V23354
p68092
stp68093
a((dp68094
g2
(lp68095
VTo serialized with protobuf, there is some necessary data about how to map the members - and note that each member itself must make sense to protobuf, or must be some kind of list
p68096
aVIf you can show the exact tree you are using I can help more, but for example:
p68097
aVshould serialize fine
p68098
aVThe necessary data can also be supplied at runtime in "v2"
p68099
aVBased in part on an email conversation, I understand the model a bit better, and the important changes I see are:
p68100
aVthe value field must be annotated for serialization
p68101
aVthe class must be annotated
p68102
aVthere must be a parameterless constructor
p68103
aVthere must be something that it to use to add and enumerate the child lists
p68104
aVThe last is an interesting one; I made the deliberate decision not to demand full / there - all it needs is  and an  method, so I can add a private wrapper object that only exists for the purposes of serialization
p68105
aVSo, based on the email content:
p68106
aVwhich should work for most  you throw at it, except
p68107
aVAny unusual objects should probably themselves be data-contracts
p68108
aVNotes for v2:
p68109
aVyou don't need the attributes; that can all be specified at runtime
p68110
aVyou don't need a parameterless constructor (although it is probably easiest to keep one, to make the  initiation easy)
p68111
aVlists can be non-generic,  and  (but the expected type must be specified)
p68112
as(dp68113
g18
V23354
p68114
stp68115
a((dp68116
g2
(lp68117
VIn C# and indexer has  syntax, so you could write something like:
p68118
aVthen the caller can access , where  is defined on
p68119
aVThe string to  is just a constructor parameter, so:
p68120
as(dp68121
g18
V23354
p68122
stp68123
a((dp68124
g2
(lp68125
s(dp68126
g18
V23354
p68127
stp68128
a((dp68129
g2
(lp68130
VA web-reference (2
p68131
aV0-style) doesn't have the "re-use types" option that full a WCF (3
p68132
aV0+) service-reference supports, so if you use the tooling you are going to have to accept the proxy types over the wire, and then transform them (perhaps AutoMapper) to/from the domain types
p68133
aVDo not edit the reference file; that may be regenerated randomly
p68134
as(dp68135
g18
V23354
p68136
stp68137
a((dp68138
g2
(lp68139
VThe "none" probably just means it hasn't started iterating yet, and is at BOF (for want of a better term)
p68140
aVIt should still work
p68141
aVUsually, if it doesn't it means the namespaces are incorrect - double-check for  in the source
p68142
aVThis works fine, for example:
p68143
as(dp68144
g18
V23354
p68145
stp68146
a((dp68147
g2
(lp68148
VThere are members of the base razor view, which is typically specified in the web
p68149
aVconfig in the /views folder, typically with contents like:
p68150
aVThe pageBaseType is probably what you are missing
p68151
as(dp68152
g18
V23354
p68153
stp68154
a((dp68155
g2
(lp68156
VIf that type is inside the project, then it is probably a namespace collision; try:
p68157
aVthis avoids conflicts with  in other namespaces
p68158
as(dp68159
g18
V23354
p68160
stp68161
a((dp68162
g2
(lp68163
VIn your example code, you show public fields, which are generally a very bad idea
p68164
aVUnless you try very hard (it can be done), data binding applies only to properties
p68165
aVSo change those fields to properties and it will work
p68166
aVIIRC in vb
p68167
aVnet this is:
p68168
aV(but my vb is rusty)
p68169
aVor in C#:
p68170
as(dp68171
g18
V23354
p68172
stp68173
a((dp68174
g2
(lp68175
VAbsolutely it can
p68176
aVAlways snapshot values from cache, and work with the snapshot:
p68177
aVand use  throughout
p68178
aVWhen it comes to threading, the above is generally a sane approach; the only caveat being you might want to look at  for a range of methods that let you see (safely) whether a variable/field changed while you weren't looking, and only apply a change it it hadn't changed
p68179
as(dp68180
g18
V23354
p68181
stp68182
a((dp68183
g2
(lp68184
VThe worst case I can think of given your scenario is that your replacement text contains a  comment and the file contains  already inside a comment, since xml comments don't nest well
p68185
aVIf you assert that your "very long xml
p68186
aVhas no comments it'll probably work (although the result may not always be pretty)
p68187
aVPersonally I'd use xml
p68188
as(dp68189
g18
V23354
p68190
stp68191
a((dp68192
g2
(lp68193
VI wonder if you mean
p68194
aVThis is not universally supported, but some converters report true for
p68195
as(dp68196
g18
V23354
p68197
stp68198
a((dp68199
g2
(lp68200
VTo access it as a , yes you'd need to find T using reflection (probably over the interfaces, for example , and use more reflection and MakeGenericMethod etc
p68201
aVIn all honesty, it isn't worth it: you would do better to check for the non-generic :
p68202
aVGenerics ad reflection are not good friends
p68203
aVNote in 4
p68204
aV0 there are also some tricks you can do here with  and generics
p68205
as(dp68206
g18
V23354
p68207
stp68208
a((dp68209
g2
(lp68210
VMany data-structures (lists, collections, etc) act as containers - they hold a set of objects
p68211
aVBut not a stream; if a list is a bucket, then a stream is a hose
p68212
aVYou can pull data from a stream, or push data into a stream - but normally only once and only in one direction (there are exceptions of course)
p68213
aVFor example, TCP data over a network is a stream; you can send (or receive) chunks of data, but only in connection with the other computer, and usually only once - you can't rewind the Internet
p68214
aVStreams can also manipulate data passing through them; compression streams, encryption streams, etc
p68215
aVBut again - the underlying metaphor here is a hose of data
p68216
aVA file is also generally accessed (at some level) as a stream; you can access blocks of sequential data
p68217
aVOf course, most file systems also provide random access, so streams do offer things like Seek, Position, Length etc - but not all implementations support such
p68218
aVIt has no meaning to seek some streams, or get the length of an open socket
p68219
as(dp68220
g18
V23354
p68221
stp68222
a((dp68223
g2
(lp68224
VSince there is no guarantee of thread safety, there is no defined or sensible way of answering "nothing", "anything", and "boom" are all valid answers, and indeed it could change between versions, platforms, architecture, etc
p68225
aVHave you considered making it [ThreadStatic] so each thread can have an isolated version automatically
p68226
aV(initialisation should probably be double-checked per thread)
p68227
as(dp68228
g18
V23354
p68229
stp68230
a((dp68231
g2
(lp68232
VIt seems to me that this is tied more to the schema than to the specific value; i
p68233
ag50
aVa column tends to be all dates vs datetimes, not usually individual cells within a column
p68234
aVWith that working assumption (which might not fit your scenario) I might use metadata, for example (but not limited to):
p68235
aVThen you can use  to see if it is set per-member
p68236
as(dp68237
g18
V23354
p68238
stp68239
a((dp68240
g2
(lp68241
VIt is odd, in particular because  is supported
p68242
aVCould you, for example, do:
p68243
as(dp68244
g18
V23354
p68245
stp68246
a((dp68247
g2
(lp68248
Vgives the final digit each time, so we add that into an accumulator
p68249
aVperforms integer division, essentially removing the final digit each time
p68250
aVThen we repeat until we have a small enough number
p68251
as(dp68252
g18
V23354
p68253
stp68254
a((dp68255
g2
(lp68256
VMaybe something like a
p68257
aVFor example:
p68258
aVOr if reading from a data-reader (comment):
p68259
as(dp68260
g18
V23354
p68261
stp68262
a((dp68263
g2
(lp68264
VThe easiest way to do this is to prefix the data with the expected count:
p68265
aVOtherwise, you have to detect EOF, which is easy enough with a , but a pain with a
p68266
as(dp68267
g18
V23354
p68268
stp68269
a((dp68270
g2
(lp68271
VNormally, generics are determined at compile time, but they are also a runtime feature
p68272
aVIn this case you are using generic type inference, which uses the variables etc to infer type
p68273
aVIn the method:
p68274
aVall that is known of  in this context is that it must be  so there is an implicit Anmial, i
p68275
ag50
aVOther options:
p68276
aVuse  to find the actual type of the object
p68277
aVuse  to defer resolution to runtime (note; not an ideal use of dynamic, but it works)
p68278
as(dp68279
g18
V23354
p68280
stp68281
a((dp68282
g2
(lp68283
s(dp68284
g18
V23354
p68285
stp68286
a((dp68287
g2
(lp68288
VThe user-agent for these devices includes "iPod", "iPad" or "IPhone" as appropriate
p68289
aVNote that there are several user agents in play, so an exact match is unwise - but have a look from your device at http://whatsmyuseragent
p68290
aVcom
p68291
aVSo check the user-agent in the headers
p68292
as(dp68293
g18
V23354
p68294
stp68295
a((dp68296
g2
(lp68297
VI would add logging to assess it in production, and rethrow in dev - to understand the issues:
p68298
as(dp68299
g18
V23354
p68300
stp68301
a((dp68302
g2
(lp68303
VThat code is recursive (when you try to get or set that property it goes on forever - follow the code
p68304
aV; the IDE is probably trying to either display that in a property-grid, or write code for the designer
p68305
aVcs - and is hitting your friendly stack-overflow exception
p68306
aVAs appropriate implementation would be:
p68307
as(dp68308
g18
V23354
p68309
stp68310
a((dp68311
g2
(lp68312
VYour  is responsible for configuring the routes, usually via
p68313
aVYou can edit this to explicitly add your own patterns or individual mappings
p68314
aVFor example:
p68315
as(dp68316
g18
V23354
p68317
stp68318
a((dp68319
g2
(lp68320
VThe database name isn't prepended; that is the schema (historically: owner, but a bit more complex) of the object
p68321
aVIt will not work without the schema, especially for a UDF, where it is a mandatory part of the calling syntax in TSQL
p68322
aVBy which I mean that:
p68323
aVis not valid TSQL; it must include the schema, for example:
p68324
aVThe database would be before that; multi-part object naming is:
p68325
aVso  is an object called , and  is  in the  database
p68326
aVI suspect the problem here is that you have chosen the "default schema" for the database on a per-database basis, which is a bad design, IMO
p68327
aVA LINQ data-context works just fine against any database with appropriate objects - you simply supply the connection-string (or connection) at runtime via the constructor
p68328
as(dp68329
g18
V23354
p68330
stp68331
a((dp68332
g2
(lp68333
s(dp68334
g18
V23354
p68335
stp68336
a((dp68337
g2
(lp68338
VYour  will have been updated to account for any  /  parameters
p68339
aVSince you believe it is the last one:
p68340
as(dp68341
g18
V23354
p68342
stp68343
a((dp68344
g2
(lp68345
VIt sounds like you have a property called ; there is a convention for change handlers to follow the  pattern, so the binding code (in the property-descriptor, mainly) spots this pattern and tries to subscribe with an event-handler
p68346
aVIn this case, it is fairly doomed
p68347
aVYou might want to check that they are using the same
p68348
aVNET version (including service packs); maybe this was improved in later versions
p68349
aVOf course, assuming there is a  property, you could just switch back to  and have the subscriber query from there
p68350
as(dp68351
g18
V23354
p68352
stp68353
a((dp68354
g2
(lp68355
VAfaik (and I've done a good amount of IL), no this isn't possible as presented, and even if it were it would almost certainly lead to unverifiable IL (not good), as there would be no way to prove the stack is balanced
p68356
aVAlso remember that the offset is part of the IL instruction, not the stack - so you couldn't store it in a local (or on the stack) and reload it etc
p68357
aVJust structure the code more cleanly; use calls where necessary to call into sub methods, and maybe a jump-table ("switch" essentially)
p68358
as(dp68359
g18
V23354
p68360
stp68361
a((dp68362
g2
(lp68363
VIn
p68364
aVNET 3
p68365
aV5 and above, that is
p68366
aVUnfortunately the only provided implementation is the immutable , however it is easy to re-implement
p68367
aVAn  is included in MiscUtil
p68368
aVWith an , the  indexer returns an  (even if there were no matches for that key), so typical usage is:
p68369
as(dp68370
g18
V23354
p68371
stp68372
a((dp68373
g2
(lp68374
V1: a list of unknown type could be the non-generic , or , or
p68375
aV2:
p68376
aVAlternatively, look at writing a generic method, ideally something like:
p68377
aVand use  to create new items, and  to talk about the
p68378
aVWith a generic method the caller supplies the T - often implicitly
p68379
aVNote that there is no need for the  in your example
p68380
as(dp68381
g18
V23354
p68382
stp68383
a((dp68384
g2
(lp68385
VThere is no standard language syntax for that
p68386
aVTo create an implementation of  on the fly you could use Reflection
p68387
aVEmit and maybe something involving generics and/or / (with or without ), but it is a non-trivial amount of work
p68388
aVEssentially, this is what many of the mocking frameworks do
p68389
aVLook to them, perhaps
p68390
as(dp68391
g18
V23354
p68392
stp68393
a((dp68394
g2
(lp68395
VYou are attempting to assign an  to a variable with type  - that can't work
p68396
aVAn enumerable is not a collection, and certainly isn't that specific collection
p68397
aVMany collections allow an enumerable constructor, so this may work:
p68398
as(dp68399
g18
V23354
p68400
stp68401
a((dp68402
g2
(lp68403
VIf you are reading/writing this, I would simply translate it at the  level, somthing like:
p68404
aVIf you are doing lots of it, you could wrap it up into something more elegant, perhaps using attributes to specify the offsets - but for 10
p68405
aVmeh
p68406
aVnot worth it
p68407
aVWriting a robust generic converter is lots of hard work
p68408
as(dp68409
g18
V23354
p68410
stp68411
a((dp68412
g2
(lp68413
VIf you mean with BinaryFormatter (which is usually where this kicks) - don't; it isn't (IMO) suitable for storage - only for transport (and versioning is much less an issue here, as you probably control both ends of the pipe)
p68414
aVMany other serializers of every variety are available; most of them cope just fine with versioning
p68415
aVPersonally, I would go for:
p68416
aVxml: XmlSerializer (DataContractSerializer isn't as flexible in the output, but can handle graphs)
p68417
aVjson: JavaScriptSerializer
p68418
aVbinary: protobuf-net (I'm biased here)
p68419
aVWith any of these, you should be fine between versions, adding members, renaming fields, etc
p68420
aVActually, I'd use the above 3 even if I was just transporting (not storing)
p68421
as(dp68422
g18
V23354
p68423
stp68424
a((dp68425
g2
(lp68426
VSince you aren't specifying the columns explicitly, I assume  is being passed into an  column, which as the error indicates you can't do unless you force it via
p68427
aVUsually, you let the DB generate this; specify the columns in the  and omit the identity column (and don't try to assign a value)
p68428
aVThe straight after the  your new id is available as
p68429
as(dp68430
g18
V23354
p68431
stp68432
a((dp68433
g2
(lp68434
Vprotocol buffers certainly provides serialization, although the RPC side of things is left to your imagination (often something simple and socket-based works very well)
p68435
aVThe data-types are all well supported by protobuf (although you might want to use something like ms into the unix epoch for the date)
p68436
aVNote though that protobuf doesn't include compression (unless you also apply gzip etc to the stream)
p68437
aVSo the message will be "a bit longer than the string (which always uses UTF-8 encoding in protobuf)
p68438
aVI say a "a bit" because the varint algorithm for integer types could give anything between 1 and 10 bytes each for the id and timestamp, depending on their magnitude
p68439
aVAnd a few (3, probably) bytes for the field headers
p68440
aVIf that sounds about right, then it should work fine
p68441
aVIf you have lots of text data, though, you might want to run the protobuf stream through gzip as well
p68442
aVJava has excellent support within protobuf via the main google trunk
p68443
as(dp68444
g18
V23354
p68445
stp68446
a((dp68447
g2
(lp68448
VNo, basically, without making it less efficient
p68449
aVIf there is a return value, you can use:
p68450
aVbut that is about it
p68451
aVWell, you can create a pair of delegates from the method group, but that adds overhead for no good reason
p68452
aVI won't endorse it
p68453
as(dp68454
g18
V23354
p68455
stp68456
a((dp68457
g2
(lp68458
VAs discussed in comments, it might be sufficient just to preload the assemblies:
p68459
as(dp68460
g18
V23354
p68461
stp68462
a((dp68463
g2
(lp68464
Vif you still mean http, that is pretty trivial - you simply set an appropriate content-type, and write your data to the response stream
p68465
aVThe exact how depends on your web framework and tools, but this is no different to (say) serving generated images on the fly
p68466
aVHTTP requests function fine for messaging scenarios - as simple as making an http request (typically POST) with a protobuf (etc) body, and processing the response in the same way
p68467
aVcan't comment
p68468
aVa web app can be lightweight; certainly more-so than having to configure a non-http service/daemon
p68469
aVThe "lightweight" option would be raw sockets, but that is harder to deploy, and you'll have to be more picky choosing a host
p68470
aVUnless you absolutely need this level of terseness (i
p68471
ag50
aVdropping the http headers and writing your own transport to get close to the wire), just stick with http - it'll be a lot easier to get going and maintain
p68472
aVFor info, I have a blog post on doing this with ASP
p68473
aVNET MVC; this isn't intended to mean "do this" (heck, use whatever tools help you) - simply, it is meant to show the kind of thing necessary
p68474
as(dp68475
g18
V23354
p68476
stp68477
a((dp68478
g2
(lp68479
VI always bulk insert into a staging table (a table representive of the final home, but not used by the transactional system)
p68480
aVThis:
p68481
aVallows me to validate through TSQL (including checking any related data in other tables etc)
p68482
aVensures the final  (into the real table) is fully logged (bulk inserts aren't, necessarily)
p68483
aVensures nobody reads the incomplete/unvalidated data
p68484
aVprevents any blocks etc (to or from the live system)
p68485
aVinsulates from problems if the insert fails half way through
p68486
aVIn your case, the first bullet is most paramount, but all the others matter too
p68487
aVAlso, since the data is coming from
p68488
aVNET, make sure you are using  if this truly is a bulk insert
p68489
as(dp68490
g18
V23354
p68491
stp68492
a((dp68493
g2
(lp68494
VThe language spec explicitly states (8
p68495
aV13) that the captured value is tested for null if necessary, i
p68496
ag50
aVthe  is essentially (with caveats around non-nullable types)
p68497
aVI frequently use this to my advantage, for things that might be null, but when they aren't: need disposing
p68498
aVIn fact, here's a useful scenario (manually enumerating ):
p68499
aVas the non-generic version of  isn't necessarily , but when it is, should be disposed
p68500
as(dp68501
g18
V23354
p68502
stp68503
a((dp68504
g2
(lp68505
VI hate to say it, but it depends on whether the setting is intended to span all clients to the database, vs whether different nodes/applications would require different values
p68506
aVHaving the values in the database can make it easier to centrally configure the system via the system itself (an admin page), without needing to re-deploy or reconfigure any nodes
p68507
aVDisconnected clients can also work either way, as long as they capture the settings locally when connected (being able to connect at least once is not unreasonable)
p68508
aVOf course, even per-node settings can be in the db if you add suitable dimensions to the table
p68509
aVThe one setting that is a pain, of course, being the connection details
p68510
as(dp68511
g18
V23354
p68512
stp68513
a((dp68514
g2
(lp68515
V has to convert the object to a string to print it; the default implementation uses the type's name, but you can override it:
p68516
aVor if (comment) you want a conversion operator:
p68517
as(dp68518
g18
V23354
p68519
stp68520
a((dp68521
g2
(lp68522
VReflection and  are a bit of a pain; reflection uses , and  has special boxing/unboxing rules for
p68523
aVSo by the time you have an  it is  no longer a  - it is either  or the value itself
p68524
ag412
ag50
aVThis makes it a bit confusing sometimes, and note that you can't get the original  from an empty  that has been boxed, as all you have is a
p68525
as(dp68526
g18
V23354
p68527
stp68528
a((dp68529
g2
(lp68530
Vstatic items should generally be a: minimised, and b: thread-safe
p68531
aVIn any threaded scenario you are otherwise at a great risk of problems from concurrency - and ASP
p68532
aVNET is very, very threaded
p68533
aVPersonally, I just wouldn't here - having public access to a static list is doomed to failure
p68534
aVI might have a private list and some static helper methods that  and obtain a specific item etc, but I'd look at it for a long while to decide if it "smells"
p68535
aVNote also that static doesn't work well with multi-tenancy
p68536
as(dp68537
g18
V23354
p68538
stp68539
a((dp68540
g2
(lp68541
VAbsolutely nothing, with a few very specific examples:
p68542
aVPrincipalPermissionAttribute
p68543
aVMethodImplAttribute
p68544
aVetc
p68545
aVwhich have some very specific handling
p68546
aVOther than that, attributes are inert and only activated when explicitly using reflection
p68547
aVThere are a few that the compiler uses, though - ConditionalAttribute, SerializableAttribute, etc
p68548
aVBut to reiterate, in the general case and for the vast majority of attributes: nothing, nil, zip, nada nix and null
p68549
as(dp68550
g18
V23354
p68551
stp68552
a((dp68553
g2
(lp68554
Vor to be more selective about non-empty text nodes:
p68555
as(dp68556
g18
V23354
p68557
stp68558
a((dp68559
g2
(lp68560
VSomething like:
p68561
aVin particular:
p68562
aVthis isn't really an entry-point; it is just an arbitrary method
p68563
aVsince it is a static method, you don't need to create an instance
p68564
as(dp68565
g18
V23354
p68566
stp68567
a((dp68568
g2
(lp68569
VThat is already in place; you just aren't seeing it as by default raw errors are displayed if your request comes from the web-server itself - very useful for debugging
p68570
aVRemote visitors would see the default error
p68571
aVcshtml result:
p68572
aVSorry, an error occurred while processing your request
p68573
aVTo see the error page even when local, ensure the customErrors mode is "On":
p68574
aVYou may need to add this to  in web
p68575
aVconfig
p68576
aVBut most commonly during debugging this is set to "RemoteOnly"
p68577
as(dp68578
g18
V23354
p68579
stp68580
a((dp68581
g2
(lp68582
VI've had a play with the code, and I can repro for both struct and class; ultimately I suspect the issue here is that  isn't designed to be appendable quite like that, i
p68583
ag50
aVI suspect it is misinterpreting data from the next object as part of the current
p68584
aVFWIW, those really shouldn't be structs, and you are (IMO) horribly over-engineering the save/load code
p68585
aVI changed it so that the save method took a , and the load code returned a single  (i
p68586
ag50
aVso there is only one outermost object in the stream) and it worked fine, supporting my theory
p68587
aVIf you need to be able to gradually append individual objects, I would suggest protobuf-net; you can use  to write an object in a way suitable for append, and  to read a single object from the stream, or  to read (as a sequence) all the items in the stream
p68588
aVFor example, using protobuf-net v2 (only available as code at the moment):
p68589
aVv1 (available as a dll; more stable) would work almost the same, but doesn't support structs - only classes
p68590
aVBut to emphasise:
p68591
aVthey should be classes
p68592
aVpublic fields are a bad idea
p68593
as(dp68594
g18
V23354
p68595
stp68596
a((dp68597
g2
(lp68598
VRather than , use ; this will work correctly with  (for reference-types),  (for value-types), types that implement , and any other types using
p68599
aVYou might want to cache it, though:
p68600
as(dp68601
g18
V23354
p68602
stp68603
a((dp68604
g2
(lp68605
VIf the "latter made it work", you are probably using data-binding; data-binding usually works only against properties (not fields)
p68606
aVThese can be explicit properties, or automatically implemented properties like in your example
p68607
aVNote that changing from a field to a property can break serialization if you are using  (which IMO is deeply flawed anyway), but properties are very much preferred over fields
p68608
aVAbsolutely make this change ;p
p68609
as(dp68610
g18
V23354
p68611
stp68612
a((dp68613
g2
(lp68614
V&& is defined as a short-circuiting operator; if the first operand evaluates false, it is demanded to short circuit there and not evaluate the right hand side
p68615
aVWhat else would you expect it to do
p68616
aVThis allows checks like  etc
p68617
aVYour question basically says "if I write an incorrect implementation of a true/false operator, bad things happen"
p68618
aVso; don't do that
p68619
aVeither don't write a true/false operator at all, or if you do; do it right
p68620
aVThere are also and  which do not short-circuit
p68621
as(dp68622
g18
V23354
p68623
stp68624
a((dp68625
g2
(lp68626
VThat is a  enum, which doesn't really have a direct map in protobuf (as defined by google)
p68627
aVI would simply re-expose as :
p68628
aVAdditionally, IIRC, I have already coded v2 to operate this way on  automatically, and to optionally allow pass-thru of enums  (to treat as the underlying value automatically)
p68629
as(dp68630
g18
V23354
p68631
stp68632
a((dp68633
g2
(lp68634
VI would expect this to be the file rather than the writer; if this were C#, I would use something like:
p68635
aV(and I believe VB has the same thing, probably ) saves a lot of pain here
p68636
as(dp68637
g18
V23354
p68638
stp68639
a((dp68640
g2
(lp68641
VAs already noted (comments), the easier approach is just to use a lambda:
p68642
aVbut you can also use meta-programming for this (below)
p68643
aVHere you control the method name, and have more flexibility (not that you need it here)
p68644
aVBut note that this doesn't really add a method to the type - the dynamic method is separate and disconnected
p68645
aVYou can't really add members to types at runtime
p68646
aVA final thought here might be to use , but it is very hard to choose names at runtime with
p68647
as(dp68648
g18
V23354
p68649
stp68650
a((dp68651
g2
(lp68652
VNothing inbuilt; there is  which operates as a multi-map, but that is immutable
p68653
aVI wrote a mutable  for MiscUtil which may help
p68654
as(dp68655
g18
V23354
p68656
stp68657
a((dp68658
g2
(lp68659
VYes, reference updates are guaranteed to be atomic in the language spec
p68660
ag691
aV5 Atomicity of variable references
p68661
aVReads and writes of the following data types are atomic: bool, char, byte, sbyte, short, ushort, uint, int, float, and reference types
p68662
aVIn addition, reads and writes of enum types with an underlying type in the previous list are also atomic
p68663
aVReads and writes of other types, including long, ulong, double, and decimal, as well as user-defined types, are not guaranteed to be atomic
p68664
aVHowever inside a tight loop you might get bitten by register caching
p68665
aVUnlikely in this case unless your method-call is inlined (which might happen)
p68666
aVPersonally I'd add the  to make it simple and predictable, but  can help here too
p68667
aVAnd note that full thread-safety is more than just atomicity
p68668
aVIn the case of a cache, I'd be looking at , personally - i
p68669
ag50
aVtry to update, but if it fails redo the work from scratch (starting from the new value) and try again
p68670
as(dp68671
g18
V23354
p68672
stp68673
a((dp68674
g2
(lp68675
VSwearing black and blue about anything without giving reasons why is, frankly, dumb
p68676
aVThere are scenarios where data-binding is great, and scenarios where it is more trouble than it is worth
p68677
aVYour colleague isn't doing you any favors if only reporting from the "pain" end of the spectrum
p68678
aVFor simple display of data, great
p68679
aVIt'll save you lots of time and errors
p68680
aVFor direct updates of data (including property logic and  support), again, great
p68681
aVAnd indeed it is a core part of WPF etc
p68682
aVThere are scenarios where it isn't so helpful:
p68683
aVmassive data volumes (where "virtual" mode helps, or better: don't display 10 million rows; it isn't helpful to anyone)
p68684
aVif you don't want the updates to be direct, but rather: deferred - although binding to a view-model (rather than your domain-model) is a good counter argument to that
p68685
aVwhen you have lots of different threads trying to bind to the same data (again, independent view-models help here)
p68686
aVI would ask your colleague "why"; and if they can't give a good reason, I'd be inclined to ignore them
p68687
aVWithout a sensible discussion behind it is just FUD
p68688
as(dp68689
g18
V23354
p68690
stp68691
a((dp68692
g2
(lp68693
VLike winforms, Gtk has thread affinity
p68694
aVYour updates should happen on the main UI loop
p68695
aVYou can do this via:
p68696
aVSee also the mono Best Practices notes on this
p68697
as(dp68698
g18
V23354
p68699
stp68700
a((dp68701
g2
(lp68702
VInside a process address-space, everything is just bytes; some stack, some managed heap, etc
p68703
aVBytes are inherently serializable - they are just bytes
p68704
aVAll hibernate has to do is suspend the threads and write the entire address space to disk
p68705
aVWith objects, you want to save them to some out-of-memory structure
p68706
aVUnfortunately, it makes no sense to store addresses etc, as it is exceptionally unlikely to rehydrate into exactly the same point in memory
p68707
aVAdditionally, many things like unmanaged object handles will make no sense when rehydrated
p68708
aVIt is also extremely likely that you want to save just a small block of objects, not an entire process space
p68709
aVAnd even in a small graph, those objects could be scattered all over the place - so you can't just copy out a few pages of memory
p68710
aVAlso keep in mind that a common use of serialization is to deep-clone objects; if you relied on the in-memory representation of objects, you would have to deserialize to exactly the same place in memory - so you can't have cloned anything
p68711
aVAnd that is *before you touch on concepts such as compacting garbage collectors, which move objects around in memory while you aren't looking
p68712
aVAlso consider that you might be loading the data into a different platform / architecture, or want to write a specific format (xml, json, etc)
p68713
aVSo instead of just copying raw memory, serialization code must look at individual objects, traversing references and writing an object graph in a way that allows rehydration from a source that has nothing at all to do with raw memory
p68714
aVMuch harder
p68715
as(dp68716
g18
V23354
p68717
stp68718
a((dp68719
g2
(lp68720
VThat is hard to answer without seeing both ends of the pipe (but in particular the sending end)
p68721
aVonly really indicates the state of the local buffer (not the stream itself); in terms of determining the end of a stream it is largely useless (t reports something unrelated)
p68722
aVI expect this is a bug in the transmitting code
p68723
aVA classic error here is the following:
p68724
aVWhen it should be:
p68725
aVThe first (and incorrect) version sends the garbage portion of the memory-stream's backing buffer
p68726
as(dp68727
g18
V23354
p68728
stp68729
a((dp68730
g2
(lp68731
VThis overhead is quite simply the information it needs to know where each of the 20 objects starts and ends
p68732
aVThere is nothing I can do different here without breaking the format (i
p68733
ag50
aVdoing something contrary to the spec)
p68734
aVIf you really want the gory details:
p68735
aVAn array or list is (if we exclude "packed", which doesn't apply here) simply a repeated block of sub-messages
p68736
aVThere are two layouts available for sub-messages; strings and groups
p68737
aVWith a string, the layout is:
p68738
aVwhere  is the varint-encoded mash of the wire-type and field-number (hex 08 in this case with field 1),  is the varint-encoded size of , and data is the sub-object itself
p68739
aVFor small objects ( less than 128 bytes) this often means 2 bytes overhead per object, depending on a: the field number (fields above 15 take more space), and b: the size of the data
p68740
aVWith a group, the layout is:
p68741
aVwhere  is the varint-encoded mash of the wire-type and field-number (hex 0B in this case with field 1),  is the sub-object, and  is another varint mash to indicate the end of the object (hex 0C in this case with field 1)
p68742
aVGroups are less favored generally, but they have the advantage that they don't incur any overhead as  grows in size
p68743
aVFor small field-numbers (less than 16) again the overhead is 2 bytes per object
p68744
aVOf course, you pay double for large field-numbers, instead
p68745
as(dp68746
g18
V23354
p68747
stp68748
a((dp68749
g2
(lp68750
VI would just add an extra property:
p68751
aVand set the
p68752
as(dp68753
g18
V23354
p68754
stp68755
a((dp68756
g2
(lp68757
Vsimple enough; just run (at the vs command prompt)
p68758
aV(which will create )
p68759
aVNote, however, that most of the intrinsic options here haven't changed much since 2
p68760
ag190
aVFor the options, use  or see MSDN; for example  can be useful
p68761
as(dp68762
g18
V23354
p68763
stp68764
a((dp68765
g2
(lp68766
VArithmetic overflow; for example:
p68767
aVSo use  when you don't want accidental overflow / wrap-around to be a problem, and would rather see an exception
p68768
aVexplicitly sets the mode to allow overflow; the default is  unless you tell the compiler otherwise - either through code (above) or a compiler switch ( in csc)
p68769
as(dp68770
g18
V23354
p68771
stp68772
a((dp68773
g2
(lp68774
VI would suggest, if only for debugging, handle the connection yourself for now, i
p68775
ag50
aVthis might at least get you started in terms of finding the problem at
p68776
aVBut it sounds to me like maybe the DB (/catalog) doesn't exist, or the account doesn't have access to it
p68777
as(dp68778
g18
V23354
p68779
stp68780
a((dp68781
g2
(lp68782
VAn individual element is not the array, and unless you do something to make the array available, so element *will have access to the array
p68783
aVRather - it will have access to itself (aka `thi
p68784
aVWhat you could do is make the method :
p68785
aVSide note (unrelated): I doubt that  is the right choice here; it very rarely is
p68786
aValways default to  unless you can state exactly why you are making it a
p68787
as(dp68788
g18
V23354
p68789
stp68790
a((dp68791
g2
(lp68792
VXmlSerializer doesn't support serialization callbacks
p68793
aVOne option is to use IXmlSerializable, but that is lots of work
p68794
aVIn some simple cases DataContractSerializer may be a viable option; it supports the cllbacks, but it does not support as many XML scenarios (most notably: no attributes)
p68795
aVYou may be out of luck, in which case consider a separate DTO and domain type
p68796
aVFor example, you could deserialize into , then copy the values into a , manually telling it that this is via serialization
p68797
as(dp68798
g18
V23354
p68799
stp68800
a((dp68801
g2
(lp68802
Vnet 3
p68803
aV0 is basically
p68804
aVnet 2
p68805
aV0 plus service pack plus some libraries
p68806
aVThe extra libraries won't hurt, but there are changes in the service pack; you could in theory hit an edge case that makes it not work
p68807
aVSo test it
p68808
aVBut usually you are fine
p68809
as(dp68810
g18
V23354
p68811
stp68812
a((dp68813
g2
(lp68814
VYou are seeing  because there is no overloaded  - it is doing a direct reference compare
p68815
aVTo do that, all it has to do is directly compare two numbers on the stack; this is just about the fastest thing it can do
p68816
aVobject
p68817
aVEquals is ambiguous; there are two;
p68818
ag6106
aVEquals(y) is a virtual method, so may well be overridden
p68819
aVDepending on the type, a virtual call, a static call or a constrained call will be issued, which may have a custom implementation
p68820
aVobject
p68821
aVEquals(x,y) is a static method, which checks first for nulls; 2 nulls = true,  1 null = false, 0 nulls - call x
p68822
aVEquals(y)
p68823
aVBut to focus on the question, it is logically a == on native ints; in most JITs I would hope that this remains a == against two integer types (possibly pointers), but JITs vary (or may in fact not even exist - MF is an interpreter)
p68824
as(dp68825
g18
V23354
p68826
stp68827
a((dp68828
g2
(lp68829
VSince BoltClock has already covered the dictionary answer - here's another alternative to consider; type information:
p68830
aVwith (at the caller)
p68831
aVpersonally though - I like the approach that LINQ-to-SQL takes here; the TSQL string is (for example)
p68832
aVand you just pass in a  of the parameters; the code finds the tokens and invents the argument names for each  etc in the case of sql server
p68833
as(dp68834
g18
V23354
p68835
stp68836
a((dp68837
g2
(lp68838
VWhat is the format
p68839
aVIf it is text, passing in a  would be ideal; and for xml, an
p68840
aVIf it is arbitrary binary, pass in a
p68841
aVFor large data, the ideal approach where possible is to read the data in a non-buffered way - i
p68842
ag50
aVdon't load it all into memory
p68843
aVIterator blocks can be useful here, for example here's a silly example that shows reading lines (but it could just as easily  objects built from data in a stream):
p68844
aVobviously in the general case a lot more processing may be necessary per item
p68845
aVThe caller now has a lazily-spooling, non-buffered source of your data, for example:
p68846
aVAnd handling stream/textreader etc allows them to use it in a decorator chain with things other than files; network streams, in-memory streams, compression/crypto streams, etc
p68847
as(dp68848
g18
V23354
p68849
stp68850
a((dp68851
g2
(lp68852
VYou might try the older
p68853
aVIn C# parlance,
p68854
aVIn particular, this works with , which underpins a lot of data-binding
p68855
as(dp68856
g18
V23354
p68857
stp68858
a((dp68859
g2
(lp68860
VAccording to the docs, the last parameter is a string
p68861
aVSo:
p68862
aVBut you should also just be able to use tabtab
p68863
as(dp68864
g18
V23354
p68865
stp68866
a((dp68867
g2
(lp68868
VLooking at the problem as reported, it seems to make no sense
p68869
aVThe two versions should be identical
p68870
aVI wonder, though, if the problem here is that the camera API is using  at some point, and it is trying to look for a // operator
p68871
aVThis might convince it to switch to  logic:
p68872
as(dp68873
g18
V23354
p68874
stp68875
a((dp68876
g2
(lp68877
Vet voila
p68878
as(dp68879
g18
V23354
p68880
stp68881
a((dp68882
g2
(lp68883
VTo sort it in-place, you can use the overload that accepts a comparison delegate:
p68884
as(dp68885
g18
V23354
p68886
stp68887
a((dp68888
g2
(lp68889
VYes - but exactly which is a little complex (see MSDN):
p68890
aVIf the SynchronizingObject property is null, the Elapsed event is raised on a ThreadPool thread
p68891
aVIf processing of the Elapsed event lasts longer than Interval, the event might be raised again on another ThreadPool thread
p68892
aVIn this situation, the event handler should be reentrant
p68893
aVBut either way; it isn't your thread - code appropriately, with synchronization
p68894
as(dp68895
g18
V23354
p68896
stp68897
a((dp68898
g2
(lp68899
VNo, it is about a lot more, especially with more sophisticated obfuscators
p68900
aVThey can produce IL that cannot be expressed in most languages, and where the logic flow is horribly tangled to befuddle the best of tools
p68901
aVWith lots of time you can do it (probably lots by hand), and there is certainly an arms race between the obfuscators and deobfuscators - but you vastly underestimate the technology here
p68902
aVAlso, note that many obfuscators look at an entire application (not just one assembly), so they can change the public API too
p68903
as(dp68904
g18
V23354
p68905
stp68906
a((dp68907
g2
(lp68908
VRe your 2nd point (and reading the comment); indeed, the "one fail, everything rolls back immediately" is an inherent part of DTC; the entire outer transaction is the atomic unit
p68909
aVYou might be able to use some regular SQL transactions inside the DTC transaction, but to be honest that is making things complex
p68910
aVMy suggestion:
p68911
aVeither write the SQL to succeed (i
p68912
ag50
aVon rollback if something gets very ill; not just for convenience of experimental queries)
p68913
aVor: don't use DTC
p68914
aVand I prefer the first, as rollback is expensive (commit is cheap)
p68915
aV(I don't know definitively for your first point, but I believe that is pretty stone-like)
p68916
as(dp68917
g18
V23354
p68918
stp68919
a((dp68920
g2
(lp68921
VDo you mean to use  instead
p68922
aVthey look like "or" constraints to me
p68923
aValso, when mixing  and , be very clear with brackets
p68924
ag412
ag50
aVis it , or
p68925
as(dp68926
g18
V23354
p68927
stp68928
a((dp68929
g2
(lp68930
V328
p68931
aV94 is not an integer
p68932
aVInteger  divide rounds down; that is how it works
p68933
aVI suggest you cast to decimal:
p68934
aVor with variables:
p68935
as(dp68936
g18
V23354
p68937
stp68938
a((dp68939
g2
(lp68940
VA much simpler (and much more efficient) approach:
p68941
aVand yes, the error is because changing the data deliberately breaks iterators
p68942
as(dp68943
g18
V23354
p68944
stp68945
a((dp68946
g2
(lp68947
VThe problem is that the type inference for T1 doesn't work
p68948
aVActually, the problem isn't T1 - it is T2; return types are not used in this inference
p68949
aVSo you can't do that
p68950
aVOne option might be a fluent API, for example:
p68951
aVwith something like:
p68952
aVassuming that the interface is something like:
p68953
as(dp68954
g18
V23354
p68955
stp68956
a((dp68957
g2
(lp68958
VWith , check
p68959
aVWith , check  (and , for that matter)
p68960
aVYou may also want to check  in the case of  (but this is already handled with ):
p68961
aVIMO,  is a better model to use here; it will allow custom models
p68962
as(dp68963
g18
V23354
p68964
stp68965
a((dp68966
g2
(lp68967
Vnot nice, huh
p68968
aVNote this also assumes that  is public + static, and has no collisions with overloads
p68969
as(dp68970
g18
V23354
p68971
stp68972
a((dp68973
g2
(lp68974
VThat is not a task suitable for LINQ-to-SQL, or frankly any ORM
p68975
aVYou do not want to drag that much data twice over the network in that way; that should ideally be written in pure TSQL, perhaps using bulk insert /  to populate a separate table if you need to combine with data from other sources
p68976
as(dp68977
g18
V23354
p68978
stp68979
a((dp68980
g2
(lp68981
VHow about something like:
p68982
as(dp68983
g18
V23354
p68984
stp68985
a((dp68986
g2
(lp68987
VGenerally this works (assuming you target any-CPU and aren't using any PInvoke that could fall apart), however I wouldn't take that risk unless I have a test environment that matches production
p68988
aVIt may be more advisable, however, to just invest in 64-bit dev infrastructure to most closely mimic your target environment
p68989
aVFinding the problem while you are writing it is far, far cheaper than finding it even in test
p68990
aVAnd certainly cheaper than finding it in production
p68991
as(dp68992
g18
V23354
p68993
stp68994
a((dp68995
g2
(lp68996
VOr (comments) as fluent notation:
p68997
as(dp68998
g18
V23354
p68999
stp69000
a((dp69001
g2
(lp69002
VIf you make it an  it will be suppressed when :
p69003
aVYou can also hide this on your object's API:
p69004
aVwhere  is a pattern recognised automatically by
p69005
as(dp69006
g18
V23354
p69007
stp69008
a((dp69009
g2
(lp69010
VOnce you have the objects,  may be a good fit here (for calling methods and accessing properties etc) - however, that only applies to variables, not namespaces
p69011
aVIf you really need the namespace (I don't think you do), you could pass it in as a string and use
p69012
aVHowever, reading it - it seems that only the application is needed; perhaps:
p69013
aVand call as
p69014
as(dp69015
g18
V23354
p69016
stp69017
a((dp69018
g2
(lp69019
VStatic fields are (unless ) one instance per app-domain, meaning: all requests share the same value
p69020
aVYou need to be exceptionally careful using  in a web application
p69021
aVIf in doubt: don't
p69022
aVRe lifetime; the AppDomain; they won't be collected while assigned to the static field, and will expire if the App-Pool recycles in IIS
p69023
as(dp69024
g18
V23354
p69025
stp69026
a((dp69027
g2
(lp69028
VAnnotating a type with  should be enough to tell it to look for the members marked  - but it sounds like maybe you have a combination of data-contracts and vanilla objects
p69029
aVIf you strictly need xml, my recommendation here would be to write a set of DTO types and use DCS in graph-mode
p69030
aVThis may require some mapping between your object model and the DTOs; but that is usually not a big problem
p69031
aVNote also that DCS in graph-mode is not typical xml output - it will be very different to what  would output
p69032
aVIf you just need to serialize arbitrary types (xml not being the issue), then the current experimental cut of protobuf-net supports all these scenarios; it'll handle the object references, and it'll allow you to work with both annotated and vanilla types (you just need to tell it how)
p69033
aVIf that is an option, perhaps provide a basic example of your model and I might be able to fill in some blanks
p69034
as(dp69035
g18
V23354
p69036
stp69037
a((dp69038
g2
(lp69039
VYou have introduced this by using a type from your DAL as a base-class in the BL; in some ways, maybe the problem is, then, that the BL is using (and exposing) too much about the DAL, when maybe that might be better addressed via IoC
p69040
aVEither way, either live with it, or expect a big refactor;
p69041
aVNET can't use your type if it uses a base-class or interface it can't resolve; so it will need the assembly reference
p69042
as(dp69043
g18
V23354
p69044
stp69045
a((dp69046
g2
(lp69047
VFirst off, it is hard to know if they are the same without checking the return value fro Read - is it possible they are just choosing different chunks
p69048
aV(perfectly valid; it is your job to ensure you loop over Read until you have enough data, or EOF)
p69049
aVHowever, I wonder if a BOM is involved here - especially if you are sitting a text-reader on top of this
p69050
aVSimply, a reader expects the BOM at the start; so it may well hide it the first time through
p69051
aVBut if you rewind the stream while using the same reader/decoder, it won't be expecting a BOM, so will try to report it as character data (or throw an error, depending on the configuraion)
p69052
as(dp69053
g18
V23354
p69054
stp69055
a((dp69056
g2
(lp69057
VThe c# implicit interface implementation (by name match) is convenience only; when doing it by hand you need to associate each in the virtual-method table using typeBuilder
p69058
aVDefineMethodOverride, passing in the new (generated) method and the interface method to satisfy
p69059
aVThis must done for each method of every interface you want to implement
p69060
as(dp69061
g18
V23354
p69062
stp69063
a((dp69064
g2
(lp69065
V is in the eye of the caller only, so no; that isn't possible AFAIK
p69066
aVAs far as  is concerned it is just
p69067
as(dp69068
g18
V23354
p69069
stp69070
a((dp69071
g2
(lp69072
VLimiting the interface implementations means it isn't really acting as an interface (which should accept any implementation (substitution), such as decorators) - so I can't recommend that
p69073
aVAlso, note that with a small exception of generics, treating a struct as an interface leads to boxing
p69074
aVSo that leaves one interesting case; an abstract class with a private constructor, and a known number of implementations as nested types, which means that they have access to the private constructor
p69075
aVNow you control the subtypes, boxing isn't an issue (as it is a class), and there is less expectation of substitution
p69076
as(dp69077
g18
V23354
p69078
stp69079
a((dp69080
g2
(lp69081
VIt all depends on why
p69082
aVBy itself it adds nothing, except perhaps a name
p69083
aVIt might be useful if you have a serializer that doesn't like generics (unless wrapped), or if you want to add/override methods/attributes, or if you simply want a fixed name
p69084
aVNote also that extension methods can be used to add(-ish) methods to such types (without inheritance), and that a using-alias can be used to name it in a single file
p69085
aVPersonally I wouldn't subclass it unless I had a reason
p69086
as(dp69087
g18
V23354
p69088
stp69089
a((dp69090
g2
(lp69091
VThoughts:
p69092
aVyou arent really using the reader except for a few ints; otherwise, all you need is ReadByte you can do that from the Stream, and save some indirection/confusion
p69093
aVread the ints manually to avoid Endianness issues
p69094
aVreading byte by byte can be expensive; if possible, try to fill a buffer (or rather: read the right amount of data) by looping over Read rather that ReadByte
p69095
aVif multiple messages are coming down the same pipe, reading to EOF will probably fail (either corrupt the data or block forever); you usually need either a terminator sequence or a length-prefix
p69096
aVI prefer the latter, as it let's you use Read instead of ReadByte
p69097
aVI assume that is packetSize in your example; it is critical to use this: to separate the messages, to verify you have an entire message, and to deny over-sized data
p69098
aVconsider whether async (BeginRead) is suitable - sometimes yes, sometimes no; and note that this makes disposal trickier as you can't use "using" with async
p69099
aVwhen using MemoryStream, using
p69100
aVGetBuffer() in combination with
p69101
aVLength has less overhead than using
p69102
aVToArray()
p69103
as(dp69104
g18
V23354
p69105
stp69106
a((dp69107
g2
(lp69108
VUsually it is pretty obvious with manual inspection
p69109
aVYou might try serialising to a file, and just look at the end of the file - it won't be complete XML, obviously, but it should give a clue
p69110
aVNote that  is capable (by enabling an option) of serialising complete graphs, but it has less XML options than  has - and graph mode is even less XML-like;  IMO removing the cycle is preferable
p69111
aVUsually this is just a case of something like:
p69112
aV(i
p69113
ag50
aVserialize "downwards" references only)
p69114
as(dp69115
g18
V23354
p69116
stp69117
a((dp69118
g2
(lp69119
VIirc,  is still integer subtraction
p69120
aVTo do exclusion you want:
p69121
aVAnd inclusion:
p69122
aVLikewise, to test for a partial match (any bit from Flag):
p69123
aVOr a full match (all the bits in Flag):
p69124
as(dp69125
g18
V23354
p69126
stp69127
a((dp69128
g2
(lp69129
VIf speed-of-development is the key (especially since you have interfaces etc, which you need to configure appropriately for some serializers) then maybe
p69130
aVJust remember to mark any events as:
p69131
aVOn every other measure (CPU performance, bandwidth, robustness as you version, interoperability, cost of maintenance, etc) I would choose other formats :)
p69132
aVHere's a selection profiled:
p69133
aVPerformance Tests of Serializations used by WCF Bindings
p69134
aVPerhaps not a surprise (since I wrote it), but I lean towards protobuf-net
p69135
as(dp69136
g18
V23354
p69137
stp69138
a((dp69139
g2
(lp69140
VReferencing two assemblies with the same name already has lots of problems; some with workarounds (extern alias), some not
p69141
aVYou're best avoiding this by a long distance
p69142
aVRe choosing to copy-local; that is handy if you have it in the GAC, but the target machine might not; for example, you can deploy MVC-3 using copy-local without installing anything on the servers, but on a dev machine they are most likely in the GAC
p69143
as(dp69144
g18
V23354
p69145
stp69146
a((dp69147
g2
(lp69148
VYou can with generic constraints; for example in c#:
p69149
aVThen  will work only when  is typed as something that implements both  and
p69150
as(dp69151
g18
V23354
p69152
stp69153
a((dp69154
g2
(lp69155
VActually, for that scenario all of those are secondary; the first thing you should look at is asyc-IO, aka  etc; this allows you to minimise the number of threads by waiting on IO completion ports - much more efficient
p69156
aVOnce you have a complete message, at that scale I would throw the message into a custom thread-pool/synchronized-queue
p69157
aVI would have a controlled number of regular threads (not pool threads or IOCP) servicing that queue to process each item
p69158
aVAs it happens I'm doing something similar (lower scale) at the moment; to prevent memory exploding, I have capped the work queue; if it gets full (i
p69159
ag50
aVthe workers can't keep up) then you might block IOCP for a small while, perhaps with a timeout eventually that tells the client "too busy" at the IOCP layer
p69160
as(dp69161
g18
V23354
p69162
stp69163
a((dp69164
g2
(lp69165
Vpretty-much the only way to get a (singular) large object is to have a very large string or array (perhaps encapsulated inside a long list)
p69166
aVOtherwise, you just have a large graph of small objects (many)
p69167
aVSmall objects aren't a problem; if it is no longer referenced, the GC will at some point clean it up, and compact the space (depending on the GC implementation)
p69168
aVIf that isn't happening, then perhaps you have given out another reference to the graph - subscribing to an event is a classic way of doing this accidentally; as is adding one of the objects to a list that is still in play
p69169
aVA single missed reference can keep a large graph from being collected, so watch that
p69170
aVSo far, the "fix" is simply; don't call GC; and check you don't have a missed reference
p69171
aVA different problem, however, is when you have arras/strings that are large enough to go onto the "large object heap" (LOH)
p69172
aVThe LOH is not compacted, so you can hit problems with fragmentation here
p69173
aVOne questionable way around that is to use a jagged array, i
p69174
ag50
aV1,000 arrays of length 1,000 (plus an extra array to track them) instead of a single array of length 1,000,000 - YMMV
p69175
as(dp69176
g18
V23354
p69177
stp69178
a((dp69179
g2
(lp69180
VTypical options here include;
p69181
aVhashing the contents and comparing that
p69182
aVrelying onthe audit dates
p69183
aVstoring version in the file and
p69184
aVstoring version in the first line of the file
p69185
aVusing file-watcher events (unreliable by itself, by most accounts)
p69186
aVusing the alternative data streams in NTFS
p69187
aVBut no; plain text files don't have much associated metadata by themselves
p69188
as(dp69189
g18
V23354
p69190
stp69191
a((dp69192
g2
(lp69193
VIf size is your aim, something terse like protobuf would be good; consider some measures: Performance Tests of Serializations used by WCF Bindings
p69194
aVIn your case, using protobuf-net:
p69195
aVThe size doesn't depend on the member-names, it is pure-binary, there are no text overheads, and it uses efficient encodings for most data types
p69196
aVExample usage:
p69197
aVIn fact, the above type will be somewhere between 2 and 6 bytes, depending on the value of the property (integers close to 0 take less space)
p69198
as(dp69199
g18
V23354
p69200
stp69201
a((dp69202
g2
(lp69203
VThe question is about playing cards; 5-of-hearts, 5-of-clubs, 6-of-spades, 7-of-spades, king-of-diamonds; i
p69204
ag50
aV5\u2665 5\u2663 6\u2660 7\u2660 K\u2666
p69205
as(dp69206
g18
V23354
p69207
stp69208
a((dp69209
g2
(lp69210
VI honestly haven't tried
p69211
aVI have looked at cache/session-state, but to be frank view-state is something I've always turned off, or avoided via MVC
p69212
aVSo I lack some of the familiarity
p69213
aVI suspect, however, that it is rather key-heavy; with those keys being fundamental to retrieval and not fixed
p69214
aVThis makes it very hard to package efficiently as protobuf (which works best when the data is predictable ahead of time)
p69215
aVMy gut says "not a good fit"
p69216
aVAnd then it says "meh, horrible view-state is"
p69217
as(dp69218
g18
V23354
p69219
stp69220
a((dp69221
g2
(lp69222
VFirst off, it is important to know if what you are doing is sensible
p69223
aVIf they are all CPU-bound, then do not do this, IMO; a web server is already highly threaded, and is usually a busy place to begin with
p69224
aVChances are high that you will slow the whole thing down by using multiple cores
p69225
aVIt'll look great for 1 user, though
p69226
aVIf you are IO-bound, then there are any number of ways to do this; the preferred would be to use the inbuilt async methods of whatever you are talking to, so you can use IOCP rather than regular threads
p69227
aVSo for a , you would use  etc
p69228
aVThen you need to join everything together
p69229
aVLots more ways; personally I tend to use  and , as this avoids going to unmanaged code (many wait-handles are actually OS-provided)
p69230
aVAlso note: threading/parallelism comes in a bundle alongside many fun ways to fail; normally you only need to worry overly about static methods/data for synchronization, but if you have multiple threads in a single request doing things: watch out for bumps
p69231
aVthere are many
p69232
aVThe next version of
p69233
aVNET is meant to make continuations a lot easier; I need to take a look to see how easily we can apply the current experimental code to IOCP scenarios
p69234
as(dp69235
g18
V23354
p69236
stp69237
a((dp69238
g2
(lp69239
VOnly if, for example, they expose a fluent API and have a return value (i
p69240
ag50
aVsomething that allows you to squeeze multiple steps into a single expression); for example:
p69241
aVotherwise
p69242
aVno; you only get a single expression to evaluate per case
p69243
aVYou could refactor out to methods, of course;
p69244
aVwhich again assumes a return value
p69245
as(dp69246
g18
V23354
p69247
stp69248
a((dp69249
g2
(lp69250
VIt doesn't exist in vanilla VS
p69251
aVYour best bet is ghostdoc or similar
p69252
aVThis is available in the Extension Manager, or here
p69253
as(dp69254
g18
V23354
p69255
stp69256
a((dp69257
g2
(lp69258
VWell, you could measure; but as long as you are  the connections (so they are disposed even if you get an exception), and have pooling enabled (for SQL server it is enabled by default) it won't matter hugely; closing (or disposing) just returns the underlying connection to the pool
p69259
aVBoth approaches work
p69260
aVSorry, that doesn't help much ;p
p69261
aVJust don't keep an open connection while you do other lengthy non-db  work
p69262
aVClose it and re-open it; you may actually get the same underlying connection back, but somebody else (another thread) might have made use of it while you weren't
p69263
as(dp69264
g18
V23354
p69265
stp69266
a((dp69267
g2
(lp69268
VI would assume  would do this (but I don't personally use webforms data-binding, so my apologies if this fails)
p69269
as(dp69270
g18
V23354
p69271
stp69272
a((dp69273
g2
(lp69274
VThe problem with months is that it isn't really a simple measure - they aren't constant size
p69275
aVYou would need to define your rules for what you want to include, and work from there
p69276
aVFor example 1 Jan to 1 Feb - you could argue 2 months are involved there, or you could say that is one month
p69277
aVThen what about "1 Jan 20:00" to "1 Feb 00:00" - that isn't quite an entire full month
p69278
aVIs that 0
p69279
ag733
aVwhat about the other way around (1 Jan 00:00 to 1 Feb 20:00)
p69280
ag733
ag5115
aVFirst define the rules, then you'll have to code it yourself, I'm afraid
p69281
as(dp69282
g18
V23354
p69283
stp69284
a((dp69285
g2
(lp69286
VRe "how"
p69287
aVwell, you could use a Semaphore, Mutex or reset-event (ManualResetEvent, AutoResetEvent), but personally I use  for that;
p69288
aVthread 1:
p69289
aVthread 2:
p69290
as(dp69291
g18
V23354
p69292
stp69293
a((dp69294
g2
(lp69295
Vmaybe something like:
p69296
aVOr if the member-name (feedTime) is dynamic too:
p69297
as(dp69298
g18
V23354
p69299
stp69300
a((dp69301
g2
(lp69302
VBased on the question, the closest I can see is:
p69303
as(dp69304
g18
V23354
p69305
stp69306
a((dp69307
g2
(lp69308
VSimple; for method variables (excluding captured variables, iterator blocks, etc), the variables are on the stack
p69309
aVEach thread has a different stack
p69310
aVThis is no different to a recursive method on a single thread - the method variables are separate and independent per call
p69311
aVFor objects on the heap
p69312
aVit doesn't
p69313
aVNo boundaries; no protection
p69314
aVIf you don't correctly synchronize etc, you will corrupt your data
p69315
aVIn short, this is your job
p69316
as(dp69317
g18
V23354
p69318
stp69319
a((dp69320
g2
(lp69321
VI'd do this with sections, i
p69322
ag50
aVAnd render the "head" section from the layout:
p69323
aVIf you don't want sections, and don't want to pass it around, I would use the HttpContext here; store some data against
p69324
aVIf it is null, create a new one and store it in the context
p69325
aVFor example:
p69326
as(dp69327
g18
V23354
p69328
stp69329
a((dp69330
g2
(lp69331
VIf they are different assemblies, then there is no direct way to do that
p69332
aVYou can get a bit cheeky with , but that is a bit hacky
p69333
aVFrankly, you can't stop external code calling your methods unless you go to extremes
p69334
aVA malicious app can just walk past any modifiers with reflection if they want (since the app calling you probably owns the AppDomain, it can assert full-trust)
p69335
aVThere is some support for caller-based security / permissions, but the regular stuff is largely disabled by "full trust" - you would need to check the caller yourself
p69336
aVNot worth it, IMO
p69337
aVEspecially since from 4
p69338
aV0 code-access permissions are not used any more (see MSDN)
p69339
as(dp69340
g18
V23354
p69341
stp69342
a((dp69343
g2
(lp69344
V hands you back a stream, that you haven't closed
p69345
aVshould work; or easier:
p69346
aVor even just:
p69347
as(dp69348
g18
V23354
p69349
stp69350
a((dp69351
g2
(lp69352
VThe compiler will almost certainly reduce "a" down to "b" anyway in release mode
p69353
aVThere is a case for adding intermediate variables if you are likely to want to debug with break-points at that location
p69354
aVBut IMO "a" adds very little
p69355
aVI'd use "b"
p69356
aVOf course, you could also argue that the  instance adds very little, and a static method should be provided instead
p69357
aVAnd then at that point the method itself is providing very little, and the caller should just call the static  itself
p69358
as(dp69359
g18
V23354
p69360
stp69361
a((dp69362
g2
(lp69363
VI wouldn't touch the main config itself, however you can trivially store a path as a setting, i
p69364
ag50
aVThen at runtime you could use the regular settings framework to get the file-path, and then deserialize from there
p69365
aVThat should work - although I'm not sure it is the classic use-case; people generally like their configuration settings to be human-readable and editable via notepad
p69366
as(dp69367
g18
V23354
p69368
stp69369
a((dp69370
g2
(lp69371
VThat is DataContractSerializer working in full-graph mode
p69372
aVIt isn't compressed - that is simply the format is uses to preserve object references
p69373
aVTurn on full-graph mode when deserializing and it should work
p69374
aVThat is a constructor argument to DataContractSerializer
p69375
as(dp69376
g18
V23354
p69377
stp69378
a((dp69379
g2
(lp69380
VInitially, you are data-binding:
p69381
aVyou should then continue data-binding; either tell the table to clear itself (and repopulate the data), or just assign a different data-table to
p69382
as(dp69383
g18
V23354
p69384
stp69385
a((dp69386
g2
(lp69387
VSomething like "###,##0
p69388
aV##" then
p69389
as(dp69390
g18
V23354
p69391
stp69392
a((dp69393
g2
(lp69394
VUsing an enumerator wildly is a bad idea - for example, it needs disposing - which you haven't done (this could lead to a  being left open - not good)
p69395
aVIn this case, just enumerate it
p69396
aVIf there aren't any records, that will be trivial:
p69397
aVIf you need the data twice, put it in a list:
p69398
as(dp69399
g18
V23354
p69400
stp69401
a((dp69402
g2
(lp69403
Vconvenience counts for a lot - especially as it can be used to wrap code that you can't control (since the code you wrap will enlist automatically, by default)
p69404
aVThis means you can wrap pre-existing libraries that use the server
p69405
aVperformance takes a slight hit, but note that in many cases you'll be using the lightweight transaction manager, not DTC - this means you don't pay full DTC costs
p69406
aVanother disadvantage is that nested transactions can't be rolled back; any rollback immediately rolls back the outer transaction
p69407
aVPersonally I like this approach; if things get ill - stop doing them ASAP
p69408
aVRe your query in point 3; you can open/close as many connections as you like inside the transaction scope, without affecting the behaviour, except you may find (depending on circumstances) that your transaction elevates to DTC
p69409
aVIt is pretty-much guaranteed to elevate if you talk to multiple trnasaction-aware servers
p69410
aVAnother difference: different timeouts apply, especially if DTC gets involved
p69411
aVWhich makes sense: a long-running distributed transaction is poison, and may indicate a cross-server deadlock
p69412
aVDeadlocks are usually detected on a single server, but are pretty much impossible to spot automatically when distributed, so a hard timeout is essential
p69413
as(dp69414
g18
V23354
p69415
stp69416
a((dp69417
g2
(lp69418
VIn this case it doesn't hurt you because you aren't using the delegate at a place outside the loop
p69419
aVOf course, you aren't really doing anything useful in the example, so it is unclear if this "stands" for your actual code
p69420
aVThreads and deferred callbacks would suffer though, so yes it is (in a way) valid
p69421
aVIf unsure, fix it:
p69422
aVTo clarify, this problem only hurts when the captured variable is used outside of the normal flow of the foreach loop
p69423
aVWhen used directly inside the loop, and on the same thread (no ), the captured variable will always be at the expected value
p69424
aVAnything that breaks that will see random data; typically (but not always) the last value
p69425
aVNote in particular that this "deferred delegate" includes things like building up  filters on a query, as you'll find they all use the last value
p69426
aVThe following would be bad:
p69427
aVRe any "better way" (comments)
p69428
aVwell, the cloned variable trick has the advantage of working, but here's a cute trick - fixes the above "BAD CODE
p69429
ag6864
aVPersonally I'd find the following easier to grok though:
p69430
as(dp69431
g18
V23354
p69432
stp69433
a((dp69434
g2
(lp69435
VIt sounds like sheer data overload
p69436
aVPagination, as noted in comments, is a practical solution
p69437
aVIf there is a good reason to want the 80k, you could try using a different mechanism to serialize the data
p69438
aVFor example, protobuf data is generally much smaller than xml, so you might try using that on the wire
p69439
aVHowever, since this is Silverlight I can't (currently) swap this automatically - you would need to return a  or  and handle the serialization/deserialization explicitly at the server/client
p69440
aVThis should drop the bandwidth requirements by a fair whack (even more if you can configure Silverlight to use MTOM - I haven't checked lately, but this wasn't supported in some earlier releases)
p69441
as(dp69442
g18
V23354
p69443
stp69444
a((dp69445
g2
(lp69446
VBut, this isn't locale independent as I am hard coding decimal and numeric separator
p69447
aVNo you aren't; in format specifiers the  and  mean "decimal separator" and "thousands separator" respectively, not literal commas and periods
p69448
aVIt should work correctly
p69449
aVFor example, '#,###
p69450
aV00##' in a fr-FR culture should come out as "1 234,56":
p69451
as(dp69452
g18
V23354
p69453
stp69454
a((dp69455
g2
(lp69456
VI don't think that solution will work well, as neither sub-types nor base-types need be handled by the "other" serializer (if you see what I mean)
p69457
aVPersonally, I would create a DTO layer for the "unusual" tier, and map between them
p69458
aVSo pretty much like the example in the question, perhaps using AutoMapper
p69459
aVThe other option is to see if the other serializer supports metadata from sources other than attributes
p69460
aVSome do, some don't
p69461
aVIf automapper causes problems you could simply annotate your server DTO with the same DCS attributes, and use DCS to translate the model, i
p69462
ag50
aVAs long as the names match, DCS should be happy enough with this
p69463
ag412
ag50
aVuse DCS to serialize from one model and deserialize as the other model
p69464
aVI use similar tricks in a few places (although I tend to use my own serializer for this, not DCS - faster ;p)
p69465
as(dp69466
g18
V23354
p69467
stp69468
a((dp69469
g2
(lp69470
VThe  is the problem; that creates an anonymous type with a property called
p69471
aVJust:
p69472
as(dp69473
g18
V23354
p69474
stp69475
a((dp69476
g2
(lp69477
VYou import a namespace, not a file
p69478
aVSo; what namespace is  in
p69479
aVFor example:
p69480
aV@using My
p69481
aVUtils
p69482
aVAuthentication
p69483
aVcs;
p69484
aVAlso - you want to drop the  in the razor call:
p69485
aVYou can also provide the fully qualified name in the code:
p69486
aV(aside: are you intentionally calling the same method twice with the same values
p69487
as(dp69488
g18
V23354
p69489
stp69490
a((dp69491
g2
(lp69492
VHow about:
p69493
as(dp69494
g18
V23354
p69495
stp69496
a((dp69497
g2
(lp69498
VIf the incoming stream represents rows for a table, then you can write a custom IDataReader implementation that reads from the stream and presents each row in turn (non-buffered)
p69499
aVYou can then feed this to SqlBulkCopy
p69500
aVExample: https://groups
p69501
aVgoogle
p69502
aVcom/group/microsoft
p69503
aVpublic
p69504
aVdotnet
p69505
aVlanguages
p69506
aVcsharp/msg/b1d70b504cdee2ad
p69507
aVhl=en&pli;=1
p69508
as(dp69509
g18
V23354
p69510
stp69511
a((dp69512
g2
(lp69513
VThe fact that multiple
p69514
aVNET languages share a runtime and BCL, and can talk to each-other very easily is due to the CLR/CLI, but ultimately the VS IDE doesn't just write CLI (unmanaged C++ being the obvious example)
p69515
aVSimply, the IDE (like many others) is designed to be extensible
p69516
aVIf you wanted, I'm very sure it would be possible to write your own compiler plugin for VS, using a managed or unmanaged language
p69517
as(dp69518
g18
V23354
p69519
stp69520
a((dp69521
g2
(lp69522
VThe in-line assignment will define the type of ; if the  and  are compatible with  that'll work, but the first assignment is pointless
p69523
aVYou could perhaps cast a  if it is a ref-type; this will essentially a no-op:
p69524
aVBut by that point, you might as well just use no assignment:
p69525
aVArguably a better layout would be
p69526
aVNote that if there isn't an obvious same type (perhaps they are different subclasses of a common base-type), you may need to help it decide:
p69527
aVIf the types are unrelated, this is not an appropriate use of ; you may find  or  more suitable
p69528
as(dp69529
g18
V23354
p69530
stp69531
a((dp69532
g2
(lp69533
VI can't comment on that implementation, but in protobuf-net streaming is fully possible
p69534
aVIf all the objects you want to stream are first-level children of the root object, then you can simply iterate over the outer sequence; using  if they are all the same type, or  if there are different types of objects involved
p69535
aVIf the item you want to treat as a stream is in the middle of the tree, you can provide an alternative receiving model; by just implementing IEnumerable and Add() on a fake collection, it can push data through any API you want (event-based, for example - SAX like)
p69536
aVI should also note that you can serialize streaming data in exactly the same ways
p69537
aVIt is not required to have a complete object model at any point
p69538
aVIf you want a more complete example, let me know
p69539
as(dp69540
g18
V23354
p69541
stp69542
a((dp69543
g2
(lp69544
VIf you want it to open in-place, then the disposition should be "inline", not "attachment"
p69545
aVIE in particular is fussy about the end of the filename; iirc I've had success simply with  - i
p69546
ag50
aVIt only looked (or looked) at the end of the URL; not the content type
p69547
aVIt isn't clear in the example, but you should also ensure nothing else unexpected are in the stream
p69548
aVIn particular you mat need to clear any headers that have already been written
p69549
aVUse something like fiddler to check what actually goes down the wire
p69550
as(dp69551
g18
V23354
p69552
stp69553
a((dp69554
g2
(lp69555
VThe 0 you are passing in is the type, not the value
p69556
aV0 literals (and constant values) are allowed for any enum type - meaning the 0 of the underlying enum type, and are a better "match" than object, since it doesn't need boxing
p69557
aVPersonally, I would use;
p69558
aVperhaps in the object initializer
p69559
as(dp69560
g18
V23354
p69561
stp69562
a((dp69563
g2
(lp69564
VI'm not familiar with an AD octet string, but arbitrary octets should indeed use  -  being the most versatile
p69565
aVIf the string is hex or base-64, the translation should be very easy
p69566
aVIt will take less space correctly stored as a BLOB
p69567
as(dp69568
g18
V23354
p69569
stp69570
a((dp69571
g2
(lp69572
Vwould the MS charting library suffice
p69573
aVIt supports both web and winforms usage
p69574
as(dp69575
g18
V23354
p69576
stp69577
a((dp69578
g2
(lp69579
Vlambdas and loops are orthogonal
p69580
aVIt is inappropriate to try to change them to brute-force one into the other
p69581
aVThat code is fine
p69582
aVLeave it
p69583
aVYou can get  implementations, but it isn't going to make the code better (in fact, it will be harder to follow, i
p69584
ag50
aVworse), and it won't be more efficient (in fact, it will be marginally slower, i
p69585
ag50
aVworse)
p69586
as(dp69587
g18
V23354
p69588
stp69589
a((dp69590
g2
(lp69591
VSince you are talking about UI, you might want to look at BackgroundWorker, which offers a RunWorkerCompleted event that fires on the UI thread, and indicate success/failure/cancel etc
p69592
aVhttp://msdn
p69593
aVmicrosoft
p69594
aVcom/en-us/library/system
p69595
aVcomponentmodel
p69596
aVbackgroundworker_events
p69597
aVaspx
p69598
aVPersonally, though, I'd just run a callback method at the end of my worker code (remembering to switch back to the UI thread, via Dispatcher
p69599
aVInvoke in WPF or this
p69600
aVInvoke in winforms)
p69601
as(dp69602
g18
V23354
p69603
stp69604
a((dp69605
g2
(lp69606
VTwo options;
p69607
aVtake away the default (bool defaults to false anyway)
p69608
aVuse ShouldSerialize* to make it clear
p69609
aVin the latter, you might want a bool
p69610
aVto track "explicit set" vs "implicit default":
p69611
aVNote that Reset* and ShouldSerialize* are patterns recognized by the component-model
p69612
as(dp69613
g18
V23354
p69614
stp69615
a((dp69616
g2
(lp69617
VIn that scenario, you might want to consider doing the ongoing task on a worker thread
p69618
aVThe MVC loop must complete in order to return the response to the caller
p69619
aVNote that background threads will not have access to the request context, so you must capture anything you need
p69620
aVNote also that you cannot return anything to the caller once the http context has exited - you will need the caller to call back to get any extra data
p69621
as(dp69622
g18
V23354
p69623
stp69624
a((dp69625
g2
(lp69626
VIt is the first one defined in
p69627
aVproto order
p69628
aVFrom the
p69629
aVproto language guide (since all implementations use the same logic here):
p69630
aVOptional Fields And Default Values
p69631
aV(snip) For enums, the default value is the first value listed in the enum's type definition
p69632
as(dp69633
g18
V23354
p69634
stp69635
a((dp69636
g2
(lp69637
VFor completeness, here's another way of causing this:
p69638
aVThe problem is that the unclosed element makes it not obvious enough that the content is an html block (but we aren't always doing xhtml, right
p69639
aVIn this scenario, you can use:
p69640
aVor
p69641
as(dp69642
g18
V23354
p69643
stp69644
a((dp69645
g2
(lp69646
VYou are using , right
p69647
aVthere-in lies pain
p69648
aVAny contract-based serializer should be fine; , , protobuf-net, , etc
p69649
aVOtherise, you'll have to handle the AppDomain
p69650
aVAssemblyLoad event and/or provide a custom binder; lots of work
p69651
as(dp69652
g18
V23354
p69653
stp69654
a((dp69655
g2
(lp69656
VMost probably you are using x64 windows
p69657
aVIt is not supported on x64
p69658
aVFrankly, don't use this API
p69659
as(dp69660
g18
V23354
p69661
stp69662
a((dp69663
g2
(lp69664
VBoth  and  implement  - the code is correct
p69665
aVActually the compiler probably wouldn't let you do this if it was wrong
p69666
aVIf there isn't a public , then it must be using explicit interface implementation - but that doesn't change your responsibility for calling
p69667
aVFor interest, in C# you can avoid the ever-increasing nesting/indenting, i
p69668
ag50
aVbut fundamentally your current code is correct
p69669
as(dp69670
g18
V23354
p69671
stp69672
a((dp69673
g2
(lp69674
VThe CommandTimeout only impacts commands issued - not the overall transaction
p69675
aVDTC has a timeout (also available via some constructor overloads), but that is mainly intended for distributed deadlock scenarios
p69676
aVIn this scenario, I suspect it is more a case that the controller is keeping tabs on all the systems involved, and reporting failure if any of them fail to respond / keep in touch
p69677
as(dp69678
g18
V23354
p69679
stp69680
a((dp69681
g2
(lp69682
VRegex
p69683
aVno
p69684
aVBut for that query you can just use:
p69685
aVIf you really want SQL , you can use , which LINQ-to-SQL maps to  in SQL Server
p69686
as(dp69687
g18
V23354
p69688
stp69689
a((dp69690
g2
(lp69691
VThis usually simply means a configuration issue;
p69692
aVperhaps there genuinely is no such table
p69693
aVperhaps the table is there, but isn't the the  scheme (it might be in )
p69694
aVperhaps the db is case-sensitive (which is fine), and the table is actually
p69695
aVAny of these will cause the above exception
p69696
aVIn particular, you state:
p69697
aVMy database contains 6 tables and one of them is Category
p69698
aVNow to a machine,
p69699
ag5136
as(dp69700
g18
V23354
p69701
stp69702
a((dp69703
g2
(lp69704
VYou can't use  to make a field act as a pointer; the  is only in effect during the call
p69705
aVTo do what you want, maybe:
p69706
aVupdate the title/description properly (i
p69707
ag50
aVwindow
p69708
aVTitle = "foo" etc)
p69709
aVuse a wrapper class as an intermediary - i
p69710
ag50
aVboth uses keep a reference to a class with a title/description
p69711
aVThe latter is probably going to be the closest to what you want
p69712
ag412
ag50
aVhave a
p69713
aVand
p69714
as(dp69715
g18
V23354
p69716
stp69717
a((dp69718
g2
(lp69719
VThe error message tells you everything you need to know here; either (and preferred) make the column a  initially (and importantly: before you load data), or hack around it
p69720
aVBy which I mean perhaps add a second column (), and push the data accross - inefficient and extra work for no good reason
p69721
as(dp69722
g18
V23354
p69723
stp69724
a((dp69725
g2
(lp69726
VI would not expect session-state to continue working in this scenario; the worker may have no idea who the user is, and even if it does (or more likely: you capture this data into the worker), no reason to store anything (updating session is a step towards the end of the request pipeline; but if you aren't in the pipeline
p69727
aVI suspect you might need to store this data separately using some unique property of the user (their id or cn), or invent a GUID otherwise
p69728
aVOn a single machine it may suffice to store this in a synchronised dictionary (or similar), but on a farm/cluster you may need to push the data down a layer to your database or state server
p69729
aVAnd fetch manually
p69730
as(dp69731
g18
V23354
p69732
stp69733
a((dp69734
g2
(lp69735
VSomething like:
p69736
aVthis will give you one group per team, i
p69737
ag50
aVNote that this changes each item to an , and note that  will do something very similar if that is easier
p69738
as(dp69739
g18
V23354
p69740
stp69741
a((dp69742
g2
(lp69743
VGenerally, they are passed on the stack - but note that this is largely an implementation detail ;p
p69744
aV1: the stack is built up such that the target is on the stack first = specifically:
p69745
aVldloc
p69746
aV0 loads request onto the stack
p69747
aVcallvirt get_Proxy() consumes request (since virtual) and leaves the proxy on the stack (from the return value)
p69748
aVcall get_DefaultCredentials() doesn't consume anything, and appends the default credentials
p69749
aVcallvirt set_Credentials consumes 2 values; the first (the proxy) is used as the instance (since virtual); the second (the credentials) is used as the first parameter value
p69750
aV2: In this case the instance is held in a "local" to the method (i
p69751
ag50
aVa reserved slot relative to the stack-frame); in this case, loc 0
p69752
aVIn a release build, I would actually expect loc 0 to be removed, and this all handled simply without reserved slots; "dup" (to copy the reference as needed) would most-likely be used rather than stloc/ldloc
p69753
as(dp69754
g18
V23354
p69755
stp69756
a((dp69757
g2
(lp69758
VIf you use a delegate's , you are responsible for ensuring that  gets called
p69759
aVI suspect that  (or a custom work-queue / worker-thread(s)) would be a better idea
p69760
aVAnother thing to watch out for is the calling context; you will no longer have access to anything about the request, so any information (for example, the site if doing multi-tenancy) must be captured in advance
p69761
aVCareful thread safety is obviously a concern, but impossible to give specific warnings about without a specific example
p69762
aVFinally; be careful about the DB connection; connections aren't thread-safe, so you might want to ensure you have an isolated connection inside your worker, as you have no way of predicting what any connection in the calling context is doing; it could be disposed, or could be busy doing something
p69763
aVDon't use it
p69764
as(dp69765
g18
V23354
p69766
stp69767
a((dp69768
g2
(lp69769
VIf you can't change the existing object, then your main option is to use a DTO that looks similar to the existing object, but which has properties / behaviours that the serializer you are using (XmlSerializer for asmx, DataContractSerializer by default for svc) can handle
p69770
aVFor example, it would have:
p69771
aVor even:
p69772
aVYou might be able to map between these representations using AutoMapper, or do it by hand
p69773
aVIf you are using WCF, you might also be able to swap the serializer at runtime to support generic interface-based lists like
p69774
as(dp69775
g18
V23354
p69776
stp69777
a((dp69778
g2
(lp69779
VUgly but effective (ideally on your root object):
p69780
as(dp69781
g18
V23354
p69782
stp69783
a((dp69784
g2
(lp69785
VPerhaps feed the xmi xsd into xsd
p69786
aVexe, and use the resultant model with XmlSerializer
p69787
aVjob done
p69788
as(dp69789
g18
V23354
p69790
stp69791
a((dp69792
g2
(lp69793
VReadUncommitted, like the name suggests, impacts readers - i
p69794
ag50
aVshould read operations take read-locks and key-range-locks; should they respect existing locks, etc
p69795
aVI wonder whether IsolationLevel
p69796
aVChaos would offer anything here, but please don't use that
p69797
aVPlease
p69798
aVIf your competing reader needs to see uncommitted data, then change the isolation-level of the reader
p69799
aVAlso, it goes without saying, but long-running transactions (and DTC/LTM transactions in particular) are not recommended
p69800
as(dp69801
g18
V23354
p69802
stp69803
a((dp69804
g2
(lp69805
VWhat serialisation are you using
p69806
aVVarious options
p69807
aVuse a serialiser that handles this for you
p69808
aVuse something before each that tells you the type that follows (could be the full type, could be some marker code, or could be the element name (XML), member-name (JSON), etc)
p69809
aVwrite the number if A before the As, the number of B before the Bs etc
p69810
aVif using something like BinaryFormatter or NetDataContractSerializer (which both include type metadata), deserialize it as normal and use GetType() afterwards to find what you were given
p69811
as(dp69812
g18
V23354
p69813
stp69814
a((dp69815
g2
(lp69816
Vto read a grid of data, you should use ExecuteReader(), i
p69817
ag50
aVWith a SELECT statement like:
p69818
aVYou can't select all those cells into a single output parameter since you have multiple rows; SELECT is the way to go instead
p69819
as(dp69820
g18
V23354
p69821
stp69822
a((dp69823
g2
(lp69824
VIn the case of
p69825
aVNET (C#) you don't need any compiler; build it as an exe, and ship that to any computer with a
p69826
aVNET runtime
p69827
aVFor windows and MS
p69828
aVNET, just run it
p69829
aVFor mono, you'll need to tell mono to run it:
p69830
aVAs it happens, the C# compiler (typically csc) is normally available in the framework, but you shouldn't need it in this case
p69831
as(dp69832
g18
V23354
p69833
stp69834
a((dp69835
g2
(lp69836
VYou can't do a controlled / blocking "wait" on a bool (although you probably don't need to, and Monitor might be more light-weight anyway)
p69837
aVAs a cancel flag bool is fine, but you might want to make the bool volatile to prevent register cache being an issue
p69838
as(dp69839
g18
V23354
p69840
stp69841
a((dp69842
g2
(lp69843
VThe "truncated" warning suggests to me that in production the column is not, in fact,  - but rather something like  (the old maximum before you had to go to )
p69844
aVVerify that the column is in fact
p69845
aVAs a side note, if you are only storing the data,  would be preferred - it will avoid the doubling etc
p69846
aVAnd if you are inspecing the data,  might be preferred
p69847
as(dp69848
g18
V23354
p69849
stp69850
a((dp69851
g2
(lp69852
VOne option here might be to associate a TypeConverter with the types you care about (you can do this at compile-time via , or there is a trick for doing this at runtime if you don't control the types)
p69853
aVThen it is:
p69854
as(dp69855
g18
V23354
p69856
stp69857
a((dp69858
g2
(lp69859
VTo the best of my knowledge,  is essentially issuing a  query over the table, and then (following the "If execution of this command returns rows" notes from MSDN), these existing rows are being merged
p69860
aVIt isn't doing an insert/update
p69861
aVMaybe consider a command builder MSDN
p69862
aV(caveat: I never, ever, ever use DataAdapter - this is based purely on my interpretation of MSDN; it could easily be wrong)
p69863
as(dp69864
g18
V23354
p69865
stp69866
a((dp69867
g2
(lp69868
VI would go a different route here
p69869
aVThread safe, no locks
p69870
aVOr if you are worried about wrapping around Int32:
p69871
as(dp69872
g18
V23354
p69873
stp69874
a((dp69875
g2
(lp69876
VThe focus seems to be on the first n items; in which case, protobuf-net is ideal
p69877
aVAllow me to demonstrate:
p69878
aVIn particular, because  is a streaming API, it is easy to pull a capped quantity of data by using LINQ's  (or just  with )
p69879
aVNote, though, that the existing public dll won't love you for using ; v2 does better there, but personally I would make that a
p69880
as(dp69881
g18
V23354
p69882
stp69883
a((dp69884
g2
(lp69885
VTry:
p69886
aVPersonally, though, I'd see if you can't sort on the integer directly, rather than the string representation
p69887
as(dp69888
g18
V23354
p69889
stp69890
a((dp69891
g2
(lp69892
s(dp69893
g18
V23354
p69894
stp69895
a((dp69896
g2
(lp69897
VThe error message strongly suggests that approach simply isn't going to work
p69898
aVYou may have to use either static binding (perhaps to an interface that declares ), or manual reflection
p69899
as(dp69900
g18
V23354
p69901
stp69902
a((dp69903
g2
(lp69904
Vor simpler:
p69905
as(dp69906
g18
V23354
p69907
stp69908
a((dp69909
g2
(lp69910
VI would start by breaking the query into aliases - see if that helps things; and unless you are intentionally doing cross-db work (usually a bad idea), drop the db identifier and just use the current db:
p69911
as(dp69912
g18
V23354
p69913
stp69914
a((dp69915
g2
(lp69916
VA list might be easier than an array, but: you are assigning items to a null array; once you know the number you need, create the array first:
p69917
aVHowever, personally I'd use a list:
p69918
as(dp69919
g18
V23354
p69920
stp69921
a((dp69922
g2
(lp69923
s(dp69924
g18
V23354
p69925
stp69926
a((dp69927
g2
(lp69928
VIn the case of properties, there is an interesting syntax:
p69929
aVThis 1-liner can use a dup stloc rather than storing and loading the field separately
p69930
aVFor example:
p69931
aVA micro-optimisation, maybe - but quite cute
p69932
as(dp69933
g18
V23354
p69934
stp69935
a((dp69936
g2
(lp69937
VYes; a static nested class has the same behaviour as any other static class
p69938
aVThe only time nested classes behave differently is when the outer class is generic type (the nested type is then implicitly generic via the parent, so  would be independent of )
p69939
aVAnd just be careful: static for sharing data between sessions is fraught with danger
p69940
aVSynchronize like a paranoid thing
p69941
aVPersonally I would need a very good reason to do this
p69942
aVand it needs careful implementation
p69943
aVI only use that approach for things like configuration caching, and even then I'm insanely careful about it
p69944
as(dp69945
g18
V23354
p69946
stp69947
a((dp69948
g2
(lp69949
VIf you only have a few types to transfer and they aren't likely to change much - just define it at both ends
p69950
aVIf you have lots, then share a dll
p69951
aVNo magic really
p69952
aVjson is by design quite contract free
p69953
aVIn fact, even anonymous types serialize very nicely in most cases
p69954
aVPersonally I'd use a  not a , though
p69955
aVas always, prefer  unless you have a really good idea why you are using  : most times, they are used incorrectly
p69956
as(dp69957
g18
V23354
p69958
stp69959
a((dp69960
g2
(lp69961
Vif  is a , you should find that:
p69962
aVworks fine; but there are limits to what it can understand (and more importantly, write as TSQL)
p69963
as(dp69964
g18
V23354
p69965
stp69966
a((dp69967
g2
(lp69968
VI'm not sure that a memory gate would change this scenario, as that would surely only affect subsequent reads
p69969
aVand then the question becomes reads from where
p69970
aVIf it is from a field (which must at a minimum be static or an instance fields for some instance still on the stack or otherwise reachable), or local variable - then by definition it isn't available for collection
p69971
aVRe the scenario where that reference is only now in the registers
p69972
aVthat is far trickier
p69973
aVIntuitively I want to say "no that isn't a problem", but it would take a detailed look at the memory model to prove it
p69974
aVBut handling references is such a common scenario that simply: this has to work
p69975
as(dp69976
g18
V23354
p69977
stp69978
a((dp69979
g2
(lp69980
VIn your example, you don't actually add anything to
p69981
aVa simple enough mistake, but there is a more significant issue:
p69982
aVIt needs to be  not an ; also, you might want to ensure the hashcode can't change; most simply by making  read-only:
p69983
as(dp69984
g18
V23354
p69985
stp69986
a((dp69987
g2
(lp69988
VPretty much by changing to:
p69989
aVwith the notable exception that you will need an  option to handle  methods
p69990
aVYou will have to supply dummy parameter values, of course - if you really want you can obtain those too
p69991
aVActually, your existing code might not be robust; you may need to throw away a cast operation (to box the int to an object)
p69992
as(dp69993
g18
V23354
p69994
stp69995
a((dp69996
g2
(lp69997
VReplace  with either:
p69998
aVor
p69999
aV(since  is for arbitrary data, so typed as  - but that method expects a )
p70000
as(dp70001
g18
V23354
p70002
stp70003
a((dp70004
g2
(lp70005
VThat is an extension method (via the  modifier on the first parameter)
p70006
aVThe  is passed in as the first argument instead
p70007
aVSo:
p70008
aVis identical to:
p70009
aVBut note that genuine instance methods always take precedence during static analysis, so if the object had a suitable  method itself, it would be chosen instead of the extension method
p70010
aVExtension methods must be static methods on non-nested static classes
p70011
as(dp70012
g18
V23354
p70013
stp70014
a((dp70015
g2
(lp70016
VThis is the expected functionality; merging a singular property does indeed overwrite the properties with the values from the merging stream; however, for repeated properties (lists, arrays, etc) the behavior (as per the wider "protobuf" family of implementations) is to append the additional object(s) from the merging stream to the list
p70017
aVYou will find that:
p70018
aVAnd specifically, it does not do an item-by-item merge by position
p70019
as(dp70020
g18
V23354
p70021
stp70022
a((dp70023
g2
(lp70024
VOne possible way would be to build the model at runtime use XmlAttributeOverrides (and caching the final XmlSerializer, which is essential when using approach)
p70025
aVThe minor problem here being that you need to tell it member-names as strings, but there are ways of doing that with the Expression API such that use can use something like
p70026
aVSince expression trees operate with the MemberInfo directly, this should return the obfuscated name, not "Bar"
p70027
as(dp70028
g18
V23354
p70029
stp70030
a((dp70031
g2
(lp70032
VIt sounds simply like the target computer doesn't have the necessary fonts
p70033
aVPerhaps they have a different version or locale of windows (with a different "Sans Serif" font), or maybe you are actually using a different font that the target PC lacks
p70034
as(dp70035
g18
V23354
p70036
stp70037
a((dp70038
g2
(lp70039
VYou need to use the same format in this scenario
p70040
aVSince BinaryFormatter isn't OK for Silverlight, that is out
p70041
aVPersonally I'd use protobuf-net, which works on both and can be configured to work on vanilla objects (but is easier if you can add attributes), but if your linked serialiser works on desktop that is a viable option too
p70042
aVWith an example of your model I can be more specific
p70043
as(dp70044
g18
V23354
p70045
stp70046
a((dp70047
g2
(lp70048
VThe advantage here is that it will be created with the right size, without any intermediate steps - plus it works without LINQ
p70049
aVIn C# 2
p70050
aV0 it is a bit uglier - the following is identical:
p70051
aVThe combination of , lambdas, and improved generic type inference really shine for C# 3
p70052
aV0 here
p70053
as(dp70054
g18
V23354
p70055
stp70056
a((dp70057
g2
(lp70058
VWell, you do
p70059
aVeach property has two ColumnArtribute instances defined
p70060
aVThe fact that they are on different lines and in different sets of square brackets is irrelevant
p70061
aVIt looks like in both cases the one on the first line is redundant
p70062
as(dp70063
g18
V23354
p70064
stp70065
a((dp70066
g2
(lp70067
VOne option would be:
p70068
aVThe other option is to pass the query into the paging function
p70069
as(dp70070
g18
V23354
p70071
stp70072
a((dp70073
g2
(lp70074
VThe simplest approach here is , for example:
p70075
aVThis works fine for LINQ-to-Objects and LINQ-to-SQL, but isn't supported by EF
p70076
aVFor EF you'll need to use a visitor to rewrite the tree, sadly
p70077
aVUsing the code from: combining two lamba expressions in c#
p70078
aVOr in
p70079
aVNET 4
p70080
aV0, using :
p70081
as(dp70082
g18
V23354
p70083
stp70084
a((dp70085
g2
(lp70086
VThere isn't a simple way to do this at the moment
p70087
aVThe changes required would primarily be to the csharp
p70088
aVxslt file
p70089
aVThere is a bug reported about this but hasn't been fixed yet
p70090
as(dp70091
g18
V23354
p70092
stp70093
a((dp70094
g2
(lp70095
Vxslt is case sensitive; for each row you'll need
p70096
aVand you'll need to use Muenchian grouping to get one  per like-named elements:
p70097
as(dp70098
g18
V23354
p70099
stp70100
a((dp70101
g2
(lp70102
VConvert
p70103
aVToInt32 works against  and accepts a range of data-types, of which `string is just one
p70104
aVint
p70105
aVParse is optimised for the very common string case, and raises an exception on failure
p70106
aVUseful when we expect an integer
p70107
aVint
p70108
aVTryParse is like int
p70109
aVParse, but no exception (false instead); useful for testing for an integer
p70110
as(dp70111
g18
V23354
p70112
stp70113
a((dp70114
g2
(lp70115
s(dp70116
g18
V23354
p70117
stp70118
a((dp70119
g2
(lp70120
VPersonally I always use captured variables, I
p70121
ag50
aVThis means it is always checked for correctness during build, unlike passing an object parameter
p70122
as(dp70123
g18
V23354
p70124
stp70125
a((dp70126
g2
(lp70127
V doesn't support list notifications, so it has no way of telling the UI to update or do anything useful
p70128
aVChanging to  instead of  should solve this
p70129
as(dp70130
g18
V23354
p70131
stp70132
a((dp70133
g2
(lp70134
VIf the regex isn't going to change (and it usually isn't), then:
p70135
aVis the fastest and most efficient in every way
p70136
as(dp70137
g18
V23354
p70138
stp70139
a((dp70140
g2
(lp70141
VMarking it as  (or ) is necessary for anything using , which may well include viewstate under the default configuration
p70142
aVAs for good vs bad practice
p70143
aVwell, most classes don't need to be serialized, and IMO even when they are, using  is not always the best choice*
p70144
aVAnd specifically, marking it as both  and  will cause an exception IIRC
p70145
aV*=actually, IMO  is very rarely a good choice, but I might be biased
p70146
aVand I deliberately don't use viewstate ;p
p70147
as(dp70148
g18
V23354
p70149
stp70150
a((dp70151
g2
(lp70152
VYes, the
p70153
aVNET runtime is per-process
p70154
aVRe JIT; it is per-method, so it doesn't all need to be JITted; and it is very fast
p70155
aVYou can use NGEN (or AOT on mono) to avoid this slight delay
p70156
aVBut JIT delay is rarely a huge problem
p70157
as(dp70158
g18
V23354
p70159
stp70160
a((dp70161
g2
(lp70162
VOn how many projects do you expect the same constants to be useful
p70163
aVIf there is genuinely a case for it, then fine; otherwise
p70164
aVdon't
p70165
aVOf course, if you have some equally likely to be reused utility library, then they might make sense in there, as long as appropriately scoped by namespace and type
p70166
aVPersonally, until I had an actual, concrete purpose in moving them, I'd leave them alone
p70167
as(dp70168
g18
V23354
p70169
stp70170
a((dp70171
g2
(lp70172
VUsing direct reflection (as in the example) will be sloooow; giving a more complete answer is tricky, as it depends on whether you want a shallow clone or deep clone of sub-objects
p70173
aVEither way, you should expect this to involve some meta-programming and caching - using either ILGenerator or Expression
p70174
aVHowever, for a lazy option, serialization might be useful
p70175
aVA number of serializers allow you to use attributes to include/exclude particular items; by serializing to a memory-stream, rewinding () and deserializing you should get a deep copy of just your chosen members
p70176
aVHere's an example using :
p70177
as(dp70178
g18
V23354
p70179
stp70180
a((dp70181
g2
(lp70182
VYou are only locking while you create the thread, or (in the second case), access the value
p70183
aVLocks must be used by all threads, otherwise they do nothing
p70184
aVIt is the act of trying to acquire the lock that blocks
p70185
aVEven if you did lock in both threads, that wouldn't help you marry each thread to the value of  (etc) at a particular point in time (that no longer exists)
p70186
aVEqually, threads work at their own pace; you cannot guarantee order unless you have a single worker and queue; or you implement your own re-ordering
p70187
aVit will run at its own pace, and since you are capturing the variable , it is entirely likely that the field  has changed by the time the thread gets as far as
p70188
aVInstead, you should capture the value, by making a copy:
p70189
aV(or probably remove  completely)
p70190
as(dp70191
g18
V23354
p70192
stp70193
a((dp70194
g2
(lp70195
Vhttp://msdn
p70196
aVmicrosoft
p70197
aVcom/en-us/library/ch9714z3
p70198
aVaspx
p70199
aVThe GetFields method does not return fields in a particular order, such as alphabetical or declaration order
p70200
aVYour code must not depend on the order in which fields are returned, because that order varies
p70201
aVhttp://msdn
p70202
aVmicrosoft
p70203
aVcom/en-us/library/kyaxdd3x
p70204
aVaspx
p70205
aVThe GetProperties method does not return properties in a particular order, such as alphabetical or declaration order
p70206
aVYour code must not depend on the order in which properties are returned, because that order varies
p70207
aVYou would need to define order yourself, perhaps with attributes:
p70208
as(dp70209
g18
V23354
p70210
stp70211
a((dp70212
g2
(lp70213
VIf you append strings in a loop () you are causing lots of intermediate strings to be created; this causes "telescopic" memory usage, and puts extra load on GC
p70214
aVAggregate, mixed with the fluent-API of StringBuilder can help here - but as would looping with StringBuilder
p70215
aVIt isn't Aggregate that is important: it is not creating lots of intermediate strings
p70216
aVFor example, I would use:
p70217
aVeven fewer ;p
p70218
aVAnd for a similar example using StringBuilder in Aggregate:
p70219
as(dp70220
g18
V23354
p70221
stp70222
a((dp70223
g2
(lp70224
VWell, you can always edit the DBML by hand if you like
p70225
aVOtherwise, no; the tooling is "as is"
p70226
aVSince most development effort by MS is on EF, we shouldn't expect it to improve much /soon / possibly-ever
p70227
as(dp70228
g18
V23354
p70229
stp70230
a((dp70231
g2
(lp70232
VYou have two things going on there
p70233
aVtelling the length of an array is pretty simple once you have an array; you just call  (in the case of a vector)
p70234
aVHowever, you mention an instance, and you are showing an instance property; which makes me think it is the containing object you lack
p70235
aVIn which case
p70236
aVno
p70237
aVYou can't make a virtcall on a null instance
p70238
aVAnd trying to use static-call on an instance member of a class is very evil; IIRC the runtime will kick you for this
p70239
aVYou could, however, make it a static property just by adding the  modifier
p70240
aVThen you just pass in  as the instance to reflection
p70241
as(dp70242
g18
V23354
p70243
stp70244
a((dp70245
g2
(lp70246
VIf they differ by one bit, xor should give you just that bit
p70247
aVSo then you could shift to find which
p70248
aVPerhaps needs some optimisation:
p70249
as(dp70250
g18
V23354
p70251
stp70252
a((dp70253
g2
(lp70254
VThe "latest" is  and  - however, I don't think the query is right;  returns the day of the month, not the date-only part of a datetime:
p70255
aVNote I've chosen to preserve your "today" semantics; this could matter if you have future data
p70256
as(dp70257
g18
V23354
p70258
stp70259
a((dp70260
g2
(lp70261
VIf the content isn't obviously either language or content, you need to help it decide:
p70262
aVor:
p70263
aVor
p70264
as(dp70265
g18
V23354
p70266
stp70267
a((dp70268
g2
(lp70269
VIf you need it back where you called BeginRead, you are missing a trick; you might as well just call Read
p70270
aVThe whole point of async is that you typically process the data in a disconnected way
p70271
aVHowever, you can also call EndRead in the originating method if all you want to do is so something else while it is reading
p70272
aVJust don't specify a callback
p70273
as(dp70274
g18
V23354
p70275
stp70276
a((dp70277
g2
(lp70278
VThree options:
p70279
aVexecute the query twice (readers like this are forwards only)
p70280
aVbuffer the data locally, then process it twice (the "buffer" could be an object collection, XML, a DataTable (spit), etc)
p70281
aVwrite both outputs at the same time; i
p70282
ag50
aVfor each row, write the first format to the first output, then the second format to the second output
p70283
aVI'd probably aim at the last option, as it involves no buffering or repetition; however I would move the logic for each method into 2 distinct methods
p70284
as(dp70285
g18
V23354
p70286
stp70287
a((dp70288
g2
(lp70289
VControls have thread-affinity; you can only safely talk to them from their creating thread
p70290
aVYou are checking InvokeRequired; however, you are mixing up Delegate
p70291
aVInvoke (runs on the current thread) with Control
p70292
aVInvoke (runs on the UI thread); very different meaning
p70293
aVIt should be:
p70294
as(dp70295
g18
V23354
p70296
stp70297
a((dp70298
g2
(lp70299
VI would look at scripting languages; IronPython is easy to embed, or there are JavaScript engines for
p70300
aVNET
p70301
aVSimple, and usually fast enough
p70302
aVIf (comments) you need to use c#, I would:
p70303
aVbuild all the current methods at the same time into one assembly; solves a lot of problems
p70304
aVif the data changes during execution, make use of AppDomains so that I can unload them
p70305
aVI've done something similar where the model/rules were XML, running it through a transform to get c#, and compiling with CSharpCodeProvider (or whatever); and simply polling every minute or so to see if a new build is required
p70306
as(dp70307
g18
V23354
p70308
stp70309
a((dp70310
g2
(lp70311
VThis should just be a case of firing up a  with the right  (and  set to true), and handling  (but watch out; the callback is not on any particular thread)
p70312
aVMSDN has an example: http://msdn
p70313
aVmicrosoft
p70314
aVcom/en-us/library/system
p70315
aVtimers
p70316
aVtimer
p70317
aVelapsed
p70318
aVaspx
p70319
aValso from MSDN:
p70320
aVThe Timer component is a server-based timer, which allows you to specify a recurring interval at which the Elapsed event is raised in your application
p70321
aVYou can then handle this event to provide regular processing
p70322
aVFor example, suppose you have a critical server that must be kept running 24 hours a day, 7 days a week
p70323
aVYou could create a service that uses a Timer to periodically check the server and ensure that the system is up and running
p70324
aVIf the system is not responding, the service could attempt to restart the server or notify an administrator
p70325
aVThe server-based Timer is designed for use with worker threads in a multithreaded environment
p70326
aVServer timers can move among threads to handle the raised Elapsed event, resulting in more accuracy than Windows timers in raising the event on time
p70327
as(dp70328
g18
V23354
p70329
stp70330
a((dp70331
g2
(lp70332
VBeyond not returning a value, very little definition is given of  (although  gets some attention) in the language spec
p70333
aVThis isn't really a language concern - although the CLI may define it further
p70334
aVUltimately though: because it has no meaning to do
p70335
as(dp70336
g18
V23354
p70337
stp70338
a((dp70339
g2
(lp70340
V2 / 3; there are a few attributes that the compiler interprets as IL metadata, not really attributes; it looks like this is the case here;  is another example
p70341
aVThe data for the default is there:  - not all attributes in code become attributes in the metadata (again, I'm looking at  here)
p70342
aVre that point on  (comments); here's an example:
p70343
aVfor which the core IL is:
p70344
aVIn  (for some arbitrary attribute), we get:
p70345
aVHowever this does not apply for ; instead, that is part of the type:
p70346
as(dp70347
g18
V23354
p70348
stp70349
a((dp70350
g2
(lp70351
VThere are various scripting languages you can use inside your
p70352
aVNET application; IronPython being one obvious example, but others are available - javascript for example (talking to your
p70353
aVNET objects; not in a browser)
p70354
aVOne of these might have some application here
p70355
as(dp70356
g18
V23354
p70357
stp70358
a((dp70359
g2
(lp70360
VIf you want ascii,  i
p70361
ag50
aV"00" as characters, then just:
p70362
aVor you could optimise it if you want
p70363
aVBut IMO, if you are storing 0-99, 1 byte is plenty:
p70364
aVIf you want the range 0-65535, then just:
p70365
aVor swap index 0 and 1 for endianness
p70366
aVBut if you are using the full range (of either single or double byte), then it isn't ascii nor a string
p70367
aVAnything that tries to read it as a string might fail
p70368
as(dp70369
g18
V23354
p70370
stp70371
a((dp70372
g2
(lp70373
VIf you mean in TSQL, then you need a temporary table () or table variable ()
p70374
aVThen at each step:
p70375
aVThen do a final
p70376
aVThe choice between table-variable and temporary-table is subtle
p70377
aVI prefer table-variables; but for large data, or if you need an identity/index, a temporary-table may be more versatile
p70378
aVBut if you aren't inside a SPROC you must ensure you clean up your temp table
p70379
as(dp70380
g18
V23354
p70381
stp70382
a((dp70383
g2
(lp70384
VJIT is only done per-method; it doesn't JIT everything
p70385
aVOnly the bits you need
p70386
aVOf course this has a small but measurable hit the first time into a method (plus generics etc)
p70387
aVNGEN does this work up-front, but must be done on the same platform/architecture etc - essentially that machine
p70388
aVThis also means adding it to the GAC etc, which may need higher access
p70389
aVIn many cases, JIT is fine, especially if the app is open for a long time (web servers, for example)
p70390
as(dp70391
g18
V23354
p70392
stp70393
a((dp70394
g2
(lp70395
V looks suspicious when you are only selecting 2 columns:
p70396
aVSince it is 0-based, that should probably be
p70397
as(dp70398
g18
V23354
p70399
stp70400
a((dp70401
g2
(lp70402
VPersonally, I would leave this to a message-bus/service-bus, or anything else with pub/sub
p70403
aVMy preference would be redis: http://redis
p70404
aVio/commands#pubsub
p70405
aVRe the object, I would use protobuf-net, simply because I know it will produce tiny binary for the above message
p70406
aVSending (PUBLISH) a BLOB to a named redis channel will cause it to be distributed to all listeners on that channel
p70407
as(dp70408
g18
V23354
p70409
stp70410
a((dp70411
g2
(lp70412
VI'm that case I would use regular dispose, and handle the file deletion (or not) in a  block
p70413
aVI don't know of a way to reset that
p70414
as(dp70415
g18
V23354
p70416
stp70417
a((dp70418
g2
(lp70419
VSince delegates are multicast, just pass an :
p70420
aVand combine at the caller
p70421
aVIf you need to run them independently (for example, to run later actions even if earlier actions fail), de-construct it:
p70422
aVNote, however, that this doesn't magically provide access to the member variables from the delegate, unless the delegate's context already had access to the fields (and a reference to the new instance, perhaps via  instead of )
p70423
as(dp70424
g18
V23354
p70425
stp70426
a((dp70427
g2
(lp70428
VIt is serializable, but simply not via *- i
p70429
ag50
aVit isn't  or
p70430
aVLINQ data-contexts are designed to be serialized with , however - for binary, either  or protobuf-net should also work fine
p70431
aVIf this is profile serialization
p70432
aVI honestly don't know if you can write your own plugin serialization layer - I've never had need to look; but in this case I would write a simple, non-LINQ object (a DTO) for the object properties that I actually need in my profile, and just populate that object from LINQ, and serialize that
p70433
aV*=for what it is worth, I don't consider this a bad thing;  has so many ways of causing pain that actively not supporting it is actually a positive thing, by virtue of finally weaning people of this approach
p70434
as(dp70435
g18
V23354
p70436
stp70437
a((dp70438
g2
(lp70439
VIt looks to me like you have 2 lists ( and ), and are getting them confused:
p70440
as(dp70441
g18
V23354
p70442
stp70443
a((dp70444
g2
(lp70445
VIf you are querying via http, then : no, there is no robust way of doing this, and the answer is moot because increasingly the http address doesn't map 1:1 to files anyway
p70446
aVJust look at the address above for example (this page, I mean)
p70447
aVYou could act like a robot might; look for things like a site-map, else/or spider the pages
p70448
aVBut note that aggressive spidering will usually get you blocked pretty quickly
p70449
aVIf you have access to the server's file system, just count the files
p70450
as(dp70451
g18
V23354
p70452
stp70453
a((dp70454
g2
(lp70455
VIt I hard to give a complete answer without the full details of the errors that occur when you try to update; however, I would be sorely tempted to edit the EDMX as XML, use "find" to locate , and fix directly
p70456
aVIf nothing else, it is quick to try :)
p70457
as(dp70458
g18
V23354
p70459
stp70460
a((dp70461
g2
(lp70462
VLambda expressions won't work, but for delegates you should be fine using a statement body:
p70463
aVFor delegates
p70464
aVYou will need to define your own:
p70465
as(dp70466
g18
V23354
p70467
stp70468
a((dp70469
g2
(lp70470
VIt will certainly avoid the "list" issue
p70471
aVIn regular
p70472
aVproto the size will be the same as long as the field numbers are small - the only difference on the wire will be different field numbers instead of the same number 4 times
p70473
aVHowever, if your list is currently using the "packed" option it will be marginally larger as 4 fields
p70474
aVPersonally, since the size is capped at 4, I think the 4 field approach represents your scenario more closely, as otherwise there is nothing to stop you adding 20 values
p70475
aVI'm all for the 4 field approach here
p70476
as(dp70477
g18
V23354
p70478
stp70479
a((dp70480
g2
(lp70481
VIt is now an open source project, here; http://code
p70482
aVgoogle
p70483
aVcom/p/wmd-new/, reverse-engineered from the original WMD, as explained in the SO blog: http://blog
p70484
aVstackoverflow
p70485
aVcom/2009/01/wmd-editor-reverse-engineered/
p70486
as(dp70487
g18
V23354
p70488
stp70489
a((dp70490
g2
(lp70491
VLooking at your MyObject, I believe all you are seeing here is the concrete type that is underpinning an
p70492
aVThis is because you aren't limiting to a single object
p70493
aVIf you expect one row, tell it:
p70494
aVOtherwise, just access  as an , and you should find that each row is actually a ; i
p70495
ag50
aVbut note that this is different to it being an ; for that, you would use
p70496
as(dp70497
g18
V23354
p70498
stp70499
a((dp70500
g2
(lp70501
VLet's consider the line:
p70502
aVthis:
p70503
aVreads the value of , and since it is post increment the "value" here is the old value
p70504
aVincrements
p70505
aVassigns the old value to , undoing all your work
p70506
aVYou just want:
p70507
as(dp70508
g18
V23354
p70509
stp70510
a((dp70511
g2
(lp70512
VThis might be a wild guess, but perhaps: is your application-root a few levels down
p70513
ag412
ag50
aVinstead of
p70514
aVIf so, you need to ensure that IIS knows to consider  /  the app-root, by clicking "create application" in IIS (it'll get a bog icon)
p70515
aVEssentially,  is relative to the app-root, which is by default the site-root
p70516
aVSo even though your code is at , it is looking for the dll in
p70517
aVBy correctly marking the application root, it will look for
p70518
as(dp70519
g18
V23354
p70520
stp70521
a((dp70522
g2
(lp70523
VI would store them outside, simply because there isn't an immediate and pressing need to store them inside
p70524
aVAlso, videos are big, and you might need to run them through some other encoding etc steps, which may or may not like SQL Server
p70525
aVUsing basic files also gives you the opportunity to spread that load around any number of file servers, rather than a single SQL Server
p70526
aVRe the path; don't store the full path - only store some path relative to an external root that you configure in your app
p70527
aVThat way, you can relocate all the files and just change a single site setting, rather than having to do a big
p70528
aVFor example, in the DB I might store , and then later combine that with my site-setting of  (using )
p70529
as(dp70530
g18
V23354
p70531
stp70532
a((dp70533
g2
(lp70534
VThe iterator block () handles this for you; an iterator block is a streaming API; work only happens during each  call on the iterator (or on )
p70535
aVBecause  also doesn't read the entire stream, this behaviour is preserved
p70536
aVNote, however, that some operations need to buffer the data locally -  and  most notably; but as long as you use non-buffering operations, you are fine
p70537
aVFor example:
p70538
as(dp70539
g18
V23354
p70540
stp70541
a((dp70542
g2
(lp70543
Vit is a bad idea; anon types are a poor choice outside of a single location
p70544
aVThere is something called "cast by example", but it is not good practice
p70545
aVThe right approach is simply "write a simple class to represent that state"
p70546
aVWith auto-props that is trivial
p70547
aVDynamic is another viable option (that can talk to anon-types), but again: what are you tryig to save here
p70548
aVWrite the POCO/DTO already
p70549
aVIt doesn't even need to be Serializable in many cases (unless ou have an out-of-process state server; in which case it is more important to have a known DTO)
p70550
as(dp70551
g18
V23354
p70552
stp70553
a((dp70554
g2
(lp70555
Vis the easiest; this is actually an array, but a list is easy enough too  - perhaps  if you feel lazy
p70556
aVPersonally, in this scenario I'd use an anon-type:
p70557
aVVery similar, except the member-names are more meaningful
p70558
as(dp70559
g18
V23354
p70560
stp70561
a((dp70562
g2
(lp70563
VI have a simple approach here
p70564
aVif you find yourself having to hammer the LINQ query to get it to play nicely, then: don't play that game
p70565
aVSince you have  at your disposal, I would just write the TSQL directly, in a way that I can measure, predict and optimise - and use LINQ-to-SQL (or dapper
p70566
aVnet) to lift the result into a basic object
p70567
as(dp70568
g18
V23354
p70569
stp70570
a((dp70571
g2
(lp70572
VIt all depends on how much effort you go to; for example, you could enable database failover, which tends to be expensive (second server, license, etc) but has a very quick recovery onto the pair
p70573
aVYou could code your app to do something either in-memory (which gets tricky if your app recycles), or to an independent store
p70574
aVThe most common choice here is pragmatic: we need a DB (whether that is sql, nosql, or whatever; some central data repository); if the DB server goes offline, so does the app
p70575
aVYou should be looking to have very good uptime on your DB tier; your time would be better spent trying to see how to improve that uptime
p70576
aVAnother choice for read only applications would be to keep a copy of the DB on each app-tier server, and update incrementally
p70577
aVWhen the app server is up, so (generally) is the local DB
p70578
as(dp70579
g18
V23354
p70580
stp70581
a((dp70582
g2
(lp70583
VReplacing spaces with  is not really encoding, since there is no standard decoder for that; the  is correct
p70584
aVHowever, if this is for display only, and as long as your code doesn't rely on this value (for example, to do an exact slug match expecting the space) you could simply do a  before you encode
p70585
aVIn that lossy scenario you might also want to replace a few others, truncate overly long strings, etc
p70586
aVEncoding it once it has a  should be a no-op (i
p70587
ag50
aVit won't change)
p70588
as(dp70589
g18
V23354
p70590
stp70591
a((dp70592
g2
(lp70593
VSince 3rd party libraries are out, a few choices (there are probably others):
p70594
aVwrite a quote-aware CSV reader yourself
p70595
aVuse ODBC - see the last page here
p70596
as(dp70597
g18
V23354
p70598
stp70599
a((dp70600
g2
(lp70601
VOptions:
p70602
aVFor a sensible number of locations, you could obtain (purchase, calculate, etc) a travel matrix between all locations - gets large as you increase the count, though
p70603
aVIf you have the lat/long for each, you can do great-arc quite easily; but tends to get messy near lakes, oceans, etc
p70604
aVYou could use an offline like MapPoint desktop, perhaps by storing a queue of unknown routes and processing those outside the db
p70605
as(dp70606
g18
V23354
p70607
stp70608
a((dp70609
g2
(lp70610
Vwell
p70611
aVyes
p70612
aVthe form is closing; why wouldn't it fire the event
p70613
aVIf the  isn't helping, then just throw a  field onto the form that you set to true when you click logout; and check that field in the closing event
p70614
as(dp70615
g18
V23354
p70616
stp70617
a((dp70618
g2
(lp70619
VThe  syntax  only allows for parameterless constructors
p70620
aVThere are some hacks to do this, else  should work
p70621
aVBut a preferred approach would be an accessible  method, perhaps via an interface (also specified via )
p70622
aVSo you can use:
p70623
as(dp70624
g18
V23354
p70625
stp70626
a((dp70627
g2
(lp70628
VAn  is essentially a wrapper around an , with functionality to track space in the array and grow it (double it) as necessary
p70629
aVNote that usually  is preferred, but to answer the question: yes, it just stores the references to the s, which may well be boxed value-types
p70630
aVA  is pretty much the same, but around a , which means value types can be stored without boxing
p70631
aVReference-types are still stored as references
p70632
aVYou also get more type safety; i
p70633
ag50
aVyou can't add the wrong thing nor cast a retrieved item improperly
p70634
as(dp70635
g18
V23354
p70636
stp70637
a((dp70638
g2
(lp70639
VHow many threads the pool uses is largely up to it, and may vary based on what else is going on, the number of unstarted items, etc; you are only setting the max
p70640
aVYou aren't the only user of the pool;
p70641
aVnet uses that itself, so don't mess with it
p70642
aVIf you explicitly want 20 threads, create 20 s
p70643
as(dp70644
g18
V23354
p70645
stp70646
a((dp70647
g2
(lp70648
VDelegate fields are not events - they are just delegate fields
p70649
aVThey can be (very incorrectly) inspected, nulled and invoked by external callers, whin is contrary to the design of events (which can only be handles by the declaring class, typically)
p70650
aVThe encapsulation allows indirection, validation, etc; all desirable
p70651
aVAnd the cost is minimal
p70652
aVIt would not be normal for this to impact your code's performance
p70653
aVIt also allows them to be used on interfaces; fields cannot be declared on interfaces
p70654
aVEdit:
p70655
aVThe question is a little unclear, but if the question is simply field-like events vs explicit add/remove with a delegate backer
p70656
aVThen that is stupid
p70657
aVDon't add unnecessary code
p70658
aVField like events would be preferred, unless there are enough events to warrant an EventHandlerList implementation
p70659
aVIn particular, the 4
p70660
aV0 compiler does the thread-safety very sensibly now (this was not the case historically)
p70661
as(dp70662
g18
V23354
p70663
stp70664
a((dp70665
g2
(lp70666
VFrom comments:
p70667
aVit's much more efficient memory wise
p70668
aVNo, it isn't
p70669
aVIt is about the same, with  marginally less efficient, as the data is passed in an array (usually GEN0), and it is necessary to parse the format string (which is actually very fast, to be fair)
p70670
aVIt is defined in the spec that a composite string  sequence, i
p70671
ag50
aVIs compiled as:
p70672
aVInternally, this is very efficient, and doesn't do the classic "telescoping strings" problem
p70673
aVAdditionally, there are overloads of  taking various numbers of operands, to avoid even the params-array overhead
p70674
aVAnd additional overloads for when all operands are strings (which it can so even easier)
p70675
aVIn short, this is costing you nothing
p70676
aVUnless you are doing this so you can supply the formats externally (quite common in an i18n scenario), I would leave it alone
p70677
aVAll you are doing is risking bugs; you aren't making it more efficient
p70678
as(dp70679
g18
V23354
p70680
stp70681
a((dp70682
g2
(lp70683
VIn short, no
p70684
aVWith  you can either implement  (which is non-trivial), or write a basic DTO (that is fully read-write) and then translate from the DTO model to your main model
p70685
aVNote that in some cases  is a viable option, but it doesn't offer the same control over the XML
p70686
aVHowever, with DCS you can do:
p70687
as(dp70688
g18
V23354
p70689
stp70690
a((dp70691
g2
(lp70692
VDifferent LINQ providers support different tricks; as it happens LINQ-to-SQL works with invoke
p70693
aVEF: not so much
p70694
aVIf you are building the expression by hand, you may need to either form the expression without invoke, or to use a re-writer to flatten it
p70695
aVThere's a rewriter example here that illustrates how to do this: combining two lamba expressions in c#
p70696
as(dp70697
g18
V23354
p70698
stp70699
a((dp70700
g2
(lp70701
VNot entirely sure how protobuf fits in, since you don't want an object serializer, but:
p70702
aVwraps a stream, and has tools for what you want; the format isn't anything to do with protobuf, but should work
p70703
aVNote that for name/value pairs you would just write the name then the value
p70704
aVit you really want protobuf in here somewhere, protobuf-net v2 has  which is basic "I write values", rather than objects; note, though, that it doesn't handle field-names, since that doesn't "fit" in the protobuf spec (which uses numeric markers)
p70705
aVObviously there are twins for each;  and
p70706
aVPersonally though, I think you'd find it more convenient to think in terms of objects
p70707
aVBut you can take control of it yourself, like I did here
p70708
aVHere's an example using the alpha dll:
p70709
as(dp70710
g18
V23354
p70711
stp70712
a((dp70713
g2
(lp70714
VThe attribute () is , which limits many options; however, LINQ-to-SQL is not tied to the attribute model - there are other providers
p70715
aVMost notably, you might look at using the xml model provider, and generating the xml at runtime
p70716
aVThis is the  parameter in the overloaded constructor; a typical usage would be  or similar
p70717
aVHowever, it generally seems pretty uncommon that the core tables will change at runtime
p70718
aVUncommon, but not unsupported
p70719
aVFor reference, the implicit default is
p70720
as(dp70721
g18
V23354
p70722
stp70723
a((dp70724
g2
(lp70725
VAn  is an ; you still need to fetch it like that, and to be honest it isn't exactly clear how exactly you mean, but at a guess it sounds like you want:
p70726
as(dp70727
g18
V23354
p70728
stp70729
a((dp70730
g2
(lp70731
VThe TPL should do that for you - just call  on your  - however, there is no way to do this without blocking; by definition, in your scenario that is exactly want you want to do
p70732
aVBlocking might be implemented via a , but there are other ways too - the TPL hides this
p70733
aVPersonally, in a similar scenario I do it with a custom queue and a mini-pool of objects I can use to lock against (never exposed outside the wrapper)
p70734
aVYou might also want to look at the C# 5 async/await stuff
p70735
aVBut note: if you aren't going to do anything useful while you are waiting, you might as well run that code directly on the current thread - unless the issue is thread-bound, for example a multiplexer
p70736
aVIf you are interested, later today (or over the weekend) I intend releasing the multiplexer that stackoverflow uses to talk to redis, which (in synchronous mode, at least) has exactly the problems you describe
p70737
aVAs a side note; if you can work with a callback (from the other thread), and not have to wait on completion, that can be more efficient overall
p70738
aVBut it doesn't fit every scenario
p70739
as(dp70740
g18
V23354
p70741
stp70742
a((dp70743
g2
(lp70744
VNot entirely sure of the meaning, but it sounds like you just want:
p70745
aVOf course, if you are actually dealing with an  it is already padded on the left with 0, to 4 bytes
p70746
as(dp70747
g18
V23354
p70748
stp70749
a((dp70750
g2
(lp70751
V is a TSQL parameter
p70752
aVWithout  this is neither defined nor assigned a value
p70753
aVIt simply will not work with the parameter omitted, and even if it did: where would it get your chosen value () from
p70754
aVThe absolute best it could do would be to use  which was not your intent; more typically it would simply fail to execute (are you sure you aren't swallowing an exception somewhere
p70755
aVNote that concatenating the value into the string itself is not recommended; it would cause a SQL injection risk, and can reduce performance (plan re-use; not sure this applies to CE though - CE might very well not bother with cached plans)
p70756
as(dp70757
g18
V23354
p70758
stp70759
a((dp70760
g2
(lp70761
VIt really depends on how much you need to guard against pathologically stupid code ;p The following  (against a class) will return :
p70762
aVwith:
p70763
aVYou do, thankfully, need to go a long way off-piste to get this type of crazy, though
p70764
aVIn any sane code,  will never return a  (except for )
p70765
aVBoth these counter-cases are discussed more here
p70766
aVBut to reiterate: no, don't check the result for  unless you have reason to suspect somebody is being really, really daft
p70767
as(dp70768
g18
V23354
p70769
stp70770
a((dp70771
g2
(lp70772
VNotepad is an actual exe; cls is a command to the interpreter, not an exe
p70773
aVYou can probably "fix" it by toggling use-shell-invoke, but either way, it won't help because it isn't clearing your console window, but the console window of the newly spawned process
p70774
aVI suspect you want:
p70775
as(dp70776
g18
V23354
p70777
stp70778
a((dp70779
g2
(lp70780
VIt sounds to me like your colleague would do well with a no-sql document-database or key-value store
p70781
aVWhich are themselves very good tools and a good fit for many problems
p70782
aVHowever, a relational database is heavily optimised for working with sets
p70783
aVThere are many, many ways of querying the data based on joins that are vastly more efficient than lots of round trips
p70784
aVThis is where the versatilty of a rdbms comes from
p70785
aVYou can achieve the same in a nosql store too, but you often end up building a separate structure suited for  each different nature of query
p70786
aVIn short: I disagree
p70787
aVIn a RDBMS, joins are fundamental
p70788
aVIf you aren't using them, you aren't using it as a RDBMS
p70789
as(dp70790
g18
V23354
p70791
stp70792
a((dp70793
g2
(lp70794
VWell,
p70795
aVThis is then short-circuited, and we only find the end date once
p70796
as(dp70797
g18
V23354
p70798
stp70799
a((dp70800
g2
(lp70801
VIt wouldn't surprise me if that simply won't work; however, you can use a trivial projection, such as:
p70802
aVThen the member name is
p70803
as(dp70804
g18
V23354
p70805
stp70806
a((dp70807
g2
(lp70808
VA full SQL Server install is probably not something you should even try to deploy - licensing aside, the configuration of a SQL server is environment dependent
p70809
aVIt would be better to list sql server as a pre-requisite in documentation only, and get it installed manually
p70810
aVIf your database is smaller, though, a SQL server express install might be reasonable to embed in an installer (if you use a named instance); IIRC the larger version of the installer allows you to create a custom installer for an application, ideal for deployment scenarios
p70811
aVEven better; if you can fit into SQL server compact, then that is an embedded server; there is no install as such - just ship the runtime with the application
p70812
as(dp70813
g18
V23354
p70814
stp70815
a((dp70816
g2
(lp70817
VYour best bet there is to just use  or , and write a factory method that creates the appropriate type of connection to return (as the more abstract  / )
p70818
aVThen it will work for any connection type
p70819
aVBe sure to use the connection's  method etc for creating commands
p70820
aVYour  is then just  (or )
p70821
aVre the actual question; not really
p70822
aVYou can do that at compile time, with  etc - but not at runtime
p70823
as(dp70824
g18
V23354
p70825
stp70826
a((dp70827
g2
(lp70828
VIn short, trying to serialize a http request object may not end well; even if you get past the current issue, I would expect it to fail in a few more places
p70829
aVYou should construct your own object model that includes those parts of the request you care about, in a simple form
p70830
aVIn the case of the HttpValueCollection, you may need to add a basic collection of some type that is a name/value pair
p70831
aVThen: populate your new model from the actual request, and serialize your model
p70832
as(dp70833
g18
V23354
p70834
stp70835
a((dp70836
g2
(lp70837
VIn short, no
p70838
aVFor the same reasons that extension methods don't work with , which is that from just the method name, there is no way of knowing what  directives were in effect, and hence which extension methods are candidates
p70839
aVIt is entirely possible to have scenarios where using different  directives changes the available methods, so there is no benefit in having it try to guess
p70840
aVYou'll have to limit yourself to regular methods, unless the string allows you to specify static methods on classes explicitly, i
p70841
ag50
as(dp70842
g18
V23354
p70843
stp70844
a((dp70845
g2
(lp70846
Vweb
p70847
aVconfig is always composed of multiple layers; the "master" in the main
p70848
aVNET directory (under CONFIG), the root web
p70849
aVconfig, and every layer down - notably including subdirectories within an application
p70850
aVIn short, yes: it needs read access to any parent web
p70851
aVconfig files
p70852
as(dp70853
g18
V23354
p70854
stp70855
a((dp70856
g2
(lp70857
VBy calling , you have already "claimed" the first row (hence why Bag isn't showing - because you aren't doing anything with it); and yet  is also going to do a
p70858
aVI expect you want (note I'm not calling  here, and have no  loop):
p70859
aVThe reason it is exiting is that once you've called  you've already read all the data, so there is nothing else to read
p70860
aVI honestly don't know whether getting to the end of the TDS stream implicitly closes the reader, but you should be using:
p70861
as(dp70862
g18
V23354
p70863
stp70864
a((dp70865
g2
(lp70866
VWith the clarification, it looks like you want to find whether there is an integer  for which (in math terms, not code)
p70867
aVis true; so you want to know whether  is some multiple of ; which is easy:
p70868
aVand if you want to know which :
p70869
as(dp70870
g18
V23354
p70871
stp70872
a((dp70873
g2
(lp70874
VTo explain how  and  work (the footnote of the question), read the following but noting that:
p70875
aVimplements  and has a  which is used for resolving metadata
p70876
aVimplements , which provides the table's default ; the  implements , and implements  to provide metadata
p70877
aVCollections bind in the following order:
p70878
aVthe source is tested for ; if available the  is obtained via
p70879
aVotherwise the source is tested for ; if unavailable an exception is thrown
p70880
aVthen metadata for the  is queried:
p70881
aVthe  is tested for ; if available this is used via
p70882
aVthe  is tested for a public typed (non-object) indexer, i
p70883
ag50
aV- if found,  is implied as the type and metadata obtained via
p70884
aVelse the first item (if non-empty) is queried via  for the type, and metadata obtained via
p70885
aVwe now have access to the items () and their metadata; additional support (optional) is provided via  (provides 2-way binding and basic sorting etc),  (provides advanced sorting, filtering, etc),  and
p70886
aVFor most common scenarios (show data and push changes back)  is fine; if you need to show unrelated updates as they  happen  helps - but note that to support member level updates (as opposed to just add/remove/etc) the  must implement
p70887
aVFor reference, "metadata" here means "a set of s" (1 per column/property), which provide access to the underlying data (when supplied with an ), and information about the member itself (name, type, etc)
p70888
as(dp70889
g18
V23354
p70890
stp70891
a((dp70892
g2
(lp70893
VDepending on the architecture, implementing  on your domain types might be an option; this allows you to indicate failure at both the object and object+member level, and IIRC this is now also handled automatically by MVC (a number of other frameworks such as winforms etc have supported this for ages)
p70894
as(dp70895
g18
V23354
p70896
stp70897
a((dp70898
g2
(lp70899
VWhat is the  in your
p70900
aVThe type metadata is inferred from that (in winforms binding, at least; so I assume this applies to WPF too)
p70901
aVSo if you have a  then only the properties of  will be shown
p70902
aVTry using a  instead
p70903
as(dp70904
g18
V23354
p70905
stp70906
a((dp70907
g2
(lp70908
VYes;  is not thread safe, so adding to it ad-hoc from arbitrary threads (quite possibly at the same time) is doomed
p70909
aVYou should use a thread-safe list instead, or add locking manually
p70910
aVOr maybe there is a
p70911
aVAlso, if it matters: insertion order will not be guaranteed
p70912
aVThis version is safe, though:
p70913
aVhere we are using  to update a different array index per parallel call
p70914
as(dp70915
g18
V23354
p70916
stp70917
a((dp70918
g2
(lp70919
VFirstly, that isn't xml (element names can't have whitespace)
p70920
aVIt would have to be, for example:
p70921
aVis supported on WP7 (MSDN), so you should be able to use:
p70922
aVAnother option is , also supported on WP7 (MSDN)
p70923
as(dp70924
g18
V23354
p70925
stp70926
a((dp70927
g2
(lp70928
VIn short, no
p70929
aVThere are various attempts at this, including stack inspection () and lambda expressions, but ultimately they are all a bit inefficient
p70930
aVUnless you need need obfuscation, I would just use a string -  - this is very unlikely to be a genuine maintenance problem
p70931
aVThe stack inspection approach suffers from potential brittleness if it inlines; if you need obfuscation, I would probably go with
p70932
aVOr just mark the method as "don't obfuscate this name"
p70933
aVAnother approach would be to have an abstract base type, and use meta-programming to create the concrete type with the right data/code at runtime, based on inspecting your attributes
p70934
as(dp70935
g18
V23354
p70936
stp70937
a((dp70938
g2
(lp70939
VThe first to to look for is a "content-disposition" header; if that exists, and in particular if it starts "attachment", then it represents an explicit download, and the "content-disposition" header may (optionally) contain the preferred filename, which may include an extension
p70940
aVIf that doesn't help, then look at the "content-type" header; you may have to infer a few things for common types
p70941
aVBut to state it explicitly: file extensions don't rule on the internet
p70942
as(dp70943
g18
V23354
p70944
stp70945
a((dp70946
g2
(lp70947
VNot nicely
p70948
aVIt is the  that is making them automatically implemented properties; without them they become fields
p70949
aVYou really don't want public fields, so leave it alone
p70950
aVReally, you aren't solving any problem here; leave it
p70951
aVThis is normal (at least since automatically implemented properties were introduced), and the  is not adding to the line count etc
p70952
as(dp70953
g18
V23354
p70954
stp70955
a((dp70956
g2
(lp70957
VWhen using a socket like this, I would use something like protobuf-net instead of  (caveat/disclosure: I wrote it) In particular, if you write each item with  using Base128 for the prefix-style (one of the options), and some known tag (the other option) such as , then at the other end you can just use  (again specifying Base128 and )
p70958
aVThis will correctly pick off items without trying to over-read until the stream is closed, when it will
p70959
aVEach object is returned () separately, so it won't try to consume the entire stream before giving you data
p70960
aVIt can also be used with heterogeneous data if you like, but homogeneous is easiest
p70961
as(dp70962
g18
V23354
p70963
stp70964
a((dp70965
g2
(lp70966
VThe builder approach should be cheap enough, especially if you can execute near to the server to minimise latency
p70967
aVHowever, if the bit field has the first/last field number, it should be a single byte update in either the 2nd or last byte, so might be possible in SQL if you like
p70968
aVIn fact, as long as you just want to skip the ints (i
p70969
ag50
aVyou don't need to know what they were or change them), even picking out the bool in the middle would be fairly easy
p70970
aVBut try the route using the existing client first; it may be faster than you think
p70971
as(dp70972
g18
V23354
p70973
stp70974
a((dp70975
g2
(lp70976
VNo, there's no syntax in C# for marking an explicit abstract override method (as distinct from another method with the same signature), and since you can't have two matching signatures declared in the same level you can't do quite what you want
p70977
aVSince you've ruled out changing the base class, the only suggestion I have is to add an artificial extra level:
p70978
as(dp70979
g18
V23354
p70980
stp70981
a((dp70982
g2
(lp70983
VAn  method is typically being implemented via a dll-import (P/Invoke) - so it does have an implementation - you just can't see it
p70984
aVA  method is useful mainly with code-generation as a way to inject functionality into the generated code
p70985
aVThey are optional, private only, and only exist if you provide the other half
p70986
aVAs such there are also some limitations around return/out values to assure definite assignment
p70987
aVCalls to partial methods will be omitted entirely by the compiler if there is no implementation
p70988
aVAn  method is where the implementation has to be provided by a derived type
p70989
aVThe runtime ensures you can't have an instance if there are still unimplemented abstract methods, so you are assured that they will exist at runtime
p70990
as(dp70991
g18
V23354
p70992
stp70993
a((dp70994
g2
(lp70995
VYou aren't calling the setter; you are essentially calling  each time (for "test2" and "test3") - it is a collection initializer
p70996
aVFor it to be the property assignment, it would be:
p70997
as(dp70998
g18
V23354
p70999
stp71000
a((dp71001
g2
(lp71002
VThe scenario with  isn't supported, partly due to how to v1 handles the generation/caching -however, in v2 (preview available) this is supoortable:
p71003
aVActually, with this approach you can take away all the attributes if you want (telling it explicitly instead)
p71004
aVNote: you should cache and re-use the compiled model as far as possible - it is thread-safe, but generating it each time will be a bit more expensive
p71005
as(dp71006
g18
V23354
p71007
stp71008
a((dp71009
g2
(lp71010
VXmlSerializer doesn't  check this flag; the answer is "when using BinaryFormatter (or a few others; not many) and not implementing ISerializable"
p71011
aVMost serializers don't use this flag
p71012
as(dp71013
g18
V23354
p71014
stp71015
a((dp71016
g2
(lp71017
VIt is an  (void, no parameters) delegate with a body that does nothing
p71018
aVUseful for when a non-null delegate is needed (perhaps to simplify callback or event invocation, as invoking on a  is an error), but you have nothing specific to do
p71019
as(dp71020
g18
V23354
p71021
stp71022
a((dp71023
g2
(lp71024
VMy approach here is:
p71025
aVsplit the data into several calls, essentially pages of (say) 500 rows each
p71026
aVA handful of round-trips (rather than 1) won't hurt latency, but will increase stability
p71027
aVchange the serializer (I'm biased here, but I like protobuf-net) to reduce the bandwidth needed per call, ideally in combination with enabling MTOM
p71028
aVThat should reduce the bandwidth in the different ways in parallel, and fix the issue
p71029
as(dp71030
g18
V23354
p71031
stp71032
a((dp71033
g2
(lp71034
VNot all strings are interned; literals / constants from the compiler (and specifically, the  IL code) are interned automatically, and you can intern/check manually - but most strings constructed at runtime (for example from user-input, loaded from files/databases, or concatenation with values) are not
p71035
aVSo yes: it is necessary to do value checks too
p71036
aVInterning is an optimisation only; it needs to work without it
p71037
as(dp71038
g18
V23354
p71039
stp71040
a((dp71041
g2
(lp71042
VYou can always keep the indexers, but add the named methods as an auxiliary API - perhaps even via extension methods so you can bring them into play by adding a  directive
p71043
as(dp71044
g18
V23354
p71045
stp71046
a((dp71047
g2
(lp71048
VThe more I look at it, the more I want to say:
p71049
aVif you need it based on a string, the  API is pretty fair there
p71050
as(dp71051
g18
V23354
p71052
stp71053
a((dp71054
g2
(lp71055
VA dictionary is a 1:1 map (each key is mapped to a single value), and a dictionary is mutable (editable) after the fact
p71056
aVA lookup is a 1:many map (multi-map; each key is mapped to an  of the values with that key), and there is no mutate on the  interface
p71057
aVAs a side note, you can query a lookup (via the indexer) on a key that doesn't exist, and you'll get an empty sequence
p71058
aVDo the same with a dictionary and you'll get an exception
p71059
aVSo: how many records share each key
p71060
aVAn overly simplified way of looking at it is that a  is roughly comparable to a
p71061
as(dp71062
g18
V23354
p71063
stp71064
a((dp71065
g2
(lp71066
V is already pass-by-reference, so unless you have something specific in mind: just assign to
p71067
aVNote that if multiple threads are involved here you might need ,  or synchronisation such as  - and this applies to all access to the member (read or write)
p71068
as(dp71069
g18
V23354
p71070
stp71071
a((dp71072
g2
(lp71073
VIt actually depends on your
p71074
aVNET version and configuration
p71075
aVIn C++/CLI you can throw anything; it doesnt have to be an
p71076
aVIn 1
p71077
aV1 (IIRC) ou could only catch these with a catch block like:
p71078
aVWhich isn't very helpful - you can't see what happened
p71079
aVIn 2
p71080
aV0 (IIRC) by default such exceptions are automatically wrapped up inside a dummy  subclass
p71081
aVHowever, for compatibility you can turn this off
p71082
aVI beg you: don't :)
p71083
as(dp71084
g18
V23354
p71085
stp71086
a((dp71087
g2
(lp71088
VHyperDescriptor is designed for the specific purpose of fitting inside the ComponentModel API
p71089
aVIf you don't use that, it may be overkill
p71090
aVJust caching the data inside a static generic type can be pretty effective, using a static constructor to populate the data
p71091
aVBy which I mean: store the data per-T:
p71092
as(dp71093
g18
V23354
p71094
stp71095
a((dp71096
g2
(lp71097
VInside a
p71098
aVthat should be easy:
p71099
aVwhich should work as a: you have a  (which is unusual for a list; I don't recommend it), and b: that shouldn't break the iterator (adding/removing/etc to the underlying list (etc) of resorts would break the iterator)
p71100
as(dp71101
g18
V23354
p71102
stp71103
a((dp71104
g2
(lp71105
VDon't obfuscate anything to do with serialization unless the names are explicitly stated via attributes; and even then take care - some serializers include type names in the metadata (which may not match for long)
p71106
aVWatch out for convention-based methods; for example  and  (twinned with property ) - these conventions are common in both serializers and the
p71107
aVThere is also a  convention for some serializers
p71108
aVAnd anything that is going to use reflection is likely doomed
p71109
aV;p
p71110
as(dp71111
g18
V23354
p71112
stp71113
a((dp71114
g2
(lp71115
VUnless you are doing printing at the server, ASP
p71116
aVNET isn't doing the printing; the browser is
p71117
aVYou can't control that from code, AFAIK
p71118
aVYou would need to be using a plugin of some kind, at a minimum
p71119
as(dp71120
g18
V23354
p71121
stp71122
a((dp71123
g2
(lp71124
VIf you want the full graph serialized, DataContractSerializer can do that, but only with the  option enabled in the constructor
p71125
aVPersonally, I would just serialize the downwards relationships, and fixup the parent navigations only
p71126
as(dp71127
g18
V23354
p71128
stp71129
a((dp71130
g2
(lp71131
VSince you are talking TCP, I would use a Stream pattern, not a return type - i
p71132
ag50
aVThis is then format independent
p71133
aVHowever, for "separation of concerns" I would favour a separate serializer than objects that also know about serialization
p71134
aVEither it's job is to be an object model, or it's job is to know how to serialize things; rarely both
p71135
aVPersonally, on a socket I'd use something denser than XML though; I have very strong tendencies towards protobuf (but as an implementor (protobuf-net) I'm biased)
p71136
as(dp71137
g18
V23354
p71138
stp71139
a((dp71140
g2
(lp71141
VIf you have a generic method with 2 generic types (T and U) then both most be specified, or both most be inferred
p71142
aVIf that isn't possible, consider an expression taking  (remove U), and remove the cast/convert node from the expression tree when inspecting it at runtime
p71143
aVYou can also do things to make both types inferred, but that may need more of a refactor
p71144
as(dp71145
g18
V23354
p71146
stp71147
a((dp71148
g2
(lp71149
VThe Windows
p71150
aVForms timer raises the event back on the UI thread, presumably via the sync-context
p71151
aVIf you want a non-UI thread, there are other timers - for example System
p71152
aVTimers
p71153
aVTimer or System
p71154
aVThreading
p71155
aVTimer
p71156
as(dp71157
g18
V23354
p71158
stp71159
a((dp71160
g2
(lp71161
VWell, "it doesn't seem to work" is pretty vague - a bit more detail would be nice
p71162
aVBut it sounds like a permissions issue
p71163
aVThe default profile in IIS has very little access to the disk, especially write access
p71164
aVIt isn't really a good idea to write inside your own site anyway (I'd use an unrelated part of the disk, myself), but you will need to configure IIS to run the application in a specific named identity, with access to the disk
p71165
aVConfiguring the account itself (not IIS - the account; for example granting "logon as a service") to run as an ASP
p71166
aVNET account is not particularly trivial, unfortunately
p71167
aVAnother thought: is your app a sub-application, i
p71168
ag50
aVis your app-root , or is it
p71169
aVThe reason I ask is your use of  might be better expressed relative to the app-root, i
p71170
ag50
aV- but again I stress; writing inside the app is risky
p71171
aVYou really want that folder to be non-executing
p71172
as(dp71173
g18
V23354
p71174
stp71175
a((dp71176
g2
(lp71177
VManual enumeration is very rare (compared to , for example) - the first thing I'd suggest is: check you really need that
p71178
aVHowever, since a dictionary enumerates as key-value-pair:
p71179
aVshould work
p71180
aVOr if it is only a method variable (not a field), then:
p71181
aVor better (since if it isn't a field it probably needs local disposal):
p71182
aVor best ("KISS"):
p71183
aVHowever, you should also always dispose any existing value when replaced
p71184
aVAlso, a set-only property is exceptionally rare
p71185
aVYou really might want to check there isn't a simpler API here
p71186
aVfor example, a method taking the dictionary as a parameter
p71187
as(dp71188
g18
V23354
p71189
stp71190
a((dp71191
g2
(lp71192
VWith generics, the best constraint you can use here is , which isn't very restrictive and doesn't give you access to anything useful
p71193
aVIf the problem is operators, then there are various hacks around that; MiscUtil provides operator support with generics, or  works too (almost as fast, as long as you aren't using )
p71194
aVA  alias might help if you need compile time, i
p71195
ag50
aV(in each file)
p71196
as(dp71197
g18
V23354
p71198
stp71199
a((dp71200
g2
(lp71201
VFirstly, Silverlight has different permission rules - much harder to get at the private fields
p71202
aVOf course, for the FCL designers I don't think this would be a problem - they could just code that into the runtime (but re-creating a potential way of side-stepping the sandbox)
p71203
aVPerhaps the biggie is that Silverlight doesn't need (or want) to support "remoting", which is the main reason it has to exist in the main
p71204
aVNET BCL
p71205
aVOf course, remoting is out of fashion generally, but needs to be in core
p71206
aVNET for backwards compatibility
p71207
aVA third reason could well be the very nature of ; many classes in SL have different implementations inside the SL runtime, to account for different features and available types / security / etc
p71208
aVThis makes it virtually impossible to have it wire compatible with the core
p71209
aVNET runtime
p71210
aVSo you wouldn't be able to share it with your server code
p71211
aVOverall, then, it makes great sense to just cut it
p71212
aVFor app<===>server, contract-based serializers exist; and other (dare I say: better) binary serializers are available that avoid all these problems (i
p71213
ag50
aVare fully portable)
p71214
as(dp71215
g18
V23354
p71216
stp71217
a((dp71218
g2
(lp71219
VSimpy, it is quite tightly related to  and a few other web assets like  (which I confess I've never heard of before)
p71220
aVYou are right in that fundamentally that class has little directly to do with web, but I can see why it would be tempting to leave it with it's siblings (with which it is designed to be used)
p71221
aVUltimately, though
p71222
aVmeh
p71223
aVNaming stuff (and I'll include namespaces in that) is hard
p71224
as(dp71225
g18
V23354
p71226
stp71227
a((dp71228
g2
(lp71229
VI suspect @abatishchev's revised answer will help here, but if you are doing this lots, or this is an important query, then I strongly suggest a refactor
p71230
aVFor example:
p71231
aVI can now do a very efficient first-character match simply by testing
p71232
aVWhich could be an integer instead if the numeric ones are particularly important
p71233
as(dp71234
g18
V23354
p71235
stp71236
a((dp71237
g2
(lp71238
VYou could try adding  to
p71239
aVHowever you may find it easier just to split into 2 DTO classes - 1 for json, one for DCS
p71240
aVIf you use , a twinned  is pretty easy to write, so that is another viable option (you might even be able to get away with just )
p71241
as(dp71242
g18
V23354
p71243
stp71244
a((dp71245
g2
(lp71246
VI think your best option here would be to write to a , and when done,
p71247
aVIf the contents are large, you might consider writing directly to the file in the first place (via ), but for small-to-medium files this should be fine
p71248
as(dp71249
g18
V23354
p71250
stp71251
a((dp71252
g2
(lp71253
Vdo you mean:
p71254
aVNote that having generics depend hugely on the T (and act differently) may mean what you are trying to do isn't actually very generic
p71255
as(dp71256
g18
V23354
p71257
stp71258
a((dp71259
g2
(lp71260
VIn that example it isn't entirely clear where the timing starts and ends - for example, if you are including the time to fetch data from the  then that will most likely be a bottle-neck
p71261
aVThe contracts look fine; there are some small optimisations possible if you like, but nothing major (although using group-based sub-objects should help a bit by avoiding some buffering; add  to the sub-object  and )
p71262
aVIf the issue isn't the , then it may well be worth trying v2 (currently available as an alpha, or as source) which completely overhauls the internals
p71263
aVFor a more detailed answer, I'd need a fully reproducible example to investigate
p71264
as(dp71265
g18
V23354
p71266
stp71267
a((dp71268
g2
(lp71269
VI don't think the difference will usually be huge, but I would prefer the full async approach (Begin
p71270
aV/End
p71271
aVif I expect pauses in the incoming stream, so that the callback can be offloaded a few layers rather than demanding an extra thread
p71272
aVAnother advantage of the async approach is that you can always get the data you need, queue another async fetch, and then process the new data on the existing async thread, giving some more options for parallelism (one reading, one processing)
p71273
aVThis can be done manually too, of course (perhaps using a work queue)
p71274
aVYou could of course profile
p71275
as(dp71276
g18
V23354
p71277
stp71278
a((dp71279
g2
(lp71280
VIt looks like the problem is simply that the properties are non-public, so  etc will return
p71281
aVTo fetch non-public properties, you need binding flags:
p71282
aVYou might also want to loop at something like dapper which will do the binding for you, and is much faster (it pre-generates IL via the emit API, rather than per-item/per-member reflection)
p71283
as(dp71284
g18
V23354
p71285
stp71286
a((dp71287
g2
(lp71288
VTwo thoughts:
p71289
aVtreat it as  and cast at the consumer
p71290
aVcreate a  class  (and make it immutable), and swap some  references
p71291
aVIn both cases, the consumer should take a clone of the value before anything else (no double reads; it may change between reads)
p71292
as(dp71293
g18
V23354
p71294
stp71295
a((dp71296
g2
(lp71297
VRe performance; protobuf-net is designed to perform that reflection as little as possible, creating efficient data access code after that
p71298
aVIn v2, it takes this much further in many ways - using much lower-level meta-programming, and if you want it (entirely optional), pre-generation of a standalone serializer dll - so at runtime the reflection cost is somewhere between minimal (if using runtime meta-programming) to nil (if using pre-generation)
p71299
aVRe release; "when it is ready"; life is crazy hectic, but an alpha dll is available for both full
p71300
aVNET and iPhone (this latter will probably work on most of the lighter runtimes, since iPhone is the most restrictive)
p71301
aVUltimately, reality is that (as unsponsored, etc) it is going to lag a bit behind things like work and family - I try to find time when I can, though
p71302
aVI think a more sensible comparison is the goals; protobuf-net is designed to be easily fitted onto your existing DTO or domain model, without significant rework - or for use in a code-first scenario
p71303
aVIt also supports generation from
p71304
aVproto, but that isn't the primary goal (but is of course hugely desirable)
p71305
aVIt also sports a very different API, geared around common
p71306
aVNET metaphors, rather than common protobuf metaphors
p71307
aVOr to put it another way:
p71308
aVprotobuf-csharp-port focuses on protobuf, and adds C# /
p71309
aVNET to the existing protobuf landscape
p71310
aVprotobuf-net focuses on C# /
p71311
aVNET, and adds protobuf to the existing C# /
p71312
aVNET landscape
p71313
aVA subtle distinction, maybe - and indeed either would make a worthy serialization API for
p71314
aVNET
p71315
aVAs a corollary, if your primary aim is interop between heterogeneous environments that you actively work on in the same team - then maybe protobuf-csharp-port is a better match for you
p71316
aVI'm also a bit
p71317
aV"loose" with protobuf, so I have no (well, minimal) guilt going a little bit beyond the standard spec (while staying inside the protocol definition) to shoehorn in inheritance, full-graphs, etc - which are common in the
p71318
aVNET ecosystem but have no direct map in protobuf
p71319
aVAnd of course I can look more at tools like WCF (and to a lesser degree: remoting)
p71320
as(dp71321
g18
V23354
p71322
stp71323
a((dp71324
g2
(lp71325
VThe standard download zip contains several dlls with cumulative features; in particular, the 3
p71326
aV0 version includes WCF hooks that only exist in 3
p71327
aV0 and above
p71328
aVWhile VS2008 is fairly forgiving here, VS2010 will usually point-blank refuse to include a reference for a higher framework
p71329
aVIf you don't need WCF, then the 2
p71330
aV0 version should work on any of 2
p71331
aV0, 3
p71332
aV0, 3
p71333
aV5 or 4
p71334
aV0 Otherwise - pick the right dll from the zip
p71335
as(dp71336
g18
V23354
p71337
stp71338
a((dp71339
g2
(lp71340
VThere are some edge-cases where this might cause harm:
p71341
aVChanging to an automatically implemented property
p71342
aVif you are using field-based serialization at any point (for example, ), then this will break when changing to an automatically implemented property, as the field-name will change
p71343
aVThis will also impact any other scenario that uses reflection to access the (hopefully private) fields, but  is the most common cause of confusion here
p71344
aVRemoving the  test
p71345
aVwill be fine for most data-types such as  etc, however, if you use it with a type that implements a custom equality operation, you might find you are suddenly swapping a reference when previously (with the ) the objects reported equal for different references
p71346
aVThe first is a more likely problem
p71347
aVIf you are using , then keep the private field (byt maybe remove the  test)
p71348
aVAnd then start refactoring your code away from  ;p
p71349
as(dp71350
g18
V23354
p71351
stp71352
a((dp71353
g2
(lp71354
VI am not aware of any inbuilt encryption for either solution or project files, and I quite often move projects around on USB stick
p71355
aVIt is possible that this is being provided by some service on your computer, or by the disk itself - but I wonder if a more likely explanation is simply file corruption or a damaged disk
p71356
as(dp71357
g18
V23354
p71358
stp71359
a((dp71360
g2
(lp71361
VIf you are using the  per thread or per method (i
p71362
ag50
aVas a method variable), then your code is most-likely broken
p71363
aVIt is not a singleton; it relies on all threads accessing the protected data using the same lock
p71364
aVThis is most commonly achieved by placing the lock in a field, i
p71365
ag50
aVAlso - maybe consider  in many scenarios; less overhead
p71366
aVRe your follow-up; when acquiring the lock you are changing the internal state (in a thread-safe manner) to preserve the "many-readers  single-writer" expectation (perhaps blocking until that is possible, i
p71367
ag50
aVconflicting locks have been withdrawn)
p71368
as(dp71369
g18
V23354
p71370
stp71371
a((dp71372
g2
(lp71373
VIt depends in part on whether the query itself is streaming, or whether it does lots of work in temporary tables then (finally) starts returning data
p71374
aVYou can't do much in the second scenario except re-write the query; however, in the first case an iterator block would usually help, i
p71375
ag50
aVThis is now a streaming iterator - you can  over it and it will retrieve records live from the incoming TDS data without buffering all the data first
p71376
aVIf you (perhaps wisely) don't want to write your own materialization code, there are tools that will do this for you - for example, LINQ-to-SQL's  will do the above pain-free
p71377
as(dp71378
g18
V23354
p71379
stp71380
a((dp71381
g2
(lp71382
VThat is not a standard assembly / namespace, so it sounds like (as the error message is already telling you) you are missing a reference:
p71383
aVare you missing a using directive or an assembly reference
p71384
aVIf "commonlib" is something of yours, check that this project has a valid reference to it
p71385
aVIf the code isn't yours, then you'll need to find what "commonlib" referred to, and either track, re-implement, or excise it
p71386
aVIf you are migrating from VB
p71387
aVNET code, this could just be a case-sensitivity issue, i
p71388
ag50
aVit might be , not
p71389
as(dp71390
g18
V23354
p71391
stp71392
a((dp71393
g2
(lp71394
VYou should really re-architect this with appropriate infrastructure
p71395
aVOne option would be your existing client, with a ClickOnce wrapper, and switching the data-access to use a web-service that you expose (with appropriate security etc) via a web server
p71396
aVHowever, this limits you to windows clients - as would xbap or WPF (plus xbap/WPF is a UI rewrite)
p71397
aVSilverlight has a little more flexibility but is a complete UI rewrite
p71398
aVPersonally, I think your best option is to bite the bullet and re-engineer it as a web-based application; html, jQuery, etc - and MVC or WebForms, etc (since you're familiar with
p71399
aVNET)
p71400
as(dp71401
g18
V23354
p71402
stp71403
a((dp71404
g2
(lp71405
VTry:
p71406
as(dp71407
g18
V23354
p71408
stp71409
a((dp71410
g2
(lp71411
VSee the comment on the  argument where you are passing in :
p71412
aVIf this is null, external resources are not resolved
p71413
aVYet  is an external resource
p71414
aVTry passing in a  instead of
p71415
aVAlso, you are over-complicating the load by using  - this is easier:
p71416
aVFor info, you can supply your own custom resolvers if you like - for example, I wrote one that re-mapped relative paths to contents from a resx, so the files could be edited normally in the IDE but then included as embedded resources (but still resolve their siblings correctly)
p71417
as(dp71418
g18
V23354
p71419
stp71420
a((dp71421
g2
(lp71422
VDifference
p71423
aVthe latter ends with A being 0, not 100
p71424
aVWhen
p71425
aVPretty much never
p71426
aVMaybe in some generated code it is simpler to use the  syntax, but  would be preferred even then
p71427
aVAnd  does not "allocate memory on the heap"
p71428
aVIt initializes an instance; that is all
p71429
as(dp71430
g18
V23354
p71431
stp71432
a((dp71433
g2
(lp71434
VAn excellent question
p71435
aVPersonally, I'm definitely not a fan, however some people running on things like CF/XNA will swear blind that they need the extra bit of performance they can eek from (over)using structs, which generally involves them being mutable
p71436
aVThis argument has some value if the struct is accessed directly in an array, on a public field, or accessed via , but in many cases you might get bitten by chomping through stack-space by duplicating an over-sized struct many times on the stack
p71437
aVIf you are using structs, mutable-or-not, and if you are using serialization, then a fully immutable struct can be a real problem
p71438
aVPartial or "popsicle" immutability can be an answer here, but the same frameworks that are tempting for value-types also tend to have more reflection restrictions, making private/field-based serialization tricky
p71439
aVSo mutable is handy
p71440
aVAll of the above are really examples of using a struct to hold something that is actually better classified as an object
p71441
aVPure values don't change
p71442
aVEver
p71443
aVSo full immutability is fine
p71444
aVAs a final thought
p71445
aVnot a justification for the existence, but it makes excellent interview fodder, and is great for tripping up the unwary
p71446
aVMaybe it was designed by people acting as consultants ;p
p71447
as(dp71448
g18
V23354
p71449
stp71450
a((dp71451
g2
(lp71452
VFor a pure TSQL answer:
p71453
aV(credit is due to Mikael Eriksson re )
p71454
aVNote that  makes the  and  injection safe
p71455
aVNote also, though, that the varying parameter () is safe from injection - we don't need to validate that anywhere; and that this will allow query-plan re-use via
p71456
as(dp71457
g18
V23354
p71458
stp71459
a((dp71460
g2
(lp71461
VYou aren't really testing an object - you want to test the type
p71462
aVTo call those, the caller must know the type, but
p71463
aVmeh
p71464
aVGiven a signature  the only sane answer is:
p71465
aVor if we want to use an example object for type inference purposes:
p71466
aVthis doesn't need boxing ( is boxing), and doesn't have problems with
p71467
aVA more interesting case is when you are passing
p71468
aVhere, we already have massive problems with , since that could be an empty  (a struct) or a class
p71469
aVBut A reasonable attempt would be:
p71470
aVbut note that it is incorrect (and unfixable) for empty s
p71471
aVHere it becomes pointless to worry about boxing as we are already boxed
p71472
as(dp71473
g18
V23354
p71474
stp71475
a((dp71476
g2
(lp71477
VNo, basically
p71478
aVYou would have to initialize the collection in the constructor
p71479
aVTo be honest, a settable collection is rarely a good idea anyway; I would actually use just (changing your first version, removing the ):
p71480
aVor if I want to defer construction until the first access:
p71481
as(dp71482
g18
V23354
p71483
stp71484
a((dp71485
g2
(lp71486
VYou should start and commit/rollback a transaction at the same level, otherwise you are introducing a lot of unpredictable paths - and frankly some bad design
p71487
aVSo: if you need to commit at the server, use  /  in the TSQL to handle the transaction locally
p71488
aVNote, though, that TSQL exception/error handling is not as rich as handling errors at a caller such as java/C#
p71489
aVIf the problem is that you want to disassociate this work from another unrelated transaction, then it depends on how your calling code works:
p71490
aVif it is using connection-level transactions, then you will need to use a separate connection; just run the transaction on a different connection using the java/C#/whatever transaction API (i
p71491
ag50
aVthe same as your existing code, by the sound of it, but on a different connection)
p71492
aVif it is using things like scope-based transactions ( in C#; not sure about java etc - but this is an LTM or DTC transaction) then you can explicitly create a new scope that is bound to either a new (isolated) transaction, or the nil-transaction (i
p71493
ag50
aVthe inner scope is not enlisted)
p71494
aVAs for affecting the tables
p71495
aVSQL Server generally does optimistic changes, i
p71496
ag50
aVyes the changes are applied immediately (so that commit is cheap, and rollback is more expensive) - however, the isolation level will generally prevent other SPIDs from seeing the data
p71497
aVA competing SPID with a low isolation level (or using the  hint) will see the uncommitted data, but this may be a phantom/non-repeatable read if the data eventually gets rolled back
p71498
as(dp71499
g18
V23354
p71500
stp71501
a((dp71502
g2
(lp71503
VIf you process the configuration manually (perhaps not even in the app
p71504
aVconfig file), then you can periodically check that file for updates
p71505
aVis
p71506
aVprobably overkill, and isn't guaranteed in all scenarios
p71507
aVPersonally, I'd just poll the file every (say) 30 seconds
p71508
as(dp71509
g18
V23354
p71510
stp71511
a((dp71512
g2
(lp71513
VAvoid using ; a range of null-safe implicit conversion operators are available:
p71514
as(dp71515
g18
V23354
p71516
stp71517
a((dp71518
g2
(lp71519
VIf it is the same assembly (dll), then the type is the same and no mismatch will occur
p71520
aVIf you have multiple versions of the same dll loading into the same AppDomain, then things are already horribly mixed up
p71521
aVAt this point, you can use forwarding via configuration; for example, the following forwards and MVC 1
p71522
aV*/2
p71523
aV* references to MVC 3
p71524
ag190
aVBut I stress: the above is usually not needed, especially if you are shipping your dlls next to the application (rather than using the GAC)
p71525
as(dp71526
g18
V23354
p71527
stp71528
a((dp71529
g2
(lp71530
VYou can't data-bind to a  member, and you can't data-bind to a field (unless you use a custom binding-model); one option would be to have some contextual instance that you can data-bind too, for example:
p71531
aVThen make it possible to pass a  instance to your form, and data-bind:
p71532
aVYou could of course have a  instance of the , but again : that isn't a great design;  often means you're taking a hacky short cut
p71533
as(dp71534
g18
V23354
p71535
stp71536
a((dp71537
g2
(lp71538
VThat is an instance field that is initialized to a new instance; encapsulation of a  would be my description
p71539
aVIf you were re-exposing an interface common to both types, then, it might be decoration
p71540
aVOf course, with no methods, a private field can't do a lot ;p
p71541
aVSo to clarify:
p71542
aVis a field ( and per-instance, in this case) of type
p71543
aVis a new object of type
p71544
aVthe reference to the new object is then assigned to  during construction; field initializers (to use the name of this assignment) typically happen before any custom constructors are invoked
p71545
as(dp71546
g18
V23354
p71547
stp71548
a((dp71549
g2
(lp71550
VThe problem here is that all your callers are using a different mutex; you need the locking object to be shared, usually by making it a field
p71551
aVFor example, and switching to a simpler  metaphor:
p71552
aVor using the mutex:
p71553
as(dp71554
g18
V23354
p71555
stp71556
a((dp71557
g2
(lp71558
VSince the error happens after you click OK, I expect that  is , due to the failing constructor
p71559
aVAlso, you shouldn't assume that  means "Some of the entries for this transaction are empty so kindly complete them", and allowing a constructor to succeed when it has clearly failed to fully initialize an object is very dangerous
p71560
aVIn fact, only the UI should be doing message-boxes anyway
p71561
aVI would rewrite such that it throws a known exception after checking the transactions (i
p71562
ag50
aVthe scenario you expect to be a problem)
p71563
aVLet the UI catch that exception and do the message box there
p71564
as(dp71565
g18
V23354
p71566
stp71567
a((dp71568
g2
(lp71569
VEach field header takes 1 byte (for low field numbers; more for large field numbers), and each bool takes 1 byte
p71570
aVThere is no sub-byte packing in protobuf; things are rounded up to the nearest byte
p71571
aV1 option would be to store an unsigned integer map - I
p71572
ag50
aVTreat each bool as a power of two and add them up (bitwise)
p71573
aVThen you need one byte header and one byte data, so 2 bytes for both
p71574
aVYou will, however, have to pack/unpack the integer yourself
p71575
aVAssuming you have a low field number, up to 7 bools is then 1 byte data plus 1 byte header
p71576
aVSince "varint" uses base-128 encoding (the msb is continuation), an 8th bool (up to 14 bools) would take 2 bytes data plus 1 byte header
p71577
as(dp71578
g18
V23354
p71579
stp71580
a((dp71581
g2
(lp71582
VNot in c#, no
p71583
aVHowever most serializers allow you to customise this - often via attributes
p71584
aVIIRC with JSON
p71585
aVNET you want  to specify the name
p71586
aVHowever you can't use attributes on anonymous types, so you may need to define a class with the properties (and attributes) the you desire
p71587
as(dp71588
g18
V23354
p71589
stp71590
a((dp71591
g2
(lp71592
VIf the code must be safe, and you don't want to use a larger type and "shift", them you'll have to iterate each byte
p71593
aV(edit) If the data is sufficiently sparse, you could use a dictionary to store the non-zero values; then finding the non-zeros is trivial (and enormous by sparse arrays become cheap)
p71594
as(dp71595
g18
V23354
p71596
stp71597
a((dp71598
g2
(lp71599
Vby itself, it doesn't
p71600
aVBut add any ORM or similar, and you start to get closer
p71601
aVfor example, LINQ-to-SQL (which I mention because it is easy to get working with Visual Studio), you typically get (given to you by the tooling) a custom "data context" class, which you use as:
p71602
aVThis is generating TSQL and mapping the data to objects automatically
p71603
aVBy default the tooling creates a separate Employee class, but you can tweak this via partial classes
p71604
aVThis also supports inserts, data changes and deletion
p71605
aVThere are also tools that allow re-use of your existing domain objects; either approach can be successful - each has advantages and disadvantages
p71606
aVIf you only want to read data, then it is even easier; a micro-ORM such as dapper-dot-net allows you to use our type with TSQL that you write, with it handling the tedious materialisation code
p71607
as(dp71608
g18
V23354
p71609
stp71610
a((dp71611
g2
(lp71612
V is not usable in the fashion described (and note that  only really applies to )
p71613
aVYour best bet is to transport the  and load at each end, but note that you will need the declaring assembly at each end for this to work
p71614
aVUltimately the objective of sending a  between platforms doesn't really make much sense, I'm adraid
p71615
aVIf you could be more specific a out what you want to accomplish maybe we can suggest a better plan
p71616
as(dp71617
g18
V23354
p71618
stp71619
a((dp71620
g2
(lp71621
VAssuming you don't want the caller to pass them in separately, the  arg is IMO fine; the only change I'd make is that I'd consider passing in a start offset too (since I often find myself working away from the start of a  - but it depends on your context)
p71622
aVIf you really want to avoid this ugliness, you could consider treating it as a  (or arguably better (because of right-shift of negatives) for bit-work: )
p71623
aVYou always know that is exactly 8 bytes in length, and it avoids a few lookups to boot
p71624
aVYou can switch between the two formats either by shifting or by unsafe cast of a  and
p71625
as(dp71626
g18
V23354
p71627
stp71628
a((dp71629
g2
(lp71630
VCLS compliance is, in truth, rarely needed
p71631
aVIf having this warning/error is a show-stopper, then for now turn off CLS
p71632
aVFrom what I can pick out of the error (presumably translated), it sounds like a conflict in case; the following is not CLS compliant, for example:
p71633
aVfor the reason that case-insensitive languages (VB
p71634
aVNET etc) can't use it reliably
p71635
aVSo check your WSDL and generated code for anything that differs only by case
p71636
aVA better approach, though, is to move away from
p71637
aVNET 1
p71638
aV1; Visual Studio 2003 is by virtually any measure obsolete
p71639
aVLater frameworks and tool fix a wide range of bugs (including security issues)
p71640
as(dp71641
g18
V23354
p71642
stp71643
a((dp71644
g2
(lp71645
VAt the Visual Studio command-prompt:
p71646
aVwhich should generate  with appropriate classes for a model that matches that schema
p71647
aVNote that it isn't 100% perfect - there are edge-cases that can confuse it
p71648
as(dp71649
g18
V23354
p71650
stp71651
a((dp71652
g2
(lp71653
VScenarios:
p71654
aVyou aren't using generics, but just -based code
p71655
aVyou are using generic, but the constructor takes parameters -  is limited to parameterless constructors
p71656
aVthere is a parameterless constructor, but it is not accessible (IIRC Activator will use private constructors if you ask)
p71657
aVBut yes, in your case the  constraint is ideal
p71658
as(dp71659
g18
V23354
p71660
stp71661
a((dp71662
g2
(lp71663
VIf you are using , changing to (or from) automatically implemented properties is a breaking change, since field names matter to BF
p71664
aVOf course, one easy fix there is: don't use BF
p71665
aVYou also can't add attributes to the backing field using automatic properties
p71666
aVNo field initialisers
p71667
aVNo true  for use with immutability
p71668
aVYou can't add logic, obviously; no laziness, validation, side-effects or notification events
p71669
aVWith structs, you need to call  on custom constructors, which is ugly
p71670
aVOtherwise though: they are great
p71671
aVI'm a big fan
p71672
as(dp71673
g18
V23354
p71674
stp71675
a((dp71676
g2
(lp71677
Vasp
p71678
aVnet runs at the server
p71679
aVI suspect you are running in cassini locally, so your server desktop and client desktop are the same thing
p71680
aVWhat you are doing is opening a command prompt at the server; which is an interesting DDOS attack surface if you think about it (i
p71681
ag50
aVdon't do that)
p71682
aVShort answer: you cannot do this
p71683
aVNo browser would (or should
p71684
aVI'll make allowances for IE ;p) allow this
p71685
aVThe client OS need not even support a command prompt, nor
p71686
aVNET; and even if it did, very few browsers will let you spawn a process
p71687
as(dp71688
g18
V23354
p71689
stp71690
a((dp71691
g2
(lp71692
VSome factors that impact performance:
p71693
aVis the serializer prepared
p71694
aVThis is automatic on the first use per-type; the first time through, it needs to do quite a bit of inspection etc to figure out how your model works
p71695
aVYou can offset this by calling  somewhere during startup
p71696
aVor as an alternative, in v2 (available as "alpha") you can pre-generate the serializer as a dll if you need the fastest possible cold-start performance
p71697
aVwhat is the transport
p71698
aVin particular with WCF, you need to keep in mind how your  is encoded (this isn't a problem on sockets, of course); for example, can the transport use MTOM
p71699
aVor is it base-64 encoding the
p71700
aVand note also that it is possible that  and  are handled differently; if you can measure the bandwidth, you might want to try both
p71701
aVbasic-http with MTOM enabled is my preference for WCF transports if absolute speed is your aim; or sockets if you want to get closer to the limit
p71702
as(dp71703
g18
V23354
p71704
stp71705
a((dp71706
g2
(lp71707
VThe first thing I'd try is Sam Saffron's CPU analyzer tool, which should give an indication if there is something common that is happening too much / too long
p71708
aVIn part because it doesn't involve any changes; just run it at the server
p71709
aVAfter that, there are various other debugging tools available; we've found that some very ghetto approaches can be insanely effective at seeing where time is spent (of course, it'll only work on the 10% of successful results)
p71710
aVYou can of course just open the server profiling tools and drag in various
p71711
aVNET / IIS counters, which may help you spot some things
p71712
aVBetween these three options, you should be covered for:
p71713
aVcode dropping into a black hole and never coming out (typically threading related)
p71714
aVcode running, but too slowly (typically data access related)
p71715
as(dp71716
g18
V23354
p71717
stp71718
a((dp71719
g2
(lp71720
VIf you mean about calling a method defined as per the example, then just (for example):
p71721
aVAn  parameter cannot be optional (which means it must appear before the optional ones), but can be specified anywhere (as a named argument) - for example:
p71722
aVIf you want  to be optional, you would need an overload:
p71723
aVNow you can call:
p71724
as(dp71725
g18
V23354
p71726
stp71727
a((dp71728
g2
(lp71729
V(from the question)
p71730
aVNow, is there a way to bind the
p71731
aVDispose() call to garbage collector
p71732
aVactions, because I want these objects
p71733
aVdisposed right in the moment they are
p71734
aVno longer accessible from other code
p71735
aVparts
p71736
aVGC doesn't happen immediately when your object goes out of scope / reach; it is non-deterministic
p71737
aVBy the time GC sees it, there is no point doing anything else (that isn't already handled by the finalizer), as it is too late
p71738
aVThe trick, then, is to know when you are done with it, and call  yourself
p71739
aVIn many cases  achieves this
p71740
aVFor example you could write a class that implements  and encapsulates a set of s - and wrap your use of that encapsulating object with
p71741
aVThe  on the wrapper could  all the images held
p71742
ag412
ag50
aVhowever, this is a bit trickier if you are displaying the data on the UI
p71743
aVThere is no shortcut there; you will have to track when you are done with each image, or accept non-deterministic finalization
p71744
as(dp71745
g18
V23354
p71746
stp71747
a((dp71748
g2
(lp71749
V1: yes they are necessary; both enqueue and dequeue mutate state; a standard queue is not thread safe
p71750
aV2:  would work nicely; personally I use a version I wrote here on SO, Creating a blocking Queue in
p71751
aVNET
p71752
aV- it makes it easy to throttle the size of the queue, and do efficient dequeues without looping
p71753
aVNote; with your current implementation the lock-object should only be static if the queue is static  (that isn't clear in the question, though) - otherwise all your similar queues may be sharing a lock
p71754
as(dp71755
g18
V23354
p71756
stp71757
a((dp71758
g2
(lp71759
VI do not know that is guaranteed, and with the lack of a documented guarantee I would not personally rely on it
p71760
aVIn particular:
p71761
aVanything that implements  (i
p71762
ag50
aVcustom serialization) can do whatever it wants
p71763
aVanything involving something like a dictionary may be unreliable - simply because there is no defined ordering inside a dictionary, and it may depend on the spare space in the original vs reconstituted, etc
p71764
aVthere may be subtle compatible but not identical changes between platforms, revisions etc
p71765
aVHowever, if you are talking about binary equivalence, I deduce you are talking about storage of  data, and subsequent comparison at a later date
p71766
aVAllow me to stress: IMO,  is not suitable for storage; it is OK (ish) for transport of data between running systems that share a platform and application version, but the sheer number of times I've seen people stuck in a hole due to version differences and  is overwhelming
p71767
aVIt is for these reasons that I got interested in protobuf, and wrote my own serializer that would be suitable for storage and rehydration against existing object models that make have "versioned" in the interim
p71768
as(dp71769
g18
V23354
p71770
stp71771
a((dp71772
g2
(lp71773
VYou have created a new orphan node (i
p71774
ag50
aVnot yet in the tree), without any descendants
p71775
aVIt is reasonable that your queries relative to that orphan don't find anything
p71776
aVTo find existing nodes, look at ,  and
p71777
as(dp71778
g18
V23354
p71779
stp71780
a((dp71781
g2
(lp71782
VYes, using the  option will mean that "do the real logging" happens outside of the transaction context
p71783
aVBut it depends a little bit on what you are logging and why; one other approach is to throw all your logging data onto a producer/consumer queue (i
p71784
ag50
aVa thread-safe queue serviced by a separate thread)
p71785
aVBecause  is thread-bound this removes your transaction association, but it also has the advantage of removing the logging as a factor (latency etc) in the operation itself, and allows you to batch up the logging operations if you choose
p71786
aVObviously this would only apply to informational logging, as there is a chance (in edge cases) that a small amount of data from the queue will be lost during recycles etc
p71787
aVThe producer/consumer approach is particularly enticing if you are logging to a file, as it allows you to synchronize access to the file (which is obviously necessary), without the need to block on the IO itself (you are only synchronizing access to the queue)
p71788
as(dp71789
g18
V23354
p71790
stp71791
a((dp71792
g2
(lp71793
VI would guess:
p71794
aV(note the different quotes;  is a quoted identifier;  is a string literal)
p71795
aVAlso, in most SQL dialects, a  without a wildcard is equivalent to ; did you mean to include a wildcard
p71796
as(dp71797
g18
V23354
p71798
stp71799
a((dp71800
g2
(lp71801
VSince your list is , I'm assuming you have something like:
p71802
aVor whatever; here  the variable is typed as
p71803
aVOperator resolution happens during build via static analysis (not at runtime via polymorphism/RTTI), so the only  available is the default for any , i
p71804
ag50
aVreference equality
p71805
aVTo support your custom operator, the variables must be typed accordingly, for example:
p71806
aVYour cast achieves a similar thing
p71807
aVAnother option would be to make sure that  and  (and ) are in agreement, and use:
p71808
aVwhich will do  checks and then use your overridden  method
p71809
aVThis then supports polymorphism, so it doesn't matter what the types are
p71810
as(dp71811
g18
V23354
p71812
stp71813
a((dp71814
g2
(lp71815
VThat would possibly work if it knew that , doing a reference comparison
p71816
aVOperators generally have very little support with generics, but there are workarounds
p71817
aVMiscUtil offers indirect support for operators on generics, otherwise  is a good choice
p71818
as(dp71819
g18
V23354
p71820
stp71821
a((dp71822
g2
(lp71823
VIn v1 you can't, unless it happens to have xmlaerializer or datacontractserializer attributes
p71824
aVWell, that isn't quite true
p71825
aVThere is a GlobalOptions toggle that should work in theory, but is not very tolerant if the type changes, as it is inferring a lot
p71826
aVThe better option here is to look at "v2", which is available as an alpha download
p71827
aVYour attributed types should be fine, but you can also tell the type-model how to handle unattributed types; this is all via RuntimeTypeModel
p71828
as(dp71829
g18
V23354
p71830
stp71831
a((dp71832
g2
(lp71833
VWhen you add a web-reference you are transporting data (i
p71834
ag50
aVthe data's shape), not implementation
p71835
aVIn particular, the serializer layer is looking for public read/write members (mainly properties) that it should represent at the other end
p71836
aVYour properties are read-only, so there is no way it can reconstruct (deserialize) your object; it skips those properties
p71837
aVLikewise, a custom constructor is implementation, not data - it only really wants a public parameterless constructor
p71838
aVIf you want to share implementation, WCF can do that with assembly sharing (you use the same DTO assembly at both ends, or identicial type definitions)
p71839
aVAdditionally the default WCF serializer (DataContractSerializer) is happy with private accessors, so it would be happy if you added a private  (and told it what to serialize via DataContractAttribute/DataMemberAttribute)
p71840
as(dp71841
g18
V23354
p71842
stp71843
a((dp71844
g2
(lp71845
VIt isn't clear what cache you are using, but I'll make the assumption that this is the asp
p71846
aVnet cache, using default configuration (the same ideas will hold for other in-process caches)
p71847
aVIf so, this is a reference-preserving cache
p71848
aVWhy you put in is the same object that you get back out
p71849
aVThis means that if you mutate the cached state, otter callers will see the change; or it could even explode due to cross-threading
p71850
aVGuidance:
p71851
aVno not mutate anything you have from cache; make a copy if you need
p71852
aVPerhaps even make the cached data immutable
p71853
aVor; use a serialising cache (which gives you a clone each time)
p71854
as(dp71855
g18
V23354
p71856
stp71857
a((dp71858
g2
(lp71859
VYou could start by narrowing it down within
p71860
aVEnabling build symbols for that dll would be a start, but even some simple tracing so that you can tell where it got to when it exploded would help
p71861
aVUltimately  isn't core
p71862
aVNET, so you will have to help us narrow it down
p71863
aVOr even simpler: hit "Start Debugging", and put a break-point on that method; now step through and see a: where it explodes, and b: what the key values are at that point
p71864
as(dp71865
g18
V23354
p71866
stp71867
a((dp71868
g2
(lp71869
VUse a user-setting instead (via a  file)
p71870
aVWhen your app loads, check the setting; if it is missing/blank display a dialog to enter the server name (etc), and use  to form that into a connection-string
p71871
aVNow store that as the setting and save (it should now reappear next time they load)
p71872
aVYou might also want to make that available via an options menu somewhere
p71873
as(dp71874
g18
V23354
p71875
stp71876
a((dp71877
g2
(lp71878
VMultiple calls to  is pretty inefficient
p71879
aVJust switch to  - it should fix  returning , be more efficient, and simpler
p71880
aVAlso, why not just:
p71881
aVIf you are using lots of , you're probably missing a trick
p71882
aVin particular, you stand a good chance of opening xss holes if you use too much
p71883
as(dp71884
g18
V23354
p71885
stp71886
a((dp71887
g2
(lp71888
s(dp71889
g18
V23354
p71890
stp71891
a((dp71892
g2
(lp71893
VAn expression tree allows you to express your code in regular C#, but to deconstruct that, inspect it, and interpret it
p71894
aVFor example, you might interpret it by writing an equivalent TSQL string (example: LINQ-to-SQL or Entity Framework), or a web-service query (astoria)
p71895
aVYou might interpret it as an RPC call (I've written an expression-based RPC layer)
p71896
aVTo repeat my "Explaining Expression" blog entry:
p71897
aVThe delegate
p71898
aVversion () is the
p71899
aVbeligerant manager; "I need you to
p71900
aVgive me a way to get from 2 integers
p71901
aVto a bool; I don't care how - when I'm
p71902
aVready, I'll ask you - and you can tell
p71903
aVme the answer"
p71904
aVThe expression version
p71905
aV() is the
p71906
aVdutiful analyst; "I need you to
p71907
aVexplain to me - if I gave you 2
p71908
aVintegers, how would you go about
p71909
aVgiving me a bool
p71910
aVIf you have the expression, you can either call  to form a delegate (to do it exactly as explained), or you can unpick it and do something similar based on what steps they took
p71911
aVAnother view on  is that it can act as a simplified version of  - but still be pretty versatile
p71912
aVVery useful  for meta-programming
p71913
aVHere's an article exploring that approach
p71914
as(dp71915
g18
V23354
p71916
stp71917
a((dp71918
g2
(lp71919
V just runs arbitrary SQL (after applying -esque parameterization) and then materializes the  results as a sequence of objects
p71920
aVNote that the mappings between mapped types and the db-columns/type-members is well defined by the data-context (usually via attributes on the members, but not always), but IIRC  does not apply these mapping (I'm happy to be corrected here)
p71921
aVYou can inspect this via
p71922
aVThe fundamentals here are no different to if you executed
p71923
aVexcept the  version can apply more mappings etc
p71924
aVThe materialization itself (i
p71925
ag50
aVcreating the object and setting members) is an example of reflection and meta-programming; most ORMs and micro-ORMs will work pretty much the same there: inspect the type ( above) and inspect the fields in the reader - and then build some code on-the-fly (usually cached) that will create the new objects and set the members
p71926
as(dp71927
g18
V23354
p71928
stp71929
a((dp71930
g2
(lp71931
VThere are two approaches you might take there; the first is to have:
p71932
aVand use
p71933
aVbut you may want to think about synchronization etc around the subscription
p71934
aVA second approach is to create a wrapper class that has the event - then you can use the compiler's synchronization, which is good in C# 4
p71935
aV0:
p71936
aVand then expose those perhaps via an indexer, so you have
p71937
aVPersonally, I expect the first is easier
p71938
aVIt is only the synchronization that might be a nuisance
p71939
aVI do this in some pub-sub code, and IIRC I just  during the subscribe
p71940
as(dp71941
g18
V23354
p71942
stp71943
a((dp71944
g2
(lp71945
Vthis is the only example I could find in a bit of googling, but it looks promising
p71946
as(dp71947
g18
V23354
p71948
stp71949
a((dp71950
g2
(lp71951
VNote the above uses a
p71952
aVNET 4
p71953
aV0 feature; in previous versions replace  with )
p71954
aVAlso, replace  with your preferred way of reading xml files - perhaps ,  or an
p71955
as(dp71956
g18
V23354
p71957
stp71958
a((dp71959
g2
(lp71960
VPersonally I think xslt is still your best bet here; it really is very versatile for XML transforms
p71961
aVIf your data is object-based, you could see whether XmlAttributeOverrides (which you can feed to XmlSerializer) does what you need; it allows XML maps that are unrelated to the code attributes, and thus allows parallel maps for the same model - but it is not as rich as an xslt sweep; and you need to be careful to cache and reuse any XmlSerializer instances created using XmlAttrributeOverrides, or it will leak uncollectable dynamic assemblies
p71962
as(dp71963
g18
V23354
p71964
stp71965
a((dp71966
g2
(lp71967
VRe "as they arrive", the simplest thing there is to build a (thread-safe) queue of pending items at the back-end, I
p71968
ag50
aVNew results go in the queue - and have your JSON query poll every few seconds for new data in the queue (for that session)
p71969
aVRe performance; just profile it and attack the bits that the profile shows is hurting
p71970
aVPre-loading the XML into some indexed structure (maybe even a database) would be my main guess
p71971
as(dp71972
g18
V23354
p71973
stp71974
a((dp71975
g2
(lp71976
VLINQ is only going to hide the loop in prettier code; it won't make it faster
p71977
aVThe real slowness in that loop is the reflection
p71978
aVIf the caller could express the field at compile-time, that would help (and no need for your method, really):
p71979
aVHowever, if the caller only knows the field name, you could do something similar with meta-programming
p71980
aVA reasonable starter might be:
p71981
aVexample usage:
p71982
aVfor maximum performance, you'd want to cache the compiled lambdas per-type
p71983
as(dp71984
g18
V23354
p71985
stp71986
a((dp71987
g2
(lp71988
VAssuming this is even remotely a programming question, you could try a HTTP HEAD query (ideally sending a If-Modified-Since header in your request), and inspect the response headers - if the server is friendly, it'll tell you whether it hasn't been updated via a 304 response code
p71989
aVIf you don't get a 304, then issue a GET request and save the response stream
p71990
aVYou could also just try issuing a GET with last-modified (skipping the HEAD); but a HEAD request might save some bandwidth if the server isn't entirely happy with just a GET / 304
p71991
aVNot tested extensively, but:
p71992
as(dp71993
g18
V23354
p71994
stp71995
a((dp71996
g2
(lp71997
VA lot of things are not fully defined in the spec, or are implementation-specific extensions
p71998
aVExamples of not-fully-specified:
p71999
aVthe synchronisation semantics of field-like events; this is explicitly open to implementations in the ecma spec; it is stricty defined in the MS spec, but uses a different version in c# 4
p72000
aV0 which does not yet appear in the formal spec, IIRC
p72001
aVconstruction (from lambdas); is simply "defined elsewhere" (actually, it isn't)
p72002
aVExamples of implementation extensions:
p72003
aVP/Invoke
p72004
aVCOM interface handling (i
p72005
ag50
aVhow you can call  on an interface)
p72006
aVSo no: it is not guarantees to have the same IL, either between csc or [g]mcs - but even between different versions of csc
p72007
aVEven more: depending on debug settings, optimizations being enabled or not, and some compilation constants being defined (such as DEBUG or TRACE), the same compiler will generate different code
p72008
as(dp72009
g18
V23354
p72010
stp72011
a((dp72012
g2
(lp72013
VTo implement a custom scheme is probably going to require installation/registration at the OS level, for example in the registry for windows (allow user-level may suffice)
p72014
aVFor the sake of simplicity, http would probably the sensible default unless you really, really need something custom
p72015
aVMSDN discusses this for windows here: http://msdn
p72016
aVmicrosoft
p72017
aVcom/en-us/library/aa767914(v=vs
p72018
aV85)
p72019
aVaspx
p72020
as(dp72021
g18
V23354
p72022
stp72023
a((dp72024
g2
(lp72025
VSpeaking as someone who is rather familiar with protobuf-net, I honestly haven't tried that approach, but glancing at that blog entry it looks encouraging
p72026
aVIf it works, I'd be happy to add support to the core library (at least, the 3
p72027
aV0 version)
p72028
aVI realise this isn't really an answer, but I can't see a reason why it shouldn't, given thaw it works for BSON
p72029
as(dp72030
g18
V23354
p72031
stp72032
a((dp72033
g2
(lp72034
VFor that to work for arbitrary , you had two choices:
p72035
aVadd a  constraint, where  is either a base-class or (more likely and more versatile) an interface that declares the properties you need
p72036
aVswitch to using  (or reflection before 4
p72037
aV0) to access the properties
p72038
aVThe first gives you compile-time safety, but requires some commonality between the ; the second demands no commonality, but is entirely runtime - no static-analysis checking
p72039
aVFor example:
p72040
aVAnd add  to the method signature (between te closing  of the parameters and te opening  of the method body)
p72041
as(dp72042
g18
V23354
p72043
stp72044
a((dp72045
g2
(lp72046
V members are entirely specific to the declaring class; subclasses do not get separate copies
p72047
aVThe only exception here is generics; if an open generic type declares static fields, the field is specific to that exact combination of type arguments that make up the closed generic type; i
p72048
ag50
aVwould have separate static fields to , assuming the fields are defined on
p72049
as(dp72050
g18
V23354
p72051
stp72052
a((dp72053
g2
(lp72054
VIf it does what you need
p72055
aVstop tinkering ;p If you want feedback:
p72056
aVno need for that cursor; a set-based  should suffice; anytime you find yourself writing  a cursor it is probably wrong
p72057
aVeither join to a mapping table (between SQL types and C# types), or use  to pick inline
p72058
aVyou might want to be paranoid about reserved words, for example  - in C# you'd need to use  for that (or avoid it)
p72059
aVyou might want to remove spaces; you can call a db column , but that won't work in C#
p72060
aVyou could check the extended metadata for an  value, and write that into (one of, or perhaps both) the  or
p72061
as(dp72062
g18
V23354
p72063
stp72064
a((dp72065
g2
(lp72066
VI'm assuming you want to encapsulate the , so that the caller only needs to know about ; in which case, you still need to access  explicitly, as that is where the per-thread magic happens:
p72067
as(dp72068
g18
V23354
p72069
stp72070
a((dp72071
g2
(lp72072
VAt no point do you load the original file, so you are replacing it entirely, without any of the old data
p72073
aVLook at
p72074
aVAlso, you haven't closed the , and to be honest just  is easier
p72075
as(dp72076
g18
V23354
p72077
stp72078
a((dp72079
g2
(lp72080
VSince you mention  and overflow, I assume the problem is an index range; most
p72081
aVNET indexers are 0-based, so you need:
p72082
aVNote also that in most cases  is simpler and safer:
p72083
as(dp72084
g18
V23354
p72085
stp72086
a((dp72087
g2
(lp72088
VUsing any object/value as a key is not as trivial as it sounds, as it depends on a correct implementation of Equals and GetHashCode
p72089
aVTo be honest, the "subclass distorting things" scenario is not one I've hugely encountered, however a more common use of this API is to allow usage when the type you are using as the key doesn't provide a suitable Equals/GetHashCode, and is outside of your control
p72090
aVFor example, you want to use  as a key, but you only want to match on the  (i
p72091
ag50
aVyou don't want the default reference equality behaviour; maybe you are handling different objects from different sources, and need different instances to be considered equal based on the )
p72092
aVIn this scenario you could write a custom equality comparer that considers only the
p72093
aVPersonally, though; I'm a fan of simple
p72094
aVI very rarely (if ever) index on anything except , , etc
p72095
aVThis keeps things simple - and at the same time shows another common scenario: providing a case-sensitive/insensitive or culture-sensitive/insensitive comparer for a  key
p72096
as(dp72097
g18
V23354
p72098
stp72099
a((dp72100
g2
(lp72101
VOr
p72102
as(dp72103
g18
V23354
p72104
stp72105
a((dp72106
g2
(lp72107
VFor XHTML, load it into XmlDocument or XDoxument
p72108
aVFor (non-X)HTML, load it into the HTML Agility Pack's HtmlDocument - the API is almost the same as XmlDocument, so it should be familiar
p72109
as(dp72110
g18
V23354
p72111
stp72112
a((dp72113
g2
(lp72114
VChanging the name is fine; you just need the right attributes
p72115
aVYou don't show the XML, but it looks like you just need
p72116
aVIf the type is outside your control, you can use  to re-educate  - but if you do that you must cache and re-use the serializer instance (or you will leak memory)
p72117
as(dp72118
g18
V23354
p72119
stp72120
a((dp72121
g2
(lp72122
VFor the version:
p72123
aV(where  can be replaced with any type from the assembly you are interested in)
p72124
aVFor the architecture:
p72125
aVIf you want the ClickOnce deployment version, that is obtainable - but separately (and needs a reference to ):
p72126
as(dp72127
g18
V23354
p72128
stp72129
a((dp72130
g2
(lp72131
VI don't know about JSON
p72132
aVNET, but if you use  you can provide a custom serializer, but still use the inbuilt parsing / formatting etc:
p72133
as(dp72134
g18
V23354
p72135
stp72136
a((dp72137
g2
(lp72138
V is (from MSDN):
p72139
aVSupported in: 3
p72140
aV5 SP1, 3
p72141
aV0 SP1, 2
p72142
aV0 SP1
p72143
aVIt sounds like you are trying to run it on a machine without the necessary service pack
p72144
as(dp72145
g18
V23354
p72146
stp72147
a((dp72148
g2
(lp72149
VNGEN only helps JIT performance; now, you can try that, but given your scenario it sounds to me like you are throttled on IO performance
p72150
aVThe simplest "fix" I can suggest is: fit a faster disk (an SSD or something)
p72151
aVOf course, you aren't showing how exactly you are reading the files; I would suggest a  and , and only reading the data you actually want to display
p72152
as(dp72153
g18
V23354
p72154
stp72155
a((dp72156
g2
(lp72157
VThat is just endianness (-46 and 210 is because of Java's signed bytes, but that is just a UI thing)
p72158
aVEither reverse the array contents, or use shift operations to write the int
p72159
aVNote: the endianness that
p72160
aVNET emits depends on the platform
p72161
aVI would suggest using KNOWN ENDIANNESS in both cases; most likely by using shift operations from both
p72162
aVOr perhaps a better idea: just use a pre-canned, platform independent serialization format (for example: protocol buffers, which has good support on both Java and
p72163
aVNET/C#)
p72164
aVFor example; if I was writing an  to a  (starting at ), I might use:
p72165
aVthis is guaranteed little-endian, and similar code should work on any framework
p72166
as(dp72167
g18
V23354
p72168
stp72169
a((dp72170
g2
(lp72171
VThere are two ways of implementing an interface method; the first is implicit implementation - which assumes the public API is exposing the interface methods, and is what you are no-doubt seeing
p72172
aVHowever, you can also use explicit implementation:
p72173
aVis a trivial example; this is private, yet satisfies the interface
p72174
aVAn explicit implementation always takes precedence over a like-named method on the public API
p72175
aVIn fact, explicit implementation is often necessary, for example to implement  - since there are two conflicting  methods; the following is common:
p72176
aVSo: if you don't want public members; use explicit implementation
p72177
as(dp72178
g18
V23354
p72179
stp72180
a((dp72181
g2
(lp72182
VYes, any type
p72183
aVIt it the number of items to reserve space for on the stack
p72184
aVThis is more for verification than for space, as far as I can tell - because as you note different types require different amounts of space (oversized structs, for example)
p72185
aV1 may be a bit low in most cases, though
p72186
as(dp72187
g18
V23354
p72188
stp72189
a((dp72190
g2
(lp72191
VThe list is never assigned; this should work:
p72192
aV(and access , i
p72193
ag50
ag38293
as(dp72194
g18
V23354
p72195
stp72196
a((dp72197
g2
(lp72198
V is the syntax for an attribute - additional metadata about some type or member (or even the assembly itself; or indeed parameters)
p72199
aVYou can write your own attributes, for example that one is something like:
p72200
aVthe name  is inferred, so only  is needed
p72201
aVThe string  is used as a constructor argument, and also you can use property assignments, for example:
p72202
aVlooks for a type  or , with a constructor that takes an  and a , and has a property  that can be assigned an
p72203
aVMost attributes don't do anything directly, but you can write code that inspects types for attributes (via reflection), which is a very convenient way of library code knowing how to work with a type
p72204
aVFor example:
p72205
aVthis reconfigures  (which checks for the above attributes) to serialize the type as:
p72206
aVwhere without the attributes it would be:
p72207
as(dp72208
g18
V23354
p72209
stp72210
a((dp72211
g2
(lp72212
VSince yoy have the [xml] tag, you would want (at the parent level):
p72213
aVhowever, you can't control this at the type level
p72214
aVThe type exposing the member has to define it
p72215
aVAn alternative is to use  when creating the
p72216
aVNote that  makes no impact on xml serialization; you would need , which is (IMO) a pain to implement robustly
p72217
as(dp72218
g18
V23354
p72219
stp72220
a((dp72221
g2
(lp72222
V /  are not necessarily the right tools for writing to an arbitrary stream; in particular, they choose a specific way of encoding strings, with a length-prefix
p72223
aVIf this is not what your remote device is expecting, it will fail
p72224
aVI would just use the  directly, with  and
p72225
aVIn particular,  is 123 in ASCII, so it looks  is incorrectly taking the "length" from the opening JSON brace
p72226
as(dp72227
g18
V23354
p72228
stp72229
a((dp72230
g2
(lp72231
VIt can only be covariant if it only has a  indexer, i
p72232
ag50
aVBut all main collections have , which makes that awkward
p72233
aVI'm not aware of any that would suffice there, but you could wrap it, i
p72234
ag50
aVwrite an extension method:
p72235
aVwhich is a wrapper around an  that only exposes the  and the  indexer
p72236
aVshould be only a few minutes work
p72237
as(dp72238
g18
V23354
p72239
stp72240
a((dp72241
g2
(lp72242
VWe had a similar scenario with a redis client, and originally our solution was to have a common single instance that we synchronised access to via
p72243
aVThis was fine, but to avoid the latency and blocking we eventually wrote a thread-safe pipelined client, which allows concurrent use without any blocking
p72244
aVI don't know as much about the men ached protocol, but I wonder if something similar could apply here
p72245
aVI'm actualy tempted to try investigating to see if I could add this to BookSleeve (our custom OSS redis client) if you can wait a little while
p72246
aVBut we were generally able to keep up just using a synchronised shared instance (pretty much the same thing as a singleton, depending on how purist you are)
p72247
aVGlancing at the FAQ, pipeline is indeed a possibility; and I'm entirely open to the option of writing an async/pipelined memcached client inside booksleeve
p72248
aVMost of the raw IO / multiplexing would be pretty common with redis
p72249
aVThe other tricks you can consider is using get_multi etc rather than separate gets where possible - I don't know whether your current client supports this, though (IK haven't looked)
p72250
aVBut: I don't know how it contrasts memcached to redis, but in our case, switching to a pipelined/multiplexed API meant we didn't need to use much pooling (many connections) - a single connection (properly pipelined) is capable of supporting lots of concurrent usage from a single node
p72251
as(dp72252
g18
V23354
p72253
stp72254
a((dp72255
g2
(lp72256
VCan you infer the zeros
p72257
ag412
ag50
aVcan we just say that anything not listed is zero
p72258
aVif so:
p72259
aVWith output:
p72260
as(dp72261
g18
V23354
p72262
stp72263
a((dp72264
g2
(lp72265
VFollowing the discussion in the comments
p72266
aVIn my experience (and I've done lots of serialization/WCF work) the performance "benefit" of NetTcpBinding (and NetDataContractSerializer) is largely mythical
p72267
aVI have never seen a significant difference - and often vanilla http bindings are faster
p72268
aVI would switch to BasicHttpBinding over SSL which is trivial to setup and is secure
p72269
aVIf you want improved performance etc, I would switch serializer to something like protobuf-net (disclosure: I'm the author)
p72270
aVThis does have easily demonstrated performance advantages, and works nicely inside WCF (just a change to a config file), especially over BasicHttpBinding (with an extra boost if you enable MTOM message-encoding, since it is a binary format)
p72271
aVPersonally, I never use NetTcpBinding; as mentioned, the performance is questionable, and it gets you dependent on things that won't work in basic-http if you find you need WAN access
p72272
as(dp72273
g18
V23354
p72274
stp72275
a((dp72276
g2
(lp72277
VIMO you should use a top-level object, I
p72278
ag50
aVWhich should serialize as a "whatever" element with multiple "Person" sub-elements
p72279
as(dp72280
g18
V23354
p72281
stp72282
a((dp72283
g2
(lp72284
VThe error here is changing the lock object
p72285
aVTo Pulse[All] you must have the lock
p72286
aVIt looks like you have a lock, but if you look carefully you reassign  in the code, so that is a different object
p72287
aVFor this reason, lock objects are commonly  fields
p72288
aVAlso, locking on a boxed value-type or a string is generally a bad idea; the most appropriate lock object is:
p72289
aV(can additionally be  if needed)
p72290
aVBeing a private instance avoids unexpected lock conflicts; beig readonly avoids accidental reassignment
p72291
as(dp72292
g18
V23354
p72293
stp72294
a((dp72295
g2
(lp72296
VYou mention protocol buffers (protobuf); this is a binary format, but has no direct relationship to XML
p72297
aVIn partiular, no member-names (element names / attribute names / namespaces) are encoded - it is just the data (with numeric markers for identifiers)
p72298
aVAs such, you cannot reconstruct arbitrary XML from a protobuf stream unless you already know how to map "field 3" etc
p72299
aVHowever
p72300
aVIf you have an object-model that works with both XML and protobuf, the transform is trivial; deserialize with either - serialize with either
p72301
aVHow well this works depends on the implementation; for example, it is trivial with protobuf-net and is actually how I do the codegen (load the binary; write as XML; run the XML through an xslt layer to emit code)
p72302
aVIf you actually just want to transfer object data (and XML is just a proposed implementation detail), then I thoroughly recommend protobuf; platform independent, a wide range of implementations, version-tolerant, very small output, and very fast processing at both read and write
p72303
as(dp72304
g18
V23354
p72305
stp72306
a((dp72307
g2
(lp72308
VSilverlight has a harsher reflection security model, and does not support the usual tricks used to bypass this
p72309
aVAFAIK, you are limited to public members
p72310
aVYou could of course make the object self-serializing, perhaps via a custom interface and code-generation into a partial class (to avoid manual implementation)
p72311
aVHowever, IMO a better approach here is to create a secondary DTO class model; that is mutable and which has public properties with  and
p72312
aVMost serializers will be happy with that, and you can always provide a conversion operator between your DTO model and your primary object model
p72313
as(dp72314
g18
V23354
p72315
stp72316
a((dp72317
g2
(lp72318
Vwould be my offering; there is an annoying glitch that the SUM in SQL over 0 rows is , not  - the above works around that
p72319
aVor as lambdas (from comments):
p72320
as(dp72321
g18
V23354
p72322
stp72323
a((dp72324
g2
(lp72325
VThe definition of the shift operators means that only the 5 least significant bits are used for 32-bit numbers and only the first 6 bits for 64-bit; meaning:
p72326
aVis identical to
p72327
aV(both are )
p72328
aVBy making it:
p72329
aVyou make it a 64-bit number, which is why @leppie's fix works; otherwise the  is considered first (and note that  is identical to , i
p72330
ag50
aV), and then the resulting  is converted to a ; so it is still
p72331
aVFrom 14
p72332
aV8 in the ECMA spec:
p72333
aVFor the predefined operators, the number of bits to shift is computed as follows:
p72334
aVWhen the type of x is  or , the shift count is given by the low-order five bits of count
p72335
aVIn other words, the shift count is computed from
p72336
aVWhen the type of x is  or , the shift count is given by the low-order six bits of count
p72337
aVIn other words, the shift count is computed from
p72338
aVIf the resulting shift count is zero, the shift operators simply return the value of x
p72339
aVShift operations never cause overflows and produce the same results in checked and unchecked context
p72340
as(dp72341
g18
V23354
p72342
stp72343
a((dp72344
g2
(lp72345
VIf the array is of known dimension, for example , then actually pretty simply (since you can already  over a multi-dimensional array; but note that  doesn't itself implement  - since that isn't technically a requirement for ):
p72346
as(dp72347
g18
V23354
p72348
stp72349
a((dp72350
g2
(lp72351
VWhen using  (which includes this session-state provider), all types in the graph must be serializable via  or
p72352
aVThe most common "gotcha" here is events
p72353
aVNormally you might add:
p72354
aVto any field-like event declarations, i
p72355
ag50
aVbut obviously this is not convenient in generated code
p72356
aVIMO, the real problem here is using rich objects in state
p72357
aVSession-state and cache objects should really be bare-bones versions - basic DTOs with minimum fuss and complexity - just data (I would consider full-immutability or popsicle-immutability a nice-to-have, too)
p72358
aVI would refactor to add a DTO for the things you want to store, and just store that
p72359
aVAnother approach is to change your state implementation, in the process swapping the serializer
p72360
aVIn the DBML designer you can make LINQ models "unidirectional", meaning  will work with them; so  might make a reasonable swap out; but writing a provider is hard work and nothing to do with your business needs
p72361
aVI would just write the DTO ;p
p72362
aVOne final option is to implement  in your , and only store/fetch the values you actually need
p72363
aV(in addition to events, any other fields that lead to objects that are not serializable by  will also fail)
p72364
as(dp72365
g18
V23354
p72366
stp72367
a((dp72368
g2
(lp72369
VExplicit interface implementation:
p72370
as(dp72371
g18
V23354
p72372
stp72373
a((dp72374
g2
(lp72375
Vhow about
p72376
aVI haven't tested it for all types, but looks feasible
p72377
aVUpdate: seems to work for most:
p72378
as(dp72379
g18
V23354
p72380
stp72381
a((dp72382
g2
(lp72383
VChanging the size of the  is almost certainly a bad idea (not least: each thread will take another chunk of stack space); you should look instead at your thread usage - are you saturating the pool
p72384
aVYou might find TPL and  a better way to handle some async code, or in the cases of things like IO - the  /  async operations rather than a sync operation on a  thread
p72385
aVYou might also check that all your async operations are existing cleanly; are they perhaps stalling (deadlock perhaps) and not exiting
p72386
aVFinally: the  is primarily intended for brief operations (where the spin-up cost of a  is most noticeable); long-running operations may do better on dedicated s
p72387
as(dp72388
g18
V23354
p72389
stp72390
a((dp72391
g2
(lp72392
VWe had this, and since we are using razor with html, the pages can't adapt automatically
p72393
aVFor me, the simplest fix was to change the content-type in the :
p72394
aVThe "figure out the content-type yourself" insanity only happens when nothing is set explicitly
p72395
aVSo
p72396
aVset it
p72397
aVYour actual views can still override this:
p72398
aVFor info, to test for this issue on your local dev server (with a clean cache to avoid false results by previous cached data), do something like wget or Fiddler:
p72399
aVand look for:
p72400
aVin the result; if you see that, IIS/ASP
p72401
aVNET has decided to pretend your reply satisfies the request's "Accept" header
p72402
aVeven  if it doesn't
p72403
aVWorse: you might now be able to get that "text/vnd
p72404
aVwap
p72405
aVwml" from a wget without specifying the Accept header (or specifying something like "text/html"); if you see this you have a problem (or: your users do) - you have a cached response for WAP that is being fed to non-WAP clients
p72406
aVWith the above tweak, the first wget will return "text/html" - since that is what our content is
p72407
aVSorry, down-level browsers; you should have included "text/html" as an option - and if you can't handle "text/html"
p72408
aVsucks to be you
p72409
as(dp72410
g18
V23354
p72411
stp72412
a((dp72413
g2
(lp72414
VSimple: don't optimise prematurely
p72415
aVAnd in this case, that is premature
p72416
aVThere is a subtle difference between hoisting the length vs querying it each time, but in any sane circumstance, a: we're talking nanoseconds if that, and b: it changes depending on whether it is a naked vector, a list, an ilist, etc
p72417
aVDon't learn a general rule
p72418
aVBut the bigger problem here: that specific example is absolutely irrelevant to overall performance; you are talking about a ; a  presumably that is being populated from a database, which is out-of-process, and probably on a different machine
p72419
aVYou are comparing nanoseconds (possibly less) against network latency (normally 0
p72420
aV3ms on a local LAN) plus query time, plus bandwidth (depends on the query)
p72421
aVYou can't change the speed of light (latency), but you can write an efficient data query that accesses only the required data, using appropriate indexing and possibly denormalization
p72422
aVOh, and N+1 - that's a biggie
p72423
aVLikewise, even in memory - most bottlenecks tend to be due to things like inappropriate looping (when a hash-based lookup would be better), or not using appropriate caching to remove the need to constantly query data over and over and over and over and over
p72424
aVOn "the web in general"; caching, compression (transport and content - for example js/css minification), cookie-free domains for static content (maybe a CDN), farms of servers, fat pipes, and proper CPUs
p72425
as(dp72426
g18
V23354
p72427
stp72428
a((dp72429
g2
(lp72430
VI would use something like dapper-dot-net to load it into a basic type model; this is a micro-ORM, so you get the benefits of meta-programming (efficiently pre-generated IL etc) - without the overhead of things like EF or DataTable
p72431
as(dp72432
g18
V23354
p72433
stp72434
a((dp72435
g2
(lp72436
VOoh, that is
p72437
aVodd; I don't do anything non-deterministic in there (I'm the author, btw)
p72438
aVI don't think I've got enough there for a repro (in particular, I don't know your type-model nor your specific data)
p72439
aVI'm more than happy to help, but I might need a bit more to reproduce that
p72440
aVIn Visual Studio, you can generally capture part of a blown stack in the "Call Stack" window, which should give some indication of there the problem is
p72441
aVAlternatively, if you are able to post more specific information (so that I can reproduce it), either here or directly, we'll get to the bottom of it
p72442
aVI'm going to make the assumption that you are using r282 (the current downloadable dll); you could also try using the alpha build of v2; since I don't know what the problem is (yet) I can't state that this will fix it, but if it does work reliably it will point at a bug in v1 (r282)
p72443
aVAnother possibility is that there is something in your type model that is tying it in knots; perhaps some atypical getter/setter that is causing problems
p72444
as(dp72445
g18
V23354
p72446
stp72447
a((dp72448
g2
(lp72449
V@Richard Its "ID" which is the Auto Increment in both tables
p72450
aVHaving an auto-increment () act as a primary key is fine, but using it as a foreign key is dangerous, since you can't really guarantee that they will always be in sync; any rollback could leave them broken (rollback does not undo identity increments, as this would affect other SPIDs)
p72451
aVAlso, any thread-race between two concurrent s will be in jeopardy
p72452
aVThe correct approach here is to query  after the first insert, and use that in the  to the second table; i
p72453
ag50
aVin the second table you tell it the value
p72454
aVNote that since  and  are floating values, you should query them both directly after the first :
p72455
as(dp72456
g18
V23354
p72457
stp72458
a((dp72459
g2
(lp72460
VYou could add an extension method:
p72461
aVWhich should do it
p72462
as(dp72463
g18
V23354
p72464
stp72465
a((dp72466
g2
(lp72467
VNo, basically
p72468
aVWhen I last changed from 2
p72469
aV0 to 4
p72470
aV0 on an app-pool, we needed subtle but critical changes to configuration files (in particular), but ultimately any part of the runtime could have feature changes that break existing code on some edge cases
p72471
as(dp72472
g18
V23354
p72473
stp72474
a((dp72475
g2
(lp72476
VIf that is LINQ-to-objects, they'll both be pretty fast
p72477
aVIf you want faster, consider a  and use
p72478
aVObviously you need to pre-generate the dictionary, perhaps via ToDictionary()
p72479
aVNote that the two examples shown are different when there is no match; one throws; one returns an empty string
p72480
aVAlso, there is no need to call ToString() on a string
p72481
aVRe the faster version (comments); you need a field,
p72482
aVAnd at some point prior to use (or after data changes) you need to populate it:
p72483
aVThen your lookup would be like:
p72484
as(dp72485
g18
V23354
p72486
stp72487
a((dp72488
g2
(lp72489
VFor that method, you need the extension method from the  namespace (and found in System
p72490
aVData
p72491
aVDataSetExtensions
p72492
aVdll); so try adding:
p72493
aVto the top of your file
p72494
aVIf that doesn't work, add a dll reference to the dll
p72495
aVThen:
p72496
aVshould work, assuming  is typed as a
p72497
as(dp72498
g18
V23354
p72499
stp72500
a((dp72501
g2
(lp72502
VIf the tabular data is arbitrary, and needs to be handled in-memory, then you might as well choose  - it will save you a lot of bug-hunting
p72503
aVIf the data doesn't need to be buffered in memory, I'd use  and let the consumer pull the data down themselves
p72504
aVI should stress that  is never my first choice of API, but it may be pragmatic here
p72505
aVOne other option is a generic method  that fills the data into  instances, perhaps usig something like dapper-dot-net
p72506
as(dp72507
g18
V23354
p72508
stp72509
a((dp72510
g2
(lp72511
VYou use the CsvReader from here to easily and conveniently read a csv (or other similar data) into a DataTable (or an IDataReader)
p72512
aVIt is always my first choice for this scenario - fast and pretty robust
p72513
as(dp72514
g18
V23354
p72515
stp72516
a((dp72517
g2
(lp72518
VMy guess is that  is not , but that the property setter () uses some internal state that is my correctly configured, and is throwing the exception as a consequence
p72519
aVAn event being invoked without a null-check would be a classic example, as would some inner object that holds the state
p72520
aVCheck the setter to see what is happening
p72521
aVIf the value you are assigning () is a property, it could also be thrown from in there; again: check the getter
p72522
aVIt is possible for  on a class to return , but only in an extreme edge case that can not happen by accident
p72523
aVThus I very much doubt that  is  - the debugger will tell you quicky enough
p72524
as(dp72525
g18
V23354
p72526
stp72527
a((dp72528
g2
(lp72529
VNothing is guaranteed; pulling the plug out or terminating a process won't respect , for example
p72530
aVAll that is guaranteed is that in normal execution (which includes most sane exceptions), it will call
p72531
aVIn your case, you have an unhandled thread exception; that is a process killer
p72532
aVAll bets are off, since your process is now sickly and in the process of being put down (and out of it's misery)
p72533
aVIf you want code to behave, you must ensure ou don't have process-killing exceptions; unhandled exceptions on threads being at the top of that list
p72534
aVA / around any thread-level code is highly recommended
p72535
as(dp72536
g18
V23354
p72537
stp72538
a((dp72539
g2
(lp72540
VSQL Server (at least, via SqlClient) uses named parameters
p72541
aVThat code will indeed execute a parameterised query, but a few notes:
p72542
aVit hasn't been formally "prepared" (see ), but you pretty much never need to anyway
p72543
aVseveral of those objects are ; you should have s for them
p72544
aV(and adapter, etc) will work, but is in decline (with mapped classes being preferred, IMO)
p72545
aVseeing a  and a  in the same method probably means your UI code is too close to the data access code; I would push the data-access stuff down a level, personally
p72546
aVFor example:
p72547
aV(and bind it to the  back at the UI)
p72548
aVOf course, if the parameter value is always  you could code that into the TSQL directly
p72549
as(dp72550
g18
V23354
p72551
stp72552
a((dp72553
g2
(lp72554
VHow about:
p72555
aVthis uses the  axis on the Control lookup (the default is )
p72556
aVObviously replace the  - they are just for brevity; the important thing in the above is
p72557
as(dp72558
g18
V23354
p72559
stp72560
a((dp72561
g2
(lp72562
VThe method slot used by static analysis during compilation depends on the type of the variable (or expression), not the actual object
p72563
aVThe variable  is typed as , so the  method slot is used
p72564
aVAnd then the correct override is selected based on the typed (essentially vtable on that slot)
p72565
aVSo the base function is used
p72566
aVTo use the derived2 function, the variable (or expression) must be typed as  or a subclass
p72567
as(dp72568
g18
V23354
p72569
stp72570
a((dp72571
g2
(lp72572
VIt isn't really about "benefit" - it is about representing something subtly different; an  is really just shorthand for , which means it is capable of representing a null/empty state in addition to the regular  range
p72573
aVBut the downside is that it takes more space
p72574
aVSo if space efficiency is your aim (which mainly only makes sense in an array, etc) you may want to think carefully
p72575
as(dp72576
g18
V23354
p72577
stp72578
a((dp72579
g2
(lp72580
VYou can do this at the command line, with  (web reference),  (WSE3 web reference), or  (WCF service reference)
p72581
aVThis will consume the WSDL/MEX and generate your proxy layer as a C# class file
p72582
as(dp72583
g18
V23354
p72584
stp72585
a((dp72586
g2
(lp72587
VPerhaps the simplest way to do this (without waiting on dapper) is to have a second property:
p72588
aVAnd in your query, alias the column as
p72589
aVOf course, then this prompts the question: should dapper support private properties for this type of thing
p72590
aVTo which I say: probably
p72591
as(dp72592
g18
V23354
p72593
stp72594
a((dp72595
g2
(lp72596
VMy understanding is that the zip is writing to (or reading from) a single underlying stream; so my assumption would be a resounding no; this cannot be thread safe if you are talking about a single underlying stream
p72597
aVHowever; separate instances talking to separate underlying streams should be fine; and indeed it is usually easier to run separate (unrelated) tasks in parallel than it is to parallelise a single task
p72598
as(dp72599
g18
V23354
p72600
stp72601
a((dp72602
g2
(lp72603
VAs long as the  is not a background-thread (), the app should stay alive:
p72604
aVNothing else is needed
p72605
aVNote that the  will use background threads; is the problem perhaps that you are using  here
p72606
aVNote: if the second thread hasn't actually started there might be a small race where it can exit prematurely; you might want to gate the threads starting
p72607
as(dp72608
g18
V23354
p72609
stp72610
a((dp72611
g2
(lp72612
VTo support sorting, the source needs to implement  with sorting enabled
p72613
aVAnnoyingly, AFAIK the only inbuilt type with this is
p72614
aVAll is not lost, though; your best option is to create a  of your data - or rather, one of the many  subclasses available as examples on the internet
p72615
aVgets you 90% of the way there - it just needs about 3 (IIRC) additional methods implementing to get basic (one-column) sorting support
p72616
aVDinesh Chandnani wrote a series of articles back in 2005 (http://blogs
p72617
aVmsdn
p72618
aVcom/b/dchandnani/archive/2005/03
p72619
aVaspx) that do a good job of explaining binding via a BindingSource
p72620
aVIt was written before EF, but it provides some good background information
p72621
aVHere's one tidbit:
p72622
aVOf course you can bind the DataGridView to the DataTable directly and
p72623
aVbypass the BindingSource, but BindingSource has certain advantages:
p72624
aVIt exposes properties to Sort the list, Filter the list, etc
p72625
aVwhich would other wise be a pain to do
p72626
aV(i
p72627
ag50
aVif you bind the
p72628
aVDataGridView to the DataTable directly then to Sort the DataTable you
p72629
aVneed to know that DataTable is an IListSource which knows the
p72630
aVunderlying list which is a DataView and a DataView can be sorted,
p72631
aVfiltered, etc
p72632
aVIf you have to set up master/child views then BindingSource does a great job of doing this (more details in my previous post)
p72633
aVChanges to the DataTable is hidden (also in my previous post)
p72634
as(dp72635
g18
V23354
p72636
stp72637
a((dp72638
g2
(lp72639
VControl
p72640
aVInvoke and Control
p72641
aVBeginInvoke are safe to call from the UI thread and non-UI threads, so if you already know you are on a non-UI thread there is no harm (IMO) skipping the check and just calling Invoke/BeginInvoke
p72642
aVExample:
p72643
as(dp72644
g18
V23354
p72645
stp72646
a((dp72647
g2
(lp72648
VA delegate constructor accepts the target method to invoke; perhaps the most convenient approach here is:
p72649
aValthough other variants exist (passing the control as an argument to a formal method)
p72650
as(dp72651
g18
V23354
p72652
stp72653
a((dp72654
g2
(lp72655
VWhat the compiler emits is identical; indeed, even when calling a non-virtual instance method on a sealed class it uses  - which is the same as it would use calling any method with polymorphism
p72656
aVAnd no: it isn't copy/paste - the code you wrote in  remains as part of
p72657
aVAnd no, you don't get 2 objects just because of inheritance
p72658
aVIt is combining the behaviour; an instance of  also has the implementation from  - but not via copy paste: a  is also an  - i
p72659
ag50
aVa  is also a , etc
p72660
as(dp72661
g18
V23354
p72662
stp72663
a((dp72664
g2
(lp72665
VThe line:
p72666
aVis adding an alias, i
p72667
ag50
aVallowing the serializer to use  inside the xml
p72668
aVHowever this doesn't make your object use this namespace; for that, you need (on your type):
p72669
aV(or something equivalent, perhaps using )
p72670
aVNote that with the alias added, you will get:
p72671
aVTo get it without an alias, you want:
p72672
aVwhich gives output:
p72673
as(dp72674
g18
V23354
p72675
stp72676
a((dp72677
g2
(lp72678
VThe only way you can send multiple files in one response is to put them inside an archive package, e
p72679
ag24035
aVa  file
p72680
aVThat is at least something that can be done with code, using various tools (IIRC there's a zip packager inside the main
p72681
aVNET framework now; otherwise, SharpZipLib will do the job nicely)
p72682
as(dp72683
g18
V23354
p72684
stp72685
a((dp72686
g2
(lp72687
VI would guess it is doing basic sanity checking (i
p72688
ag50
aVshould anything have changed) - to prevent unexpected source code changes (I hate it when opening a file can cause side-effects - I'm looking at you, DBML
p72689
aVOn a side note, to force serialization generally (I don't think it will apply due to the above):
p72690
aVthe  and  are a convention used by the framework
p72691
as(dp72692
g18
V23354
p72693
stp72694
a((dp72695
g2
(lp72696
VYou have two options; you could declare an  parameter called ; or - you could change the end to  and just use:
p72697
aVI prefer the formal parameter approach, but  works well
p72698
as(dp72699
g18
V23354
p72700
stp72701
a((dp72702
g2
(lp72703
VIt depends on how close the client is to your object domain
p72704
aVIf it is your client, then maybe - and indeed this is pretty much how ADO
p72705
aVNET Data Services (etc) work - directly exposing your model
p72706
aVHowever, if the client is anything else I would suggest a dedicated DTO
p72707
aVIn fact, I'd suggest it anyway ;p Otherwise, it gets somewhat complex:
p72708
aVcontrolling the serialization details (what members
p72709
aVwhat names
p72710
aVwhat happens when we version it
p72711
aVhandling relation properties (it has an  member
p72712
aVbut is that lazily loaded
p72713
aVdo we want that
p72714
aVmerging incoming objects (for updates etc) back into the model
p72715
aVsuppressing any logic that you've added in setters, etc, during deserialization
p72716
aVhandling identity management if you get 2 separate copies of the same object back in a tree-based serializer like
p72717
aVIn most cases, having a separate DTO makes most of these problems just go away
p72718
as(dp72719
g18
V23354
p72720
stp72721
a((dp72722
g2
(lp72723
VIgnoring the compile issue
p72724
aVthe first matching exception block () will get the exception
p72725
aVYou then ignore the exception and don't re-throw, so exception will be seen by the outside world
p72726
aVThat doesn't make it good practice, though
p72727
aVin particular, catching an arbitrary  and ignoring it is risky - it could have been anything
p72728
aVit isn't necessarily the exception you thought it was
p72729
as(dp72730
g18
V23354
p72731
stp72732
a((dp72733
g2
(lp72734
VThe simplest approach here would be to do that work from a BackgroundWorker
p72735
aVMSDN has examples for this
p72736
aVThis then executes on a worker thread, with events for completion/error/etc
p72737
aVIt can also support cancel, but your operation needs to be coded to be interruptable
p72738
aVAnother approach is the Task API in 4
p72739
aV0; but if you use this you'll need to get back to the UI thread (afterwards) yourself
p72740
aVWith BackgroundWorker this is automatic (the events are raised on the UI thread)
p72741
as(dp72742
g18
V23354
p72743
stp72744
a((dp72745
g2
(lp72746
VIIRC, if you don't use formal data-contract markers, it defaults to acting like a field-serializer
p72747
aVThis will work, but is less easy to version, since private changes can break the client/server
p72748
aVIMO you should always formally decorate WCF types with the data-contract/data-member attributes
p72749
aVIt will work without them, but for the wrong reasons (IIRC, originally it didn't work without formal markers)
p72750
as(dp72751
g18
V23354
p72752
stp72753
a((dp72754
g2
(lp72755
VI suspect the problem is that you have 2 separate definitions of , perhaps by copying the class file between projects; that is not sufficient, as types are defined by their assembly
p72756
aVYou need a reference between the projects, so they both use the same Type
p72757
as(dp72758
g18
V23354
p72759
stp72760
a((dp72761
g2
(lp72762
VYou state that you want to go from  to  to ; firstly, note that  (such as UTF-8) is not an option; that only applies when going string to binary back to string
p72763
aVThe difference is important: it needs to actually be textual data for that to work, and an arbitrary  can not be treated as textual data
p72764
aVThis also rules out your "direct write into a string", for similar reasons (not limited to: surrogates etc)
p72765
aVThe correct way to encode binary to a string is with base-64, base-16, etc; base-64 is the most efficient general purpose encoding here
p72766
aVHowever; most encryption code works with binary, not text
p72767
aVIf you have a text encryption API, in most cases the first thing it is going to do is to turn it into binary using an encoding such as UTF-8
p72768
aVSo: check you aren't missing a direct binary API option
p72769
as(dp72770
g18
V23354
p72771
stp72772
a((dp72773
g2
(lp72774
VIt actually depends on where  is defined
p72775
aVIf this is an instance method, there is an implicit capture of  onto a compiler-generated type; likewise anything else (not shown in your example) might be captured
p72776
aVIn most normal cases the extra overhead of a delegate instance is minimal
p72777
aVOne workaround to avoid passing creating a delegate is to have a parameterised delegate (an , perhaps stored in a  field), and feed the state in as a separate parameter
p72778
aVbut of course, then you are creating an object for the state
p72779
aVThe slight advantage of doing a manual capture is that you are probably (it depends on the exact code sample) reducing it from 2 (or more) allocations (1 delegate, 1-or-more capture classes) to 1 allocation (your manual capture; the delegate being held on a static field)
p72780
aVOne way of another, there is likely going to be something created
p72781
aVPersonally, until your profiling shows it is a bottleneck, I think you should relax a bit - allocations are very fast, and most times the object will be collected in GEN-0, which is very efficient
p72782
as(dp72783
g18
V23354
p72784
stp72785
a((dp72786
g2
(lp72787
VNormally, I would expect this to work, since you should be blocked until it is committed (or rolled back)
p72788
aVAre you perhaps using lock-avoiding mechanisms (nolock etc)
p72789
aVYou could always do the reads in another Serializable transaction (i
p72790
ag50
aVa second ) - that should ensure the reads are true
p72791
as(dp72792
g18
V23354
p72793
stp72794
a((dp72795
g2
(lp72796
VYou could use middleware for the queue (MSMQ etc)
p72797
aVAn alternative would be a thread-safe producer/consumer queue at the client
p72798
aVYour "main" code just adds to the queue (ConcurrentQueue in 4
p72799
aV0 might work nicely here, although even in 4
p72800
aV0 I tend to use a utility queue I wrote a while ago instead); and you have a dedicated worker thread that dequeues messages, does the WCF work, and processes the response
p72801
as(dp72802
g18
V23354
p72803
stp72804
a((dp72805
g2
(lp72806
VYou haven't really given us any breakdown of where the performance degradation is coming in
p72807
aVor indicated how long the core SQL query takes, but some thoughts:
p72808
aVthis is buffering the entire set of data; personally, I'd be using a non-buffered API for this, i
p72809
ag50
aVprocessing each row as it arrives
p72810
aVI'd also be using typed objects, not a  - something like dapper-dot-net would do both very neatly
p72811
aVI would also be profiling that individual query to see how much of the time is in there vs the processing of the data once it is local
p72812
aVYou seem to be doing a lot (2*N+1) of find () and  /  etc; I think you are drowning in latency
p72813
aVFor this volume, I'd be tempted to just throw () the source data into a table on the DB server and do some set-based queries (3; one update, one delete, one insert - or a  if available) at the db
p72814
as(dp72815
g18
V23354
p72816
stp72817
a((dp72818
g2
(lp72819
VSilverlight has a much-reduced runtime (to suit the required size, and platform limitations)
p72820
aVThe WCF core () is still available, though:
p72821
aVSystem
p72822
aVRuntime
p72823
aVSerialization Namespace
p72824
aVas is :
p72825
aVSystem
p72826
aVXml
p72827
aVSerialization Namespace
p72828
aVOther 3rd-party serializers are available for Silverlight as libraries
p72829
as(dp72830
g18
V23354
p72831
stp72832
a((dp72833
g2
(lp72834
VNormally, it will tell you why very clearly in the exception - look in particular at the InnerException; however, to summarise:
p72835
aVFor a custom type  to be serializable via  (either as the root object or via a property, i
p72836
ag50
ag38293
aVit must be
p72837
aVit must have a public parameterless constructor
p72838
aVa few generic combinations may not be supported
p72839
aVit must be expected (exposing data as  is a no-go, for example; subtypes of  must be advertised in advance, typically via )
p72840
aVit must be concrete (non-), or have concrete implementations defined via
p72841
aVUsing  removes the type from consideration, so types that are not xml-friendly can be avoided
p72842
aVYou can also try  for those cases
p72843
as(dp72844
g18
V23354
p72845
stp72846
a((dp72847
g2
(lp72848
VIf you want any object, you probably have to live without the
p72849
aVYou could do the same with a combination of reflection, special-cases (for  etc), and  - however, IMO you should limit yourself (in this case) to , which will be null for reference types (including string) and nullable value-types, and all-zeros for non-nullable value-types
p72850
aVYou should also probably use a  or similar to make sure you don't actually use that value, except to satisfy definite assignment rules for the compiler
p72851
as(dp72852
g18
V23354
p72853
stp72854
a((dp72855
g2
(lp72856
VExpression trees are not easily serialized, and even if they were, the 4
p72857
aV0 extensions to allow more method-like usage are not supported by the expression compiler, so creating the expressions would be very tricky
p72858
aVAdditionally, allowing arbitrary code execution is not something to be taken lightly - there are lots of security implications
p72859
aVPersonally, I suspect your best bet would be to let the server know the implementation (in advance) perhaps via assembly sharing (so the contract classes at the client and server are identical, loaded from a library dll)
p72860
aVHowever, another option may exist via scripting languages - maybe you could write the method in iron-python
p72861
aVYou could also use C# and compile on the fly - but I repeat my warning: running input as code on a server
p72862
aVnot very safe
p72863
as(dp72864
g18
V23354
p72865
stp72866
a((dp72867
g2
(lp72868
VNot only is that inefficient, it is incorrect; you should never access a control's properties except from the UI thread, due to thread affinity
p72869
aVSetting properties (the enabled assignment) is especially bad, but reading them (the enabled check) is bad enough
p72870
aVRather than continuous monitoring, those forms should update themselves, based on event notifications
p72871
aVFor example, by hooking  on the two buttons
p72872
aVyou could also (instead) do this at the code that causes the  property to change
p72873
as(dp72874
g18
V23354
p72875
stp72876
a((dp72877
g2
(lp72878
VCasting (at least, in the way you usually mean) is a compile-time / static-typed operation
p72879
aVThe only way that even makes sense at runtime with an unknown type is when dealing either with generics (casting it to some  - and note that you can choose the  at runtime via  or ), or with meta-programming (emitting IL to do the appropriate cast)
p72880
aVIn all other cases when the type is unknown until runtime, you are stuck with either  or
p72881
as(dp72882
g18
V23354
p72883
stp72884
a((dp72885
g2
(lp72886
Vprimary is a reserved keyword in TSQL
p72887
aVMake it  to escape it and indicate you mean the object named Primary
p72888
as(dp72889
g18
V23354
p72890
stp72891
a((dp72892
g2
(lp72893
VThere are two possible issues - finding a method if it is non-public (the example shows non-public), and handling the generics
p72894
aVIMO, this is the easiest option here:
p72895
aVYou could make the  clause more restrictive if it is ambiguous
p72896
as(dp72897
g18
V23354
p72898
stp72899
a((dp72900
g2
(lp72901
VEither will work, since in most cases the client will be getting a WSDL/MEX representation - not your type directly
p72902
aVIn either case, remember to use explicit / attributes so that it truly is contract-based, rather than looking at the fields
p72903
aV(note: don't inherit a DTO from your domain type; a DTO should be separate, if you go that route)
p72904
aVPersonally, I prefer a separate DTO, but I know people have success exposing the domain model directly (that is how LINQ-to-Data-Services works, for example)
p72905
as(dp72906
g18
V23354
p72907
stp72908
a((dp72909
g2
(lp72910
VVariance needs to be explicit (and requires C# 4
p72911
aV0); for example, this makes it compile as covariant (note the  modifiers in the interface):
p72912
aVNote, however, that this also limits your interface to
p72913
aVcovariance
p72914
aVYou couldn't have an  method, for example - as that would need to be contavariant (aka )
p72915
as(dp72916
g18
V23354
p72917
stp72918
a((dp72919
g2
(lp72920
VThe simplest way would be to just build a mapping array:
p72921
aVand just use:
p72922
as(dp72923
g18
V23354
p72924
stp72925
a((dp72926
g2
(lp72927
VSerializing it as binary shouldn't be a problem - in fact, it would be an ideal scenario for protobuf-net, since this is a tree-serializer (like ), and can even work with the s if you really want (so you don't need any more decoration)
p72928
aVHowever, most serializations will not allow you to filter (etc) on the file while it is just a file - you would need to rehydrate the object model into a regular object model, and work with that
p72929
aVFortunately, with a fast binary serializer like that, it should be faster to load anyway (and much smaller than 10MB)
p72930
aVHowever, another viable option is to use an embedded database, and write the data as records in an indexed table structure that supports the queries you need
p72931
aVFor info, a quick test with your sample data showed it taking your 512 byte file to 102 bytes:
p72932
as(dp72933
g18
V23354
p72934
stp72935
a((dp72936
g2
(lp72937
VThat is a perfectly fine definition, and should work in any implementation (including protobuf-net); are you seeing any problem
p72938
aVHOWEVER
p72939
aVyou might want to consider the computational impact of serialization - in particular, to serialize a sub-message, the size of the sub-messages needs to be known first
p72940
aVA deeply recursive method (as necessitated by this linked-list) may cause some issues
p72941
aVIs there any reason this can't be just a  message instead
p72942
aVthat would by far be my preference
p72943
as(dp72944
g18
V23354
p72945
stp72946
a((dp72947
g2
(lp72948
VThis is just a typo in your code:
p72949
aVshould surely be
p72950
aVand then it works
p72951
aVHowever, a  would do the same thing, without needing the extra definition
p72952
aVFinally, using  (i
p72953
ag50
aVwould have avoided one of the conflicts
p72954
aVTo be honest, though, the existing  does so much of this that I wouldn't bother defining this - i
p72955
ag50
as(dp72956
g18
V23354
p72957
stp72958
a((dp72959
g2
(lp72960
VYes; there are various options here;
p72961
aVfirstly, note that "implicit fields" is brittle if you add members, since it has to make more guesses than I would like; only use that with stable contracts
p72962
aVyou can apply a default behaviour globally via GlobalSettings, but I tend to advise against it
p72963
aVprotobuf-net v1 can also work with:
p72964
aVXmlType/XmlElement attribute pairs, as long as the XmlElement specifies an Order
p72965
aVDataContract/DataMember attribute pairs, as long as the DataMember specifies an Order
p72966
aVpartial classes; even for properties, via ProtoPartialMember attribute(s), etc
p72967
aVprotobuf-net v2 can be used 100% without attributes of any kind, by using a TypeModel to describe the interesting types at runtime; this can also compile the model to a dedicated serialization dll if you need (in particular for use with AOT-dependent devices)
p72968
aVI can advise more, but there are a number of options presented; tell me which is/are most appropriate and I can add more detail
p72969
aVRe
p72970
aVproto files; those are (and have always been) entirely optional with protobuf-net, as I recognise that there are a lot of cases where a code-first approach (or retrofit of serialization to an existing model) is useful
p72971
aVThree is a code-generator if you choose to use
p72972
aVproto, of course
p72973
as(dp72974
g18
V23354
p72975
stp72976
a((dp72977
g2
(lp72978
VMy preferred way of handling that would be to call a common method from all of them, so each (individually) looks like:
p72979
aVHowever, you can also do it with delegates, i
p72980
ag50
aVand
p72981
as(dp72982
g18
V23354
p72983
stp72984
a((dp72985
g2
(lp72986
VJust find the first :
p72987
as(dp72988
g18
V23354
p72989
stp72990
a((dp72991
g2
(lp72992
VYou can achieve that, with lots of reflection (both to find the correct , and then to invoke via  etc); however: you aren't using the generic features, so remove them
p72993
aV(or have a secondary non-generic API):
p72994
aVand
p72995
aV(you can also use  in the above step, but you need to be careful with  etc if you do that)
p72996
as(dp72997
g18
V23354
p72998
stp72999
a((dp73000
g2
(lp73001
Vnever; ultimately this was a mistake
p73002
aVThe correct way to iterate a sequence more than once is to call  again - i
p73003
ag50
aVuse  again
p73004
aVIf your data is non-repeatable (or expensive to repeat), buffer it via  or similar
p73005
aVIt is a formal requirement in the language spec that iterator blocks throw exceptions for this method
p73006
aVAs such, you cannot rely on it working
p73007
aVEver
p73008
as(dp73009
g18
V23354
p73010
stp73011
a((dp73012
g2
(lp73013
VIt is pretty simple, really - the translation never injects variables without parameterising them; so:
p73014
aVwill become:
p73015
aVwhere  is a parameter with value taken from your captured
p73016
aVnothing more, nothing less
p73017
aVBut this avoids injection attacks
p73018
aVContrast to an incorrect accidental:
p73019
aVwhich introduces huge risks
p73020
aVYou can of course parameterise the above correctly, too:
p73021
aV(and add a parameter  with value from )
p73022
as(dp73023
g18
V23354
p73024
stp73025
a((dp73026
g2
(lp73027
s(dp73028
g18
V23354
p73029
stp73030
a((dp73031
g2
(lp73032
VSwitching to  is a bad idea here, IMO - it radically changes the behaviour and in particular your ability to trust the files between versions and between platforms
p73033
aVIt also means you are now serializing your fields, which may not be a 1:1 map to the data you wanted to serialize (the public members, by default)
p73034
aVIf you want smaller, perhaps just run it through  or
p73035
aVIf that isn't enough, my next move would be to switch to something like protobuf-net, for the reason that it behaves very similarly (not identically) to , but as a binary serializer (not a field serializer)
p73036
aVHowever, it does not respect  - depending on the complexity, that may be easy to side-step
p73037
as(dp73038
g18
V23354
p73039
stp73040
a((dp73041
g2
(lp73042
VThe is no magic way of doing that, except perhaps via reflection at runtime
p73043
aVIn particular, the compiler won't help you do that
p73044
aVIt seems a very unusual requirement - perhaps if you indicate why we can help more
p73045
as(dp73046
g18
V23354
p73047
stp73048
a((dp73049
g2
(lp73050
VHow about
p73051
aVThis uses word boundaries to limit it to the single word
p73052
as(dp73053
g18
V23354
p73054
stp73055
a((dp73056
g2
(lp73057
VThe problem here is that it isn't that simple; an object can be referenced by zero, one or many, many collections
p73058
aVAssuming that there is a good OO reason for the child to know about the parent (which is actually pretty rare), you need to decide which it is you need to support
p73059
aVI wouldn't use events here as events are also multicast, potentially confusing things
p73060
aVIf it is a strong parent/child relationship, then by all means add a parent property, but you should enforce it - i
p73061
ag50
aVyou can't accidentally add an object that is already a child of another collection, and adding it should set the parent
p73062
aVYou should also ensure that there is only one Add api - i
p73063
ag50
aVdo you call a method on the object
p73064
aVor on the collection
p73065
aVeither works, but having one method will save confusion
p73066
aVYou will almost certainly need a custom collection to do this, to avoid the default Add implementation
p73067
as(dp73068
g18
V23354
p73069
stp73070
a((dp73071
g2
(lp73072
VA data-context should be considered as a unit-of-work
p73073
aVHow granular you make that is up to you - it could be a page request, or a single operation; but - if you get an exception (or pretty much anything unexpected) - stop; abandon the data-context and rollback
p73074
aVAfter a rollback, your data-context is going to be confused, so just don't keep it
p73075
aVAdditionally; don't keep a data-context for longer than necessary
p73076
aVIt is not intended as an app-long data cache
p73077
as(dp73078
g18
V23354
p73079
stp73080
a((dp73081
g2
(lp73082
VFirst: profile ;p
p73083
aVThe next thing I'd try is taking  out of the system, in favor of strongly typed classes that exactly match your data
p73084
aVAlthough data-load speed isn't the problem, I'd use something like dapper-dot-net to make loading the data as efficient as possible
p73085
aVWith a , every member access is indirect, and has to come via an internal lookup, possibly involving boxing en-route
p73086
aVCut all of that out by using static binding to the actual data properties (which are almost always inlined to the fields)
p73087
aVUnfortuantely, this is a bit hard to measure as an estimated impact, as is non-trivial
p73088
as(dp73089
g18
V23354
p73090
stp73091
a((dp73092
g2
(lp73093
VYou can't do that in regular TSQL, as the server treats  as a single value that happens to contain commas
p73094
aVHowever, if you use a , you can use dapper-dot-net, with
p73095
aVdapper figures out what you mean, and generates an appropriate parameterisation
p73096
aVAnother option is to send in a string and write a UDF to perform a "split" operation, then use that UDF in your query:
p73097
as(dp73098
g18
V23354
p73099
stp73100
a((dp73101
g2
(lp73102
VIf you put code in the block, it used to warn of unreachable code, but IIRC this warning disappeared (the issue has been reported)
p73103
aVAs for "why"; because there is a legal implicit conversion (box or nullable) that allows the test to work as per the language requirements
p73104
aVHowever, it will always be , and IIRC the compiler is smart enough to excise the clearly unreachable code (shame about the warning)
p73105
as(dp73106
g18
V23354
p73107
stp73108
a((dp73109
g2
(lp73110
VNo, it does not
p73111
aVIn particular the first lock shown only protects for the duration of obtaining the list reference
p73112
aVAfter that, other threads can compete while the caller does
p73113
aVwell, whatever they do after accessing
p73114
as(dp73115
g18
V23354
p73116
stp73117
a((dp73118
g2
(lp73119
VA reader is conceptually a unidirectional thing, from the start (or more accurately, the current position in the stream) to the end
p73120
aVEach time you read a line, it is simply buffering data until it finds a new line; it doesn't really have the concept of a current line (or moving between lines)
p73121
aVAs long as the file isn't massive, you should be OK reading the entire file, working on a string (or string array), then saving the entire file; inserting/removing text content is otherwise non-trivial (especially when you consider the mysteries of encodings)
p73122
aVFile
p73123
aVReadAllLines and File
p73124
aVWriteAllLines may be easier in your scenario
p73125
as(dp73126
g18
V23354
p73127
stp73128
a((dp73129
g2
(lp73130
VAn anonymous method works well here:
p73131
aVThe compiler pretty much does what you did, but with less plumbing code to read
p73132
as(dp73133
g18
V23354
p73134
stp73135
a((dp73136
g2
(lp73137
VEdit:
p73138
aVWith the edited question, my guess is that the input is not ", but actually contains padding
p73139
aVPerhaps as simple as
p73140
aVCheck the string carefully
p73141
aVHeck, check the  first, then character by character
p73142
aVOriginal answer based on the original question
p73143
aVI don't believe the output you are displaying is true, in part because of the missing LOL
p73144
aVBut also, you have one of the numbers hard-coded; surely it should be:
p73145
aVAlso keep in mind the differnce between a local IP and a public IP
p73146
aVA 192
p73147
aV168 IP is your LAN
p73148
aVRemote clients won't have that, but will be using a public IP address translated via their router/proxy/whatever
p73149
as(dp73150
g18
V23354
p73151
stp73152
a((dp73153
g2
(lp73154
VAttribute instances are completely independent of the types/fields/properties that they decorate; there is absolutely no way of accessing the context from an attribute
p73155
aVHowever, attributes also aren't created until you explicitly query them with reflection
p73156
aVIf you want to invoke some logic, then it must be done explicitly through code - so you might consider adding a method on your attribute that accepts the context object:
p73157
aVfor example, then use GetCustomAttribute to obtain it, cast it, and call
p73158
as(dp73159
g18
V23354
p73160
stp73161
a((dp73162
g2
(lp73163
VI would say put the sql where you would have put the equivalent LINQ query, or the sql for DataContext
p73164
aVExecuteQuery
p73165
aVAs for where that is
p73166
aVwell, that is up to you and depends on how much separation you want
p73167
aVHowever, personally I see no benefit hiding the SQL in a separate class away from the  call - you want to see them in context so you can easily verify the data (and indeed, the parameters)
p73168
aVYou might also be constructing the query (still parameterised) in situ
p73169
aVBut for a regular static query I would keep the TSQL as a literal near the code, unless I have good reason to need it abstracted, i
p73170
ag50
aV(note also the alternative extension method usage in the above)
p73171
aVIMO, the key in the above is that it is extremely unlikely that you would ever re-use that query from any other place - the logic would instead be put into a method, and that method called from multiple places
p73172
aVSo the only other reason you might use to hide the query behind a central wrapper is if you need to support different database providers (with different SQL dialects)
p73173
aVAnd that is rarer than people make out
p73174
as(dp73175
g18
V23354
p73176
stp73177
a((dp73178
g2
(lp73179
VYour edit changes everything; if  implements  then they all implement
p73180
aVWith that, you are using custom serialization so the behaviour is determined entirely by the  and serialization-constructor code you write in each of  /  /
p73181
aVOriginal answer, when there was no mention of
p73182
aVserialization is generally based on type of the actual object at runtime, and  (which maps to ) is a field serializer
p73183
aVHowever, if  is not marked , it cannot be serialized with  (unless it is ); so:
p73184
aVif it is an , all  fields will be serialized
p73185
aVif it is a , it will throw an exception
p73186
aV(it can't be a  since that is abstract; but if it was, that would throw too)
p73187
aVIf you aren't using  (and personally I don't think  is a good choice most of the time), then the behaviour will depend on the specific serializer
p73188
aVMy advice: use a different serializer; there are plenty
p73189
aVAlmost all are (IMO) better choices than
p73190
as(dp73191
g18
V23354
p73192
stp73193
a((dp73194
g2
(lp73195
VIf you aren't going to know the generic type, it isn't ideal to use a generic interface
p73196
aVI would be tempted to use:
p73197
aVwith an API that works with
p73198
aVIn most cases, this will not present an issue - as you are most likely serializing classes (so no boxing)
p73199
aVThe occasional cast is not going to be an issue
p73200
aVIf you really want, you can have a dual generic/non-generic API, but unless you need it that is probably overkill (says someone who has spent a lot of time working with pretty-much this exact scenario)
p73201
as(dp73202
g18
V23354
p73203
stp73204
a((dp73205
g2
(lp73206
VYou state:
p73207
aVI am referring to slow time for compile due to type 'inferencing'
p73208
aVThis does not slow down the compiler
p73209
aVThe compiler already has to know the result type of the expression, in order to check compatibility (direct or indirect) of the assignment
p73210
aVIn some ways using this already-known type removes a few things (the potential to have to check for inheritance, interfaces and conversion operators, for example)
p73211
aVIt also doesn't slow down the runtime; try are fully static compiled like regular c# variables (which they are)
p73212
aVIn short
p73213
aVit doesn't
p73214
as(dp73215
g18
V23354
p73216
stp73217
a((dp73218
g2
(lp73219
VThere are no such devices in C#
p73220
aVA few options are available, though:
p73221
aVin C# 4
p73222
aV0 and
p73223
aVNET 4
p73224
aV0 (or above), use , which supports  but offers no compile time checking
p73225
aVin
p73226
aVNET 3
p73227
aV5 (or above), MiscUtil offers an  class which makes operators available as methods - again, without any compile-time checking
p73228
aVSo either:
p73229
aVor
p73230
as(dp73231
g18
V23354
p73232
stp73233
a((dp73234
g2
(lp73235
VIf you use VSCommands (available via the extension manager), it prevents this completely - as moving folders is pretty rare
p73236
aVIIRC you need to press ctrl (or something) otherwise no drag happens
p73237
aVInvaluable (although "Prevent accidental Drag & Drop" is only in the "Pro" version, looking at the comparison sheet - but honestly, it's a good plugin - I recommend it)
p73238
as(dp73239
g18
V23354
p73240
stp73241
a((dp73242
g2
(lp73243
VAt the most basic, xml serialization can be as simple as spinning up an  and using it
p73244
aVHowever, you can use many many attributes to influence the serializer, or use  if you can't annotate
p73245
aVIn particular, since you mention hierarchy, you'll want:
p73246
aVOther notes on :
p73247
aVthe type must be public
p73248
aVonly public properties and fields are considered
p73249
aVthere must be a public parameterless constructor (or a default constructor)
p73250
aVit is a tree serializer, so object references are not preserved (you can use  to avoid upwards navigation on "parent" properties)
p73251
aVyou can also implement  if you want custom serialization, but I don't recommend it
p73252
aVserializer callbacks are not supported
p73253
as(dp73254
g18
V23354
p73255
stp73256
a((dp73257
g2
(lp73258
VIt all comes down to how you encode the data
p73259
aVIf you are treating it only as a raw sequence of bytes, there is no conflict; the sequence is the same
p73260
aVWhen the matters is in endianness when interpreting chunks of the data as (for example) integers
p73261
aVAny serializer written with portability in mind will have defined endianness - for example, in protocol buffers (available for both Java and C#) little-endian is always used regardless of your local hardware
p73262
aVIf you are doing manual writing to the stream, using things like shift-based encoding (rather than direct memory copying) will give you defined endianness
p73263
aVIf you use pre-canned platform serializers, you are at the mercy of the implementation
p73264
aVIt might be endian-safe, it might not be (i
p73265
ag50
aVit might depend on the platform at both ends)
p73266
aVFor example, the
p73267
aVNET  class is not safe - it is usually assumed (incorrectly) to be little-endian, but on some platforms (and particularly in Mono on some hardware) it could be big-endian; hence the  property
p73268
aVMy advice would be to use a serializer that handles it all for you ;p
p73269
as(dp73270
g18
V23354
p73271
stp73272
a((dp73273
g2
(lp73274
V variables are treated as readonly, as any reassignment is probably an error
p73275
aVSince  allows reassignment, this would also be an issue
p73276
aVAt the IL level,  is pretty-much identical to
p73277
aVHowever, I doubt you need  here; you are already passing a reference to the form, since it is a class
p73278
aVFor reference-types, the main purpose of a  would be to allow you to reassign the variable, and have the caller see the reassignment, i
p73279
ag50
aVit is not required if you are just talking to the form object:
p73280
aVsince it is the same form object
p73281
as(dp73282
g18
V23354
p73283
stp73284
a((dp73285
g2
(lp73286
VYou always need to override them together and with compatible implementations
p73287
aVA hash-code match/mismatch means (respectively) "possible equality" and "non-equality"
p73288
aVThe hash-code by itself does not indicate equality
p73289
aVHence, after a hash-code match is found (or used to create groups of values),  is still checked to determine a match
p73290
aVIf the two do not agree, you might never find matches
p73291
as(dp73292
g18
V23354
p73293
stp73294
a((dp73295
g2
(lp73296
VNormally:
p73297
aV(with optional name,  namespace, etc) is what you are after
p73298
aVHowever, you can't use that directly on a collection
p73299
aVYou would nee instead need to have a wrapper class for Bars, with the attribute and a:
p73300
as(dp73301
g18
V23354
p73302
stp73303
a((dp73304
g2
(lp73305
V is used by  when you need to persist data that is a bit more complex than just serializing the fields - for example, you want to process the data differently (maybe condensed - for example, a dictionary is pretty expansive in memory, but can just be a key/value list on the wire)
p73306
aVLikewise a "linked list" - you would again want to iterate that in the serialization of one object (the list), rather than just serialize the first node, and have that node serialize itself and the next node, etc
p73307
as(dp73308
g18
V23354
p73309
stp73310
a((dp73311
g2
(lp73312
VHow about:
p73313
as(dp73314
g18
V23354
p73315
stp73316
a((dp73317
g2
(lp73318
VVariables barely exist
p73319
aVThe only way to reliably call-by-string (in this scenario) would be to store the delegates in a dictionary:
p73320
aVNow store that dictionary somewhere (in a field, typically), and do something like:
p73321
as(dp73322
g18
V23354
p73323
stp73324
a((dp73325
g2
(lp73326
VIn VB, to do integer division, reverse the slash:
p73327
aVotherwise it is expanded to floating-point for the division, then forced back to an  after rounding when assigned to
p73328
as(dp73329
g18
V23354
p73330
stp73331
a((dp73332
g2
(lp73333
Va  statement needs to be within the context/scope of a single method
p73334
aVIf you can't constrain the scope to a method, you'll need to dispose it manually, usually be implementing  on an object, and doing the dispose in
p73335
aVSometimes (but very rarely) you might also want a finalizer to catch undisposed objects as the get collected - but emphasis: very rare
p73336
aVThere is no inbuilt mechanism for disposing static fields - you'd have to add a static  method (or similar) to call during clean app-exit
p73337
aVThere is also a  alias which looks a bit like your code, but does something completely unrelated (it allows you to use an alternative name for a single type, either for convenience or to avoid ambiguity; it is limited to the single file)
p73338
as(dp73339
g18
V23354
p73340
stp73341
a((dp73342
g2
(lp73343
VThe obvious answer is the language spec; for reasoning
p73344
aVI guess mainly simplicity - it just wasn't worth the overhead of sanity-checking the spec and compiler for the tiny tiny number of single-statement methods
p73345
aVIn particular, I can potentially see issues with generic constraints, etc (i
p73346
ag50
aVon the end of the signature)
p73347
aVNote that not using the braces can sometimes lead to ambiguities, and in some places is frowned upon
p73348
aVI'm a bit more pragmatic than that personally, but each to their own
p73349
aVIt might also be of interest that C# inside razor does not allow usage without explicit braces
p73350
aVAt all (i
p73351
ag50
aVeven for  etc)
p73352
as(dp73353
g18
V23354
p73354
stp73355
a((dp73356
g2
(lp73357
VProfiling is a sure way
p73358
aVDepending on the LINQ provider, this may also be inbuilt, for example with LINQ-to-SQL you can assign anything to  and it will write the queries as it does them
p73359
aVAt the simplest level:
p73360
aVInternally, we use a custom ADO
p73361
aVNET stack for this (and some other things)
p73362
aVIt looks like a  (and LINQ-to-SQL is perfectly happy with it), but it does some logging and profiling for us on every command executed, so we can see where our long running operations are
p73363
aVI think Sam is looking to make this available to the public if you want
p73364
as(dp73365
g18
V23354
p73366
stp73367
a((dp73368
g2
(lp73369
VWhen we get hit by rogue CPU, we use Sam Saffron's CPU analyzer to see what it is busy doing
p73370
aVMost times it turns out to be a bad regex (no, seriously; this bites too often for comfort)
p73371
as(dp73372
g18
V23354
p73373
stp73374
a((dp73375
g2
(lp73376
VYou mean  in place of ; the assignment expression (as opposed to the equality operator) is confusing things; instead of returning a bool, the result of  is a string
p73377
aV(not quite sure what to make of the last part of your , so I omitted it)
p73378
as(dp73379
g18
V23354
p73380
stp73381
a((dp73382
g2
(lp73383
VThis has the advantage that only the desired properties are included in the  statement, and there are no hidden additional round-trips (lazy loading)
p73384
as(dp73385
g18
V23354
p73386
stp73387
a((dp73388
g2
(lp73389
VThere's a lot of missing context, but I think you mean just:
p73390
as(dp73391
g18
V23354
p73392
stp73393
a((dp73394
g2
(lp73395
VNot generally; a few options though;
p73396
aVinherit from ContextBoundObject - which does allow this, but at a performance cost
p73397
aVwrite an explicit property (i
p73398
ag50
aVwith a backing field), and add a utility method call manually
p73399
aVlook at compile-time weavers, such as PostSharp - generally by spotting an attribute or similar
p73400
aVlook at runtime code generators, as offered by some DI/IoC tools (and some other "decorator" based tools) - which either decorate or subclass your object to add the extra code
p73401
as(dp73402
g18
V23354
p73403
stp73404
a((dp73405
g2
(lp73406
VI would definitely say consider using the REST client; however, to look at the issues
p73407
aVgenerally you want to deserialize the data as JSON manually, then run that data through your UI code
p73408
aVFor example:
p73409
aVWhich uses the JavaScriptSerializer from System
p73410
aVWeb
p73411
aVExtensions
p73412
aVdll
p73413
as(dp73414
g18
V23354
p73415
stp73416
a((dp73417
g2
(lp73418
VIn that scenario, I would strongly recommend using regular SOAP for the protocol, and exposing a  or  (or whatever works) as the payload - and then handle the encoding in your application
p73419
aVThe serializer hooks in WCF mean that it is largely similar to a  payload (on a per-parameter/result basis), but I can't guarantee that it will be easily deconstructed outside of WCF
p73420
aVBesides
p73421
aVif you describe it as a SOAP message that includes a BLOB, you are being truthful to SOAP
p73422
as(dp73423
g18
V23354
p73424
stp73425
a((dp73426
g2
(lp73427
VIf you just want to remove the namespace aliases, then as already shown you can use  to force  to use the namespace explicitly (i
p73428
ag50
aV) on each element, rather than declaring an alias and using the alias instead
p73429
aVHowever, regardless of what you do with the aliases, the fundamental name of that element is  in the  namespace
p73430
aVYou can't remove the namespace completely without that representing a breaking change to the underlying data - i
p73431
ag50
aVsomebody somewhere is going to get an exception (due to getting data it didn't expect - specifically  in the root namespace)
p73432
aVIn C# terms, it is the difference between  and  - sure, they are both called , but that is just their local name
p73433
aVIf you want to remove all traces of the namespace, then a pragmatic option would be to edit away the  entries from  and  (plus anywhere else that isn't shown in the example)
p73434
aVIf the types are outside of your control, you can also do this at runtime using  - but a caveat: if you create an  using  you must cache and re-use it - otherwise your  will leak (it creates assemblies on the fly per serializer in this mode, and assemblies cannot be unloaded)
p73435
as(dp73436
g18
V23354
p73437
stp73438
a((dp73439
g2
(lp73440
VIt depends on how big the image is
p73441
aVIf it is small, you could write something to base-64 encode it and embed it in the html, like any of these
p73442
aVFor a concrete example from here:
p73443
aVIf the image is of any appreciable size, you may want instead to write a route that allows lookup via some key to the image, i
p73444
ag50
aVa route like  - in that route you fetch the image binary and use , additionally setting caching headers (and remember to re-check any necessary security)
p73445
aVIn your html you would just have an
p73446
aV(using razor syntax, but similar for aspx)
p73447
aVThe separate route approach requires an additional hop to the server, but allows caching at the client (the inline base-64 approach puts the data on every request)
p73448
as(dp73449
g18
V23354
p73450
stp73451
a((dp73452
g2
(lp73453
VThe ECMA spec is sadly out of date
p73454
aVReading the annotated MS spec is useful, but not essential
p73455
aVReally, just use C#
p73456
aVlots
p73457
aVAnd read books like C# in Depth
p73458
as(dp73459
g18
V23354
p73460
stp73461
a((dp73462
g2
(lp73463
Vthat is LINQ-to-Objects, so it will execute the operations in the order presented; in particular, it will try to sort before it has filtered, and almost all of the filters execute before the key  test
p73464
aVI would simply re-order them:
p73465
aVRunning sorts after filters is a good idea anyway, as you reduce the cost of sorting (which is always super-linear)
p73466
aVAs Chris notes, you then just want to finish up with:
p73467
as(dp73468
g18
V23354
p73469
stp73470
a((dp73471
g2
(lp73472
VThere are a few ways of doing that
p73473
aVthe simplest is to have the async method also do the follow-on operation
p73474
aVAnother popular approach is to pass in a callback, i
p73475
ag50
aVAnother approach would be to raise an event (with the result in the event-args data) when the async operation is complete
p73476
aVAlso, if you are using the TPL, you can use :
p73477
as(dp73478
g18
V23354
p73479
stp73480
a((dp73481
g2
(lp73482
VAs mentioned, a regular lock will war forever, which is a risk of deadlocks
p73483
aVThe preferred mechanism is (and note the ):
p73484
aVThis avoids the risk of not releasing the lock is some edge-cases
p73485
aVThe  (which exists in any sensible implementation) ensures the lock is releases even in error conditions
p73486
as(dp73487
g18
V23354
p73488
stp73489
a((dp73490
g2
(lp73491
VOut of the box, protocol buffers does not have any reference semantics
p73492
aVYou would need to cross-reference them manually, typically using an artificial key
p73493
aVEssentially on the DTO layer you would a key to CDataSet (that you simply invent, perhaps just an increasing integer), storing the key instead of the item in m_refData/m_refParent, and running fixup manually during serialization/deserialization
p73494
aVYou can also just store the index into the set of CDataSet, but that may make insertion etc more difficult
p73495
aVUp to you; since this is serialization you could argue that you won't insert (etc) outside of initial population and hence the raw index is fine and reliable
p73496
aVThis is, however, a very common scenario - so as an implementation-specific feature I've added optional (opt-in) reference tracking to my implementation (protobuf-net), which essentially automates the above under the covers (so you don't need to change your objects or expose the key outside of the binary stream)
p73497
as(dp73498
g18
V23354
p73499
stp73500
a((dp73501
g2
(lp73502
VDepending on what you mean by comparable, maybe:
p73503
aVHowever, this only accounts for the interface, which would be rare
p73504
aVMost implicit conversions will be harder to check for
p73505
aVIf you add more context, maybe a more appropriate solution will be easier to spot
p73506
as(dp73507
g18
V23354
p73508
stp73509
a((dp73510
g2
(lp73511
VIn
p73512
aVNET, the easiest implementation there is simply:
p73513
aVI'm using C# here, but it applies to VB too
p73514
as(dp73515
g18
V23354
p73516
stp73517
a((dp73518
g2
(lp73519
VThe XmlRootAttribute doesn't apply since you are serialising a list of then, not an individual item; this also means your XML is one layer further-out than needed
p73520
aVIMO, your easiest option here is:
p73521
aVand deserialize a Locations object, using  to initialisers the XmlSerializer
p73522
as(dp73523
g18
V23354
p73524
stp73525
a((dp73526
g2
(lp73527
VAs a third option,  and  can be used
p73528
aVbut I don't think that is what you mean ;p
p73529
aVIn "v2", this is indeed possible
p73530
aVYou don't need to define a
p73531
aVproto - you can simply tell it what to do at runtime, for example:
p73532
aVnow store  somewhere (and re-use it), and use  and
p73533
aVThe above configures  to serialize  (as field 1),  (as field 2) and  (as field 3)
p73534
aVThere are of course many more ways of doing this for more fine-grained control
p73535
aVIt will generate (as first needed) a serializer (via IL emit, so very fast) that works with your types as expected
p73536
aVThere is a downloadable "v2" dll, but it needs updating - I have done a lot of fixes in the last few weeks
p73537
aVI will try to refresh this dll later today, or you can build from code
p73538
as(dp73539
g18
V23354
p73540
stp73541
a((dp73542
g2
(lp73543
VInteresting question
p73544
aVThere is a concept of "surrogates" in v2, which was designed for immutable objects (and structs), which might be of use - it depends how complex the object is as to how attractive an option that is
p73545
aVA second option might be to make the property exhibit popsicle immutability
p73546
aVI will illustrate both, but:
p73547
aVpopsicle immutability in this case is only semi-popsicle, and could easily be side-stepped; this option is convenient, and may be useful if you just want to prevent accidental damage
p73548
aVtrue immutability gives you stronger protection; essentially the surrogate acts as a "builder", but that never allows you to mutate an existing instance
p73549
aVNote that surrogates can't be specified on an attribute at the moment (I might add that later ;p) - so I've used the runtime model to demonstrate this:
p73550
aVI don't currently have anything like an
p73551
aVI'm still waiting to find that one thing that truly needs it
p73552
aVI'm not sure this is it
p73553
as(dp73554
g18
V23354
p73555
stp73556
a((dp73557
g2
(lp73558
Vprotocol-buffers itself does not support this - so no, it is not a bug
p73559
aVIndeed,  and * would do the same (and probably so would  and JSON
p73560
aVNET)
p73561
aVHowever, it is a common request, so this is supported in protobuf-net v2 (basically: I cheat)
p73562
aVJust change it to:
p73563
aV(and use the v2 dll that I'm uploading in about 5 minutes, or build from code)
p73564
aV*=caveat:  does support references, but only if you use a specific constructor; it is disabled by default
p73565
as(dp73566
g18
V23354
p73567
stp73568
a((dp73569
g2
(lp73570
VErm
p73571
aVbecause you are creating an extra array (rather than just using the iterator)
p73572
aVThe first approach stops after the first match ( is a non-buffered streaming API)
p73573
aVThe second loads all the matches into an array (presumably with several re-sizes), then takes the first item
p73574
aVAs a side note; you can create infinite sequences; the first approach would still work, the second would run forever (or explode)
p73575
aVIt could also be:
p73576
aV(that won't make it any faster, but is perhaps easier to read)
p73577
as(dp73578
g18
V23354
p73579
stp73580
a((dp73581
g2
(lp73582
VThere is not such class in the BCL or System
p73583
aVData, you will have to roll your own
p73584
aVWe went with a custom type to provide more fine-grained customn in the end; this test shows typical usage:
p73585
aVSo; it supports:
p73586
aVansi vs unicode
p73587
aVfixed vs dynamic length
p73588
aVin the case of dynamic length, explict vs implicit (4000 if the length is <= 4000; "max" otherwise - this keeps the number of query-plans sane)
p73589
aVThe type is available inside dapper
p73590
as(dp73591
g18
V23354
p73592
stp73593
a((dp73594
g2
(lp73595
VThere's various different things here:
p73596
aVthe objects live off in the heap
p73597
aVForget about them for now
p73598
aVthe references to the objects are what get stored in  and second
p73599
aVyou have two variables in
p73600
aVyou have two parameters in
p73601
aVnow; the important thing is the difference between "reference type / references", and "pass by reference"
p73602
aVThey are completely unrelated
p73603
aVin the line:
p73604
aVyou pass the values of two variables to
p73605
aVIn this case, the value of  /  is the reference to the boxed object
p73606
aVNext;
p73607
aVHere, you swap the value of two local parameters, but these are completely independent to anything else
p73608
aVIf we want the caller to see the change to the values (i
p73609
ag50
aVreassignment), we need to pass by reference:
p73610
aVNow the value of  is no longer a reference to the boxed object; it is a reference to a reference to the boxed object
p73611
aVAt the caller, we use:
p73612
aVwhich means pass the reference of variable , rather than pass the value of variable
p73613
aVNote that I said you could forget about the fact that there is an object
p73614
aVEverything above is exactly the same if we used:
p73615
aVthe only difference is that the value of  is 1 etc, and  is a reference to variable x
p73616
aVIn pass by reference, reference-type vs value-type is completely irrelevant; the only important thing is understanding that you pass the value of a variable by default, where the value of a variable is  (etc), or "a reference to an object"
p73617
aVEither way, the logic is the same
p73618
as(dp73619
g18
V23354
p73620
stp73621
a((dp73622
g2
(lp73623
VIt should just be an unbox - although you might want to unbox to the enum and then cast
p73624
aVIn C#, something like;
p73625
aVNot sure what that looks like in C++ though
p73626
aVIn C# the following also works, but I can't guarantee how formally:
p73627
aVNote in the above I'm assuming that  is using  as the underlying type
p73628
aVIf that is not the case, then you need tweak it to unbox as the correct underlying type first
p73629
aVRunning it through reflector, I get:
p73630
as(dp73631
g18
V23354
p73632
stp73633
a((dp73634
g2
(lp73635
VThe  approach could fail if the item is null, so you might want a null check first
p73636
aVI don't know about VB, but in C# you use  with the object, not it's type - i
p73637
ag50
aVAnother difference between  (done correctly) and / - the difference here is subclasses
p73638
aVIf the item is actually an  (inherited from ) then  or  will return  - however,  will return true
p73639
aVis restricted to use with types, not variables - i
p73640
ag50
aV, but not
p73641
aVIf you want the actual type of an object in a variable, use
p73642
aVPersonally, I would use (in C#):
p73643
aVas this does a type-check and cast once rather than twice
p73644
as(dp73645
g18
V23354
p73646
stp73647
a((dp73648
g2
(lp73649
VYour app will need to be configured to run in ASP
p73650
aVNET 4
p73651
aVx rather than 2
p73652
aVx; you might also want (in your web
p73653
aVconfig):
p73654
aVYou might get away without this if you pre-compile your views
p73655
as(dp73656
g18
V23354
p73657
stp73658
a((dp73659
g2
(lp73660
VI would (and have, many times) push this type of data into a file (perhaps via a resx)
p73661
aVThen load the data via your choice of deserializer
p73662
aVIf it needs to be easily edited, maybe JSON via JavaScriptSerializer or JSON
p73663
aVNET
p73664
aVIf it is told of data and performance is key, maybe something more hardcore (maybe binary)
p73665
aVXML is of course a viable choice too
p73666
aVOther options might included an embedded database, if the scenario warrants it
p73667
as(dp73668
g18
V23354
p73669
stp73670
a((dp73671
g2
(lp73672
VGroupBy, if done sensibly, would work in a single forwards only pass
p73673
aVA basic implementation (not theirs) would be something comparable to:
p73674
aVThat basically groups by key, creating a list for each unique key, containing the values
p73675
aVYou could do things like compare to the last-seen key (to help with sorted data), but
p73676
aVyou'd need to profile to know if it is worthwhile
p73677
as(dp73678
g18
V23354
p73679
stp73680
a((dp73681
g2
(lp73682
VAs a 1-off you could just write the property names to a text file (via type
p73683
aVGetProperties()), and use basic tools (a spreadsheet would suffice) to generate a basic method be property
p73684
aVNot sophisticated, but pragmatic
p73685
aVOf course you'd need to account for ongoing changes
p73686
aVTo answer the question as posed; no, not really (unless you implement IXmlSerializable, which is a pain)
p73687
aVI would ask, though: does it have to be XML
p73688
aVI could make that much smaller and have the behaviour you describe (no data written for nulls) by changing data format
p73689
aVThat might not be an option, but that does seem unnecessarily large
p73690
as(dp73691
g18
V23354
p73692
stp73693
a((dp73694
g2
(lp73695
VWCF doesn't call any constructors (at all)
p73696
aVTwo choices:
p73697
aVadd a deserialization callback (MSDN)
p73698
aVhandle it in the property
p73699
aVIMO the second is easier:
p73700
as(dp73701
g18
V23354
p73702
stp73703
a((dp73704
g2
(lp73705
s(dp73706
g18
V23354
p73707
stp73708
a((dp73709
g2
(lp73710
V is a reserved keyword, so you must use square brackets to make it explicit that you mean the object named "User" it, i
p73711
ag50
aVuse  instead of
p73712
as(dp73713
g18
V23354
p73714
stp73715
a((dp73716
g2
(lp73717
V1: sounds viable; often it is a subjective call; for example if your utility relies on static fields, this limits you to a single setup per AppDomain
p73718
aVThis may be fine, but may be limiting if you later move to multi-tenancy
p73719
aVIt also may be harder to test
p73720
aV2: a static class cannot have instances (or instance methods); if the methods are all implemented as static then probably it should be a static class
p73721
aV3: I see no benefit in singleton over static here
p73722
aVA singleton is useful if you need to treat is as an instance, for example to implement an interface
p73723
aVAnother choice here might be regular instance, but just ensure all your code talks to he same instance - perhaps via IoC/DI (and perhaps not)
p73724
aVThis will give you similar convenience, but more flexibility for testing and multi-tenancy
p73725
aVAs a side note, you may also want to consider the threading implications, especially in a web app (highly threaded)
p73726
aVShared data (including static fields and shared instances) should be correctly synchronised (or immutable)
p73727
as(dp73728
g18
V23354
p73729
stp73730
a((dp73731
g2
(lp73732
VAny time you are sending data between machines (or between processes), you are already talking binary data (you could argue that everything is binary data, but when working with it as an OO model it doesn't feel like it)
p73733
aVThe point here is that all you need to do is serialize your messages
p73734
aVThere are a myriad of serialization frameworks - some aimed at convenience, some aimed to range-of-features, and som can use aimed at performance (minimum bandwidth etc)
p73735
aVEven the inbuilt ones would work - for example, you can use  etc to write to a  (such as the  you typically use with a socket)
p73736
aVBut please - not  (it will hurt you, honest)
p73737
aVPersonally I'd use something a bit less verbose such as protobuf-net, but I'm somewhat biased since I wrote it ;p
p73738
aVHowever, note that when working with sockets, you are typically sending multiple (separate) messages as part of the conversation
p73739
aVIn order for each end to correctly and conveniently read the right data per-message from the stream, it is common to prefix each message with the length (number of bytes) - for example, as a little-endian  taking a fixed 4 bytes
p73740
aVSo the reading process is:
p73741
aVread 4 bytes
p73742
aVinterpret that as an , let's say
p73743
aVread  bytes
p73744
aVrun that data through your deserializer, perhaps via
p73745
aVprocess the message
p73746
aVand the sending process might be:
p73747
aVserialize the message, perhaps to a
p73748
aVquery the length and form the 4 byte prefix
p73749
aVwrite the prefix
p73750
aVwrite the data
p73751
as(dp73752
g18
V23354
p73753
stp73754
a((dp73755
g2
(lp73756
VLeaving the aside of whether that enum makes sense as a , IMO the only sensible way of storing this data is in an  column
p73757
aVJust store the value - nothing else is required
p73758
aVTrying to coerce it as a  is a mistake
p73759
aVThe job of the DB is to store data, not to care about presentation
p73760
aVIf you need to filter by this you can use bitwise operators in the search, but note that performance is impacted since when searching by combination (rather than via equality, which can use a non-clustered index)
p73761
aVIf you need to search on arbitrary combinations, then consider denormalization instead
p73762
aVIf you only need to search on predictable bits then you can lift those out with a calculated persisted indexed column - i
p73763
ag50
aVyou can have an automatic  column () that represents bit 2
p73764
as(dp73765
g18
V23354
p73766
stp73767
a((dp73768
g2
(lp73769
VSure - as long as your enum agrees, i
p73770
ag50
aVthen it will all work automatically
p73771
aV(this limitation is by design, and shared with LINQ-to-SQL as it happens)
p73772
aVAlternatively, if the enum is  and can't be changed, cast it in the SQL:
p73773
aVOr finally, use the  API:
p73774
aVThe first is my preferred object, as that enforces the  data-type limitation throughout all your code, which is IMO a good thing
p73775
as(dp73776
g18
V23354
p73777
stp73778
a((dp73779
g2
(lp73780
VThe error message says everything you need, really:
p73781
as(dp73782
g18
V23354
p73783
stp73784
a((dp73785
g2
(lp73786
VPersonally I'd write a class with 4 properties (with matching names and types), then use "dapper" (http://code
p73787
aVgoogle
p73788
aVcom/p/dapper-dot-net/):
p73789
aVWith something like:
p73790
aVDapper is free, simple, has parameterisation to avoid SQL-injection, and is very very fast
p73791
as(dp73792
g18
V23354
p73793
stp73794
a((dp73795
g2
(lp73796
VThe swap works fine:
p73797
aVI can only conclude that the problem is something outside of the code you have shown us, for example:
p73798
aVconfusing which fields/properties/variables TarikheShorooeGharardad and TarikhePayaneGozaresh refer to at each point (hit "show definition" to ensure they are the same)
p73799
aVin the case of fields/properties, confusing which objects they relate to
p73800
aVanything involving mutable structs (i
p73801
ag50
aVstructs with values that can change after creation)
p73802
aVmutable structs are evil and will always cause confusion such as changes which seem to evaporate unexpectedly
p73803
aVor doubly so if it has explicit layout (unlikely, but even more evil if abused)
p73804
as(dp73805
g18
V23354
p73806
stp73807
a((dp73808
g2
(lp73809
V is the composed query - an  or similar; note the query has not yet executed - it is just a pending query
p73810
aVmeans "compiler, figure out the type of r from the expression on the right"
p73811
aVYou could have stated it explicitly in this case, but not all
p73812
aVBut it wouldn't add any value, so  is fine
p73813
aVis a convenience marker for each product; the query is "for each product (p), restricting to those with unit price greater than 15 (), select that product () as a result
p73814
aVUltimately this compiles as:
p73815
aV(in this case, a final  is omitted by the compiler, but with a non-trivial projection, or a trivial query, the  is retained)
p73816
as(dp73817
g18
V23354
p73818
stp73819
a((dp73820
g2
(lp73821
VThe simplest way is to call them all  (case-insensitive, so just  and  are fine); then you can use:
p73822
aVIf you can't do that, there is an optional  () parameter that takes a comma-separated list of columns to treat at splits
p73823
as(dp73824
g18
V23354
p73825
stp73826
a((dp73827
g2
(lp73828
VA  poses a number of challenges for a serialization format that does not include type metadata
p73829
aVbut as always, there are tricks, traps, and workarounds
p73830
aVIf you mean at the outermost level, there are a few options here that revolve around using a different tag(/field-number) to indicate the message type
p73831
aVThis is useful on an API (for example, a socket conversation) where different messages might be expected at any time
p73832
aVAs example would be: How can I send multiple types of objects across Protobuf
p73833
aVInside a message is somewhat trickier; if the list of candidate types is small, then a reasonable workaround is something like presented here: Protobuf attributes with a hierarchy of generic classes, i
p73834
ag50
aVtreating each anticipated type as a specialization
p73835
aVIf the type can't be predicted, then v2 includes another workaround, but including more metadata than normal; see http://marcgravell
p73836
aVblogspot
p73837
aVcom/2011/03/objects-graphs-and-all-that-jazz
p73838
aVhtml
p73839
as(dp73840
g18
V23354
p73841
stp73842
a((dp73843
g2
(lp73844
VWithout explicit numbers, enums increment by 1 each time (even with  specified), so you get:
p73845
aVwhich is simply not the numbers you wanted (and certainly isn't bitwise flags which are typically successive powers of 2)
p73846
as(dp73847
g18
V23354
p73848
stp73849
a((dp73850
g2
(lp73851
VThink about load-order
p73852
aVIn order to JIT and invoke Main, it must understand Program
p73853
aVIt can't understand Program without loading the base-class, which needs special handling
p73854
aVThe event doesn't fire because it hasn't registered yet (because Main hasn't started)
p73855
aVThat cannot work
p73856
aVThe only way you can do this is to have an entry-point that doesn't depend on anything else
p73857
aVNote that JIT is done before the method starts, so the Main also can't involve anything that isn't known
p73858
aVFor example, you might do:
p73859
aVNote we need 2 methods above since it can't JIT Main unless it can fully resolve Program
p73860
aVWith the above, the event should fire just before MainCore() is invoked (I
p73861
ag50
aVDuring JIT for MainCore)
p73862
as(dp73863
g18
V23354
p73864
stp73865
a((dp73866
g2
(lp73867
VThey are identical
p73868
aVThe only difference is the ability to put extra things (types, using-directives) just inside the outer  in the top example (which may or may not be a good idea)
p73869
aVI don't think I've ever used the first version in real code
p73870
aVThe second version is preferred, usually
p73871
as(dp73872
g18
V23354
p73873
stp73874
a((dp73875
g2
(lp73876
VI still need to assess the impact (not something to dry doing while my head feels like cheese), but there is a
p73877
aVtrouble-spot with the root object in the graph - meaning: because I usually handle the reference tracking while walking the association, and on the root object there is no association
p73878
aVI guess I can probably address this with some type-level attribute instead (i
p73879
ag50
aValways treat as a reference)
p73880
aVAnyway, for now you can side-step this by adding one more level to the graph (artificially adding an association), i
p73881
ag50
as(dp73882
g18
V23354
p73883
stp73884
a((dp73885
g2
(lp73886
VFirst, note that LINQ-to-SQL is not (AFAIK) validated for use on Access
p73887
aVIt generally works, but MMMV
p73888
aVPersonally, I would approach this by importing (migrating) the tables from the Access database into a SQL Server Express instance, and using that to generate the model (of course, the tooling might even work against Access, but I assume they don't - hence the question)
p73889
aVWith the model generated, you should be able to point it (at runtime - via connection-string or connection) at your access database instead
p73890
aVYou might also consider: why not leave it as a SQL Server Express node - it works well, and is better supported in terms of LINQ-to-SQL
p73891
aVNote also that there are other LINQ-to-SQL-like tools that may work for your purposes; DbLinq, dapper-dot-net, etc - and a few more heavy-weight tools (EF, NHibernate, LLBLGen Pro, etc)
p73892
as(dp73893
g18
V23354
p73894
stp73895
a((dp73896
g2
(lp73897
VIn "v2", the available subtypes can be defined (against a RuntimeTypeModel) on the fly at runtime via  (in fact, all the attributes now only serve as a default configuration for the type-model, which can be configured any which way)
p73898
aVHowever, I should stress that v2 is currently in beta, and as noted in the blog the WCF hooks are currently not included in the beta, purely while I finish validation etc
p73899
aVHowever, I expect that with your setup as shown in the question it should be trivial (it will merely be a case of passing the model into the  implementation provided)
p73900
as(dp73901
g18
V23354
p73902
stp73903
a((dp73904
g2
(lp73905
VIf you are serializing homogeneous data, the field-number is largely irrelevant, with the minor caveat that keeping it as 1 (aka ) it is trivial to read it back as a list if you want (but pretty easy either way)
p73906
aVIn the case of heterogeneous data, as in this example - there is a non-generic API designed for this purpose (in fact, in v2 all the APIs are non-generic - the generic API simply forwards to the non-generic)
p73907
aVBy passing in a , you can tell it on the fly how to interpret any tag encountered (at the root of the stream)
p73908
aVIf you choose to return  for a given tag, it assumes you aren't interested in that object and skips it entirely (in the example below it will just blow up, obviously - but that is just because the example code is minimal):
p73909
as(dp73910
g18
V23354
p73911
stp73912
a((dp73913
g2
(lp73914
VActually, I'm quite surprised that didn't throw an exception - I will investigate
p73915
aVIn order for that to work, the base-type must have a unique way to indicate each of the sub-types
p73916
aVThis can be specified via attributes, or (in v2) at runtime
p73917
aVFor example:
p73918
aVThere's nothing special about  except that it shouldn't collide with any other members defined for that type
p73919
aVMultiple subtypes can be defined (with different tags)
p73920
aVNote also that protobuf-net doesn't look at , so you don't need that unless you are also using  (or similar)
p73921
aVSimilarly,  should advertise its expected subtypes, and should indicate the members to serialize (and against which tag)
p73922
as(dp73923
g18
V23354
p73924
stp73925
a((dp73926
g2
(lp73927
V is used to specify derived types, along with their identifier; for example (full code):
p73928
aVThe above configures the entire type model at runtime, but you can also mix-and-match between automatic (via properties) and explicit (through code)
p73929
as(dp73930
g18
V23354
p73931
stp73932
a((dp73933
g2
(lp73934
VOh, on second glance this is easier than I dared hope
p73935
aVIf you are using a custom model, you need to use the methods exposed on
p73936
aVThe v1 API (i
p73937
ag50
aV) is now just an indirection to
p73938
aVTry:
p73939
aVNote also that the newly created object may come in as  - in my local repro I added:
p73940
aVto the operator
p73941
aVWhen I feel less grotty, I'll take and look and see if it makes sense for the library to ensure as non-null
p73942
as(dp73943
g18
V23354
p73944
stp73945
a((dp73946
g2
(lp73947
VIf you compile it without the  symbol defined, then no calls to  will be compiled (the methods are defined with )
p73948
as(dp73949
g18
V23354
p73950
stp73951
a((dp73952
g2
(lp73953
VYou could reduce the duplication by making the base field available:
p73954
aVand cast at the sub-type (since you expect your choice of  to be respected):
p73955
aVYou could also do something with generics on the base-type (to avoid the cast) but I'm not sure it is worth it
p73956
aVNote, however, that this might explode if the base-class decides to inject a decorator abound  (if the decorator doesn't provide the second interface)
p73957
as(dp73958
g18
V23354
p73959
stp73960
a((dp73961
g2
(lp73962
VBefore about 2 minutes ago, it was illegal because known-types weren't supported against interfaces
p73963
aVNow, that usage is illegal because it can't safely serialize  because it has no setter
p73964
aVHowever, as long as we restrict ourselves to interfaces members that can be sensible serialized, or members on the concrete type, this is now committed
p73965
aVUsing either attributes or the type model
p73966
aVSee here for the scenarios that are now available (via either code, or the next public drop)
p73967
as(dp73968
g18
V23354
p73969
stp73970
a((dp73971
g2
(lp73972
VYou are out to test me ;p
p73973
aVThat wasn't directly exposed; google isn't letting me commit at the moment, but the following will work as soon as I can commit:
p73974
as(dp73975
g18
V23354
p73976
stp73977
a((dp73978
g2
(lp73979
VThat isn't available on the http-request, but if javascript is enabled, it is available there via
p73980
aVYou may also want to compare the time in javascript to the server-time (which you could send down in the response as milliseconds since Jan 1 1970) to get a more accurate delta to the server
p73981
aVYou can of course use javascript to populate a hidden form-field so your server can know the time, but that excludes the first request
p73982
aVIMO, it is simpler to just handle the time offsets at the UI
p73983
aVNote also that you can't do much if javascript is disabled (except maybe a drop-down of possible offsets to choose from)
p73984
as(dp73985
g18
V23354
p73986
stp73987
a((dp73988
g2
(lp73989
VFrom how I read it, all you need is:
p73990
aVThis addresses:
p73991
aVthe issue of returning multiple descendants
p73992
aVthe issue of firstname/lastname not being specified
p73993
aVif you intent there to only be one, then use  /  /  /
p73994
as(dp73995
g18
V23354
p73996
stp73997
a((dp73998
g2
(lp73999
VSo
p74000
aVjust count from 1 to 15 (=(2^n)-1), and write as binary, perhaps using shift operations
p74001
aVThis is sane for small numbers
p74002
aVbut gets rather large quite quickly
p74003
aVFor 64 items you can model in a long, but that is  18,446,744,073,709,551,615 combinations
p74004
aVhint: you are never, ever, ever going to loop that far
p74005
aVFor small cases:
p74006
as(dp74007
g18
V23354
p74008
stp74009
a((dp74010
g2
(lp74011
VA connection will not close on its own, no
p74012
aVThe main times a connection would close would be:
p74013
aVdisposal (for example via a  statement)
p74014
aVexplicit call to
p74015
aVa command is executed with the  behaviour
p74016
aVgarbage collection - kind-of (although this is a bit different, really)
p74017
aVthe server ceases to be available
p74018
aVThe first is very possible if you are actually getting an exception (maybe timeout or deadlock), bouncing through the  block (disposing it), and perhaps swallowing the exception
p74019
aVThe third is very possible in well-meaning code
p74020
aVTo investigate, you could subscribe to the  event and add a break-point in the handler; then walk backwards through the stack trace and you'll know exactly who is closing it, and why
p74021
aVIf you use the connection beyond the scope of this code, remember to unsubscribe too
p74022
as(dp74023
g18
V23354
p74024
stp74025
a((dp74026
g2
(lp74027
VThis is simply a bug (thank you for exercising the beta so thoroughly
p74028
aV- in the dynamic/reference handling it was double-counting the object (once as part of the shim wrapper it spoofs to do the magic, and once for the object itself)
p74029
aVFor efficiency, the recursion detection only kicks into full gear beyond a specific depth
p74030
aVYour code tripped this depth, causing the double-counting to be seen as recursion
p74031
aVI have fixed this in the code
p74032
aVThe code above passes locally, and will be in the next drop
p74033
as(dp74034
g18
V23354
p74035
stp74036
a((dp74037
g2
(lp74038
VIMO the sane way to handle this is with any form of queue
p74039
aVA simple database table (or a redis list) would suffice
p74040
aVYour service should simply check: is there work to do
p74041
aVI'd so: do it, otherwise sleep for a short period and re-query
p74042
aVAs an optional extra, something like pub/sub could be used for faster wake-up so there is no perceptible delay between enqueue and dequeue - but ideally the queue/poll loop should work without this extra
p74043
aVThen, the batch process is simply: add the work to the queue
p74044
aVOptionally, you might allow priority, such that a moderator (or other "live" user) gets work ahead of background processing
p74045
aVIt is possible to run the same exe as a service multiple times (giving it different service names), but each requires explicit setup
p74046
aVTo be honest, it isn't worth it in your scenario : a simpler option would be to have more than one worker thread servicing the queue, which can be done within a single process
p74047
as(dp74048
g18
V23354
p74049
stp74050
a((dp74051
g2
(lp74052
VThis scenario is exactly what the TPL is designed to achieve, in particular , or  in C# 5 parlance
p74053
aVNote that async
p74054
aV= threading (although they are related), but the point is that you are actually trying to execute 100k tasks, not 100k threads
p74055
aVThese two concepts are different
p74056
aVThe TPL is the right way to do this
p74057
aVAlways use an appropriate tool for the job
p74058
aVI'll happily whip up a TPL example if you want
p74059
aVsomething not too far to:
p74060
as(dp74061
g18
V23354
p74062
stp74063
a((dp74064
g2
(lp74065
VRight; Mex/generation hasn't included the numbers, but you can add them
p74066
aVIn a separate code file (same namespace), add
p74067
aVSometimes WCF helps, sometimes it is a pain (note it works easy if you have a shared DTO assembly at both ends)
p74068
aVSometimes WCF gives the right-ish numbers on each DataMember, but off-by-1 - if that happens there's a tweak you can use to just tell protobuf to use those numbers with an offset
p74069
as(dp74070
g18
V23354
p74071
stp74072
a((dp74073
g2
(lp74074
VI am not aware of any way to do that
p74075
aVUnless your  is large, that extra step probably isn't going to hurt you, and at least it is local - and if it is large, your main problem is bandwidth, which will be the same either way
p74076
aVYou can expose the data as  in the message, which will avoid this step - but then callers will need to know to recognise it as an  (as all they will see in the mex/wsdl is a chunk-o'-xml)
p74077
aVUltimately, part of the reason it is doing this is that WCF is an object based model, and the serializer can actually be swapped via many tricks - so in terms of the regular WCF model, the fact that you have xml is irrelevant: that might not actually be anything like what goes down the wire
p74078
aVIt needs the object so it can ask the actual serializer to do the job
p74079
as(dp74080
g18
V23354
p74081
stp74082
a((dp74083
g2
(lp74084
VI'm still waiting for more info, but ultimately inheritance from the open-generic type is a bit tricky
p74085
aVPerhaps if I understand the exact model I could add more, but the following works:
p74086
aValthough actually the relationship between  and  is entirely unnecessary unless you need it:
p74087
as(dp74088
g18
V23354
p74089
stp74090
a((dp74091
g2
(lp74092
VNot inbuilt, but you could just use either a regex, or :
p74093
aVor
p74094
as(dp74095
g18
V23354
p74096
stp74097
a((dp74098
g2
(lp74099
VIt can't possibly use  to sort - knowing whether two things are equals doesn't help you rank them
p74100
aVHowever, it can use  if your types implement it, or any  (including ) to provide a custom comparer object
p74101
aVThe functional style () is convenient too, for ad-hoc sorting without lots of code:
p74102
aVbut if you just want a simple ordinal sort, have your  implement , and just use:
p74103
as(dp74104
g18
V23354
p74105
stp74106
a((dp74107
g2
(lp74108
VWhen I see users report this type of message, it almost always means they've corrupted the file
p74109
aVStarting from a  is a worrying sign, as protocol buffers is a binary format that cannot be represented in a text encoding (unless you count base-64 etc)
p74110
aVAnother common cause of this is over-writing a file with less data and not trimming the excess
p74111
aVSince protocol buffers includes (for the root message) neither a length prefix nor a terminator, any excess data (essentially garbage now) from previous file contents will be processed
p74112
aVThis is a bad thing; you must always trim your outputs when over-writing
p74113
as(dp74114
g18
V23354
p74115
stp74116
a((dp74117
g2
(lp74118
VIt sounds simply as though your model is unaware of the fact that it is an identity; the  column should be marked as db-generated ( in the UI, or  in the xml), and probably as the primary key
p74119
aVThen it will not attempt to insert it, and will update the value correctly after it is written
p74120
as(dp74121
g18
V23354
p74122
stp74123
a((dp74124
g2
(lp74125
VThe SQL is chosen based on the server at runtime
p74126
aVThe IDE-generated code (C# etc) is not version-specific
p74127
aVNo, you don't have to do anything to re-target a different DB version
p74128
aVHowever, some code will fail against SQL2000 if you try that
p74129
aVIt is simply not possible (at least, conveniently or sanely) to do some of the skip/take/etc without reasonable DB support
p74130
aVSome things it can do
p74131
aVSome things it can't
p74132
aVYou will need to integration-test your app for that platform
p74133
as(dp74134
g18
V23354
p74135
stp74136
a((dp74137
g2
(lp74138
VYou want to build JSON, right
p74139
aVand apparently it is ridiculous of me to suggest a JSON serializer
p74140
aVyet:
p74141
aVIn the majority of cases, using a pre-canned serializer is both more convenient and more robust against edge-cases of data
p74142
as(dp74143
g18
V23354
p74144
stp74145
a((dp74146
g2
(lp74147
VAny time you are doing that amount of sequential data access, a few obvious questions (that have nothing to do with LINQ-to-SQL vs raw ADO
p74148
aVNET) are:
p74149
aVcould you pull lists rather than gets
p74150
aVcould you do the entire thing at the database
p74151
aVLINQ-to-SQL adds a lot of convenience and static checking, and generally the overheads are pretty minimal; however, if you load lots (thousands) of records into a single data-context the identity-manager has more work to do, which may impact performance slightly
p74152
aVWe also sometimes notice unexplained pauses in LINQ-to-SQL load times (i
p74153
ag50
aVthe TSQL will take 1ms and the object will take 80ms to materialize) - this was sporadic and hard to reproduce, but for bulk work we ended up writing dapper as a drop-in-replacement allowing convenient materialization in a LINQ-to-SQL style way, without that overhead - but also without the ability to mutate it and push changes down ;p Of course, you could try  etc
p74154
as(dp74155
g18
V23354
p74156
stp74157
a((dp74158
g2
(lp74159
VNote I'm assuming you just have the data part of the string, not an entire JSON fragment - i
p74160
ag50
aVIf the above assumption is wrong and you have a full JSON fragment, just use  to get an object from the data
p74161
aVAnnoyingly,  has encode but not decode
p74162
aVYou could spoof the string into a full JSON object, though - this seems a bit overkill:
p74163
as(dp74164
g18
V23354
p74165
stp74166
a((dp74167
g2
(lp74168
VNote that using strings to sort in orders other than alphabetical is fraught with pain
p74169
aVYou could try using  as a hack, but personally I'd be tempted to write a numerical converting sort (a custom comparer), or (probably more efficient) I might add a pre-computed numerical equivalent, i
p74170
ag50
aVso that  becomes the integer
p74171
aVThen you just sort on  instead
p74172
aVFor example, you could do this in the  setter (and make the numeric value read-only, and only changed by changing the key)
p74173
as(dp74174
g18
V23354
p74175
stp74176
a((dp74177
g2
(lp74178
VTsansactions (and in particular heavy-weights like , even with the LTM) mainly kick in when applying multiple operations, which may span more than one db call
p74179
aVAdding transactions can be important, but it changes the nature of the query; you could introduce deadlocks being the most obvious, but you could also change an intended side-effect of a method that is faulting
p74180
aVIt could also fix an otherwise unintended side-effect
p74181
aVIt changes the locking profile, and it has different system requirements (DTC enabled being the most obvious)
p74182
aVSo don't idly add them
p74183
aVEqually, a lot of read-only view screens don't need any special locking; heck, most list/search/etc wouldn't change in any important way if you saw an in-progress transaction with phantom/dirty/non-repeatable/etc data
p74184
aVPersonally, back when I was using SP-based code, I didn't tend to put the transaction management in the SP - it is often both easier and more appropriate to move that up to a higher level with more sophisticated fault management - i
p74185
ag50
aVpretty much anything except TSQL, which isn't intended to be good at procedural plumbing code like that
p74186
aVIt is good at set-based DML, obviously
p74187
as(dp74188
g18
V23354
p74189
stp74190
a((dp74191
g2
(lp74192
V has particular significance
p74193
aVIn particular, it forms the hub of much data-binding, and largely acts as the canonical way of saying "I'm a bunch of items"
p74194
aVNote also - generics are not convenient via reflection; data-binding struggles a bit with them, preferring non-generic APIs
p74195
aVIt helps that in the binding scenario, the convention used by the data-binding code is that if the list also has a non- indexer:
p74196
aVthen assume the items are List` satisfies admirably
p74197
aVSo; this provides plenty of backwards compatibility with existing code and data-binding support via this
p74198
as(dp74199
g18
V23354
p74200
stp74201
a((dp74202
g2
(lp74203
VI am assuming the connection string doesnt change during execution (you might want to make it readonly)
p74204
aVSince there is no other shared state shown in the question, there are no real problems
p74205
aVHowever, if you have any shared state you have a huge threading problem
p74206
aVAnd if you have shared connections you have an even bigger problem
p74207
aVBut as written, with no significant static fields: no problem
p74208
as(dp74209
g18
V23354
p74210
stp74211
a((dp74212
g2
(lp74213
VThe signature takes object; you need
p74214
aVI also suggest looking at either the ThreadPool or TPL/Task - threads are relatively expensive
p74215
as(dp74216
g18
V23354
p74217
stp74218
a((dp74219
g2
(lp74220
VIt seems to me you should just do some math here first
p74221
aVFind the number of groups you need (div) and then just divide the total by this to see how many items per group
p74222
aVNow use this value (rather than the 15) in your group-by:
p74223
aVand group by
p74224
as(dp74225
g18
V23354
p74226
stp74227
a((dp74228
g2
(lp74229
VYou aren't cleaning the variables between tests, so (for all but the first) initially  is  and  is  - before  has done anything
p74230
aVcan get that initial value of  (so  is ), and then  can get in, get as far as changing  to
p74231
aVNow  reads the  (so  is )
p74232
aVEt voila
p74233
aVNo re-order necessary to repro
p74234
aVReset  and  to  between runs and I expect it will go away
p74235
aVedit: confirmed; "as is" I get the issue almost immediately (<2000 iterations); but by adding:
p74236
aVit then loops for any amount of time without any issue
p74237
aVOr as a flow:
p74238
as(dp74239
g18
V23354
p74240
stp74241
a((dp74242
g2
(lp74243
VBasically, you can't nicely;
p74244
aVtreating as  or an interface: boxed
p74245
aVwrap in a generic type with an abstract base-class: re-inventing a box
p74246
aVreflection: uses , boxed
p74247
aV: essentially , boxed
p74248
aVThere is the option, however, of encapsulating the object in a bigger struct, i
p74249
ag50
aVnow, this should work but hsa the downside of being much bigger, obviously
p74250
aVYou might be able to work around this using explicit-layout to position them all at byte 0 (making a union), but I suspect this isn't allowed on xbox
p74251
aVBut on regular
p74252
aVNET:
p74253
as(dp74254
g18
V23354
p74255
stp74256
a((dp74257
g2
(lp74258
VSerialization is fundamentally about transporting data
p74259
aVInterfaces are about describing behaviour
p74260
aVFundamentally these two things are completely orthogonal, IMO
p74261
aVYou can possibly make it work with  - and it would certainly help if you were using the same exact types at each end (assembly sharing), but this is very non-portable
p74262
aVIf you are after the idiomatic WCF usage for portability, you should probably restrict yourself to simple data contracts, which stand a chance of being useful to clients who know only the WSDL
p74263
aVThat said, I have no qualms torturing and abusing WCF to my own ends when it suits me ;p
p74264
as(dp74265
g18
V23354
p74266
stp74267
a((dp74268
g2
(lp74269
VI think you should replace that struct with a class of your own, only using the struct for portability
p74270
aVStructs should be immutable; as such, there is rarely anything interesting to observe
p74271
aVAnd due to value semantics, each observer might be seeing a different value (or maybe boxed object)
p74272
aVStructs and events don't mix well
p74273
as(dp74274
g18
V23354
p74275
stp74276
a((dp74277
g2
(lp74278
VThe OUTPUT clause will give you back the records you have just inserted: http://msdn
p74279
aVmicrosoft
p74280
aVcom/en-us/library/ms177564
p74281
aVaspx
p74282
aVIf you mean the rows inserted before the trigger invoked, they are in the  pseudo-table
p74283
as(dp74284
g18
V23354
p74285
stp74286
a((dp74287
g2
(lp74288
VNo nice way
p74289
aVyou can hack your way in, though
p74290
aVFor example imagine you have a  object that you know is keyed by :
p74291
aVPretty-much every access is non-public; I would expect this to suck performance-wise unless you use  to spoof access from another type
p74292
aVAnd as a  version:
p74293
aV(yes, I'm hard-coding to an  key
p74294
aVyou could make it any single-value by replacing the  with , and just drop the  - or you could make it a  argument and pass it in directly)
p74295
as(dp74296
g18
V23354
p74297
stp74298
a((dp74299
g2
(lp74300
Vyou say  is a ; now, s are immutable, so that hasn't changed during the method - and the parameter  is not by-ref (), so that hasn't changed during the method
p74301
aVappears (hard to say) to parse the string to an object, so there is no shared state there unless you have some cache that you haven't told us about
p74302
aVSo
p74303
aVthis is just a parsing bug in your code; nothing to do with threading
p74304
aVNote: method parameters and variables are per call - they are isolated (unless they refer to shared state)
p74305
aVThis is not a threading issue
p74306
aVJust a run-of-the-mill bug
p74307
aVAt some point during parsing, you've called it an apple, but assigned it an orange
p74308
aVTrace through  to find it, looking in particular at where  and  get assigned
p74309
aVAs an aside -  is a bad idea in general; in this case, it also does nothing useful since you have no shared state to protect
p74310
aVIf there was a use, having a dedicated object for this would be preferred:
p74311
as(dp74312
g18
V23354
p74313
stp74314
a((dp74315
g2
(lp74316
VIn discussion of WCF you are essentially talking about a DTO
p74317
aVIt would be a fair argument to say that if the serialization is different, then it isn't the same DTO, since the entire purpose of the DTO is to allow appropriate serialisation
p74318
aVSo my answer would be: have multiple parallel DTO classes representative of the needs of the different APIs, and translate between them
p74319
aVYou might be able to work some magic by specifying the serializer at runine, but that is more brittle and hard to configure
p74320
as(dp74321
g18
V23354
p74322
stp74323
a((dp74324
g2
(lp74325
VLargely this simply a matter of validation / timing with the beta
p74326
aVThere are also a number of tweaks logged in the code-gen area that I want to address, which I plan to address shortly
p74327
aVHowever, there is a functional reason I haven't included it: by default (IIRC) it includes round-trip safe objects, using the unknown-fields API (extension fields)
p74328
aVThis feature is not in the current beta drop (you can do a vast amount without it)
p74329
aVIf you don't request round-trip safe objects, the existing protogen should emit C# that is compatible with v2 (the entire v1 API is retained for both compatibility and convenience)
p74330
as(dp74331
g18
V23354
p74332
stp74333
a((dp74334
g2
(lp74335
VThe domain is very important, an you will need a DNS mapping for the domain, and an IIS (or whatever web-server) mapping for the domain/subdomain (or alternatively: a wildcard mapping)
p74336
aVAs part of adding the IIS mapping, you also need to decide whether those two domains are in the same IIS application, or 2 different applications
p74337
aVDifferent applications may be easier to configure (especially if they point to different folders on disk, with different configurations), but a shared application (multi-tenancy) can be more efficient in terms of fewer app-startups, etc
p74338
aVOf course, it helps if you've designed for multi-tenancy from the start, in terms of cache key names, configuration data, etc
p74339
as(dp74340
g18
V23354
p74341
stp74342
a((dp74343
g2
(lp74344
Vit really depends on the implementation
p74345
aVMost implementations will not love you if you change the collection during enumeration - and will throw an exception deliberately
p74346
aVHowever, it is possible (mainly for append-only collections, but possible for all) to write an enumerator that is safe (for example, by enumerating as far as existed when it was created - but multiple designs are possible)
p74347
aVPersonally, I would avoid the scenario; it is better to design it so that you are either enumerating or mutating, but never both
p74348
aVIf you can't use a collection that supports concurrent enumerate and mutate, then taking a copy is feasible, but again - not my preferred option
p74349
as(dp74350
g18
V23354
p74351
stp74352
a((dp74353
g2
(lp74354
VIt depends in part on whether the ids for your statuses have guaranteed values, or whether the ids could change per-database (via an )
p74355
aVPersonally, for statuses I prefer fixed - which gives you the most flexibility, and least overhead - you can choose to use an enum (or maybe some consts if more convenient), and you never have to add an indirection, i
p74356
ag50
aV"get the id that is "
p74357
aVThis isn't always possible, though, and when it isn't it is still definitely useful to cache and re-use them (to avoid hitting the DB for that lookup)
p74358
aVHowever, I would avoid a singleton, not least because it won't play nicely if you ever need to talk to more than one database - the ids in each could well be different
p74359
aVHowever, any suitable cache implementation (or maybe IoC/DI) should allow you to store the appropriate data (probably some kind of dictionary)
p74360
aVSingletons are also just a bit of a pain generally if you like testing etc
p74361
aVBut: an enum and fixed id values is a lot simpler
p74362
aVNote that under any implementation, changing the status list is a non-trivial operation, not least it will be a big  (or several if you are denormalized)
p74363
as(dp74364
g18
V23354
p74365
stp74366
a((dp74367
g2
(lp74368
VIf it must be exactly 4, then you need to use $ and ^ to mark end and start of the input:
p74369
aVNote I'm also using verbatim string literals here, so save on sanity - then you don't need to C#-escape all your regex-escape-characters
p74370
aVOnly  needs escaping in the C# (to )
p74371
as(dp74372
g18
V23354
p74373
stp74374
a((dp74375
g2
(lp74376
VThe idea here is that if you want, you can save resources by using different serialization in different scenarios
p74377
aVFor example, it might be that some of your data is in some OS resource that will work for your entire process
p74378
aVIf you have multiple s in a single process, and are using remoting to talk between them, then when you spot the  option you might just copy the underlying OS handle - that existing handle is just as valid from either , since the OS handles don't really know about app-domains
p74379
aVIIRC,  is actually valid over an entire process space, without need to serialize - so that might be an interesting case to just keep the reference
p74380
aVOther options would be same-app-domain, same-machine, different-machines, etc
p74381
aVIMO though, this just exposes you to additional complexity
p74382
aVIt would only be worth worrying about in very specialized scenarios
p74383
aVIn the general case it is better just to serialize to a pre-defined storage representation, and rehydrate
p74384
as(dp74385
g18
V23354
p74386
stp74387
a((dp74388
g2
(lp74389
VYou are setting up an open connection, etc - and not disposing it
p74390
aVIt isn't actually clear to me why, since this is all for the adapter () that you don't actually seem to use
p74391
aVHowever: in general, you should use  around all such () objects:
p74392
aVThis ensures the object is disposed cleanly and quickly - putting the underlying connection back into the pool
p74393
aVThe same applies to any other objects that implement  - for example, probably the transaction too
p74394
as(dp74395
g18
V23354
p74396
stp74397
a((dp74398
g2
(lp74399
VIn a flags enum,  should be zero, and  should be the cumulative bitwise sum
p74400
aVThis makes the maths pretty easy, then:
p74401
aVmaybe written as a  if you prefer
p74402
aVHowever, in the general case, you can test for a complete flags match (against any number of bits) with:
p74403
aVand to test for any overlap (i
p74404
ag50
aVany common bits -  needs to be non-zero):
p74405
as(dp74406
g18
V23354
p74407
stp74408
a((dp74409
g2
(lp74410
VNot simple; you need to rewrite all the expressions - well, strictly speaking you can recycle most of one of them, but the problem is that you have different  in each (even though it looks the same), hence you need to use a visitor to replace all the parameters with the final
p74411
aVFortunately this isn't too bad in 4
p74412
aV0:
p74413
aVThis uses the constructor from the first expression found, so you might want to sanity-check that all of the others use trivial constructors in their respective s
p74414
aVI've left that for the reader, though
p74415
aVEdit: In the comments, @Slaks notes that more LINQ could make this shorter
p74416
aVHe is of course right - a bit dense for easy reading, though:
p74417
as(dp74418
g18
V23354
p74419
stp74420
a((dp74421
g2
(lp74422
VThe whole point of the await-based code is that it is indeed "execute the next stuff when this is finished" (a callback), and not "block the current thread until this has finished"
p74423
aVAs such, from  you get back a task, but that task is not yet complete
p74424
aVWriting the task to the console does not mean it waits for it to complete
p74425
aVIf you want to block on the task's completion:
p74426
aVor more explicitly:
p74427
as(dp74428
g18
V23354
p74429
stp74430
a((dp74431
g2
(lp74432
VEvents are usually intended for optional consumption by the calling code of the object - for example, as an observer (or multiple observers)
p74433
aVIt is pretty rare that handling the event is enforced
p74434
aVThere is no standard language / compiler construct for verifying an event gets subscribed at compile-time (and I suspect it would be very hard, since you could validly subscribe/unsubscribe at any time, at any place in the code - possibly multiple times, i
p74435
ag50
aV+HandlerA, +HandlerB, -HandlerA, -HandlerB - which ends with no subscribers)
p74436
aVIn the scenario you present, where it is required, then passing it in to the constructor sounds more appropriate, but I would probably use  or  in this case (not )
p74437
aVBut that is subjective
p74438
aVOther approaches:
p74439
aVmake it an abstract class and force the consumer to subclass and  one-or-more  members
p74440
aVhave an  parameter that the consumer must supply
p74441
as(dp74442
g18
V23354
p74443
stp74444
a((dp74445
g2
(lp74446
VA process ID is only meaningful while the process is alive
p74447
aVThe first thing to check is  - if this is true, ignore the process ID; it no longer has any meaning
p74448
aVThere are a number of ways you can start something and have no process left even though you can apparently see it still on screen:
p74449
aVif it is a script/bat/cmd that spawns something and exits (remember: you are watching the script, not the "something")
p74450
aVif the exe does some inter-exe voodoo internally - for example, most of the office apps and internet explorer do this; if there is an existing process, it forwards the args to that process to handle, and exits immediately
p74451
as(dp74452
g18
V23354
p74453
stp74454
a((dp74455
g2
(lp74456
VIf you want your documentation to contain anything except the things that are already obvious from the signature, the only useful tool here is
p74457
aVyou
p74458
aVThat and some  (C#) or  (VB) fun
p74459
aVThere are tools that will generate things like "gets or sets the FrobCount", but ultimately
p74460
aVwhat did you think the  property did
p74461
aVBTW, by this I don't mean "don't bother adding those comments" - they do have some sense
p74462
aVbut my concern is that you get into the habit of just using the automatic tooling
p74463
aVUltimately, this adds very little extra value
p74464
aVThe value comes from knowledge about the semantics, expected usage, side-effects etc
p74465
aVNo automated tool will generate that
p74466
as(dp74467
g18
V23354
p74468
stp74469
a((dp74470
g2
(lp74471
VYou need to use the boxed version (you currently create , but base your final query instead on ):
p74472
aVRe why this isn't implicit - there simply is no implicit casting here;
p74473
aV= C#
p74474
aVBoxing is a non-trivial operation, and the  API requires a specific node in the tree
p74475
as(dp74476
g18
V23354
p74477
stp74478
a((dp74479
g2
(lp74480
VThe path is relative to the current request, so  might have a different result on requests at different urls
p74481
aVHowever, if your path is relative to the app-root () or relative to the site-root () you can pretty much cache to your heart's content
p74482
aVThere is perhaps an edge-case scenario of people adding virtual directories inside IIS during execution, but that is vanishingly unlikely,  and is pretty-much going to cause pain anyway
p74483
as(dp74484
g18
V23354
p74485
stp74486
a((dp74487
g2
(lp74488
V is generally fine, but   (available from Mono) may have more options if the assembly you are generating is not for the same platform (i
p74489
ag50
aVyou want to build a silverlight dll from your compiler, which is written in "full"
p74490
aVNET)
p74491
as(dp74492
g18
V23354
p74493
stp74494
a((dp74495
g2
(lp74496
VYou can't have a generic field; you can, however, push this into a generic static type:
p74497
aVand use
p74498
aVYou might want to tidy that up, though (the internal field, etc)
p74499
as(dp74500
g18
V23354
p74501
stp74502
a((dp74503
g2
(lp74504
VThe  and  modifiers in 4
p74505
aV0 are necessary to enforce (or rather: enable) covariance and contravariance
p74506
aVIf you add , you are only allowed to use  in inwards (contravariant) positions - so things like  is fine, but  is not as this is an outwards (covariant) position
p74507
aVThis is essential for the variance features in 4
p74508
ag190
aVWith variance,  and  are both unavailable (they are both, and as such: neither)
p74509
as(dp74510
g18
V23354
p74511
stp74512
a((dp74513
g2
(lp74514
VI think it is happening all the time; however, binding errors are usually silently ignored (for example, BindingSource
p74515
aVDataError )
p74516
aVVisual Studio catches exceptions that are handled - to highlight fail
p74517
aVHaving a data-bound control (DataGridView) and binding-aware collection is asking for trouble if you then update that from another thread
p74518
aVThe "observer" nature leads it to do updates on the UI thread
p74519
aVI have hacked around this in the past, but I kinda think you should disable the data-binding completely and update manually
p74520
aVAnd don't forget that manual update and the background edits should both synchronise access so they don't fight
p74521
aVDepending on how exactly you are doing the binding, you should be able to disable it and manually refresh it in a loop
p74522
as(dp74523
g18
V23354
p74524
stp74525
a((dp74526
g2
(lp74527
VIt is run-time binding (if that is even the right phrasing - I'm not convinced) because even with a  variable you could actually have:
p74528
aVhere the variable is a , but the object is a
p74529
aVYou could argue that maybe if it was  etc, but actually even non-virtual instance (non-static) methods go through the callvirt process
p74530
aVIt works well, and is very fast
p74531
aVAdditionally, the callvirt opcode has the necessary null-check, which means your code doesn't (under the bonnet) have to constantly check for nulls (which would be necessary if it was static-call)
p74532
aVThe only exception here is s which override an  method; the following is a static call:
p74533
as(dp74534
g18
V23354
p74535
stp74536
a((dp74537
g2
(lp74538
VImportant caveat: both of these tools are in pain - since the vendor fired the dev team (read the "Fighting for Your Right to Party" paragraph)
p74539
aVHopefully soon to be replaced by Xamarin
p74540
aVMonoDroid does exactly that for android development
p74541
aVFor iPhone, you need to be on a mac, and it runs inside MonoDevelop - but ultimately the code is pretty similar
p74542
aVI would expect any Xamarin tools be have similar architecture
p74543
as(dp74544
g18
V23354
p74545
stp74546
a((dp74547
g2
(lp74548
VAt the moment - in short, no
p74549
aVIt needs to have a basic understanding of how you intend it to operate
p74550
aVI guess maybe I could add something to let you specify a default strategy for completely unadorned types (things that aren't ,  or ), but the most appropriate option there would be "all public members" (much like )
p74551
aVThe reason I don't want to encourage this is that it is brittle
p74552
aVBecause of how the protobuf spec is defined, all you get is field-numbers
p74553
aVIt is easy enough to say "ok, order them alphabetically and use their positions", but that is not safe if you ever want to change the type
p74554
aVAnd let's face it, we all do
p74555
aVYou'd be amazed how often I add an  property, which messes with alphabetical orderings
p74556
aVHence, I don't want to make it easy to get people into a position where they risk data integrity
p74557
aVBecause I don't like people shouting at me
p74558
aVIf there was a global default policy, it would be easy to use that policy without realising it, which is when you start getting into trouble
p74559
aVI do, however, intend making it easier to choose those strategies on a per-type basis (the code all exists, it just isn't in the public API) - for example:
p74560
aV(the  stuff already exists, back to v1 days) or maybe just:
p74561
aVany help
p74562
aVdoes the reasoning make sense
p74563
as(dp74564
g18
V23354
p74565
stp74566
a((dp74567
g2
(lp74568
VIf you type space, or just tabspace you will get this list
p74569
aVSelect the one you want tab and it will generate the full  signature and place you in the body (the caret will be placed immediately before the  call it generates)
p74570
as(dp74571
g18
V23354
p74572
stp74573
a((dp74574
g2
(lp74575
VIt isn't entirely clear without a reproducible example, but IMO the most likely answer here is that you are overwriting an output stream (such as a file) without truncating it
p74576
aVBecause the protobuf spec does not include terminators (etc) for the root object, it reads to the end of the file
p74577
aVIf you then overwrite with less data, any contents not truncated are garbage
p74578
aVNow, if the change means the garbage at the end doesn't parse as protobuf, you'll get an exception, like this
p74579
aVHowever, if the data is still valid (because, for example  is the last item in the stream) then it'll just read it and process it
p74580
aVIn particular, setting a collection results in that item not being written, hence why setting it to null still leaves a valid stream (if it is the final field to be serialized)
p74581
aVIf you aren't already doing so, ensure you trim your outputs (2 simple ways of doing this are shown in the post linked above)
p74582
aVIf this is unrelated, then I apologise - but without further information / a reproducible example I have to use a little guesswork ;p
p74583
as(dp74584
g18
V23354
p74585
stp74586
a((dp74587
g2
(lp74588
VYou are including a lot of 0 characters, since you are including the entire  in getstring
p74589
aV0s don't print, but they are there
p74590
aVYou must tell it the correct number of bytes to decode
p74591
as(dp74592
g18
V23354
p74593
stp74594
a((dp74595
g2
(lp74596
VThe compiler will already do that for you - you should actually see:
p74597
aVThe type 'int' must be a reference type in order to use it as parameter 'T' in the generic type or method 'blah
p74598
aVMyGenericMethod(T)'
p74599
aVat compile-time
p74600
aVThe tricky scenarios are:
p74601
aVgenerics upon generics upon generics - all those type-constraints stack, so you end up with  a lot
p74602
aVSometimes it is better to use runtime validation against
p74603
aVreflection (, etc) - again, just check at runtime
p74604
aVAlso, note that  doesn't actually mean  is a class - it means it is a reference-type, which can include interfaces and delegates
p74605
aVLikewise,  doesn't actually mean  is a  - it means it is a struct that is not
p74606
as(dp74607
g18
V23354
p74608
stp74609
a((dp74610
g2
(lp74611
VGenuinely recursive lambdas (and by inference, s) are technically possible but pretty much insane
p74612
aVI would also expect any parser (L2S, EF, etc) except maybe LINQ-to-Objects to just go crazy trying to unpick that
p74613
aVIn short: you would do well to consider this an unsupported mechanism for
p74614
aVFinally, note that just because you are writing an  doesn't mean you are executing it in C# - in fact, quite probably the opposite: if you are actively writing an  (rather than a delegate or procedural code) I assume that it is going to a parser (unless you used  to push it to LINQ-to-Objects)
p74615
as(dp74616
g18
V23354
p74617
stp74618
a((dp74619
g2
(lp74620
VThe way I do that in C# is by using a static method in the pipe, for example:
p74621
aVI assume you can do something very similar in VB
p74622
aV(shared methods
p74623
aVReflector assures me this translates into:
p74624
as(dp74625
g18
V23354
p74626
stp74627
a((dp74628
g2
(lp74629
V is a static method - it is not specific to any single object - indeed, no instance of  is created to call
p74630
aVis an instance method, and needs to be invoked on a single object
p74631
aVTwo options:
p74632
aVmake  static, which makes sense since it uses no state (fields):
p74633
aVcreate an instance in :
p74634
aVThe first is more appealing here
p74635
aVI've included the second purely for completeness
p74636
as(dp74637
g18
V23354
p74638
stp74639
a((dp74640
g2
(lp74641
VYour first example includes just a length; the "with length prefix" actually encodes in a protobuf-compatible stream
p74642
aVIf you are decoding from c++, read two varints; the first is the field-number and wire-type; the second is the length
p74643
aVThe first is packed as 3 bits wire-type, the rest is the field-number
p74644
aVYou might also be able to specify field 0 to skip - I can't recall without checking
p74645
aVUpdate; I checked this out, writing the data without a field-number (just a varint length prefix), and then reading it back in C# using two different APIs - individually with Deserialize, and as an enumerable block via DeserializeItems
p74646
aVI had to fix a bug in the latter, but the following will work from the next code push (note: only the reading code has a fix, so if you are writing in C# and reading in C++ this won't affect you):
p74647
as(dp74648
g18
V23354
p74649
stp74650
a((dp74651
g2
(lp74652
VWith LINQ-to-SQL it will update any IDENTITY (etc) properties during the save automatically, so just look at  (or whatever)
p74653
aVRe knowing it happened: updates etc happen in a transaction; that transaction must have committed to have got out of the method without an exception
p74654
aVIf you have an outer  (or similar) then that it up to you to commit; in short - until you do commit you have a phantom record
p74655
aVAs such, avoid passing that new id anywhere until you have committed all your transactions
p74656
as(dp74657
g18
V23354
p74658
stp74659
a((dp74660
g2
(lp74661
Vtoday it isn't
p74662
aVWe actually investigated table-valed-parameters for our cheeky "in" implementation (), but were very unimpressed by performance
p74663
aVHowever in the context of a SPROC it makes sense
p74664
aVYour best bet is to log this as an issue on the project site so we can track/prioritise it
p74665
aVIt sounds like something will be doable, though, probably similar to the DbString or DynamicParameters options
p74666
aVBut today
p74667
aVNo
p74668
as(dp74669
g18
V23354
p74670
stp74671
a((dp74672
g2
(lp74673
VThe default behaviour for a root object is to consume all data to the end of the stream
p74674
aVAnd since you don't close the stream, that end never comes
p74675
aVIf your intention is to send multiple objects down the same socket (which is pretty normal) then you need to give it a clue
p74676
aVThe most common approach would be to prefix each message with the length of the data about to be sent
p74677
aVThis could be in a fixed-32 int, or in a varint if convenient
p74678
aVYou can then read that at the consumer
p74679
aVHow you then handle that depends on the caller; protobuf-net has a  that will handle various forms of encoding, with-or-without an additional field marker (in the case of varint, to make it a valid protobuf stream)
p74680
aVFor example:
p74681
as(dp74682
g18
V23354
p74683
stp74684
a((dp74685
g2
(lp74686
VC is useful to allow the engine to understand expression trees, for example a predicate:
p74687
aVWith "a" I would expect this to fail, as it doesn't really know about the property  (only the field  and the database column)
p74688
aVSpecifying the "Storage" in "c" allows the db-value to be saved directly to the field rather than using the property, avoiding code that shouldn't be necessary during materialisation from the db
p74689
as(dp74690
g18
V23354
p74691
stp74692
a((dp74693
g2
(lp74694
VBecause CE is an embedded file-based DB, there is nothing really to start - you just specify the file in the connection string (see MSDN)
p74695
aVEDIT: CE is not supported on web apps until CE 4
p74696
aVHowever, watch out - while it is easy to deploy, CE might not be the best option for a highly threaded environment like a web-server (it is targetted at clients, really - although server usage is supported)
p74697
aVSee here for the TSQL differences, transaction differences, etc
p74698
as(dp74699
g18
V23354
p74700
stp74701
a((dp74702
g2
(lp74703
VIf you are writing with protobuf-net, the WithLengthPrefix methods will do this for you
p74704
aVI'd be more than happy to help with this (I'm the author)
p74705
aVBtw, the reason it is throwing an exception is that a varint value by itself is not normally valid in a protobuf stream
p74706
aVThe system will override this in the case of WithLengthPrefix if you pass 0 as the field number (or pass a positive field-number for a more pure protobuf stream; this is optional, though)
p74707
aVAs it happens there is a method on ProtoReader to read an isolated varint (without worrying about protobuf stream semantics) it would be trivial for me to add such to ProtoWriter if that would be useful
p74708
aVBtw - in terms of PrefixStyle, Base128 is the same as varint
p74709
aVSome folks prefer 32-bit prefixes, to marry up with other systems - hence a few others are provided
p74710
as(dp74711
g18
V23354
p74712
stp74713
a((dp74714
g2
(lp74715
VIt depends on the client :) if the client will accept input from stdin you could push the dta to the client
p74716
aVAnother possibility might be to write a named-pipes server or a socket-server - not trivial, but it may work
p74717
aVHowever, the simplest option is to just grab a temp file and write to that (and delete afterwards)
p74718
aVRemember to clean up the file when you are done
p74719
as(dp74720
g18
V23354
p74721
stp74722
a((dp74723
g2
(lp74724
VI would say bin it
p74725
aVOne of the particular problems with a timeout is that you don't know what happened at the other end, since your client gave up listening
p74726
aVIf you have a stateful connection, all bets are now off
p74727
aVIf you are stateless, you can probably get away with it
p74728
aVIn either event, you might way to validate the current status if you timed out while performing an operation that affects data
p74729
aVIf you were just querying data things are simpler
p74730
as(dp74731
g18
V23354
p74732
stp74733
a((dp74734
g2
(lp74735
VVolatile prevents (among other things) re-ordering, so without volatile it could as an edge condition conceivably (on some hardware) write them in a different order, allowing the flag to be true even though result is 0 - for a tiny fraction of time
p74736
aVA much more likely scenario, though, is that without volatile the hot loop caches the flag in a register and never exits even though it has been changed
p74737
aVIn reality, this is not a good way to handle concurrency, and in particular a hot loop like that is really actively harmful
p74738
aVIn most common cases, a lock or a wait-handle of some kind would be preferred
p74739
aVOr a Task would be ideal if you are up to date in your
p74740
aVNET versions
p74741
as(dp74742
g18
V23354
p74743
stp74744
a((dp74745
g2
(lp74746
VInteresting
p74747
aVThe fact that things are surviving to GEN2 could imply you are holding onto things a bit much - perhaps you have temporary objects that remain reachable by a longer-lived object, perhaps due to an event subscription or a captured variable closure
p74748
aVIt also sounds like allocations themselves might be high; watch out for vast numbers of temp objects (that are somehow reachable)
p74749
aVBut events are IMO the most likely explanation
p74750
aVSee if you are failing to unsubscribe temporary objects from events
p74751
as(dp74752
g18
V23354
p74753
stp74754
a((dp74755
g2
(lp74756
VYou have a couple of options there
p74757
aVIf your type internally knows what has changed, you can use the same pattern as XmlSerializer (IIRC), I
p74758
ag50
aVSecond option would be to create the model on the fly, and only tell it about the members that are changed
p74759
aVHowever, since by default this would cause (over time) lots of dynamic code to be generated, so you might want to set AutoCompile to fse for that case
p74760
aVA third option would be to serialize manually via ProtoWriter
p74761
aVThis probably needs more protobuf know-how than is desirable
p74762
as(dp74763
g18
V23354
p74764
stp74765
a((dp74766
g2
(lp74767
V(from comments)
p74768
aVUsing the generic type 'System
p74769
aVCollections
p74770
aVGeneric
p74771
aVIEnumerator' requires '1' type arguments
p74772
aVThat means you have
p74773
aVand not
p74774
aVswitch to the latter and it will work
p74775
aV/  are the non-generic API
p74776
aVOr better: use  - it is simpler, safer and more correct (you didn't remember to check for , for example)
p74777
aVAdditional notes:
p74778
aVconcatenating strings in a loop is very bad - it causes telescopic string allocations (i
p74779
ag50
aVlots of intermediate strings); something like  is preferred by a long margin
p74780
aVbuilding xml by hand is not ideal - you need to encode etc;  would be ideal
p74781
aVso IMO: use an  that writes to a , using
p74782
aVUntested, but something like:
p74783
as(dp74784
g18
V23354
p74785
stp74786
a((dp74787
g2
(lp74788
VIf you can't specify the subtypes in attributes (because it isn't known at compile-time) you have 2 options (both of which only apply to "v2", available as beta):
p74789
aVuse a , rather than the static  methods (which are now just a short-cut to ); tell the model about the inheritance (example below)
p74790
aVadd  to the  in question
p74791
aVThe second is not very pure protobuf - it embeds type information, which I don't really love but people just kept asking for
p74792
aVThe first is my preferred option
p74793
aVTo add subtypes at runtime:
p74794
aVthe  in the above means "use normal rules to add member properties automatically" - you can also take control of that and specify the properties (etc) manually if you prefer
p74795
aVNote that a  should be cached and re-used (not created per object you need to serialize), as it includes some "emit" code to generate methods
p74796
aVRe-using it will be faster and require less memory
p74797
aVThe type-model is thread-safe, and can be used to serialize/deserialize multiple streams concurrently on different threads
p74798
as(dp74799
g18
V23354
p74800
stp74801
a((dp74802
g2
(lp74803
VIf the 3
p74804
aV5 framework is not installed on the machine that executes this, it will fail as  won't exist
p74805
aVYou can use LINQBridge with
p74806
aVNET 2
p74807
aV0 and C# 3
p74808
aV0 (which will give you access to a re-implementation of LINQ-to-Objects) but in reality it may be easier to get the client to upgrade
p74809
ag5115
aV0 is pretty old now
p74810
aVAlternatively
p74811
aVif all you need is a , there are easier routes
p74812
aVFor example:
p74813
as(dp74814
g18
V23354
p74815
stp74816
a((dp74817
g2
(lp74818
VThat is because the node isn't called response; you need to take the namespace into account:
p74819
as(dp74820
g18
V23354
p74821
stp74822
a((dp74823
g2
(lp74824
VAh, good ol' ; yes, that is:
p74825
aVRe guidance
p74826
aVmy trick if I get stuck is always "compile something similar, and look at it in reflector"
p74827
aVIf you wanted some examples, dapper-dot-net and protobuf-net both do a decent amount of IL - the first is more contained, limited and understandable; the second is all-out, no-holds-barred crazy IL
p74828
aVHints for IL:
p74829
aVtrack the stack in comments at EVERY step on the right hand side of the screen
p74830
aVuse the short-forms of branches etc, but only use them when you know you have a very local branch
p74831
aVwrite yourself a little set of utility methods even for simple things like loading an integer (which is actually quite complex since there are 12 different ways of loading an int-32, depending on the value)
p74832
as(dp74833
g18
V23354
p74834
stp74835
a((dp74836
g2
(lp74837
VMost types are thread-safe to read, but not thread-safe during mutation
p74838
aVIf none of the threads is changing the dictionary, then you don't need to do anything - just read away
p74839
aVIf, however, one of the threads is changing it then you have problems and need to synchronize
p74840
aVThe simplest approach is a , however this prevents concurrent readers even when there is no writer
p74841
aVIf there is a good chance you will have more readers that writers, consider using a  to synchronize - this will allow any number of readers (with no writer), or: one writer
p74842
aVIn 4
p74843
aV0 you might also consider a
p74844
as(dp74845
g18
V23354
p74846
stp74847
a((dp74848
g2
(lp74849
VAt a push - how about a redis node
p74850
aVUltimately though any pub/sub implementation would suffice as long as it handles binary
p74851
aVI happen to like redis as it solves a host of problems in one tool; BookSleeve is a fully async binary-safe redis client that works well with BLOBs such as protobuf fragments
p74852
aVDisclosure: since I wrote both protobuf-net and BookSleeve I might be biased
p74853
as(dp74854
g18
V23354
p74855
stp74856
a((dp74857
g2
(lp74858
VWith generics, you can add a constraint that means the generic-type supplied must meet a few conditions, for example:
p74859
aV-  must have a public parameterless constructor (or be a )
p74860
aV-  must be a reference-type ( /  / )
p74861
aV-  must be a value-type (other than )
p74862
aV-  must be inherited from  (or  itself)
p74863
aV-  must implement
p74864
aVfor example:
p74865
aVit is  and  that are interesting here, as they allow you to demand (and use) functions defined on those types - for example,  gives you access to  etc
p74866
aVHOWEVER
p74867
aVsimply: there is no such mechanism for things like:
p74868
aVconstructors with parameters
p74869
aVstatic methods
p74870
aVoperators / conversions
p74871
aVarbitrary methods not defined via a base-type or interface
p74872
aVso: you can't demand those, and you can't use them (except via reflection)
p74873
aVFor some of those  can be used, though
p74874
as(dp74875
g18
V23354
p74876
stp74877
a((dp74878
g2
(lp74879
VI would do something like (switching to C# as my VB is weak):
p74880
aVLINQ-to-SQL (courtesy of SQL-server) has a foible where that gives  if there are no results, i
p74881
ag50
aVThe key point there (for reading it as VB): switch to  and  it
p74882
aVThen compare to
p74883
as(dp74884
g18
V23354
p74885
stp74886
a((dp74887
g2
(lp74888
VIn that case, yes:
p74889
aVThe problem here though is that you will probably be using DynamicInvoke which is slow
p74890
aVAn  then access by index may outperform an  invoked with DynamicInvoke
p74891
as(dp74892
g18
V23354
p74893
stp74894
a((dp74895
g2
(lp74896
VI suspect it should be possible to tweak the data-contract serializer code for that
p74897
aVI'll take a look
p74898
aVFor now: my advice would be to return an obvious concrete type that has the  as a property
p74899
aVOr maybe return a  instead, which might work
p74900
aVIt sounds reasonable to support this scenario, though
p74901
aVI'll see what I can do
p74902
as(dp74903
g18
V23354
p74904
stp74905
a((dp74906
g2
(lp74907
VNo, there isn't
p74908
aVActually, to get the most appropriate call stack, I would have something more like below, where the method creates the exception but we  it locally:
p74909
aVwhich solves both problems in one go
p74910
aVAnother lazier approach would be:
p74911
as(dp74912
g18
V23354
p74913
stp74914
a((dp74915
g2
(lp74916
s(dp74917
g18
V23354
p74918
stp74919
a((dp74920
g2
(lp74921
VI probably would do that with double-check (I
p74922
aVe check if null; if null, lock and check again; if still null, do the work to compile and assign)
p74923
aVHowever, this is mainly to prevent duplicated work during cold-start than anything else
p74924
aVIf the work was minimal (I
p74925
ag50
aVLess than compile) I might use a local variable to do the work, then use Interlocked
p74926
aVCompareExchange to assign if (and only if) the field is still null
p74927
aVThis means all threads get the same value, but might mean duplicated effort (all but the first are discarded)
p74928
aVIf the scenario in question is likely, I would actually use a static field initializer, as that has less runtime overhead; no locks are necessary then
p74929
as(dp74930
g18
V23354
p74931
stp74932
a((dp74933
g2
(lp74934
VThe delegate for the  (materialization) is pretty versatile and flexible, but IMO makes for a bit of unnecessary work in the vast majority of cases
p74935
aVIn terms of what it does - they use the delegate as a callback to get the caller to specify how to read the record
p74936
aVNote, since they don't expect the consumer to change record, they should probably be exposing , not  (any reader also implements record)
p74937
aVNote that if there are any error messages in the TDS stream after the first record, the approach shown won't see them - but that is an edge case
p74938
aVIf you wanted to mitigate against that, you could read to the end of the TDS stream:
p74939
aVPersonally, though, I'd just use dapper-dot-net here - avoids having to write that per-type code manually:
p74940
aVthis executes  as a sproc, passing in  with the value from , then applies a direct column<===>property/field match to create  records, then asserts that there is exactly one result - and returns it
p74941
as(dp74942
g18
V23354
p74943
stp74944
a((dp74945
g2
(lp74946
VSomething like:
p74947
aVNote that the namespace aliases are merely conveniences, and don't have to match between the document and the namespace-manager - but it is probably easier if they do
p74948
as(dp74949
g18
V23354
p74950
stp74951
a((dp74952
g2
(lp74953
VYes it is redundant
p74954
aVThere is no circumstance when it does anything different since the order is implicitly ascending
p74955
aVI guess it provides completeness, but it does indeed seem a shame to introduce a keyword into the language that is so
p74956
aVimpotent
p74957
aVOn the other side, though:
p74958
aVit mimics SQL, which is broadly related in terms of semantics
p74959
aVit avoids the "how do I
p74960
aVquestions
p74961
aVit does no harm, and nobody is forcing you to use it
p74962
aVit (arguably) makes things clearer if you have  etc
p74963
aVExample (see comments) that  is actually very different to :
p74964
aVprints:
p74965
aVnote the middle two are reversed
p74966
aVThis is because of the difference between:
p74967
aVin the first loop, and
p74968
aVin the second
p74969
aVBecause LINQ attempts to guarantee a stable sort (i
p74970
ag50
aVwhen there are matches, the data is retained in the original order), an  does the first sort (on X), and then resorts the data, only looking at the original (sorted by X) order when the Ys match
p74971
aVOr in other words: it flips them left-to-right
p74972
as(dp74973
g18
V23354
p74974
stp74975
a((dp74976
g2
(lp74977
VAs discussed in the comments, this is expected
p74978
aVIt can be side-stepped by removing the JIT's ability to keep the value in a register (which will be wider than the actual value) - by forcing it down to a field (which has clearly-defined size):
p74979
aVInterestingly, I tried this with a struct first, but the JIT was able to see past my cheating (presumably because it is all on the stack)
p74980
as(dp74981
g18
V23354
p74982
stp74983
a((dp74984
g2
(lp74985
Vif I remember my VB (which is dubious)
p74986
aVThe error message appears to be due to it trying a bitwise "or" operation between the two strings, which seems pretty random
p74987
as(dp74988
g18
V23354
p74989
stp74990
a((dp74991
g2
(lp74992
VIf you are using different types, you would need to use a non-generic type for the variable:
p74993
aVor
p74994
aVPersonally, I'm not sure it is a great design, but it satisfies the requirement
p74995
as(dp74996
g18
V23354
p74997
stp74998
a((dp74999
g2
(lp75000
VIt fails because protobuf-net can't process inheritance unless you give it more of a clue either via attributes or a runtime type-model - essentially it needs to get a field number from somewhere (i
p75001
ag50
aVyou)
p75002
aVI am content to concede that maybe a trace warning might be useful in this case, since it is reasonably clear that there is probably more to this inheritance scenario than just
p75003
aVThe following addition (at runtime) fixes it:
p75004
aV(the only significance of  there is that it doesn't conflict with any other fields defined for )
p75005
as(dp75006
g18
V23354
p75007
stp75008
a((dp75009
g2
(lp75010
VIt is fine, since the compiler omits it in release build
p75011
aVIt is not bad practice, and you do not need to remove them from source (indeed, you probably shouldn't)
p75012
aVBut you must be careful:
p75013
aVis bad - the  will be ignored in release; you must use:
p75014
aVBasically, avoid side-effects in calls to conditional methods and partial methods
p75015
as(dp75016
g18
V23354
p75017
stp75018
a((dp75019
g2
(lp75020
VYou have three options, depending on the scenario:
p75021
aVyou could  the queries each time (which could make for a lot of overhead, I suspect)
p75022
aVyou could build a custom expression (lots of work, and not really a good fit for LINQ to Objects)
p75023
aVyou could build a  of the matches (my preferred option)
p75024
ag412
ag50
as(dp75025
g18
V23354
p75026
stp75027
a((dp75028
g2
(lp75029
VHave you tried simply:
p75030
as(dp75031
g18
V23354
p75032
stp75033
a((dp75034
g2
(lp75035
VI suspect this relates to the static field initializer
p75036
aVConnections on web apps should never be static anyway (but request-specific at most)
p75037
aVThe key is: what does  actually come out as
p75038
aVThe  method returns a  only if you are currently profiling (on the current request), and the connection is profiled against the  instance on that request
p75039
aVIf you use a static field, then there are two scenarios:
p75040
aVthe static field is initialized without a request context (or a non-developer request context): no profiling will occur as  is null
p75041
aVthe static field is initialized, but everything is logged against the very first request, which is quickly dead
p75042
as(dp75043
g18
V23354
p75044
stp75045
a((dp75046
g2
(lp75047
VThe raw "protobuf" spec, a defined by Google, is a tree serializer (like XmlSerializer)
p75048
aVSo by default you would get C serialized twice, and two different objects when deserialized
p75049
aVHowever, this is such a common question that in "v2" I provide this as an opt-in behaviour; note you should only use this for protobuf-net to protobuf-net, as other clients will not expect this configuration (although it remains a valid protobuf stream)
p75050
aVFor example (using attributes, bit you can also use a runtime model instead):
p75051
aVThis will serialize the instance once, generating an id unique in the output
p75052
aVWhen deserialized, the same object will be used in both places
p75053
as(dp75054
g18
V23354
p75055
stp75056
a((dp75057
g2
(lp75058
VYou state:
p75059
aVThe HTTP post should have the following headers
p75060
aVContent-Type: application/xml;charset=UTF-8
p75061
aVyet that is clearly not xml in your payload, and that isn't an xml header in the trace
p75062
aVit looks to me simply that you aren't sending the right data to the API
p75063
as(dp75064
g18
V23354
p75065
stp75066
a((dp75067
g2
(lp75068
VThat is a false lead
p75069
aVIgnore that
p75070
aVYou are only seeing that because of the debugger / visualiser trying to show you all the properties (some of which don't make sense for a stream of unknown length)
p75071
aVThat said, I'm not sure how it makes sense to add that stream to view-data
p75072
aVStreams are pipes, not buckets
p75073
aVWith a few exceptions they don't actually hold the data - they are just intermediaries to a data source / sink
p75074
aVIn terms of finding an actual problem, you need to  the actual exception that is happening in the code
p75075
aVIgnore anything you see in the visualiser; that is not what your code uses
p75076
aVI suspect this "connect" stream (I'm not familiar) is intended to be used as a sink - meaning: you write to it
p75077
aVHowever, to serialize (for view-data) it might be trying to read it
p75078
aVThis is just supposition, however, unless you indicate the actual exception that your code is raising (ignoring the visualiser)
p75079
as(dp75080
g18
V23354
p75081
stp75082
a((dp75083
g2
(lp75084
VAnything acting as an event is the classic answer here - then the caller doesn't need to know who is listening (just invoke it, if it is non-null)
p75085
aVThis is ideal as multiple operations can subscribe simultaneously - for example 3 separate controls observing (data-binding) to the same property on a view-model
p75086
aVAny cases where the delegate is acting as function (in particular with a return value) is tricker, as you need to think how you will handle that - take the first
p75087
aVLast
p75088
aVAggregate
p75089
as(dp75090
g18
V23354
p75091
stp75092
a((dp75093
g2
(lp75094
VFor the record:
p75095
aVThis will keep you safe
p75096
aVDO NOT CONCATENATE TEXT TO MAKE SQL
p75097
aVIf that is typical of your coding style, I need you to realise that your code is dangerously exposed and can be abused and broken accidentally or maliciously
p75098
aVPain
p75099
aVLots of pain
p75100
as(dp75101
g18
V23354
p75102
stp75103
a((dp75104
g2
(lp75105
VUsually, this means that you are running in a sub-directory (i
p75106
ag50
aVnot the site-root), and that directory is not marked as an application in IIS
p75107
aVBasically, App_Code is resolved relative to the nearest application (or the root otherwise)
p75108
aVSo if your app is at , then instead of looking in , it is looking in
p75109
aVWhere your files aren't
p75110
aVIf this is the case, mark the folder as an application in IIS
p75111
aVThis varies between IIS versions, but the end-result is that the folder icon should display a cog in IIS
p75112
as(dp75113
g18
V23354
p75114
stp75115
a((dp75116
g2
(lp75117
VIt looks like a bug processing the root name, indeed
p75118
aVAs a workaround: take control of the root manually:
p75119
aVThis should serialize as
p75120
aVon either platform
p75121
aVSubstitute  and  for your preferred names
p75122
aV(personally, I'd be using binary output, though ;p)
p75123
as(dp75124
g18
V23354
p75125
stp75126
a((dp75127
g2
(lp75128
VPersonally I would start by losing the  variable names (which you also use as  elsewhere)
p75129
aVI don't know if this is the cause, but I have never seen this usage personally, and I'm dubious
p75130
aVFine for column names (and table names), but variables
p75131
aVNot so sure
p75132
aVChanging the variable names is local to this code, so shouldn't cause any side-effects
p75133
as(dp75134
g18
V23354
p75135
stp75136
a((dp75137
g2
(lp75138
VYou can get the  via reflection, and use that to subscribe:
p75139
as(dp75140
g18
V23354
p75141
stp75142
a((dp75143
g2
(lp75144
VThe console behaviour is part of the PE header in the exe; there is a flag to distinguish between console and windows apps
p75145
aVThe value of this flag is pretty much the only fundamental difference between a windows exe and a console exe (you can still create forms from a console exe, etc - and you can write to the console from a windows exe, although you won't be able to see anything)
p75146
aVYou can toggle this flag using  if you want to play with it - the  flag, in particular
p75147
aVThe debug output is because the debugger attaches to pre-defined trace points to gather the output
p75148
aVIf you press ctrl+f5 it runs without attaching any of these hooks, so you get something closer to running it directly from the shell
p75149
as(dp75150
g18
V23354
p75151
stp75152
a((dp75153
g2
(lp75154
VSimply: it isn't
p75155
aVI don't trust your (not provided) test:
p75156
aVMy results:
p75157
aVwhich ties in to what I would expect from additional ldarg0 and ldfld (to get the value from an instance field) rather than the simpler ldsfld (to get the value from a static field) or ldloc0 (to get the value from a local variable)
p75158
aVMy code:
p75159
as(dp75160
g18
V23354
p75161
stp75162
a((dp75163
g2
(lp75164
VI suspect the first line in there is hurting you; the following would be more appropriate:
p75165
aVWhich will rebind without having to worry about a different type in the middle
p75166
aVAlso, at some point earlier (once only):
p75167
as(dp75168
g18
V23354
p75169
stp75170
a((dp75171
g2
(lp75172
VBinaryFormatter is deeply tied to the type metadata
p75173
aVIt is not a good choice here, since you have different types
p75174
aVActually IMO it isn't a good choice anyway :) It is not very version tolerant, and is not portable
p75175
aVI will openly recommend protobuf-net here (disclosure: I wrote it)
p75176
aVIt is free OSS, but uses google's protobuf format to fix all the BF problems
p75177
aVIt is trivial to setup and use, is faster, and has smaller output than BinaryFormatter
p75178
aVSince it is contract-based you can have different types at each end, as log as they agree on the contract (matching field-numbers etc)
p75179
aVFor example:
p75180
aVAnd then just use ProtoBuf
p75181
aVSerializer
p75182
aVSerialize(stream, object) to write the data
p75183
aVYou can also work without attribute if you need, it takes a little more setup, but not much
p75184
as(dp75185
g18
V23354
p75186
stp75187
a((dp75188
g2
(lp75189
VSince you are serialising a root object, in v1 (the fully released dll) you can do this using the Serializer
p75190
aVNonGeneric
p75191
aVSerializeWithLengthPrefix and DeserializeWithLengthPrefix API, in particular using a different field-number (tag) per-type when serialising, and using the deserialize overload that accepts a type-resolver to translate a irks-number back into a Type
p75192
aVI'm not at a PC currently but I can add an example later of you need
p75193
aVIn "v2" there are additional options here:
p75194
aVyou can mark a property (etc) as DynamicTypr=true, which stores additional type metadata making this work even for object properties, but making it a bit more tied to your model
p75195
aVyou can add known sub-types at runtime via the flexible type-model; however generally this wouldn't be from , and I am still exploring possible side-effects of this (it has been requested as a feature previously)
p75196
as(dp75197
g18
V23354
p75198
stp75199
a((dp75200
g2
(lp75201
VThese features are now all in the editor itself
p75202
aVAdding a base class is trivial - just add
p75203
aVTo the type
p75204
aVLikewise interfaces, noting ctrl+
p75205
aVto resolve namespaces automatically
p75206
aVRight-Click on the interface name to add the interface methods
p75207
aVRe overrides; type  and it gives you a list of overrides left
p75208
aVSelecting one then  tab provides the signature and a default implementation
p75209
aVSo essentially, all these features are now in the editor - available all the time rather than just when adding the class
p75210
as(dp75211
g18
V23354
p75212
stp75213
a((dp75214
g2
(lp75215
VThis looks like a problem for reflection rather than generics (although generics can be used as a sneaky way of caching the strategy for reflection)
p75216
aVUnless I misread it, you want to create a new instance and copy most of the members
p75217
aVWhich reflection is good at, albeit relatively slow
p75218
aVYou can improve the speed by using meta-programming; on the first run (per-type) generate an optimised version, perhaps using DynamicMethod or Expression, and store a typed delegate from that
p75219
aVThen just use the delegate
p75220
as(dp75221
g18
V23354
p75222
stp75223
a((dp75224
g2
(lp75225
VMost commonly:
p75226
aVor similar (perhaps in a comparer class, if it is non-trivial)
p75227
as(dp75228
g18
V23354
p75229
stp75230
a((dp75231
g2
(lp75232
VLists etc are mapped to the "repeated" syntax from the
p75233
aVproto spec
p75234
aVThis embeds directly from the parent object directly
p75235
aVThere is no facility to store any additional metadata
p75236
aVThe code has been tweaked to highlight this rather than silently ignore it
p75237
aVYou can specify the default concrete type to use, but only that
p75238
as(dp75239
g18
V23354
p75240
stp75241
a((dp75242
g2
(lp75243
VCompression streams don't flush (and can't properly flush) until they are closed
p75244
aVYou will need to close the
p75245
aVTelling it not to close the underlying stream (one of the constructor arguments) will make this easier
p75246
as(dp75247
g18
V23354
p75248
stp75249
a((dp75250
g2
(lp75251
VIf you are calling from
p75252
aVNET, you could use Dapper dot net:
p75253
aVHere Dapper does the thinking, so you don't have to
p75254
aVSomething similar is possible with LINQtoSQL, of course:
p75255
as(dp75256
g18
V23354
p75257
stp75258
a((dp75259
g2
(lp75260
VNo matter how you invoke it; for a composite operation it is entirely possible that the first operation will succeed and the second operation will fail (for example, a unique key violation or a foreign key violation)
p75261
aVIf you need to ensure all-or-nothing, then surround the call to  with a transaction, and only commit when you know it all worked
p75262
aVYou can also create transactions at the SQL level, but the tools at your disposal are easier to get wrong if you do it in TSQL
p75263
aVIt does, to give due credit, avoid a few round-trips - but usually not so much that it is worth fighting the language to do it
p75264
aVUltimately SQL is designed for good set-based DML operations - it isn't quite as good at more procedural code like execution flow management
p75265
as(dp75266
g18
V23354
p75267
stp75268
a((dp75269
g2
(lp75270
VIn a zero-based collection / array / list, etc; item  and item  are the first and last items respectively
p75271
aVFor example if count =o
p75272
aVIf the collection does not have any items, either of the above will usually result in an out-of-range exception
p75273
aVSo
p75274
aVdon't do that
p75275
aVCheck the size first
p75276
aVor count = -1
p75277
aVIf the count is -1, you have bigger problems - like, you broke the universe
p75278
aVYou might also look at LINQ's  /  etc (both have special checking for typed lists to minimise pain - but I don't know if  is technically a typed list () - I suspect not); but access via an indexer is convenient and fast
p75279
as(dp75280
g18
V23354
p75281
stp75282
a((dp75283
g2
(lp75284
VPedant point: if the server is needed, it isn't a unit-test - it is an integration test
p75285
aVThat doesn't change the very real need to do it, though :)
p75286
aVWhen I need this, I design the server as something I can spin up from a few classes anywhere (the simpler, the better); then, you can start the server in a few classes from the test suite (and shut down)
p75287
aVThe server "application" is then just a thin shell around the same set of classes
p75288
aVIt depends on what you are doing, of course
p75289
as(dp75290
g18
V23354
p75291
stp75292
a((dp75293
g2
(lp75294
VI would refactor this to a method, and just call  whenever I need to
p75295
aVYou could also use , and I have used  for this, but it gets frowned upon
p75296
aVWhich is dumb; this scenario is why it exists in the language
p75297
as(dp75298
g18
V23354
p75299
stp75300
a((dp75301
g2
(lp75302
VThe preferred way of doing this is to use  and
p75303
aVIn the case of func, the last  is the return, so:
p75304
as(dp75305
g18
V23354
p75306
stp75307
a((dp75308
g2
(lp75309
VIMO, the correct approach here is not to (as per the accepted answer) use the database specific parameter prefix (so  for sql-server,  for oracle) - but rather: use no prefix at all
p75310
aVSo ultimately this is:
p75311
aV(etc)
p75312
aVIn particular, a  property would be bad as it would limit you to one vendor per
p75313
aVDapper has been updated with this change
p75314
aVIt also now dynamically detects  and sets it accordingly (all without needing a reference to )
p75315
as(dp75316
g18
V23354
p75317
stp75318
a((dp75319
g2
(lp75320
VIf sounds like the type  is not , but is using the default accessibility of either  (if it is top-level) or  (if it is nested in another type)
p75321
aVGiving the type the  modifier would fix it
p75322
aVAnother approach is to make both the type and the method , if that is your intent
p75323
aVThe issue is not the accessibility of the field (), but rather of the type  itself
p75324
as(dp75325
g18
V23354
p75326
stp75327
a((dp75328
g2
(lp75329
VThat is, in part, because there is nothing to set up - all you need is a database (which it doesn't care about) and some classes (which it doesn't care about)
p75330
aVThe core methods just take parameterised SQL, and are deliberately close to LINQ-to-SQL's sql-based methods (hint: we use dapper as a direct drop-in replacement whenever we get isues with LINQ-to-SQL)
p75331
aVIf you want a few examples, the "tests" project contains examples of the core APIs
p75332
aVIf you mean "how do I add dapper" - two choices; a single file added to your project, or a nuget package
p75333
aVThe nuget pacakge tends to lag a little bit, but not much
p75334
aVBut ultimately, usage is just:
p75335
aVwhere your  class has properties with names matching the database (it is  a very direct map)
p75336
aVNo attributes are required; no special tooling is required
p75337
aVIn our case, we tend to use LINQ-to-SQL generated classes with it, or a specific class created for some subset of columns (or composite between several tables, etc)
p75338
as(dp75339
g18
V23354
p75340
stp75341
a((dp75342
g2
(lp75343
VTimezones change - as indeed do the rules for each (DST etc)
p75344
aVEnums do not
p75345
aVFor the same reason, culture-info has a string identifier, not an enum
p75346
aVThis also allows you to define your own cultures at runtime, and pick up changes as the OS gets updates from external sources
p75347
aVI actually hope you can do the same with timezones (define your own)
p75348
as(dp75349
g18
V23354
p75350
stp75351
a((dp75352
g2
(lp75353
VYou need to consider the  object and the underlying connection as separate
p75354
aVIt is the underlying connection that is pooled
p75355
aVThis is returned to the pool when the  is disposed, either by explicit usage of , or by a  block*
p75356
aVLater, a new (different)  might be created with the same underlying connection
p75357
aVSo: the magic happens:
p75358
aV*=it might also (I didn't check) be released back to the pool by /finalizer - but we shouldn't focus on that because if that happens you're already doing it wrong
p75359
as(dp75360
g18
V23354
p75361
stp75362
a((dp75363
g2
(lp75364
VFor simple examples, you could do something like:
p75365
aVwhich gives you access to:
p75366
aVetc
p75367
aVHowever, personally I would be writing a custom  (for your ), with an internal  buffer and tracking cursor
p75368
aVThis allows must more efficient reading in most cases (even compared to a )
p75369
aVAs a side-note, your string looks to be UTF-16 and read to the EOF; reading to EOF is a pain as it doesn't really allow you to encode 2 strings
p75370
aVI would (instead) be adding (first) the length of the string, and I would be using UTF-8 unless there is a good chance of large character points
p75371
aVThen reading a string is a case of:
p75372
aVread the length
p75373
aVdecode that much via
p75374
aVAs a final point - if you are mostly writing small integers, there are alternative encoding styles for integers that might be useful (allowing single-byte for small values, but still allowing full  ranges to be expressed)
p75375
as(dp75376
g18
V23354
p75377
stp75378
a((dp75379
g2
(lp75380
VThere are a number of ways you could do this
p75381
aVI'm not actually sure extensions is the one I would leap for, but:
p75382
aVin your message type, you could have a set of fully defined fields for each sub-message, i
p75383
ag50
aVwhere you would have exactly one of the sub-message object
p75384
aValternatively, encapsulate the common parts inside the more specific message:
p75385
aVEither approach would allow you to deserialize; the second is trickier, IMO, since it requires you to know the type ahead of time
p75386
aVThe only convenient way to do that is to prefix each with a different identifier
p75387
aVPersonally I prefer the first
p75388
aVThis does not, however, require extensions - since we know everything ahead of time
p75389
aVAs it happens, the first is also how protobuf-net implements inheritance, so you could do that with type inheritance (4 concrete sub-types of an abstract base message type)and
p75390
aVRe extension data; protobuf-net does support that, however as mentioned in the blog this is not included in the current v2 beta
p75391
aVIt will be there soon, but I had to put a line somewhere
p75392
aVIt is included in the v1 (r282) download though
p75393
aVNote that protobuf-net is just one of several C#/
p75394
aVNET implementations
p75395
aVThe wire format is the same, but you might also want to consider the directly ported version
p75396
aVIf I had to summarise the difference I would say "protobuf-net is a
p75397
aVNET serializer that happens to be protobuf; protobuf-csharp-port is a protobuf serializer that happens to be
p75398
aVNET" - they both achieve the same end, but protobuf-net focuses on being idiomatic to C#/
p75399
aVNET where-as the port focuses more on having the same API
p75400
aVEither should work here of course
p75401
as(dp75402
g18
V23354
p75403
stp75404
a((dp75405
g2
(lp75406
V is indeed not supported on CE; only unicode ,  and
p75407
aVChange to ,  and , etc
p75408
aVAlso; start with the simplest operation (table etc) that works - and keep expanding it until it breaks, then you'll know which bits fail
p75409
as(dp75410
g18
V23354
p75411
stp75412
a((dp75413
g2
(lp75414
VYou can't use the open generic type , except inside
p75415
aVIf you wanted to refer to a set of queries (type not specified) you would need a non-generic API, for example:
p75416
aVthis, however, means you need to provide a shadow implementation of  for each, which is a pain
p75417
aVNote there is also an ambiguity in the above if any service implements both  and  - in that there is no obvious way of indicating
p75418
as(dp75419
g18
V23354
p75420
stp75421
a((dp75422
g2
(lp75423
VHis example is confusing in part because of the (incorrect, IMO) re-use of  for a generic method within a generic type
p75424
aVThe two  are not the same
p75425
aVSo; let's work with a non-generic type:
p75426
aVHere I added  - and clearly the 2nd method could try to use features of this second  - however, the caller might be:
p75427
aVthe base implementation does not enforce , so the compiler does not complain that it isn't implemented
p75428
aVSo what does the overridden method do
p75429
aVHence it can't exist
p75430
aVHowever
p75431
aVIf you do this at the type level instead, it does work, as for the concrete object to exist we know the constraint was enforced:
p75432
aVAnd a brief reminder - if you have a generic type with , don't also use  in a generic method; something more specific like  etc
p75433
as(dp75434
g18
V23354
p75435
stp75436
a((dp75437
g2
(lp75438
VAssuming you want UTF8, then yes the code shown in the question is entirely correct
p75439
aVThe only thing I would change is: consider whether your API should actually be talking about  rather than
p75440
aVIf so,  would do nicely
p75441
aVBut for arbitrary binary  usage, your code is correct as shown (especially if you add a , although in reality that is moot since for  it is a no-op ; but I'm fussy ;p)
p75442
as(dp75443
g18
V23354
p75444
stp75445
a((dp75446
g2
(lp75447
VIn the case of , it pre-dates generics, which is a good reason - but there are others
p75448
aVHaving spent a lot of time on serialization code, I know painfully that (very common in library code) often all you have is the
p75449
aVSimply, library code like WCF can't be generic throughout - it would be a lot of overhead and complexity
p75450
aVFor example, it might have just looked up the  from the element-name (or some other marker)
p75451
aVIt didn't know the type in advance, so it can't possibly be "generic" (in the  sense)
p75452
aVIn those cases when you have a , you can use  etc, but that is a lot of overhead, and can actually break CF etc (you start getting missing-method errors eventually)
p75453
aVAs it happens, I have recently rewritten an entire serialization library from using generics as the primary API to using  as the primary API
p75454
aVFortunately this means the old methods just use  with the new methods, so it works nicely
p75455
as(dp75456
g18
V23354
p75457
stp75458
a((dp75459
g2
(lp75460
VYou are using a TextReader to process a non-text binary chunk
p75461
aVThis will not work; essentially you have corrupted the binary by trying to UTF decode something that wasn't UTF, then re-encoded the (nonsensical) string you obtained
p75462
aVEither return binary (for example a byte[]), or if it must be string: use base-64 via Convert
p75463
aVToBase64String etc
p75464
aVSee also: http://marcgravell
p75465
aVblogspot
p75466
aVcom/2010/03/binary-data-and-strings
p75467
aVhtml
p75468
as(dp75469
g18
V23354
p75470
stp75471
a((dp75472
g2
(lp75473
VUsing the code from here and here:
p75474
aVchanging the second  to  gives  and a list containing the single entry:
p75475
as(dp75476
g18
V23354
p75477
stp75478
a((dp75479
g2
(lp75480
VFirst i tried XmlSerializer, but then i found out that it has problems with circural references
p75481
aVWell, yes: xml is a tree format - it won't love circular references
p75482
aVdoesn't allow anything like the same level of control over the xml, so my advice: stick to  in this case, and remove your circular references (usually with a few  on parent-properties)
p75483
aVOtherwise: implement , but note that this provides virtually no metadata and is a real pain to do robustly
p75484
as(dp75485
g18
V23354
p75486
stp75487
a((dp75488
g2
(lp75489
VYou have a list, and to that list you've added 4 strings
p75490
aVThe list is a list-of-strings, not a a list-of-lists-of-strings
p75491
aVI suspect you mean (since you are doing something with )
p75492
aValternatively, if you mean the first 3 characters in each (which WON'T WORK for your sample data, since each is a string of length 1):
p75493
as(dp75494
g18
V23354
p75495
stp75496
a((dp75497
g2
(lp75498
VIf this is some database-level task, then perhaps a scheduled-task (or crontab on nix)
p75499
aVThere is no need for MVC to do that
p75500
aVIf you really want, the scheduled-task could just hit a route on the web-site
p75501
aVHowever, personally I'd simply partition the data with a week-number (or a start date), so that when I get the data, I'm getting the data for the week starting (your date)
p75502
aVThen:
p75503
aVthere is nothing to do
p75504
aVyou have access to history as needed
p75505
ag412
ag50
aVadd  (or similar) as a column on your existing storage, and use that to select the most timely data
p75506
aVYou will get calls about "I need the data from last week" - you might as well built it in from the outset
p75507
aVBesides
p75508
aVif something isn't done on Friday, that doesn't mean it ceases to exist
p75509
as(dp75510
g18
V23354
p75511
stp75512
a((dp75513
g2
(lp75514
VThe first parameter is the target object:
p75515
aVPersonally, though, I might be tempted to use the non-generic API here; generics and reflection rarely mix well:
p75516
as(dp75517
g18
V23354
p75518
stp75519
a((dp75520
g2
(lp75521
VFirstly, value-types have no object header (because they aren't objects), so there would be no way to identify the actual type, or to do virtual dispatch
p75522
aVSecondly - how could you add fields to sub types
p75523
aVThe size has to be known by the compiler (for stack space etc), so:
p75524
aVmust always take the same amount of space
p75525
aVLikewise, an abstract base-type wouldn't work, as you can always construct a struct
p75526
aVBasically, they would be horrible malformed things, crippled and ugly
p75527
aVI find it interesting that you would want a subtype of a value - that sounds a bit like a confused usage of a struct
p75528
as(dp75529
g18
V23354
p75530
stp75531
a((dp75532
g2
(lp75533
VTo do it simply, you could consider each as a  (plenty of room there), and hex-encode; that gives you:
p75534
aVbase-64 would be shorter, but you'd need to look at it as big-endian (note most
p75535
aVNET is little-endian) and ignore leading 0 bytes
p75536
aVThat gives you:
p75537
aVFor example:
p75538
as(dp75539
g18
V23354
p75540
stp75541
a((dp75542
g2
(lp75543
VNo, AFAIK that is not possible
p75544
aVEven if you  the properties to add data-member markers it'll still complain:
p75545
aVType 'BaseClass' cannot be serialized
p75546
aVConsider marking it with the DataContractAttribute attribute, and marking all of its members you want serialized with the DataMemberAttribute attribute
p75547
aVIf the type is a collection, consider marking it with the CollectionDataContractAttribute
p75548
aVSee the Microsoft
p75549
aVNET Framework documentation for other supported types
p75550
as(dp75551
g18
V23354
p75552
stp75553
a((dp75554
g2
(lp75555
VYes, that is the primary cause of the error
p75556
aVCurrently, many of those connections will wait until the next GC to re-pool the underlying connection
p75557
aVYou will exhaust the pool (and database connections) pretty quickly
p75558
aVThe best way of refactoring this is to add the missing , such that the connection is scoped
p75559
aVPersonally I'd also refactor that to a single method, i
p75560
ag50
aVClosing the reader does little unless the reader is marked to close the connection; and having the data-reader close the connection (via a behaviour) sort of works, but it assumes you get as far as consuming the reader - it won't necessarily behave well in error scenarios
p75561
as(dp75562
g18
V23354
p75563
stp75564
a((dp75565
g2
(lp75566
VLooking at the new comments, this appears to be (as the OP notes)  capacity limited
p75567
aVA slight annoyance in the protobuf spec is that since sub-message lengths are variable and must prefix the sub-message, it is often necessary to buffer portions until the length is known
p75568
aVThis is fine for most reasonable graphs, but if there is an exceptionally large graph (except for the "root object has millions of direct children" scenario, which doesn't suffer) it can end up doing quite a bit in-memory
p75569
aVIf you aren't tied to a particular layout (perhaps due to
p75570
aVproto interop with an existing client), then a simple fix is as follows: on child (sub-object) properties (including lists / arrays of sub-objects), tell it to use "group" serialization
p75571
aVThis is not the default layout, but it says "instead of using a length-prefix, use a start/end pair of tokens"
p75572
aVThe downside of this is that if your deserialization code doesn't know about a particular object, it takes longer to skip the field, as it can't just say "seek forwards 231413 bytes" - it instead has to walk the tokens to know when the object is finished
p75573
aVIn most cases this isn't an issue at all, since your deserialization code fully expects that data
p75574
aVTo do this:
p75575
aVThe deserialization in protobuf-net is very forgiving (by default there is an optional strict mode), and it will happily deserialize groups in place of length-prefix, and length-prefix in place of groups (meaning: any data you have already stored somewhere should work fine)
p75576
as(dp75577
g18
V23354
p75578
stp75579
a((dp75580
g2
(lp75581
VA null/empty string is in the wrong format; you would need to detect that scenario and compensate:
p75582
as(dp75583
g18
V23354
p75584
stp75585
a((dp75586
g2
(lp75587
VThe trick with dates is to create a range first with DATEADD and whatever else you need, I
p75588
ag50
aVThen search in that range; I typically include the start and exclude the end, as this allows a simple "data between the 10th and 12th"
p75589
aVHaving a range is critical unless the values are entire units (days, etc) - otherwise equality won't work very well
p75590
aVAnd the simple >= and < use allows effective use of indexing etc
p75591
as(dp75592
g18
V23354
p75593
stp75594
a((dp75595
g2
(lp75596
Vin addition to those mentioned;
p75597
aVhas special compiler support, since it restricts (at compile) how you can apply attributes
p75598
aVis also used by the compiler to warn or error about usage
p75599
aVI suspect though, that technically you could write all of these yourself - as long as you write your own core libarary and System
p75600
aVdll ;p The compiler is generally looking for a pattern/signature, since it must cater for different runtimes - and indeed you don't have to use the MS core libraries
p75601
aVThe behaviour, however, is defined by the compiler, not the class - so you can't make it do anything different
p75602
as(dp75603
g18
V23354
p75604
stp75605
a((dp75606
g2
(lp75607
VThat depends largely on what exactly the binary looks like ;p Xslt is not going to help much here; I would be using either a dedicated c# method that understands the structure (if it is specific to one task), or if a general purpose approach is needed (i
p75608
ag50
aVto cater for more than one scernario), then a proper serialization library to match your intended format
p75609
aVYou should be prepared to spend lots of time working with streams, buffers and encoders
p75610
aVIf you just want to serialize, and you don't care about the format - then use a pre-canned serializer; I suggest protobuf-net, as it works nicely alongside  allowing you to read from xml and write as binary, or read from binary and write as xml, etc
p75611
aVLikewise, since it is (by default) tree-based it has a direct correlation to xml (also tree-based)
p75612
as(dp75613
g18
V23354
p75614
stp75615
a((dp75616
g2
(lp75617
VNever edit the
p75618
aVdesigner
p75619
aVcs; instead, add a second file, and use  to add the method, for example:
p75620
aVNo; you can't add this to the get
p75621
aVAnother alternative, though, is an extension method:
p75622
aVNow you can use:
p75623
aVpersonally I would rename this to clarify the direction of the change, and have two methods - one to encode, one to decode
p75624
aVRe doing this for a set of data; perhaps:
p75625
as(dp75626
g18
V23354
p75627
stp75628
a((dp75629
g2
(lp75630
VPerhaps
p75631
aVPersonally I'd be tempted to use ExecuteQuery though:
p75632
as(dp75633
g18
V23354
p75634
stp75635
a((dp75636
g2
(lp75637
VMost events don't return anything - in fact you assert that it has no return-type
p75638
aVYou then declare your custom method () as returning , and try to bind it to a delegate that doesn't return an int
p75639
aVThis won't work
p75640
aVAlso; your stack isn't valid for returning an int, since you "pop" the result
p75641
ag412
ag50
aVI created a test with
p75642
aVand bound to it; so then here:
p75643
aVyou'll find that  is
p75644
aVThat doesn't match , which returns
p75645
aVRe the stack (comments); consider:
p75646
aVYou've loaded two values, added them up, thrown the result away, and then returned
p75647
aVBut you haven't returned the  that you claim to - this will fail IL inspection
p75648
aVIf you change:
p75649
aVand
p75650
aVthen it might work as you intend
p75651
aVAlso; this is simpler:
p75652
as(dp75653
g18
V23354
p75654
stp75655
a((dp75656
g2
(lp75657
VThe whole point of a strong name is that you know what dlls are getting loaded
p75658
aVYou can't add a strong-name to your dll if you reference something that isn't strong-named, as anything could be loaded in place of the dll you are thinking of (as long as the name matches)
p75659
aVThis entirely defeats the guarantees that a strong name is intended to provide
p75660
aVSo (one of):
p75661
aVdon't add a strong-name to your dll (for most internal things, you just don't need one)
p75662
aVor; rebuild the dll you are referencing with a strong-name
p75663
aVor; load the additional dll only through reflection (yuck)
p75664
as(dp75665
g18
V23354
p75666
stp75667
a((dp75668
g2
(lp75669
VThe  version is not going to be faster - it involves an extra string allocation
p75670
aV(which must later be collected), etc
p75671
aVPersonally, I'd use
p75672
aVthis avoids all the issues of culture-sensitive strings, but as a consequence it avoids all the issues of culture-sensitive strings
p75673
aVOnly you know whether that is OK in your context
p75674
aVUsing the  static method avoids any issues with  being
p75675
as(dp75676
g18
V23354
p75677
stp75678
a((dp75679
g2
(lp75680
VThe difference between an auto-reset event and a manual-reset event is that an auto-reset event clears itself (closes) after one use, so only one item gets through the gate
p75681
aVI suspect an  would do nicely here
p75682
aVPersonally I tend to use  more, though - it has lower overheads, but you do need to be a bit careful; your first thread must be sure to own the lock before any of the others, i
p75683
ag50
aVwith the workers doing something like:
p75684
aVHolding the lock originally means that we don't miss any messages while we are spinning up workers, as any workers getting to  will be blocked until the original thread releases the lock at
p75685
aVThe first thread the  will signal our original thread to continue
p75686
as(dp75687
g18
V23354
p75688
stp75689
a((dp75690
g2
(lp75691
VIt has to be an exact match, else  could do:
p75692
aVwhich would be valid for  (it will box the  to an ), but not for  (where it is a )
p75693
aVTwo immediate options; firstly, use an intermediate variable and a type-check:
p75694
aVor alternatively, maybe try generics (); or treat  as  instead of
p75695
as(dp75696
g18
V23354
p75697
stp75698
a((dp75699
g2
(lp75700
VA protobuf message is internally ambiguous unless you have the
p75701
aVproto schema (or can infer a schema) available, as (for example) a "string" wire-type could represent:
p75702
aVa utf-8 string
p75703
aVa BLOB
p75704
aVa sub-message
p75705
aVa packed array
p75706
aVSimilar ambiguity exists for all wire-types (except perhaps "groups")
p75707
aVMy recommendation would be to run it through your existing deserialization process (against the type-model that you presumably have available in the project) to get an object model suitable for inspection
p75708
aVFrom the object-model you have all the usual options - reflection, serialization via  / , etc
p75709
aVIf all you have is the raw data, there is a wireshark plugin that might help, or protobuf-net exists a ProtoReader class that might be useful for parsing such a stream; but the emphasis here is that the stream is tricky to decipher in isolation
p75710
as(dp75711
g18
V23354
p75712
stp75713
a((dp75714
g2
(lp75715
VSure
p75716
aVYou can also change the name/namespace etc by looking at the attribute parameters
p75717
as(dp75718
g18
V23354
p75719
stp75720
a((dp75721
g2
(lp75722
VYou can't parameterise things like table-names, columns, order-by, etc
p75723
aVThey are the query
p75724
aVYou will need to white-list the expected values (to avoid SQL injection) and concatenate it into the query directly (which is what your  usage does)
p75725
aVAt the moment, the order-by is on the vale of the variable, which doesn't change per-row
p75726
aVEssentially, the sort (as written) is ignored
p75727
as(dp75728
g18
V23354
p75729
stp75730
a((dp75731
g2
(lp75732
VPersonally, I approach this problem by writing an AddParameterWithValue extension method to DbCommand (or IDbCommand)
p75733
aVIt has to be on the command so that you have access to CreateParameter, and then call
p75734
aVParameters
p75735
aVAdd
p75736
aVThis allows easy usage against any ADO
p75737
aVNET stack, including abstractions like logging decorators
p75738
as(dp75739
g18
V23354
p75740
stp75741
a((dp75742
g2
(lp75743
VThe signature with a  is supported, but it does not currently include the  (it currently just announces  with ), if that is what you mean
p75744
aVI could support that by adding an overload to the serialize/deserialize methods - presumably that would solve it
p75745
aVIf so, please log a feature request on the project site
p75746
aVSince it already supports  in this scenario, it doesn't sound hard
p75747
as(dp75748
g18
V23354
p75749
stp75750
a((dp75751
g2
(lp75752
VSimply, you need two uses of
p75753
aVConstructed manually,  is:
p75754
aV(note that it is important to include  in case  is ; this avoids a lot of unexpected problems)
p75755
as(dp75756
g18
V23354
p75757
stp75758
a((dp75759
g2
(lp75760
V is one of two things:
p75761
aVa reference that doesn't actually point to an object - just a "nothing" indicator (essentially, it is the value  as a reference)
p75762
aVa  struct, which does not currently have a value (the  property will also return )
p75763
aVis specific to some parts of ADO
p75764
aVNET to represent  in the database
p75765
aVI have yet to think of a good reason why they didn't just use regular  here
p75766
aVis a string literal with length zero - a perfectly valid, but empty, string
p75767
aVThe significance of this is that between  string and a  string, instance methods like  will behave differently;  will throw an exception;  is just
p75768
aVIn general, using  as a test makes this distinction go away
p75769
as(dp75770
g18
V23354
p75771
stp75772
a((dp75773
g2
(lp75774
VIt all depends on the serializer
p75775
aVSome serializer skip constructors; some serializers run the default constructor
p75776
aVSome let you choose
p75777
aVSome offer serialization callbacks
p75778
aVSo depending on the serializer:
p75779
aVwrite a public parameterless constructor to set a default value (or use a field-initializer, which is ultimately similar)
p75780
aVwrite an "on deserializing" serialization callback to set a default before deserialization
p75781
aVor worst-case, implement custom serialization ( /  / etc, depending on the serializer)
p75782
aVFor example, with :
p75783
aVWith other serializers, it might use  instead
p75784
aVNote; personally I wouldn't be exposing public fields, even in a DTO
p75785
aVBut if you are using , changing this is now a breaking change
p75786
aVFor completeness, I also wouldn't be using  - it is not very friendly to this
p75787
aVOther serializers are available that will hurt you less
p75788
as(dp75789
g18
V23354
p75790
stp75791
a((dp75792
g2
(lp75793
VIt supports a number of patterns here, to help transition from other serializers
p75794
aVAnd note that there are options in the protobuf-net  to include such members for you automatically
p75795
aVFirstly, anything  is omitted; this includes both  references and  for structs
p75796
aVSo:
p75797
aVwill behave
p75798
aVAnother option is default values; using
p75799
aVNET conventions:
p75800
aVno values of 17 will be serialized
p75801
aVFor more explicit control, the  pattern (from ) and the  pattern (from ) are observed, so you can do:
p75802
aVand
p75803
aVThese can be public or private (unless you are generating a standalone serialization assembly, which requires public)
p75804
aVIf your main classes are coming from code-gen, then a  is an ideal extension point, i
p75805
ag50
aVsince you can add that in a separate code file
p75806
as(dp75807
g18
V23354
p75808
stp75809
a((dp75810
g2
(lp75811
VIt should just work; I believe the problem is that the attributes are inverted (I will take a note to raise a clearer error in this case) - it should be :
p75812
ag412
ag50
aVthe base needs to know about the descendants
p75813
aVNot I removed the discriminator from serialization, as that is redundant if it relates directly to the object type - it handles this internally via the  and will create the correct type for you
p75814
aVEach type needs to know only about the direct subtypes, i
p75815
ag50
aVhere A needs to know about B and D; B needs to know about C; D needs to know about E and F
p75816
aVNote that a "what is this" enum is a good idea here, but there is no need for it to be a field - a virtual property without a field may be more appropriate
p75817
aVIf I have misundersood and the message-type doesn't relate to the object-type, then ignore me ;p
p75818
aVAlso: public fields - don't do it
p75819
aVThink of the kittens
p75820
aVIt will work, but properties are preferred (in general, I mean; nothing to do with protobuf-net)
p75821
as(dp75822
g18
V23354
p75823
stp75824
a((dp75825
g2
(lp75826
VThe main advantage here is in getting the IDE to write all the plumbing for you, i
p75827
ag50
aVgetting the parameters and return data sorted out
p75828
aVIn terms of raw performance; with a stored procedure there is no expression tree to parse, so it should be pretty quick
p75829
aVHowever, internally we have noticed occasional slowdowns in the LINQ-to-SQL materializer, which might impact you if you have heavy usage
p75830
aVIf you want the fastest performance, my advice is to look at dapper-dot-net, which we wrote (and released as OSS) after finding these materializer pauses
p75831
aVThe usage is pretty simple
p75832
aVIn particular, this neatly allows you to use dapper to do the heavy work, but still use the IDE-generated types for the data
p75833
aVInternally, we don't use stored-procedures; we use a combination of:
p75834
aVLINQ-to-SQL expression tree code
p75835
aVLINQ-to-SQL  (etc) code
p75836
aVdapper-dot-net
p75837
aVThe preference for performance is (in our experience) the last
p75838
aVThe first is convenient to write, and is often plenty fast enough
p75839
aVThe middle option is fast, but when dapper has an almost identical API (and is faster) is hard to love now ;p
p75840
as(dp75841
g18
V23354
p75842
stp75843
a((dp75844
g2
(lp75845
VIn the case of generics, you would presumably be limited to basic CRUD operations
p75846
aVIn which case, you should be able to to use the table:
p75847
aV(and update should work for entities that have been changed, using the SPROC that you have specified for updates)
p75848
aVthe  will then use the correct sprocs automatically (you can specify a SPROC for insert, update and delete in the designer or the DBML
p75849
aVThe tricky bit is the get
p75850
aVThat is not exposed directly on the ctx
p75851
aVThe only suggestion I have their is a name-based pattern on the data-context and reflection
p75852
aVSo maybe a  method for getting a
p75853
aVAnother approach, of course, is to implement multiple generic interfaces, i
p75854
ag50
aV(which extends the data-context)
p75855
aVThen you could cast the data-context:
p75856
as(dp75857
g18
V23354
p75858
stp75859
a((dp75860
g2
(lp75861
VNormally you would insert from a  via an adapter (such as )
p75862
aVThis will handle the nulls etc
p75863
aVYou could also use  if it is very large (although you need to be careful about transaction logs etc in that case, as a bulk insert might not be fully logged, IIRC)
p75864
aVcaveat: personally, I would be using a  here anyway - I'd be using regular typed classes
p75865
as(dp75866
g18
V23354
p75867
stp75868
a((dp75869
g2
(lp75870
VThere is a ShouldSerialize* pattern (introduced by TypeDescriptor, but recognised by a few other areas of code, such as XmlSerializer):
p75871
aVThat should sort it
p75872
aVA simpler option, though, is to assign it null
p75873
as(dp75874
g18
V23354
p75875
stp75876
a((dp75877
g2
(lp75878
VI think the thing to try here is simply to move the transaction complete outside the connection, i
p75879
ag50
aVAlso note that most times, it is easier to simply let exception handling bypass the Complete() for us, i
p75880
ag50
as(dp75881
g18
V23354
p75882
stp75883
a((dp75884
g2
(lp75885
s(dp75886
g18
V23354
p75887
stp75888
a((dp75889
g2
(lp75890
VIs it by design
p75891
aVNo it isn't
p75892
aVThe short version is that it wasn't considering inheritance of surrogates, and (for various reasons) most of the callbacks are only invoked by the effective base type of an inheritance chain (the exception here is OnDeserializing, which is invoked at sub-type levels as objects are created)
p75893
aVThis is fixed in r414
p75894
as(dp75895
g18
V23354
p75896
stp75897
a((dp75898
g2
(lp75899
VI for one don't, although one exists for wireshark if that helps
p75900
aVI haven't had time to look at the VS extension API necessary; also note that unless you have the schema (either as , or via a type-model) the format is internally ambiguous - a varint could be twos-complement or zig-zag encoded for example (with no distinction on the wire), or a fixed32 could be an int, a float, etc
p75901
aVA string could be a UTF-8 string, a packed array, or a sub-message
p75902
aVAnd so on
p75903
aVIf anyone wanted to implement this, the  available already exposes the necessary API to handle the core encoding - it is simply that interpreting that encoding really needs access to the schema
p75904
aVPlus, VS visualizer skills
p75905
aVMight I suggest that (unless you expect the raw data itself is corrupt) a simpler option is to deserialize into an object, and view the object in the debugger
p75906
as(dp75907
g18
V23354
p75908
stp75909
a((dp75910
g2
(lp75911
VIntelliTrace in VS2010
p75912
aVhttp://msdn
p75913
aVmicrosoft
p75914
aVcom/en-us/library/dd264915
p75915
aVaspx
p75916
aVhttp://msdn
p75917
aVmicrosoft
p75918
aVcom/en-us/magazine/ee336126
p75919
aVaspx
p75920
as(dp75921
g18
V23354
p75922
stp75923
a((dp75924
g2
(lp75925
V doesn't necessarily emit "typical" xml, and you don't have much control over the output
p75926
aVIt does, however, support full-graphs if you need
p75927
aVIf you want xml, and don't need full-graphs, I would tend towards  - it'll avoid having to write any code for manually traversing the data (ala  or ), yet give you control
p75928
aVOne caveat:  places demands on your type (public, public parameterless constructor, limited to public members, no serialization callbacks, etc)
p75929
aVThey are usually not a problem
p75930
aVBut then, I'd probably be writing binary instead of xml anyway ;p (just not with , which has
p75931
aVkinks)
p75932
as(dp75933
g18
V23354
p75934
stp75935
a((dp75936
g2
(lp75937
VI too would have expected it to leave it alone if it isn't in the xml, but I too can reproduce  what you are saying, both "as is", and with  on the member
p75938
aVI guess internally it is newing up the list "in case"
p75939
aVI also tried the alternative syntax just using a  and a lazy initializer, i
p75940
ag50
aVbut it still invokes this getter, even when no conflict data is included
p75941
aVAnd annoyingly the  pattern only ever gets called for data that is specified - it doesn't get called for data that isn't specified, else you could do:
p75942
aVAdd to that the fact that serialization callbacks aren't supported in  and I'm out of options
p75943
aVI've tested it back to
p75944
aVNET 2
p75945
aV0, and it behaves the same there too
p75946
as(dp75947
g18
V23354
p75948
stp75949
a((dp75950
g2
(lp75951
VThe only way you could do that would be to use something like:
p75952
aVHere:
p75953
aVis the  we'll use to store the data
p75954
aVis a shim property that handles the parsing etc
p75955
aVensures we only serialize valid data
p75956
as(dp75957
g18
V23354
p75958
stp75959
a((dp75960
g2
(lp75961
VYou have used  which forces it to use LINQ-to-Objects after running an unfiltered query at the server
p75962
aVTo use query composition you must use expression-trees, not delegates
p75963
aVChange it to:
p75964
as(dp75965
g18
V23354
p75966
stp75967
a((dp75968
g2
(lp75969
V is a reference-type
p75970
aVHonest
p75971
aVIt is only a struct when it is
p75972
aVYou would need to replace all the  with  for it not to box
p75973
aVHowever, there will be no inbuilt cast from  to
p75974
aVso: you can't
p75975
aVYou will have to box
p75976
aVPlus, not all enums are -based (your box-as-enum, unbox-as-int will fail for a , for example)
p75977
aVIn C# 4
p75978
aV0,  might be a cheeky way to do this:
p75979
aVOtherwise, some meta-programming (essentially to do what  does, but manually):
p75980
as(dp75981
g18
V23354
p75982
stp75983
a((dp75984
g2
(lp75985
VThe problem is the base-uri that it uses to associate each file (via XmlReader
p75986
aVBaseUri)
p75987
aVThe fix is fortunately simple; in :
p75988
aVNote that this means the logical name of the entity (for relative resolution) is now
p75989
aVIn your case that is fine, but if the path was using a folder structure you would need to be careful to ensure they are relative/rooted correctly
p75990
as(dp75991
g18
V23354
p75992
stp75993
a((dp75994
g2
(lp75995
VAs always, the best place to start is by writing down what you need it to do, and then you have a basis to evaluate the myriad of data-access tools available
p75996
aVDon't get side-tracked by YAGNI features - focus on what you actually need
p75997
aVThe decision itself is subjective; there are die-hards on all sides
p75998
aVPersonally I mix'n'match - I'm happy to use LINQ-to-SQL for editing data etc, and dapper-dot-net for read-only displays (it is faster)
p75999
aVI'm not anti-EF, but I haven't found I've needed to make that complexity step
p76000
aVRemember; the more complex the ORM/data-access, the more time you need to get it working, and the more reluctant you'll be to ever change it
p76001
aVWhich is why I like low-impact, low-complexity data-access that I can rip out and swap easily
p76002
as(dp76003
g18
V23354
p76004
stp76005
a((dp76006
g2
(lp76007
V is marked:
p76008
aVSo you need the  symbol defined at compile time for it to be included
p76009
aVThis is usually by checking the "Define TRACE constant" box in the project properties page (it is enabled by default for both Debug and Release profiles, so somebody has unchecked it at some point)
p76010
as(dp76011
g18
V23354
p76012
stp76013
a((dp76014
g2
(lp76015
VAre you tied to a specific serializer
p76016
aVprotobuf-net supports that use-case, for example:
p76017
aVNote the addition of  on the member-attributes; that is because protobuf uses numeric identifiers on fields/properties, and needs a way to choose them
p76018
aVYou can also use the project-specific / attributes, but it works with the WCF ones too (as shown)
p76019
aV( is also available on the non-generic 2
p76020
aV0 API - but you pass  in as an argument to  instead)
p76021
as(dp76022
g18
V23354
p76023
stp76024
a((dp76025
g2
(lp76026
VYou should look at , in particular:
p76027
as(dp76028
g18
V23354
p76029
stp76030
a((dp76031
g2
(lp76032
VIf you only subscribe once, it doesn't matter how many times you unsubscribe - unsubscribing when you don't have a subscription is a no-op
p76033
aVEqually, the entire point of the event API is that you can't accidentally unsubscribe other subscriptions (either other types, or other instances of the same type)
p76034
aVAs such, the code as shown should be fine, although it might be worth moving the two calls to a single method that handles this
p76035
aVThat might be overkill, though
p76036
aVAlso, if your type is , make sure it gets called in that code-path too (presumably by calling )
p76037
as(dp76038
g18
V23354
p76039
stp76040
a((dp76041
g2
(lp76042
V returns a new date - it doesn't change the existing value (it is immutable)
p76043
aVYou could perhaps use:
p76044
aVFor the middle term, you might also find  easier to read (at a glance) than
p76045
as(dp76046
g18
V23354
p76047
stp76048
a((dp76049
g2
(lp76050
VThe spec explicitly allows this; 12
p76051
aV3 in ECMA334v4
p76052
aVA struct-type variable is considered definitely assigned if each of its instance variables is considered definitely assigned
p76053
aVHowever, mutable structs are evil
p76054
aVSo I strongly suggest you DO NOT do this
p76055
aVMake the fields private readonly, set them via a custom constructor, and access them via a -only property:
p76056
as(dp76057
g18
V23354
p76058
stp76059
a((dp76060
g2
(lp76061
VPersonally I'd handle that afterwards at the client, but if you'd like a LINQ way, then I would probably avoid  - it'll be a more complex query
p76062
aVI'd go for:
p76063
as(dp76064
g18
V23354
p76065
stp76066
a((dp76067
g2
(lp76068
s(dp76069
g18
V23354
p76070
stp76071
a((dp76072
g2
(lp76073
VI can't repro, but I suspect that in your actual code there is a constraint somewhere that  - you need to propagate that to make the compiler happy, for example (hard to say for sure without a repro example):
p76074
as(dp76075
g18
V23354
p76076
stp76077
a((dp76078
g2
(lp76079
VYou need to add an implicit conversion operator from  to  for that to work
p76080
aVIn C#:
p76081
aVThen:
p76082
as(dp76083
g18
V23354
p76084
stp76085
a((dp76086
g2
(lp76087
VThe trick with LINQ would be to build an  from the data
p76088
aVAs an example, to illustrate the example shown:
p76089
aVIn particular, note how  can be used to compose the various operations (the same as multiple , but simpler)
p76090
as(dp76091
g18
V23354
p76092
stp76093
a((dp76094
g2
(lp76095
VIn the context of the comment:
p76096
aVwas found to be one of the quicker options -- certainly much faster than the vanilla BasicHttpBinding/WS binding that was tried
p76097
aVThat's the only real need since netTcpBinding used binary vs straight text it was faster
p76098
aVFirstly, I have looked at this many, many times - and oddly enough, every time I test it,  completely fails to be any quicker than the basic xml offering
p76099
aVHowever, since performance is your goal I have options
p76100
aVI'm a bit biased (since I wrote it), but I strongly recommend "protobuf-net" here; since it is designed along the same idioms as most
p76101
aVNET serializers, it is pretty easy to swap in, but it is faster (CPU) and smaller (bandwitdh) in every test I make for this - or tests that other people make
p76102
aVAnd because the protobuf format is an open specification, you don't have to worry about the "Net" bindings being non-interoperable
p76103
aVFor MS
p76104
aVNET, I have direct WCF hooks that can be used purely from config making enabling it a breeze
p76105
aVI honestly don't know how well that will work with the Mono equivalent - I haven't tried
p76106
aVIt might work, but if not the other option is to simply throw a  or  over the network and worry about (de)serialization manually
p76107
aVMy preferred layout here is basic-http binding with MTOM enabled, which gives you the simplicity and portability of the simplest xml binding, without the overhead of base-64 for the binary data
p76108
as(dp76109
g18
V23354
p76110
stp76111
a((dp76112
g2
(lp76113
VThere are two separate types of interning here; there's interning while deserializing -  this is always enabled, so if duplicates are in the data, you should only see a single
p76114
aVNET  instance in your managed classes, re-used as many times as needed
p76115
aVThere is also interning while serializing, to avoid duplicating data into the stream while serializing
p76116
aVThis is  not on by default, for the simple reason that no such behaviour is defined in the protobuf spec; protobuf-net tries to stay inside the spec by default, only using extensions on an opt-in basis
p76117
aVIf you want to enable this for protobuf-net=to=protobuf-net usage, then enable the  option for any given string:
p76118
aVThis uses a protobuf-net implementation-specific representation
p76119
aVIt won't play very nicely for interop purposes, however
p76120
aVIf you need this in an interoperable way, the only thing to do is store the lists separately (perhaps in a  somewhere), and use the position in the list in your data, i
p76121
ag50
as(dp76122
g18
V23354
p76123
stp76124
a((dp76125
g2
(lp76126
VThe easiest fix there is
p76127
aVwhich is also actually cheaper than  as it omits the has-value check
p76128
aVIt will default to  , which is indeed  here (it just returns the value of the underlying  field, without any checks at all)
p76129
aVIf you need a different default to , then:
p76130
as(dp76131
g18
V23354
p76132
stp76133
a((dp76134
g2
(lp76135
VThe method is fine, but you need to do something in the case that an  happens, since you don't re-throw
p76136
aVThat means you could exit the method (after an exception in ) without giving it a value
p76137
aVIn this case, maybe:
p76138
as(dp76139
g18
V23354
p76140
stp76141
a((dp76142
g2
(lp76143
VThe only time you use protobuf here is:
p76144
aVwhere you have written xml ( is an ), and then attempted to read it via protobuf ()
p76145
aVHowever; protobuf is not xml; it is a binary format completely unrelated to xml
p76146
aVIf your intention is to deep-clone the data, you should also serialize with protobuf-net ()
p76147
aVIt is often possible to convert a model between the two formats, but the streams themselves are not swappable
p76148
as(dp76149
g18
V23354
p76150
stp76151
a((dp76152
g2
(lp76153
VA network stream in isolation has no automatic segregation of messages - it is all just bytes
p76154
aVAs such, it is necessary to split manually; the most convenient to write is using a known delimiter between records
p76155
aVThe most convenient to read is to prefix each message with the number of bytes to read in the next message
p76156
aVYou need to use this information to read entire messages, otherwise the reading goes mad
p76157
aVIn this case, I suspect you read both messages completely in the first Receive, and now there is no more data - hence the blocking (it must block until either at least one byte can be read, or it is closed)
p76158
aVAlso - note that because you read doesn't mean you have a full message - just at least one byte
p76159
aVYou usually need to loop to get a message
p76160
as(dp76161
g18
V23354
p76162
stp76163
a((dp76164
g2
(lp76165
VIt depends on the intent
p76166
aVIf the purpose if your service is to have a logical and/or physical boundary between layers, then usig the same type on either side of the boundary does nothing to harm that, and can make everything work a lot more conveniently
p76167
aVIt also gives you a single type model to test etc
p76168
aVThe mex/wsdl approach is especially useful when exposing a public service interface, or where cross-platform portability is an issue
p76169
aVBut if you don't need that, it can be very tempting (right or wrong) to re-use the types
p76170
aVAn overly simplified version of this can even be when an app talks to the same app on a different node via some private API - introducing a separate type model here adds little
p76171
aVAdditionally, sharing the types can give a more typical (less code-gen foolery) API, and with the logic in the types to perform validation you can get richer validation
p76172
aVI would approach this more from a "what do I need/expect" from this service; if "it must be cross-platform and independent of the type-model in my core application" isn't on the list, maybe cross that bridge if/when it arises
p76173
as(dp76174
g18
V23354
p76175
stp76176
a((dp76177
g2
(lp76178
VI've parsed it through the reader in v2, and it seems to make perfect sense:
p76179
aVNote that I've done that purely from the hex data (not using the
p76180
aVproto), but it should be close to your original data
p76181
aVBut most notably, it seems intact
p76182
aVSo: first thing to do; check that the binary you get at the C++ side is exactly the same as the binary you sent; this is doubly important if you are doing any translations along the way (binary => string, for example - which should be done via base-64)
p76183
aVsecond thing; if that doesn't work, it is possible that there is a problem in the C++ implementation
p76184
aVIt seems unlikely since that is one of google's pets, but nothing is impossible
p76185
aVIf the binary comes across intact,  but it still behaves oddly, I can try speaking to the C++ folks, to see if one of us has gone cuckoo
p76186
as(dp76187
g18
V23354
p76188
stp76189
a((dp76190
g2
(lp76191
VWith the edit, it sounds like you want the length without serializing it (since if you want the length with serializing it, you'd just serialize it and check the )
p76192
aVBasically, no - this isn't available
p76193
aVI know that some of the other implementations build this data eagerly, that is in part because they are constructing the buffered data all the time, where-as protobuf-net works from an object graph
p76194
aVprotobuf-net does not do this - it builds the data by discovery during a single pass over the object graph
p76195
aVIs there a specific purpose you have in mind
p76196
aVThings can always be added (with effort, though)
p76197
aVRe the issue of a notes (string) field that you don't want to be over-sized; as a sanity check, note that protubuf uses UTF8 or string data, so personally I would just do:
p76198
aVnote we've checked this a bit more cheaply in the obvious cases
p76199
as(dp76200
g18
V23354
p76201
stp76202
a((dp76203
g2
(lp76204
VRunnning wsdl manually:
p76205
aVThe wsdl isn't very
p76206
aVNET-friendly, it seems
p76207
as(dp76208
g18
V23354
p76209
stp76210
a((dp76211
g2
(lp76212
VProperties provide controlled access to data; at the most basic, it can just mean encapsulating a field (public fields are not recommended), which the compiler can make easy for you:
p76213
aVYou could, however, use the property to enforce logic or handle side effects:
p76214
aVOther common options are lazy-loading, calculated members, proxied members, etc
p76215
aVYou can also change the accessibility, for example:
p76216
aVwhich can only be assigned by the type and subclasses, not by unrelated code
p76217
aVIt could also only have a get or set
p76218
aVBasically, properties act as a more formal version of a get/set pair of methods, making it much easier to talk about "Foo", rather than "get_Foo"/"set_Foo" etc (for two-way binding)
p76219
aVUnlike fields, properties can also be advertised on interfaces, which is essential for interface-based code
p76220
as(dp76221
g18
V23354
p76222
stp76223
a((dp76224
g2
(lp76225
VThat is entirely correct
p76226
aV"Get" (BookSleeve) returns a deferred
p76227
aVYou have correctly used Wait to get the actual , then used a  over this  to call  via protobuf-net
p76228
aVAll good
p76229
aVIf you make it clear any steps that you find ugly, I might be able to be more specific, but:
p76230
aVBookSleeve is entirely async via , hence the need for either  or  to access the
p76231
aVprotobuf-net is entirely Stream-based, hence the need for  to sit on top of a
p76232
aVOf course, if you add a generic utility method (maybe an extension method) you only need to write it once
p76233
aVAnd with the addition if a wrapper class (for some tracking/sliding-expiry) and a L1 cache (Redis as L2), this is pretty much exacty how we use it at stackoverflow
p76234
aVOne note: the connection is thread safe and intended to be massively shared; don't do a connection per operation
p76235
as(dp76236
g18
V23354
p76237
stp76238
a((dp76239
g2
(lp76240
VThere are options in v2 here:
p76241
aVyou can configure a RuntimeTypeModel telling it about types and members without needing any attributes
p76242
aVfor types that are awkward, a surrogate can be supplied to make serialization easier (it must have conversion operators to/from the original type)
p76243
aVfor APIs where the types aren't static-typed, there is an option to include type metadata
p76244
aVNow, I think some of that addresses some of your points
p76245
aVIf you can fully specify a scenario that is problematic I might be able to be more specific (or think of new ways of torturing the code to make it work)
p76246
aVBut to answer the headline question (non-decorated): yes, in v2
p76247
as(dp76248
g18
V23354
p76249
stp76250
a((dp76251
g2
(lp76252
VFor simplicity of using a pre-build serializer, I recommend protobuf-net; here is protobuf-net v2, with just adding some attributes:
p76253
aVusing:
p76254
aVto serialize
p76255
aVThis takes 10,960,823 bytes, but note that I tweaked SetupTestArray to limit the size to 10,000 since by default it uses "varint" encoding on the integers, which depends on the size
p76256
aV10k isn't important here (in fact I didn't check what the "steps" are)
p76257
aVIf you prefer a fixed size (which will allow any range):
p76258
aVWhich takes 16,998,640 bytes
p76259
as(dp76260
g18
V23354
p76261
stp76262
a((dp76263
g2
(lp76264
VConstructors, when generated from C#, are invoked base-class first, so:
p76265
aVobject()
p76266
aVthen Parent()
p76267
aVthen Child()
p76268
aVEssentially the chained  is prepended to the local
p76269
aVFor this reason you should avoid calling virtual methods during construction, as if Child overrides it, it could fail as Child hasn't initialized the fields defined there yet (they will be zeros)
p76270
aVIn C++/CLI you get to choose what order to do things
p76271
as(dp76272
g18
V23354
p76273
stp76274
a((dp76275
g2
(lp76276
VActually, the first consideration I'd make is "do I really need SOAP/XMl
p76277
aVIn particular:
p76278
aVWSDL is not nearly as cross-platform as is suggested; it is very easy to get cases that don't work well (there was one here on SO re PayPal earlier this week)
p76279
aVXML is human readable
p76280
aVBut as a result is relatively slow and bloated
p76281
aVThere are other ways of sharing a definition - for example, we all manage just fine with an API document that says "this API returns JSON in this shape {
p76282
aV}"
p76283
aVWSDL mainly seems to help drag-and-drop developers; of which I am not one
p76284
aVAs such, I suggest looking at simpler (think: YAGNI) protocols
p76285
aVFor payload, I'm a big fan of protobuf, which deliberately is a simpler schema and therefore allows for much less uncertainty over what can/can't be handled by different implementations, while still covering every sane use-case
p76286
aVIt is also very efficient or both CPU/bandwidth
p76287
aVVery portable, and has a schema definition language (
p76288
aVproto) for defining the data, but MUCH simpler than WSDL
p76289
aVShock horror
p76290
aVIt isn't human readable
p76291
aVWell, there are tools for that :) why impose the failings of us week and slow flesh-based units on our APIs
p76292
as(dp76293
g18
V23354
p76294
stp76295
a((dp76296
g2
(lp76297
V operates at the (public) field/property level
p76298
aVIn doing so, one of the things it looks at is the similar
p76299
aVIt does not look at methods at all, except for a few assistance patterns like
p76300
aVAs such, there would seen to be no crossover at all with parameters, ad no need to look at
p76301
as(dp76302
g18
V23354
p76303
stp76304
a((dp76305
g2
(lp76306
VIt depends a bit on whether the enum is itself based on   ;p
p76307
aVIf it is, nothing happens - enums are represented entirely in their  /  whatever form until you box them
p76308
aVCasting from  <===>  is a no-op
p76309
aVMost distinctions that you are familiar with in terms of method overload resolution etc exist purely for the compiler; at the IL level there is no difference whatsoever
p76310
as(dp76311
g18
V23354
p76312
stp76313
a((dp76314
g2
(lp76315
VI would have a class representing the 6 things
p76316
aVand a  - then you can:
p76317
aVand
p76318
as(dp76319
g18
V23354
p76320
stp76321
a((dp76322
g2
(lp76323
V should act as a cast here
p76324
as(dp76325
g18
V23354
p76326
stp76327
a((dp76328
g2
(lp76329
VI haven't finished the tooling in that area, but note that RuntimeTypeModel has a Compile() method that takes a path and type name; this is the method you want
p76330
aVI suggest trying this from a "full"
p76331
aVNET console application
p76332
aVto generate the ell then reference that from SL (also referencing the SL build of the protobuf-net dll)
p76333
aVYou might get an IDE warning about the reference, but from memory it should work
p76334
aVLong term I suspect I need to switch to the IKVM emit (to explicitly target SL), and either way I need to build an exe to do this for you automatically (presumably using some pattern to find a method to generate your RuntimeTypeModel through code)
p76335
aVOnce you have that reference you can use the model you named when generating it;  this up and away you go
p76336
aVNote that when using this approach, you can't serialize against private members - the runtime will not allow it
p76337
as(dp76338
g18
V23354
p76339
stp76340
a((dp76341
g2
(lp76342
VThe database is simply the wrong level to be formatting things
p76343
aVIt's jobs:
p76344
aVdata in, data out (queries/manipulation in whatever form)
p76345
aVrobust persistence, integrity, atomicity, etc (ACID)
p76346
aVand nothing else
p76347
aVsure, you could format that at the DB, but why would you
p76348
aVThat should be done in your app-tier, allowing:
p76349
aVcache and reuse of the unchanging  (where-as "1 minute ago" changes constantly with time) - cache the data, etc
p76350
aVinternationalization and localization
p76351
aVcorrect encoding for the UI (is it html
p76352
aVxml
p76353
aVxaml
p76354
aVcsv
p76355
aVtxt
p76356
aVwinforms
p76357
aV- the DB should not know about the UI
p76358
aVscaling "out" rather than "up" - don't do more than you need in the DB; multiple app servers are cheaper than a ultra-powerful DB server
p76359
aVAs for "coding in the code behind of my aspx page", well you don't need to do that either ;p (but then, I'm pretty partial to MVC+razor)
p76360
as(dp76361
g18
V23354
p76362
stp76363
a((dp76364
g2
(lp76365
VSure:
p76366
aVThe "3" can be anything as long as it doesn't clash with anythig else from ClassA
p76367
aVThis will appear as a nested message on the wire, but automatically
p76368
aVIf this is expressly not what you want, then let me know
p76369
as(dp76370
g18
V23354
p76371
stp76372
a((dp76373
g2
(lp76374
VThe  method is now called automatically (and with appropriate write-locks, etc) by the static constructor, which should in turn be called when you first call
p76375
aVThis should inject the routes into the route-table
p76376
aVSo unless you are explicitly clearing the route-table at some point after you have first touched the profiler, it should (all things being equal) work
p76377
aVI wonder if this is a security thing
p76378
aVFor example, which version of IIS are you running with
p76379
aVIn some configs (IIS6 in particular) the path needs to be recognised by the server, or you need to enable a wildcard
p76380
aVIf this is the case, please let me know - maybe we can implement some kind of fallback route to an ashx or something
p76381
aVUpdate: the problem is that you aren't saving the results at the end of the query; there is both short-term and long-term storage, and both have default implementations provided - all you need to do is something like:
p76382
aVUpdate update: you may also need to add the following to web
p76383
aVconfig, in the ,  section:
p76384
as(dp76385
g18
V23354
p76386
stp76387
a((dp76388
g2
(lp76389
VMake sure you are reading up to date material - CAS has changed significantly in 4
p76390
ag190
aVWith the exception of things like principal permissions, it is pretty much deprecated, except within specific hosts like IE
p76391
aVSo: I wouldn't worry about it
p76392
as(dp76393
g18
V23354
p76394
stp76395
a((dp76396
g2
(lp76397
VThere's a couple of issues in this approach; yes, in standard protocol buffers any kind of  metadata is a bit naughty, as it isn't really interoperable, but I play a little loose with that in v2 on an opt-in basis - allowing you to send  etc as long as internally it still knows what you mean
p76398
aVThis, however, will get expensive for cell-by-cell work, even with the optimisations built in (it only sends the same type meta once, for example)
p76399
aVIMO, though, a far better option is to restrict yourself to a list of known types that are all known ahead of time
p76400
aVIf you can do that there are some interesting tricks with inheritance that are pretty efficient and reasonably suited for this scenario
p76401
aVBut essentially you'd have something like:
p76402
aV(pseudo-code, incomplete)
p76403
aVI'd happily walk you through a lot of that, but you might also want to look at this blog entry to see if using  (much as I dislike it for data-access) might save some effort here
p76404
as(dp76405
g18
V23354
p76406
stp76407
a((dp76408
g2
(lp76409
VThe list variable / field only exists for the duration of a single request; any button-click (such as Save) is a separate request, with an entirely different set of objects
p76410
aVIn many cases it won't even be served by the same server
p76411
aVIf you need state between requests, you need to manage that state, perhaps via session-state
p76412
as(dp76413
g18
V23354
p76414
stp76415
a((dp76416
g2
(lp76417
VYou will have to use reflection at some point, via  (or maybe )
p76418
aVIf this is a frequent code-path you may want to cache some kind of strategy per-type to avoid overhead
p76419
aVOr perhaps better: use a pre-built serialization API that optimises for this type of scenario (i
p76420
ag50
aVmost of them)
p76421
aVIf you mean the  and , then 2 options:
p76422
aVput those two properties on an interface, implement that interface from the t 2 types, and add the  constraint to
p76423
aVuse  to duck-type to the properties
p76424
as(dp76425
g18
V23354
p76426
stp76427
a((dp76428
g2
(lp76429
VThe only way to know for sure is to profile in your context
p76430
aVTo set expectation,  is pretty smart, and caches (per pattern) the actual code-path
p76431
aVAs such, it is much faster than raw reflection, however an interface should be slightly faster and has the advantage of static checking
p76432
aVPersonally, I'd code to an interface from a library dll that both the current code and SampleLib can reference, i
p76433
ag50
as(dp76434
g18
V23354
p76435
stp76436
a((dp76437
g2
(lp76438
VYou don't
p76439
aVYou can't
p76440
aVThat is not supported in C# or
p76441
aVNET
p76442
aVYou use multiple interface implementation, and at most single (non-) inheritance
p76443
aVIn most cases, even single inheritance is vastly overused ;p
p76444
aVTo absorb the methods, you'd have to use some kind of encapsulation
p76445
aVExtension methods also provide a way to share methods between types, for completeness
p76446
as(dp76447
g18
V23354
p76448
stp76449
a((dp76450
g2
(lp76451
V means that all calls (methods, properties, etc) are proxied over the wire
p76452
aVThis potentially means that instead of transferring the data once and then running multiple methods etc locally on the transferred data, you are making a network call every access
p76453
aVHow many times (per request) is a role tested, for example
p76454
aVor the name queried
p76455
aVI honestly don't know, but I'm guessing it is more than 1 (all totalled)
p76456
aVPlus the original setup costs
p76457
aVThe bandwidth probably won't be significant, but latency is very significant, especially if you have distributed nodes (since you mention a cloud scenario)
p76458
aVPersonally, I would avoid  like the plague, but up to you
p76459
as(dp76460
g18
V23354
p76461
stp76462
a((dp76463
g2
(lp76464
VThe error is correct; partial methods do not exist if not implemented, so you can't bind a delegate to them in quite that way
p76465
aVYour best option here is either to call it manually based perhaps on a switch (or similar), or if you really need a delegate, look for the method with reflection (remembering to specify non-public binding-flags) and use  if the method turns out to exist
p76466
aVOr a lazy option:
p76467
aVnow bind your delegate to  instead of
p76468
aVIn terms of delegates, this could also be as simple as changing it to an indirect delegate, which is very similar to the  approach:
p76469
aV(however, if that is an expression rather than a delegate I would expect failure)
p76470
as(dp76471
g18
V23354
p76472
stp76473
a((dp76474
g2
(lp76475
Vwith  as
p76476
aVand note that the  are the literal  (escaped via the  character we specified) - the  and  are the  wildcards akin to  and  respectively
p76477
as(dp76478
g18
V23354
p76479
stp76480
a((dp76481
g2
(lp76482
Vwith  things are either lists or they have members
p76483
aVTo do that you need:
p76484
aVwith example:
p76485
aVwhich generates:
p76486
aVyou can remove the / namespace aliases if you want, of course
p76487
as(dp76488
g18
V23354
p76489
stp76490
a((dp76491
g2
(lp76492
Vprotobuf-net supports a number of patterns to aid this type of scenario, the simplest being (to share the pattern used by System
p76493
aVComponentModel):
p76494
aVThis assumes you have some mechanism for tracking the changes yourself (for hooking into the  method); protobuf-net doesn't do change tracking itself
p76495
aVIf you don't currently have any change tracking, you might be able to use something from this answer: Comparing 2 objects and retrive a list of fields with different values
p76496
as(dp76497
g18
V23354
p76498
stp76499
a((dp76500
g2
(lp76501
V(heavily revised)
p76502
aVBased on the comments, the scenario presented is:
p76503
aVthere are two types, which happen to be subclasses in C#
p76504
aVin serialization, we just want to flatly swap between them - no inheritance code (i
p76505
ag50
aVso you can save as  and load as , or v
p76506
ag10042
aVThis is a little different to the normal use case, where inherited types expect inheritance during serialization (which changes the data),  and unrelated types are interchangeable as long as the contract fits
p76507
aVThere are a couple of ways of approaching this; one minor issue is that by default it doesn't look at inherited properties, to avoid duplication
p76508
aVYou could re-advertise them, but that is a bit ungainly
p76509
aVPersonally, I think I'd be tempted to just tell it what to do during app-startup:
p76510
aVNow your existing  code will treat  correctly, including the two properties as indicated
p76511
as(dp76512
g18
V23354
p76513
stp76514
a((dp76515
g2
(lp76516
VDoes the attribute you've added apply to the event
p76517
aVor to the field
p76518
aVI'm not a C++ guru, but that looks like a C++ implementation of a "field-like event"
p76519
aVThe  attribute only applies to the backing field - not the
p76520
aVIn C#, you would target the field via:
p76521
aVso: make sure you are targetting the field
p76522
aVI can't advise on the C++ syntax for that, though
p76523
aVMaybe there isn't one and you need to use an explicit event implementation with a field you add yourself (and can then decorate)
p76524
aVThis is supported by a quick search that shows that error number linked to:
p76525
aVwhich is exactly what I would expect to see if targeting the event rather than the field
p76526
aVAs an aside - events on structs are tricky beasts
p76527
as(dp76528
g18
V23354
p76529
stp76530
a((dp76531
g2
(lp76532
VThe problem here is that  is getting the hex encoding of the data, where-as  is getting your server's configured decoding of the bytes (which isn't really valid, since that data is not text-based)
p76533
aVVery different things
p76534
aVIf you keep as varbinary and compare to a  you should be fine
p76535
aVIf you are using SQL Server 2008, you can also use:
p76536
aVto get the hex-encoded version (you can use  instead of  to get a leading )
p76537
as(dp76538
g18
V23354
p76539
stp76540
a((dp76541
g2
(lp76542
VThe way to do that is to make it an abstract member in the base class, and override in the derived; the other approach you could use is to try casting  to  - if it succeeds, use it via the interface, i
p76543
ag50
aVIt does seem a little unusual, though, not to push this down to the base-class if it is a mandate of all subclasses
p76544
aVBy pushing it to the base-class, you cannot forget to implement the missing member
p76545
as(dp76546
g18
V23354
p76547
stp76548
a((dp76549
g2
(lp76550
VAs with all attributes, the included type information on attributes apply to all closed types from the generic type definition
p76551
aVThus, what you have actually defined (to protobuf-net) is:
p76552
aVAs you can see, there are lots of duplicates - which is clearly confusing
p76553
aVSince attribute arguments can't use type parameters, this would leave the option of adding some kind of odd predicate mechanism, which is IMO pretty confusing
p76554
aVIMO, it would be a better idea to model this manually (removing the  attributes)
p76555
aVI suspect your intended model is:
p76556
aVprotobuf-net can work with that, but to explain the model requires "v2" and the :
p76557
aVNote also that  is a bit of a problem for protobuf; protobuf-net can fake around it with the dynamic-type option, but that is
p76558
aVnot ideal
p76559
aVIt certainly can't serialize an , so for the test I've substituted a string
p76560
aVNote also that ,  and  are not currently marked for serialization, but can be trivially
p76561
aVAnyway:
p76562
aVYou don't have to use  - in fact, I recommend using (and caching) a separate type-model; but  points at the default model
p76563
aVIf you create a custom model () just store it somewhere and use the  etc from there
p76564
as(dp76565
g18
V23354
p76566
stp76567
a((dp76568
g2
(lp76569
VThat almost always means you aren't calling  on your connections, and you have saturated the pool until GC runs - which it probably won't if your app is now dead
p76570
aVEssentially, you have opened connections successively over a period of time (without ever giving them back), and now there are none left
p76571
aVSolution: give them back to the pool when you are done
p76572
aVWhenever you use something like a connection, use a  statement, or some other mechanism to ensure it is disposed promptly when you are done with it
p76573
aVThe same applies to anything , but connections are particularly vulnerable to this
p76574
as(dp76575
g18
V23354
p76576
stp76577
a((dp76578
g2
(lp76579
VIt sounds like you are simply missing a reference to ent-lib (assuming by "sqlhelper" you mean the MS application blocks example)
p76580
aVAdd that reference, and your  directive should start working
p76581
aVIf you have changed your ent-lib version, note that "sqlhelper" is obsolete
p76582
aVI believe this was replaced by  (and  etc)
p76583
aV(this should not be taken as a recommendation to use ent-lib; quite the opposite - I am not a fan ;p)
p76584
as(dp76585
g18
V23354
p76586
stp76587
a((dp76588
g2
(lp76589
VSince  is simply a public field (and non- at that), there are no guarantees about what you see; the normal sensible rules about what you see only apply on a single thread, and you have not guarded any of this data
p76590
aVThere is also an edge-case around the start condition, but personally I would be using either  (if you need to wait for it to complete), or maybe  if you just need to know if it is active
p76591
aVFor example:
p76592
aVand
p76593
aVWith the above, you are guaranteed that only one thread will have the lock at any time, so if you get to "do stuff" you know that it isn't also running the other Update()
p76594
aVIf you need to wait etc there are also  /  methods against locks, or you can use gates such as /
p76595
aVThings like  also ensure correct memory barriers between the threads, so you see the correct data
p76596
as(dp76597
g18
V23354
p76598
stp76599
a((dp76600
g2
(lp76601
VHaving a  block from data-access talk to  tells me you have your UI code and your DB code too close together
p76602
aVI would not do that; my DB code would be simply:
p76603
aVor perhaps something a lot cleaner using "dapper":
p76604
aVand my UI code would be
p76605
aVwhere  tells the user about the problem (perhaps sanitized) without needing evert operation to know the UI details
p76606
as(dp76607
g18
V23354
p76608
stp76609
a((dp76610
g2
(lp76611
VYou can't lock "the array" if it is null; but it wouldn't matter anyway - the reference can't change; it is still the same reference even if the contents change
p76612
aVSo you can defer the lock until you are interested in the contents
p76613
aVSo:
p76614
aVnull check
p76615
aVlock
p76616
aVcheck contents / use contents
p76617
aVIf you mean general validity - it depends on whether any threads are going to change the contents
p76618
aVIf not
p76619
aVmeh, no locks needed
p76620
aVIf they are changing the contents, you need to lock before you validate, otherwise your validations are moot
p76621
as(dp76622
g18
V23354
p76623
stp76624
a((dp76625
g2
(lp76626
VBlocking "any requests" isn't exactly running
p76627
aVIf you mean some kind of read-only mode where your app services queries but not changes, you would have to code that yourself
p76628
aVYou might be able to do something fancy via a WCF extension, but I'm not sure I'd bother personally - I'd just check "is the admin flag set" at the start of all the "doing" methods
p76629
aVOr potentially all methods if that is your intent
p76630
aVYou would return a known fault/exception that the caller may (or may not) handle gracefully
p76631
aVIf the number of methods is non-trivial, then sure - look to WCF extension points
p76632
aVI'm thinking an "operation behaviour", although there are many extension points
p76633
as(dp76634
g18
V23354
p76635
stp76636
a((dp76637
g2
(lp76638
VJon's multiple optionals covers the simplest setup, especially if you need cross-platform support
p76639
aVOn the
p76640
aVNET side (to ensure you don't serialize unnecessary values), simply return  from any property that isn't a match, for example:
p76641
aVYou can also do the same using the  pattern if you don't like the nulls
p76642
aVWrap that up in a  and you should be fine to use that at either the field level or list level
p76643
aVYou mention optimal performance; the only additional thing I can suggest there is to perhaps consider treating as a "group" rather than "submessage", as this is easier to encode (and just as easy to decode, as long as you expect the data)
p76644
aVTo do that, use the  data-format, via , i
p76645
ag50
aVHowever, the difference here can be minimal - but it avoids some back-tracking in the output stream to fix the lengths
p76646
aVEither way, in terms of overheads a "submessage" will take at least 2 bytes; "at least one" for the field-header (perhaps taking more if the  is actually ) - and "at least one" for the length, which gets bigger for longer messages
p76647
aVA group takes 2 x the field-header, so if you use low field-numbers this will be 2 bytes regardless of the length of the encapsulated data (it could be 5MB of binary)
p76648
aVA separate trick, useful for more complex scenarios but not as interoperable, is generic inheritance, i
p76649
ag50
aVan abstract base class that has ,  etc listed as subtypes - this, however, takes an extra 2 bytes (typically), so is not as frugal
p76650
aVTaking another step further away from the core spec, if you genuinely can't tell what types you need to support, and don't need interoperability - there is some support for including (optimized) type information in the data; see the  option on  - this takes more space than the other two options
p76651
as(dp76652
g18
V23354
p76653
stp76654
a((dp76655
g2
(lp76656
VThe short version is that should already work; based on the error:
p76657
aVThe type : SMDApp
p76658
aVModels
p76659
aVCagedAnimal is not supported by dapper
p76660
aVI conclude that either you are actually passing  instead of , or, your  has a property (, perhaps
p76661
aVthat is itself a , and which dapper can't understand
p76662
aVThe current behaviour is that a parameter is added for every public property of the provided parameter object - and if it can't figure out how to send any of the properties to the database, it complains
p76663
aVYou should find that a simple POCO with just value members works fine
p76664
aVHowever
p76665
aVNote that it does not ever attempt to parse your SQL - in particular, it does not check for parameters in the query provided
p76666
aVAs such, using the POCO approach will mean that you are adding unnecessary properties to the query
p76667
aVWe use dapper extensively, and we just use the approach:
p76668
as(dp76669
g18
V23354
p76670
stp76671
a((dp76672
g2
(lp76673
VThe system can't process anything from the message queue (i
p76674
ag50
aVbutton clicks, repaints, etc) until your  completes - which it never will
p76675
aVThis is exactly what causes all those "{blah} is not responding" messages - code that doesn't respond to the message queue promptly
p76676
aVBasically, don't do that
p76677
aVA hacky fix would be some , but NO
p76678
aVdo it properly; basically, handle the event from  instead
p76679
aVPerhaps you should run the refreshes from a timer tick
p76680
as(dp76681
g18
V23354
p76682
stp76683
a((dp76684
g2
(lp76685
VIf you only serialize  in the context of , you can mark the other members with  and they won't appear
p76686
aVIf you need a different layout in different contexts, then you can use  to define the model at runtime, but this isn't trivial
p76687
aVAlso, if doing this you MUST cache and re-use the resulting  (there is a ctor that accepts the overrides), or it will leak dynamic assemblies (there is an inbuilt cache for the trivial  serializers, but custom serializers are not automatically cached, and generate an assembly each; assemblies cannot be unloaded)
p76688
as(dp76689
g18
V23354
p76690
stp76691
a((dp76692
g2
(lp76693
VBased on VS2010, but similar should work for other versions:
p76694
aVTools > Options > Projects and Solutions > Build and Run
p76695
aVChange the "MSBuild project build output verbosity" to "Normal" (or higher)
p76696
aVBuild, and bring up the Output window (ctrl+w, o)
p76697
aVChange the "Show output from" drop-down to "Build"
p76698
aVYou should see an indicative  line
p76699
aVNote this is not truly what it executed; it is a happy lie
p76700
aVIIRC it actually executes directly, and there are some corner-cases where what it outputs there is not quite the same as what you would need
p76701
as(dp76702
g18
V23354
p76703
stp76704
a((dp76705
g2
(lp76706
V also accepts , and  accepts most combinations of  input, and ,  and  as output
p76707
aVSo most typically, you might use a  for the output, and a  created from a  for the input
p76708
aVFull example, no files:
p76709
as(dp76710
g18
V23354
p76711
stp76712
a((dp76713
g2
(lp76714
VI have a pretty simple approach to these things - if it doesn't play nicely, just invent a view-model, i
p76715
ag50
aVan object layout designed to make mapping between your domain model and the UI plain sailing
p76716
aVThis can also encourage you to populate your data in the correct shape for the view-model, rather than for the domain-model; and this often has decent savings in terms of reducing the number of columns (and sometimes rows) fetched, and (perhaps more importantly) avoiding multiple trips to the DB (by fetching exactly the right data, in one hit, in the right shape)
p76717
aVFrom a view-model, you can then use simple data-binding techniques, as the data you want is now directly available as first-level values on the view-model
p76718
as(dp76719
g18
V23354
p76720
stp76721
a((dp76722
g2
(lp76723
VIf you are purely CPU-bound (i
p76724
ag50
aVthere is no unrelated cost we don't know about such as disk/network IO which might not scale linearly), and if each test is independent (no lock conflicts), then pretty-much yes this will help
p76725
aVIt is rarely quite linear (due to overheads), but close enough
p76726
aVIf you are on a web-server you might want to stay fairly reserved as it is already highly threaded, but if you have the whole machine, use all the cores you have
p76727
aVIndeed, Parallel
p76728
aVForEach etc will do all this for you if you don't want the code pain
p76729
aVWe've used tricks like this successfully here on the stackoverflow site, although since t is a web-server we limit the parallelism to 2 threads per request, which neatly halves the time
p76730
aVIn out case, due to the need to combine the results afterwards using more treads was actually counter-productive - 2 was our sweet-spot
p76731
aVBit if you don't need to combine the results in any clever way you can up the parallelism a bit
p76732
as(dp76733
g18
V23354
p76734
stp76735
a((dp76736
g2
(lp76737
VMy advice; don't concatenate input ;p (as always)
p76738
aVYou can still use parameters with EXEC, especially with sp_ExecuteSQL
p76739
aVThat will avoid all the issues and allow query-plan re-use
p76740
aVNEVER concatenate user input, even in TSQL
p76741
aVALWAYS use parameters, unless it is absolutely impossible to do so
p76742
aVAs a trivial example (in particular to show how the parameter names don't need to match):
p76743
aVwe are passing in @a and @b as parameters (mapping to @x and @y) to the SQL in @sql, and executing in a safe, re-usable, cachable way
p76744
as(dp76745
g18
V23354
p76746
stp76747
a((dp76748
g2
(lp76749
VIndeed, that won't work
p76750
aVSo don't do that
p76751
aVAdditionally, there are no hooks to detect xml serialization except the oh-so-painful
p76752
aVSo either:
p76753
aVdon't use a read-only collection here
p76754
aVimplement  (tricky)
p76755
aVhave a dual API (one read-only, one not; serialize the "not" - tricky as  only handles publicx members)
p76756
aVuse a separate DTO for serialization
p76757
as(dp76758
g18
V23354
p76759
stp76760
a((dp76761
g2
(lp76762
VYou cannot do that without the table name, no
p76763
aVHowever, the bigger problem is that your code is horribly dangerous and at rick from SQL injection
p76764
aVYou should fix this right now, today, immediately
p76765
aVInjection, even for internal apps, is the single biggest risk
p76766
aVBetter code would be:
p76767
aVadding the parameters  and  to your command (obviously, replace with sensible names)
p76768
aVBefore you ask: no, the table name cannot be parameterised; you cannot use
p76769
aVThe table name(s) is(/are) fundamental in any query or operation
p76770
as(dp76771
g18
V23354
p76772
stp76773
a((dp76774
g2
(lp76775
VIt would seem that you already have
p76776
aVThe issue, perhaps, is getting whatever you are using (I'm guessing
p76777
aVto render the return
p76778
aVThat is outside your control
p76779
aVYou might also try using crlf, , but no guarantees there either
p76780
as(dp76781
g18
V23354
p76782
stp76783
a((dp76784
g2
(lp76785
VIf you have a column based design, since L2S doesn't let you manually materialize (i
p76786
ag50
aVyou are a bit scuppered
p76787
aVIf you just want the data, you could use something like "dapper" which won't have this issue, but you'll need to write the TSQL yourself, i
p76788
ag50
aVBut ultimately, I think I'd prefer a different db schema here
p76789
as(dp76790
g18
V23354
p76791
stp76792
a((dp76793
g2
(lp76794
VPersonally I think it is fine "as is"
p76795
aVAnother approach, though, is to return a composite return value (perhaps an immutable struct with 2 properties); that avoids the fact that some people avoid
p76796
aVI am not one of those people :p
p76797
aVRe the question; indeed, out/ref can't be optional
p76798
aVIf you wanted to get unnecessarily fancy you could give the conposite return-type a conversion to bool to allow implicit  tests
p76799
as(dp76800
g18
V23354
p76801
stp76802
a((dp76803
g2
(lp76804
VOK, I think I understand the model now (very glad I didn't look too hard last night ;p) - you have:
p76805
aVThis is actually a similar issue to this question, and relates to attributes generally, in that the attributes apply to all closed types, not just the one you were thinking of
p76806
aVIn particular, you are currently telling it that  relates to both  and  (and the same for all the crossovers there)
p76807
aVWith two similar questions in a short span, I will try and look at this, but short-term I think the v2 modeller is the way to fix this; I have removed the  attributes from the 3 generic types (,  and ), then:
p76808
aV(the regular attributes handle the majority of the cases)
p76809
aVNote as a slight "feature" of this that since we are in parallel branches, you don't need separate  /  tags, as it isn't that you expect either an  or a  from a  - only  is possible
p76810
aVI will have to investigate options for making this cleaner - but at least in v2 it can work
p76811
aVRe removing the existing exception; I honestly don't believe that the v1 code has the subtlety to correctly handle this scenario
p76812
aVRemoving that exception could cause it to fail in other interesting ways, in particular when it tries to work down the type hierarchy
p76813
aVBy all means make any changes you choose to your local copy, but: at own risk - I can't say "yes that is safe", as I don't believe it is
p76814
aVMy recommendation here is to use the more sophisticated modelling in v2, while I investigate ways of handling this type of parallel generic model
p76815
aVAny changes here will only apply to v2, as v1 simply has no sane way of storing this information, without essentially introducing the v2 type-modeller, i
p76816
ag50
aVmaking v1 into v2
p76817
as(dp76818
g18
V23354
p76819
stp76820
a((dp76821
g2
(lp76822
Vvia:
p76823
aVand
p76824
aVThe exact list could be platform-specific (especially for mono), and it includes some non-printable characters
p76825
aVso showing you them here is tricky ;p
p76826
as(dp76827
g18
V23354
p76828
stp76829
a((dp76830
g2
(lp76831
VTime
p76832
aVincludes the 09:23:12 or whatever;  is the date-part only  (at 00:00:00 on that day)
p76833
aVSo use  if you want to include the time, and  if you just want the date
p76834
aVis essentially the same as
p76835
as(dp76836
g18
V23354
p76837
stp76838
a((dp76839
g2
(lp76840
VAs a string; for example:
p76841
aVI guess this could be handled automatically, but
p76842
aVpacking xml inside protobuf already seems to smell a bit of redundancy / inner-platform-effect
p76843
aVI As such, I'm not sure that it is something I want to encourage by adding direct library support ;p
p76844
aVIf you have lots of xml-documents in your model, then - well, firstly protobuf probably isn't going to gain you much, but secondly : it is probably possible to hook a "surrogate" for  in v2; this will probably add 2 bytes overhead per doc, but if you have xml that probably isn't your biggest problem
p76845
as(dp76846
g18
V23354
p76847
stp76848
a((dp76849
g2
(lp76850
VUnless you have something specific in mind, I would declare a type with 4 properties with suitable names and types, i
p76851
ag50
aVand use any list/array/dictionary etc as necessary, or just
p76852
aVetc
p76853
as(dp76854
g18
V23354
p76855
stp76856
a((dp76857
g2
(lp76858
Vwhy return a
p76859
aVa  with a single  in it is perfectly well defined
p76860
aVuse that
p76861
aVAn ambiguous API is silly here
p76862
aVAnother option might be , but
p76863
aVmeh, just return the list with a single
p76864
as(dp76865
g18
V23354
p76866
stp76867
a((dp76868
g2
(lp76869
VSerialisation is hard :)
p76870
aVDoing this automatically in a way that doesn't mess with the format is a pain
p76871
aVA common trick here is to assign an unrelated opaque key while de/serialising, using a central map
p76872
aVYou can see this in DataContractSerializer by enabling reference-tracking in the constructor
p76873
aVThis key is then used to check for existing objects as a substitute
p76874
aVPersonally, when it gets that complex IMO it is time to use a pre-canned aerializer; Even inside a dedicated library it is a bit challenging
p76875
aVThe approach I use (protobuf-net) is pretty similar, but harder to read (binary dense output, etc)
p76876
as(dp76877
g18
V23354
p76878
stp76879
a((dp76880
g2
(lp76881
VIs there any way in the language to solve this situation other than
p76882
aVNo, there isn't
p76883
aVIf you genuinely feel that this is a risk, perhaps use an interface-based design rather than inheritance
p76884
aVPersonally, I feel it unlikely that this is going to cause you any significant issue, especially if you use more specific method names than
p76885
as(dp76886
g18
V23354
p76887
stp76888
a((dp76889
g2
(lp76890
VIf this is for LINQ-to-SQL etc, maybe something like:
p76891
aVYou can use that with LINQ-to-Objects too if you use  first
p76892
aVFor example,
p76893
aVor alternatively, via :
p76894
as(dp76895
g18
V23354
p76896
stp76897
a((dp76898
g2
(lp76899
VNothing except for the constraints you have already seen (which do, to be fair, cover a lot of common scenarios)
p76900
aVThere are some common workarounds:
p76901
aV, in 4
p76902
ag190
aVmanual duck-typing using either reflection or IL generation etc
p76903
aVnone of these have static type-checking etc, though
p76904
as(dp76905
g18
V23354
p76906
stp76907
a((dp76908
g2
(lp76909
Vif  is null, in  a non-generic () method, you will have no access to the original type - and you can't do much about that
p76910
aVHence, the only time it matters is non-nullable value-types, so:
p76911
as(dp76912
g18
V23354
p76913
stp76914
a((dp76915
g2
(lp76916
VOn this occasion, I suggest HyperDescriptor; it is like reflection, but with IL generation thrown in the middle for performance; then, you just use regular component-model code:
p76917
aVEdit; for a bit of a 2012 update, FastMember involves less abstraction:
p76918
aVIn addition to being more direct, FastMember will work with properly  types, too - not just reflection
p76919
as(dp76920
g18
V23354
p76921
stp76922
a((dp76923
g2
(lp76924
VYou don't have to lock them, but yes: you must ensure 2 threads aren't using the same connection at the same time
p76925
aVSynchronisation (locks, etc) is one way to do that; isolation is another (better, IMO) way
p76926
aVIf two threads never have the same connection then all is good
p76927
aVFor this reason, a  connection is never a good idea
p76928
as(dp76929
g18
V23354
p76930
stp76931
a((dp76932
g2
(lp76933
VThat tells you that no rows were loaded, presumably because there was no matching product/etc
p76934
aVThis could be a case-sensitivity issue, or there could genuinely be no such products
p76935
aVFor info, using concatenation of inputs IS BAD
p76936
aVYou should always prefer a parameterised command, both to avoid data-errors (when you get a quote in a name) but more importantly to avoid SQL injection
p76937
as(dp76938
g18
V23354
p76939
stp76940
a((dp76941
g2
(lp76942
VPersonally, I would just tell it the base-path to use; then the same code can work in a number of environments, not just web
p76943
aVIf you are web-bound, HttpContext
p76944
aVCurrent may help
p76945
aVIf you want to pass it in, I would instead pass in the abstracted HttpContextBase, ala MVC
p76946
aVBut passing in a string of the base-path is a lot easier :)
p76947
as(dp76948
g18
V23354
p76949
stp76950
a((dp76951
g2
(lp76952
VThere doesn't seem to be anything there that would influence storage, do I would say "a list of classes", i
p76953
ag50
aVa  or similar, with
p76954
aVIf the volume is high, you might want to look at databases rather than in-memory storage
p76955
aVSQL Server (Express or Compact) for example, are both free
p76956
aVThis may allow for more specialised indexing without much effort, plus pre-built persistence
p76957
as(dp76958
g18
V23354
p76959
stp76960
a((dp76961
g2
(lp76962
VYou wouldn't reload all your data constantly; there are a couple of common approaches here:
p76963
aVkeep a list of changes; if you add new data you add the primary data record and you write the fact that the change happened (essentially an "events" list)
p76964
aVThen you can query the change log periodically to get and additions/updates/deletes simply by asking for all events after (x)
p76965
aVif the infrastructure allows, some kind of pub/sub framework - same approach really but typically using middleware for the changes, rather than the main DB
p76966
aVre how you get the data; polling is simple and effective; active pushing is harder to setup but may reduce latency - not sure it is worth it here
p76967
aVAnother approach, though, is to design it as a web app - then all your data lives at the server-farm and is trivial to update immediately
p76968
aVYour "desktop" app could be a web page using ajax
p76969
as(dp76970
g18
V23354
p76971
stp76972
a((dp76973
g2
(lp76974
VThere is some very odd code there that:
p76975
aVassumes we read 1024 bytes without checking
p76976
aVcopies the 1024 buffer
p76977
aVassumes the serialized data is 1024 bytes, no more no less
p76978
aVdeserializes from that
p76979
aVIMO there is your error; you should be reading the correct number of bytes from the stream (usually in a loop)
p76980
aVGenerally, you would be looping, checking the return value from Read until either we have read the amount of data we wanted, or we get EOF (return <= 0)
p76981
aVOr better; use serializers that do this for you
p76982
aVFor example, protobuf-net has SerializeWithLengthPrefix and DeserializeWithLengthPrefix that handle all the length issues for you
p76983
aVSince you mention "custom" serialization - if you are implementing ISerializable it is also possible that the problem is in there - but we can't see that without code
p76984
aVBesides, the current buffer/stream is so broken (sorry, but it is) that I doubt it is getting that far anyway
p76985
as(dp76986
g18
V23354
p76987
stp76988
a((dp76989
g2
(lp76990
VSleeping the UI thread makes things worse, as it can't respond to "paint" events until it has finished your method
p76991
aVThe most appropriate option here is a timer, doing a bit of work on each tick
p76992
aVA lazy and deeply flawed approach is to add Application
p76993
aVDoEvents() - I only mention this to allow me to say DON'T DO THIS
p76994
as(dp76995
g18
V23354
p76996
stp76997
a((dp76998
g2
(lp76999
VNo, there ist
p77000
aVThe types on the public API must be explicit
p77001
aVThe only time you aren't explicit is with , which is limited to method variables
p77002
aVFurther, you can't change the signature in C# (adding a public getter in the subclass) - you would have to re-declare it:
p77003
aVBut as the  suggests: this is an unrelated property and is not required to have the same type
p77004
as(dp77005
g18
V23354
p77006
stp77007
a((dp77008
g2
(lp77009
VEasier and faster
p77010
aVAlmost certainly winforms
p77011
aVWPF is tricker to quantify - it is more complex yet more powerful, but to be honest I've lost track of it's future
p77012
aVIs it killed
p77013
aVWho knows
p77014
aVXaml certainly has life in mobile (WP7), though
p77015
aVIMO though, your time is better spent learning web UI - some jQuery or HTML5
p77016
as(dp77017
g18
V23354
p77018
stp77019
a((dp77020
g2
(lp77021
Vstatic events; DEADLY, since they never go out of scope
p77022
aVThe anonymous method is simply a nice-to-have here but are nice because they also are a pig to unsubscribe unless you take a copy into a variable/field and subscribe that
p77023
aVTechnically this isn't actually "leaked", as you can still access them via  - however, when used with regular objects this can cause unexpected object lifetimes, i
p77024
ag50
aVnow the object at  lives forever
p77025
aVThis satisfies enough of a perceived leak IMO, and "my app died a horrible death" is good enough for me ;p
p77026
as(dp77027
g18
V23354
p77028
stp77029
a((dp77030
g2
(lp77031
VUltimately I suspect it is a false hope to make a truly thread-safe binding list, as there will be cases where multiple operations are performed - regardless of whether that is a "check the Count then iterate rows to Count-1", or "enumerate with " - and there is no easy way to lock over the duration of those, since the calling code is outside of your control
p77032
aVEven for a half-working version, you'd need to add your  code to every access, via overriding all the available methods - however, I can't see a virtual method for the  on , which might render that futile - it is only synchronized if all callers agree to use the lock
p77033
aVUltimately, I suspect that trying to use threading with tight UI coupling is fairly doomed
p77034
aVIMO, you might have more success separating the two things, and having the UI worry about handling an event and calling  to update the binding on the UI thread
p77035
as(dp77036
g18
V23354
p77037
stp77038
a((dp77039
g2
(lp77040
Vthis uses  when available to avoid boxing, and handles value-types, reference-types, and "lifted" usage against  to avoid boxing in almost all scenarios
p77041
aVWhen  is not available, it must defer to , so boxing of value-types may occur
p77042
as(dp77043
g18
V23354
p77044
stp77045
a((dp77046
g2
(lp77047
VYou've already done it correctly by using a  parameter with the value from the , so it should already work
p77048
aVForget about  - since that isn't used here
p77049
aVIf there is a difference, it is most likely to do with different precision between the two environments; maybe choose a rounding (seconds, maybe
p77050
aVand use that
p77051
aVAlso keep in mind UTC/local/unknown (the DB has no concept of the "kind" of date;
p77052
aVNET does)
p77053
aVI have a table and the date-times in it are in the format:
p77054
aVNote that datetimes in the database aren't in any such format; that is just your query-client showing you white lies
p77055
aVIt is stored as a number (and even that is an implementation detail), because humans have this odd tendency not to realise that the date you've shown is the same as
p77056
aVStupid humans
p77057
aVBy treating it simply as a "datetime" throughout, you shouldn't get any problems
p77058
as(dp77059
g18
V23354
p77060
stp77061
a((dp77062
g2
(lp77063
VYou can't use a runtime  instance as a generic type parameter unless you use reflection ( / )
p77064
aVHowever I doubt it would help anyway
p77065
aVIn this scenario, either use the non-generic  (no ) API, or perhaps cast to a known interface/subclass, or use  as a last resort duck-typing
p77066
aVYou can also use  etc, but that is more involved and almost certainly slower
p77067
aVFor example:
p77068
aVAnother trick can be to use  to invoke the generic code:
p77069
as(dp77070
g18
V23354
p77071
stp77072
a((dp77073
g2
(lp77074
VYou already know there is a problem; IMO, any "quick" fix here is likely to reduce the attack surface, but is not likely to prevent determined abuse; simply, blacklisting is truly hard and there are some really bizarre inputs readily available on black-hat (and, as samples, on white-hat) sites
p77075
aVThese are not always easily recognizable as abusive
p77076
aVIt isn't all  ;p
p77077
aVWHATEVER you do, I would advise doing it properly; parameters
p77078
aVTools like dapper might reduce the code you need, though:
p77079
aV(which is easier than handling all the parameters etc manually)
p77080
as(dp77081
g18
V23354
p77082
stp77083
a((dp77084
g2
(lp77085
VI suspect the problem is that you are  the value from a field
p77086
aVThat will work once, but after the Dispose() you have doomed that connection
p77087
aVFor this scenario, I use a custom  method that returns an IDisposable if it wasn't already open; usage:
p77088
aVThis way the connection isn't disposed prematurely but is open when needed
p77089
aVPlus it works whether it was already open or not
p77090
aVI can share EnsureOpen later if you want
p77091
as(dp77092
g18
V23354
p77093
stp77094
a((dp77095
g2
(lp77096
VQuestion (property) is encapsulation; the question is part of the outer struct, via a field
p77097
aVOptions, however, is a reference to an external object that yields one or more Options; these will be copied each time
p77098
aVThere are several other mistakes here:
p77099
aVmutable structs: EVIL
p77100
aVpublic fields: EVIL
p77101
aVthe Options would be better as a list; not all enumerables are repeatable
p77102
aVthey aren't "values" - so they should not be structs; use classes instead
p77103
aVIMO:
p77104
as(dp77105
g18
V23354
p77106
stp77107
a((dp77108
g2
(lp77109
VIt looks like you are writing some kind of multiplexer
p77110
aVIndeed, that should work fine as long as you write an entire payload (and length-prefix) within a single , and as long as the  is representative of the mutual-exclusive resource (i
p77111
ag50
aVmust be a common  for all clients that we don't want to collide)
p77112
aVPerhaps the trickier question is: are you going to read the reply within that method (success/return-value/critical-fail), or are you going to read the reply asynchronously, and let the next writer write to the stream while the first message is flying
p77113
aVFor comparison, when writing BookSleeve (a redis multiplexer, full source available if you want some reference code), I chose a different strategy: one dedicated thread to do all the writing to the thread, with all the callers simply appending to a thread-safe queue; that way, even if there is a backlog of work, the callers aren't delayed
p77114
as(dp77115
g18
V23354
p77116
stp77117
a((dp77118
g2
(lp77119
VTo describe "advantages", a key question is "over what
p77120
aVIf you mean "in preference to a hot-loop", well, CPU utilization is obvious
p77121
aVIf you mean "in preference to a sleep/retry loop" - you can get much faster response ( doesn't need to wait as long) and use lower CPU (you haven't woken up 2000 times unnecessarily)
p77122
aVGenerally, though, people mean "in preference to Mutex etc"
p77123
aVI tend to use these extensively, even in preference to mutex, reset-events, etc; reasons:
p77124
aVthey are simple, and cover most of the scenarios I need
p77125
aVthey are relatively cheap, since they don't need to go all the way to OS handles (unlike Mutex etc, which is owned by the OS)
p77126
aVI'm generally already using  to handle synchronization, so chances are good that I already have a  when I need to wait for something
p77127
aVit achieves my normal aim - allowing 2 threads to signal completion to each-other in a managed way
p77128
aVI rarely need the other features of Mutex etc (such as being inter-process)
p77129
as(dp77130
g18
V23354
p77131
stp77132
a((dp77133
g2
(lp77134
VBy inspection only (i
p77135
ag50
aVI haven't tested this), but:
p77136
as(dp77137
g18
V23354
p77138
stp77139
a((dp77140
g2
(lp77141
VThis:
p77142
aVparses the xml into an  (starting at )
p77143
aViterates over the  elements
p77144
aVforms a dictionary, using  as the key (interpreting as an ), and  as the value (as a string)
p77145
aVassigns this dictionary to , which is implicitly typed as
p77146
as(dp77147
g18
V23354
p77148
stp77149
a((dp77150
g2
(lp77151
VThe best way to store thousands of files is (gasp) on a file-system
p77152
aVIf you need a hybrid, have you considered the FILESTREAM type in sql server
p77153
as(dp77154
g18
V23354
p77155
stp77156
a((dp77157
g2
(lp77158
VThere is an overload of  that takes a predicate (filter); and the  is redundant, so if the  is part of the purchase:
p77159
aVWith the edit, you will need to join, either through a helper member:
p77160
aVOr manually:
p77161
as(dp77162
g18
V23354
p77163
stp77164
a((dp77165
g2
(lp77166
VAssuming this is Windows, the operating system can do this itself; instead of mounting the disk as E:, create an empty folder somewhere on D: and mount the new drive there
p77167
aVThis is available on most operating systems, via different routes
p77168
aVStart => right-click Computer => Manage => Storage => Disk Management
p77169
aVfind the drive, right-click, Change Drive Letter and Paths
p77170
aV, Add
p77171
aV, Mount in the following empty NTFS folder
p77172
as(dp77173
g18
V23354
p77174
stp77175
a((dp77176
g2
(lp77177
VWell, you should only really check the sign anyway, but for reasons: I guess for  etc there would be a risk of overflow/wrap (when handling 2 large-magnitude numbers) that would reverse the sign, meaning it must check the operators
p77178
aVI'd rather it was consistent, but it doesn't seem to be a problem
p77179
aVMore likely an optimisation that is atypical but within the documented API
p77180
aVIn particular, optimising  here doesn't feel like it is going to get a massive amount of use (I use , but not anything like as much as I do )
p77181
as(dp77182
g18
V23354
p77183
stp77184
a((dp77185
g2
(lp77186
VADO
p77187
aVNET has different meanings to different people; if you mean the "core" ADO
p77188
aVNET services, i
p77189
ag50
aVthe provision of a connection/command/parameter/reader, then for a database implementation you might struggle - but why would you want to use a completely separate stack
p77190
aVADO
p77191
aVNET fulfils that role admirably
p77192
aVIf, by ADO
p77193
aVNET, you mean data-set, data-table, data-adapter etc; then indeed - don't use that stuff ;p Whether you use an ORM, a micro-ORM, or whatever else - yes, there are lots of tools that can give you a better experience of loading your data, without using DataTable
p77194
aVIf you aren't using a RDBMS, then the world is your mollusc; any number of nosql connectors are around; please be specific and people will help
p77195
aVThe choice of which tool to use is a: dependent on what you want to do, and b: somewhat subjective - so you'll notice I haven't mentioned any specific tools
p77196
aVThe question is too much like walking into a hardware store and saying "I need a tool, but I don't want to use a spanner"
p77197
as(dp77198
g18
V23354
p77199
stp77200
a((dp77201
g2
(lp77202
VIt boils down to an  method, so in short: we can't see directly
p77203
aVIt isn't done in managed code, but by the CLI host:
p77204
aVRe your existing code; IMO, the issue here is your choice to allocate  If your intention is to avoid the additional  overhead, I would create a smaller buffer (say, ) and use a loop, filling in  progressively
p77205
aVAlso, if you don't need all the floats at once, consider an iterator block instead, which will slash the memory overheads here (but will mean you only have access to the items as a sequence, not random access)
p77206
as(dp77207
g18
V23354
p77208
stp77209
a((dp77210
g2
(lp77211
VThe answer I'd like to hear is that somehow protobuf-net can maintain reference integrity across assembly boundaries, even with types that just look like each other
p77212
aVYes, it can
p77213
aVWhen using  it internally generates an opaque key unrelated to anything else, and uses that on the wire; this key is based on the deterministic nature of the stream
p77214
aVEverything remains 100% contract based
p77215
aVAs long as the contracts are compatible it doesn't matter whether it is the same type, same process, same machine, same OS, etc
p77216
aVThe only exception to this is when using the  option, where it burns type metadata into the wire, but even that is not required to be the actual type data - there is an event you can subscribe to if you want to provide something more fine-grained and controlled than the default ()
p77217
aVIf you were using , this would allow you to transparently swap types between implementations
p77218
aVOf course, if you aren't using  then this problem doesn't exist in the first place
p77219
aVRe your identity map
p77220
aVI'm unclear on the motivation there
p77221
aVBut to be explicit: the existing code does not attempt to identify any "primary key" candidates and serialize just those; it serializes the object the first time it sees it (and invents a key), otherwise it just writes the key it made up last time
p77222
as(dp77223
g18
V23354
p77224
stp77225
a((dp77226
g2
(lp77227
Vthe legendary  capture issue - by the time it gets around to invoking it (on a different thread), the  variable refers to a different
p77228
aVMake a copy instead:
p77229
aVThe difference is that the loop variable ( in your example,  in mine) is scoped outside the loop (according to the spec), hence for capture purposes it is a single variable common to the entire loop
p77230
aVHowever,  in my example is scoped inside the loop, so (for capture purposes) is treated as a different variable per iteration
p77231
as(dp77232
g18
V23354
p77233
stp77234
a((dp77235
g2
(lp77236
VBy using a delegate you are forcing it to use LINQ-to-Objects, which is why it is running out of memory
p77237
aVWhat you need to do is build an  instead
p77238
aVEqually, it is bad practice to use the attributes as that is not the only model that LINQ-to-SQL supports; it is preferable to look at  to get the primary key
p77239
aVIf you have 4
p77240
aV0, the following should work:
p77241
aVwith
p77242
as(dp77243
g18
V23354
p77244
stp77245
a((dp77246
g2
(lp77247
VFirstly, you cannot "dispose" a list since it isn't , and you can't force it to be collected since that isn't how C# works
p77248
aVTypically you would do nothing here
p77249
aVSo when might we need to do anything
p77250
aVIf it is a method variable, and your method is going to exit in a moment, don't do anything: let the GC worry about it at some point after the method has existed
p77251
aVIf it is a field (instance variable), and the object is going to go out of scope in a moment, don't do anything: let the GC worry about it at some point after the instance is unreachable
p77252
aVThe only time you need to anything is if it is a field (or captured variable / iterator block variable / etc) and the instance (/delegate/iterator) is going to live a long while longer - then perhaps set the list field to null
p77253
aVNote, however, that if any other code still has a reference to the list then everything will still be reachable
p77254
as(dp77255
g18
V23354
p77256
stp77257
a((dp77258
g2
(lp77259
VIt is not exclusive, and MSDN does not state that it is
p77260
aVWell, OK, it does use the word "exclusive" when talking about , which is less than clear, but the reality is that in the vast majority of cases it is indeed exclusive as expected
p77261
aVThere are, however, some corner-cases: to be specific with examples,  returns ;  returns
p77262
aVIt is inclusive when it has no option, and this is documented in the "Return Value" sections on MSDN:
p77263
aVTo quote from :
p77264
aVHowever, if maxValue equals zero, maxValue is returned
p77265
aVand from :
p77266
aVIf minValue equals maxValue, minValue is returned
p77267
aV(which of course could also be stated " is returned")
p77268
aVSo in both cases, it is possible for  to be returned
p77269
aVThe only exception is the parameterless  which is documented as being strictly
p77270
as(dp77271
g18
V23354
p77272
stp77273
a((dp77274
g2
(lp77275
VThe first thing any Equals implementation usually checks is: "is this the right type"
p77276
aVAnd  is not the same as
p77277
aV(actually, this only happens because you have boxed the items via your incompatible use of ; at the IL level they are indistinguishable until boxed)
p77278
aVYou must compare them as items of the same type
p77279
aVTo borrow some code from :
p77280
as(dp77281
g18
V23354
p77282
stp77283
a((dp77284
g2
(lp77285
VI suspect a big problem here is your statement "the same as in the query" - however, your query never defines (and cannot define) an order by the things being aggregated (you can of course order the groups, by having a  after the )
p77286
aVBeyond that, I can only say that it is based purely on a set (rather than an ordered sequence), and that technically the order is indeed undefined
p77287
as(dp77288
g18
V23354
p77289
stp77290
a((dp77291
g2
(lp77292
VI have a slightly different take on this; when profiling (with our shiny profiler) we noticed that LINQ (to SQL in this case) was doing a reasonable job generating TSQL for basic queries, and the operation was running very fast at the DB server (0
p77293
aV5ms etc) - however, the actual query operation was taking MUCH longer (like 20ms+ for the same 0
p77294
aV5ms query, in some cases)
p77295
aVSo where was the time
p77296
aVYou might think "query translation", but no; we also have a lot of  code (i
p77297
ag50
aVwhere you write the TSQL by hand) and this was doing exactly the same thing
p77298
aVIt turned out that somewhere between the materializer and the identity map vast amounts of time was being lost
p77299
aVSo; we wrote our own materializer that was pretty-much a drop-in replacement for  - and thus was born dapper
p77300
aVOn more of the LINQ side, it generally does OK at generating TSQL for simple queries, but for anything complex I usually trust hand-coded TSQL a lot more
p77301
aVTo take a case as a sample, I had a complex query involving groups, skips and takes
p77302
aVIt didn't perform well
p77303
aVWhen I wrote it by hand with ROW_NUMBER() etc the same results took 4% of the "stats IO" and total time
p77304
aVMy current opinion on LINQ is that the ORM tools make data mutation a breeze, but for query I tend to use dapper
p77305
aVWhich is ironic since the Q in LINQ is "query"
p77306
as(dp77307
g18
V23354
p77308
stp77309
a((dp77310
g2
(lp77311
VWill protobuf be quicker
p77312
aVAbsolutely
p77313
aVI've profiled this many many times, all with similar results, for examples:
p77314
aVPerformance Tests of Serializations used by WCF Bindings
p77315
aVprotocol buffers
p77316
aVnet (protobuf-net) 10x slower that xml serializer
p77317
aVhow come
p77318
aV(note the title here is misleading)
p77319
aVhttp://code
p77320
aVgoogle
p77321
aVcom/p/protobuf-net/wiki/Performance
p77322
aVhttp://www
p77323
aVservicestack
p77324
aVnet/benchmarks/NorthwindDatabaseRowsSerialization
p77325
aV1000000-times
p77326
aV2010-02-06
p77327
aVhtml (doesn't include , but includes most others for comparison)
p77328
aVand many passing comments from happy users
p77329
aVI honenstly haven't compared to Jon's version in a long while, and I haven't done a direct v2 comparison, but here's a key point: in most cases the final bandwidth is the limiting factor in network performance, and they are the same wire format so should be pretty much identical there
p77330
aVOf course, protobuf is also demonstrably cheaper to read and write too, but unless you are on a mobile device that is secondary
p77331
aVThe big difference between protobuf-net and the port is that the ported version (Jon's) adopts (quite reasonably) the protobuf approach (immutable/generated objects etc) which might it hard to retrofit to an existing type model - you would have to introduce a separate DTO layer and map to it
p77332
aVWhich isn't a big problem - simply a consideration
p77333
aVAnd for that reason you might find it hard to do a direct comparison between XmlSerializer and the port; they both get your data, but the routes are very different
p77334
aVConversely, protobuf-net deliberately positions itself as a very similar API to XmlSerializer etc, so it is pretty easy to do a test suite using the same objects etc - just changing the serializer
p77335
as(dp77336
g18
V23354
p77337
stp77338
a((dp77339
g2
(lp77340
VWell, you can use  on any typed collection/list/array, however IMO you cannot unit test this, as different query providers support different options/methods
p77341
aVYou can only integration-test this
p77342
aVAny unit test (especially one using objects) does little or nothing to prove your system
p77343
as(dp77344
g18
V23354
p77345
stp77346
a((dp77347
g2
(lp77348
VYes, that is pretty much the idea
p77349
aVIt shouldn't matter which library you use, as long as it follows the spec
p77350
aVNote that the same data can be represented in slightly different ways, for example field order should not matter to the client, and while it is common for clients to write fields in ascending order, it is explicitly required of clients to process fields in any order
p77351
aVAll I'm saying here is that it might not be exactly the same bytes in the same order, but it should work fine from any client
p77352
aVNote that some implementations might offer additional features (*cough* like mine offers inheritance support), intended for use primarily only within that single client
p77353
aVIn that case, I would a: expect those features to be obvious when used, and b: it should always still produce a valid protobuf stream (you might just choose to ignore those fields, or support them as  for the purpose of round-trip)
p77354
as(dp77355
g18
V23354
p77356
stp77357
a((dp77358
g2
(lp77359
VVarious options:
p77360
aVuse a transaction and mark each record as in-progress when you take it; never take records that are already marked in-progress (note: you may need to "unmark" items that take too long, for example the machine died)
p77361
aVuse a random sort ( perhaps) to select rows that are unlikely to conflict
p77362
aVhowever, personally there are other storage metaphors that work nicely here, for example "redis" has a few suitable operations:
p77363
aVRPOPLPUSH (moves 1 record between lists, and returns it)
p77364
aVSPOP (removes and returns 1 record at random)
p77365
aVRPOP / LPOP (removes and returns 1 record from the end of a list)
p77366
aVall of these are atomic, avoiding all the bits that would make this a pain in SQL
p77367
as(dp77368
g18
V23354
p77369
stp77370
a((dp77371
g2
(lp77372
VThat is expected if there is a strong crossover between what the two operations are looking at, and aren't in the same transaction
p77373
aVThe outer transaction has presumably taken a key-range lock that is causing the block (at a guess the outer transaction is "serializable" isolation-level)
p77374
aVThere is nothing you can really do here, except:
p77375
aVenlist/operate in the same transaction, rather than operate outside it
p77376
aVlower the isolation level of the outer operation, so no key-range lock is generated
p77377
aVif the outer operation is a query (a select, not an insert/update/delete), then use NOLOCK or similar to avoid locking it)
p77378
aVif you can't do any of those things, then you can't insert without breaking integrity - so it won't let you
p77379
aVYou might want to consider deferring the insert until the outer operation has comlpleted
p77380
as(dp77381
g18
V23354
p77382
stp77383
a((dp77384
g2
(lp77385
Vlike dynamics enums
p77386
aVThere is no such construct readily available
p77387
aVIf you really hate the strings, you could write some kind of expression-tree lambda (i
p77388
ag50
aVor , however - that a: is a lot of work, and b: won't work well if there are other parameters being provided by the container
p77389
aVTo be honest, this is a bit of a non-issue, especially since named arguments mean that parameter names should be treated as a contract
p77390
aVIMO, just use the string
p77391
aVIf it worries you, make sure you cover the scenario in a unit test, so that you find out early if it changes
p77392
as(dp77393
g18
V23354
p77394
stp77395
a((dp77396
g2
(lp77397
Vthe field initializers happen before the ctor, so it should be fine
p77398
aVI suspect this is something like a permissions error
p77399
aVLook at the  to see exactly what:
p77400
aVIt could also be that the delete is failing because the directory you are deleting isn't empty
p77401
as(dp77402
g18
V23354
p77403
stp77404
a((dp77405
g2
(lp77406
VHmm
p77407
aVdoesn't look like it to me ;p
p77408
aVhas some instance properties, in particular  and  (via ) etc
p77409
aVPutting that anywhere  is a terrible terrible idea
p77410
aVWith the basic code that is going on you'll probably get away with it, but: IMO this is still a very bad idea
p77411
aVWell spotted
p77412
as(dp77413
g18
V23354
p77414
stp77415
a((dp77416
g2
(lp77417
V1000 is not a large amount of data; that will work fine, but you will need to think about synchronization if this data is shared between requests
p77418
aVIn reality a  to make access to a  is probably fine, although you can be more fine-grained if you need
p77419
aVHowever, the inbuilt web cache () will also approach this same problem, and has all the thread-safety built in
p77420
aVDon't use  unless you have a care that the data is sorted
p77421
aVI don't think you do
p77422
aVAs numbers get larger, I'd be more inclined to think about stores such as redis / memcached, with local memory as a local shortcut
p77423
as(dp77424
g18
V23354
p77425
stp77426
a((dp77427
g2
(lp77428
g5136
aVA SQL  is a monotonically increasing number, expressed as binary
p77429
aVNot time
p77430
aVNothing to do with time, except that they both roll ever-forwards
p77431
aVWhich is why  (as a keyword) is now deprecated (as confusing), and replaced with
p77432
aVYou cannot get time from a
p77433
aVIf you want the time, store the time as
p77434
as(dp77435
g18
V23354
p77436
stp77437
a((dp77438
g2
(lp77439
VIt is hard to see exactly since you don't show any of your inputs; however, the following is clearly dangerous:
p77440
aVEven if we gloss over the fact that you should be using parameters (you really should), you would need to format this date in the way that SQL server expects - which could be very different to the local format
p77441
aVHowever; don't bother formatting it
p77442
aVUse a parameter for this, and it'll go away
p77443
aVThis doesn't need to be hard - for example with dapper:
p77444
aVand done; fully safe from both injection and the (more likely in this case) issue of formatting data as strings
p77445
as(dp77446
g18
V23354
p77447
stp77448
a((dp77449
g2
(lp77450
VActually,  does not need an ; it is  that does
p77451
aVFirst, I would also recommend using a , since it looks like you are using winforms - that will automatically fire on the UI thread, making all the problems go away - just run the code you want to run in the handler (don't use  etc)
p77452
aVThe problem in your example is that the parameters don't match; an  expects a method name (more accurately: a method group) to be invoked, and the parameters in the array must be suitable
p77453
aVSince you don't show the method you plan to invoke, I can't help there - but  isn't a method (it is a field)
p77454
as(dp77455
g18
V23354
p77456
stp77457
a((dp77458
g2
(lp77459
VThe most effecient approach is to filter at the point of origin (for example, at the point of database query, for example), not once we have the objects in memory, but:
p77460
aVor in C# (note this is identical once compiled):
p77461
as(dp77462
g18
V23354
p77463
stp77464
a((dp77465
g2
(lp77466
VA cookie is just string data; the only way to do that would be to serialize it as a string (xml, json, base-64 of arbitrary binary, whatever), however, you shouldn't really trust anything in a cookie if it relates to security information ("who am I
p77467
aVas a: it is easy for the end-user to change it, and b: you don't want the overhead of anything biggish on every single request
p77468
aVIMO, caching this as the server is the correct thing; don't put this in a cookie
p77469
as(dp77470
g18
V23354
p77471
stp77472
a((dp77473
g2
(lp77474
VFirstly,  is going to fail; that should be  instead (the string  is not xml - it is a path)
p77475
aVhas a lot of overloads, but none for taking an
p77476
aVPerhaps give it a node-reader instead
p77477
aVOr simpler, perhaps just give it the stream or string:
p77478
aVno  needed
p77479
as(dp77480
g18
V23354
p77481
stp77482
a((dp77483
g2
(lp77484
VYou must override both  and  to indicate equivalence
p77485
aVFor example:
p77486
aVNote that  is entirely optional, but is especially helpful for structs where it avoids a box
p77487
aVNote: it will make life saner if the parts that define equality are immutable
p77488
as(dp77489
g18
V23354
p77490
stp77491
a((dp77492
g2
(lp77493
VIf  is an instance field, you can't access it without telling it which object you mean
p77494
aVFor an instance member, there is an implicit , i
p77495
ag50
aVJust add:
p77496
aVThe problem is, you could have any number of variables and objects kicking around
p77497
aVAnd even for an instance method you often have to disambiguate, i
p77498
ag50
aV(in the above the  is not strictly needed, but helps the reader IMO; the  is entirely necessary)
p77499
as(dp77500
g18
V23354
p77501
stp77502
a((dp77503
g2
(lp77504
VMy approach here would be to use  to re-declare the , and expose the  as a :
p77505
aVThis will, however, require "explicit interface implementation", i
p77506
ag50
aVThis approach makes the API fully usable via both the generic and non-generic API
p77507
as(dp77508
g18
V23354
p77509
stp77510
a((dp77511
g2
(lp77512
VI would expect that to work fine as a ; so all you need to do is serialize the string
p77513
aVIf I make an assumption that the xml is tagged as UTF8 internally (or not tagged at all), then perhaps:
p77514
aVHowever, note that if your xml is tagged internally with a different encoding to UTF8, the actual encoding should ideally match (otherwise: bad things)
p77515
aVOf course, if you are creating the xml, then you can write it directly to binary and select the encoding at the same time
p77516
aVYou can do this by passing a  and an  to :
p77517
as(dp77518
g18
V23354
p77519
stp77520
a((dp77521
g2
(lp77522
VIn C# 4
p77523
aV0 targeting
p77524
aVNET 4
p77525
aV0 (i
p77526
ag50
aVwith variance) that is fine "as is", since there is a reference-preserving conversion from  to
p77527
aVThis is possible because  is actually defined as , making it covariant
p77528
aVIn previous versions of C#, or with C# 4
p77529
aV0 targeting earlier versions of
p77530
aVNET, you need to translate as per Steven's answer
p77531
aVnote, you will need disambiguation to prevent it being recursive
p77532
aVAt the simplest, two method names
p77533
aVOr alternatively,
p77534
as(dp77535
g18
V23354
p77536
stp77537
a((dp77538
g2
(lp77539
VYou cannot (at least, not in any sane way)
p77540
aVThe only way I can see to do that would be to use an expando object, and then:
p77541
aVYou can use  with the  API, but even then I'm unclear what this is meant to help you with
p77542
as(dp77543
g18
V23354
p77544
stp77545
a((dp77546
g2
(lp77547
VIn a genuine OOM scenario (more likely on x86 than x64) you are pretty doomed there
p77548
aVAlmost anything would cause an allocation, so your best option is to die as quickly and elegantly as possible, doing minimum harm
p77549
aVSince it isn't happening, don't stress overly, but avoidance is better than handling here:
p77550
aVuse streaming data APIs rather than buffering everything in memory
p77551
aVre-use buffers etc
p77552
aVavoid enormous arrays/lists/etc (in truth, the most likely way to cause an OOM is to request an enormous (but single) array) - for example, a jagged array scales better than a 2D array (even on x64 there is a hard limit on the maximum size of a single array)
p77553
aVthink about how you handle sparse data
p77554
aVdo you read lots of strings from external sources
p77555
aVIf so, consider around a custom interner so you don't have 20,000 different copies of common strings (country names, for example)
p77556
aVkeep an eye on what you release when
p77557
aVavoid accidentally prolonged life on objects, especially via event subscriptions (notorious for accidental extensions to lifetimes)
p77558
as(dp77559
g18
V23354
p77560
stp77561
a((dp77562
g2
(lp77563
VPart of the point of contract-based serialization ala DataContractSerialization is that it isn't tied to specific types (note: NetDataContractSerializer doesn't share this)
p77564
aVAs such, there could be zero, one, or many candidate types
p77565
aVWhich would it choose
p77566
aVSo no; AFAIK that is fundamentally not possible
p77567
aVYou could perhaps use reflection over all types in all loaded assemblies, looking for [DataContract] and apply he tests manually, of course
p77568
aVNormally you have existing Type information (either the root type or the current type), so you only have a small set of candidate types (KnownType etc) to consider
p77569
as(dp77570
g18
V23354
p77571
stp77572
a((dp77573
g2
(lp77574
VTo change a value (meaning the value itself) between methods you start getting into  territory - but I suggest DON'T do that
p77575
aVYet
p77576
aVTo return a useful value just  it
p77577
aVOne problem with loops in particular is that they might not iterate even once, so in terms of "definite assignment" you often need to assign a default value outside the loop
p77578
aVAnother option is to  if you don't get into the loop, or to use LINQ methods like  or
p77579
as(dp77580
g18
V23354
p77581
stp77582
a((dp77583
g2
(lp77584
Vfrom your description of the line that is throwing, one of the UI elements is not initialized
p77585
aVWhich one
p77586
aVOnly you can find out - set a breakpoint and debug it
p77587
aVHover over all the components until you find the
p77588
aVBut that really is very bad code:
p77589
aVmixing UI, data access, session and response all at once (separation of concerns)
p77590
aVconcatenation of user input is a massive security risk (SQL injection)
p77591
aVno  statements for the connection/command (risk of pool saturation)
p77592
aVcrude error handling (that will stomp on any UI)
p77593
aVthe names
p77594
aVHow about  - do you see how that is clearer
p77595
as(dp77596
g18
V23354
p77597
stp77598
a((dp77599
g2
(lp77600
VThe vast majority of code is not CPU bound
p77601
aVCPUs are ridiculously fast, and spend most of their time waiting passively for IO to catch up
p77602
aVSo in most sane cases I would say "no"
p77603
aVIt is possible that you have an application that does everything in memory, has perfect loop structures etc, and in this mythical beast you might eek out a tiny bit more performance by forsaking virtual functions
p77604
aVBut that is a pretty extreme scenario
p77605
aVIt will depend on the context basically
p77606
aVGenerally this is simply not an issue; java / c# are themselves pretty well optimised (on the desktop/server versions at least) and are not massively slow
p77607
as(dp77608
g18
V23354
p77609
stp77610
a((dp77611
g2
(lp77612
VTools like AutoMapper can help this type of switch between similar object types
p77613
as(dp77614
g18
V23354
p77615
stp77616
a((dp77617
g2
(lp77618
VIf you want to store the fields individually like that, a hash would seem more appropriate than 5 keys each, i
p77619
ag50
aVwhere "comment
p77620
aV1" is the key, with subkeys "author", "content", etc
p77621
aVHowever, unless you have a reason to just want the IDs, I would be tempted to store the entire thing as a serialized chunk of json or binary - then you just  and you have the data - no fuss, and minimal trips
p77622
aVTo reduce bandwidth, I'd use something like protobuf-net for the storage (although I may be biased), and if you need a binary safe client BookSleeve will do quite nicely
p77623
as(dp77624
g18
V23354
p77625
stp77626
a((dp77627
g2
(lp77628
VI'm guessing that in his example, he is using the notification to propagate changes to one part of the view to other parts of the view
p77629
aVSince the different portions are presumably bound to the same view-model, this would  work
p77630
aVRe logic validation; I probably wouldn't base that on change events anyway; firstly because that would be a lot of even subscriptions (contrast UI, where you only bind things the UI cares about), and secondly it is probably too important to risk missing ;p If the model isn't performing validation internally (as changes happen) then I would just run the validation logic explicitly before commit, looking at the members altogether
p77631
aVThis also avoids the "briefly inconsistent" issue, i
p77632
ag50
aVwhere you plan to make several changes that result in a valid model, but if you validate immediately it is either really awkward to find a sequence that allows you to make the change you want, or is totally impossible
p77633
aVBy deferring the validation, this goes away
p77634
as(dp77635
g18
V23354
p77636
stp77637
a((dp77638
g2
(lp77639
Vlooks deadly
p77640
aVFor binary data you can expect to get  here
p77641
aVYou can't just call  on such - you'll probably get the type name
p77642
aVSo, how would you want to display it
p77643
aVhex
p77644
aVnow format as you choose
p77645
aVFor example:
p77646
as(dp77647
g18
V23354
p77648
stp77649
a((dp77650
g2
(lp77651
VYou aren't specific about the exception, so I'm guessing this is a namespace issue
p77652
aVAdd
p77653
aVat the top
p77654
aVYou can also specify namespaces to add automatically in  if you are going to use that namespace a lot:
p77655
as(dp77656
g18
V23354
p77657
stp77658
a((dp77659
g2
(lp77660
VUnless you enable the ability to do identity-insert (by setting identity-insert on for that table), you are NOT ALLOWED to touch that column - the database owns it
p77661
aVEither enable identity insert briefly, or: don't try to insert the UserId (let the DB create a new id)
p77662
aVAs per books online, :
p77663
aVMore likely, though: if this is the  table, should the identity not be on
p77664
aVYou'd still have the same problem since you are trying to control the , of course
p77665
as(dp77666
g18
V23354
p77667
stp77668
a((dp77669
g2
(lp77670
VEdit:
p77671
aVAfter lots of dialog, it would seem you are using an ASMX web service
p77672
aVThese are basic web-services, and do not support this usage
p77673
aVIncreased support for this is given by things like WCF in certain modes (not all), and requires additional configuration
p77674
aVHowever, personally my advice is: DON'T
p77675
aVDistributed transactions are tricky enough for things like SQL on a local LAN - add web services into the mix and it is usually asking for trouble (is my opinion)
p77676
aVHowever, some people get along with these just fine - YMMV
p77677
aVHere's your error:
p77678
aVYour code is probably trying to tell you what is wrong, but you went and swallowed the exception
p77679
aVMy guess is that another element in the distributed transaction (maybe a WCF call) failed, dooming the entire transaction
p77680
aVThe exception will tell you this
p77681
aVIMO, remove the  block completely
p77682
aVIf bad things happen, don't hide them and then wonder what happened
p77683
aVLet it bubble up to the top level, where your existing (cough) central error handling will of course write that error into the error log that you check frequently
p77684
as(dp77685
g18
V23354
p77686
stp77687
a((dp77688
g2
(lp77689
VIn common with  and  (and possibly  - I haven't checked), there is a strong divide between is a list vs contains a list
p77690
aVIf something is a list, it doesn't have values itself
p77691
aVThe preferred layout there would be to either have a list or values
p77692
aVAt the protocol level, there is simply no way of representing that, as this is just  - there is simply nowhere for  to go
p77693
aV(update); tested, and indeed  behaves the same:
p77694
aVhated it more, throwing:
p77695
aVType 'MyCollection' is an invalid collection type since it has DataContractAttribute attribute
p77696
as(dp77697
g18
V23354
p77698
stp77699
a((dp77700
g2
(lp77701
V is strict
p77702
aVAny non-conformance, it will error
p77703
aVSo no, you can't do that unless you write your own xml implementation
p77704
aVFixup on the malformed data is probably easier
p77705
as(dp77706
g18
V23354
p77707
stp77708
a((dp77709
g2
(lp77710
VThat line would work only with an implicit static conversion operator (or maybe the more-confusing  operator, but that is rarely seen in the wild)
p77711
aVYou cannot define operators on enums, so ultimately the answer is: no
p77712
aVYou could, however, write an extension method on  to return  or
p77713
aVthen you can use
p77714
as(dp77715
g18
V23354
p77716
stp77717
a((dp77718
g2
(lp77719
VUltimately, there is no direct link between  and  (and indeed,  only represents a specific type of node, not xml)
p77720
aVYou are going to have to go down to  or  level and back up again (since you aren't using the streaming reader)
p77721
aVFor example:
p77722
aVor:
p77723
aVor (perhaps more efficient) using the  API:
p77724
aVand
p77725
as(dp77726
g18
V23354
p77727
stp77728
a((dp77729
g2
(lp77730
VIf you have an array, then personally, I'd use:
p77731
aVhere; it avoids a few reallocations, and works on more versions of
p77732
aVNET
p77733
aVLikewise:
p77734
aVLINQ will work, but isn't actually required here
p77735
as(dp77736
g18
V23354
p77737
stp77738
a((dp77739
g2
(lp77740
VThis is what we technically call a "bug", that impacts serialization callbacks with a  parameter, but only on specific platforms
p77741
aVBasically, a bit of code was the wrong side of a  (to cut binary-formatter related code out of the Silverlight etc builds)
p77742
aVThe tests for this have been straightened out, and this is fixed in r431
p77743
aVI've also improved the error message to give a more useful message, including method name (code that already existed elsewhere, but not used from there oddly)
p77744
aVLet me know you need a new zip archive for that (vs build from source)
p77745
aVAnnoyingly, the actual "doing" code would have been fine - it was only that sanity-check that was
p77746
aVnot sane
p77747
as(dp77748
g18
V23354
p77749
stp77750
a((dp77751
g2
(lp77752
VNothing fundamental, and you can usually change between them safely
p77753
aVuntil something has used the field name (I'm looking at  here
p77754
aVotherwise, no
p77755
aVYou can usually change between the, without breaking things, for example to add logic or to add attributes to the field
p77756
as(dp77757
g18
V23354
p77758
stp77759
a((dp77760
g2
(lp77761
VSince (comments) you expressed an interest in avoiding this scenario, here's how I would do it:
p77762
aVwell, except I wouldn't have public fields ;p If you don't want the attributes, they can be avoided too, in a number of ways that I can explain if you really want
p77763
aVAdvantages:
p77764
aVfaster and smaller
p77765
aVnot tied to any platform (you could load that in a C++/java/etc protobuf client very easily)
p77766
aVnot tied to any particular type or field names
p77767
aVno risk of accidentally serializing extra objects through event subscriptions etc
p77768
aVmost common serialization concepts fully supported
p77769
as(dp77770
g18
V23354
p77771
stp77772
a((dp77773
g2
(lp77774
VYou can't do that directly - you would need to add a separate method:
p77775
as(dp77776
g18
V23354
p77777
stp77778
a((dp77779
g2
(lp77780
VThat is a false positive here
p77781
aVIn a read-only collection an  is never going to be useful
p77782
aVIt is only needed to satisfy the interface, since there is no valid/inbuilt read-only  equivalent that provides read access by index
p77783
aVIn this case, tucking it out of sight makes perfect sense
p77784
as(dp77785
g18
V23354
p77786
stp77787
a((dp77788
g2
(lp77789
VAs an extension to Ben's answer
p77790
aVstrictly speaking, protobuf has no definition of time, so there is nothing to retain compatibility with
p77791
aVI'm tempted to add support for this in v2, but sadly it would add 2 bytes per value
p77792
aVI have yet to think about whether this is acceptable
p77793
aVfor example, I could perhaps default to "unspecified" so that only explicitly local or UTC dates have a value
p77794
as(dp77795
g18
V23354
p77796
stp77797
a((dp77798
g2
(lp77799
VHow about using  with object-tracking enabled ( in the constructor)
p77800
aVThat should allow you to serialize them to xml (of a sort, at least), where you might be able to compare the differences
p77801
as(dp77802
g18
V23354
p77803
stp77804
a((dp77805
g2
(lp77806
VTo the base class, add:
p77807
aVand to the derived class, add:
p77808
aVThis is a pattern that  recognises, but must be declared at the same level as the member (), hence the need to make it
p77809
aVIf it offends the eye, add some:
p77810
aVto it - but it must be  to work
p77811
as(dp77812
g18
V23354
p77813
stp77814
a((dp77815
g2
(lp77816
VYour 10s timeout only times out the task
p77817
aVIt doesn't stop  from executing (if indeed it ever starts - I can't see a  there)
p77818
aVIt just means you locally see a timeout on
p77819
aVAlso, it depends in part on what  does - does it return a non-buffered sequence, or is it a list, etc
p77820
aVWhile  does support cancellation, this requires co-operation from the implementation
p77821
aVTo be honest, since you aren't doing anything async you might be better off just handling your own "have I taken too long" basic timeout in
p77822
aVA thread-abort (the other option) is not to be recommended
p77823
as(dp77824
g18
V23354
p77825
stp77826
a((dp77827
g2
(lp77828
VDon't mess with the  (i
p77829
ag50
aVlimiting threads) - it isn't yours to mess with, and core parts of the system will want it
p77830
aVYou risk starvation and deadlock
p77831
aVEither use a custom thread-pool implementation, or use the inbuilt options in the TPL to run an operation on a constrained number of threads
p77832
as(dp77833
g18
V23354
p77834
stp77835
a((dp77836
g2
(lp77837
VThe result of an assignment  is defined as the value evaluated from {expr}
p77838
aV14
p77839
aV14
p77840
aV1 Simple assignment (ECMA334 v4)
p77841
aVThe result of a simple assignment expression is the value assigned to
p77842
aVthe left operand
p77843
aVThe result has the  same type as the left operand,
p77844
aVand is always classified as a value
p77845
aVAnd note that the value assigned is the value already evaluated from
p77846
aVHence the implementation here is:
p77847
aValthough I would also expect with optimisations enabled it will use the  instruction rather than a local variable
p77848
as(dp77849
g18
V23354
p77850
stp77851
a((dp77852
g2
(lp77853
VNo clean way, no
p77854
aVAll  usage is intercepted and refers to the declaring instance
p77855
aVYou could possibly do something horrible involving abusing the stack or similar, but nothing tidy is obvious
p77856
aVYou could maybe chain the iterators LINQ-style instead
p77857
ag412
ag50
aVand use
p77858
as(dp77859
g18
V23354
p77860
stp77861
a((dp77862
g2
(lp77863
VNot directly, and I'm not sure there is a great need to
p77864
aVMaybe I am missing something in the example
p77865
aVTo pick up on the key point - even forgetting about inheritance you've broken the contract - te fields in your exampl are 1 & 1 in one model and 1 & 2 in the other
p77866
aVIt really depends what your objective is; if you just want to push the data over, then sure you can set up a RuntimeTypeModel that only knows about the derived type (disable automatic configuration and add the fields manually)
p77867
aVThis will then only work for the derived type (obviously), but will output the data as expected by the flat model:
p77868
aVThen use model
p77869
aVSerialize etc
p77870
aVHowever, writing a flat conversion method on c#, or using AutoMapper would be more obvious
p77871
aVI would only use the above if my objective is to remove the inheritance from the output, for example for interoperability reasons
p77872
as(dp77873
g18
V23354
p77874
stp77875
a((dp77876
g2
(lp77877
VLINQ providers look at your expression tree, and try to generate equivalent TSQL (etc) from that
p77878
aVThis only works for recognised methods, or recognised expression scenarios
p77879
aVIt can't look at an arbitrary method in your C# code and execute that at the database
p77880
aVHowever
p77881
aVYou could simplify the query for it:
p77882
as(dp77883
g18
V23354
p77884
stp77885
a((dp77886
g2
(lp77887
VPersonally I wouldn't keep anything in the WCF service implementation instance, but then I also don't enable "session" - simply, I want any client to be able to connect to any server, without the overheads of session tracking, sticky load balancing, etc
p77888
aVIf you want session, I'd personally do it outside of WCF, but in your case it sounds like you are really looking for something closer to a cache anyway
p77889
aVEither way, there are plenty of ways of implementing that preserve the (desirable to me, at least) stateless query metaphor
p77890
aVSure, the data might still be around for re-use, but I don't need a session for that
p77891
as(dp77892
g18
V23354
p77893
stp77894
a((dp77895
g2
(lp77896
Vwell, you aren't strictly coupled to any specific provider, but as a re-phrasing of that: you can't easily test the code, since each provider has different supported features (meaning: what works for one might not work for another - even something like )
p77897
aVI don't think so, if there is any question in your mind about ever changing provider - see above
p77898
aVit just provides a decorated wrapper that uses  on any lambdas, and uses LINQ-to-Objects instead
p77899
aVNote LINQ-to-Objects has more support than any other provider, so this won't be an issue - except that it means that any "mocks" using this approach don't really test your actual code at all and are largely pointless (IMO)
p77900
aVyeah, tricky - see below
p77901
aVyeah, tricky - see below
p77902
aVPersonally, I'd prefer well defined APIs here that take known parameters and return a loaded  or  (or similar) of results; this gives you a testable/mockable API, and doesn't leave you at the mercy of deferred execution (closed connection hell, etc)
p77903
aVIt also means that any differences between providers is handled internally to the implementation of your data layer
p77904
aVIt also makes a much closer fit for calling scenarios such as web-services, etc
p77905
aVIn short; given a choice between  and , I choose neither - opting instead to use  or
p77906
aVIf I need additional filtering, then either:
p77907
aVI'll add that to the existing API via parameters, and do the filtering inside my data layer
p77908
aVI'll accept that oversized data is coming back, which I then need to filter out at the caller
p77909
as(dp77910
g18
V23354
p77911
stp77912
a((dp77913
g2
(lp77914
VIf you have made a POST with the json in the payload, then you need to read the request body
p77915
aVYou would do this by consuming , for example:
p77916
aVYou need to be careful, though - since consuming the body may mean that your actual code can't read it
p77917
aVWhich would be bad
p77918
as(dp77919
g18
V23354
p77920
stp77921
a((dp77922
g2
(lp77923
VYes;  will fix that;  is the default behaviour
p77924
aVMathematically, you can't add +inf and -inf, and you can't infer a sign
p77925
aVNaN is the only sane option; however, +inf + +inf => +inf, and -inf + -inf => -inf, like you might deduce
p77926
aVAgain, mathematically that first work
p77927
aVNot least, it would lead to 2*x/x=>1, which would be worse
p77928
aVBut basically : inf is not a number
p77929
aVNo, they don't; that is the expected behaviour for floating point
p77930
aVFloat doesn't wrap; exceeding max is infinity
p77931
as(dp77932
g18
V23354
p77933
stp77934
a((dp77935
g2
(lp77936
VI would encapsulate the list - in part for simplicity (avoiding some gnarly overloads the the  constructor), and in part because there are some glitches here on CF etc that make it unreliable
p77937
aVBut:
p77938
aV(I have removed all unnecessary other attributes)
p77939
aVYou then just return a  (named more appropriately, obviously), and it will serialize as per your example
p77940
as(dp77941
g18
V23354
p77942
stp77943
a((dp77944
g2
(lp77945
VI would shape the DTO accordingly:
p77946
aVAlso note that you shouldn't need to "strip out" the header junk - if you configure the writer correctly it won't be added in the first place:
p77947
as(dp77948
g18
V23354
p77949
stp77950
a((dp77951
g2
(lp77952
VUltimately, WCF is going to look at the contract class
p77953
aVIf that is generated from WSDL/MEX it won't have this (since this isn't how it is expressed in the metadata) - but if your client has the code as above, then sure it should work fine
p77954
aVIf you add a library reference (i
p77955
ag50
aVa dll / project reference) to your DTO dll from the client, and ensure WCF has shared-assemblies enabled, it should work
p77956
aVIf it still baulks, then cheat: use a service reference just to get the config data
p77957
aVThen delete the service reference but keep the configuration (those config files are a pain otherwise)
p77958
aVThen it should locate the type from the library
p77959
as(dp77960
g18
V23354
p77961
stp77962
a((dp77963
g2
(lp77964
VMy guess is that you've stored an object somewhere in memory (most likely the http cache using in-process mode, but could also be any manual cache such as a shared dictionary), and now you've somehow associated that object with something else, for example:
p77965
aVHence, a problem if the cached object still thinks it is attached to a context; not least, you are probably keeping an entire graph alive accidentally
p77966
aVThe code looks OK (as long as you are disposing it at the end of the request), but this would be a good time to add:
p77967
aVand use that in place of the 5 literals
p77968
aVAvoids a few risks ;p
p77969
as(dp77970
g18
V23354
p77971
stp77972
a((dp77973
g2
(lp77974
V and  are very different, and I don't suggest arbitrarily switching between them
p77975
aVBut neither has any extra "cost", since  is a single fixed reference (you can use it any number of times)
p77976
aVThere is no "pollution" on the stack caused by a ldsfld - that concern is
p77977
aVcrazy
p77978
aVLoading a  is arguably marginally cheaper, but could cause null-reference exceptions if you aren't careful about checking the value
p77979
aVPersonally, I use neither
p77980
aVIf I want an empty string I use  - simple and obvious
p77981
aVInterning means this also has no per-usage overhead
p77982
aVAt the IL level, the difference here between "" and Empty is just ldstr vs ldsfld - but both give the same single interned string reference
p77983
aVFurthermore, in more recent
p77984
aVNET versions the JIT has direct interception of these, yielding the empty string reference without actually doing a static field lookup
p77985
aVBasically, there is exactly no reason to care either way, except readability
p77986
aVI just use ""
p77987
as(dp77988
g18
V23354
p77989
stp77990
a((dp77991
g2
(lp77992
VThe length is little-endian varint encoded, presumably - meaning it is in chunks of 7-bits with the MSB as a continuation bit
p77993
aVIf the MSB is set, then you need to process the next byte (and so on) to get the combined length, then use bitwise shift to combine them
p77994
aVIndeed, for all numbers < 128, this indeed looks identical to reading a single byte
p77995
aVSee here for the spec on decoding base-128 varints
p77996
as(dp77997
g18
V23354
p77998
stp77999
a((dp78000
g2
(lp78001
VLike this:
p78002
as(dp78003
g18
V23354
p78004
stp78005
a((dp78006
g2
(lp78007
VThat means your program crashed and burned
p78008
aVEither add less bugs, or at a minimum, add some error handling so that when it does die, you get some clue what happened
p78009
aVPretty much anything could have caused this
p78010
aVand  would be a good start here
p78011
as(dp78012
g18
V23354
p78013
stp78014
a((dp78015
g2
(lp78016
VMy guess (slightly spurred on from a discussion in the comments) is that some code somewhere in your application is detecting  and deciding to serialize the object
p78017
aVFor example, a cache would be a likely candidate - as might any "deep clone" code
p78018
aVTry implementing  (or just add a serialization callback), and add a break-point
p78019
aVIf your break-point hits, load the call-stack window and navigate back up the stack to see what is serializing your object, and why
p78020
as(dp78021
g18
V23354
p78022
stp78023
a((dp78024
g2
(lp78025
VSee MSDN:
p78026
aVCaution
p78027
aVYou can use this method only on value types that have constructors; however, value types that are native to C# do not have constructors
p78028
aVis native
p78029
as(dp78030
g18
V23354
p78031
stp78032
a((dp78033
g2
(lp78034
VIf the size is big enough that holding it twice is an issue, then probably holding it once is an issue too
p78035
aVHowever; if you are interested, protobuf-net has a DeserializeItems method that returns a non-buffered (fully streaming)  - i
p78036
ag50
aVno list
p78037
aVSo you could:
p78038
aVI can also pretty-much guarantee that it'll be smaller on disk and faster to process too
p78039
aVI wonder, though, if "virtual mode" might be a better option for a large list
p78040
as(dp78041
g18
V23354
p78042
stp78043
a((dp78044
g2
(lp78045
VHere's a visitor that does the job
p78046
aVit makes a copy of the parameter (since we'll need to create a new parameter and substitute all references of the old parameter for the new one)
p78047
aVit walks the  of the tree, substituting the parameter, and switching any member-access against the old type to a like-named member on the new type
p78048
aVit re-assembles a lambda using the parameter we invented earler
p78049
aVCode:
p78050
aVNote that if you have  you might need to be a bit more careful, but this should get you a reasonable way
p78051
as(dp78052
g18
V23354
p78053
stp78054
a((dp78055
g2
(lp78056
VAt the moment, no
p78057
aVI'm in two minds as to whether it is worthwhile adding; in my mind, this defeats most of the benefits of protocol buffers
p78058
aVHowever, since Jon's version is a port of the java version you should find that it is feature compatible, so it should exist there
p78059
as(dp78060
g18
V23354
p78061
stp78062
a((dp78063
g2
(lp78064
VThe trick here is to use the  option on a member to your object - as an over-simplified example:
p78065
aVRe the "string<===>Type map", that is the  event on
p78066
aVIf you are using the  methods, that is a shortcut (mainly for preserving the v1 API) to the  serializer instance
p78067
aV(as a side-note, in writing this I did notice an edge-case that I need to go and fix in the code)
p78068
aVNote: another approach here, rather than using , is to simply configure the model at runtime, for example:
p78069
aVIMO this latter is my preferred option, and will generally be more efficient
p78070
aVNote that it is necessary for the unique-identifiers to be fixed/repeatable, as that is part of the wire format (don't just use the index of the order you find them)
p78071
as(dp78072
g18
V23354
p78073
stp78074
a((dp78075
g2
(lp78076
VOptions:
p78077
aVyou are missing one-or-more  directives, most likely to your db-context (solution: add )
p78078
aVin the DBML, maybe you set the db-context accessibility modifier to something other than  (solution: make it  in the DBML)
p78079
as(dp78080
g18
V23354
p78081
stp78082
a((dp78083
g2
(lp78084
VWell, the error is pretty clear that this isn't going to work
p78085
aVisn't very ambiguous; options:
p78086
aVexecute the tsql outside of a transaction
p78087
aVif you might already have a nested transaction, use a nil-transaction  (i
p78088
ag50
ag38293
as(dp78089
g18
V23354
p78090
stp78091
a((dp78092
g2
(lp78093
VYou could do something like
p78094
aVwhich uses an anonymous type as a holding type while switching () into LINQ-to-Objects for the  - however, note that this is a potential N+1; Personally, I'd be looking for a  that takes more than one , and I'd stitch them back together after the fact
p78095
as(dp78096
g18
V23354
p78097
stp78098
a((dp78099
g2
(lp78100
VThey will be pretty-much on a par; note that  would be preferred over  here
p78101
aVHowever, since there is no clear distinction in performance, I would strongly suggest the more idiomatic  via  is a much better implementation; not least, / is a constant source of confusion, and may often require introducing an extra variable for the purpose (rather than using the return value as an expression)
p78102
aVVery minor, but this also means there is one less indirection inside  - meaning: with the / usage, any access on  needs to first dereference the  to get the array reference, then dereference to the array
p78103
as(dp78104
g18
V23354
p78105
stp78106
a((dp78107
g2
(lp78108
VIt is trying to do a split on , so every time it sees  it is cutting the data
p78109
aVThis use-case is essentially intended for the (not uncommon) scenario where all the tables have a predictable key such as
p78110
aVIn your case, this is not what you want, as you get from the database:
p78111
aVHowever, that splits on  as:
p78112
aVwhich is why  doesn't get included in the second object, and also why adding it to the end makes it work
p78113
aVThere is another usage, IIRC, that accepts the sequenced keys to split on; you would use:
p78114
as(dp78115
g18
V23354
p78116
stp78117
a((dp78118
g2
(lp78119
VChecking under-the-hood, as an implementation detail it is indeed the case that in the current EF the type will always live in "System
p78120
aVData
p78121
aVEntity
p78122
aVDynamicProxies"
p78123
aVThis probably isn't a robust test, but should change infrequently
p78124
aVI will attempt to clarify this with Microsoft, though
p78125
as(dp78126
g18
V23354
p78127
stp78128
a((dp78129
g2
(lp78130
VThe final point:
p78131
aVis actually just a restatement of your earlier point:
p78132
aVgives a reference to the first Structure item
p78133
aVBut  gives me a copy of it
p78134
aVIf you edited a copy of it, the change would be lost into the ether, i
p78135
ag50
aVSince that is almost certainly not what you intended, the compiler doesn't let you
p78136
aVHowever, mutable structs are evil
p78137
aVA better option here would be don't use mutable structs
p78138
aVThey bite
p78139
aVTaking this down a level, to a simple but concrete example:
p78140
aVThis compiles (looking at the last 2 lines here) as:
p78141
aVIt never actual talks to the struct as a value - no copies, etc
p78142
as(dp78143
g18
V23354
p78144
stp78145
a((dp78146
g2
(lp78147
Valthough the types clearly are compatible
p78148
aVNo they aren't; C# covariance via  applies only to interfaces and delegates (of reference-types, although that is fine here)
p78149
aVIt does not apply to classes such as
p78150
as(dp78151
g18
V23354
p78152
stp78153
a((dp78154
g2
(lp78155
VBecause (as per the documentation) for connection strings:
p78156
aVKeywords are not case sensitive
p78157
aVThe values, however, are case-sensitive (obviously, for passwords etc)
p78158
as(dp78159
g18
V23354
p78160
stp78161
a((dp78162
g2
(lp78163
VUse XmlElement if you don't want a wrapper element:
p78164
aVother notes:
p78165
aVyou don't need
p78166
aVpublic fields are generally not recommended - a property would be preferred
p78167
aVIMO a list would be better than an array here
p78168
as(dp78169
g18
V23354
p78170
stp78171
a((dp78172
g2
(lp78173
VThat isn't possible;
p78174
aVNET 2
p78175
aV0 only has ; SL only has
p78176
aVOptions:
p78177
aVuse  (hard to do robustly, to be honest)
p78178
aVwrite an abstraction over the two, and use a compiler symbol or similar to switch
p78179
aVupdate your minimum requirements to 3
p78180
aV5 SP1 or higher (it would be in 3
p78181
aV5 too, but 3
p78182
aV5 is now technically unsupported (since 12/07/2011); 3
p78183
aV5 SP1 is is minimum officially supported version of
p78184
aVNET)
p78185
as(dp78186
g18
V23354
p78187
stp78188
a((dp78189
g2
(lp78190
VIt often depends on what is in that namespace; for example, if nothing is in there then the namespace doesn't really exist
p78191
aVIt is also possible that you are missing some other dependency which means that the compiler can't use (until the reference is added) any of the types in that namespace (for example, if the types in that namespace all depend on some type from Another
p78192
aVdll, and you haven't referenced Another
p78193
aVdll)
p78194
aVIt is possible you have referenced the wrong version of the dll, and the version you are referencing doesn't have that namespace
p78195
aVIt is possible the compiler is already telling you about a reference problem, meaning it can't use it - look in the errors/warnings list
p78196
aVFor example, it could be a physically missing file, or a
p78197
aVNET version mismatch, or a strong-naming issue, that means it can't use the reference
p78198
as(dp78199
g18
V23354
p78200
stp78201
a((dp78202
g2
(lp78203
VThe question is a little hard to follow, but if you simply want to log all LINQ access to the DB, then with something like LINQ-to-SQL you could use  and specify a writer (be careful though - don't give it the file directly, as you'll block parallel activity)
p78204
aVI personally think this is a bad idea though - data volume is usually prohibitive for this
p78205
aVDatabases get very busy
p78206
aVIf that isn't sufficient, and you have other operations to log - you could try an intercepting DbConnection, a bit like the profiled connection in mvc-mini-profiler
p78207
aVThis works well with LINQ-to-SQL (EF
p78208
aVharder)
p78209
aVBut again - data volume is a big issue here
p78210
as(dp78211
g18
V23354
p78212
stp78213
a((dp78214
g2
(lp78215
V(applies to the original question)
p78216
aVGiven the signature, you should just need:
p78217
aVYou can also do this by inspection of the expression if absolutely needed
p78218
as(dp78219
g18
V23354
p78220
stp78221
a((dp78222
g2
(lp78223
VThe result of the post-increment expression  is the original value of
p78224
aVSo after  has been evaluated (incrementing ), you assign the old value of  to
p78225
aVJust use
p78226
aV;)
p78227
as(dp78228
g18
V23354
p78229
stp78230
a((dp78231
g2
(lp78232
VNo, binding to a DataTable will not be faster than data-reader; in fact it will add overhead
p78233
aVI would create a class that matches the table, and use either data-reader (manually) or "dapper" to fill it into a
p78234
aVThere won't be much speed difference between those two, as from lots of profiling: that is as fast as you'll get (short of moving the data closer to avoid LAN)
p78235
aVOne option might be to cache the data locally, so most times you read you don't hit the DB at all
p78236
aVI would suggest maybe using protobuf-net to serialize to a file on the local disk; again - about the fastest you'll get
p78237
aVYou could also store some token so you can tell when the data is stale - maybe the last timestamp or similar
p78238
aVThen you just check the DB to query the latest timestamp; if te same, read from your local copy
p78239
aVOtherwise load from the DB and then rewrite your local copy
p78240
as(dp78241
g18
V23354
p78242
stp78243
a((dp78244
g2
(lp78245
VYour constructor doesn't take a lambda - it takes a  instance, so a
p78246
aVEither give it a , or write a constucor that can take that expression - maybe an
p78247
aVPersonally, I suspect you mean simply:
p78248
aVwhich is an object initializer, not a lambda - i
p78249
ag50
as(dp78250
g18
V23354
p78251
stp78252
a((dp78253
g2
(lp78254
VAttributes need literals
p78255
aVThe way to approach this is by using  to configure it at runtime, and pass that to the  constructor
p78256
aVHowever: cache and re-use the serializer instances when you do this, or you will leak dynamically generated assemblies
p78257
as(dp78258
g18
V23354
p78259
stp78260
a((dp78261
g2
(lp78262
VYes; that is normal
p78263
aVWith the exception of field initializers, the code must be in a method
p78264
aVThat isn't a field initializer
p78265
aVEither assign  in the derived constructor, or create an overloaded constructor and pass  to the base type's constructor
p78266
aVSo either:
p78267
aVOr:
p78268
as(dp78269
g18
V23354
p78270
stp78271
a((dp78272
g2
(lp78273
VThat is absolutely not thread safe
p78274
aVAny time 2 threads are doing something (very common in a web application), chaos is possible - exceptions, or silent data loss
p78275
aVYes you need some kind of synchronization such as ; and  is usually a very bad idea for data storage, IMO (unless treated very carefully and limited to things like configuration data)
p78276
aVAlso -  events are notorious for a good way to keep object graphs alive unexpectedly
p78277
aVTreat those with caution too; if you subscribe once only, fine - but don't subscribe etc per request
p78278
aVAlso - it isn't just locking the operations, since this line:
p78279
aVreturns your list, now unprotected
p78280
aVall access to an item must be synchronized
p78281
aVPersonally I'd return a copy, i
p78282
ag50
aVFinally, returning a  from such can be confusing - as it is not guaranteed to still be  at any point
p78283
aVIt is informational at that point in time only
p78284
as(dp78285
g18
V23354
p78286
stp78287
a((dp78288
g2
(lp78289
VIMO, since the "columns" are fixed, declare a class for that:
p78290
aVnow have a :
p78291
aVthis has everything you need:
p78292
aVadd to list,select,input elements
p78293
aVetc
p78294
aVusing elements in database queries
p78295
aVusing as parameters in other functions
p78296
aVvague without more info, but you can pass either the  or invidual values, or the entire list
p78297
as(dp78298
g18
V23354
p78299
stp78300
a((dp78301
g2
(lp78302
VIt already is a lambda expression
p78303
aVBut to get a delegate from the lambda, call
p78304
aVIn the general sense - to make a lambda from an Expression you would use Expression
p78305
aVLambda, indicating the desired type and including the parameter (declaration) instances (from Expression
p78306
aVParameter)
p78307
aVHowever, this is not required here
p78308
as(dp78309
g18
V23354
p78310
stp78311
a((dp78312
g2
(lp78313
VI'm guessing there is no matching row in the db, so no rows returned
p78314
aVSanity-check the result from ExecuteScalar - in particular, check it for null before casting to int
p78315
aVIt is also possible that the column contains a null, but maybe I'd expect DBNull
p78316
aVValue for that
p78317
aVAlso - use  on all the  objects here; the connection and command in particular
p78318
as(dp78319
g18
V23354
p78320
stp78321
a((dp78322
g2
(lp78323
VIt sounds like you simply want encryption
p78324
aVDepending on the scenario (who can read it vs who can write it) this could be symmetric or asymmetric
p78325
aVJust keep the keys outside the db
p78326
aVAnother option: assume access to the DB is secure; then you don't need to encrypt the data
p78327
aVYou would, however encrypt the connection, and typically enable the encrypted storage options inside the database itself
p78328
aVSo everything is encrypted, but invisibly to you as a caller
p78329
as(dp78330
g18
V23354
p78331
stp78332
a((dp78333
g2
(lp78334
VTimeSpan is a duration "17 hours", not a time
p78335
aVMaybe add this to a date (only) and use the existing datetime formatting options
p78336
aV(although watch for daylight savings)
p78337
ag412
ag50
as(dp78338
g18
V23354
p78339
stp78340
a((dp78341
g2
(lp78342
VDeclare it (uninitialized) outside:
p78343
aVIf the logic is simple, a conditional is possible too:
p78344
aVThe latter is much easier to use with a  block, as it can be done inline
p78345
as(dp78346
g18
V23354
p78347
stp78348
a((dp78349
g2
(lp78350
VI wonder if this is simply cacheing
p78351
aVIf you have forced it to load an unfiltered set of students, then sure - it might well the trust that set (empty at the point of load)
p78352
aVDataContext is intended to be short-lived; try creating a new one after the insert and retry
p78353
aVIf this hasn't already read the empty table it should find your data
p78354
aVAdditionally, check you don't have two Students tables - for example dbo
p78355
aVStudents vs bluesummers
p78356
aVStudents
p78357
as(dp78358
g18
V23354
p78359
stp78360
a((dp78361
g2
(lp78362
VIf your data is going to look roughly like code you may well have to disable this validation; but then you need to be really sure about your code handling, in particular avoiding XSS and SQL injection attacks
p78363
aVYou should be able to set in the aspx  to disable on a per-page basis:
p78364
aVor globally in the web
p78365
aVconfig if you need this everywhere
p78366
as(dp78367
g18
V23354
p78368
stp78369
a((dp78370
g2
(lp78371
VIt is documented as returning "A sequence that contains the set difference of the elements of two sequences
p78372
aVSets do not have duplicates
p78373
aVIt is perhaps a subtle point, but it functions as per the spec
p78374
aVIf you want the dups:
p78375
as(dp78376
g18
V23354
p78377
stp78378
a((dp78379
g2
(lp78380
VYou can return (or assign) a copy of the item:
p78381
aVNotes;
p78382
aVis usually a bad name, as the convention is that  refers to generics
p78383
aVis almost always misused; make sure you know what  means before deciding to use it - one thing it doesn't mean is "a lightweight object without methods", which is the oft-reported (and entirely incorrect) myth; in particular, mutable s are usually a very bad idea
p78384
as(dp78385
g18
V23354
p78386
stp78387
a((dp78388
g2
(lp78389
VWith the SP1 refresh, you need:
p78390
aVSome  method (possibly but not necessarily an extension method) that returns something ( in your example) with all of:
p78391
aVA  property ()
p78392
ag13333
aVA  method which returns , or the desired outcome of the awaited operation
p78393
aVHowever, I suggest you look at  - I looked at this, and it out-performed my naive implementation (here; obsolete)
p78394
aVYou can also use it for  tasks, by using something like a  (and exploit the fact that the  is also an untyped )
p78395
as(dp78396
g18
V23354
p78397
stp78398
a((dp78399
g2
(lp78400
VYou say:
p78401
aVSo some interfaces have beforefieldinit flag (ICollection, IEnumerable)
p78402
aVNeither reflector nor ildasm show this
p78403
aVfor example (via ildasm):
p78404
aVcontrast to  that does have this flag:
p78405
aVI suspect this is simply a false-positive in your program
p78406
as(dp78407
g18
V23354
p78408
stp78409
a((dp78410
g2
(lp78411
VIn order:
p78412
aVIs it just to make the annoying casts in LINQ expressions go away
p78413
aVIt makes things behave like people generally expect ;p
p78414
aVWon't this introduce the same problems like with  (broken array variance) in C#
p78415
aVNo; since it doesn't expose any  mechanism or similar (and can't;  and  are enforced at the compiler)
p78416
aVHow was the addition of the covariance done from a compatibility point of view
p78417
aVThe CLI already supported it, this merely makes C# (and some of the existing BCL methods) aware of it
p78418
aVWill earlier code still work on later versions of
p78419
aVNET or is recompilation necessary here
p78420
aVIt is entirely backwards compatible, however: C# that relies on C# 4
p78421
aV0 variance won't compile in a C# 2
p78422
aV0 etc compiler
p78423
aVWhat about the other way around
p78424
aVThat is not unreasonable
p78425
aVWas previous code using this interface strictly invariant in all cases or is it possible that certain use cases will behave different now
p78426
aVSome BCL calls () may return differently now
p78427
as(dp78428
g18
V23354
p78429
stp78430
a((dp78431
g2
(lp78432
Vxml is usually intended to be platform independent, hence why that isn't working
p78433
aVYou could try:
p78434
aVNote also that the data-contract attributes have no effect if you are using
p78435
aVNote also that this will tie you to
p78436
aVNET and possibly particular versions etc
p78437
as(dp78438
g18
V23354
p78439
stp78440
a((dp78441
g2
(lp78442
VY does not inherit "copy local" options from X
p78443
aVIf you want System
p78444
aVInteractive and System
p78445
aVReactive to be deployed with Y, then reference them both from Y, and in Y mark them as "Copy Local = true"
p78446
as(dp78447
g18
V23354
p78448
stp78449
a((dp78450
g2
(lp78451
VI query isn't a table
p78452
aVIMO, you should settle on something like a  here:
p78453
aVand
p78454
as(dp78455
g18
V23354
p78456
stp78457
a((dp78458
g2
(lp78459
V vs
p78460
aVThe field-number used to identify a sub-type must not conflict with any defined fields on that same type
p78461
aVJust use a number that doesn't conflict
p78462
aVThe conflict only applies to that type - it doesn't have to be unique among the sub-types; for example,  would be fine, and it would not matter whether  had a "field 8"
p78463
aVFrom that I deduce that the only way for the inheritance to work is with surrogates
p78464
aVI don't see how that follows
p78465
as(dp78466
g18
V23354
p78467
stp78468
a((dp78469
g2
(lp78470
Vafter 2 weaks of working this application have 150Mb of memory
p78471
aVNothing; that's doing just fine
p78472
aVMemory is there to be used, and apps needn't by overly shy about using it
p78473
aVIt doesn't sound like it is haemorrhaging memory; let it be
p78474
as(dp78475
g18
V23354
p78476
stp78477
a((dp78478
g2
(lp78479
VWe are a group of 2 C# programmers, which have experience in (snip) asp
p78480
aVnet MVC
p78481
aVYou want to write a web-site, and you have asp
p78482
aVnet MVC experience
p78483
aVASP
p78484
aVNET MVC can run on linux / Mono
p78485
aVSo my suggestion
p78486
aVdo that
p78487
aVSome links:
p78488
aVDeploy ASP
p78489
aVNET MVC on Linux: Best Practices, Tools & Suprises
p78490
aVDeveloping ASP
p78491
aVNET MVC Apps Using Mono
p78492
aVSetting up a Ubuntu, Apache, MySQL, Mono, ASP
p78493
aVNET, MVC 2 Development Server
p78494
aVmono FAQ : ASP
p78495
aVNET
p78496
as(dp78497
g18
V23354
p78498
stp78499
a((dp78500
g2
(lp78501
VI see no reason it would optimize that
p78502
aVpretty sure it won't (I know it won't optimize it at the IL layer, but that doesn't say anything about the JIT; but I really don't think it will - it doesn't know that the method is always going to return the same thing each time)
p78503
aVInstead, lift it out of the loop if you care about it:
p78504
aVRe just  (comments); let's create a test program:
p78505
aVif we compile that and then disassemble the IL (reflector/ildasm/etc), we get:
p78506
aVLook at L_0009 thru L_0011 - that is creating the  per loop iteration ( is the loop repeat)
p78507
aVThe compiler has been very literal with your request, as I would expect
p78508
as(dp78509
g18
V23354
p78510
stp78511
a((dp78512
g2
(lp78513
V is an anonymous type, so you can't refer to it conveniently
p78514
aVYou should use either a regular class that is defined in your code, or maybe a  (i
p78515
ag50
aV) - then:
p78516
as(dp78517
g18
V23354
p78518
stp78519
a((dp78520
g2
(lp78521
VIf you are exposing the datatable via data-binding, then forget it; you cannot make that thread-safe
p78522
aVEven if you wrap the  somehow (in a custom ), that doesn't do enough - data-binding makes assumptions about the data, in particular the  etc - for example, that it isn't going to randomly change length in a thread-contended way in the middle of iterating the data or adding a row on the UI thread
p78523
aVThere is provision for changes on the same thread via events
p78524
aVbut not cross-threaded
p78525
as(dp78526
g18
V23354
p78527
stp78528
a((dp78529
g2
(lp78530
VHow about:
p78531
aVNote: this won't protect you from reflection, or from generics with the  constraint, but it avoids the more likely  scenario
p78532
as(dp78533
g18
V23354
p78534
stp78535
a((dp78536
g2
(lp78537
VHow about:
p78538
as(dp78539
g18
V23354
p78540
stp78541
a((dp78542
g2
(lp78543
VThat is pretty much what  does, but there is a problem
p78544
aVtypically you need to check the  and  in one atomic unit - not check the  (one unit) then  (another unit) - you can't trust  at all once the lock is surrendered, and  will throw if another thread has stolen the work
p78545
aVMaybe try  in 4
p78546
aV0 (with ), or use  and
p78547
as(dp78548
g18
V23354
p78549
stp78550
a((dp78551
g2
(lp78552
VDifferent concept
p78553
aVCovariance in the  sense (or contravariance via ) is always reference-preserving, with no transformation at all - just the same reference in other (provable) terms
p78554
aVThis is also why it doesn't apply to structs that implement an interface, as a box is not reference-preserving
p78555
aVThe same reference-preserving logic applies to covariant assignment of arrays of reference-types
p78556
as(dp78557
g18
V23354
p78558
stp78559
a((dp78560
g2
(lp78561
VThis one is from the home page, but there should be similar in the tests:
p78562
aVArguments etc work as normal, and should map directly to defined parameter names if CommandType is specified
p78563
aVEach call to  relates to a successive results grid
p78564
as(dp78565
g18
V23354
p78566
stp78567
a((dp78568
g2
(lp78569
VThe lambda expression "rules" are part of the c# compiler (or whatever language you are using); the Expression itself has no automatic knowledge of the context
p78570
aVInstead, if you "capture" a variable, i
p78571
ag50
aVbelow:
p78572
aVthe compiler creates an instance of a generated context class, and uses  to associate it with the tree:
p78573
aVThe only way to "swap" context instance would be to rewrite the entire expression, typically via
p78574
aVAlso note that nested scopes can lead to more complex scenarios involving chained context objects
p78575
aVPersonally; I doubt you need to worry about this
p78576
as(dp78577
g18
V23354
p78578
stp78579
a((dp78580
g2
(lp78581
VThat is an empty element:
p78582
aVso it makes perfect sense that you're seeing an empty result for a query
p78583
aVI guess the page is loading that with ajax or other DOM manipulation
p78584
aVAlso, keep in mind that web-sites are usually intended for browsers, not scraping
p78585
aVThere may be a more appropriate source of this data somewhere, perhaps an RSS feed
p78586
as(dp78587
g18
V23354
p78588
stp78589
a((dp78590
g2
(lp78591
VThat namespace is LINQ-to-SQL, so you'll also need to add a reference to System
p78592
aVData
p78593
aVLinq
p78594
aVdll; it won't be added by default just by adding Entity Framework
p78595
as(dp78596
g18
V23354
p78597
stp78598
a((dp78599
g2
(lp78600
VIt isn't a very helpful idea to create a class on the fly, since none of your other code will be able to talk to it at compile time
p78601
aVWhat is the objective here
p78602
aVOptions:
p78603
aVuse a  to return data keyed by name
p78604
aVin 4
p78605
aV0, use , which has both dictionary and  APIs
p78606
aVif this is for databinding, implement  and provide properties at runtime
p78607
aVFor example:
p78608
aVbut importantly, this still has the  API for static use
p78609
as(dp78610
g18
V23354
p78611
stp78612
a((dp78613
g2
(lp78614
VIf you have text data that you need to store as binary:
p78615
aVYou convert a string to byte[] via Encoding
p78616
aVGetBytes(), for example Encoding
p78617
aVUTF8
p78618
aVGetBytes()
p78619
aVyou convert such text data back to a string via Encoding
p78620
aVGetString(); this requires the binary to be valid text data via this encoding (not arbitrary binary)
p78621
aVIf you have binary data you need to store as a string;
p78622
aVyou convert arbitrary binary to a string with Convert
p78623
aVToBase64String()
p78624
aVyou convert such a string back to binary with Convert
p78625
aVFromBase64String(); this requires the string to be a valid base-64 string (not an arbitrary string)
p78626
aVSo: look at Encoding
p78627
as(dp78628
g18
V23354
p78629
stp78630
a((dp78631
g2
(lp78632
VPretty simple really;
p78633
aVessentially performs like an inner loop here, creating a continuous sequence (all of the  from the first class, all of the  from the second class, etc)
p78634
aVcreates a concrete  from that data
p78635
aVthe  is fully static typed, and infers  from the expression
p78636
as(dp78637
g18
V23354
p78638
stp78639
a((dp78640
g2
(lp78641
VAll configuration section elements (such as  etc) have the  attribute, as discussed on MSDN
p78642
aVThis allows you to specify a separate file for inclusion, but not in the way you have shown
p78643
aVExample:
p78644
as(dp78645
g18
V23354
p78646
stp78647
a((dp78648
g2
(lp78649
Vshould get the name; there is no instance in ; but  should give you what you want
p78650
aVThe value is
p78651
as(dp78652
g18
V23354
p78653
stp78654
a((dp78655
g2
(lp78656
VFirstly, note that protobuf-net is just one available implementation for
p78657
aVNET; anyway
p78658
aVtest1
p78659
aVproto" is not a
p78660
aVproto - it is C#; a
p78661
aVproto is not required for use with protobuf-net, but in your interop scenario it is a very good idea
p78662
aVThere is VS2010 plugin for this, or alternatively the  tool that is in the protobuf-net zip:
p78663
aVThis should generate  with the contents:
p78664
aVNote that there are additional switches if you want, for example, it to attempt case normalization (so you get , , , etc), or want it to include additional serializer support (, , etc)
p78665
as(dp78666
g18
V23354
p78667
stp78668
a((dp78669
g2
(lp78670
VIMO, the preferred way to do that would be TSQL, not an ORM
p78671
aVwhich is trivial to execute via either ADO
p78672
aVNET or any helper utility
p78673
aVthat avoids dragging an unknown amount of data over the wire, and avoids a lengthy transaction while you perform multiple discreet operations
p78674
as(dp78675
g18
V23354
p78676
stp78677
a((dp78678
g2
(lp78679
VYou should cast all of those, rather than blindly using :
p78680
aVThis will "unbox" the value as needed
p78681
aVOf course, an easier approach here is to use an ORM or micro-ORM (such as "dapper") - then you just run:
p78682
aVwhere  is a class with properties that match the table definition, i
p78683
ag50
aVAlso; make sure you read about  here, i
p78684
ag50
aVthis is even more important for connections etc, but it acts to ensure the resource is correctly d even if there is an error
p78685
aVThis replaces your "init as null, set to null at the end" code, and has the advantage of actually doing something ;p
p78686
as(dp78687
g18
V23354
p78688
stp78689
a((dp78690
g2
(lp78691
V is not the same as ; doing an  is a significant re-writing of that method, and in particular affects the expectation of how that method exits to the caller
p78692
aVYou are right in that it doesn't actually do much (caveat: return types) except tell the compiler to enable some things (as do switches like ,  and  if you think about it) - but consider: this actually matters hugely in your example
p78693
aVIf  exits (and we assume no other threads) - you exe is toast
p78694
aVGone
p78695
aVNo longer exists
p78696
aVAdding  makes you consider that just because the method exits doesn't mean it has finished
p78697
aVYou really don't want  exiting before you are ready
p78698
aVAs a secondary effect, this switch also formalises that the method can only return things like ; without the switch, you might be tempted to make it async later, which could be a significantly breaking change
p78699
as(dp78700
g18
V23354
p78701
stp78702
a((dp78703
g2
(lp78704
VYes, there is an identity-manager that returns the same object if it sees the same record identity come back from the database
p78705
aVAs such, the result should be , unless you disable the identity-manager
p78706
as(dp78707
g18
V23354
p78708
stp78709
a((dp78710
g2
(lp78711
VPass an object that represents the data instead:
p78712
aVwith
p78713
aVof course, then the question becomes : why use  at all
p78714
aVsince a  class is a much better metaphor / mechanism for expressing that data, and  (or ) is ideal for a collection of such
p78715
aV(hint: I very, very, very rarely use  - or maybe less frequently than that)
p78716
as(dp78717
g18
V23354
p78718
stp78719
a((dp78720
g2
(lp78721
VIf you lower the severity to 10 or below (from memory) it will not raise an exception, but will be available via the  event on the connection
p78722
aVNote, however, that because of how TDS works, you should ensure that you  etc to the end of all results; for example, if you have multiple s and then a , and you only read the first  before dropping the data-reader, there is a chance you won't see the message (the TDS will be killed)
p78723
as(dp78724
g18
V23354
p78725
stp78726
a((dp78727
g2
(lp78728
VA "location" with longitude/latitude to me falls quite nicely into the "immutable value" slot
p78729
aVThe position itself doesn't change - if you change the latitude that is a different position
p78730
aVFrom there, it could be a ; for  the  would be the same size as an x64 reference anyway, so no real down side
p78731
aVRe equality; if the position isn't quite the same, it isn't "equals", at least in the "key" perspective, so I'd be happy with  here
p78732
aVYou could add a "is within (x) distance" method if it helped
p78733
aVOf course, great-arc geometry isn't exactly totally free either ;p
p78734
aVThoughts though:
p78735
aVit should override  as well as adding a
p78736
aVit should override  and implement
p78737
aVstatic operators are a nice-to-have optional extra
p78738
as(dp78739
g18
V23354
p78740
stp78741
a((dp78742
g2
(lp78743
VIn the first scenario, since thread B knows it isn't the UI thread, it might as well just call
p78744
aVWhen there are two non-UI threads, you are going to have to use some kind of message passing / queue
p78745
aVYou can't just interrupt thread A to run the work; you must code thread A to (for example) check a queue for work, dequeue an item and execute it
p78746
aVWhich is pretty much what winforms does, courtesy of the windows message loop
p78747
aVIt doesn't matter if it isn't the answer you're looking for - it is what it is
p78748
as(dp78749
g18
V23354
p78750
stp78751
a((dp78752
g2
(lp78753
VI can't comment on the duplex, but re protobuf-net - yes, especially in v2; there is an iOS build in the zip, and I know of success stories using this with both monotouch and unity
p78754
as(dp78755
g18
V23354
p78756
stp78757
a((dp78758
g2
(lp78759
VA / has no defined sort; that will not work
p78760
aVA  is sorted by key, not by value, so that won't work
p78761
aVPersonally, I think you should just use a regular  (for some simple  with the two properties), and after loading it:
p78762
aVthe subtle x/y switch in there achieves "descending"
p78763
aVIf you also need the data keyed by the first property, then separately store a
p78764
aVFull example:
p78765
as(dp78766
g18
V23354
p78767
stp78768
a((dp78769
g2
(lp78770
VIf we assume a  on , and the expression is that simple, then maybe just build it manually:
p78771
aVA visitor should work for more complex examples; for example:
p78772
aVand
p78773
as(dp78774
g18
V23354
p78775
stp78776
a((dp78777
g2
(lp78778
VDefine a class with the members you want as properties
p78779
aVThen populate and return that object
p78780
aVYou can make this simple using tools like "dapper":
p78781
aVThen:
p78782
aVNow:
p78783
aVit is clear we have a single object
p78784
aVthe members on the object are obvious and well-types
p78785
aVyou avoid a lot of overhead from DataTable
p78786
as(dp78787
g18
V23354
p78788
stp78789
a((dp78790
g2
(lp78791
VThat IL is simply the way the compiler caches the delegate instance - it isn't part of the method itself
p78792
aVIf you are using DynamicMethod (which you probably should be) then just call CreateDelegate({your delegate type}), cast it to your desired delegate type (probably ThreadStart), and store the (typed) delegate instance anywhere
p78793
as(dp78794
g18
V23354
p78795
stp78796
a((dp78797
g2
(lp78798
VThe point about underlying types is already well-covered, so I'll add a different context:
p78799
aVAt the IL / runtime level, instances of enums do not exist
p78800
aVThey only exist:
p78801
aVa: to the compiler
p78802
aVb: to the runtime as a boxed value
p78803
aVc: in metadata (parameter/field/variable declarations)
p78804
aVAt all other times, they are purely the integer-types values (most commonly )
p78805
aVThe compiler uses enum variables (etc) for static analysis, overload resolution, etc but the opcodes it emits are identical to those it would have emitted for constant / literal integer values; i
p78806
ag50
aVwill have identical IL (except for the variable type, perhaps)
p78807
aVThe only time it gets interesting is if emitting a box operation, or a call like
p78808
aVToString() etc
p78809
aVSo: as long as you don't box them (store them in an  field/etc), then there is (at runtime) no significant difference between an enum or an integer when it comes to storage or performance (unless you use
p78810
aVToString(), etc)
p78811
as(dp78812
g18
V23354
p78813
stp78814
a((dp78815
g2
(lp78816
VRe 2: with
p78817
aVNET 2
p78818
aV0 and above there is indeed little point in using  here unless you have a specific reason (such a the lock-semantics)
p78819
aVHowever,  is even less desirable (IMO)
p78820
aVThe better replacement would be  - or if the keys are always 1,2,3,
p78821
aVmaybe just a  and offset by one
p78822
aVWith a dictionary you get a  in foreach, I
p78823
ag50
as(dp78824
g18
V23354
p78825
stp78826
a((dp78827
g2
(lp78828
VYes, both  and  are supported; the latter maps to  in the
p78829
aVproto spec
p78830
aVThis is actually the same as how a sub-message is normally represented anyway
p78831
aVJust let the serializer know about the member (most simply: by adding an attribute such as )
p78832
as(dp78833
g18
V23354
p78834
stp78835
a((dp78836
g2
(lp78837
VJava's  is signed (it doesn't have unsigned types), while C#'s  is unsigned (there is a separate  for signed bytes); so two immediate options appear:
p78838
aVuse base-64 which will be immune to confusion
p78839
aVread the data as  in the C#, then just cast the values to  (per item)
p78840
aVI'd probably use the base-64 option as it should also be smaller than representing them as numbers on the wire, but as an example of the convert:
p78841
aV(add  if you are using checked contexts, but this is rare; unchecked is the default and mire common option)
p78842
as(dp78843
g18
V23354
p78844
stp78845
a((dp78846
g2
(lp78847
VUntested, but:
p78848
aVOf course, skip the first line if you are actually starting with a string, but since you mention UTF-8 I assumed binary
p78849
aVObviously for large data volumes you might use a / (each with encoding) instead - but same idea
p78850
as(dp78851
g18
V23354
p78852
stp78853
a((dp78854
g2
(lp78855
VRe " I want my same XMlDocument updated " - it doesn't work like that; the output is separate to the input
p78856
aVIf that is important, just use a StringWriter or MemoryStream as the destination, then reload the  from the generated output
p78857
aVConsider in particular: the output from an xslt transformation does not have to be xml, and also: the xslt is most likely using the node tree during the operation; changing the structure in-place would make that very hard
p78858
as(dp78859
g18
V23354
p78860
stp78861
a((dp78862
g2
(lp78863
VI think I'd look at a scripting solution here; probably IronPython is the easiest to bundle and host, but others are available (including Javascript
p78864
aVNET, IronRuby, IronScheme, Boo, F#, etc)
p78865
as(dp78866
g18
V23354
p78867
stp78868
a((dp78869
g2
(lp78870
VI don't know what the error is, but I have a hunch that if you redirect stderr () and read the stderr stream (like you do with stdout) it will tell you
p78871
aVAlternatively, while debugging leave  and maybe you'll see the console message (especially if it is waiting for a keypress; otherwise it might disappear too quickly to notice)
p78872
aVNote that you might need to set up async readers on stdout/stderr if the process isn't terminating
p78873
aVYou can do that either on extra threads, or via the  /  events (you need to set  to  also)
p78874
aVIf that still doesn't work; you could try running with
p78875
aVThis means you won't be able to redirect IO, so you might have to use  /  etc to pipe the output to a file (ideally in temp), then read the file
p78876
as(dp78877
g18
V23354
p78878
stp78879
a((dp78880
g2
(lp78881
VIn your example, I'm assuming that it would be reasonable to run the  calls in your standard code, although since we might not know the "depth", we can simplify to a jagged array (a rectangular array would work too, but is harder to work with at all points, so let's not do that)
p78882
aVSo imagine we have a jagged array instead of ,, (although we'll assume the answers  is simple enough)
p78883
aVThus, we actually need to build:
p78884
aVwhich is, as a tree:
p78885
aVSo we can build an expression (and evaluate), via:
p78886
aVObviously your actual code needs to parse your input expression and build a similar tree flexibly; but this should be enough to illustrate a general approach
p78887
as(dp78888
g18
V23354
p78889
stp78890
a((dp78891
g2
(lp78892
VIf cross-platform reading is your goal, IMO you should use a cross-platform serializer
p78893
aVXml would be a trivial example (and checking the docs, may be supported), so the first thing I'd try is serializing as xml and hacking through what is generated
p78894
aVIf that doesn't work, or you need something more compact then protobuf is available for Objective-C (or another, and of course there are several for C#)
p78895
aVI don't know much about the Apple serialization API, but platform tied serializers tend to do a few things that make portability very hard:
p78896
aVundocumented format (often)
p78897
aVtied to platform-specific types, requiring re-mapping
p78898
aVtied to specific names (fields etc) or layouts (byte offset) on the types
p78899
as(dp78900
g18
V23354
p78901
stp78902
a((dp78903
g2
(lp78904
VAn array of double would be best stored via
p78905
aVmakes it act as a list, allowing multiple items;  avoids a header per item
p78906
aVThere is no direct support for rectangular (or higher) arrays in protobuf
p78907
aVThe closest is to store something like:
p78908
aVthis is broadly akin to a jagged array, but with an element between each tier
p78909
as(dp78910
g18
V23354
p78911
stp78912
a((dp78913
g2
(lp78914
VMy understanding is that  acts in the same way as , and is intended for guiding the runtime when the language you are using lacks direct support (via  in C#)
p78915
aVAs such, the usage should be very similar to the  modifier, most notably using
p78916
as(dp78917
g18
V23354
p78918
stp78919
a((dp78920
g2
(lp78921
VHow do we avoid it
p78922
aVand
p78923
aVTotal number of rows in a csv file is 100000
p78924
aVIn this case, use  to write the 100,000 rows into a staging table (a basic and separate table, not part of your transactional tables; no triggers, foreign keys, etc)
p78925
aVOnce the data is in the staging table, use TSQL (either direct or a SPROC) to do the  from the staging table into the transactional table, i
p78926
ag50
aVwhere your data lives
p78927
aVThe transaction only needs to span this last operation
p78928
aVThis achieves several key things:
p78929
aVuses the same API as bulk-insert; it is the fastest way to shift large amounts of data over the wire to SQL Server
p78930
aVit minimises the size of the transaction, most notably by not including all the data transfer time in the transaction; only the core  is transactional, but at this point all the data is local
p78931
as(dp78932
g18
V23354
p78933
stp78934
a((dp78935
g2
(lp78936
VIt will depend on the model obviously, and serialization and deserialization will be different here
p78937
aVFor moderately sized models the performance overhead will be minimal, except of course it will typically have less actual serialization to do (assuming there is a reasonable amount of repeated object instances marked ; if there are none at all then the overhead, though minmimal, is wasted)
p78938
aVAnd if the reference means we avoid re-serializing a large branch of data (maybe a sub-collection etc) then we can get some very nice savings for both CPU and bandwidth
p78939
aVAny cost here is felt purely by serialization, since the problematic part is checking whether we have seen the object before
p78940
aVDuring deserialization it is just pluckign items from a list by index, so very fast
p78941
aVAlso note that I'm assuming  is disabled here, as that is a separate concern (again, impact is minimsed)
p78942
aVRe storage; currently a flat list is maintained, and checked for referential equality
p78943
aVI would like to have used a hashtable/dictionary lookup, but I have concerns about types that override /, and sadly it is not possible to access the original  instance method
p78944
aVThis means that for very large numbers of members marked  (and here I mean many many thousands of objects in the graph) it may slowly degrade (the lookup will be O(N) for a growing list of length N)
p78945
aVChanging this to a hash lookup would make it O(1) at each lookup
p78946
aVThinking aloud, we could possibly do something when we can prove that the type doesn't override (although this involves more reflection, which is itself a pain), or we could just trust the user not to make a mess of  etc - and use their definition of equality to mean equality in the graph
p78947
aVI'm open to thoughts here, but currently referential equality is used as the safest and simplest option
p78948
aVFor actual numbers: it depends a lot on your model and size; since you have a handy model and know the size with/without , you are presumably in a good position to wrap that in a  or similar (preferably to something like  so you aren't including disk/IO costs in the timing)
p78949
as(dp78950
g18
V23354
p78951
stp78952
a((dp78953
g2
(lp78954
VProtobuf is an appendable format, and your layout is ideal for this
p78955
aVJust open your file positioned at the end, and start with a new (empty)
p78956
aVAdd/serialize just the new  instance, and write to the file (from the end onwards)
p78957
aVNow, if you parse your file from the beginning you will get a single  with all the  instances (old and new)
p78958
aVYou could actually do this by logging each individual  as it arrives, as long as you wrap it in a  each time, i
p78959
ag50
aVin pseudo-code
p78960
as(dp78961
g18
V23354
p78962
stp78963
a((dp78964
g2
(lp78965
VIn most implementations, lower-case comes first (not least, that is how code-points are arranged ordinally)
p78966
aVYou won't be able to get SQL server to change that, so the next best thing is to bring it back unsorted, and write a custom comparer
p78967
aVNote that the inbuilt
p78968
aVNET comparers will also treat lower-case as either first or equal (compared to their upper-case equivalent), depending on the comparer
p78969
aVHowever
p78970
aVUnless you limit yourself to very simple examples (ASCII etc), ordering "alike" characters is a very non-trivial exercise
p78971
aVEven if we ignore the Turkish I / \u0130 / \u0131 / i, accented characters are going to cause you problems)
p78972
as(dp78973
g18
V23354
p78974
stp78975
a((dp78976
g2
(lp78977
VAn expression tree is an object-oriented representation of an expression at runtime
p78978
aVThe C# compiler can automatically write a limited subset of expressions as  instances, via a lambda - i
p78979
ag50
aVThe above will have a ; your example will have a  that captures  and a  that wraps that constant () and the member ()
p78980
aVThen at runtime, it locates the , which has a , which has a
p78981
aVIt could even have a  to a capture class, a  to  (as a field on the capture-class), and then a  to
p78982
aVThe difference is subtle, but an expression can be pulled apart and inspected at runtime - which is critical for LINQ
p78983
aVHowever: while the compiler can write these, they are not free to inspect; they have cost too
p78984
aVIMO, perhaps stick with:
p78985
aVthis is simpler and faster (obviously, changing the method to take a string that it passes to the event)
p78986
as(dp78987
g18
V23354
p78988
stp78989
a((dp78990
g2
(lp78991
VSure; protobuf has a few different encodings; what you want here is zig-zag encoding:
p78992
aVwhich has the xml-comment in protobuf-net:
p78993
as(dp78994
g18
V23354
p78995
stp78996
a((dp78997
g2
(lp78998
VIf you mean "in the handler", then:
p78999
aVor more dense as a lambda:
p79000
aVIf you mean "when invoking the event", use  and
p79001
as(dp79002
g18
V23354
p79003
stp79004
a((dp79005
g2
(lp79006
VYou want :
p79007
as(dp79008
g18
V23354
p79009
stp79010
a((dp79011
g2
(lp79012
VThere is no varadic support for generic type arguments (on either methods or types)
p79013
aVYou will have to add lots of overloads
p79014
aVvaradic support is only available for arrays, via , i
p79015
ag50
aVImprotantly - how would you even refer to those various  to write a generic method
p79016
aVPerhaps your best option is to take a  or similar (depending on the context)
p79017
as(dp79018
g18
V23354
p79019
stp79020
a((dp79021
g2
(lp79022
VOnly a few attributes get compiler support, but one very interesting use of attributes is in AOP: PostSharp uses your bespoke attributes to inject IL into methods, allowing all manner of abilities
p79023
aVlog/trace being trivial examples - but some other good examples are things like automatic INotifyPropertyChanged implementation (here)
p79024
aVSome that occur and impact the compiler or runtime directly:
p79025
aV- calls to this method (including argument evaluation) only occur if the "FOO" symbol is defined during build
p79026
aV- used to indicate a few thing like synchronization, inlining
p79027
aV- used to inject security checks into the code automatically
p79028
aV- used to move types between assemblies without rebuilding the callers
p79029
aVFor things that are checked manually via reflection - I'm a big fan of the  attributes; things like , ,  and  which can completely change the behavior of types in data-binding scenarios (i
p79030
ag50
aVdynamic properties etc)
p79031
as(dp79032
g18
V23354
p79033
stp79034
a((dp79035
g2
(lp79036
VActually, I might be wrong, but I don't expect F# to be as mainstream as the other
p79037
aVNET languages; useful in a few circles (academic, compilers, a few other scenarios) - however, don't forget that C# offers FP usage - and it gets better each time: C# 1
p79038
aV2 has delegates; C# 2
p79039
aV0 has anonymous methods and captures/closures; C# 3
p79040
aV0 has lambdas for simplicity, and Expression for abstraction
p79041
aVAnonymous types (C# 3
p79042
aV0) share some similarity with tuples (in terms of convenience), but obviously are very different beasts,  so definitely not a like-for-like comparison
p79043
aVMaybe not quite as optimised as F#, but for most day-to-day FP use-cases, more than sufficient
p79044
aVIt is also quite clear that better support for immutability (especially for threading) is very much on the minds of the C# language team for future consideration
p79045
aVMy money is on C# getting better at FP, and being the
p79046
aVNET FP offering for most day-to-day purposes
p79047
aVOf course, there will be some F# usage - but (purely subjective) I simply don't see there being a huge migration
p79048
as(dp79049
g18
V23354
p79050
stp79051
a((dp79052
g2
(lp79053
VI've never missed it once, not ever
p79054
aVYes, it [MI] gets complicated, and yes, interfaces do a similar job in many ways - but that isn't the biggest point: in the general sense, it simply isn't needed most of the time
p79055
aVEven single inheritance is overused in many cases
p79056
as(dp79057
g18
V23354
p79058
stp79059
a((dp79060
g2
(lp79061
VOK, due to demand, I've written up some of the Expression stuff
p79062
aVI'm not 100% happy with how blogger and LiveWriter have conspired to format it, but it'll do for now
p79063
aVAnyway, here goes
p79064
aVI'd love any feedback, especially if there are areas where people want more information
p79065
aVHere it is, like it or hate it
p79066
as(dp79067
g18
V23354
p79068
stp79069
a((dp79070
g2
(lp79071
VDelegates; I like the ability to write functional-style code, without the pain of F#, and the untyped function pointers of C++
p79072
aVAdd to that the very nice lambda syntax (C#), and the compiler support for captures, and they are great
p79073
aVI prefer C# captures to java captures, since the value can flow in either way (the variable, rather than the value, is captured)
p79074
aVAs a trivial example - how painful isn't this
p79075
as(dp79076
g18
V23354
p79077
stp79078
a((dp79079
g2
(lp79080
V is compile-time
p79081
aVYou could specify this in your build process (via switches to msbuild/csc), but not really at runtime
p79082
aVThe excluded code doesn't exist
p79083
aVYou might be better advised to (1 of):
p79084
aVHave separate DAL stacks for each back-end, using Dependency Injection / IoC
p79085
aVUse an ORM tool that supports either
p79086
aVBranch the code based n the provider (in a single DAL)
p79087
as(dp79088
g18
V23354
p79089
stp79090
a((dp79091
g2
(lp79092
VI wonder whether subversion hooks (at the svn server) might not be another approach here
p79093
aVI have not tried it, but CaptainHook appears to offer svn->
p79094
aVNET hook integration
p79095
as(dp79096
g18
V23354
p79097
stp79098
a((dp79099
g2
(lp79100
VAnother alternative to  is  - this provides a much simpler programming model, and is extensible to multiple simultaneous databases and other feeds (via DTC) - but at the cost of a small amount of overhead on the connection
p79101
aVIt used to be more overhead, but under SQL2005 etc it will use the "LTM" until you start spanning multiple connections - so a single operation is usually very cheap:
p79102
aVVery simple ;-p
p79103
aVYou should also be able to make the transaction more granular (over just a few queries) ormore encompassing very simply
p79104
aVMost existing code will automatically enlist in the transaction scope, making it very easy to retro-fit into existing code
p79105
aVFor more info on TransactionScope (and general transactions in
p79106
aVNET), see here
p79107
as(dp79108
g18
V23354
p79109
stp79110
a((dp79111
g2
(lp79112
VExpression Blend
p79113
aVVisual Studio 2010
p79114
as(dp79115
g18
V23354
p79116
stp79117
a((dp79118
g2
(lp79119
VThe most likely time you'll need this is for anonymous types (where it is 100% required); but it also avoids repetition for the trivial cases, and IMO makes the line clearer
p79120
aVI don't need to see the type twice for a simple initialization
p79121
aVFor example:
p79122
aV(please don't edit the hscroll in the above - it kinda proves the point
p79123
aVvs:
p79124
aVThere are, however, occasions when this is misleading, and can potentially cause bugs
p79125
aVBe careful using  if the original variable and initialized type weren't identical
p79126
aVFor example:
p79127
as(dp79128
g18
V23354
p79129
stp79130
a((dp79131
g2
(lp79132
VI would make the comparison an optional constructor parameter; this is comparable to how things like ,  etc allow you to specify the comparison mechanism
p79133
aVWhether to accepts an  or an  depends on whether you are going to sort the data, or just look for an equality match; if the match, then you'll need something like
p79134
aVUnfortunately, since this has 2 methods ( and ) there is no direct delegate version of this, except perhaps  or
p79135
aVFor the default constructor, I'd pass in the
p79136
as(dp79137
g18
V23354
p79138
stp79139
a((dp79140
g2
(lp79141
Vthe  method on  was a mistake (for iterator blocks, the language spec even demands that this throws an exception)
p79142
aVthe reflection methods that return arrays were, in Eric's view, a mistake
p79143
aVarray covariance was and remains an oddity; at least in C# 4
p79144
aV0 /
p79145
aVNET 4
p79146
aV0 this is done correctly for
p79147
aVrather fell out of favor - was that a mistake
p79148
aVsynchronized collections - a nice idea, but not necessarily useful in reality: you usually need to synchronize multiple operations (, then ), so a collection that synchronizes distinct operations isn't all that useful
p79149
aVmore use could have been made of the / pattern - perhaps allowing them to share a re-usable (extensible
p79150
aVsyntax; you can simulate this by returning  and using , but it could have been clearer
p79151
aViterator blocks : no simple way of checking arguments ahead-of-time (rather than lazily)
p79152
aVSure, you can write two chained methods, but that is ugly
p79153
aVsimpler immutability would be nice; C# 4
p79154
aV0 helps a bit, but not quite enough
p79155
aVno "this ref-type parameter cannot be null" support - although contracts (in 4
p79156
aV0) help with this somewhat
p79157
aVBut syntax like  (that injects a null-check / ) would be nice (contrast to  etc)
p79158
aVlack of support of operators and non-default constructors with generics; C# 4
p79159
aV0 solves this a bit with , or you can enable it like this
p79160
aVthe iterator variable being declared outside the while in the  expansion, meaning that anon-methods/lambdas capture the single variable, rather than one per iteration (painful with threading/async/etc)
p79161
as(dp79162
g18
V23354
p79163
stp79164
a((dp79165
g2
(lp79166
VWell, the "express" integration with testing is disabled
p79167
aVBut you can still run your unit tests separately - for example, at the command line or via the NUnit GUI
p79168
aVAs it happens, I am fully licensed, but if I wasn't, I'd happily use Express and NUnit
p79169
aVOr pay for VS Pro and use the personal edition of TestDriven
p79170
aVNET
p79171
as(dp79172
g18
V23354
p79173
stp79174
a((dp79175
g2
(lp79176
VCan you clarify
p79177
aVThe title suggests you have ASP
p79178
aVNET and want to add WPF (in which case look at xbap or Silverlight), but the question suggests you have WPF and want to add a web page
p79179
aVIf you want to view a web page, you should be able to host the  control in the WPF app
p79180
aVIf you want to host a web-server, look at
p79181
aVSo what do you have, and what exactly do you want to do
p79182
as(dp79183
g18
V23354
p79184
stp79185
a((dp79186
g2
(lp79187
V is the left-shift operator; this takes the binary representation of a value, and moves all the bits "n" places to the left (except for "mod", see "1"), back-filling with zeros
p79188
aVis the right-shift operator; this does nearly the opposite (moving to the right), except for signed values (i
p79189
ag50
aVthose that can be negative) it back-fills with 1s for negative values, else zeros
p79190
aV1:
p79191
aVThe shift operator is essentially "mod" the width of the data
p79192
aVAn int is 32 bits, so a left shift of 33 (in Int32) is exactly the same as a left shift of 1
p79193
aVYou don't get all zeros
p79194
aVA  is 64 bits, so a left-shift of 33 gives a different answer (original times 2^33)
p79195
aV2:
p79196
aVEach left shift (within the data width) is the same (for integers) as x2 - so <<4 is x2x2x2x2 = x16
p79197
aVThis is simple binary:
p79198
aV<< goes to
p79199
aV<< goes to
p79200
aV<< goes to
p79201
as(dp79202
g18
V23354
p79203
stp79204
a((dp79205
g2
(lp79206
VSome performance and size metrics are on this page
p79207
aVI haven't got Jon's stats on there at the moment, just because the page is a little old (Jon: we must fix that
p79208
aVRe being transparent; protobuf-net can hook into WCF via the contract; note that it plays nicely with MTOM over basic-http too
p79209
aVThis doesn't work with Silverlight, though, since Silverlight lacks the injection point
p79210
aVIf you use svcutil, you also need to add an attribute to class (via a partial class)
p79211
aVRe BinaryFormatter (remoting); yes, this has full supprt; you can do this simply by a trivial  implementation (i
p79212
ag50
aVjust call the  method with the same args)
p79213
aVIf you use  to create your classes, then it can do it for you: you can enable this at the command line via arguments (it isn't enabled by default as  doesn't work on all frameworks [CF, etc])
p79214
aVNote that for very small objects (single instances, etc) on local remoting (IPC), the raw  performance is actually better - but for non-trivial graphs or remote links (network remoting) protobuf-net can out-perform it pretty well
p79215
aVI should also note that the protocol buffers wire format doesn't directly support inheritance; protobuf-net can spoof this (while retaining wire-compatibility), but like with XmlSerializer, you need to declare the sub-classes up-front
p79216
aVWhy are there two versions
p79217
aVThe joys of open source, I guess ;-p Jon and I have worked on joint projects before, and have discussed merging these two, but the fact is that they target two different scenarios:
p79218
aVdotnet-protobufs (Jon's) is a port of the existing java version
p79219
aVThis means it has a very familiar API for anybody already using the java version, and it is built on typical java constructs (builder classes, immutable data classes, etc) - with a few C# twists
p79220
aVprotobuf-net (Marc's) is a ground-up re-implementation following the same binary format (indeed, a critical requirement is that you can interchange data between different formats), but using typical
p79221
aVNET idioms:
p79222
aVmutable data classes (no builders)
p79223
aVthe serialization member specifics are expressed in attributes (comparable to , , etc)
p79224
aVIf you are working on java and
p79225
aVNET clients, Jon's is probably a good choice for the familiar API on both sides
p79226
aVIf you are pure
p79227
aVNET, protobuf-net has advantages - the familiar
p79228
aVNET style API, but also:
p79229
aVyou aren't forced to be contract-first (although you can, and a code-generator is supplied)
p79230
aVyou can re-use your existing objects (in fact,  and  classes can often be used without any changes at all)
p79231
aVit has full support for inheritance (which it achieves on the wire by spoofing encapsulation) (possibly unique for a protocol buffers implementation
p79232
aVnote that sub-classes have to be declared in advance)
p79233
aVit goes out of its way to plug into and exploit core
p79234
aVNET tools (, , WCF, ) - allowing it to work directly as a remoting engine
p79235
aVThis would presumably be quite a big split from the main java trunk for Jon's port
p79236
aVRe merging them; I think we'd both be open to it, but it seems unlikely you'd want both feature sets, since they target such different requirements
p79237
as(dp79238
g18
V23354
p79239
stp79240
a((dp79241
g2
(lp79242
VUsing  / , you should be able to use:
p79243
as(dp79244
g18
V23354
p79245
stp79246
a((dp79247
g2
(lp79248
V returns a string (a sequence of characters)
p79249
aVIn Python, multiplying a string and a float makes no defined meaning (while multiplying a string and an integer has a meaning:  is ; how much is
p79250
aVPlease do not reply )
p79251
aVYou need to parse the string to a numerical value
p79252
aVYou might want to try:
p79253
as(dp79254
g18
V23354
p79255
stp79256
a((dp79257
g2
(lp79258
VThe value of a  always gets burned directly into the caller, so yes they are identical
p79259
aVAdditionally, the compiler interns strings found in source code - a  is helpful if you are using the same string multiple times (purely from a maintenance angle - the result is the same either way)
p79260
as(dp79261
g18
V23354
p79262
stp79263
a((dp79264
g2
(lp79265
VI think I'm in the same boat: I very rarely use datasets, and I certainly don't claim to be an expert on the adapter model (I think "" is the only method I have really used in production) - but they do occasionally have some uses
p79266
aVFor example, if you need to execute some ad-hoc SQL code, can't predict the schema (and so ORM doesn't help), and don't want to mess with  etc for a simple, small set of data
p79267
aVOther than that (i
p79268
ag50
aVmost of the time), I prefer standard classes - either ORM or manual
p79269
as(dp79270
g18
V23354
p79271
stp79272
a((dp79273
g2
(lp79274
VIt is more "constrained variables" than "constrained types" - but definitely interesting
p79275
aVAs with generic constraints, there are probably a few minor niggles with resolution if there are conflicting members, but the same workarounds would presumably apply as with generic constraints
p79276
aVOf course, the pragmatic view is that you can already cast etc, but then you need to keep the two references up-to-date with each-other
p79277
aVhmm
p79278
aVinteresting
p79279
as(dp79280
g18
V23354
p79281
stp79282
a((dp79283
g2
(lp79284
VIt is very easy trying to make something flexible, and ending up with the Inner Platform Effect
p79285
aVI'm guilty of inner-databases, for example
p79286
aVAnd sometimes it is too tempting to code things yourself rather than use that pre-canned similar version - Not Invented Here
p79287
aVI try to avoid it, but
p79288
as(dp79289
g18
V23354
p79290
stp79291
a((dp79292
g2
(lp79293
VAs mentioned, most properties must have both a getter and setter; the main exception to this is lists - for example:
p79294
aVwhich will work fine; however, if  finds a setter - it demands that it is public; the following will not work:
p79295
aVOther reasons it might not serialize:
p79296
aVit isn't public with get and set (or is  for a field)
p79297
aVit has a  attribute, and is with that value
p79298
aVit has a public  method that returned false
p79299
aVit has a public  property or field that returned false
p79300
aVit is marked
p79301
aVit is marked
p79302
aVAny of these will cause it not to serialize
p79303
as(dp79304
g18
V23354
p79305
stp79306
a((dp79307
g2
(lp79308
VCiting from thedailywtf:
p79309
aVOh, XML
p79310
aVThe Flat-File Society Does XML
p79311
aVXML vs CSV : The Choice is Obvious
p79312
as(dp79313
g18
V23354
p79314
stp79315
a((dp79316
g2
(lp79317
VWhat is it you need to get out
p79318
aVSandcastle is meant to do much of this - I don't know how complete it is, though
p79319
aVIt uses reflection and any code documentation files (
p79320
aVxml files from the  comments)
p79321
as(dp79322
g18
V23354
p79323
stp79324
a((dp79325
g2
(lp79326
VVisual InterDev 6
p79327
aV0, talking via FrontPage extensions to Visual SourceSafe
p79328
aVIt is so hunkered that if any of the config breaks, we're not sure that we can put it back together again
p79329
as(dp79330
g18
V23354
p79331
stp79332
a((dp79333
g2
(lp79334
VI can't claim credit (hence wiki) but there is a good answer here
p79335
as(dp79336
g18
V23354
p79337
stp79338
a((dp79339
g2
(lp79340
VThe serialized form of data is not the same as in-memory; for example, a collection/dictionary will involve multiple objects for the items, the arrays, hash-buckets/indexes, etc - but the raw data (when serialized) will typically be just the data - so you might see less volume when serialized
p79341
aVEqually, things like  have to include a lot of (verbose) type metadata - but in the objects it just has a (terse) type handle in the object handle - so you might see more data in the serialized data
p79342
aVLikewise, the serializer (unless it is manually optimized) needs to tokenize the individual fields - but in memory this is implicit in the offset from the objects address
p79343
aVSo you might get a number from serialization, but it is not the same number
p79344
aVTo get an accurate idea of the size of an object graph is tricky
p79345
aVSOS might help; otherwise, create a whole shed-load of them and divide
p79346
aVCrude, but it might just work
p79347
as(dp79348
g18
V23354
p79349
stp79350
a((dp79351
g2
(lp79352
VHow different do you want it to be each time
p79353
aVYou could always run it through an obfuscator
p79354
as(dp79355
g18
V23354
p79356
stp79357
a((dp79358
g2
(lp79359
VYes, it is a risk - and it gets discussed a lot
p79360
aVIt is getting to a point where it is very hard to pick up C# from scratch
p79361
aVFortunately, things have stabilised a bit, and the language changes between C# 3
p79362
aV0 and C# 4
p79363
aV0 are relatively minor
p79364
aVActually, I've recently been doing a lot of work trying to fix a CF generics problem, and as part of the fix it might actually happen that the code reverts almost to C# 1
p79365
aV2 techniques (no, or very few, generics)
p79366
aVSo most problems can be addressed with the simpler language constructs
p79367
aVThe point is: how hard should it be to do something
p79368
aVFor example - anonymous methods add a LOT of benefits for relatively little complexity
p79369
aV(4
p79370
aV0) adds some more for the COM interop scenarios
p79371
aVIterator blocks are invaluable for LINQ-style code
p79372
aVI see a lot of questions about the non-trivial parts of C#, and I think I would struggle to teach a beginner all of C# from the ground up
p79373
aVBooks like Jon's C# in Depth are good for people who already know the basics (at least C# 1
p79374
aV2; ideally some C# 2
p79375
aV0) - but it is not really designed for newbies (I know Jon won't disagree)
p79376
aVA tricky one indeed
p79377
aVFortunately, the C# team set the bar (for inclusion) very high; something new has be be very useful to make it into the language
p79378
as(dp79379
g18
V23354
p79380
stp79381
a((dp79382
g2
(lp79383
VAs a (perhaps-)interesting aside
p79384
aVis unusual in that it isn't  - this leads to some very, very odd things
p79385
aV(marked as wiki as it is somewhat off-topic to the actual question)
p79386
as(dp79387
g18
V23354
p79388
stp79389
a((dp79390
g2
(lp79391
VInteractive 3D effects are certainly doable in WPF/Surface, although it'll take a bit of work
p79392
aVFor example, have a look at the stuff here, especially the rolling globe about 1:50 into the first picture
p79393
aVThe implementation shown is Surface, but that is largely WPF with some different input mechanisms
p79394
aVUnfortunately, he doesn't show the code
p79395
as(dp79396
g18
V23354
p79397
stp79398
a((dp79399
g2
(lp79400
VThis is just an extended comment (hence wiki) in counter to the "the DataGridView will restrict you from changing some values (strings) but not other values (bools)" point; neither is editable; make it a  and both are editable
p79401
ag6864
as(dp79402
g18
V23354
p79403
stp79404
a((dp79405
g2
(lp79406
VYou could issue a "HEAD" request rather than a "GET"
p79407
aV(edit) - lol
p79408
aVLooks like I've done this before
p79409
aV; changed to wiki to avoid accusations of rep-garnering
p79410
aVSo to test a URL without the cost of downloading the content:
p79411
aVYou would / around the  to check for errors; no error
p79412
aVIt exists
p79413
aVWith C# 2
p79414
aV0 (VS2005):
p79415
aVand
p79416
as(dp79417
g18
V23354
p79418
stp79419
a((dp79420
g2
(lp79421
VI would be tempted to create an empty windows service project, and just grab the bits that deal with a service; it isn't a lot - a few references and some of the code in
p79422
aVYou can actually have your existing console work both as a service and as a console - either by checking the args to  and using (for example) a "-console" switch, or I believe you can check
p79423
aVIf it is in "console" mode, run your code as you do now; if it is in service mode, run the code you grabbed from the template project
p79424
aVFor info, you can also have the same exe work as the installer/uninstaller for the service
p79425
aVI do this with "-install" / "-uninstall" switches
p79426
aVFor an example, see here
p79427
as(dp79428
g18
V23354
p79429
stp79430
a((dp79431
g2
(lp79432
VIf you are talking about (xml) attributes (i
p79433
ag50
aV), then you aren't talking about  - so perhaps stick with the  etc
p79434
aVsomething like:
p79435
aVThat doesn't have the aliases - but it seems to be correct, at least
p79436
aVMerge the attributes above with "Guard"'s  code and it should be there
p79437
aV(credit here to "Guard", but this is wiki anyway
p79438
as(dp79439
g18
V23354
p79440
stp79441
a((dp79442
g2
(lp79443
VAzure is Microsoft's cloud computing environment - see here
p79444
aVRe WCF: is certainly one the the things you can host in the cloud, but you can do a lot more too
p79445
aV(wiki'd, as close to a dup, but not 100% dup
p79446
as(dp79447
g18
V23354
p79448
stp79449
a((dp79450
g2
(lp79451
VF# doesn't need parameters - in particular when using the pipeline operator
p79452
aVis equivalent to:
p79453
aV(a similar effect to extension methods, really)
p79454
aVIn Ruby, the brackets are always optional (similar to VB) - but in Ruby they are even optional when declaring a method:
p79455
aVis identical to:
p79456
as(dp79457
g18
V23354
p79458
stp79459
a((dp79460
g2
(lp79461
VAFAIK, no: there is no direct way of doing this on SQL Server
p79462
as(dp79463
g18
V23354
p79464
stp79465
a((dp79466
g2
(lp79467
V(made wiki, in case of dups)
p79468
aVC# (3
p79469
aV0) doesn't support covariance of lists etc
p79470
aVC# 4
p79471
aV0 will support limited [co|contra]variance, but still not lists
p79472
aVThe problem is that with:
p79473
aVI could do:
p79474
aVwhich would compile, but not work
p79475
aVThis behaviour is supported for arrays, but largely for historic reasons
p79476
as(dp79477
g18
V23354
p79478
stp79479
a((dp79480
g2
(lp79481
VXBAP is the regular
p79482
aVNET framework exposed (as WPF/XAML) in the browser; Silverlight is a much reduced framework, focusing on things like UI/media/etc
p79483
aVBut with the advantage of cross-patform support, and (with the next version) allowing the client to take it out-of-browser
p79484
aVThe XAML is similar, but is not a strict subset/superset; so you can't always translate "as is" in either direction; it will also be easier to go Silverlight-to-WPF/XBAP
p79485
aVWith Silverlight 3 on the horizon, I'm not sure I'd bother looking too hard at XBAP myself
p79486
aVif I wanted the full
p79487
aVNET, I'd go WPF/ClickOnce
p79488
aVAnd I'm pretty sure Silverlight doesn't use presentation host
p79489
as(dp79490
g18
V23354
p79491
stp79492
a((dp79493
g2
(lp79494
VNot a direct answer (hence wiki), but my experience with surface suggests to me that even if you do get an emulator, that is only enough to help quicken development - you shouldn't for one moment think that an app that looks and feels right on an emulator works well on an actual device
p79495
aVThis applies trebly so in the case of touch-enabled devices like iPhone / surface, where things like orientation, physical response, etc are all very important factors - that are poorly emulated (at best) on regular PCs
p79496
as(dp79497
g18
V23354
p79498
stp79499
a((dp79500
g2
(lp79501
VEric Lippert on method hiding
p79502
as(dp79503
g18
V23354
p79504
stp79505
a((dp79506
g2
(lp79507
VAlmost always a class; structs should really only be used for things that are values - for example, a complex-number, or a currency type/value pair - and should almost-without-exclusion be immutable
p79508
aVA parameterless constructor is handy on mutable data if you are going to do data-binding, as this allows the system to create instances without additional code from yourself
p79509
aVA non-empty constructor is pretty-much essential for immutable data
p79510
aVFor mutable data, an object initializer goes a long way towards that (although isn't quite the same in terms of validation etc):
p79511
aVWhether your types are immutable is up to you; mutable makes it easier to do data-binding and serialization
p79512
aVIn general, you tend to see more mutable types in
p79513
aVNET, but this may change as we get into the parallel / many-core era
p79514
as(dp79515
g18
V23354
p79516
stp79517
a((dp79518
g2
(lp79519
VUse the tool
p79520
aVSomebody needs to really understand how the existing tool works
p79521
aVNot just well enough to walk through it; but well enough to do it for real
p79522
aVWhy not take 2 weeks and go and do their job with them
p79523
aVThat will both improve your understanding of the tool, and may foster a better working relationship with them
p79524
aVAnd while you're there, perhaps buy the drinks once or twice - it sounds corny, but anything that lowers the hostility, and lets you communicate
p79525
aVUser experience
p79526
aVGetting a good developer (or better: designer) who understanding user-experience is probably key
p79527
aVYou can't just completely change their tooling and expect their productivity to remain the same
p79528
aVKeyboard use:
p79529
aVThink of tools like Visual Studio, AutoCAD, etc - in most cases you don't need the mouse, and "die hard" types wouldn't notice if you took their mouse away
p79530
aVTry to respect this; provide shortcuts / chords (ideally the same as the existing system)
p79531
aVTerminology:
p79532
aVKeep it the same
p79533
aVDon't invent new terms for things
p79534
aVTalk to them
p79535
aVThis may or may not be possible, but getting a few key users "on board" early can be pivotal; especially if you genuinely empower them to help with the user experience
p79536
aVFind the faults
p79537
aVIn the existing system
p79538
aVTake away their existing pain points and they may forgive you a lot
p79539
as(dp79540
g18
V23354
p79541
stp79542
a((dp79543
g2
(lp79544
VIt depends on what exactly you mean by "team leader" ;-p
p79545
aVI've seen places where there is a distinct split between the technical lead (who might have more accountability for technical decisions, design issues, the "go to guy" for coding snarls; etc), and the development lead, who is primarily a facilitator, with two main jobs:
p79546
aVresolve any non-coding blockages that arise
p79547
aVact as the main liaison to the client/customer/user-champion/whatever
p79548
ag412
ag50
aVanything to preserve those few precious golden hours of coding
p79549
aVThey might also do some coding on the side, but that isn't their primary job
p79550
aVMain skills of a technical lead:
p79551
aVexperience of the subject, product, APIs, language, etc
p79552
aVunderstand impact of changes to the above
p79553
aVability to make technical decisions
p79554
aVgeneral code problem solving
p79555
aVaccountability
p79556
aVgood at explaining technical subjects
p79557
aVa "perm"
p79558
aVMain skills of a development lead:
p79559
aVcommunication
p79560
aVpeople management
p79561
aVknowledge of the client/etc
p79562
aVtime accounting
p79563
aVability to steer the development focus
p79564
as(dp79565
g18
V23354
p79566
stp79567
a((dp79568
g2
(lp79569
VI'm confused; you say you want it as a POST param, but then you read it from a header
p79570
aVThat would be the Form for typical post fields, or just the request body for raw data
p79571
aVFor sending form fields:
p79572
aVFor sending a raw file (not as a form; just the text itself), use ; and for headers, use
p79573
as(dp79574
g18
V23354
p79575
stp79576
a((dp79577
g2
(lp79578
VTools like Pex may be useful here; it is designed to try to find values / scenarios that crash the code (by exercising every code branch and likely error-case like div-by-zero/overflow/etc), based on static analysis of what it does
p79579
aVIt has successfully found some edge-cases in code like the
p79580
aVNET "resx" reader
p79581
as(dp79582
g18
V23354
p79583
stp79584
a((dp79585
g2
(lp79586
VWithout using something like postsharp, the minimal version I use uses something like:
p79587
aVEach property is then just something like:
p79588
aVwhich isn't huge; it can also be used as a base-class if you want
p79589
aVThe  return from  tells you if it was a no-op, in case you want to apply other logic
p79590
aVor even easier with C# 5:
p79591
aVand:
p79592
aVwith which the compiler will add the  automatically
p79593
as(dp79594
g18
V23354
p79595
stp79596
a((dp79597
g2
(lp79598
VAttributes, with a few exceptions with special treatment, only provide metadata
p79599
aVThey don't provide executable code, unless you use a tool like PostSharp
p79600
aVPersonally, I'd code with ; it works, and won't confuse people
p79601
as(dp79602
g18
V23354
p79603
stp79604
a((dp79605
g2
(lp79606
VI let people trust my code in a number of projects, but I urge people to make and maintain their own tests, and I make sure that I'm content with the unit tests
p79607
aVDocumentation is always good, but I'm very guilty of finding time to do as much as I would like
p79608
aVBut having the author fairly contactable is helpful
p79609
as(dp79610
g18
V23354
p79611
stp79612
a((dp79613
g2
(lp79614
VDo you mean you want all values, sorted by the inner value
p79615
as(dp79616
g18
V23354
p79617
stp79618
a((dp79619
g2
(lp79620
VFirst, choose your flavor of SQL - there are several
p79621
aV(T-, PL-, etc)
p79622
aVUltimately, there are similarities and differences
p79623
aVA lot of the LINQ changes make more sense - i
p79624
ag50
aVchoosing your source () before you try filtering () / projection (), allowing better static analysis etc (including intellisense), and a more natural query comprehension syntax
p79625
aVThis helps both the developer and the compiler, so I'm happy
p79626
as(dp79627
g18
V23354
p79628
stp79629
a((dp79630
g2
(lp79631
VMarking as wiki as I can't claim any credit, but an MSFT answer to this question is here: What is the equivilant of GetTable in L2E
p79632
as(dp79633
g18
V23354
p79634
stp79635
a((dp79636
g2
(lp79637
VSVN isn't tricky
p79638
aVSince it sounds like you're windows based (C#), perhaps pick up something like VisualSVN Server (free) and Tortoise SVN client (free)
p79639
aVYou can literally get it all going in under half an hour
p79640
aVSince you are using a variety of tools, it sounds like IDE integration might not be the most important thing (tortoise is an explorer extension)
p79641
aVLearning the best way to organise your projects is tricker
p79642
aVand comes with time
p79643
aVBut if you are mainly using the basic "checkout, edit, commit" (+ backup) approach it should be simple to get started
p79644
aVAnd TEST YOUR BACKUPS
p79645
aVIf you haven't tested them, they don't exist
p79646
aVThere are "changes afoot" for TFS that might make that a viable option for the lone developer next year (install the server on desktop OS, for example) - but it it a much more complex product, the "new" pricing model isn't yet announced, and it won't be aimed squarely at your Java code
p79647
aVBut if you have a suitable level of MSDN subscription it might be an option worth looking at next year
p79648
aVThe current TFS would probably be overkill
p79649
as(dp79650
g18
V23354
p79651
stp79652
a((dp79653
g2
(lp79654
VThe main advantage is that you can handle null and empty strings separately in both the
p79655
aVNET and SQL code - they can, after all, mean different things
p79656
aVThe downside is you need to be careful; in
p79657
aVNET you have to not call obj
p79658
aVSomeMethod() on null, and in SQL you need to watch that nulls tend to propagate when combined (unlike, for example, C# string concatenation)
p79659
aVThere isn't really a noticeable size difference between null and empty
p79660
aVIn the
p79661
aVNET code I'd hope that it uses the interned empty string, but it isn't going to matter hugely
p79662
as(dp79663
g18
V23354
p79664
stp79665
a((dp79666
g2
(lp79667
VIt isn't much of a step behind
p79668
aVEspecially now that Mono 2
p79669
aV6 "borrows" Silverlight's WCF implementation and provides a LINQ-to-SQL equivalent
p79670
aVIt might not have the wide coverage of Java, but the code I write runs fine in all the places I care about
p79671
as(dp79672
g18
V23354
p79673
stp79674
a((dp79675
g2
(lp79676
VActually, for min/max it is easier to use , which also supports , handles "lifted" operators, etc
p79677
aVYou can get most of this for free if you use MiscUtil; I wrote some code that provides access to generic operators, including generic extension methods for , , etc
p79678
aVUnfortunately, operators can't appear on interfaces, and to make things worse the primitives don't actually have operators in the  sense (this is provided directly in IL instead) - as discussed here
p79679
as(dp79680
g18
V23354
p79681
stp79682
a((dp79683
g2
(lp79684
VWhat is a wire-type
p79685
aVIt is a 3-bit flag that tells it (in broad terms; it is only 3 bits after all) what the next data looks like
p79686
aVEach field in protocol buffers is prefixed by a header that tells it which field (number) it represents,
p79687
aVand what type of data is coming next; this "what type of data" is essential to support the case where
p79688
aVunanticipated data is in the stream (for example, you've added fields to the data-type at one end), as
p79689
aVit lets the serializer know how to read past that data (or store it for round-trip if required)
p79690
aVWhat are the different wire-type values and their description
p79691
aV0: variant-length integer (up to 64 bits) - base-128 encoded with the MSB indicating continuation (used as the default for integer types, including enums)
p79692
aV1: 64-bit - 8 bytes of data (used for , or electively for /)
p79693
aV2: length-prefixed - first read an integer using variant-length encoding; this tells you how many bytes of data follow (used for strings, , "packed" arrays, and as the default for child objects properties / lists)
p79694
aV3: "start group" - an alternative mechanism for encoding child objects that uses start/end tags - largely deprecated by Google, it is more expensive to skip an entire child-object field since you can't just "seek" past an unexpected object
p79695
aV4: "end group" - twinned with 3
p79696
aV5: 32-bit - 4 bytes of data (used for , or electively for / and other small integer types)
p79697
aVI suspect a field is causing the problem, how to debug this
p79698
aVAre you serializing to a file
p79699
aVThe most likely cause (in my experience) is that you have overwritten an existing file, but have not truncated it; i
p79700
ag50
aVit was 200 bytes; you've re-written it, but with only 182 bytes
p79701
aVThere are now 18 bytes of garbage on the end of your stream that is tripping it up
p79702
aVFiles must be truncated when re-writing protocol buffers
p79703
aVYou can do this with :
p79704
aVor alternatively by  after writing your data:
p79705
as(dp79706
g18
V23354
p79707
stp79708
a((dp79709
g2
(lp79710
VIt isn't really quite the same concept as in haskell etc, but in C#, the lambda construct has (optionally) the ability to compile to an objcet model representing the code (expression-trees) rather than code itself (this is itself one of the cornerstones of LINQ)
p79711
aVThis in turn can lead to some very expressive meta-programming opportunities, for example (where the lambda here is expressing "given a service, what do you want to do with it
p79712
ag6864
aV(assuming a suitable  signature)
p79713
aVThere are lots of uses for this type of thing, but I've used it to build an RPC stack that doesn't require any runtime code generation - it simply parses the expression-tree, figures out what the caller intended, translates it to RPC, invokes it, gathers the response, etc (discussed more here)
p79714
as(dp79715
g18
V23354
p79716
stp79717
a((dp79718
g2
(lp79719
V essentially does this - that is key to some of LINQ
p79720
aVI am currently using reflection emit to re-write a serialization API - because sometimes reflection just isn't good enough
p79721
aVAs it happens this will also allow it to generate dlls (much like how sgen works), allowing fully static code (I'm hopeful this will make it iPhone friendly)
p79722
aVI also use a similar approach in HyperDescriptor to provide very fast name-based property-lookup
p79723
aVI've also used emit to do things like:
p79724
aVAOP (cache injection)
p79725
aVinterface list wrapping
p79726
aVcompare objects
p79727
aVall related to SO questions
p79728
aVFinally, this IL approach is the core of protobuf-net "v2"; the reason here is that it allows me both to have a fast model at runtime (compiling it via IL on the fly), and to write the same directly to a static-compiled dll, so that it works on things like iPhone, Phone 7, etc (which lack the necessary meta-programming APIs)
p79729
as(dp79730
g18
V23354
p79731
stp79732
a((dp79733
g2
(lp79734
VIt is usually pretty rare that you need to go down to this level, but I'm doing something pretty similar at the moment; some thoughts:
p79735
aVdo you have any buffers in regular use
p79736
aVHave you considered pooling them
p79737
ag412
ag50
aVso that instead of creating a new one you ask a pool to get (or create) one
p79738
aVhave you removed any reflection
p79739
aV(replacing with typed delegates, , etc) - or taking it hardcore,
p79740
aVhave you considered
p79741
aV(used sparingly, in places where you have a measured need to do so)
p79742
aV(again, pretty low level) have you looked for anything silly in the IL
p79743
aVI recently found a lot of cycles (in some specific code) were being spent shuffling things around on the stack to pass in parameters appropriate
p79744
aVBy changing the code (and, admittedly doing some custom IL) I've eliminated all the unnecessary (shuffling) /, and removes almost all of the locals (reducing the stack size in the process)
p79745
aVBut honestly, you need to profile here
p79746
aVFocus on things that actually matter, or where you know you have a problem to fix
p79747
as(dp79748
g18
V23354
p79749
stp79750
a((dp79751
g2
(lp79752
VThe truth is that there is no such thing as the perfect optimised code
p79753
aVYou can, however, optimise for a specific portion of code, on a known system (or set of systems) on a known CPU type (and count), a known platform (MS
p79754
aVMono
p79755
aV, a known framework / BCL version, a known CLI version, a known compiler version (bugs, spec changes, tweaks), a known amount of total and available memory, a known assembly origin (GAC
p79756
aVdisk
p79757
aVremote
p79758
aV, with known background system activity from other processes
p79759
aVIn the real world, use a profiler, and looks at the important bits; usually the obvious things are anything involving IO, anything involving threading (again, this changes hugely between versions), and anything involving loops and lookups, but you might be surprised at what "obviously bad" code isn't actually a problem, and what "obviously good" code is a huge culprit
p79760
as(dp79761
g18
V23354
p79762
stp79763
a((dp79764
g2
(lp79765
VYou should just need:
p79766
as(dp79767
g18
V23354
p79768
stp79769
a((dp79770
g2
(lp79771
VPerformance is pretty specific to particular scenarios
p79772
aVYou cannot simply measure "performance"
p79773
aVYou have to measure "performance of [detailed, repeatable situation]"
p79774
aVThe only real way to answer this is to measure it for your specific code
p79775
as(dp79776
g18
V23354
p79777
stp79778
a((dp79779
g2
(lp79780
VCopying in an answer (hence wiki, as not my answer) from Kenton Varda on the protobuf list:
p79781
aVNo, the camel-case name is not stored anywhere
p79782
aVYou will need to construct
p79783
aVit yourself
p79784
aVIf performance is a concern, just cache the results in a
p79785
aVMap
p79786
as(dp79787
g18
V23354
p79788
stp79789
a((dp79790
g2
(lp79791
VI'm marking this as "wiki" as it doesn't really answer the question, but here's my "cannot reproduce" sample, where it behaves as expected:
p79792
as(dp79793
g18
V23354
p79794
stp79795
a((dp79796
g2
(lp79797
VWriting this as wiki, as it doesn't answer the question, but show how this type should be written:
p79798
aVfor reasons, see the comments I added to the qestion
p79799
as(dp79800
g18
V23354
p79801
stp79802
a((dp79803
g2
(lp79804
VCan I confirm: you are writing a COM dll in
p79805
aVNET, that you want to consume from VB6
p79806
aVThe most supportable option would probably be to use an msi (setup and deployment package) to register the assembly with COM
p79807
aVYou can do it at the command line, but it is harder
p79808
as(dp79809
g18
V23354
p79810
stp79811
a((dp79812
g2
(lp79813
VIn
p79814
aVNET 4
p79815
aV0, this same bug reappeared; it was fixed in a hotfix with KB:2576011
p79816
aVIt may now be rolled up into standard updates (haven't checked), but: a hotfix for 4
p79817
aV0 is available from MS if needed
p79818
as(dp79819
g18
V23354
p79820
stp79821
a((dp79822
g2
(lp79823
VIf you are using mercurial, this is done via "import"
p79824
aVSo at the command line, the  command, or  (you may find the  option useful), or "Repository" => "Import
p79825
aVin Hg Workbench
p79826
aVNote that these will commit the changes by default; you can avoid this using   option if using the command-line, or if you used Hg Workbench, you might find it useful to issue  after the merge
p79827
as(dp79828
g18
V23354
p79829
stp79830
a((dp79831
g2
(lp79832
VIn addition to the "it is a value" answer, one specific scenario for using structs is when you know that you have a set of data that is causing garbage collection issues, and you have lots of objects
p79833
aVFor example, a large list/array of Person instances
p79834
aVThe natural metaphor here is a class, but if you have large number of long-lived Person instance, they can end up clogging GEN-2 and causing GC stalls
p79835
aVIf the scenario warrants it, one potential approach here is to use an array (not list) of Person structs, i
p79836
ag50
aVNow, instead of having millions of objects in GEN-2, you have a single chunk on the LOH (I'm assuming no strings etc here - i
p79837
ag50
aVa pure value without any references)
p79838
aVThis has very little GC impact
p79839
aVWorking with this data is awkward, as the data is probably over-sized for a struct, and you don't want to copy fat values all the time
p79840
aVHowever, accessing it directly in an array does not copy the struct - it is in-place (contrast to a list indexer, which does copy)
p79841
aVThis means lots of work with indexes:
p79842
aVNote that keeping the values themselves immutable will help here
p79843
aVFor more complex logic, use a method with a by-ref parameter:
p79844
aVAgain, this is in-place - we have not copied the value
p79845
aVIn very specific scenarios, this tactic can be very successful; however, it is a fairly advanced scernario that should be attempted only if you know what you are doing and why
p79846
aVThe default here would be a class
p79847
as(dp79848
g18
V23354
p79849
stp79850
a((dp79851
g2
(lp79852
VIn
p79853
aVNET 4
p79854
aV5 / C# 5, this is simple:
p79855
aVThe compiler adds the caller's name automatically; so:
p79856
aVwill pass in
p79857
as(dp79858
g18
V23354
p79859
stp79860
a((dp79861
g2
(lp79862
VReflection, basically, i
p79863
ag50
aVor there are libraries to help both in terms of convenience and performance; for example with FastMember:
p79864
aV(which also has the advantage of not needing to know in advance whether it is a field vs a property)
p79865
as(dp79866
g18
V23354
p79867
stp79868
a((dp79869
g2
(lp79870
VA simpler approach is to just use an  constructor, but make the caller prove who they are by supplying a reference that only the legitimate caller could know (we don't need to be concerned about non-public reflection, because if the caller has access to non-public reflection then we've already lost the fight - they can access a  constructor directly); for example:
p79871
as(dp79872
g18
V23354
p79873
stp79874
a((dp79875
g2
(lp79876
VIn versions of
p79877
aVNET prior to 4
p79878
aV5, the maximum object size is 2GB
p79879
aVFrom 4
p79880
aV5 onwards you can allocate larger objects if gcAllowVeryLargeObjects is enabled
p79881
aVNote that the limit for  is not affected, but "arrays" should cover "lists" too, since lists are backed by arrays
p79882
as(dp79883
g18
V23354
p79884
stp79885
a((dp79886
g2
(lp79887
VIf you can use a tool like "dapper", this can be simply:
p79888
aVDapper will handle unwrapping this to individual parameters for you
p79889
as(dp79890
g18
V23354
p79891
stp79892
a((dp79893
g2
(lp79894
VIn versions of
p79895
aVNET prior to 4
p79896
aV5, the maximum object size is 2GB
p79897
aVFrom 4
p79898
aV5 onwards you can allocate larger objects if gcAllowVeryLargeObjects is enabled
p79899
aVNote that the limit for  is not affected, but "arrays" should cover "lists" too, since lists are backed by arrays
p79900
as(dp79901
g18
V23354
p79902
stp79903
a((dp79904
g2
(lp79905
VIn versions of
p79906
aVNET prior to 4
p79907
aV5, the maximum object size is 2GB
p79908
aVFrom 4
p79909
aV5 onwards you can allocate larger objects if gcAllowVeryLargeObjects is enabled
p79910
aVNote that the limit for  is not affected, but "arrays" should cover "lists" too, since lists are backed by arrays
p79911
as(dp79912
g18
V23354
p79913
stp79914
a((dp79915
g2
(lp79916
VIn versions of
p79917
aVNET prior to 4
p79918
aV5, the maximum object size is 2GB
p79919
aVFrom 4
p79920
aV5 onwards you can allocate larger objects if gcAllowVeryLargeObjects is enabled
p79921
aVNote that the limit for  is not affected, but "arrays" should cover "lists" too, since lists are backed by arrays
p79922
as(dp79923
g18
V23354
p79924
stp79925
a((dp79926
g2
(lp79927
VA lot of things don't make sense to be cloned; anything that talks to an unmanaged handle, for example
p79928
aVMost objects do not need a clone facility
p79929
aVDeep-copying something properly is really hard if you go outside of a few simple cases
p79930
aVIn many cases, there are better metaphors than blind clones
p79931
aVManually adding a clone facility to your types that need it is trivially easy
p79932
aVTo me, then, it is a no-brainer that this should not be added to the public API by default
p79933
as(dp79934
g18
V23354
p79935
stp79936
a((dp79937
g2
(lp79938
VOddly, I would have expected it to return garbage when not commented; doesn't  end up storing a pointer to the stack
p79939
aVWhich will be invalid after  exits
p79940
as(dp79941
g18
V23354
p79942
stp79943
a((dp79944
g2
(lp79945
VIn versions of
p79946
aVNET prior to 4
p79947
aV5, the maximum object size is 2GB
p79948
aVFrom 4
p79949
aV5 onwards you can allocate larger objects if gcAllowVeryLargeObjects is enabled
p79950
aVNote that the limit for  is not affected, but "arrays" should cover "lists" too, since lists are backed by arrays
p79951
as(dp79952
g18
V23354
p79953
stp79954
a((dp79955
g2
(lp79956
VFrom
p79957
aVNET 4
p79958
aV5 the difference in this case is: exactly nothing
p79959
aVIt looks like the JIT now detects this ldsfld and injects the interned empty string directly
p79960
aVYou can tell this because in < 4
p79961
aV5, you can change the value of string
p79962
aVEmpty via reflection and it impacts code using string
p79963
aVEmpty
p79964
aVNasty but possible
p79965
aVFrom 4
p79966
aV5 this no longer works
p79967
aVIf you can check via reflection you get the hacked version, but code using string
p79968
aVEmpty via ldsfld gets the correct empty string rather than the hacked version
p79969
as(dp79970
g18
V23354
p79971
stp79972
a((dp79973
g2
(lp79974
VWith FastMember, you can do this without ever needing to go via  (which, in my tests, more-than-doubles the performance):
p79975
aVNote that  can also work with non-generic sources, and it is not necessary to specify the member-names in advance (although you probably want to use the  aspect of  if you don't specify them in the  itself)
p79976
as(dp79977
g18
V23354
p79978
stp79979
a((dp79980
g2
(lp79981
VIn versions of
p79982
aVNET prior to 4
p79983
aV5, the maximum object size is 2GB
p79984
aVFrom 4
p79985
aV5 onwards you can allocate larger objects if gcAllowVeryLargeObjects is enabled
p79986
aVNote that the limit for  is not affected, but "arrays" should cover "lists" too, since lists are backed by arrays
p79987
as(dp79988
g18
V23354
p79989
stp79990
a((dp79991
g2
(lp79992
VI'm going to disagree with the trend here
p79993
aVI'll go on record:
p79994
aVI do not agree that  serves any useful purpose; it adds unnecessary confusion, while contributing virtually no value
p79995
aVThe argument is often put forward that  is an invalid reference, and that  is a null object pattern; neither is true
p79996
aVFor example:
p79997
aVthis is not an "invalid reference"; it is a  value
p79998
aVIndeed  means whatever you want it to mean, and frankly I have absolutely no problem working with values that may be  (indeed, even in SQL we need to correctly work with  - nothing changes here)
p79999
aVEqually, the "null object pattern" only makes sense if you are actually treating it as an object in OOP terms, but if we have a value that can be "our value, or a " then it must be , so we can't be doing anything useful with it
p80000
aVThere are so many bad things with :
p80001
aVit forces you to work with , since only  can hold  or another value
p80002
aVthere is no real difference between "could be a value or " vs "could be a value or "
p80003
aVthe argument that it stems from 1
p80004
aV1 (pre-nullable-types) is meaningless; we could use  perfectly well in 1
p80005
ag733
aVmost APIs have "is it null
p80006
aVmethods, for example  or  - neither of which actually require  to exist in terms of the API
p80007
aVfails in terms of null-coalescing;  doesn't work if the value is
p80008
aVcan't be used in optional parameters, since it isn't a constant
p80009
aVthe runtime semantics of  are identical to the semantics of ; in particular,  actually equals  - so it does not do the job of representing the SQL semantic
p80010
aVit often forces value-type values to be boxed since it over-uses
p80011
aVif you need to test for , you might as well have tested for just
p80012
aVit causes huge problems for things like command-parameters, with a very silly behaviour that if a parameter has a  value it isn't sent
p80013
aVwell, here's an idea: if you don't want a parameter sent - don't add it to the parameters collection
p80014
aVevery ORM I can think of works perfectly well without any need or use of , except as an extra nuisance when talking to the ADO
p80015
aVNET code
p80016
aVThe only even remotely compelling argument I've ever seen to justify the existence of such a value is in , when passing in values to create a new row; a  means "use the default", a  is explicitly a null - frankly this API could have had a specific treatment for this case - an imaginary  for example would be much better than introducing a  that infects vast swathes of code for no reason
p80017
aVEqually, the  scenario is
p80018
aVtenuous at best; if you are executing a scalar method, you expect a result
p80019
aVIn the scenario where there are no rows, returning  doesn't seem too terrible
p80020
aVIf you absolutely need to disambiguate between "no rows" and "one single null returned", there's the reader API
p80021
aVThis ship has sailed long ago, and it is far far too late to fix it
p80022
aVBut
p80023
aVPlease do not think that everyone agrees that this is an "obvious" thing
p80024
aVMany developers do not see value in this odd wrinkle on the BCL
p80025
aVI actually wonder if all of this stems from two things:
p80026
aVhaving to use the word  instead of something involving "null" in VB
p80027
aVbeing able to us the  syntax which "looks just like SQL", rather than the oh-so-tricky
p80028
aVSummary:
p80029
aVHaving 3 options (, , or an actual value) is only useful if there is a genuine example where you need to disambiguate between 3 different cases
p80030
aVI have yet to see an occasion where I need to represent two different "null" states, so  is entirely redundant given that  already exists and has much better language and runtime support
p80031
as(dp80032
g18
V23354
p80033
stp80034
a((dp80035
g2
(lp80036
VFalse dichotomy
p80037
aVIMO, you can get the sweet spot of both by using raw SQL (which is an important skill, that we should not shy away from) with tools that simply make that convenient
p80038
aVStored procedures introduce some coupling / deployment issues (timing, etc) that most people don't need; ORMs can be poor performing
p80039
aVMost people aren't going to change RDBMS (and if they do, it will be a major project anyway), so: I'm a big fan of parameterized command text
p80040
aVAnd tools that help, for example, dapper
p80041
aVAnother user posted a LINQ example of filtering by name; well, here's the same in dapper:
p80042
aVFully parameterized; havily optimized; safe; quick; clean; easy to get right
p80043
aVJob done
p80044
as(dp80045
g18
V23354
p80046
stp80047
a((dp80048
g2
(lp80049
VAs an advisory to people investigating this issue "before it is too late"
p80050
aVI strongly advise against persisting via BinaryFormatter
p80051
aVIt is OK for transient transfer between 2 app-domains that are in sync, but that is about it IMO
p80052
aVOther serialization tools exist that don't have these issues
p80053
aVIn terms of binary, protobuf-net is a pretty reasonable option - allowing add/remove/rename etc without pain
p80054
as(dp80055
g18
V23354
p80056
stp80057
a((dp80058
g2
(lp80059
VThis is solved simply with the  property on , ,  and  (etc); example shown below:
p80060
aVOutput:
p80061
aVXml (from here):
p80062
aVC#:
p80063
aVNote I've only mapped a few of the xml values - but it should show that it essentially works
p80064
as(dp80065
g18
V23354
p80066
stp80067
a((dp80068
g2
(lp80069
VTrailing commas on an object initializer; fine in C#
p80070
aVnot so fine in javascript
p80071
as(dp80072
g18
V23354
p80073
stp80074
a.